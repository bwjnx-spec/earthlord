"use strict";(self.webpackChunkbear_fe=self.webpackChunkbear_fe||[]).push([["vsh_6388"],{vsh_72834:function(e,t,r){r.d(t,{dFq:function(){return Wee},TMv:function(){return gm},w99:function(){return Io},T_g:function(){return Qte},k6y:function(){return bee},SWH:function(){return au},bwg:function(){return xp},XhZ:function(){return Up},W7I:function(){return eu},JTP:function(){return hf},yJh:function(){return Wg},_5N:function(){return xr},ZSG:function(){return Pr},isD:function(){return s2},R4C:function(){return lF},DB6:function(){return Sne},Vb3:function(){return WI},zcn:function(){return ns},GfN:function(){return qd},luK:function(){return uu},zof:function(){return L6},$gu:function(){return Yd},qxV:function(){return oI},BHd:function(){return cI},rvb:function(){return nu},Jr5:function(){return pae},DXb:function(){return Tne},ZJ7:function(){return zI},DsI:function(){return iV},Gni:function(){return dn},DmQ:function(){return Uk},f5z:function(){return QT},at8:function(){return fC},GzH:function(){return hre},YLM:function(){return K5},CSb:function(){return A6},EPL:function(){return O6},Aog:function(){return hO},J5L:function(){return bN},bA2:function(){return Oae},kiZ:function(){return yV},vrE:function(){return d_},OvR:function(){return _a},Nsj:function(){return fm},MLY:function(){return fI},vpZ:function(){return pm},BDP:function(){return dg},deh:function(){return z6},nKc:function(){return pO},Viq:function(){return aO},uTF:function(){return UO},waE:function(){return PO},$3z:function(){return e6},Wph:function(){return LO},pj:function(){return Ane},iHi:function(){return FN},juF:function(){return LN},bNH:function(){return qN},_JP:function(){return UI},yz_:function(){return Qi},bAI:function(){return sv},XzD:function(){return iT},D4r:function(){return i4},t$C:function(){return $p},_8N:function(){return tO},RKk:function(){return zE},hRV:function(){return yw},bP6:function(){return gw},hkV:function(){return Bs},OM_:function(){return XK},fOM:function(){return mw},Rox:function(){return Iu},upU:function(){return Kee},xQG:function(){return cy},mMO:function(){return oA},y3G:function(){return hg},ZDm:function(){return Dw},dR4:function(){return kne},$Rx:function(){return Kk},Vb_:function(){return s_},b5y:function(){return l_},PtY:function(){return xl},Nnc:function(){return KT},ITp:function(){return rn},Gdm:function(){return Wu},w2y:function(){return Au},THQ:function(){return yF},bfo:function(){return Pp},PpF:function(){return jV},Zqx:function(){return TV},Zpn:function(){return MV},RSl:function(){return UV},Gzt:function(){return as},KdS:function(){return WC},$3B:function(){return GC},Yv1:function(){return VT},e6w:function(){return ou},XBb:function(){return Vne},QWZ:function(){return gI},s3e:function(){return Ou},uPt:function(){return Vo},nw1:function(){return yf},X1$:function(){return cf},vRA:function(){return zC},Cbj:function(){return uk},xdz:function(){return dw},lq$:function(){return iu},Dx_:function(){return b9},NHZ:function(){return M9},SuU:function(){return Y8},dP7:function(){return qI},JG4:function(){return Og},Y19:function(){return jm},nl1:function(){return oV},RPo:function(){return Rre},c68:function(){return jne},aQD:function(){return uae},jTu:function(){return Gm},bRw:function(){return mI},AKq:function(){return ru},THe:function(){return HV},kyt:function(){return u2},z4O:function(){return wd},I8v:function(){return rs},vms:function(){return cg},D2Q:function(){return ite},jyU:function(){return P6},Ji0:function(){return W6},_16:function(){return I6},EGQ:function(){return kV},bju:function(){return nA},hms:function(){return JI},I5U:function(){return rA},e7B:function(){return qS},GI0:function(){return Ine},uIW:function(){return zm},E6s:function(){return Ur},bgS:function(){return Om},ZE6:function(){return Ca},OBY:function(){return pA},vus:function(){return Ra},fVw:function(){return vae},AOr:function(){return $6},QBB:function(){return hX},Q4J:function(){return fX},n$r:function(){return ZE},jo8:function(){return Wc},cLE:function(){return u4},SdI:function(){return QI},FfW:function(){return ng},ngh:function(){return rm},IEE:function(){return I4},Wje:function(){return uV},ipL:function(){return zM},mkl:function(){return mM},SJM:function(){return Lm},IJL:function(){return OI},gNO:function(){return hT},uYg:function(){return YK},DHM:function(){return n2},fBW:function(){return AA},Glb:function(){return iee},mdl:function(){return oee},$2A:function(){return uee},ry4:function(){return su},ty_:function(){return N1},XcJ:function(){return ov},X_A:function(){return nte},rMO:function(){return L9},iw5:function(){return Wd},SCt:function(){return W9},TuQ:function(){return aee},r8Q:function(){return hn},M52:function(){return Nee},PHR:function(){return Mg},l7q:function(){return Eee},kER:function(){return wee},oyI:function(){return gee},LSy:function(){return Vg},vJj:function(){return GN},xN1:function(){return AN},p5f:function(){return gN},C7s:function(){return mR},hs4:function(){return IV},$pH:function(){return R6},OlV:function(){return m_},ciS:function(){return Q8},Xy9:function(){return PC},Ukk:function(){return WT},oLG:function(){return Iae},Q8:function(){return mee},Vd7:function(){return oS},wZO:function(){return kI},XYU:function(){return lT},nMX:function(){return f_},UDU:function(){return fR},S6s:function(){return Lk},mLp:function(){return Mk},$jF:function(){return h_},Eiz:function(){return c_},Xe6:function(){return hR},Tnr:function(){return C6},la5:function(){return av},z6i:function(){return d6},RiU:function(){return Ey},CcX:function(){return are},I_9:function(){return zy},oYo:function(){return Pu},wv7:function(){return Jk},l5Z:function(){return nre},mhf:function(){return eA},Z7n:function(){return QS},eUX:function(){return $C},Vqk:function(){return kp},hLk:function(){return sT},_CE:function(){return ls},VzS:function(){return aN},f$J:function(){return Oee},U1Q:function(){return ag},mQS:function(){return gV},KST:function(){return OT},KxW:function(){return ree},Odo:function(){return Bo},P0c:function(){return Zre},mEw:function(){return D6},V8g:function(){return ga},GQK:function(){return eT},RCB:function(){return qee},SyF:function(){return cT},Ry4:function(){return Lee},IcH:function(){return x_},AGH:function(){return Bee},SMW:function(){return Hee},cI7:function(){return $9},gAR:function(){return Fv},Kq2:function(){return qp},zgZ:function(){return Ene},hSW:function(){return dre},Srs:function(){return xA},x5g:function(){return X8},aH0:function(){return Rne},ah$:function(){return wne},C7Q:function(){return rM},Jh_:function(){return Wy},Nwv:function(){return dK},zRi:function(){return Wv},zqY:function(){return jy},LxP:function(){return Xv},feJ:function(){return Ag},VRd:function(){return sR},zhK:function(){return lR},cqU:function(){return _ee},Lu3:function(){return un},ZUi:function(){return jT},T_q:function(){return GT},zi$:function(){return pee},ENK:function(){return rT},rKz:function(){return hV},_Fy:function(){return IT},I0p:function(){return _T},Goo:function(){return RT},pOj:function(){return YS},o80:function(){return ip},ECF:function(){return Mm},$go:function(){return sm},buC:function(){return cp},qNh:function(){return hp},jQ5:function(){return EI},fnp:function(){return Vv},Z5C:function(){return zN},xH3:function(){return Hy},rjm:function(){return Yp},CoF:function(){return By},$aH:function(){return Uy},_AL:function(){return oM},qs4:function(){return yv},wYj:function(){return yR},WhP:function(){return gv},iQ0:function(){return _p},_d$:function(){return Jp},XhF:function(){return wv},qRG:function(){return h3},Pq3:function(){return cR},AdU:function(){return Cg},n1H:function(){return t7},SrO:function(){return kT},uT_:function(){return Do},gfB:function(){return fT},axp:function(){return Mu},vw_:function(){return y_},EMG:function(){return iS},vYR:function(){return iN},Dwm:function(){return FC},x32:function(){return Cte},oZ:function(){return gre},JnB:function(){return dN},OSG:function(){return yT},vmo:function(){return pN},jJ3:function(){return aV},ayx:function(){return mV},aIC:function(){return Zv},hJs:function(){return Tv},QaK:function(){return bV},C68:function(){return rd},mWC:function(){return nM},C12:function(){return tg},qpA:function(){return eg},Edc:function(){return ni},BEd:function(){return _R},dbt:function(){return Ig},MPy:function(){return fV},mC6:function(){return qte},JMv:function(){return Sv},uVG:function(){return Cne},k9D:function(){return fre},nc6:function(){return My},QKf:function(){return kN},nL$:function(){return TN},eTC:function(){return wN},Thf:function(){return EN},oCv:function(){return JE},HzL:function(){return nN},yzJ:function(){return OV},TvB:function(){return MA},uW2:function(){return vS},HCW:function(){return dS},tbe:function(){return fS},fJz:function(){return Cv},XMn:function(){return Gy},A8G:function(){return RN},UE3:function(){return Vee},hjL:function(){return Qee},PuS:function(){return Cu},sMb:function(){return Wp},xhN:function(){return i2},pb4:function(){return v_},b4I:function(){return tee},NgA:function(){return C_},Bkg:function(){return Aee},eSn:function(){return Ru},UJ4:function(){return _ne},Lau:function(){return YT},q_S:function(){return ET},Rbt:function(){return JT},GCO:function(){return w_},Ab2:function(){return Eg},uUo:function(){return Sg},$4z:function(){return Dee},lYP:function(){return VR},rwT:function(){return kg},onc:function(){return Tg},GG9:function(){return vg},GSp:function(){return qT},cuz:function(){return wg},mkm:function(){return vv},Unk:function(){return dv},oFn:function(){return Tw},s2A:function(){return UE},JgN:function(){return BE},p9h:function(){return AT},MUL:function(){return CT},dCY:function(){return wT},mzN:function(){return TI},RSW:function(){return e7},b_9:function(){return O_},Xfg:function(){return A_},fuV:function(){return I_},CpM:function(){return R_},Ju9:function(){return T_},SWG:function(){return Ed},$GL:function(){return zee},Xtk:function(){return oT},YtE:function(){return M_},lep:function(){return Or},qY6:function(){return E_},v4_:function(){return pv},Cyn:function(){return P5},E42:function(){return jp},VtV:function(){return yI},Lii:function(){return xo},mJ9:function(){return N_},gLI:function(){return Ym},LJj:function(){return _u},dOv:function(){return yne},yFL:function(){return aT},iq:function(){return hk},bGC:function(){return Td},KpR:function(){return Z_},h7R:function(){return F_},Od_:function(){return b_},gsJ:function(){return k_},KqY:function(){return OR},WBL:function(){return IR},Avh:function(){return cn},lmm:function(){return Ya},MOM:function(){return lf},mGT:function(){return Nf},DBs:function(){return cS},m9o:function(){return lS},Aj9:function(){return j9},JX8:function(){return Iee},qBP:function(){return Uv},ANU:function(){return See},jBE:function(){return c6},t3y:function(){return nT},WVI:function(){return dR},sz6:function(){return XT},Yom:function(){return BC},W$j:function(){return yee},Uo4:function(){return vee},gxr:function(){return ad},r90:function(){return ca},NPK:function(){return HN},tN4:function(){return hee},deC:function(){return see},p95:function(){return cee},Zaw:function(){return lV},HTE:function(){return LV},YFY:function(){return Xk},kff:function(){return Gd},LoC:function(){return Gee},rDL:function(){return W3},mcV:function(){return J8},Hr1:function(){return n7},qRm:function(){return vR},cE9:function(){return Va},gYd:function(){return Aa},JBg:function(){return Oa},xAK:function(){return nee},MWw:function(){return xv},Mbj:function(){return Dv},h0Q:function(){return $4},V4q:function(){return Pv},smz:function(){return jee},lbI:function(){return K8},Ywm:function(){return Mv},xxt:function(){return ku},zFf:function(){return fp},RUM:function(){return ate},iBL:function(){return GI},wG9:function(){return xee},D_J:function(){return $v},MyS:function(){return Lv},Bym:function(){return bv},mEk:function(){return Bv},g99:function(){return h6},dN9:function(){return Tp},yjE:function(){return G6},VHf:function(){return AI},B0I:function(){return uT},JPx:function(){return uN},lXs:function(){return a7},yTN:function(){return xC},RhN:function(){return wI},nBL:function(){return r7},ClL:function(){return B5},xEL:function(){return lg},Si0:function(){return ste},__h:function(){return CN},uMU:function(){return Ev},h7L:function(){return id},O6n:function(){return kv},B57:function(){return _v},x7e:function(){return KE},qMG:function(){return LC},e88:function(){return DC},lDu:function(){return f8},y02:function(){return Nv},HiW:function(){return B9},U8h:function(){return $i},z3T:function(){return gu},nzm:function(){return af},F$l:function(){return p_},xD6:function(){return Av},EIf:function(){return qk},qEj:function(){return Jee},Xem:function(){return OK},ohz:function(){return Tee},UcG:function(){return H9},RcK:function(){return ZC},EgI:function(){return lm},xKO:function(){return gT},MYK:function(){return Jy},RTy:function(){return XE},JUl:function(){return nF}});var n=r("vsh_26364"),a=r("vsh_13431"),o=r("vsh_67017"),i=r.n(o),u=r("vsh_35067"),s=r("vsh_26278"),l=r("vsh_74561"),c=r("vsh_93035"),h=r("vsh_5159"),f=r("vsh_56589"),d=r("vsh_12064"),v=r("vsh_22462"),p=r("vsh_73455"),m=r("vsh_98652"),g=r("vsh_1139"),y=r("vsh_19264"),_=r("vsh_4175"),R=r("vsh_65498"),C=r("vsh_68250"),w=r("vsh_30187"),E=r("vsh_10717"),k=r("vsh_83519"),T=r("vsh_32459"),S=r("vsh_46016"),A=r("vsh_43369"),I=r("vsh_11144"),O=r("vsh_7207"),V=r("vsh_2184"),N=r("vsh_97504"),b=r("vsh_88157"),M=r("vsh_20253"),F=r("vsh_53164"),Z=r("vsh_11657"),x=r("vsh_89586"),D=r("vsh_4561"),P=r("vsh_48912"),$=r("vsh_3285"),L=r("vsh_65726"),B=r("vsh_77704"),U=r("vsh_98460"),H=r("vsh_58818"),z=r("vsh_26171"),W=r("vsh_30426"),G=r("vsh_86982"),j=r("vsh_75712"),Y=r("vsh_4468"),q=r("vsh_3186"),J=r("vsh_47551"),K=r("vsh_25264"),X=r("vsh_40969"),Q=r("vsh_11967"),ee=r("vsh_97348"),te=r("vsh_65725"),re=r("vsh_70098"),ne=r("vsh_53690"),ae=r("vsh_82898"),oe=r("vsh_59980"),ie=r("vsh_96636"),ue=r("vsh_72429"),se=r("vsh_82108"),le=r("vsh_79170"),ce=r("vsh_13867"),he=r("vsh_88206"),fe=r("vsh_89646"),de=r("vsh_89443"),ve=r("vsh_93301"),pe=r("vsh_97811"),me=r("vsh_22023"),ge=r("vsh_54313"),ye=r("vsh_29033"),_e=r("vsh_14064"),Re=r("vsh_47246"),Ce=r("vsh_24627"),we=r("vsh_84784"),Ee=r("vsh_63738");r.o(Ee,"Formatter")&&r.d(t,{Formatter:function(){return Ee.Formatter}}),r.o(Ee,"createFormatter")&&r.d(t,{createFormatter:function(){return Ee.createFormatter}}),r.o(Ee,"getPreferredFormatter")&&r.d(t,{getPreferredFormatter:function(){return Ee.getPreferredFormatter}}),r.o(Ee,"hasDate")&&r.d(t,{hasDate:function(){return Ee.hasDate}}),r.o(Ee,"isDateTimeFormatter")&&r.d(t,{isDateTimeFormatter:function(){return Ee.isDateTimeFormatter}});var ke,Te,Se,Ae,Ie,Oe,Ve,Ne,be,Me,Fe,Ze,xe,De,Pe,$e,Le,Be,Ue,He,ze,We,Ge,je,Ye,qe,Je,Ke,Xe,Qe,et,tt,rt,nt,at=r("vsh_91777"),ot=r.n(at),it=r("vsh_8746"),ut=(r("vsh_1278"),r("vsh_22392")),st=r("vsh_99520"),lt=r("vsh_47531"),ct=r("vsh_53290"),ht=r("vsh_8282"),ft=r("vsh_64299"),dt=r("vsh_93631"),vt=r("vsh_99073"),pt=r("vsh_22052"),mt=r("vsh_40742"),gt=r("vsh_67295"),yt=r("vsh_79828"),_t=r("vsh_8073"),Rt=r("vsh_55478"),Ct=r("vsh_23414"),wt=r("vsh_8798"),Et=r("vsh_34539"),kt=r.n(Et),Tt=r("vsh_45617"),St=r("vsh_61332"),At=r.n(St),It=r("vsh_82905"),Ot=r("vsh_15722"),Vt=r("vsh_33476"),Nt=r.n(Vt),bt=r("vsh_8865"),Mt=r("vsh_92292"),Ft=r("vsh_7459"),Zt=r("vsh_99820"),xt=r("vsh_75071"),Dt=r("vsh_17494"),Pt=r("vsh_56489"),$t=r("vsh_57181"),Lt=r("vsh_23188"),Bt=r("vsh_38383"),Ut=r("vsh_83784"),Ht=r("vsh_98085"),zt=r("vsh_71561"),Wt=r("vsh_89808"),Gt=r("vsh_61496"),jt=r("vsh_92641"),Yt=r("vsh_75325"),qt=r("vsh_74683"),Jt=r("vsh_26246"),Kt=r("vsh_22810"),Xt=r("vsh_1426"),Qt=(r("vsh_33417"),r("vsh_7121")),er=r("vsh_69691"),tr=r("vsh_91586"),rr=r.n(tr),nr=r("vsh_67013"),ar=r.n(nr),or=r("vsh_73565"),ir=r.n(or),ur=r("vsh_77034"),sr=r.n(ur),lr=r("vsh_99343"),cr=r("vsh_73043"),hr=r("vsh_66988").Buffer,fr=(r("vsh_14224"),["fontInfo","textDecoration"]),dr=["style"],vr=["_pivotExtra"],pr=["creatorId"],mr=["type"],gr=["refCount"];function yr(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return _r(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _r(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return i=e.done,e},e:function(e){u=!0,o=e},f:function(){try{i||null==r.return||r.return()}finally{if(u)throw o}}}}function _r(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Rr(e,t){return e.hasOwnProperty(t)}function Cr(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;return Rr(e,t)&&e[t]!==r}var wr=isNaN,Er="rowCount",kr="colCount";function Tr(e){return e}function Sr(e,t,r,n,a,o,i,u,s,l,c){var h,f,d,v,p,m,g,y,_,R,C,w,E,k,T,S,A=r[Er],I=r[kr],O=t[Er],V=t[kr],N=n[Er],b=n[kr],M=1===I,F=1===V;if(O===A&&V===I){var Z=0,x=0,D=0,P=0;for(g=A*I,h=0;h<A;h++)for(f=0;f<I;f++){if(v=o(r[h][f]),p=o(t[h][f]),e&&(wr(v)||wr(p)))return s;Z+=v,x+=v*v,D+=p=l(p),P+=v*p}var $=g*P-Z*D;for(m=a?$/(g*x-Z*Z):P/x,y=a?(D*x-Z*P)/(g*x-Z*Z):0,_=[],h=0;h<N;h++)for(_[h]=[],f=0;f<b;f++){if(v=o(n[h][f]),e&&wr(v))return s;_[h][f]=0===$?t[0][0]:c(m*v+y)}return i?new i(_):_}if(M&&O===A||1===O&&V===I){for(v=[],p=[],T=I+1,S=I+2,h=0;h<A;h++){if(y=o(C=M?t[h][0]:t[0][h]),e&&wr(y))return s;p[h]=M?l(y):y}for(h=0;h<A;h++)for(v[h]=[],f=0;f<I;f++){if(y=o(r[h][f]),e&&wr(y))return s;v[h][f]=y}var L=[];for(m=0;m<T;m++)for(L[m]=[],g=0;g<S;g++)L[m][g]=0;for(d=0;d<A;d++)for(L[0][T]+=p[d],h=0;h<I;h++)for(C=h+1,L[0][C]+=v[d][h],L[C][0]=L[0][C],L[C][T]+=v[d][h]*p[d],f=h;f<I;f++)L[E=f+1][C]+=v[d][h]*v[d][f],L[C][E]=L[E][C];L[0][0]=A;var B=a?0:1;for(R=B;R<T;R++){if(e){if(0===L[h][h]){for(k=!1,f=h+1;!k&&f<T;f++)if(0!==L[f][h]){for(d=0;d<S;d++)E=L[h][d],L[h][d]=L[f][d],L[f][d]=E;k=!0}if(!k)return u}}else{for(h=R;h<T&&0===L[h][R];)h++;if(h>=T)return u;for(w=B;w<S;w++)C=L[R][w],L[R][w]=L[h][w],L[h][w]=C}for(C=1/L[R][R],w=B;w<S;w++)L[R][w]*=C;for(h=B;h<T;h++)if(h!==R)for(C=-L[h][R],w=0;w<S;w++)L[h][w]+=C*L[R][w];!a&&(L[0][T]=0)}for(_=[],!F&&(_[0]=[]),h=0;h<N;h++){for(F&&(_[h]=[]),C=L[0][T],f=0;f<I;f++){if(y=o(C=F?n[h][f]:n[f][h]),e&&wr(y))return s;C+=L[f+1][T]*y}F?_[h][0]=c(C):_[0][h]=c(C)}return i?new i(_):_}return u}var Ar={},Ir=new Date(1899,11,30);function Or(e){return null==e}Ar._each=function(e,t){if(Ar._isArraylike(e))for(var r=0,n=e.length;r<n&&!1!==t.call(e[r],r,e[r]);r++);else for(var a in e)if(e.hasOwnProperty(a)&&!1===t.call(e[a],a,e[a]))break;return e},Ar._isEmptyObject=function(e){return!e||"object"==(0,R.Z)(e)&&0===Object.keys(e).length},Ar._isFunction=function(e){return"function"===Ar._getType(e)},Ar._isArray=function(e){return Array.isArray?Array.isArray(e):"array"===Ar._getType(e)},Ar._isNumeric=function(e){return!isNaN(parseFloat(e))&&isFinite(e)},Ar._getType=function(e){if(null===e)return"null";var t=Ar._class2type;if(!t){t=Ar._class2type={};for(var r=["Boolean","Number","String","Function","Array","Date","RegExp","Object","Error"],n=0,a=r.length;n<a;n++)t["[object "+r[n]+"]"]=r[n].toLowerCase()}var o=t.toString,i=(0,R.Z)(e);return"object"===i||"function"===i?t[o.call(e)]||"object":i},Ar._inArray=function(e,t,r){var n;if(t){var a=[].indexOf;if(a)return a.call(t,e,r);for(n=t.length,Ar._isNullOrUndefined(r)&&(r=0),r=r<0?Math.max(0,n+r):r;r<n;r++)if(r in t&&t[r]===e)return r}return-1},Ar._merge=function(e,t){var r=t.length,n=e.length,a=0;if("number"==typeof r)for(;a<r;a++)e[n++]=t[a];else for(;void 0!==t[a];)e[n++]=t[a++];return e.length=n,e},Ar._map=function(e,t,r){var n,a=0,o=e.length,i=[];if(Ar._isArraylike(e))for(;a<o;a++)null!==(n=t(e[a],a,r))&&(i[i.length]=n);else for(a in e)e.hasOwnProperty(a)&&(null!==(n=t(e[a],a,r))&&(i[i.length]=n));return[].concat.apply([],i)},Ar._extend=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r,n,a,o,i,u,s=arguments[0]||{},l=1,c=arguments.length,h=!1;for("boolean"==typeof s&&(h=s,s=arguments[1]||{},l=2),"object"==(0,R.Z)(s)||Ar._isFunction(s)||(s={}),c===l&&(s=this,--l);l<c;l++)if(!Ar._isNullOrUndefined(i=arguments[l]))for(o in i)r=s[o],s!==(a=i[o])&&(h&&a&&(Ar._isPlainObject(a)||(n=Ar._isArray(a)))?(n?(n=!1,u=r&&Ar._isArray(r)?r:[]):u=r&&Ar._isPlainObject(r)?r:{},s[o]=Ar._extend(h,u,a)):void 0!==a&&(s[o]=a));return s},Ar._inherit=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},Ar._isWindow=function(e){return null!==e&&e===e.window},Ar._isPlainObject=function(e){if(!e||"object"!==Ar._getType(e)||e.nodeType||Ar._isWindow(e))return!1;var t,r={}.hasOwnProperty;try{if(e.constructor&&!r.call(e,"constructor")&&!r.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return Ce.Ps3.moirae.ravenCatch(e),!1}for(t in e);return void 0===t||r.call(e,t)},Ar._isArraylike=function(e){if(Ar._isNullOrUndefined(e))return!1;var t=e.length,r=Ar._getType(e);return!Ar._isWindow(e)&&(!(1!==e.nodeType||!t)||"array"===r||"function"!==r&&(0===t||"number"==typeof t&&t>0&&t-1 in e))},Ar._makeArray=function(e,t){var r=t||[];return null!==e&&(Ar._isArraylike(Object(e))?Ar._merge(r,"string"==typeof e?[e]:e):[].push.call(r,e)),r},Ar._isType=function(e,t){return Ar._isNullOrUndefined(e)?"null"===t:!!t&&(t instanceof Function&&e instanceof t||(0,R.Z)(e)===t||!("function"!==t||!/^\s*\bfunction\b/.test(""+e))||Object.prototype.toString.call(e).slice(8,-1).toLowerCase()===t.toLowerCase()||("PureTimeSpan"===t?e instanceof Date&&e.getDate()===Ir.getDate():"DateTime"===t||"TimeSpan"===t?e instanceof Date:("string"==typeof t&&"undefined number boolean string".indexOf(t),!1)))},Ar._isNullOrUndefined=Or,Ar._cloneObject=function(e){if(!e)return e;if("number"==typeof e||"string"==typeof e||"boolean"==typeof e||Ar._isNullOrUndefined(e))return e;if(e.clone)return e.clone();if(e instanceof Date)return new Date(e);var t,r,n;for(r in t=e instanceof Object?new e.constructor:new e.constructor(e.valueOf()),e)e.hasOwnProperty(r)&&(n=e[r],e.hasOwnProperty(r)&&t[r]!==n&&(t[r]="object"==(0,R.Z)(n)?Ar._cloneObject(n):n));return t.toString=e.toString,t.valueOf=e.valueOf,t};var Vr="Check_Action_Valid_Fail",Nr=["Formula_Parse_Error",Vr];var br,Mr,Fr=function(){function e(t,r){(0,y.Z)(this,e),this._owner=t,this._cmdDef=r}return(0,_.Z)(e,[{key:"canUndo",value:function(){return!!this._cmdDef.canUndo}},{key:"updateCommandDef",value:function(e){this._cmdDef.canUndo=e.canUndo}},{key:"execute",value:function(e,t,r,n){var a,o=!0,i=!1;try{o=!1!==(i=("execute"in this._cmdDef?this._cmdDef.execute:this._cmdDef)(e,t,1===r,n))}catch(r){console.error("sheet log Command Error: ",r),(a=r)&&-1!==Nr.indexOf(a.message)||(Ce.Ps3.moirae.ravenCatch(r,{tags:{scm:JSON.stringify(window.scm),key:"SHEET_CMD_ERROR"}}),o=!1,Ce.Ps3.moirae.teaLog({key:"client_sheet_command_execute_fail",command:t.cmd,transId:n,err_msg:r&&r.stack?String(r.stack):String(r)}),e.throwError("CommandError",{code:"5007",command:t.cmd}))}return!0!==o||t&&o&&this._owner._commandExecuted({command:t,result:i,_actionType:r,name:this.name}),i}}]),e}(),Zr=function(){function e(t){(0,y.Z)(this,e),this._shortcutKeys={},this.executingType="idle",this._listeners={},this._executed=!1,this._spread=t}return(0,_.Z)(e,[{key:"hasExecuted",value:function(){return this._executed}},{key:"register",value:function(e,t){var r=new Fr(this,t);r.name=e,this[e]=r}},{key:"updateCommandDef",value:function(e,t){this[e]&&this[e].updateCommandDef(t)}},{key:"getCommand",value:function(e){return this[e]}},{key:"setExecutingType",value:function(e){this.executingType=e}},{key:"clearExecutingType",value:function(){this.executingType="idle"}},{key:"getExecutingType",value:function(){return this.executingType}},{key:"execute",value:function(e,t){this._executed=!0;var r=this[e.cmd];if(t=t||Ce.Hg0.genStepTid(),!r)return Ce.Ps3.browser.isMobile&&(console.error("[SHEET LOG] ".concat(e.cmd," is not registered")),Ce.Ps3.collectSuiteEvent("sheet_opration",{error_command_name:e.cmd})),!1;var n=this._spread.hookManager(),a="".concat(Ce.Jfb,"_").concat(e.cmd);if(n&&!n.executeBeforeHooks(a,e))return!0;var o=r.execute(this._spread,e,0,t);return o?n&&n.onExecuteSuccess(a,e):n&&n.onExecuteFail(a,e),null!=n&&n.executeAfterHooks(a,e),o}},{key:"addListener",value:function(e,t){this._listeners[e]=t}},{key:"removeListener",value:function(e){delete this._listeners[e]}},{key:"_commandExecuted",value:function(e){var t=this._listeners;for(var r in t)t.hasOwnProperty(r)&&t[r](e)}}]),e}(),xr=function(){function e(t){(0,y.Z)(this,e),this._id=t}return(0,_.Z)(e,[{key:"id",value:function(){return this._id}}]),e}(),Dr=function(){function e(){(0,y.Z)(this,e),this.undoStack=[],this.redoStack=[]}return(0,_.Z)(e,[{key:"do",value:function(e){this.undoStack.push(e),this.redoStack=[]}},{key:"undo",value:function(){var e=this.undoStack.pop();if(e)return this.redoStack.push(e),e}},{key:"redo",value:function(){var e=this.redoStack.pop();if(e)return this.undoStack.push(e),e}},{key:"canUndo",value:function(){return!!this.undoStack.length}},{key:"canRedo",value:function(){return!!this.redoStack.length}},{key:"reset",value:function(){this.redoStack=[],this.undoStack=[]}},{key:"clearById",value:function(e){this.redoStack=this._clearById(e,this.redoStack),this.undoStack=this._clearById(e,this.undoStack)}},{key:"_clearById",value:function(e,t){return t.filter((function(t){return 1!==t.length||t[0].id()!==e}))}}]),e}(),Pr=function(){function e(){(0,y.Z)(this,e),this.blocks=new Map,this._request=new Array,this._doSetTimeoutGap=0,this._canUndoPre=!1,this.stack=new Dr}return(0,_.Z)(e,[{key:"register",value:function(e){this.blocks.set(e.blockId,e)}},{key:"remove",value:function(e){var t=e.blockId;this.blocks.delete(t),this.stack.clearById(t)}},{key:"clear",value:function(){this.blocks.clear(),this.stack.reset()}},{key:"undo",value:function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=this.stack.undo();a&&[].concat(a).reverse().forEach((function(t){var n=t.id();if(e.blocks.has(n)){var a=e.blocks.get(n);a&&a.onUndo.apply(a,r)}}))}},{key:"redo",value:function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=this.stack.redo();a&&a.forEach((function(t){var n=t.id();if(e.blocks.has(n)){var a=e.blocks.get(n);a&&a.onRedo.apply(a,r)}}))}},{key:"do",value:function(e){var t=this;"string"==typeof e&&(e=new xr(e)),this.blocks.forEach((function(t){t.onDo(e)})),this._request.push(e),this._canUndoPre=!0,window.clearTimeout(this._doSetTimeoutId),this._doSetTimeoutId=window.setTimeout((function(){t.stack.do(t._request),t._request=[],t._canUndoPre=!1}),this._doSetTimeoutGap)}},{key:"_getStackUndoState",value:function(){return this._canUndoPre||this.stack.canUndo()}},{key:"canUndo",value:function(e){if(!e)return this._getStackUndoState();var t=this.blocks.get(e);return t&&t.canUndo?t.canUndo():this._getStackUndoState()}},{key:"canRedo",value:function(e){if(!e)return this.stack.canRedo();var t=this.blocks.get(e);return t&&t.canRedo?t.canRedo():this.stack.canRedo()}},{key:"clearHistory",value:function(){this.stack.reset()}}],[{key:"init",value:function(){return new e}}]),e}(),$r="SHEET",Lr=function(){function e(t,r,n,a){(0,y.Z)(this,e),this._spread=t,this._allowUndo=n,this._undoDispatcher=a,this._undoStack=[],this._redoStack=[],this.blockId=$r,r<0&&(r=2147483647),this._maxLength=r,this._undoDispatcher&&this._undoDispatcher.register(this)}return(0,_.Z)(e,[{key:"register",value:function(e){e.register(this),this._undoDispatcher=e}},{key:"_addCommand",value:function(e,t){e&&0===t&&this.do(e)}},{key:"_execCommand",value:function(e,t){var r=!0;try{var n=this._spread.commandManager()[e.cmd];if(n){var a=Ce.Hg0.genStepTid();r=n.execute(this._spread,e,t,a)}}catch(e){Ce.Ps3.moirae.ravenCatch(e),r=!1}return r}},{key:"do",value:function(e){if(!0!==e.dontAddToCommandStack){var t=this._maxLength,r=this._undoStack.length;if(t>0&&r>=t)for(var n=0;n<r-t+1;n++)this._undoStack.shift();this._undoStack.push(e),this._undoDispatcher&&this._undoDispatcher.do(new xr($r))}}},{key:"canUndo",value:function(){return this._undoStack.length>0}},{key:"undo",value:function(){return this._undoDispatcher&&this._undoDispatcher.undo(),!0}},{key:"canRedo",value:function(){return this._redoStack.length>0}},{key:"redo",value:function(){return this._undoDispatcher&&this._undoDispatcher.redo(),!0}},{key:"clear",value:function(){this._undoStack=[],this._redoStack=[]}},{key:"dispose",value:function(){this.clear()}},{key:"getUndoStack",value:function(){return console.warn("sheet log getUndoStack is exec slowly, try to use function getUndoStackTop instead"),(0,Re.default)(this._undoStack)}},{key:"getUndoStackTop",value:function(){return this.getStackTop(this._undoStack)}},{key:"getRedoStack",value:function(){return console.warn("sheet log getRedoStack is exec slowly, try to use function getRedoStackTop instead"),(0,Re.default)(this._redoStack)}},{key:"getRedoStackTop",value:function(){return this.getStackTop(this._redoStack)}},{key:"getStackTop",value:function(e){if(!e.length)return null;var t=e[e.length-1];return t?{cmd:t.cmd,sheetId:t.sheetId}:null}},{key:"onDo",value:function(){return this._redoStack=[],!0}},{key:"onUndo",value:function(){if(!this._allowUndo||!this.canUndo())return!0;var e=this._undoStack,t=e[e.length-1],r=this._execCommand(t,1);return!1!==r&&(e.pop(),this._redoStack.push(t)),r}},{key:"onRedo",value:function(){var e=this._redoStack;if(!this._allowUndo||!this.canRedo())return!0;var t=e[e.length-1],r=this._execCommand(t,2);return!1!==r&&(this._undoStack.push(t),e.pop()),r}}]),e}(),Br=(Mr={_getReg:function(e){var t=Mr._regDict[e];return t||(t=Mr._regDict[e]=new RegExp(e,"g")),t.lastIndex=0,t},_getRegIgnoreCase:function(e){var t=Mr._regDictIgnoreCase[e];return t||(t=Mr._regDictIgnoreCase[e]=new RegExp(e,"gi")),t.lastIndex=0,t},_regDict:{},_regDictIgnoreCase:{}},Mr);!function(e){e["&"]="&amp;",e["<"]="&lt;",e[">"]="&gt;",e['"']="&quot;",e["'"]="&#x27;",e["`"]="&#x60;"}(br||(br={}));var Ur={_trimStart:function(e,t){if(!t)return e;for(var r=e;r.substr(0,t.length)===t;)r=r.substr(t.length);return r},_trimEnd:function(e,t){if(!t)return e;for(var r=e;r.substr(r.length-t.length,t.length)===t;)r=r.substr(0,r.length-t.length);return r},_startsWith:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Hr(e,t,r,(function(e,t){return e.slice(0,t.length)===t}))},_endsWith:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Hr(e,t,r,(function(e,t){return e.slice(-t.length)===t}))},_padZero:function(e,t,r){for(var n=e.toString(),a=n.length;a<t;a++)n=r?"0"+n:n+"0";return n},_padZeroLeft:function(e,t){return Ur._padZero(e,t,!0)},_padZeroRight:function(e,t){return Ur._padZero(e,t,!1)},_escapeHtml:function(e){var t=Br._getReg("(?:&|<|>|\"|'|`)");return t.test(e)?e.replace(t,(function(e){return br[e]})):e},_unescapeHtml:function(e){var t=Br._getReg("(?:&amp;|&lt;|&gt;|&quot;|&#x27;|&#x60;)");return t.test(e)?e.replace(t,(function(e){return br[e]})):e}};function Hr(e,t,r,n){if(void 0===t)throw new Error;return""===t||!(t.length>e.length)&&n(r?e.toLowerCase():e,r?t.toLowerCase():t)}var zr,Wr=/^-?(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i;function Gr(e,t){return 5===e[t]?void 0!==e[t+1]||1&e[t-1]:e[t]>5}!function(e){e[e.ROUND_DOWN=0]="ROUND_DOWN",e[e.ROUND_HALF_UP=1]="ROUND_HALF_UP",e[e.ROUND_HALF_EVEN=2]="ROUND_HALF_EVEN",e[e.ROUND_UP=3]="ROUND_UP"}(zr||(zr={}));var jr=function(){function e(t){(0,y.Z)(this,e),this.parse(this,String(t))}return(0,_.Z)(e,[{key:"parse",value:function(e,t){if(!Wr.test(t))throw Error("invalid number");e.signNum="-"===t.charAt(0)?(t=t.slice(1),-1):1;var r=t.indexOf(".");r>-1&&(t=t.replace(".",""));var n=t.search(/e/i);n>0?(r<0&&(r=n),r+=Number(t.slice(n+1)),t=t.substring(0,n)):r<0&&(r=t.length);for(var a=t.length,o=0;o<a&&"0"===t.charAt(o);)o++;if(o===a)e.numberArr=[e.exponent=0];else{for(;a>0&&"0"===t.charAt(--a););e.exponent=r-o-1,e.numberArr=[];for(var i=0,u=o;u<=a;i++,u++)e.numberArr[i]=Number(t.charAt(u))}return e}},{key:"round",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.RM,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=t.numberArr;if(0!==n&&1!==n&&2!==n&&3!==n)throw Error("Invalid rounding mode");if(r<1)return a=3===n&&(a||!!o[0])||0===r&&(1===n&&o[0]>=5||2===n&&(o[0]>5||5===o[0]&&(a||void 0!==o[1]))),o.length=1,a?(t.exponent=t.exponent-r+1,o[0]=1):o[0]=t.exponent=0,t;if(r<o.length){if((1===n&&o[r]>=5||2===n&&(a||Gr(o,r))||3===n&&(a||o[0]))&&(a=!0),o.length=r,a)for(;++o[--r]>9;)if(o[r]=0,0===r){++t.exponent,o.unshift(1);break}for(var i=o.length;!o[--i];)o.pop()}return t}},{key:"toPrecision",value:function(t,r){if(void 0!==t){if(t!==~~t||t<1||t>1e6)throw Error("invalid digit");for(this.round(this,t,r);this.numberArr.length<t;)this.numberArr.push(0)}return this.stringify(this,t<=this.exponent||this.exponent<=e.NE||this.exponent>=e.PE,!!this.numberArr[0])}},{key:"stringify",value:function(e,t,r){var n=e.numberArr.join(""),a=e.exponent,o=n.length;if(t)n=n.charAt(0)+(o>1?"."+n.slice(1):"")+(a<0?"e":"e+")+a;else if(a<0){for(;++a;)n="0"+n;n="0."+n}else if(a>0)if(++a>o)for(a-=o;a--;)n+="0";else a<o&&(n=n.slice(0,a)+"."+n.slice(a));else o>1&&(n=n.charAt(0)+"."+n.slice(1));return e.signNum<0&&r?"-"+n:n}}]),e}();jr.NE=-7,jr.PE=21,jr.DP=20,jr.RM=1;var Yr=Ur._padZeroLeft,qr=null,Jr=parseInt,Kr=parseFloat,Xr=Math.floor,Qr=Math.abs;function en(e,t,r){return e.substr(t,r)}var tn={numberNegativePattern:1,negativeSign:"-",positiveSign:"+",percentSymbol:"%"},rn=function(){function e(e,t,r){var n=t.negativeSign,a=t.positiveSign,o=Ur;if(4!==r&&2!==r||(n=" "+n,a=" "+a),4===r||3===r){if(o._endsWith(e,n))return["-",en(e,0,e.length-n.length)];if(o._endsWith(e,a))return["+",en(e,0,e.length-a.length)]}else if(2===r||1===r){if(o._startsWith(e,n))return["-",en(e,n.length)];if(o._startsWith(e,a))return["+",en(e,a.length)]}else{if(0!==r)throw new Error("");if(o._startsWith(e,"(")&&o._endsWith(e,")"))return["-",en(e,1,e.length-2)]}return["",e]}return{_parseLocale:function(t){return function(t){if((t=Or(t)?"":Ur._trimEnd(t,"")).match(/^[+-]?infinity$/i))return Kr(t);if(t.match(/^0x[a-f0-9]+$/i))return Jr(t,10);var r,n,a=tn,o=a.numberNegativePattern,i=e(t,a,o),u=i[0],s=i[1];""===u&&1!==o&&(u=(i=e(t,a,1))[0],s=i[1]),""===u&&(u="+");var l,c,h=s.indexOf("e");h<0&&(h=s.indexOf("E")),h<0?(n=s,r=qr):(n=en(s,0,h),r=en(s,h+1));var f=n.indexOf(".");f<0?(l=n,c=qr):(l=en(n,0,f),c=en(n,f+1)),l=l.split(",").join("");var d=",".replace(/\u00A0/g," ");","!==d&&(l=l.split(d).join(""));var v=u+l;if(c!==qr&&(v+="."+c),v[v.length-1]===a.percentSymbol){v=en(v,0,v.length-1);var p=(v=Ur._trimEnd(v,"")).indexOf(".");-1===p&&(p=v.length);var m="";m+=en(v,0,p-2),m+=".",m+=en(v,p-2,2),v=m+=en(v,p+1)}if(r!==qr){var g=e(r,a,1);""===g[0]&&(g[0]="+"),v+="e"+g[0]+g[1]}return v.match(/^[+-]?\d*\.?\d*(e[+-]?\d+)?$/)?Kr(v):NaN}(t)},_parseFloat:function(e){return rn._toPrecision(Kr(e),15)},_toHexString:function(e,t,r){if(0!==Qr(Xr(e)-e))throw new Error("Bad Format Specifier");var n=e>=0?e.toString(16):(4294967295+e+1).toString(16);return n=t?n.toLowerCase():n.toUpperCase(),!Or(r)&&n.length<r?Yr(n,r):n},_toPrecision:function(e,t){return"number"!=typeof e&&(e=Number(e)),isNaN(e)||e===1/0||e===-1/0?e:Kr(new jr(e).toPrecision(t))}}}();Ar._isNumber=function(e){return Ar._isType(e,"number")||Ar._isType(e,"DateTime")||Ar._isType(e,"TimeSpan")||e&&!Ar._isType(e,"boolean")&&!isNaN(e)&&!isNaN(parseFloat(e))&&!(e.length>=2&&"0"===e[0]&&"x"===e[1])},Ar._toDouble=function(e){return Ar._isNullOrUndefined(e)||""===e?0:Ar._isType(e,"number")?e:Ar._isType(e,"string")&&!isNaN(e)?rn._parseLocale(e):Ar._isType(e,"boolean")?e?1:0:parseFloat(e)};var nn=rn._toHexString,an=parseInt,on=function(){var e=function(){};return e._toString=function(e){var t=e.a,r=e.r,n=e.g,a=e.b;return 3===arguments.length&&(t=255,r=arguments[0],n=arguments[1],a=arguments[2]),4===arguments.length&&(t=arguments[0],r=arguments[1],n=arguments[2],a=arguments[3]),255===t?"#"+nn(r,!0,2)+nn(n,!0,2)+nn(a,!0,2):"rgba("+r+","+n+","+a+","+t+")"},e._fromString=function(t){var r=ln().cssColorNames[t];if(r){var n=(0,g.Z)(r,3);return{a:255,r:n[0],g:n[1],b:n[2]}}var a=document.createElement("div");function o(t){var r=e._ctx;return r?(r.fillStyle=t,t=r.fillStyle):(a.style.backgroundColor=t,a.style.backgroundColor)}if(t instanceof e)return t;var i=0,u=0,s=0,l=0;if(t&&""!==t){var c=function(e){var t=function(e){return e.indexOf("%")>0?2.55*parseFloat(e):0|e},r=o(e),n=RegExp;if(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.test(r))return[n.$1,n.$2,n.$3].map((function(e){return an(e,16)}));if(/^rgba\(([\s\d]*),([\s\d]*),([\s\d]*),([\s\d]*)\)$/i.test(r)){var a=[n.$1,n.$2,n.$3].map(t);return a.splice(0,0,255*parseFloat(n.$4)),a}return/^rgb\(([\s\d]*),([\s\d]*),([\s\d]*)\)$/i.test(r)?[n.$1,n.$2,n.$3].map(t):/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(r)?[n.$1,n.$2,n.$3].map((function(e){return an(e+e,16)})):null}(t);c&&(3===c.length?(i=255,u=c[0],s=c[1],l=c[2]):4===c.length&&(i=c[0],u=c[1],s=c[2],l=c[3]))}return{a:i,r:u,g:s,b:l}},e}();function un(e){return ln().cssColorNamesToHex[e]||e}var sn=null;function ln(){if(sn)return sn;var e={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},t=Object.entries(e).reduce((function(e,t){var r=(0,g.Z)(t,2),n=r[0],a=r[1];return e[n]=on._toString.apply(on,(0,m.Z)(a)),e}),{});return sn={cssColorNamesToHex:t,cssColorNames:e}}function cn(e){return"number"==typeof e&&e>=we.SheetDate.MIN_DATE_VALUE&&e<=we.SheetDate.MAX_DATE_VALUE}function hn(e,t){var r=new Date(e);return r.getHours()>0||r.getMinutes()>0||r.getSeconds()>0||!!t&&(0,Ee.hasTime)(t)}var fn=function(){function e(t){(0,y.Z)(this,e),this.hooks=new Map,this._spread=t}return(0,_.Z)(e,[{key:"executeBeforeHooks",value:function(e,t){var r=this.getHooks(e);if(r){var n,a=yr(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(o.beforeExecute&&!o.beforeExecute(this._spread,t))return o.beforeExecuteFailCallback&&o.beforeExecuteFailCallback(this._spread,t),!1}}catch(e){a.e(e)}finally{a.f()}}return!0}},{key:"executeAfterHooks",value:function(e,t){this.executeHooks(e,t,"afterExecute")}},{key:"onExecuteSuccess",value:function(e,t){this.executeHooks(e,t,"onExecuteSuccess")}},{key:"onExecuteFail",value:function(e,t){this.executeHooks(e,t,"onExecuteFail")}},{key:"setHook",value:function(e,t){var r=this.getHooks(e);r?(r.push(t),this.hooks.set(e,r)):this.hooks.set(e,[t])}},{key:"setHooks",value:function(e,t){var r=this.getHooks(e);if(r){var n=r.concat(t);this.hooks.set(e,n)}else this.hooks.set(e,t)}},{key:"removeHook",value:function(e,t){var r=this.getHooks(e);if(r){var n=r.indexOf(t);n>=0&&(r.splice(n,1),this.hooks.set(e,r))}}},{key:"getHooks",value:function(e){return this.hooks.get(e)}},{key:"executeHooks",value:function(e,t,r){var n=this.getHooks(e);if(n){var a,o=yr(n);try{for(o.s();!(a=o.n()).done;){var i=a.value[r];i&&i(this._spread,t)}}catch(e){o.e(e)}finally{o.f()}}}}]),e}(),dn={_Types:Ar,_RegexHelper:Br,_ColorHelper:on,_StringHelper:Ur,_NumberHelper:rn,_hasOwnProperty:Rr,_isInstanceOf:function(e,t){return e instanceof t},_trend:function(e,t,r,n,a,o,i,u){return Sr(!0,e,t,r,n,a,o,u,i,Tr,Tr)},_growth:function(e,t,r,n,a,o,i){var u,s;for(u=0;u<e[Er];u++)for(s=0;s<e[kr];s++)if(e[u][s]<=0)return o;return Sr(!1,e,t,r,n,Tr,a,i,null,Math.log,Math.exp)}},vn=void 0,pn=null,mn=parseFloat,gn=document,yn="_nonamespace",_n="events",Rn="get",Cn="set",wn="width",En="height",kn="left",Tn="right",Sn="top",An="bottom",In="hidden",On="block",Vn="none",Nn="position",bn="visibility",Mn="display",Fn={tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},Zn={tabIndex:{get:function(e){var t=e.getAttributeNode("tabindex"),r=e.nodeName;return t&&t.specified?parseInt(t.value,10):/^(?:input|select|textarea|button|object)$/i.test(r)||/^(?:a|area)$/i.test(r)&&e.href?0:vn}}},xn={option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,r,n=e.options,a=e.selectedIndex,o="select-one"===e.type||a<0,i=o?pn:[],u=o?a+1:n.length,s=o?a:0;for(a<0&&(s=u);s<u;s++)if(((r=n[s]).selected||s===a)&&!r.disabled&&(!r.parentNode.disabled||!Gn(r.parentNode,"optgroup"))){if(t=Un(r).val(),o)return t;i.push(t)}return i},set:function(e,t){var r=Un.makeArray(t);return Un(e).find("option").getAll().forEach((function(e){e.selected=Un.inArray(Un(e).val(),r)>=0})),r.length||(e.selectedIndex=-1),r}}},Dn={},Pn="GC$"+(""+Math.random()).replace(/\D/g,""),$n=1,Ln={};function Bn(e,t){var r;Array.call(this),"string"==typeof e?r=(t||gn).querySelectorAll(e):e&&(r=e instanceof Array||"undefined"!=typeof HTMLCollection&&e instanceof HTMLCollection?e:[e]);for(var n=0;r&&n<r.length;n++)this.push(r[n])}[En,wn].forEach((function(e){Ln[e]={get:function(t){var r=getComputedStyle(t),n=t.style,a=n[Nn],o=n[bn],i=n[Mn],u=0===t.offsetWidth&&/^(none|table(?!-c[ea]).+)/.test(r[Mn]);u&&(n[Nn]="absolute",n[bn]=In,n[Mn]=On);var s=r&&r[e];if(u&&(n[Nn]=a,n[bn]=o,n[Mn]=i),""===s){for(var l=t.parentElement,c=gn.body;l&&l!==c;)l=l.parentElement;l!==c&&(s=n[e])}return s}}}));var Un=function(e,t){return new Bn(e,t)},Hn={get:function(e){return this[e]},getAll:function(){return this},bind:function(e,t,r){return ta(r)&&(r=t,t=vn),this.forEach((function(n){var a=Kn(n,_n,vn,!0);a||Kn(n,_n,a={},!0);var o=e.split("."),i=o[0],u=o[1]||yn,s=a[u];s||(s=a[u]={});var l=function(e){ta(t)||(e.data=t);var a=r.apply(n,arguments);e.result=a,!1===a&&(e.preventDefault?e.preventDefault():(e.cancelBubble=!1,e.returnValue=!1))};l.original=r;var c=s[i];c||(c=s[i]=[]),c.push(l),n.addEventListener(i,l)})),this},unbind:function(e,t){return this.forEach((function(r){var n,a,o,i=e.split("."),u=i[0],s=i[1]||yn,l=Kn(r,_n,vn,!0),c=l&&l[s];if(t){if(c&&u&&(n=c[u]))for(a=0,o=n.length;a<o;a++)if(n[a].original===t){ua(r,u,n[a]),n.splice(a,1);break}}else if(c)if(u){if(n=c[u])for(a=0,o=n.length;a<o;a++)ua(r,u,n[a]);c[u]=vn}else{for(var h in c)if(Rr(c,h)&&(n=c[h]))for(a=0,o=n.length;a<o;a++)ua(r,h,n[a]);l[s]=vn}})),this},trigger:function(e,t){for(var r=this,n=0,a=r.length;n<a;n++){var o=r[n],i=Kn(o,_n,vn,!0);if(i){var u=e.split(".")[0];for(var s in i)if(Rr(i,s)){var l=i[s],c=l&&l[u];if(c)for(var h=0,f=(c=c.concat()).length;h<f;h++)c[h].apply(o,[{type:u},t])}}}return r},css:function(e,t){var r=this,n=r,a=arguments.length;function o(e,t){n.forEach((function(r){r.style[e]=jn(e,t)}))}if(1===a){if(!ea(e)){var i=r[0],u=Ln[e];if(u&&Rn in u)return u.get(i);var s=getComputedStyle(i);return s&&s[e]}n.forEach((function(t){for(var r in e)Rr(e,r)&&(t.style[r]=jn(r,e[r]))}))}else 2===a&&(Array.isArray(e)&&Array.isArray(t)&&e.length===t.length?e.forEach((function(e,r){o(e,t[r])})):o(e,t));return r},width:ra(!0),height:ra(),innerWidth:na(!0),innerHeight:na(),outerWidth:aa(!0),outerHeight:aa(),append:function(e){var t=[e];e instanceof Un&&(t=e.getAll());var r=this[0];return t.forEach((function(e){e&&r.appendChild(e)})),this},appendTo:function(e){var t=e;e instanceof Un&&(t=e[0]);return this.forEach((function(e){t.appendChild(e)})),this},prepend:function(e){var t=this[0];return t.insertBefore(e,t.firstChild),this},insertBefore:function(e){var t=e.parentElement;return this.forEach((function(r){t.insertBefore(r,e)})),this},addClass:function(e){var t,r,n,a,o,i=0,u=this.length,s=/[\t\r\n]/g;for(t=(e||"").match(/\S+/g)||[];i<u;i++)if(n=1===(r=this[i]).nodeType&&(r.className?(" "+r.className+" ").replace(s," "):" ")){for(o=0;a=t[o++];)n.indexOf(" "+a+" ")<0&&(n+=a+" ");r.className=Un.trim(n)}return this},removeClass:function(e){var t,r,n,a,o,i=0,u=this.length,s=/[\t\r\n]/g;for(t=(e||"").match(/\S+/g)||[];i<u;i++)if(n=1===(r=this[i]).nodeType&&(r.className?(" "+r.className+" ").replace(s," "):"")){for(o=0;a=t[o++];)for(;n.indexOf(" "+a+" ")>=0;)n=n.replace(" "+a+" "," ");r.className=e?Un.trim(n):""}return this},hasClass:function(e){var t=0,r=this.length,n=/[\t\r\n]/g;for(e=" "+e+" ";t<r;t++){var a=this[t];if(1===a.nodeType&&(" "+a.className+" ").replace(n," ").indexOf(e)>=0)return!0}return!1},toggle:function(){var e=this;return e[0].style[Mn]===Vn?e.show():e.hide(),e},show:oa(!0),hide:oa(),attr:function(e,t){var r=this,n=r,a=arguments.length;if(1===a){if(!ea(e))return r[0].getAttribute(e);n.forEach((function(t){for(var r in e)Rr(e,r)&&t.setAttribute(r,e[r])}))}else 2===a&&n.forEach((function(r){r.setAttribute(e,t)}));return r},removeAttr:function(e){return this.forEach((function(t){t.removeAttribute(e)})),this},prop:function(e,t){var r=this,n=r,a=arguments.length;if(1===a){if(!ea(e))return Yn(r[0],e);n.forEach((function(t){for(var r in e)Rr(e,r)&&Yn(t,r,e[r])}))}else 2===a&&n.forEach((function(r){Yn(r,e,t)}));return r},removeProp:function(e){e=Fn[e]||e;return this.forEach((function(t){try{t[e]=vn,delete t[e]}catch(e){Ce.Ps3.moirae.ravenCatch(e)}})),this},text:function(e){var t=this,r=t;return 0===arguments.length?t[0].textContent:(r.forEach((function(t){t.textContent=e})),t)},val:function(e){var t,r=this;if(!arguments.length){var n,a=r[0];return a?(t=xn[a.type]||xn[a.nodeName.toLowerCase()])&&Rn in t&&!ta(n=t.get(a,"value"))?n:Qn(n=a.value)?n.replace(/\r/g,""):n===pn||n===vn?"":n:void 0}var o=Un.isFunction(e);return r.forEach((function(r,n){var a;1===r.nodeType&&((a=o?e.call(r,n,Un(r).val()):e)===pn||a===vn?a="":"number"==typeof a?a+="":Un.isArray(a)&&(a=Un.map(a,(function(e){return e===pn||e===vn?"":e+""}))),(t=xn[r.type]||xn[r.nodeName.toLowerCase()])&&Cn in t&&!ta(t.set(r,a,"value"))||(r.value=a))})),r},position:function(){var e=this[0];if(e){var t,r={top:0,left:0};if("fixed"===Un(e).css(Nn))t=e.getBoundingClientRect();else{var n=this.offsetParent();t=this.offset();var a=n[0];Gn(a,"html")||((r=n.offset()).left-=a.scrollLeft,r.top-=a.scrollTop),r.top+=mn(Un(a).css("borderTopWidth")),r.left+=mn(Un(a).css("borderLeftWidth"))}return{top:t.top-r.top-mn(Un(e).css("marginTop")),left:t.left-r.left-mn(Un(e).css("marginLeft"))}}},offsetParent:function(){var e=Un.map(this,(function(e){for(var t=gn.documentElement,r=e.offsetParent||t;r&&!Gn(r,"html")&&"static"===Un(r).css(Nn);)r=r.offsetParent;return r||t}));return Un(e)},offset:function(){var e,t,r={top:0,left:0},n=this[0],a=n&&n.ownerDocument;if(a)return e=a.documentElement,ta(n.getBoundingClientRect)||(r=n.getBoundingClientRect()),t=Wn(a),{top:r.top+(t.pageYOffset||e.scrollTop)-(e.clientTop||0),left:r.left+(t.pageXOffset||e.scrollLeft)-(e.clientLeft||0)}},scrollLeft:ia(!0),scrollTop:ia(),html:function(e){var t=this,r=t;return 0===arguments.length?t[0].innerHTML:(r.forEach((function(t){t.innerHTML=ot().sanitize(e)})),t)},remove:function(){this.forEach((function(e){var t=e.parentElement;t&&(t.removeChild(e),Xn([e]))}))},empty:function(){return this.forEach((function(e){Un(e.children).remove()})),this},find:function(e){var t=[];return Qn(e)&&this.forEach((function(r){var n=r.querySelectorAll(e);Un.merge(t,n)})),Un(t)},parent:function(){var e=[];return this.forEach((function(t){var r=t.parentElement;r&&e.push(r)})),Un(e)},index:function(e){var t=this[0];return e?Qn(e)?Un.inArray(t,Un(e).getAll()):Un.inArray(e,this):t&&t.parentElement?Un.inArray(t,t.parentElement.children):-1},focus:function(){var e=this[0];return e!==gn.activeElement&&e.focus&&e.focus(),this},isVisible:function(){var e=0;return this.forEach((function(t){var r=getComputedStyle(t);r[bn]!==In&&r[Mn]!==Vn&&e++})),e>0},data:function(e,t){var r=this,n=ta(t);return n&&(r=void 0),Un.each(this,(function(a,o){var i=Kn(o,e,t);if(n)return r=i,!1})),r},removeData:function(e){return Un.each(this,(function(t,r){!function(e,t,r){if(qn(e)){var n,a,o,i=function(e){var t;for(t in e)if(("data"!==t||!Un.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0},u=e.nodeType,s=u?Dn:e,l=u?e[Pn]:Pn;if(s[l]){if(t&&(o=r?s[l]:s[l].data)){for((n=0,a=(t=Un.isArray(t)?t.concat(Un.map(t,Jn)):t in o||(t=Jn(t))in o?[t]:t.split(" ")).length);n<a;n++)delete o[t[n]];if(!(r?i:Un.isEmptyObject)(o))return}(r||(delete s[l].data,i(s[l])))&&(u?Xn([e],!0):s!==s.window?delete s[l]:s[l]=pn)}}}(r,e)})),this}},zn=Bn.prototype=[];function Wn(e){return Un.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}function Gn(e,t){var r=e.nodeName;return r&&r.toLowerCase()===t.toLowerCase()}function jn(e,t){return"top left right bottom width height border-radius border-width border-left-width border-right-width border-top-width border-bottom-width line-height padding padding-left padding-right padding-top padding-bottom margin margin-left margin-right margin-top margin-bottom".split(" ").indexOf(e)>=0&&isFinite(t)?("width height".split(" ").indexOf(e)>=0&&t<0&&(t=0),t+"px"):t}function Yn(e,t,r){var n,a,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return 1!==o&&(a=Zn[t=Fn[t]||t]),ta(r)?a&&Rn in a&&(n=a.get(e,t))!==pn?n:e[t]:a&&Cn in a&&!ta(n=a.set(e,r,t))?n:e[t]=r}function qn(e){var t=e.nodeType;if(t&&1!==t&&9!==t)return!1;var r=e.nodeName,n=r&&{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0}[r.toLowerCase()];return!n||!0!==n&&e.getAttribute("classid")===n}function Jn(e){return e.replace(/^-ms-/,"ms-").replace(/-([\da-z])/gi,(function(e,t){return t.toUpperCase()}))}function Kn(e,t,r,n){if(qn(e)){var a,o,i=Pn,u=Qn(t),s=e.nodeType,l=s?Dn:e,c=s?e[i]:e[i]&&i;if(c&&l[c]&&(n||l[c].data)||!u||!ta(r))return c||(s?e[i]=c=$n++:c=i),l[c]||(l[c]={},s||(l[c].toJSON=function(){})),(ea(t)||"function"==typeof t)&&(n?l[c]=Un.extend(l[c],t):l[c].data=Un.extend(l[c].data,t)),a=l[c],n||(a=a.data||(a.data={})),ta(r)||(a[Jn(t)]=r),u?(o=a[t])!==pn&&o!==vn||(o=a[Jn(t)]):o=a,o}}function Xn(e,t){for(var r,n,a,o=0,i=Pn,u=Dn;(r=e[o])!==pn&&void 0!==r;o++)if((t||qn(r))&&(a=(n=r[i])&&u[n])){var s=a.events;if(s)for(var l in s)if(Rr(s,l)){var c=s[l];if(c)for(var h in c)if(Rr(c,h)){var f=c[h];if(f)for(var d=0,v=f.length;d<v;d++)ua(r,l,f[d])}}u[n]&&(delete u[n],delete r[i])}}function Qn(e){return"string"==typeof e}function ea(e){return"object"==(0,R.Z)(e)}function ta(e){return(0,R.Z)(e)==(0,R.Z)(vn)}function ra(e){var t=e;return function(e){var r,n=this,a="border-box"===n.css("box-sizing"),o=t?wn:En,i=t?kn:Sn,u=t?Tn:An;return 0===arguments.length?(r=Math.round(mn(n.css(o)))||0,a&&(r-=mn(n.css("padding-"+i))+mn(n.css("padding-"+u))+mn(n.css("border-"+i+"-"+wn))+mn(n.css("border-"+u+"-"+wn))),r):(n.css(o,e),n)}}function na(e){var t=e;return function(){var e=this,r=t?kn:Sn,n=t?Tn:An;return t?e.width():e.height()+mn(e.css("padding-"+r))+mn(e.css("padding-"+n))}}function aa(e){var t=e;return function(e){var r=t?kn:Sn,n=t?Tn:An,a=this,o=t?a.innerWidth():a.innerHeight();return o+=mn(a.css("border-"+r+"-"+wn))+mn(a.css("border-"+n+"-"+wn)),e&&(o+=mn(a.css("margin-"+r))+mn(a.css("margin-"+n))),o}}function oa(e){var t=e;return function(e){return this.forEach((function(r){r.style[Mn]=t?On:Vn,e&&e.apply(r)})),this}}function ia(e){var t=e;return function(e){var r="scrollLeft",n="scrollTop",a=t?r:n,o=t?"pageXOffset":"pageYOffset",i=this[0],u=Wn(i);return ta(e)?u?o in u?u[o]:gn.documentElement[a]:i[a]:(u?u.scrollTo(t?e:Un(u)[r](),t?Un(u)[n]():e):i[a]=e,this)}}function ua(e,t,r){e.removeEventListener(t,r)}Ar._extend(zn,Hn),Un.prototype=zn,Un.each=Ar._each,Un.isEmptyObject=Ar._isEmptyObject,Un.isFunction=Ar._isFunction,Un.isArray=Ar._isArray,Un.isNumeric=Ar._isNumeric,Un.getType=Ar._getType,Un.inArray=Ar._inArray,Un.merge=Ar._merge,Un.map=Ar._map,Un.extend=Ar._extend,Un.inherit=Ar._inherit,Un.isPlainObject=Ar._isPlainObject,Un.isArraylike=Ar._isArraylike,Un.isWindow=Ar._isWindow,Un.makeArray=Ar._makeArray,Un.trim=function(e){return e.trim?e.trim():e===pn||e===vn?"":(e+"").replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},Un._createElement=function(e,t,r,n,a){var o=Un(gn.createElement(e));return t&&r&&o.css(t,r),n&&o.addClass(n),a&&(a instanceof Un?a.append(o):Un(a).append(o)),o};var sa=Un;function la(e){if(null==e)return!1;var t=e.toString();return!isNaN(Number(""===t.trim()?NaN:t))||/^[1-9]\d{0,2}(?:(,\d{3})*|\d*)(?:\.\d*)?$/.test(t)}function ca(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(null==r)return null;if("string"!=typeof r&&"number"!=typeof r)return{value:r,autoFormatter:null};var a,o=t&&t.formatter,i=t&&t.autoFormatter,u=null;if(o){var s="string"==typeof r?r:String(r),l=o.parse(s);a=l?l.value:r}else if(n){var c=(0,Ee.getPreferredFormatter)(e,r,i);a=c.value,u=c.formatter}else{var h=(0,Ee.getPreferredFormatter)(e,r);a=h.value,u=h.formatter}return a instanceof we.SheetDate&&(a=a.toNumber()),{value:a,autoFormatter:u}}var ha=1,fa=2,da=3,va=4;function pa(e){for(var t=e.replace(/^\s+|\s+$/,"").replace(/\s+/g," ").split(" "),r=0;r<t.length;r+=1)if(/^(-?\d|--)/.test(t[r])||!/^([_a-zA-Z0-9-]|[^\0-\237]|(\\[0-9a-f]{1,6}(\r\n|[ \n\r\t\f])?|\\[^\n\r\f0-9a-f]))+$/.test(t[r]))return null;return t.join(" ")}function ma(e){e=e.replace(/\s*\/\s*/gi,"/");for(var t,r=ha,n="",a={"font-family":[]},o=0;t=e.charAt(o);o+=1)if(r!==va||'"'!==t&&"'"!==t)if(r===da&&","===t)r=va,n="";else if(r===va&&","===t){var i;(i=pa(n))&&a["font-family"].push(i),n=""}else r!==ha||" "!==t&&"/"!==t?r===fa&&" "===t?(/^(\+|-)?([0-9]*\.)?[0-9]+(em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)?$/.test(n)&&(a["line-height"]=n),r=va,n=""):n+=t:(/^((xx|x)-large|(xx|s)-small|small|large|medium)$/.test(n)||/^(larg|small)er$/.test(n)||/^(\+|-)?([0-9]*\.)?[0-9]+(em|ex|ch|rem|vh|vw|vmin|vmax|px|mm|cm|in|pt|pc|%)$/.test(n)?(r="/"===t?fa:va,a["font-size"]=n):/^(italic|oblique)$/.test(n)?a["font-style"]=n:/^small-caps$/.test(n)?a["font-variant"]=n:/^(bold(er)?|lighter|[1-9]00)$/.test(n)?a["font-weight"]=n:/^((ultra|extra|semi)-)?(condensed|expanded)$/.test(n)&&(a["font-stretch"]=n),n="");else{var u=o+1;do{if(!(u=e.indexOf(t,u)+1))return null}while("\\"===e.charAt(u-2));a["font-family"].push(e.slice(o,u)),o=u-1,r=da,n=""}return r!==da||/^\s*$/.test(n)?(r===va&&(i=pa(n))&&a["font-family"].push(i),a["font-size"]&&a["font-family"].length?a:null):null}function ga(e){if(null==e)return e;if("object"!=(0,R.Z)(e))return e;if(Array.isArray(e)){for(var t=[],r=0;r<e.length;r++)t[r]=ga(e[r]);return t}var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=ga(e[a]));return n}var ya,_a=13;!function(e){e[e.normal=400]="normal",e[e.bold=700]="bold"}(ya||(ya={}));var Ra="normal",Ca={_composeTextDecoration:function(e){if(e<=0)return"none";var t=[];return(e&Ce.aBM.underline)===e&&t.push("underline"),(e|Ce.aBM.lineThrough)===e&&t.push("line-through"),(e|Ce.aBM.overline)===e&&t.push("overline"),t.join(" ")},_scaleFont:function(e,t,r,n){var a;if(!n&&(a=ka[e]))return a;var o=-1!==e.indexOf("no-common-ligatures");return o&&Ea?(n||(ka[e]=Ea),Ea):(a=Sa(o?null:ma(e)),n||(ka[e]=a),Ea=a,a)},_dispose:function(){Na&&(Na.parentElement&&Na.parentElement.removeChild(Na),Na=void 0,ba=void 0)},_buildFontString:function(e,t){var r=[],n="normal",a=e.fontWeight,o=e.fontSize||"",i=e.lineHeight,u=e.fontStyle,s=e.fontVariant;if(u&&u!==n&&r.push(u),s&&s!==n&&r.push(s),a&&a!==n&&"400"!==a&&r.push(a),o){var l=o;i&&i!==n&&(l+="/"+i),r.push(l)}var c=e.fontFamily||(t?"":(0,Ce.M10)());return c&&r.push(c),r.join(" ")},_updateFont:function(e,t){var r,n=null;"string"==typeof e?(n=Ma[e])||(n=ma(e))&&(Ma[e]=n):n={"font-family":[],"font-style":e.fontStyle,"font-weight":null===(r=e.fontWeight)||void 0===r?void 0:r.toString(),"font-size":"".concat(e.fontSize,"px")};var a=Sa(n,t);return ka[a.font]=a,a},_updateTextDecoration:function(e,t){var r=t.active,n=t.flag,a=e||Ce.aBM.none;return r?a&=~n:a|=n,a},px2Pt:Aa};function wa(e){if(!e)return{fontFamily:null,fontSize:null,fontStyle:null,fontWeight:null,lineHeight:null};var t=function(){if(Na)Na.style.cssText=ba;else{var e=document.createElement("span"),t=e.style;t.visibility="hidden",t.top="-10000px",t.left="-10000px",t.lineHeight="normal",t.position="absolute",t.fontWeight="normal",t.fontStretch="normal",t.fontStyle="normal",t.fontVariant="normal",t.fontSize=Ce.OSP,document.body.appendChild(e),Na=e,ba=t.cssText}return Na}();t.style.font=e;var r=t.style;return{fontFamily:r.fontFamily,fontSize:r.fontSize,fontStyle:r.fontStyle,fontWeight:r.fontWeight,lineHeight:r.lineHeight}}var Ea,ka={},Ta={"x-small":10,small:13,medium:16,large:18,"x-large":24,"xx-large":32};function Sa(e,t){var r={font:"13px/1.5 Arial",fontStyle:"normal",fontWeight:400,fontSize:13,fontFamily:(0,Ce.M10)()};if(!e){if(!t)return r;e={"font-family":(0,Ce.M10)().split(", ")}}var n=ga(e);t&&function(e,t){for(var r in t)e[(0,_e.Z)(r)]=t[r]}(n,t);var a=n["font-style"],o=n["font-weight"],i=n["font-size"],u=n["line-height"],s=Array.isArray(n["font-family"])?n["font-family"].join(", "):n["font-family"];i&&function(e,t){var r=parseFloat(t);Number.isNaN(r)&&(r=Ta[t]||_a),/pt/i.test(t)?e.fontSize=Ia(r):e.fontSize=Math.floor(r)}(r,i),o&&function(e,t){"bold"===t?e.fontWeight=700:"normal"===t?e.fontWeight=400:t&&(e.fontWeight=parseInt(t,10)||400)}(r,o),a&&(r.fontStyle=a),s&&(r.fontFamily=s);var l=a&&"normal"!==a?a+" ":"",c=o&&"normal"!==o&&400!==Number(o)?o+" ":"",h=i?"number"==typeof i?i+"px":i:"",f=u?"/"+u:"";return r.font=l+c+h+f+" "+r.fontFamily,r}function Aa(e){return null==e?10:Math.ceil(72*e/96)}function Ia(e){return Math.floor(96*e/72)}function Oa(e){return e.endsWith("px")?Aa(parseInt(e,10)||_a):10}function Va(e){return Ia(e)+"px"}var Na,ba,Ma={};function Fa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;switch((0,R.Z)(e)){case"object":return null===e?Za(349,t):Array.isArray(e)?Da(e,t):Pa(e,t,r);case"string":return xa(e,t);case"boolean":return Za(e?433:863,t);case"number":return Za(e,t);case"undefined":return Za(937,t);default:return Za(617,t)}}function Za(e,t){return(t<<5)-t+e|0}function xa(e,t){t=Za(149417,t);for(var r=0,n=e.length;r<n;r++)t=Za(e.charCodeAt(r),t);return t}function Da(e,t){return t=Za(104579,t),e.reduce((function(e,t){return Fa(t,e)}),t)}function Pa(e,t,r){return t=Za(181387,t),Object.keys(e).sort().reduce((function(t,n){return null==e[n]||e[n]===e||r&&r.has(n)?t:(t=xa(n,t),Fa(e[n],t))}),t)}var $a=function(){function e(t,r,n,a){(0,y.Z)(this,e),this.x=t,this.y=r,this.width=n,this.height=a}return(0,_.Z)(e,[{key:"intersect",value:function(e,t,r,n){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+n}},{key:"intersectRect",value:function(e){return this.intersect(e.x,e.y,e.width,e.height)}},{key:"contains",value:function(e,t){return this.x<e&&e<this.x+this.width&&this.y<t&&t<this.y+this.height}},{key:"containsRect",value:function(e){return this.contains(e.x,e.y)&&this.contains(e.x+e.width,e.y+e.height)}},{key:"getIntersectRect",value:function(e){return this.getIntersect(e.x,e.y,e.width,e.height)}},{key:"getIntersect",value:function(t,r,n,a){var o=Math.max(this.x,t),i=Math.max(this.y,r),u=Math.min(this.x+this.width,t+n)-o,s=Math.min(this.y+this.height,r+a)-i;return u>0&&s>0?new e(o,i,u,s):null}},{key:"round",value:function(){this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.width=Math.ceil(this.width),this.height=Math.ceil(this.height)}},{key:"clone",value:function(){return new e(this.x,this.y,this.width,this.height)}},{key:"unionRect",value:function(e){return this.union(e.x,e.y,e.width,e.height)}},{key:"union",value:function(t,r,n,a){var o=Math.min(this.x,t),i=Math.min(this.y,r);return new e(o,i,Math.max(this.x+this.width,t+n)-o,Math.max(this.y+this.height,r+a)-i)}}]),e}(),La=function(){function e(t,r){(0,y.Z)(this,e),this.x=t,this.y=r}return(0,_.Z)(e,[{key:"clone",value:function(){return new e(this.x,this.y)}}]),e}();function Ba(e){return!!(31&e.$$type)}function Ua(e){return!!(14&e.$$type)}function Ha(e){return!!(96&e.$$type)}function za(e){return 2===e.$$type}function Wa(e){return 4===e.$$type}function Ga(e){return 8===e.$$type}function ja(e){return 16===e.$$type}function Ya(e){return ja(e)&&e.errorCode===it.WAIT_ASYNC_ERR_VAR.errorCode}function qa(e){return 1===e.$$type}function Ja(e){return!!(32&e.$$type)}function Ka(e){return 96===e.$$type}function Xa(e){return 96===e.$$type||1073741920===e.$$type||134217824===e.$$type}function Qa(e){return 1073741920===e.$$type}function eo(e){return 134217824===e.$$type}function to(e){return 64===e.$$type}function ro(e){return!!(64&e.$$type)}function no(e){return 384===e.$$type}function ao(e){return 1152===e.$$type}function oo(e){return 640===e.$$type}function io(e){return 2176===e.$$type}function uo(e){return 8320===e.$$type}function so(e){return 16512===e.$$type}var lo=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this))).row=e,i.col=r,i.blockToken=a,i.formula=o,i.baseVar=n,i.type=n.type,i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"isNull",value:function(){return qa(this.baseVar)}},{key:"getVar",value:function(){var e;if(!this.formula)return this.baseVar;var t=null===(e=this.formula.getState().cache)||void 0===e?void 0:e.getRawVar();if(t&&ja(t)){var r=this.formula.getRef().toJSON(),n=r.row,a=r.col;return this.row===n&&this.col===a&&t.errorCode===it.ErrorCode.SUSPENDED?it.WAIT_ASYNC_ERR_VAR:t}return this.baseVar}},{key:"getValue",value:function(){return this.getVar().getValue()}},{key:"getRawVar",value:function(){var e;return(null===(e=this.formula)||void 0===e?void 0:e.getRawVar())||it.NULL_VAR}},{key:"toNumberVar",value:function(e){return this.baseVar.toNumberVar(e)}},{key:"toStringVar",value:function(){return this.baseVar.toStringVar()}},{key:"toBooleanVar",value:function(){return this.baseVar.toBooleanVar()}},{key:"equals",value:function(e){return this.baseVar.equals(e)}},{key:"greaterThan",value:function(e){return!this.baseVar.isError()&&this.baseVar.greaterThan(e)}},{key:"lessThan",value:function(e){return!this.baseVar.isError()&&this.baseVar.lessThan(e)}},{key:"greaterThanEquals",value:function(e){return!this.baseVar.isError()&&this.baseVar.greaterThanEquals(e)}},{key:"lessThanEquals",value:function(e){return!this.baseVar.isError()&&this.baseVar.lessThanEquals(e)}},{key:"serialize",value:function(){return null}},{key:"isRuntimeError",value:function(){return this.baseVar.isError()&&this.baseVar.isRuntimeError()}}]),t}(it.BaseVar);function co(e){return e instanceof lo}lo.prototype.$$type=16512;var ho=new it.NullVar;ho.setSpecialInfo=function(){},it.BaseVar.prototype.forEach=function(e){return e(this)},it.BaseVar.prototype.rowCount=function(){return 1},it.BaseVar.prototype.colCount=function(){return 1},it.BaseVar.prototype.size=function(){return 1},it.BaseVar.prototype.at=function(){return this},it.PrimitiveVar.prototype.iter=function(){return new it.PrimitiveVarIter(this)};var fo=it.StringVar.prototype.toNumberVar;it.StringVar.prototype.toNumberVar=function(e){var t=this.getValue();if(!e.spread)return fo.call(this,e);var r=(0,Ee.getPreferredFormatter)(e.spread.formatterService,t).value;return r instanceof we.SheetDate?new it.NumberVar(r.toNumber()):"number"==typeof r?new it.NumberVar(r):"boolean"==typeof r?new it.NumberVar(r?1:0):fo.call(this,e)},it.StringVar.prototype.getCompareValue=function(e){if(void 0===this.compareValue){var t=this.toNumberVar(e);t.isNumber()?this.compareValue=t.getCompareValue():this.compareValue=this.getValue()}return this.compareValue},it.StringVar.prototype.equals=function(e){return!!e.isString()&&this.getValue().toLowerCase()===e.getValue().toLowerCase()},it.StringVar.prototype.greaterThan=function(e){return!(!e.isString()||this.equals(e))&&this.getValue().toLowerCase()>e.getValue().toLowerCase()},it.StringVar.prototype.lessThan=function(e){return!(!e.isString()||this.equals(e))&&this.getValue().toLowerCase()<e.getValue().toLowerCase()};var vo,po,mo=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,""))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"equals",value:function(e){return!!e.isNull()||e.isString()&&e.getValue()===this.value}},{key:"setSpecialInfo",value:function(){}}]),t}(it.StringVar),go=new mo,yo=new it.StringVar(it.BooleanConstant.TRUE),_o=new it.StringVar(it.BooleanConstant.FALSE);yo.setSpecialInfo=function(){},_o.setSpecialInfo=function(){},function(e){e[e.PrimePrimitive=14]="PrimePrimitive",e[e.Primitive=31]="Primitive",e[e.Collection=96]="Collection",e[e.TypeFields=110]="TypeFields",e[e.Any=238]="Any",e[e.AnyField=128]="AnyField",e[e.Nullable=1]="Nullable",e[e.Errorable=16]="Errorable",e[e.VarTypeFields=255]="VarTypeFields",e[e.SingleValue=256]="SingleValue",e[e.Lazy=1024]="Lazy",e[e.LazySkipArray=2048]="LazySkipArray"}(vo||(vo={})),function(e){e[e.None=0]="None",e[e.Array=1]="Array",e[e.Default=2]="Default"}(po||(po={}));var Ro,Co=1073741823;function wo(e){for(var t=Array.from({length:e.length},(function(){return 0})),r=0;r<e.length;++r){var n=e[r];if(n.singleValue&&224&n.type&&!(128&n.type))throw new Error("params[".concat(r,"]: 'singleValue' can only be true for native primitive type"));if(!1===n.singleValue&&14&n.type&&!(128&n.type))throw new Error("params[".concat(r,"]: 'singleValue' can only be false for collection type, giving a primitive type is meaningless"));if(128&n.type&&!n.nullable)throw new Error("params[".concat(r,"]: 'nullable' must be true for ANY type"));if(!n.lazy&&n.lazySkipArray)throw new Error("params[".concat(r,"]: 'lazy' must be true when 'lazySkipArray' is true"));var a=n.type;(n.singleValue||null==n.singleValue&&14&n.type&&!(224&n.type))&&(a|=256),n.singleValue&&128&n.type&&(a&=-97),n.nullable&&(a|=1),n.errorable&&(a|=16),n.lazy&&(a|=1024),n.lazySkipArray&&(a|=2048),t[r]=a}return t}function Eo(e,t){e.prototype.$$type=t}!function(e){e.Number=2,e.String=4,e.Boolean=8,e.Matrix=32,e.Ref=64,e.Collection=111,e.Any=238}(Ro||(Ro={})),Eo(it.BaseVar,128),Eo(it.NullVar,1),Eo(it.NumberVar,2),Eo(it.StringVar,4),Eo(it.BooleanVar,8),Eo(it.ErrorVar,16),Eo(it.BaseCustomPrimitiveVar,128),Eo(it.BaseCustomCollectionVar,128),it.NumberVar.prototype.toBooleanVar=function(){return this.value?it.BOOLEAN_VAR_MAP[it.BooleanConstant.TRUE]:it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE]};var ko=Object.getPrototypeOf(it.EqualsOp);ko.prototype.$$minOperands=2,ko.prototype.$$maxOperands=2,ko.prototype.$$lazy=!1,ko.prototype.$$paramsDesc=[399],ko.prototype.func=function(e,t){for(var r=0;r<t.length;r++)2176===t[r].$$type&&(t[r]=it.NULL_VAR);return this.opImpl(e,t[0],t[1])},it.NumberBinaryOp.prototype.$$minOperands=2,it.NumberBinaryOp.prototype.$$maxOperands=2,it.NumberBinaryOp.prototype.$$lazy=!1,it.NumberBinaryOp.prototype.$$paramsDesc=[258],it.NumberBinaryOp.prototype.func=function(e,t){return this.opImpl(t[0],t[1])};var To=Object.getPrototypeOf(it.ConcatenateOp);To.prototype.$$minOperands=2,To.prototype.$$maxOperands=2,To.prototype.$$lazy=!1,To.prototype.$$paramsDesc=[260],To.prototype.func=function(e,t){return this.opImpl(t[0],t[1])},it.PrefixUnaryOpBase.prototype.$$minOperands=1,it.PrefixUnaryOpBase.prototype.$$maxOperands=1,it.PrefixUnaryOpBase.prototype.$$lazy=!1,it.PrefixUnaryOpBase.prototype.$$paramsDesc=[258],Object.getPrototypeOf(it.NegativeOp).prototype.func=function(e,t){return this.opImpl(t[0])},Object.getPrototypeOf(it.PercentOp).prototype.func=function(e,t){return this.opImpl(t[0])},it.PositiveOp.prototype.$$paramsDesc=[399],it.PositiveOp.prototype.func=function(e,t){return t[0].isNull()?t[0].toNumberVar():t[0]},it.PercentOp.prototype.$$minOperands=1,it.PercentOp.prototype.$$maxOperands=1,it.PercentOp.prototype.$$lazy=!1,it.PercentOp.prototype.$$paramsDesc=[258],it.ParenOp.prototype.$$minOperands=1,it.ParenOp.prototype.$$maxOperands=1,it.ParenOp.prototype.$$lazy=!1,it.ParenOp.prototype.$$cacheType=0,it.ParenOp.prototype.$$paramsDesc=[255],it.ParenOp.prototype.func=function(e,t){return t[0]};var So,Ao,Io,Oo,Vo,No=1048576,bo=16384,Mo=32;!function(e){e.Add="add",e.Delete="delete"}(So||(So={})),function(e){e[e.AllRangeBase=0]="AllRangeBase",e[e.NormalRange=1]="NormalRange"}(Ao||(Ao={})),function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Top=4]="Top",e[e.Bottom=8]="Bottom",e[e.All=15]="All"}(Io||(Io={})),function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Top=4]="Top",e[e.Bottom=8]="Bottom",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"}(Oo||(Oo={})),function(e){e.A1="A1",e.R1C1="R1C1"}(Vo||(Vo={}));var Fo=Math.pow(2,25),Zo=new Set([Ce.xj7.ROW,Ce.xj7.COL,Ce.xj7.ALL]),xo=function(e){return Zo.has(e.rgType)},Do=function(e){return e[0]+e[1]},Po=function(e,t){var r=e[0],n=e[1],a=t.from(),o=t.to(),i=t.segOpType(),u=t.size();if("add"===i)a<=e[0]?r+=u:a<Do(e)&&(n+=u);else if("delete"===i){var s=function(e,t){var r=Math.max(e[0],t[0]),n=Math.min(e[1],t[1])-r;return n<=0?null:[r,n]}([r,r+n],[a,o+1]);a<e[0]&&(o<e[0]?r-=u:r=a),null!==s&&(n-=s[1])}return[r,n]},$o=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Lo=function(e,t,r,n){return e<=r&&n<=t};function Bo(e){return/[^a-z]/gi.test(e)?"'".concat(e=e.replace(/'/g,"''"),"'"):e}var Uo=Math.max,Ho=Math.min;function zo(e,t){return e.startCol<=t.startCol&&e.startRow<=t.startRow&&t.endCol<=e.endCol&&t.endRow<=e.endRow}function Wo(e,t,r){return e.startCol<=r&&e.startRow<=t&&r<e.endCol&&t<e.endRow}function Go(e,t){return e.startCol===t.startCol&&e.endCol===t.endCol}function jo(e,t){return function(e,t){return Lo(e.startRow,e.endRow-1,t.startRow,t.endRow-1)}(e,t)||function(e,t){return Lo(e.startCol,e.endCol-1,t.startCol,t.endCol-1)}(e,t)}function Yo(e,t){return t.startCol<e.endCol&&t.startRow<e.endRow&&t.endCol>e.startCol&&t.endRow>e.startRow}function qo(e,t){return e.hostId===t.hostId}function Jo(e,t){return{startRow:Ho(e.startRow,t.startRow),endRow:Uo(e.endRow,t.endRow),startCol:Ho(e.startCol,t.startCol),endCol:Uo(e.endCol,t.endCol),hostId:e.hostId,hostName:e.hostName,status:e.status}}function Ko(e,t){return{startRow:Uo(e.startRow,t.startRow),endRow:Ho(e.endRow,t.endRow),startCol:Uo(e.startCol,t.startCol),endCol:Ho(e.endCol,t.endCol),hostId:e.hostId,hostName:e.hostName,status:e.status}}function Xo(e){return{startRow:e.startRow,endRow:e.endRow,startCol:e.startCol,endCol:e.endCol,hostId:e.hostId,hostName:e.hostName,status:e.status}}var Qo=new Array(8);function ei(e,t,r,n,a,o,i,u){return Qo[0]=a||"",Qo[1]=o||"",Qo[2]=e||0,Qo[3]=t||0,Qo[4]=r||0,Qo[5]=n||0,Qo[6]=i||0,Qo[7]=u||0,Qo.join()}function ti(e,t){return t.startRow<e.startRow&&(e.startRow=t.startRow),t.startCol<e.startCol&&(e.startCol=t.startCol),t.endRow>e.endRow&&(e.endRow=t.endRow),t.endCol>e.endCol&&(e.endCol=t.endCol),e}function ri(e,t){e.startRow=t.startRow,e.endRow=t.endRow,e.startCol=t.startCol,e.endCol=t.endCol,e.hostId=t.hostId,e.hostName=t.hostName,e.status=t.status}function ni(e){return e.endRow-e.startRow}function ai(e){return e.endCol-e.startCol}function oi(e){return ai(e)*ni(e)}var ii,ui=[0,1],si=[2,3],li=["endRow","startRow","endCol","startCol"],ci={startKey:li[1],endKey:li[0]},hi={startKey:li[3],endKey:li[2]},fi=[0,2];function di(e,t){return(t<<4)+e}function vi(e){return 15&e}function pi(e){return e>>4}function mi(e){var t=pi(e);return!!(1&t&&2&t)}function gi(e){var t=pi(e);return!!(4&t&&8&t)}function yi(e){return mi(e.status)}function _i(e){return gi(e.status)}function Ri(e,t){var r=e[t.startKey],n=e[t.endKey];return r>=0&&n>r}function Ci(e){return Ri(e,ci)&&Ri(e,hi)}function wi(e,t){var r,n=Ei(function(e){var t=mi(e.status),r=gi(e.status);return{startRow:r?0:e.startRow,endRow:r?Fo:e.startRow+1,startCol:t?0:e.startCol,endCol:t?Fo:e.startCol+1,hostId:e.hostId,hostName:e.hostName,status:e.status}}(e),t);r=1===oi(e)?n:ti(n,Ei(function(e){var t=mi(e.status),r=gi(e.status);return{startRow:r?0:e.endRow-1,endRow:r?Fo:e.endRow,startCol:t?0:e.endCol-1,endCol:t?Fo:e.endCol,hostId:e.hostId,hostName:e.hostName,status:e.status}}(e),t));var a=pi(r.status),o=vi(e.status);return r.status=di(o,a),r}function Ei(e,t){for(var r={hostId:t.hostId,hostName:t.hostName},n=[],a=pi(t.status),o=vi(t.status),i=0;i<fi.length;i++){var u=fi[i],s=li[u],l=1<<3-u,c=u+1,h=li[c],f=l>>1,d=a&l,v=a&f,p=o&l,m=o&f;if(n[u]=p,n[c]=m,d&&v)r[s]=t[s],r[h]=t[h];else if(d||!v)if(!d||v)if(m&&p)r[s]=t[s],r[h]=t[h];else if(p||m){var g=p?t[s]:e[h]+t[s],y=m?t[h]:e[h]+t[h];y>=g?(r[h]=g-1,r[s]=y+1,n[c]=p>>1,n[u]=m<<1):(r[h]=y,r[s]=g)}else r[s]=e[h]+t[s],r[h]=e[h]+t[h];else r[s]=t[s],r[h]=m?t[h]:e[h]+t[h];else r[h]=t[h],r[s]=p?t[s]:e[h]+t[s]}return r.status=di(n[0]|n[1]|n[2]|n[3],a),r}function ki(e,t,r){for(var n={hostId:t.hostId,hostName:t.hostName,status:t.status},a=pi(t.status),o=vi(t.status),i=[],u=0;u<fi.length;u++){var s=fi[u],l=li[s],c=1<<3-s,h=s+1,f=li[h],d=c>>1,v=a&c,p=a&d,m=o&c,g=o&d;i[s]=m,i[h]=g,p&&(n[f]=t[f]),v&&(n[l]=t[l]),p&&v||(g&&m?(!p&&(n[f]=t[f]),!v&&(n[l]=t[l])):m||g?void 0===r||(r&d)===g&&(r&c)===m?(!p&&(n[f]=g?t[f]:t[f]-e[f]),!v&&(n[l]=m?t[l]:t[l]-e[f])):(g?(!p&&(n[f]=t[l]-e[f]-1),!v&&(n[l]=t[f]+1)):(!p&&(n[f]=t[l]-1),!v&&(n[l]=t[f]-e[f]+1)),i[h]=m>>1,i[s]=g<<1):(!p&&(n[f]=t[f]-e[f]),!v&&(n[l]=t[l]-e[f])))}return void 0!==r&&(n.status=di(i[0]|i[1]|i[2]|i[3],a)),n}function Ti(e,t){return e.startRow=Uo(e.startRow,t.startRow),e.endRow=Ho(e.endRow,t.endRow),e.startCol=Uo(e.startCol,t.startCol),e.endCol=Ho(e.endCol,t.endCol),e}function Si(e,t,r){for(var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a={hostId:r.hostId,hostName:r.hostName,status:r.status},o=pi(t.status),i=vi(t.status),u=0;u<fi.length;u++){var s=fi[u],l=li[s],c=1<<3-s,h=s+1,f=li[h],d=c>>1,v=o&c,p=o&d,m=i&c,g=i&d;if(v&&p)a[l]=r[l],a[f]=r[f];else if(!v||p)if(v||!p)if(m&&g)a[l]=r[l],a[f]=r[f];else if(m||g){var y=li[m?s:h],_=li[m?h:s],R=g?t[y]:t[y]-1,C=g?t[_]-1:t[_];e[f]<=R?a[f]=r[f]:a[f]=e[f]-C,e[l]-1>=R?a[l]=r[l]:a[l]=e[l]-C}else{a[l]=e[l]-t[f];var w=Math.abs(t[l]-t[f]);a[f]=e[f]-w+1-t[f]}else a[l]=r[l],a[f]=m?r[f]:e[f]+1-t[l];else a[f]=r[f],a[l]=g?r[l]:e[f]-t[f]+1}return n&&Ti(a,r),a}function Ai(e,t,r,n){var a=Xo(r),o=Ii(t,n),i=o.startKey,u=o.endKey,s=o.startLock,l=o.endLock;if(s&&l)return a[i]=e[i]===t[i]?r[i]:-1,a[u]=e[u]===t[u]?r[u]:-1,a;if(!s&&!l)return a[i]=e[i]-t[i],a[u]=e[u]-t[u]+1,a;var c=s?t[i]:t[u]-1,h=s?t[u]-1:t[i];return c<e[i]||c>e[u]-1?(a[i]=-1,a[u]=-1,a):(a[i]=Uo(e[i]-h,r[i]),a[u]=Ho(e[u]-h,r[u]),a)}function Ii(e,t){var r=t?ui:si,n=t?ci:hi,a=vi(e.status);return{startKey:n.startKey,endKey:n.endKey,startLock:Fi(a,r[1]),endLock:Fi(a,r[0])}}function Oi(e,t,r,n){var a=Xo(r),o=Ii(t,n),i=o.startKey,u=o.endKey,s=o.startLock,l=o.endLock;if(s&&l)return a[i]=r[i],a[u]=r[u],Ti(a,r);if(!s&&!l)return a[u]=e[i]-t[i]+1,a[i]=e[u]-t[u],Ti(a,r);var c=s?t[i]:t[u]-1,h=s?t[u]-1:t[i];return e[i]<c?a[u]=e[i]-h+1:a[u]=r[u],e[u]-1>c?a[i]=e[u]-1-h:a[i]=r[i],Ti(a,r)}function Vi(e){var t,r,n,a,o=e.startRow,i=e.endRow,u=e.endCol,s=e.startCol,l=e.status,c=e.sheetId,h=e.sheetName;return{startRow:null!==(t=o)&&void 0!==t?t:0,endRow:null!==(r=i)&&void 0!==r?r:Fo,startCol:null!==(n=s)&&void 0!==n?n:0,endCol:null!==(a=u)&&void 0!==a?a:Fo,hostId:c,hostName:h,status:l||0}}function Ni(e){var t=vi(e.status),r=!!(4&t),n=!!(8&t),a=!!(1&t),o=!!(2&t);return!(r===n&&e.startRow>=e.endRow)&&!(a===o&&e.startCol>=e.endCol||r&&e.startRow<0||n&&e.endRow<0||a&&e.startCol<0||o&&e.endCol<0)}function bi(e,t){var r=[];if(!qo(e,t)||!Yo(e,t))return r.push(e),r;var n=Ko(e,t);return n.startCol>e.startCol&&r.push({startRow:e.startRow,endRow:e.endRow,startCol:e.startCol,endCol:n.startCol,hostId:e.hostId,hostName:e.hostName,status:e.status}),n.startRow>e.startRow&&r.push({startRow:e.startRow,endRow:n.startRow,startCol:n.startCol,endCol:n.endCol,hostId:e.hostId,hostName:e.hostName,status:e.status}),n.endRow<e.endRow&&r.push({startRow:n.endRow,endRow:e.endRow,startCol:n.startCol,endCol:n.endCol,hostId:e.hostId,hostName:e.hostName,status:e.status}),n.endCol<e.endCol&&r.push({startRow:e.startRow,endRow:e.endRow,startCol:n.endCol,endCol:e.endCol,hostId:e.hostId,hostName:e.hostName,status:e.status}),r}function Mi(e,t){var r=[];if(!qo(e,t)||!Yo(e,t))return r.push(e),r;var n=Ko(e,t);return n.startRow>e.startRow&&r.push({startRow:e.startRow,endRow:n.startRow,startCol:e.startCol,endCol:e.endCol,hostId:e.hostId,hostName:e.hostName,status:e.status}),n.startCol>e.startCol&&r.push({startRow:n.startRow,endRow:n.endRow,startCol:e.startCol,endCol:n.startCol,hostId:e.hostId,hostName:e.hostName,status:e.status}),n.endCol<e.endCol&&r.push({startRow:n.startRow,endRow:n.endRow,startCol:n.endCol,endCol:e.endCol,hostId:e.hostId,hostName:e.hostName,status:e.status}),n.endRow<e.endRow&&r.push({startRow:n.endRow,endRow:e.endRow,startCol:e.startCol,endCol:e.endCol,hostId:e.hostId,hostName:e.hostName,status:e.status}),r}function Fi(e,t){return e&1<<3-t}function Zi(e,t){var r=vi(e.status),n=t?ui:si;return Fi(r,n[0])&&Fi(r,n[1])}function xi(e,t,r,n,a){var o=e.clone();return o.startRow+=t,o.endRow+=t,o.startCol+=r,o.endCol+=r,n&&(o.hostId=n),a&&(o.hostName=a),o}function Di(e,t,r,n,a){var o=e.clone(),i=pi(e.status),u=vi(e.status),s=Pi(o.startRow,o.endRow,t,u,i,!0),l=(0,g.Z)(s,2),c=l[0],h=l[1],f=Pi(o.startCol,o.endCol,r,u,i,!1),d=(0,g.Z)(f,2),v=d[0],p=d[1];return o.startRow=c,o.endRow=h,o.startCol=v,o.endCol=p,n&&(o.hostId=n),a&&(o.hostName=a),o}function Pi(e,t,r,n,a,o){var i=o?2:0;return a>>=i,[1&(n>>=i)||1&a?e:e+r,2&n||2&a?t:t+r]}function $i(e,t){var r=t.getRowCount(),n=t.getColumnCount();return e.endRow<=r&&e.endCol<=n||((e=e.clone()).status=0,e.endRow=Uo(Ho(e.endRow,r),e.startRow),e.endCol=Uo(Ho(e.endCol,n),e.startCol)),e}!function(e){e[e.ALL=0]="ALL",e[e.RANGE=1]="RANGE"}(ii||(ii={}));var Li=[];!function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:No,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:bo,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Mo,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,a={rowSize:e,colSize:t,count:1,hashBase:0};a.rowSize>r||a.colSize>n;){var o=a.count,i=Math.max(a.rowSize/2,r),u=Math.max(a.colSize/2,n);i<a.rowSize&&(o*=2),u<a.colSize&&(o*=2);var s={rowSize:i,colSize:u,count:o,hashBase:a.hashBase+a.count};a=s,Li.push(s)}}();var Bi=function(){function e(t){(0,y.Z)(this,e),this._rg=t,this._phase=0}return(0,_.Z)(e,[{key:"next",value:function(){if(0===this._phase)return this._phase=1,this._iter=new zi(this._rg,!0,this._rg.sheetHash()+1,No/2,8192),0;var e=this._iter,t=e.next();if(null==t&&(e.blockRowSize()>Mo||e.blockColSize()>8)){var r=Math.max(e.blockRowSize()/2,Mo),n=Math.max(e.blockColSize()/2,8);this._iter=new zi(this._rg,!0,e.hashOffset()+e.blockCount(),r,n),t=this.next()}return t}}]),e}(),Ui=function(){function e(t){(0,y.Z)(this,e),this.range=t,this.isDone=!0}return(0,_.Z)(e,[{key:"next",value:function(){return this.isDone?(this.isDone=!1,this.range.sheetHash()):null}}]),e}(),Hi=function(){function e(t){(0,y.Z)(this,e),this._partitionIters=[];for(var r=Li.length-1,n=Li[r];r>0&&(n.rowSize<t.rowCount()||n.colSize<t.colCount());)r--,n=Li[r];var a=t.sheetHash()+1,o=No/2,i=8192;n&&(a=t.sheetHash()+n.hashBase,o=n.rowSize,i=n.colSize),this._blockIter=new zi(t,o===Mo&&8===i,a,o,i)}return(0,_.Z)(e,[{key:"next",value:function(){var e=this._blockIter,t=e.next();if(null==t){if(e.blockRowSize()>Mo||e.blockColSize()>8){var r,n=Math.max(e.blockRowSize()/2,Mo),a=Math.max(e.blockColSize()/2,8),o=yr(e.partitionRanges());try{for(o.s();!(r=o.n()).done;){var i=r.value;this._partitionIters.push(new zi(i,n===Mo&&8===a,e.hashOffset()+e.blockCount(),n,a))}}catch(e){o.e(e)}finally{o.f()}}var u=this._partitionIters.shift();if(u)return this._blockIter=u,this.next()}return t}}]),e}(),zi=function(){function e(t,r,n,a,o){(0,y.Z)(this,e),this._includePartition=r,this._hashOffset=n,this._blockRowSize=a,this._blockColSize=o,t instanceof eu&&(t={row:t.rowFrom(),col:t.colFrom(),rowCount:t.rowCount(),colCount:t.colCount(),sheet:t.sheet()}),this._rg=t,this._row=this._rg.row,this._col=this._rg.col,this._blockRowCount=No/this._blockRowSize,this._blockColCount=bo/this._blockColSize}return(0,_.Z)(e,[{key:"next",value:function(){var e=this._rg;if(!this._includePartition&&!this._coverBlock(this._row,this._col))return this._stepToNextBlock(),Wi(e,this._row,this._col)?this.next():null;if(Wi(e,this._row,this._col)){var t=this._id();return this._stepToNextBlock(),t+this._hashOffset}return null}},{key:"blockRowSize",value:function(){return this._blockRowSize}},{key:"blockColSize",value:function(){return this._blockColSize}},{key:"blockCount",value:function(){return this._blockRowCount*this._blockColCount}},{key:"hashOffset",value:function(){return this._hashOffset}},{key:"partitionRanges",value:function(){var e=[],t=this._rg.row,r=this._rg.col,n=this._rg.row+this._rg.rowCount-1,a=this._rg.col+this._rg.colCount-1,o=this._blockRowStart(t),i=this._blockColStart(r),u=this._blockRowStart(n),s=this._blockColStart(a);return this._coverBlock(t,r)||e.push({row:t,col:r,rowCount:Math.min(o+this.blockRowSize(),n+1)-t,colCount:Math.min(i+this.blockColSize(),a+1)-r,sheet:this._rg.sheet}),s>i&&!this._coverBlock(t,s)&&e.push({row:t,col:s,rowCount:Math.min(o+this.blockRowSize(),n+1)-t,colCount:a-s+1,sheet:this._rg.sheet}),u>o&&!this._coverBlock(u,r)&&e.push({row:u,col:r,rowCount:n-u+1,colCount:Math.min(i+this.blockColSize(),a+1)-r,sheet:this._rg.sheet}),u>o&&s>i&&!this._coverBlock(u,s)&&e.push({row:u,col:s,rowCount:n-u+1,colCount:a-s+1,sheet:this._rg.sheet}),e}},{key:"_stepToNextBlock",value:function(){this._col=this._blockColStart(this._col)+this._blockColSize,this._col>this._rg.col+this._rg.colCount-1&&(this._row=this._blockRowStart(this._row)+this._blockRowSize,this._col=this._rg.col)}},{key:"_blockRowStart",value:function(e){return Math.floor(e/this._blockRowSize)*this._blockRowSize}},{key:"_blockColStart",value:function(e){return Math.floor(e/this._blockColSize)*this._blockColSize}},{key:"_id",value:function(){var e=Math.floor(this._row/this._blockRowSize);return Math.floor(this._col/this._blockColSize)+e*(bo/this._blockColSize)}},{key:"_coverBlock",value:function(e,t){var r=this._blockRowStart(e),n=this._blockColStart(t);return e===r&&this._rg.row+this._rg.rowCount-1>=r+this._blockRowSize-1||t===n&&this._rg.col+this._rg.colCount-1>=n+this._blockColSize-1}}]),e}();function Wi(e,t,r){return e.row<=t&&t<=e.row+e.rowCount-1&&e.col<=r&&r<=e.col+e.colCount-1}function Gi(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(t=t.clone(),r=r.clone(),!t.equal(r)){if(t.contain(e))return Yi(e,t,r);if(r.sheet()===e.sheet()){var a=ji(e,t,r,n),o=a.movingHorizontal,i=a.onEdge,u=a.intersectedRange;if(i)return Ki(e,t,r,u,o,n);if(!u){var s=r.intersect(e);if(s)return Xi(e,s,n)}}}}function ji(e,t,r,n){var a=r.rowFrom()!==t.rowFrom(),o=r.colFrom()!==t.colFrom(),i=t.containCol(e),u=t.containRow(e),s=null;if(!xo(t)&&xo(e)||(n&&(o&&u&&t.setColCount(e.colTo(!0)+1-t.colFrom()),a&&i&&t.setRowCount(e.rowTo(!0)+1-t.rowFrom())),s=e.intersect(t)),!s)return{intersectedRange:null,onEdge:!1,movingHorizontal:!1};var l=s.colTo(!0)===e.colTo(!0)||s.colFrom()===e.colFrom(),c=s.rowTo(!0)===e.rowTo(!0)||s.rowFrom()===e.rowFrom();return{intersectedRange:s,onEdge:u&&!i&&o&&!a&&l||i&&!u&&a&&!o&&c,movingHorizontal:o}}function Yi(e,t,r){var n=e.sheet(),a=r.sheet();if(n&&a)return e=e.clone(),n!==a&&e.setSheet(a),e.setRowFrom(Math.max(0,e.rowFrom()+r.rowFrom()-t.rowFrom())),e.setColFrom(Math.max(0,e.colFrom()+r.colFrom()-t.colFrom())),e.setRowCount(e.rowCount()),e.setColCount(e.colCount()),e}function qi(e,t){return e.colFrom()+e.colCount(!0)<t.colFrom()||e.colFrom()>t.colFrom()+t.colCount(!0)}function Ji(e,t){return e.rowFrom()+e.rowCount(!0)<t.rowFrom()||e.rowFrom()>t.rowFrom()+t.rowCount(!0)}function Ki(e,t,r,n,a,o){e=e.clone();var i={from:a?function(e){return e.colFrom()}:function(e){return e.rowFrom()},count:a?function(e){return e.colCount(!0)}:function(e){return e.rowCount(!0)},setFrom:a?function(e,t){return e.setColFrom(t)}:function(e,t){return e.setRowFrom(t)},setCount:a?function(e,t){return e.setColCount(t)}:function(e,t){return e.setRowCount(t)},movingOverBoundary:a?qi:Ji},u=i.from(r)-i.from(t),s=e.sub(n)[0];if(!s){var l,c=function(e){return JSON.stringify(Object.assign({type:e.rgType},e.toJSON()))};return null!==(l=Ce.Ps3.collectSheetEvent)&&void 0!==l&&l.call(Ce.Ps3,"ccm_sheet_add_del_cell_exception",{reason:"formulaRange",detail:"".concat(c(e),",").concat(c(n))}),void console.error("[ADD_DEL_CELL] formulaRange edge move failed")}var h=n.clone();if(i.setFrom(h,i.from(n)+u),(i.from(n)-i.from(s))*u>0){var f=s.union(h);i.setCount(e,i.count(f)),i.setFrom(e,i.from(f))}else if(i.movingOverBoundary(h,s))o?(i.setCount(e,i.count(h)),i.setFrom(e,i.from(h))):(i.setCount(e,i.count(s)),i.setFrom(e,i.from(s)));else{var d,v=s.sub(r);d=v.length?v.reduce((function(e,t){return e.union(t)})).union(h):h,i.setCount(e,i.count(d)),i.setFrom(e,i.from(d))}return e}function Xi(e,t,r){e=e.clone();var n=t.rowCount(!0)===e.rowCount(!0),a=t.colCount(!0)===e.colCount(!0);if(a&&n)return function(e){e.setRowCount(0),e.setColCount(0)}(e),e;if(r&&(a||n)){var o={from:n?function(e){return e.colFrom()}:function(e){return e.rowFrom()},count:n?function(e){return e.colCount(!0)}:function(e){return e.rowCount(!0)},setFrom:n?function(e,t){return e.setColFrom(t)}:function(e,t){return e.setRowFrom(t)},setCount:n?function(e,t){return e.setColCount(t)}:function(e,t){return e.setRowCount(t)}},i=e.sub(t);if(1===i.length){var u=i[0];return o.setCount(e,o.count(u)),o.setFrom(e,o.from(u)),e}}}var Qi=function(){function e(t,r,n,a,o,i){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;(0,y.Z)(this,e),this.startRow=t,this.endRow=r,this.startCol=n,this.endCol=a,this.hostId=o,this.hostName=i,this.status=u}return(0,_.Z)(e,[{key:"getHostIdentifier",value:function(){return-1}},{key:"hash",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&this.key)return this.key;var r=ei(this.startRow,this.endRow,this.startCol,this.endCol,this.hostId,this.hostName,this.status,this.getHostIdentifier());return t&&(this.key=r),r}},{key:"onDataChanged",value:function(){this.key=void 0}},{key:"isRow",value:function(){return mi(this.status)}},{key:"isCol",value:function(){return gi(this.status)}},{key:"toGridJSON",value:function(e){var t=Object.assign({},this.toSimpleGridJSON(),{status:this.status,sheetId:void 0,sheetName:void 0});return e&&(t.sheetId=this.hostId,t.sheetName=this.hostName),t}},{key:"toSimpleGridJSON",value:function(){var e=this.isRow(),t=this.isCol();return{startRow:t?void 0:this.startRow,endRow:t?void 0:this.endRow,startCol:e?void 0:this.startCol,endCol:e?void 0:this.endCol}}},{key:"toGridRange",value:function(){return{startRow:this.startRow,endRow:this.endRow,startCol:this.startCol,endCol:this.endCol,hostId:this.hostId,hostName:this.hostName,status:this.status}}},{key:"clone",value:function(){return e.fromGridRange(this)}}],[{key:"fromGridJSON",value:function(e){return this.fromGridRange(Vi(e))}},{key:"fromGridRange",value:function(t){return new e(t.startRow,t.endRow,t.startCol,t.endCol,t.hostId,t.hostName,t.status)}}]),e}(),eu=function(e){function t(e,r,n,a,o){var i,u;return(0,y.Z)(this,t),(u=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r,n,a,null==o||null===(i=o.id)||void 0===i?void 0:i.call(o))))._sheet=o,u.customType="SheetRange",u}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setSheet",value:function(e){this._sheet=e,this.hostId=null==e?void 0:e.id(),this.afterSheetChanged&&this.afterSheetChanged(this._sheet)}},{key:"sheetHash",value:function(){var e=String(this._sheet?this._sheet._id:0),r=t.sheetHashMap;if(!r.has(e)){var n=r.size<<26;r.set(e,n)}return r.get(e)}},{key:"getHostIdentifier",value:function(){return this._sheet?this._sheet._id:(0,f.Z)((0,v.Z)(t.prototype),"getHostIdentifier",this).call(this)}},{key:"sheet",value:function(){return this._sheet}},{key:"refStatus",value:function(){return void 0!==this.status?vi(this.status):15}},{key:"rowInterval",value:function(e){return[this.rowFrom(),this.rowCount(e)]}},{key:"colInterval",value:function(e){return[this.colFrom(),this.colCount(e)]}},{key:"rowFrom",value:function(){return this.startRow||0}},{key:"colFrom",value:function(){return this.startCol||0}},{key:"rowTo",value:function(e){return this.rowEnd(e)-1}},{key:"colTo",value:function(e){return this.colEnd(e)-1}},{key:"rowEnd",value:function(e){var t,r;return e?this.endRow:Math.min(this.endRow,null!==(t=null===(r=this._sheet)||void 0===r?void 0:r.getRowCount())&&void 0!==t?t:0)}},{key:"colEnd",value:function(e){var t,r;return e?this.endCol:Math.min(this.endCol,null!==(t=null===(r=this._sheet)||void 0===r?void 0:r.getColumnCount())&&void 0!==t?t:0)}},{key:"rowCount",value:function(e){return Math.max(0,this.rowEnd(e)-this.startRow)}},{key:"colCount",value:function(e){return Math.max(0,this.colEnd(e)-this.startCol)}},{key:"equal",value:function(e,t){return!(!this.isValid()||!e.isValid())&&!(!this._sheet||!e._sheet)&&this._sheet===e._sheet&&$o(this.rowInterval(t),e.rowInterval(t))&&$o(this.colInterval(t),e.colInterval(t))&&this._sheet.name()===e._sheet.name()}},{key:"isRangeValid",value:function(e){return!(!this.isValid()||!e.isValid())&&this._sheet===e._sheet}},{key:"contain",value:function(e,t){return!!this.isRangeValid(e)&&Lo(this.rowFrom(),this.rowTo(t),e.rowFrom(),e.rowTo(t))&&Lo(this.colFrom(),this.colTo(t),e.colFrom(),e.colTo(t))}},{key:"containRow",value:function(e,t){return!!this.isRangeValid(e)&&Lo(this.rowFrom(),this.rowTo(t),e.rowFrom(),e.rowTo(t))}},{key:"containCol",value:function(e,t){return!!this.isRangeValid(e)&&Lo(this.colFrom(),this.colTo(t),e.colFrom(),e.colTo(t))}},{key:"containCell",value:function(e,t,r){return!!this.isValid()&&this.rowFrom()<=e&&e<=this.rowTo(r)&&this.colFrom()<=t&&t<=this.colTo(r)}},{key:"intersectRow",value:function(e,t){var r=Math.max(this.rowFrom(),e.rowFrom()),n=Math.min(this.rowTo(t),e.rowTo(t))-r+1;return n<=0?null:[r,n]}},{key:"intersectCol",value:function(e,t){var r=Math.max(this.colFrom(),e.colFrom()),n=Math.min(this.colTo(t),e.colTo(t))-r+1;return n<=0?null:[r,n]}},{key:"isIntersectRow",value:function(e,t){return this.rowFrom()<=e.rowTo(t)&&e.rowFrom()<=this.rowTo(t)}},{key:"isIntersectCol",value:function(e,t){return this.colFrom()<=e.colTo(t)&&e.colFrom()<=this.colTo(t)}},{key:"isIntersect",value:function(e,t){return this._sheet===e._sheet&&!(!this.isValid()||!e.isValid())&&(e.rgType===Ce.xj7.ALL||this.rgType===Ce.xj7.ALL||this.isIntersectCol(e,t)&&this.isIntersectRow(e,t))}},{key:"size",value:function(e){return this.isValid()?this.rowCount(e)*this.colCount(e):0}},{key:"setRowFrom",value:function(e){var t=this.rowCount(!0);this.startRow=e,this.setRowCount(t)}},{key:"setRowCount",value:function(e){this.endRow=this.startRow+e}},{key:"setColFrom",value:function(e){var t=this.colCount(!0);this.startCol=e,this.setColCount(t)}},{key:"setColCount",value:function(e){this.endCol=this.startCol+e}},{key:"sheetNameToString",value:function(e){var t,r,n=e.isShowSheetName;return void 0===n&&(n=(null===(t=e.ref.sheet())||void 0===t?void 0:t.id())!==(null===(r=this._sheet)||void 0===r?void 0:r.id())),n&&null!=this.sheetName?Bo(this.sheetName)+"!":""}},{key:"rowFromToString",value:function(e){var t=e.ref,r=e.refStyle,n=void 0===r?"A1":r,a=this.rowFrom(),o=4&this.refStatus();if("R1C1"===n){var i=t?a-t.rowFrom():0;return"R".concat(o?a+1:"[".concat(i,"]"))}return"".concat(o?"$":"").concat(a+1)}},{key:"rowToToString",value:function(e){var t=e.ref,r=e.refStyle,n=void 0===r?"A1":r,a=this.rowTo(!0),o=8&this.refStatus();if("R1C1"===n){var i=t?a-t.rowTo(!0):0;return"R".concat(o?a+1:"[".concat(i,"]"))}return"".concat(o?"$":"").concat(a+1)}},{key:"colFromToString",value:function(e){var t=e.ref,r=e.refStyle,n=void 0===r?"A1":r,a=this.colFrom(),o=1&this.refStatus();if("R1C1"===n){var i=t?a-t.colFrom():0;return"C".concat(o?a+1:"[".concat(i,"]"))}return"".concat(o?"$":"").concat((0,Ce.hdC)(a))}},{key:"colToToString",value:function(e){var t=e.ref,r=e.refStyle,n=void 0===r?"A1":r,a=this.colTo(!0),o=2&this.refStatus();if("R1C1"===n){var i=t?a-t.colTo(!0):0;return"C".concat(o?a+1:"[".concat(i,"]"))}return"".concat(o?"$":"").concat((0,Ce.hdC)(a))}},{key:"canDecompile",value:function(){return this.rowFrom()>=0&&this.colFrom()>=0&&this.rowCount(!0)>0&&this.colCount(!0)>0}},{key:"isValidRefInSheet",value:function(e){return null!=this._sheet&&this.rowFrom()>=0&&this.colFrom()>=0&&this.rowCount(e)>0&&this.colCount(e)>0}},{key:"isValidBoundaryInsideSheet",value:function(){if(null==this._sheet)return!1;var e=this.rowFrom(),t=this.rowCount(!0),r=this.colFrom(),n=this.colCount(!0),a=this._sheet.getRowCount(),o=this._sheet.getColumnCount();return e>=0&&e<a&&r>=0&&r<o&&t>0&&e+t<=a&&n>0&&r+n<=o}},{key:"isValid",value:function(){return this.isValidRefInSheet(!0)}},{key:"onOp",value:function(e){if(!this.isFrozen){if("DelRowOp"===e.instanceType)return e.onOp(this),void this.updateRefInterval();if("MoveRangeOP"!==e.instanceType)if("DelSheetOp"!==e.instanceType){if(e.isRowType()){var t=Po([this.rowFrom(),this.rowCount(!0)],e),r=(0,g.Z)(t,2),n=r[0],a=r[1];this.setRowFrom(n),this.setRowCount(a)}else{var o=Po([this.colFrom(),this.colCount(!0)],e),i=(0,g.Z)(o,2),u=i[0],s=i[1];this.setColFrom(u),this.setColCount(s)}this.updateRefInterval()}else this.sheet()===e.getSheet()&&(this.hostName=this._sheet.name(),this._sheet=null,this.afterSheetChanged&&this.afterSheetChanged(this._sheet));else{var l=Gi(this,e.srcRange(),e.targetRange(),e.toEdgeAdjust);l&&(this.startRow=l.startRow,this.startCol=l.startCol,this.endRow=l.endRow,this.endCol=l.endCol,this.hostId=l.hostId,this.hostName=l.hostName,this.setSheet(l.sheet()))}}}},{key:"effectedHashIter",value:function(){return new Bi(this)}},{key:"transpose",value:function(){var e=this.colCount(!0),t=this.rowCount(!0);return this.setRowCount(e),this.setColCount(t),this}},{key:"getTransposed",value:function(){var e=this.clone();return e.transpose(),e}},{key:"toJSON",value:function(){return{row:this.rowFrom(),col:this.colFrom(),rowCount:this.rowCount(),colCount:this.colCount()}}},{key:"unionRow",value:function(e){var t=Math.min(this.rowFrom(),e.rowFrom());return[t,Math.max(this.rowEnd(),e.rowEnd())-t]}},{key:"unionCol",value:function(e){var t=Math.min(this.colFrom(),e.colFrom());return[t,Math.max(this.colEnd(),e.colEnd())-t]}},{key:"isUnionable",value:function(e){if(this._sheet!==e._sheet)return!1;if(!e.isValid()||!this.isValid())return!1;var t=this.size()+e.size(),r=Math.min(this.rowFrom(),e.rowFrom()),n=Math.min(this.colFrom(),e.colFrom()),a=Math.max(this.rowEnd(!0),e.rowEnd(!0));return t>=(Math.max(this.colEnd(!0),e.colEnd(!0))-n)*(a-r)>>1}},{key:"type",value:function(){return Ce.xj7[this.rgType]}},{key:"namespace",value:function(){return this.customNamespace||""}},{key:"setNamespace",value:function(e){this.customNamespace=e}},{key:"parentRef",value:function(){return null}},{key:"getCustomData",value:function(e){var t=this.sheet();if(!t||!this.isValid())return null;var r=this.rowFrom(),n=this.colFrom(),a=t.getActualFormatter(r,n,e)||null,o=a?a.getFormatCode():"";return{autoFormat:"General"===o?"":o}}},{key:"nth",value:function(e){if(e>=this.size()||e<0||null==this._sheet)return it.REF_ERR_VAR;var t=this.colCount();if(t<=0)return it.REF_ERR_VAR;var r=e/t,n=e%t,a=this.rowFrom(),o=this.colFrom();return this._sheet.getVar(a+r,o+n)}},{key:"updateRefInterval",value:function(){this.startRow=this.rowFrom(),this.startCol=this.colFrom()}},{key:"isAsync",value:function(){return!1}},{key:"isRef",value:function(){return!0}},{key:"isError",value:function(){return!1}},{key:"toGridJSON",value:function(e){var r=(0,f.Z)((0,v.Z)(t.prototype),"toGridJSON",this).call(this,e);return e&&(r.sheetName=this.sheetName),r}},{key:"toSheetBoundRange",value:function(){var e=this.toGridRange();return e.endRow=this.rowEnd(),e.endCol=this.colEnd(),e}},{key:"sheetName",get:function(){return null==this._sheet?this.hostName:this._sheet.name()},set:function(e){null==this._sheet&&(this.hostName=null==e?void 0:e)}}],[{key:"fromGridRange",value:function(e){throw new Error("Not implemented")}},{key:"fromGridJSON",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this.fromGridRange(Vi(e),t)}}]),t}(Qi);function tu(e,t){return bi(e.toSheetBoundRange(),t).map((function(t){return ou.fromGridRange(t,e.sheet())}))}eu.sheetHashMap=new Map;var ru,nu=function(e){function t(e,r,n){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,0,Fo,e,e+r,n))).rgType=Ce.xj7.COL,a.setRefStatus(o),a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setRefStatus",value:function(e){this.status=di(e,12)}},{key:"offset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return 0!==e||n>0?ou.prototype.offset.call(this,e,r,n,a):new t(this.colFrom()+r,a<=0?this.colCount(!0):a,this._sheet)}},{key:"rowFrom",value:function(){return 0}},{key:"rowEnd",value:function(){return(0,f.Z)((0,v.Z)(t.prototype),"rowEnd",this).call(this,!1)}},{key:"intersect",value:function(e){if(this._sheet!==e.sheet())return null;if(e.rgType===Ce.xj7.ALL)return e;var r=this.intersectRow(e);if(null!==r){var n=this.intersectCol(e);if(null!==n)return $o(r,this.rowInterval())?new t(n[0],n[1],this._sheet):new ou(r[0],n[0],r[1],n[1],this._sheet)}return null}},{key:"union",value:function(e){this._sheet!==e.sheet()&&console.error("cant union two range in different worksheet");var r=this.unionCol(e);return new t(r[0],r[1],this._sheet)}},{key:"clone",value:function(){var e=t.fromGridRange(this.toGridRange(),this._sheet);return this._sheet||(e.sheetName=this.sheetName),e}},{key:"canDecompile",value:function(){return this.colFrom()>=0&&this.colCount(!0)>0}},{key:"hashIter",value:function(){return new Hi(this)}},{key:"toString",value:function(e){return this.canDecompile()?"".concat(this.sheetNameToString(e)).concat(this.colFromToString(e),":").concat(this.colToToString(e)):it.REF_ERR_VAR.getValue()}},{key:"setRowFrom",value:function(e){console.warn("ColumnRange.setRowFrom not effect, row:",e)}},{key:"setRowCount",value:function(e){console.warn("ColumnRange.setRowCount not effect, rowCount:",e)}},{key:"sub",value:function(e){for(var r=tu(this,e),n=0;n<r.length;n++){var a=r[n];a.rowFrom()===this.rowFrom()&&a.rowCount()===this.rowCount()&&(r[n]=new t(a.colFrom(),a.colCount(),this.sheet()))}return r}},{key:"id",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t="";if(e){var r=this.sheet();if(null==r)throw new Error("sheet is null");t+=r.id()+","}return"".concat(t).concat(Ce.xj7.COL,",").concat(this.colFrom(),",").concat(this.colCount())}}],[{key:"fromGridRange",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new t(e.startCol,e.endCol-e.startCol,r,vi(e.status));return n.sheetName=e.hostName,n}}]),t}(eu),au=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,0,Fo,0,Fo,e))).rgType=Ce.xj7.ALL,r.setRefStatus(n),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"onOp",value:function(e){}},{key:"offset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=e||r>0,o=t||n>0;return a&&o?ou.prototype.offset.call(this,e,t,r,n):o?nu.prototype.offset.call(this,e,t,r,n):a?iu.prototype.offset.call(this,e,t,r,n):this.clone()}},{key:"rowEnd",value:function(){return(0,f.Z)((0,v.Z)(t.prototype),"rowEnd",this).call(this,!1)}},{key:"colEnd",value:function(){return(0,f.Z)((0,v.Z)(t.prototype),"colEnd",this).call(this,!1)}},{key:"intersect",value:function(e){return e.sheet()!==this._sheet?null:e.clone()}},{key:"union",value:function(e){return this._sheet!==e.sheet()&&console.error("cant union two range in different worksheet"),this.clone()}},{key:"hashIter",value:function(){return new Ui(this)}},{key:"toString",value:function(e){return this.canDecompile()?"".concat(this.sheetNameToString(e)).concat(this.rowFromToString(e),":").concat(this.rowToToString(e)):it.REF_ERR_VAR.getValue()}},{key:"clone",value:function(){return new t(this._sheet,this.refStatus())}},{key:"setRowFrom",value:function(e){console.warn("AllRange.setRowFrom not effect")}},{key:"setRowCount",value:function(e){console.warn("AllRange.setRowCount not effect")}},{key:"setColFrom",value:function(e){console.warn("AllRange.setColFrom not effect")}},{key:"setColCount",value:function(e){console.warn("AllRange.setColCount not effect")}},{key:"sub",value:function(e){for(var t=tu(this,e),r=0;r<t.length;r++){var n=t[r];n.colFrom()===this.colFrom()&&n.colCount()===this.colCount()&&(t[r]=new iu(n.rowFrom(),n.rowCount(),this._sheet)),n.rowFrom()===this.rowFrom()&&n.rowCount()===this.rowCount()&&(t[r]=new nu(n.colFrom(),n.colCount(),this.sheet()))}return t}},{key:"setRefStatus",value:function(e){this.status=di(e,15)}},{key:"id",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t="";if(e){var r=this.sheet();if(null==r)throw new Error("sheet is null");t+=r.id()+","}return"".concat(t).concat(Ce.xj7.ALL)}}]),t}(eu),ou=function(e){function t(e,r,n,a,o){var i,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this,e,e+n,r,r+a,o))).rgType=Ce.xj7.NORMAL,i.setRefStatus(u),i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"intersect",value:function(e){if(this._sheet!==e.sheet())return null;if(e.rgType===Ce.xj7.ALL)return e;var r=this.intersectRow(e);if(null!==r){var n=this.intersectCol(e);if(null!==n)return new t(r[0],n[0],r[1],n[1],this._sheet)}return null}},{key:"union",value:function(e){this._sheet!==e.sheet()&&console.error("cant union two range in different worksheet");var r=this.unionRow(e),n=this.unionCol(e);return new t(r[0],n[0],r[1],n[1],this._sheet)}},{key:"hashIter",value:function(){return new Hi(this)}},{key:"offset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=this.rowInterval(),i=this.colInterval();return new t(o[0]+e,i[0]+r,n<=0?o[1]:n,a<=0?i[1]:a,this._sheet)}},{key:"clone",value:function(){var e=t.fromGridRange(this.toGridRange(),this._sheet);return this._sheet||(e.sheetName=this.sheetName),e}},{key:"toString",value:function(e){if(!this.canDecompile())return it.REF_ERR_VAR.getValue();var t=this.sheetNameToString(e),r=this.rowFromToString(e),n=this.colFromToString(e),a=this.rowToToString(e),o=this.colToToString(e),i=n===o&&r===a;return e&&"R1C1"===e.refStyle?"".concat(t).concat(r).concat(n).concat(i?"":":".concat(a).concat(o)):"".concat(t).concat(n).concat(r).concat(i?"":":".concat(o).concat(a))}},{key:"toSimpleObj",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.withoutCheck,r=void 0!==t&&t;return Object.assign({type:Ce.xj7.NORMAL},this.toJSON(r))}},{key:"toJSON",value:function(e){return e?{row:this.rowFrom(),col:this.colFrom(),rowCount:this.rowCount(!0),colCount:this.colCount(!0)}:(0,f.Z)((0,v.Z)(t.prototype),"toJSON",this).call(this)}},{key:"toNormalRange",value:function(){return{row:this.rowFrom(),col:this.colFrom(),row_count:this.rowCount(),col_count:this.colCount()}}},{key:"sub",value:function(e){return tu(this,e)}},{key:"setRefStatus",value:function(e){this.status=di(e,0)}},{key:"splitByRow",value:function(){for(var e=this.rowFrom(),r=this.rowTo(),n=this.colFrom(),a=this.colCount(),o=[],i=e;i<=r;i++){var u=new t(i,n,1,a,this._sheet);o.push(u)}return o}},{key:"id",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t="";if(e){var r=this.sheet();if(null==r)throw new Error("sheet is null");t+=r.id()+","}return"".concat(t).concat(Ce.xj7.NORMAL,",").concat(this.rowFrom(),",").concat(this.colFrom(),",").concat(this.rowCount(),",").concat(this.colCount())}}],[{key:"toNormalRange",value:function(e){return new t(e.rowFrom(),e.colFrom(),e.rowCount(),e.colCount(),e.sheet())}},{key:"fromJSON",value:function(e,r,n){switch(r){case Ce.xj7.ROW:return new iu(e.row,e.rowCount,n);case Ce.xj7.COL:return new nu(e.col,e.colCount,n);case Ce.xj7.ALL:return new au(n);default:return new t(e.row,e.col,e.rowCount,e.colCount,n)}}},{key:"fromGridRange",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new t(e.startRow,e.startCol,e.endRow-e.startRow,e.endCol-e.startCol,r,vi(e.status));return n.sheetName=e.hostName,n}}]),t}(eu),iu=function(e){function t(e,r,n){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,e,e+r,0,Fo,n))).rgType=Ce.xj7.ROW,a.setRefStatus(o),a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setRefStatus",value:function(e){this.status=di(e,3)}},{key:"offset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return 0!==r||a>0?ou.prototype.offset.call(this,e,r,n,a):new t(this.rowFrom()+e,n<=0?this.rowCount(!0):n,this._sheet)}},{key:"colFrom",value:function(){return 0}},{key:"colEnd",value:function(){return(0,f.Z)((0,v.Z)(t.prototype),"colEnd",this).call(this,!1)}},{key:"intersect",value:function(e){if(this._sheet!==e.sheet())return null;if(e.rgType===Ce.xj7.ALL)return e;var r=this.intersectCol(e);if(null!==r){var n=this.intersectRow(e);if(null!==n)return $o(r,this.colInterval())?new t(n[0],n[1],this._sheet):new ou(n[0],r[0],n[1],r[1],this._sheet)}return null}},{key:"union",value:function(e){this._sheet!==e.sheet()&&console.error("cant union two range in different worksheet");var r=this.unionRow(e);return new t(r[0],r[1],this._sheet)}},{key:"hashIter",value:function(){return new Hi(this)}},{key:"toString",value:function(e){return this.canDecompile()?"".concat(this.sheetNameToString(e)).concat(this.rowFromToString(e),":").concat(this.rowToToString(e)):it.REF_ERR_VAR.getValue()}},{key:"clone",value:function(){var e=t.fromGridRange(this.toGridRange(),this._sheet);return this._sheet||(e.sheetName=this.sheetName),e}},{key:"canDecompile",value:function(){return this.rowFrom()>=0&&this.rowCount(!0)>0}},{key:"setColFrom",value:function(e){console.warn("RowRange.setColFrom not effect")}},{key:"setColCount",value:function(e){console.warn("RowRange.setColCount not effect, colCount")}},{key:"sub",value:function(e){for(var r=function(e,t){return Mi(e.toSheetBoundRange(),t).map((function(t){return ou.fromGridRange(t,e.sheet())}))}(this,e),n=0;n<r.length;n++){var a=r[n];a.colFrom()===this.colFrom()&&a.colCount()===this.colCount()&&(r[n]=new t(a.rowFrom(),a.rowCount(),this._sheet))}return r}},{key:"id",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t="";if(e){var r=this.sheet();if(null==r)throw new Error("sheet is null");t+=r.id()+","}return"".concat(t).concat(Ce.xj7.ROW,",").concat(this.rowFrom(),",").concat(this.rowCount())}}],[{key:"fromGridRange",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new t(e.startRow,e.endRow-e.startRow,r,vi(e.status));return n.sheetName=e.hostName,n}}]),t}(eu),uu=function(e){function t(e,r,n){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r,1,1,n,o))).rgType=Ce.xj7.CELL,a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"rowCount",value:function(){return(0,f.Z)((0,v.Z)(t.prototype),"rowCount",this).call(this,!0)}},{key:"colCount",value:function(){return(0,f.Z)((0,v.Z)(t.prototype),"colCount",this).call(this,!0)}},{key:"isValidRefInSheet",value:function(){return null!=this._sheet&&this.rowFrom()>=0&&this.colFrom()>=0&&1===this.rowCount()&&1===this.colCount()}},{key:"clone",value:function(){var e=t.fromGridRange(this.toGridRange(),this._sheet);return this._sheet||(e.sheetName=this.sheetName),e}},{key:"toString",value:function(e){return this.canDecompile()?e&&"R1C1"===e.refStyle?"".concat(this.sheetNameToString(e)).concat(this.rowFromToString(e)).concat(this.colFromToString(e)):"".concat(this.sheetNameToString(e)).concat(this.colFromToString(e)).concat(this.rowFromToString(e)):it.REF_ERR_VAR.getValue()}},{key:"id",value:function(){var e=this.sheet();if(null==e)throw new Error("sheet is null");return"".concat(e.id(),",").concat(Ce.xj7.CELL,",").concat(this.rowFrom(),",").concat(this.colFrom())}}],[{key:"fromGridRange",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=new t(e.startRow,e.startCol,r,vi(e.status));return n.sheetName=e.hostName,n}}]),t}(ou);function su(e,t,r,n){for(var a=0,o=e.length-1;a<=o;){var i=a+o>>1,u=r(t,e[i]);if(u>0)a=i+1;else{if(!(u<0))return i;o=i-1}}return n&&e.length>0?a<o?a:o:-1}!function(e){e.MoveRangeOp="MoveRangeOp",e.DelSheetOp="DelSheetOp"}(ru||(ru={}));var lu=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).isValidRef=e.isValid(),e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"rowInterval",value:function(e){return(0,f.Z)((0,v.Z)(t.prototype),"rowInterval",this).call(this,!0)}},{key:"isIntersect",value:function(e){return this._sheet===e.sheet()&&!!this.isValidRef&&(e.rgType===Ce.xj7.ALL||e.rgType===Ce.xj7.COL||this.rowFrom()<=e.rowTo(!0))}}]),t}(iu),cu=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).isValidRef=e.isValid(),e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"colInterval",value:function(e){return(0,f.Z)((0,v.Z)(t.prototype),"colInterval",this).call(this,!0)}},{key:"isIntersect",value:function(e){return this._sheet===e.sheet()&&!!this.isValidRef&&(e.rgType===Ce.xj7.ALL||e.rgType===Ce.xj7.ROW||this.colFrom()<=e.colTo(!0))}}]),t}(nu);function hu(e,t){return e<t.target?-1:e>t.target+t.count-1?1:0}var fu=function(){function e(t,r){(0,y.Z)(this,e),this.sheet=r,this.instanceType="DelRowOp";var n=0;this.ranges=t.map((function(e){var t=e.target,r=e.count;return{target:t,count:r,total:n+=r}}))}return(0,_.Z)(e,[{key:"effectedRef",value:function(){return[new lu(this.ranges[0].target,1/0,this.sheet)]}},{key:"type",value:function(){return"delete"}},{key:"isRowType",value:function(){return!0}},{key:"onOp",value:function(e){var t,r,n=e.rowFrom(),a=e.rowTo(!0)+1,o=su(this.ranges,n,hu,!0),i=su(this.ranges,a,hu,!0),u=this.ranges[o],s=this.ranges[i];u&&(n>u.target+u.count-1?n-=u.total:n=u.target-((null===(t=this.ranges[o-1])||void 0===t?void 0:t.total)||0)),s&&(a>s.target+s.count-1?a-=s.total:a=s.target-((null===(r=this.ranges[i-1])||void 0===r?void 0:r.total)||0)),e.setRowFrom(n),e.setRowCount(a-n)}}]),e}(),du=function(){function e(t,r,n){(0,y.Z)(this,e),this._type=t,this._start=r,this._size=n}return(0,_.Z)(e,[{key:"type",value:function(){return this._type}}]),(0,_.Z)(e,[{key:"segOpType",value:function(){return this._type}},{key:"effectedRef",value:function(){throw new Error("should never be call")}},{key:"from",value:function(){return this._start}},{key:"size",value:function(){return this._size}},{key:"to",value:function(){return this._start+this._size-1}}]),e}(),vu=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this,r,n,a)))._isRow=e,i._sheet=o,i.instanceType="RowColOp",i.ranges=[{target:n,count:a,total:a}],i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"isRowType",value:function(){return this._isRow}},{key:"effectedRef",value:function(){return this._isRow?[new lu(this.from(),1/0,this._sheet)]:[new cu(this.from(),1/0,this._sheet)]}}]),t}(du),pu=function(){function e(t,r,n,a){(0,y.Z)(this,e),this._src=t,this._toSheet=r,this._toRow=n,this._toCol=a,this.instanceType="MoveRangeOP",this.toEdgeAdjust=!1}return(0,_.Z)(e,[{key:"type",value:function(){return"MoveRangeOp"}}]),(0,_.Z)(e,[{key:"setShouldAdjustToEdge",value:function(e){this.toEdgeAdjust=e}},{key:"effectedRef",value:function(){var e=this._src.clone(),t=this.targetRange();return 0===e.colCount(!0)&&0===t.colCount(!0)&&e.rowFrom()===t.rowFrom()||0===e.rowCount(!0)&&0===t.rowCount(!0)&&e.colFrom()===t.colFrom()?[e.union(t)]:[this._src.clone(),this.targetRange()]}},{key:"srcRange",value:function(){return this._src}},{key:"targetRange",value:function(){var e=this._toSheet,t=Math.min(this._toRow+this._src.rowCount(),e.getRowCount()),r=Math.max(this._toRow,0),n=Math.min(this._toCol+this._src.colCount(),e.getColumnCount()),a=Math.max(this._toCol,0);return new ou(r,a,t-r,n-a,e)}}]),e}(),mu=function(){function e(t){(0,y.Z)(this,e),this.sheet=t,this.instanceType="DelSheetOp"}return(0,_.Z)(e,[{key:"type",value:function(){return"DelSheetOp"}}]),(0,_.Z)(e,[{key:"effectedRef",value:function(){return[new au(this.sheet)]}},{key:"getSheet",value:function(){return this.sheet}}]),e}();function gu(e,t){var r={type:e.rgType};if(e.rgType===Ce.xj7.ALL)return r;var n=e.rgType===Ce.xj7.CELL;return e.rgType!==Ce.xj7.ROW&&(r.col=e.colFrom(),r.colCount=n?1:e.colCount(t)),e.rgType!==Ce.xj7.COL&&(r.row=e.rowFrom(),r.rowCount=n?1:e.rowCount(t)),r}function yu(e,t){var r={type:t};return t===Ce.xj7.ALL||(t!==Ce.xj7.ROW&&(r.col=e.startCol,r.colCount=ai(e)),t!==Ce.xj7.COL&&(r.row=e.startRow,r.rowCount=ni(e))),r}var _u=function(e){return e.rgType===Ce.xj7.ROW},Ru=function(e){return e.rgType===Ce.xj7.COL},Cu=function(e){return e.rgType===Ce.xj7.ALL};function wu(e){return e instanceof eu}function Eu(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(e.isRow()?iu:e.isCol()?nu:ou).fromGridRange(e,t)}function ku(e,t){return Eu(Qi.fromGridRange(Ei(t,e)),e.sheet())}function Tu(e,t,r){return Eu(Qi.fromGridRange(ki(t,e,r)),e.sheet())}var Su,Au,Iu,Ou=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];(0,y.Z)(this,e),this._sheet=r,this._ranges=n?t:t.map((function(e){switch(e.type){case Ce.xj7.ROW:return new iu(e.row,e.rowCount,r);case Ce.xj7.COL:return new nu(e.col,e.colCount,r);case Ce.xj7.ALL:return new au(r);case Ce.xj7.CELL:return new uu(e.row,e.col,r);case Ce.xj7.NORMAL:default:return new ou(e.row,e.col,e.rowCount,e.colCount,r)}}))}return(0,_.Z)(e,[{key:"intersect",value:function(e){var t=[];return this.iter((function(r){var n=r.intersect(e);n&&t.push(n)})),t.length?t:null}},{key:"isIntersect",value:function(e){var t=this;return Array.isArray(e)?e.some((function(e){return t.isIntersect(e)})):this._ranges.some((function(t){return t.isIntersect(e)}))}},{key:"sub",value:function(e){var t=[];return this._ranges.forEach((function(r){var n=r.sub(e);(0,Ce.hTd)(t,n)})),t}},{key:"subRanges",value:function(t){var r=this,n=this;return t.forEach((function(t){var a=n.sub(t);n=new e(a,r._sheet,!0)})),n.getRanges()}},{key:"containCell",value:function(e,t){return this._ranges.some((function(r){return r.containCell(e,t)}))}},{key:"toString",value:function(e){return this.mapIfValid((function(t){return t.toString(e)})).join(",")}},{key:"mapIfValid",value:function(e){return this._ranges.filter((function(e){return e.isValidRefInSheet()})).map(e)}},{key:"isValid",value:function(){return this._ranges.every((function(e){return e.isValidRefInSheet()}))}},{key:"toJSON",value:function(){return this.mapIfValid((function(e){return e.toJSON()}))}},{key:"toTypedRanges",value:function(){return this.mapIfValid((function(e){return gu(e)}))}},{key:"getRanges",value:function(){return this._ranges}},{key:"getRange",value:function(e){return this._ranges[e]}},{key:"iter",value:function(e){return this._ranges.forEach(e)}},{key:"insert",value:function(e){this._ranges.push(e)}},{key:"size",value:function(){return this._ranges.length}},{key:"sheet",value:function(){return this._sheet}}]),e}();function Vu(e,t,r,n){var a,o=arguments.length,i=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==("undefined"==typeof Reflect?"undefined":(0,R.Z)(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,r,n);else for(var u=e.length-1;u>=0;u--)(a=e[u])&&(i=(o<3?a(i):o>3?a(t,r,i):a(t,r))||i);return o>3&&i&&Object.defineProperty(t,r,i),i}function Nu(e,t){return function(r,n){t(r,n,e)}}function bu(e){var t=(0,g.Z)(e,2),r=t[0],n=t[1];return!(r<0||n<=0||r>r+n)}function Mu(e,t){var r=(0,g.Z)(e,2),n=r[0],a=r[1],o=(0,g.Z)(t,2),i=o[0],u=o[1],s=n+a,l=i+u;return n===i&&a===u?Iu.Equal:n===l||s===i?Iu.EmptyButPoint:n<=i&&s>=l?Iu.Include:n>=i&&s<=l?Iu.BeIncluded:n>=i&&n<=l||i>=n&&i<=s?Iu.IntersectedNotInlcude:Iu.Empty}function Fu(e,t){var r=(0,g.Z)(e,2),n=r[0],a=r[1],o=(0,g.Z)(t,2),i=o[0],u=n+a-1,s=i+o[1]-1,l=Math.max(n,i),c=Math.min(u,s);return n===l?[[c+1,u-c]]:u===c?[[n,l-n]]:[[n,l-n],[c+1,Math.max(u,s)-c]]}function Zu(e,t){var r=(0,g.Z)(e,2),n=r[0],a=r[1],o=(0,g.Z)(t,2),i=o[0],u=o[1],s=Math.max(n,i);return[s,Math.min(n+a,i+u)-s]}function xu(e,t){return e===Ce.xj7.ROW?{type:Ce.xj7.ROW,row:t[0],rowCount:t[1]}:{type:Ce.xj7.COL,col:t[0],colCount:t[1]}}function Du(e){return e.type===Ce.xj7.ROW?[e.row,e.rowCount]:[e.col,e.colCount]}"function"==typeof SuppressedError&&SuppressedError,function(e){e[e.One=1]="One",e[e.Two=2]="Two",e[e.Three=3]="Three",e[e.Four=4]="Four",e[e.Five=5]="Five",e[e.Six=6]="Six",e[e.Seven=7]="Seven"}(Su||(Su={})),function(e){e[e.Expand=0]="Expand",e[e.Fold=1]="Fold"}(Au||(Au={})),function(e){e[e.Empty=0]="Empty",e[e.Equal=1]="Equal",e[e.Include=2]="Include",e[e.BeIncluded=3]="BeIncluded",e[e.EmptyButPoint=4]="EmptyButPoint",e[e.IntersectedNotInlcude=5]="IntersectedNotInlcude"}(Iu||(Iu={}));var Pu=function(e,t,r){return r?{type:Ce.xj7.ROW,row:e,rowCount:t}:{type:Ce.xj7.COL,col:e,colCount:t}};function $u(e,t){var r=[],n=Du(t),a=n[0],o=n[1];if(0===e.length)return[[a,o]];var i=a+o,u=[];e.forEach((function(e){u.push(e.start,e.start+e.count)})),u.push(a,a+o),u=(0,ge.Z)(u).sort((function(e,t){return e-t}));for(var s=0;s<u.length;s++){var l=u[s];if(i===l)return r.push([a,i-a]),r;if(a<l&&i>l)r.push([a,l-a]),a=l;else if(i<l)return r.push([a,i-a]),r}return r}function Lu(e){for(var t=e.sort((function(e,t){return e.start!==t.start?e.start-t.start:t.count-e.count})),r=0;r<t.length;r++){var n=t[r];bu([n.start,n.count])||(n.tag=1);for(var a=r+1;a<t.length;a++){var o=t[a];1!==o.tag&&1!==n.tag&&n.start+n.count===o.start&&(n.count+=o.count,n.state=Ce.w2y.Expand,o.tag=1)}}for(var i=t.length-1;i>=0;i--)1===t[i].tag&&t.splice(i,1);return t}function Bu(e){e.sort((function(e,t){return e.start!==t.start?e.start-t.start:t.count-e.count})),e.forEach((function(e){return e.level=Su.One}));for(var t=0,r=1;t<e.length;){var n=e[t],a=e[r];a&&Hu(n,a)?(a.level!==n.level+1&&(a.level=n.level+1),n.state===Ce.w2y.Fold&&(a.visible=!1),r++):r=++t+1}return e}function Uu(e,t,r){t.forEach((function(t){var n=t.start,a=t.count,o=t.state;e.forEach((function(e){e.start===n&&e.count===a&&(e.state=o),r&&e.start===r[0]&&e.count===r[1]&&(e.state=r[2])}))}))}function Hu(e,t){var r=e.start,n=e.count,a=t.start,o=t.count;return r<=a&&r+n>=a+o}function zu(e,t){var r=e.start,n=e.count,a=t.start,o=t.count;return r===a&&n===o}var Wu=function(){function e(){(0,y.Z)(this,e),this._rowOutlines$=new ft.X([]),this._colOutlines$=new ft.X([]),this._hiddenSetChangedVersion$=new ft.X(0),this.colCollapsedStartSet=new Set,this.rowCollapsedStartSet=new Set,this._rowHiddenSet$=new ft.X(new Set),this._colHiddenSet$=new ft.X(new Set),this.rowOutlines$=this._rowOutlines$.asObservable(),this.colOutlines$=this._colOutlines$.asObservable(),this.hiddenSetChangedVersion$=this._hiddenSetChangedVersion$.asObservable()}return(0,_.Z)(e,[{key:"toJSON",value:function(){var e=[];return this.rowOutlineTree.forEach((function(t){var r=t.state,n=t.start,a=t.count;e.push({state:r,target:{type:Ce.xj7.ROW,row:n,rowCount:a}})})),this.colOutlineTree.forEach((function(t){var r=t.state,n=t.start,a=t.count;e.push({state:r,target:{type:Ce.xj7.COL,col:n,colCount:a}})})),e}},{key:"fromJSON",value:function(e){var t,r=yr(e);try{for(r.s();!(t=r.n()).done;){var n=t.value,a=n.state,o=n.target,i=this.buildOutlineNode(a,o);if(!i)return;o.type===Ce.xj7.ROW?this.rowOutlineTree.push(i):this.colOutlineTree.push(i)}}catch(e){r.e(e)}finally{r.f()}Bu(this.rowOutlineTree),Bu(this.colOutlineTree),this.refresh(Ce.xj7.ROW),this.refresh(Ce.xj7.COL)}},{key:"serialize",value:function(e,t){function r(t){var r=t.state,n=t.start,a=t.count;e.push({info:{collapsed:r===Au.Fold},range:{start:n,end:n+a}})}t?this.rowOutlineTree.forEach(r):this.colOutlineTree.forEach(r)}},{key:"deserialize",value:function(e,t){if(0!==e.length){for(var r=!1,n=0,a=e.length;n<a;n++){var o=e[n],i=o.info,u=o.range;i&&void 0!==i.collapsed&&u&&(r=!0,t?this.rowOutlineTree.push({type:Ce.xj7.ROW,start:u.start,count:u.end-u.start,level:Su.One,state:i.collapsed?Au.Fold:Au.Expand,visible:!0}):this.colOutlineTree.push({type:Ce.xj7.COL,start:u.start,count:u.end-u.start,level:Su.One,state:i.collapsed?Au.Fold:Au.Expand,visible:!0}))}r&&(Bu(this.rowOutlineTree),Bu(this.colOutlineTree),this.refresh(Ce.xj7.ROW),this.refresh(Ce.xj7.COL))}}},{key:"getAllStartPointsOfFoldLines",value:function(e){return e===Ce.xj7.ROW?this.rowCollapsedStartSet:this.colCollapsedStartSet}},{key:"isRowColHidden",value:function(e,t){return e===Ce.xj7.ROW?this.rowHiddenSet.has(t):this.colHiddenSet.has(t)}},{key:"getEntireMatchOutlines",value:function(e){var t=e.type===Ce.xj7.ROW?this.rowOutlineTree:this.colOutlineTree,r=Du(e),n=(0,g.Z)(r,2),a=n[0],o=n[1];return t.filter((function(e){return e.start===a&&e.count===o}))}},{key:"getInfluencedOutlines",value:function(e){var t=e.type===Ce.xj7.ROW?this.rowOutlineTree:this.colOutlineTree,r=Du(e);return t.filter((function(e){var t=[e.start,e.count],n=Mu(r,t);return!(n===Iu.Empty||n===Iu.EmptyButPoint)}))}},{key:"getBeInludedOutlines",value:function(e){var t=e.type===Ce.xj7.ROW?this.rowOutlineTree:this.colOutlineTree,r=Du(e),n=(0,g.Z)(r,2),a=n[0],o=n[1],i=a+o;return t.filter((function(e){return e.start>=a&&e.start+e.count<=i}))}},{key:"getBehindOutlines",value:function(e,t){return(e===Ce.xj7.ROW?this.rowOutlineTree:this.colOutlineTree).filter((function(e){return e.start>=t}))}},{key:"addRange",value:function(e,t){var r=this,n=e.type,a=Du(e),o=(0,g.Z)(a,2),i=o[0],u=o[1],s=n===Ce.xj7.ROW?this.rowOutlineTree:this.colOutlineTree,l=this.getInfluencedOutlines(e),c=ga(l);$u(l,e).map((function(e){r.addOutline(xu(n,e),t)})),Lu(s),Bu(s),Uu(s,c,[i,u,t]),this.refresh(n)}},{key:"cancelRange",value:function(e){for(var t=e.type,r=t===Ce.xj7.ROW?this.rowOutlineTree:this.colOutlineTree,n=this.getInfluencedOutlines(e),a=ga(r),o=$u(n,e),i=0;i<o.length;i++){var u=o[i],s=this.getInfluencedOutlines(xu(t,u)).sort((function(e,t){return e.count-t.count}));if(0!==s.length){var l=s[0],c=l.start,h=l.count,f=l.state;if(c===u[0]&&h===u[1])this.deleteOutline(l);else{var d=Fu([c,h],u);this.deleteOutline(l),this.addOutline(xu(t,d[0]),f),d[1]&&this.addOutline(xu(t,d[1]),f)}}}Lu(r),Bu(r),Uu(r,a),this.refresh(t)}},{key:"adjustOutlineAfterAddRowCol",value:function(e,t,r){var n=this,a=e===Ce.xj7.ROW?this.rowOutlineTree:this.colOutlineTree,o=this.getBehindOutlines(e,t);o.forEach((function(e){return e.start+=r}));var i=ga(o),u=this.getInfluencedOutlines(xu(e,[t-1,1])),s=ga(u);u.forEach((function(e){return n.deleteOutline(e)})),s.forEach((function(a){var o=a.state;(function(e,t){var r=Du(e),n=(0,g.Z)(r,2),a=n[0],o=n[1],i=a+o,u=t.start;return[[u,a-u],[i,u+t.count+o-i]].filter((function(e){return bu(e)}))})(xu(e,[t,r]),a).forEach((function(t){n.addOutline(xu(e,t),o)}))})),Lu(a),Bu(a),Uu(a,i),this.refresh(e)}},{key:"adjustOutlineAfterDelRowCol",value:function(e,t,r){var n=e===Ce.xj7.ROW?this.rowOutlineTree:this.colOutlineTree,a=t+r;this.getBehindOutlines(e,a).forEach((function(e){return e.start-=r})),Lu(n),Bu(n),this.refresh(e)}},{key:"updateOutline",value:function(e,t){var r=this.getEntireMatchOutlines(e);if(0===r.length)return!1;var n=r[0].type;return r.forEach((function(e){e.state=t})),this.refresh(n),!0}},{key:"addOutline",value:function(e,t){var r=this.buildOutlineNode(t,e),n=e.type;r&&(n===Ce.xj7.ROW?this.rowOutlineTree.push(r):this.colOutlineTree.push(r))}},{key:"deleteOutline",value:function(e){var t=e.type===Ce.xj7.ROW?this.rowOutlineTree:this.colOutlineTree;return-1!==t.indexOf(e)&&(t.splice(t.indexOf(e),1),!0)}},{key:"pushOutlinePipe",value:function(e){e===Ce.xj7.ROW?this._rowOutlines$.next(this.rowOutlineTree):this._colOutlines$.next(this.colOutlineTree)}},{key:"setVisibleAndHiddenSet",value:function(e){var t=e===Ce.xj7.ROW?this.rowOutlineTree:this.colOutlineTree;!function(e){for(var t=0,r=1;t<e.length;){var n=e[t];n.level===Su.One&&(n.visible=!0);var a=e[r];a&&Hu(n,a)?(n.state===Ce.w2y.Fold||!1===n.visible?a.visible=!1:a.visible=!0,zu(n,a)&&(a.visible=n.visible),r++):r=1+ ++t}}(t);var r=function(e){var t=new Set,r=new Set;return e.forEach((function(e){if(e.state===Ce.w2y.Fold){var n=e.start,a=n+e.count;r.add(n);for(var o=n;o<a;o++)t.add(o)}})),{hiddentSet:t,startSet:r}}(t);e===Ce.xj7.ROW?(this._rowHiddenSet$.next(r.hiddentSet),this.rowCollapsedStartSet=r.startSet):(this._colHiddenSet$.next(r.hiddentSet),this.colCollapsedStartSet=r.startSet),this._hiddenSetChangedVersion$.next(1^this.hiddenSetChangedVersion)}},{key:"buildOutlineNode",value:function(e,t){var r=t.type;if(r===Ce.xj7.ROW||r===Ce.xj7.COL)return r===Ce.xj7.ROW?{type:r,start:t.row,count:t.rowCount,level:Su.One,state:e,visible:!0}:{type:r,start:t.col,count:t.colCount,level:Su.One,state:e,visible:!0};console.error("[OUTLINE-GROUP]: ")}},{key:"refresh",value:function(e){this.setVisibleAndHiddenSet(e),this.pushOutlinePipe(e)}},{key:"clear",value:function(){this.rowCollapsedStartSet.clear(),this.colCollapsedStartSet.clear(),this.rowHiddenSet.clear(),this.colHiddenSet.clear(),this._rowOutlines$.next([]),this._colOutlines$.next([]),this._rowOutlines$.complete(),this._colOutlines$.complete(),this._hiddenSetChangedVersion$.complete()}},{key:"destroy",value:function(){this.clear()}},{key:"rowOutlineTree",get:function(){return this._rowOutlines$.getValue()}},{key:"colOutlineTree",get:function(){return this._colOutlines$.getValue()}},{key:"rowHiddenSet",get:function(){return this._rowHiddenSet$.getValue()}},{key:"colHiddenSet",get:function(){return this._colHiddenSet$.getValue()}},{key:"hiddenSetChangedVersion",get:function(){return this._hiddenSetChangedVersion$.getValue()}}]),e}();Vu([(0,ut.P)()],Wu.prototype,"destroy",null),Wu=Vu([(0,st.b)()],Wu);var Gu=function(){return!0};function ju(e){return e&&e.length>0?1===e.length?e[0]:function(t,r,n,a,o,i){for(var u=0;u<e.length;++u)if(!e[u](t,r,n,a,o,i))return!1;return!0}:Gu}var Yu=function(e,t,r,n,a,o){return!a||!!o&&o.filterModel.isVisible(a.startRow+t)},qu=function(e,t,r,n,a,o){return!a||!!o&&o.getRowVisible(a.startRow+t)},Ju=function(e){return!ja(e)},Ku=function(e,t,r,n,a,o){if(o){var i=o.getVar(a.startRow+t,a.startCol+r);if(i.isFormula()&&i.formula.hasAggregate)return!1}return!0},Xu=function(e,t,r,n,a,o){if(o){var i=o.getVar(a.startRow+t,a.startCol+r);if(i.isFormula()&&i.formula.hasSubtotal)return!1}return!0},Qu=function(e,t,r,n,a,o){return!a||!!o&&!o.inject(Wu).isRowColHidden(Ce.xj7.ROW,a.startRow+t)},es=function(e,t,r,n,a,o){return!a||!qa(e)};function ts(e,t){return(e=(0,it.varCheck)(e)).isPrimitive()||(e=(0,it.varCheck)(e.getVar(t))),e}var rs=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this)))._refs=e,n._ctx=r,n._value=null,n._rgIdx=-1,n._iter=null,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"nextRange",value:function(){return this._refs[++this._rgIdx]}},{key:"asyncNext",value:function(){var e=this.innerNext();if(null===e)return null;if(!e.isAsync())return e;if(e.isResolved())return e.getVar();throw e}},{key:"next",value:function(){return this.innerNext()}},{key:"innerNext",value:function(){if(null===this._iter){var e,t=this.nextRange();if(!t)return null;if(!t.isValidRefInSheet(!0))return this._iter=null,Ce.d$b[Ce.O6N.REF_INVALID_CELL_REFERENCE]({funcName:"",index:-1,value:""});this._sheet=t.sheet(),null!==(e=this._ctx)&&void 0!==e&&e.skipEmptyRef?this._iter=this._sheet._dataModel.orderedIterCell(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()):this._iter=new ns(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount())}for(var r=this._iter.next();null!==r;r=this._iter.next()){var n,a=void 0;if(null!==(n=this._ctx)&&void 0!==n&&n.skipEmptyRef){var o=this._iter.position();if((a=this._sheet._dataModel.getVarByContent(r,o.row,o.col)).isNull())continue}else{var i=this._iter.position();a=this._sheet.getVar(i.row,i.col)}return this._value=ts(a,this._ctx),this._value}return this._iter=null,this.next()}},{key:"value",value:function(){return this._value}},{key:"getCurrRow",value:function(){return this._iter?this._iter.position().row:-1}},{key:"getCurrCol",value:function(){return this._iter?this._iter.position().col:-1}}]),t}(_t.FIterator),ns=function(){function e(t,r,n,a){(0,y.Z)(this,e),this._colFrom=r,this.cellPosition={row:t,col:r-1},this._rowTo=t+n-1,this._colTo=r+a-1}return(0,_.Z)(e,[{key:"next",value:function(){if(this.cellPosition.col+=1,this.cellPosition.col>this._colTo){if(this.cellPosition.row+=1,this.cellPosition.row>this._rowTo)return null;this.cellPosition.col=this._colFrom}return!0}},{key:"position",value:function(){return this.cellPosition}}]),e}();var as,os=240;function is(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!e.canDecompile())return{type:Ce.xj7.INVALID};var n,a=e.sheet();return(n=1===r?yu(ki(t.ref,e),e.rgType):gu(e,!0)).type=r<<8|e.refStatus()<<4|(n.type||0),null!=a?(a===t.ref.sheet()||(n.sheetId=a.id()),n):null==e.sheetName?(console.error("Cannot convert range without sheet id or name to JSON"),{type:Ce.xj7.INVALID}):(n.sheetName=e.sheetName,n)}function us(e,t,r,n){var a,o,i=null;if(t===r.id()||!e&&!t)return r;if(t?i=n?n(t):r.getParent().getSheetFromId(t):e&&(i=null===(a=r.parent)||void 0===a||null===(o=a.getSheetFromName)||void 0===o?void 0:o.call(a,e)),i)return i;if(e)return null;throw new Error("Cannot deserialize range without id")}!function(e){e[e.Absolute=0]="Absolute",e[e.Relative=1]="Relative"}(as||(as={}));var ss=new ou(-1,-1,-1,-1,null);function ls(e,t,r,n){return null!=n&&n.isGridJSON?hs(e,t,r,n):function(e,t,r,n){var a=e.sheetId||null,o=e.sheetName||null,i=null;try{i=us(o,a,t,r)}catch(e){return new ou(0,0,0,0,null)}var u,s=cs(e,n),l=null==n?void 0:n.relativeRef,c=null==n?void 0:n.ref;switch(s.type){case Ce.xj7.INVALID:u=new ou(0,0,0,0,null);break;case Ce.xj7.ALL:u=new au(i);break;case Ce.xj7.ROW:u=new iu(s.row,s.rowCount,i,s.refStatus);break;case Ce.xj7.COL:u=new nu(s.col,s.colCount,i,s.refStatus);break;case Ce.xj7.CELL:u=new uu(s.row,s.col,i,s.refStatus);break;case Ce.xj7.NORMAL:u=new ou(s.row,s.col,s.rowCount,s.colCount,i,s.refStatus);break;default:throw new Error("unKnown ref bits ".concat(e.type))}if(l){if(!c)throw new Error("To deserialize to a relative Range, you should pass the reference position, namely ctx.ref, as a parameter.");u=s.type===Ce.xj7.INVALID?ss:Tu(u,c,(e.type&os)>>4)}return!u.hostId&&o?u.hostName=o:u.hostName=void 0,null!=n&&n.ref.isFrozen&&(u.isFrozen=!0),u}(e,t,r,n)}function cs(e,t){var r=e.type,n=15&r,a=(r&os)>>4,o=(3840&r)>>8,i=4&a,u=8&a,s=1&a,l=2&a;switch(n){case Ce.xj7.INVALID:return{type:Ce.xj7.INVALID};case Ce.xj7.ALL:return{type:Ce.xj7.ALL};case Ce.xj7.ROW:var c=e,h=c.row,f=c.rowCount;if(1===o&&null!=t&&null!=t.ref){var d,v=c.row,p=c.row+c.rowCount-1;i||(v+=t.ref.rowFrom()),u||(p+=t.ref.rowFrom()),v>p&&(i=(d=[u>>1,i<<1])[0],u=d[1]),h=Math.min(v,p),f=Math.abs(p-v)+1}return{type:Ce.xj7.ROW,row:h,rowCount:f,refStatus:i|u};case Ce.xj7.COL:var m=e,g=m.col,y=m.colCount;if(1===o&&null!=t&&null!=t.ref){var _,R=m.col,C=m.col+m.colCount-1;s||(R+=t.ref.colFrom()),l||(C+=t.ref.colFrom()),R>C&&(s=(_=[l>>1,s<<1])[0],l=_[1]),g=Math.min(C,R),y=Math.abs(C-R)+1}return{type:Ce.xj7.COL,col:g,colCount:y,refStatus:s|l};case Ce.xj7.CELL:case Ce.xj7.NORMAL:var w=e,E=w.row,k=w.col,T=w.rowCount,S=w.colCount;if(1===o&&null!=t&&null!=t.ref){var A,I,O=w.row,V=w.col,N=w.row+w.rowCount-1,b=w.col+w.colCount-1;i||(O+=t.ref.rowFrom()),u||(N+=t.ref.rowFrom()),s||(V+=t.ref.colFrom()),l||(b+=t.ref.colFrom()),O>N&&(i=(A=[u>>1,i<<1])[0],u=A[1]),V>b&&(s=(I=[l>>1,s<<1])[0],l=I[1]),E=Math.min(O,N),T=Math.abs(N-O)+1,k=Math.min(V,b),S=Math.abs(b-V)+1}return{type:n,row:E,col:k,rowCount:T,colCount:S,refStatus:i|u|s|l};default:throw new Error("unKnown ref bits ".concat(e.type))}}function hs(e,t,r,n){var a,o,i=e.sheetId||null,u=e.sheetName||null;try{var s;a=null!==(s=us(u,i,t,r))&&void 0!==s?s:void 0}catch(e){return new ou(0,0,0,0,null)}var l=mi(e.status||0),c=gi(e.status||0);return o=l&&c?new au(a):l?iu.fromGridJSON(e,a):c?nu.fromGridJSON(e,a):ou.fromGridJSON(e,a),u&&(o.sheetName=u),null!=n&&n.ref.isFrozen&&(o.isFrozen=!0),o}var fs=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e,r.customType="SheetImageVar",r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"toNumberVar",value:function(){return it.NULL_VAR}},{key:"toStringVar",value:function(){return it.NULL_VAR}},{key:"toBooleanVar",value:function(){return it.NULL_VAR}},{key:"toBooleanValue",value:function(){return!0}},{key:"toStringValue",value:function(){return""}},{key:"toNumberValue",value:function(){return 0}},{key:"getValue",value:function(){return this.value}}]),t}(it.Primitive);fs.prototype.$$type=2176;var ds=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).value=e,r.type=it.VAR_TYPE.CUSTOM_PRIMITIVE,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"toNumberVar",value:function(){return it.NULL_VAR}},{key:"toStringVar",value:function(){return it.NULL_VAR}},{key:"toBooleanVar",value:function(){return it.NULL_VAR}},{key:"clone",value:function(){return new t(this.value)}},{key:"customType",get:function(){return"SheetImageVar"}}]),(0,_.Z)(t,[{key:"serialize",value:function(){var e=(0,f.Z)((0,v.Z)(t.prototype),"serialize",this).call(this);return e[it.TractorFormulaCacheProps.value]=this.value.getValue(),e[it.TractorFormulaCacheProps.customType]=this.customType,e}}],[{key:"deserialize",value:function(e){var r=e[it.TractorFormulaCacheProps.value];return new t(new fs(r))}}]),t}(it.CustomPrimitiveVar);function vs(e){return 2176===e.$$type}ds.prototype.$$type=2176;var ps=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getRow",value:function(){return Math.floor(this.idx/this.v.colCount())}},{key:"getCol",value:function(){return this.idx%this.v.colCount()}}]),t}(it.CollectionVarIter),ms=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this)))._rowCount=e,n._colCount=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getRef",value:function(){return null}},{key:"rowCount",value:function(){return this._rowCount}},{key:"colCount",value:function(){return this._colCount}},{key:"iter",value:function(e){return new ps(this,e).do((function(e){return(0,it.varCheck)(e)}))}},{key:"iterWithPos",value:function(e){var t=new ps(this,e),r=new Array(3);return t.do((function(e){return(0,it.varCheck)(e)})).map((function(e){return r[0]=e,r[1]=t.getRow(),r[2]=t.getCol(),r}))}},{key:"at",value:function(e,t){return this.getVarByPos(e,t)}},{key:"forEach",value:function(e){for(var t=this.rowCount(),r=this.colCount(),n=0;n<t;++n)for(var a=0;a<r;++a){var o=e(this.getVarByPos(n,a));if(o)return o}}},{key:"nth",value:function(e,t){if(e<0||e>=this.size())return it.NULL_VAR;var r=Math.floor(e/this.colCount()),n=e%this.colCount();return this.getVarByPos(r,n,t)}},{key:"getExpandVarByPos",value:function(e,t,r){var n=this.rowCount(),a=this.colCount();return e>=n&&1===n&&(e=0),t>=a&&1===a&&(t=0),this.isPosOutOfBounds(e,t)?Ce.d$b[Ce.O6N.NA_ARRAY_SIZES_NOT_EQUAL]({funcName:""}):this.getVarByPos(e,t,r)}},{key:"idxVar",value:function(e,t){return this.nth(e,t)}},{key:"getVar",value:function(e){return this.getVarByPos(0,0,e)}},{key:"getValue",value:function(e){return this.getVar(e).getValue()}},{key:"valueCount",value:function(){return this.rowCount()*this.colCount()}},{key:"size",value:function(){return this.rowCount()*this.colCount()}},{key:"isPosOutOfBounds",value:function(e,t){return e<0||t<0||e>=this.rowCount()||t>=this.colCount()}},{key:"getFormatterByPos",value:function(e,t,r){var n,a,o,i,u=null===(n=this.getVarByPos(e,t).getSpecialInfo())||void 0===n||null===(a=n.customData)||void 0===a?void 0:a.autoFormat,s=null===(o=r.ref)||void 0===o||null===(i=o.sheet())||void 0===i?void 0:i.parent;return u&&s?s.formatterService.getFormatter(u):null}},{key:"getValueByPos",value:function(e,t){return this.getVarByPos(e,t).getValue()}},{key:"setHash",value:function(e){}},{key:"hash",value:function(){return null}}]),t}(it.BaseCustomCollectionVar);ms.prototype.$$type=32;var gs=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e.length,e.length>0?e[0].length:0))).primitiveVarArr=e,n._hash=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"customType",get:function(){return"PrimitiveMatrixVar"}}]),(0,_.Z)(t,[{key:"at",value:function(e,t){var r=this.primitiveVarArr[e];return r&&r[t]||it.NULL_VAR}},{key:"forEach",value:function(e){for(var t=this.rowCount(),r=this.colCount(),n=0;n<t;++n)for(var a=this.primitiveVarArr[n],o=0;o<r;++o){var i=e(a[o]||it.NULL_VAR);if(i)return i}}},{key:"getVarByPos",value:function(e,t){return this.primitiveVarArr[e]&&this.primitiveVarArr[e][t]||it.NULL_VAR}},{key:"getCollectionValue",value:function(){return this.primitiveVarArr}},{key:"setHash",value:function(e){this._hash=e}},{key:"hash",value:function(){return this._hash?this._hash:null}}]),t}(ms),ys=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).importRangeId=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"hash",value:function(){return this.importRangeId}}]),t}(gs);ys.prototype.$$type=536870944;var _s=function(){function e(t,r){(0,y.Z)(this,e),this.dataView=t,this.options=r}return(0,_.Z)(e,[{key:"toJSON",value:function(){var e=this.dataView,t=this.options,r=t.isDirtyCache,n=t.isPassive,a=t.isError,o=t.errorType;return{dataViewJSON:null==e?void 0:e.toJSON(),isDirtyCache:r,isPassive:n,isError:a,errorType:o}}}],[{key:"fromJSON",value:function(t){var r,n=t.dataViewJSON,a=t.isDirtyCache,o=t.isPassive,i=t.isError,u=t.errorType;return n&&(r=new Rt.b$).fromJSON(n),new e(r,{isDirtyCache:a,isPassive:o,isError:i,errorType:u})}}]),e}(),Rs=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e,r.customType="PivotTableDataVar",r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"toBooleanValue",value:function(){return!0}},{key:"toNumberValue",value:function(){return 0}},{key:"toStringValue",value:function(){return""}},{key:"getValue",value:function(){return this.value}}]),t}(it.Primitive),Cs=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).value=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"customType",get:function(){return"PivotTableDataVar"}}]),(0,_.Z)(t,[{key:"toNumberVar",value:function(){return new it.NumberVar(0)}},{key:"toStringVar",value:function(){return new it.StringVar("")}},{key:"toBooleanVar",value:function(){return new it.BooleanVar(!0)}},{key:"serializeValue",value:function(){var e;return null===(e=this.value.getValue())||void 0===e?void 0:e.toJSON()}}],[{key:"deserialize",value:function(e){var t=e[it.TractorFormulaCacheProps.value],r=e[it.TractorFormulaCacheProps.customType],n=e[it.TractorFormulaCacheProps.type];if(!r||!n)return null;var a=_s.fromJSON(t);return ws(a)}}]),t}(it.CustomPrimitiveVar);Cs.prototype.$$type=4224;var ws=function(e){return new Cs(new Rs(e))},Es=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getValue",value:function(){throw new Error("Method not implemented.")}},{key:"clone",value:function(){throw new Error("Method not implemented.")}},{key:"serializeValue",value:function(){throw new Error("Method not implemented.")}},{key:"toNumberVar",value:function(e){throw new Error("Method not implemented.")}},{key:"toStringVar",value:function(e){throw new Error("Method not implemented.")}},{key:"toBooleanVar",value:function(e){throw new Error("Method not implemented.")}},{key:"isCustomPrimitive",value:function(){return!1}},{key:"customType",get:function(){throw new Error("Method not implemented.")}}]),t}(it.BaseCustomPrimitiveVar);Es.prototype.$$type=128;var ks=function(e){function t(e,r,n,a){var o;return(0,y.Z)(this,t),(o=(0,d.Z)(this,(0,v.Z)(t).call(this))).rangeIndex=0,o.refIndex=0,o.exprs=r,o.refs=e,o.item=n,o.toSingleRef=a,o}return(0,p.Z)(t,e),t}(Es),Ts=function(){function e(t){(0,y.Z)(this,e),this.last=null,this.count=1,this.isArray=!1,this.last=t}return(0,_.Z)(e,[{key:"isLazy",value:function(){return!1}},{key:"isPreRef",value:function(){return 1}},{key:"expectedType",value:function(){return null}},{key:"circle",value:function(e,t){return this.last}}]),e}(),Ss=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this))).gridRange=e,n.cache=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getRef",value:function(){return this.gridRange}},{key:"getValue",value:function(){throw new Error("Method not implemented.")}},{key:"serialize",value:function(e){if(1===this.size())return this.at(0,0).serialize(e);throw new Error("Method not implemented.")}},{key:"rowCount",value:function(e){return this.gridRange.endRow-this.gridRange.startRow}},{key:"colCount",value:function(e){return this.gridRange.endCol-this.gridRange.startCol}},{key:"at",value:function(e,t){var r=e+this.gridRange.startRow,n=t+this.gridRange.startCol;return Wo(this.gridRange,r,n)?this.cache.get(r,n)||it.NULL_VAR:it.NA_ERR_VAR}},{key:"get",value:function(e,t){return this.cache.get(e,t)||it.NULL_VAR}},{key:"forEach",value:function(e){for(var t=this.gridRange.startRow;t<this.gridRange.endRow;++t)for(var r=this.gridRange.startCol;r<this.gridRange.endCol;++r){var n=e(this.cache.get(t,r)||it.NULL_VAR);if(n)return n}}},{key:"size",value:function(){return oi(this.gridRange)}},{key:"iter",value:function(){throw new Error("Method not implemented.")}},{key:"nth",value:function(e){var t=this.colCount();return this.at(e/t|0,e%t)}},{key:"getVarByPos",value:function(e,t){return this.at(e,t)}},{key:"hash",value:function(){if(void 0===this._hash){var e=this.gridRange;this._hash=ei(e.startRow,e.endRow,e.startCol,e.endCol,e.hostId,e.hostName,e.status)}return this._hash}},{key:"type",get:function(){return it.VAR_TYPE.COLLECTION}}]),t}(it.BaseVar);Ss.prototype.$$type=96;var As=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e[0],r[0]))).gridRanges=e,n.caches=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getRefs",value:function(){return this.gridRanges}},{key:"getRefCount",value:function(){return this.gridRanges.length}},{key:"getGridRangeVar",value:function(e){return e<0||e>=this.gridRanges.length||e>=this.caches.length?null:new Ss(this.gridRanges[e],this.caches[e])}},{key:"at",value:function(e,t,r){var n=0;if(null!=r){if(!(r>=0&&r<this.gridRanges.length))return it.NA_ERR_VAR;n=r}var a=this.gridRanges[n],o=a.startRow+e,i=a.startCol+t;return Wo(a,o,i)?this.caches[n].get(o,i)||it.NULL_VAR:it.NA_ERR_VAR}},{key:"get",value:function(e,t,r){var n=0;if(null!=r){if(!(r>=0&&r<this.gridRanges.length))return it.NA_ERR_VAR;n=r}return this.caches[n].get(e,t)||it.NULL_VAR}},{key:"forEach",value:function(e){for(var t=0;t<this.gridRanges.length;++t)for(var r=this.gridRanges[t],n=this.caches[t],a=r.startRow;a<r.endRow;++a)for(var o=r.startCol;o<r.endCol;++o){var i=e(n.get(a,o)||it.NULL_VAR);if(i)return i}}},{key:"hash",value:function(){if(void 0===this._hash){for(var e=this.gridRanges,t=[],r=0;r<e.length;++r){var n=e[r];t.push(ei(n.startRow,n.endRow,n.startCol,n.endCol,n.hostId,n.hostName,n.status))}this._hash=t.join("|")}return this._hash}}]),t}(Ss);As.prototype.$$type=1073741920;var Is=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,{get:function(){},set:function(){}}))).arr=[],n.setData(r,""),n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setData",value:function(e,t){this.arr=(Array.isArray(e)?e:[e]).map((function(e){return(0,it.boxValue)(e)})),this.name=t}},{key:"getValue",value:function(){throw new Error("Method not implemented.")}},{key:"getName",value:function(){return this.name}},{key:"rowCount",value:function(){return 1}},{key:"colCount",value:function(){return(Array.isArray(this.arr)?this.arr:[this.arr]).length}},{key:"at",value:function(e,t){return this.arr?this.arr[t]:it.NULL_VAR}},{key:"get",value:function(e,t){return this.arr[t]||it.NULL_VAR}},{key:"forEach",value:function(e){var t;if(null!==(t=this.arr)&&void 0!==t&&t.length)for(var r=0;r<this.arr.length;r++){var n=e(this.arr[r]||it.NULL_VAR);if(n)return n}}},{key:"size",value:function(){return Array.isArray(this.arr)?this.arr.length:1}},{key:"iter",value:function(){throw new Error("Method not implemented.")}},{key:"nth",value:function(e){return this.arr[e]}},{key:"getVarByPos",value:function(e,t){return this.at(e,t)}},{key:"hash",value:function(){return""}}]),t}(Ss);Is.prototype.$$type=134217824;var Os,Vs,Ns,bs,Ms,Fs=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).gridRange=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getRef",value:function(){return this.gridRange}},{key:"getValue",value:function(){throw new Error("Method not implemented.")}},{key:"serialize",value:function(e){throw new Error("Method not implemented.")}},{key:"rowCount",value:function(){return ni(this.gridRange)}},{key:"colCount",value:function(){return ai(this.gridRange)}},{key:"size",value:function(){return oi(this.gridRange)}},{key:"at",value:function(e,t){throw new Error("Method not implemented.")}},{key:"get",value:function(e,t){throw new Error("Method not implemented.")}},{key:"forEach",value:function(e){throw new Error("Method not implemented.")}},{key:"hash",value:function(){if(void 0===this._hash){var e=this.gridRange;this._hash=ei(e.startRow,e.endRow,e.startCol,e.endCol,e.hostId,e.hostName,e.status)}return this._hash}},{key:"type",get:function(){return it.VAR_TYPE.COLLECTION}}]),t}(it.BaseVar);function Zs(e,t){for(var r=[],n=[],a=0;a<e.length;++a){var o=e[a];to(o)&&(r.push(o.getRef()),n.push(a))}if(0===r.length)return t(e);var i=e.slice();return new ks(r,[],{next:function(e,r){for(var a=0;a<e.length;++a){var o=n[a];i[o]=e[a]}return t(i)}})}function xs(e,t){var r=ni(t),n=ai(t);return 1===r?1===n?t:e.startCol<t.startCol||e.startCol>=t.endCol?null:new Qi(t.startRow,t.startRow+1,e.startCol,e.startCol+1,t.hostId,t.hostName):1===n?e.startRow<t.startRow||e.startRow>=t.endRow?null:new Qi(e.startRow,e.startRow+1,t.startCol,t.startCol+1,t.hostId,t.hostName):Wo(t,e.startRow,e.startCol)?new Qi(e.startRow,e.startRow+1,e.startCol,e.startCol+1,t.hostId,t.hostName):null}function Ds(e,t){if(Ka(e)){var r=function(e,t){var r=ni(t),n=ai(t),a={row:t.startRow,col:t.startCol};return 1===r?1===n?a:e.startCol<t.startCol||e.startCol>=t.endCol?null:(a.col=e.startCol,a):1===n?e.startRow<t.startRow||e.startRow>=t.endRow?null:(a.row=e.startRow,a):Wo(t,e.startRow,e.startCol)?(a.row=e.startRow,a.col=e.startCol,a):null}(t,e.getRef());return r?e.get(r.row,r.col):it.VALUE_ERR_VAR}return Qa(e)?it.VALUE_ERR_VAR:e.at(0,0)}function Ps(e,t){return t.hostId?e.getSheetFromId(t.hostId):t.hostName?e.getSheetFromName(t.hostName):null}function $s(e,t){if(to(t)){var r=t.getRef(),n=Ps(e,r);if(n){var a=$i(r,n);if(a!==r)return new Fs(a)}}return t}function Ls(e,t){var r;return t.endRow>=Fo&&((r=r||t.clone()).endRow=e.getRowCount()),t.endCol>=Fo&&((r=r||t.clone()).endCol=e.getColumnCount()),r||t}Fs.prototype.$$type=64,function(e){e[e.AsGridRangeVar=1]="AsGridRangeVar",e[e.Projection=2]="Projection"}(Os||(Os={})),function(e){e[e.Passthrough=0]="Passthrough",e[e.DerefRange=1]="DerefRange",e[e.DerefSingle=2]="DerefSingle",e[e.DerefSingleWithRef=3]="DerefSingleWithRef"}(Vs||(Vs={})),function(e){e[e.Any=128]="Any",e[e.PivotFieldRefs=134217728]="PivotFieldRefs",e[e.CustomSingleValue=268435456]="CustomSingleValue",e[e.ImportRange=536870912]="ImportRange",e[e.MultiRefs=1073741824]="MultiRefs"}(Ns||(Ns={})),function(e){e[e.Null=1]="Null",e[e.Number=2]="Number",e[e.String=4]="String",e[e.Boolean=8]="Boolean",e[e.Error=16]="Error",e[e.Matrix=32]="Matrix",e[e.Ref=64]="Ref",e[e.GridRange=96]="GridRange",e[e.MultiRefs=1073741920]="MultiRefs",e[e.PivotFieldRefs=134217824]="PivotFieldRefs",e[e.ImportRange=536870944]="ImportRange",e[e.Lazy=384]="Lazy",e[e.Param=640]="Param",e[e.Lambda=1152]="Lambda",e[e.Image=2176]="Image",e[e.Pivot=4224]="Pivot",e[e.ProxyArray=8320]="ProxyArray",e[e.PivotFormula=16512]="PivotFormula"}(bs||(bs={})),function(e){e.COMMON="Common",e.INVERTED_INDEX="InvertedIndex",e.SORT="Sort",e.AI="AI",e.CONDITION="Condition"}(Ms||(Ms={}));var Bs={isDirtyAlwaysCalc:!1},Us=179769313486231e294,Hs=function(e,t,r,n){return it.tractorErrorVarCreators[it.ErrorCode.STRING_TOO_LONG]({funcName:e,index:t,textLength:r,maxTextLength:n})},zs=function(e,t){return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:e,index:t})},Ws=function(e,t){return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:e,index:t})},Gs=function(e,t,r,n,a){return it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:e,value:r,index:t,lowerBound:n,upperBound:a})},js=function(e,t,r,n,a){return it.tractorErrorVarCreators[it.ErrorCode.SHOULD_BE_BETWEEN_EXCLUSIVE]({funcName:e,value:r,index:t,lowerBound:n,upperBound:a})},Ys=it.tractorErrorVarCreators[it.ErrorCode.POSITIVE_OVERFLOW]({upperBound:Us}),qs=Ce.d$b[Ce.O6N.NEGATIVE_OVERFLOW]({lowerBound:-Us}),Js=function(e,t,r,n){return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:e,value:t,index:r,lowerBound:n})},Ks=function(e,t,r,n){return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:e,value:t,index:r,lowerBound:n})},Xs=function(e,t,r,n){return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:e,index:r,value:t,lowerBound:n})},Qs=function(e,t,r,n){return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:e,index:r,value:t,lowerBound:n})},el=function(e,t,r,n){return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO]({funcName:e,value:t,index:r,upperBound:n})},tl=function(e,t,r,n){return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN]({funcName:e,index:r,value:t,upperBound:n})},rl=function(e,t,r,n,a,o){return Ce.d$b[Ce.O6N.DATE_PARAMETER_SHOULD_BE_ON_OR_BEFORE_OTHER_DATE_PARAMETER]({funcName:e,index:n,firstDate:(0,Ce.L0c)(t.formatterService,r),secondArgIndex:o,secondDate:(0,Ce.L0c)(t.formatterService,a)})},nl=function(e,t,r){return Ce.d$b[Ce.O6N.NUM_PARAMETER_SHOULD_BE_INTEGER]({funcName:e,index:t,value:r})},al=function(e,t,r,n){return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_VALUE_NOT_IN_LIST]({funcName:e,value:t,index:r,validValues:Array.isArray(n)?n.join(", "):n})},ol=function(e,t,r){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_NON_DECIMAL_REPRESENTATION]({funcName:e,value:t,validValue:String(r)})},il=Ce.d$b[Ce.O6N.VALUE_RANDARRAY_ERROR_CALC_LARGE](),ul=Ce.d$b[Ce.O6N.PARAMETER_SHOULD_BE_LAMBDA](),sl=Ce.d$b[Ce.O6N.RESULT_SHOULD_BE_SINGLE_COL](),ll=Ce.d$b[Ce.O6N.RESULT_SHOULD_BE_SINGLE_ROW](),cl=Ce.d$b[Ce.O6N.RESULT_SHOULD_BE_SINGLE](),hl=function(e,t,r){return Ce.d$b[Ce.O6N.TREND_ARGUMENT_NOT_STIRNG]({funcName:e,index:t,content:r})},fl=function(e,t,r){return Ce.d$b[Ce.O6N.TREND_ARGUMENT_NOT_BOOLEAN]({funcName:e,index:t,content:r})},dl=function(e,t,r){return Ce.d$b[Ce.O6N.TREND_ARGUMENT_NOT_NULL]({funcName:e,index:t,content:r})},vl=function(e,t,r){return Ce.d$b[Ce.O6N.INVALID_WEEKEND_NUMBER]({funcName:e,index:t,invalidVal:r})},pl=function(e,t,r){return it.tractorErrorVarCreators[it.ErrorCode.NUM_OUT_OF_RANGE_PARAMETER]({funcName:e,index:t,value:r})},ml=function(e,t,r){return Ce.d$b[Ce.O6N.NUM_SETTLEMENT_DATE_NOT_BEFORE_MATURITY_DATE]({funcName:e,settlementDate:t,maturityDate:r})},gl=function(e,t,r,n,a){return it.tractorErrorVarCreators[it.ErrorCode.SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:e,value:r,index:t,lowerBound:n,upperBound:a})},yl=function(e,t,r,n,a){return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO_OTHER_PARAM]({funcName:e,index:r,value:t,secondArgIndex:n,upperBound:a})},_l=function(e,t,r,n){return Ce.d$b[Ce.O6N.VALUE_PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO]({funcName:e,index:t,value:r,upperBound:n})},Rl=function(e,t,r,n,a){return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_WRONG_DATA_TYPE]({funcName:e,index:t,value:r,argType:n,requiredArgType:a})};function Cl(e){switch(e){case 2:return it.FormulaErrorPhrases.DATA_TYPE_DOUBLE;case 4:return it.FormulaErrorPhrases.DATA_TYPE_STRING;case 8:return it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN;case 16:return it.FormulaErrorPhrases.DATA_TYPE_ERROR;case 1:return it.FormulaErrorPhrases.DATA_TYPE_EMPTY;case 32:case 96:case 536870944:return it.FormulaErrorPhrases.DATA_TYPE_MATRIX;case 64:case 1073741920:return it.FormulaErrorPhrases.DATA_TYPE_REFERENCE;case 2176:return it.FormulaErrorPhrases.DATA_TYPE_IMAGE;case 1152:return"DATA_TYPE_LAMBDA";default:return 96&e?"".concat(it.FormulaErrorPhrases.DATA_TYPE_MATRIX,",").concat(it.FormulaErrorPhrases.DATA_TYPE_REFERENCE):it.FormulaErrorPhrases.DATA_TYPE_STRING}}function wl(e){if(e.$$type)return Cl(e.$$type);switch(e.type){case it.VAR_TYPE.NUMBER:return it.FormulaErrorPhrases.DATA_TYPE_DOUBLE;case it.VAR_TYPE.STRING:return it.FormulaErrorPhrases.DATA_TYPE_STRING;case it.VAR_TYPE.BOOL:return it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN;case it.VAR_TYPE.ERROR:return it.FormulaErrorPhrases.DATA_TYPE_ERROR;case it.VAR_TYPE.NULL:return it.FormulaErrorPhrases.DATA_TYPE_EMPTY;case it.VAR_TYPE.COLLECTION:return it.FormulaErrorPhrases.DATA_TYPE_MATRIX;case it.VAR_TYPE.CUSTOM_COLLECTION:var t=e.customType;return"SheetRefVar"===t||"MultipleRefsVar"===t?it.FormulaErrorPhrases.DATA_TYPE_REFERENCE:it.FormulaErrorPhrases.DATA_TYPE_MATRIX;default:return it.FormulaErrorPhrases.DATA_TYPE_STRING}}function El(e){switch(e.$$type){case 4:case 16:return e.getValue();case 2:return e.getValue().toString();case 8:return e.getValue()?"TRUE":"FALSE";case 1:return"NULL";case 1152:return"LAMBDA";case 2176:return"IMAGE";default:return""}}var kl=function(e,t,r,n,a){return Ce.d$b[Ce.O6N.RANGE_SIZES_NOT_EQUAL]({funcName:e,expectedRows:t,expectedCols:r,actualRows:n,actualCols:a})};function Tl(e,t,r,n,a,o){return Ce.d$b[Ce.O6N.PARAMETER_RANGE_SIZES_NOT_EQUAL]({funcName:e,index:t,expectedRows:r,expectedCols:n,actualRows:a,actualCols:o})}var Sl=function(e,t){return Ce.d$b[Ce.O6N.ARG_MUST_BE_RANGE]({funcName:e,index:t})},Al=function(e){return Ce.d$b[Ce.O6N.VALUE_ARRAY_SIZES_NOT_EQUAL]({funcName:e})},Il=function(e){return Ce.d$b[Ce.O6N.NA_ARRAY_SIZES_NOT_EQUAL]({funcName:e})},Ol=function(e,t,r){return Ce.d$b[Ce.O6N.INVALID_CELL_REFERENCE]({funcName:e,index:t,value:r})},Vl=function(e,t,r){return Ce.d$b[Ce.O6N.REF_INVALID_CELL_REFERENCE]({funcName:e,index:t,value:r})},Nl=function(e,t,r){return Ce.d$b[Ce.O6N.NA_INVALID_CELL_REFERENCE]({funcName:e,index:t,value:r})},bl=function(e,t){return Ce.d$b[Ce.O6N.PARAMETER_SHOULD_BE_NON_BLANK]({funcName:e,index:t})},Ml=function(e,t){return Ce.d$b[Ce.O6N.NA_PARAMETER_SHOULD_BE_NON_BLANK]({funcName:e,index:t})},Fl=function(e,t,r){return it.tractorErrorVarCreators[it.ErrorCode.ARGUMENT_SIZES_NOT_EQUAL]({funcName:e,argCount:t,requiredOperandCount:r})};function Zl(e,t){return it.tractorErrorVarCreators[it.ErrorCode.NON_PAIR_ARGUMENTS]({funcName:e,argIndex:t})}var xl,Dl=function(e,t,r){return Ce.d$b[Ce.O6N.FUNCTION_RESULT_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:e,value:t,lowerBound:r})},Pl=function(e,t){return Ce.d$b[Ce.O6N.NUM_NOT_BE_NEGATIVE_NUMBER_OR_ZERO]({funcName:e,value:t})},$l=function(e,t){return Ce.d$b[Ce.O6N.LOOKUP_VALUE_NOT_FOUND]({funcName:e,value:t})},Ll=function(e,t,r){return Ce.d$b[Ce.O6N.DIV_TREND_POINT_NUM_UNENOUGHT]({funcName:e,expectedNum:t,receivedNum:r})},Bl=Ce.d$b[Ce.O6N.DELETED_REFERENCE](),Ul=Ce.d$b[Ce.O6N.AVERAGE_WEIGHTED_NEGATIVE_ERROR](),Hl=function(e){return it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_FUNCTION_EVAL]({funcName:e})},zl=it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER](),Wl=it.tractorErrorVarCreators[it.ErrorCode.NOT_A_NUMBER](),Gl=function(e){return it.tractorErrorVarCreators[it.ErrorCode.NO_VALID_DATA]({funcName:e})},jl=function(e){return it.tractorErrorVarCreators[it.ErrorCode.NUM_NO_VALID_DATA]({funcName:e})},Yl=function(e){return it.tractorErrorVarCreators[it.ErrorCode.NA_NO_VALID_DATA]({funcName:e})},ql=function(e){return it.tractorErrorVarCreators[it.ErrorCode.DIV0_NO_VALID_DATA]({funcName:e})},Jl=function(e){return Ce.d$b[Ce.O6N.RANGE_MUST_BE_SINGLE_ROW_OR_COLUMN]({funcName:e})},Kl=function(e){return Ce.d$b[Ce.O6N.NA_RANGE_MUST_BE_SINGLE_ROW_OR_COLUMN]({funcName:e})},Xl=it.tractorErrorVarCreators[it.ErrorCode.NO_MATCH](),Ql=function(e){return Ce.d$b[Ce.O6N.NO_MODE]({funcName:e})},ec=function(e){return Ce.d$b[Ce.O6N.NA_NO_MODE]({funcName:e})},tc=function(e,t,r){return Ce.d$b[Ce.O6N.MATRIX_ROWS_SHOULD_BE_EQUAL_COLS]({funcName:e,yRowCount:t,xRowCount:r})},rc=function(e,t){return Ce.d$b[Ce.O6N.VALUE_BY_ZERO_FROM_PARAMETER_BEING_ZERO]({funcName:e,index:t})},nc=function(e,t){return Ce.d$b[Ce.O6N.NO_VALUE_FOR_THIS_CELL_FUNCTION]({funcName:e,errorType:t})},ac=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Ce.d$b[Ce.O6N.NO_VALUE_FOR_THIS_CELL_PARAMETER]({parameterName:e,errorType:t,isI18n:r})};!function(e){e.IF_NOT_FOUND="ifNotFound",e.PAD_WITH="padWith"}(xl||(xl={}));var oc=ac(xl.IF_NOT_FOUND,it.ErrorConstant.NA,!0),ic=ac(xl.PAD_WITH,it.ErrorConstant.NA,!0),uc=function(e){return it.tractorErrorVarCreators[it.ErrorCode.POSITIVE_OVERFLOW]({upperBound:e})},sc=function(e,t){return it.tractorErrorVarCreators[it.ErrorCode.CANNOT_PARSE_TEXT_TO_NUMBER]({funcName:e,arg:'"'.concat(t,'"')})},lc=function(e,t,r){return it.tractorErrorVarCreators[it.ErrorCode.ARGUMENTS_COUNT_SHOULD_BE_EXACTLY]({funcName:e,requiredOperandCount:t,argCount:r})};function cc(){return Ce.d$b[Ce.O6N.FORMULA_SHOULD_BE_FOLLOWED_BY_A_CALL]({funcName:"LAMBDA"})}function hc(e){return it.tractorErrorVarCreators[it.ErrorCode.UNKNOWN_FUNCTION]({funcName:e})}var fc=function(e){function t(e,r,n){var a;(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).lastArray=r.isArray,a.isArray=n.formula.hasArrayFunction||n.isArrayFormula(),r.isArray=a.isArray;var o=n.getRef(),i=o.hash(!1,!0);return r.visited.set(i,(r.visited.get(i)||0)+1),null!==e&&(a.lastCell=r.ref,a.lastFormula=r.formula,a.lastInfo=r.info,r.ref=o,r.formula=n),a.lastScope=r.parameterScope,r.parameterScope=void 0,r.info={},a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"do",value:function(e,t){var r=function(e,t){Ka(t)&&(1!==(t=function(e,t){var r=e.getRef(),n=Ps(t,r),a=[];if(n)for(var o=r.startRow;o<r.endRow;++o){for(var i=[],u=r.startCol;u<r.endCol;++u){var s,l=e.get(o,u),c=null===(s=n.getActualFormatter(o,u))||void 0===s?void 0:s.getFormatCode();if(c){var h=e.get(o,u).getSpecialInfo();(l=l.clone()).setSpecialInfo(Object.assign({},h,{customData:{autoFormat:c}}))}i[u-r.startCol]=l}a[o-r.startRow]=i}return new gs(a)}(t,e.workbook)).size()||e.formula.isArrayFormula()||(t=t.at(0,0)));var r=t;if(Ja(t))Qa(t)?t=r=it.VALUE_ERR_VAR:r=t.at(0,0);else if(qa(t)){var n=t.getSpecialInfo();t=t.toNumberVar(),n&&n.customData&&t.setSpecialInfo(n)}else ao(t)?t=r=cc():oo(t)&&(t=r=it.NAME_ERR_VAR);return qa(r)?r=r.toNumberVar():uo(r)?r=r.getVar():ao(r)&&(r=cc()),[t,r]}(e,t.pop()),n=(0,g.Z)(r,2),a=n[0],o=n[1],i=new it.FormulaCache(a,o);return dc(e,e.formula,i),this.goBack(e)}},{key:"isPreRef",value:function(){return 3}},{key:"expectedType",value:function(){return 2}},{key:"circle",value:function(e,t){var r=new it.FormulaCache(Ce.aHq,Ce.aHq);return dc(e,e.formula,r),this.goBack(e)}},{key:"goBack",value:function(e){return null!==this.last&&(e.ref=this.lastCell,e.formula=this.lastFormula,e.info=this.lastInfo,e.isArray=this.lastArray),e.parameterScope=this.lastScope,this.last}}]),t}(Ts);function dc(e,t,r){t.getState().cache=r,function(e,t,r){var n={},a=e.info,o=a.customData,i=a.customDepends,u=a.cacheKeys;if(o)n.customData=o;else{var s=r.getSpecialInfo();s&&(n=Object.assign({},s))}i&&(n.customDepends=i.map((function(t){return Eu(t,Ps(e.workbook,t))}))),u&&(n.cacheKeys=u);var l=t.getInfo();l||!(n.customData||n.customDepends||n.cacheKeys||n.linkInfo)?l&&Object.assign(l,n):t.setInfo(n)}(e,r,r.getRawVar()),e.info.customData=void 0;var n=t.getCustomDepends(),a=e.info.customDepends;t.registerCustomDepends(a);var o=e.service;o.addValueChangedFormula(t),o.emit("afterFormulaCalc",t),a&&a.forEach((function(t){var r=e.workbook,n=Ps(r,t);n&&r.detectWorksheet(n)})),(a||n)&&e.workbook&&e.ref.hostId&&e.service.calcEngine.dynamicRefManager.updateDynamicRefs(t,e.ref,a),delete e.info.customDepends}var vc=function(e){function t(e,r,n,a){var o;return(0,y.Z)(this,t),(o=(0,d.Z)(this,(0,v.Z)(t).call(this))).start=e,o.end=r,o.expr=n,o.isArray=null==a?null:a,o}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"clone",value:function(){var e=new t(this.start,this.end,this.expr,this.isArray);return e.scope=this.scope?this.scope.slice():[],e}}]),t}(Es);function pc(e,t,r,n,a,o,i){e.start=t,e.end=r,e.index=n,e.expression=a,e.depth=o,e.parameterScope=i}vc.prototype.$$type=384;var mc=function(e){function t(e,r,n,a,o,i,u,s){var l;(0,y.Z)(this,t),(l=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).lastStart=r.start,l.lastEnd=r.end,l.lastIndex=r.index,l.lastExpression=r.expression,l.lastDepth=r.depth,l.lastScope=r.parameterScope;var c=r.depth;return r.ref!==i?c=0:c++,pc(r,n,a,n,o,c,u),l.isArray=null==s?e.isArray:s,l}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"do",value:function(e,t){return pc(e,this.lastStart,this.lastEnd,this.lastIndex,this.lastExpression,this.lastDepth,this.lastScope),Sc(this.last),this.last}},{key:"circle",value:function(e,t){return pc(e,this.lastStart,this.lastEnd,this.lastIndex,this.lastExpression,this.lastDepth,this.lastScope),this.last}},{key:"isPreRef",value:function(){return this.last.isPreRef()}}]),t}(Ts),gc=function(e){function t(e,r,n,a){var o;return(0,y.Z)(this,t),(o=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).first=!0,o.isRef=!1,o.refResult=[],o.exprResult=[],o.x=n,o.count=0,o.isArray=e.isArray,o.hash=a,o}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"do",value:function(e,t){if(this.first)this.first=!1;else{var r=t.pop();if(!e.skipRuntimeError&&ja(r)&&r.isRuntimeError())return Lc(e,this.last,r);this.isRef?this.refResult.push(r):this.exprResult.push(r)}var n=this.x,a=n.exprs,o=n.refs;for(this.isRef=!0;this.x.refIndex<o.length;this.x.refIndex++){var i=Vc(e,this,t,o[this.x.refIndex],this.x.toSingleRef?3:1);if(i!==this)return this.count=1,this.x.refIndex++,e.index--,i;this.refResult.push(t.pop())}for(this.isRef=!1;this.x.rangeIndex<a.length;this.x.rangeIndex++){var u=a[this.x.rangeIndex];if(u instanceof vc)return this.count=1,this.x.rangeIndex++,new mc(this,e,u.start,u.end,u.expr,e.ref,u.scope,u.isArray);if(to(u)){var s=Vc(e,this,t,u.getRef(),this.x.toSingleRef?3:1);if(s!==this)return this.count=1,this.x.rangeIndex++,e.index--,s;this.exprResult.push(t.pop())}else this.exprResult.push(u)}var l=this.x.item.next(this.refResult,this.exprResult);return Ac(this.last,e,t,l,this.hash)}}]),t}(Ts),yc=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).formula=r,i.ref=a,i.isParamProcess=o,i.count=0,i._isPreRef=n,i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"isPreRef",value:function(){return this._isPreRef}}]),(0,_.Z)(t,[{key:"do",value:function(e,t){var r=Oc(this.formula);if(!r)throw new Error("formula must be calculated");if(!e.skipRuntimeError&&ja(r)&&r.isRuntimeError())return Lc(e,this.last,r);var n=Ps(e.workbook,this.ref);if(1&this.isPreRef()){var a=bc(e,n).values;a.set(this.ref.startRow,this.ref.startCol,r),r=new Ss(this.ref,a)}else{var o,i=null===(o=n.getActualFormatter(this.ref.startRow,this.ref.startCol))||void 0===o?void 0:o.getFormatCode();i&&(r=r.clone()).setSpecialInfo(Object.assign({},r.getSpecialInfo(),{customData:{autoFormat:i}}))}return t.push(r),Sc(this.last),this.isParamProcess&&e.index--,this.last}},{key:"circle",value:function(e,t){return this.last}}]),t}(Ts),_c=function(e){function t(e,r,n,a,o,i,u,s){var l;return(0,y.Z)(this,t),(l=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).ref=n,l.sheet=a,l.unCalcRanges=o,l.index=i,l.row=u,l.col=s,l.count=0,l.cache=r.cache.get(l.sheet.id()),l}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"do",value:function(e,t){for(var r=this.unCalcRanges,n=this.cache,a=n.values,o=n.ranges,i=this.unCalcRanges[this.index];i;){for(var u=i,s=u.startCol,l=u.endRow,c=u.endCol;this.row<l;this.row++){for(;this.col<c;this.col++){var h=a.get(this.row,this.col);if(!h){var f=this.sheet.getVar(this.row,this.col);if(!(h=Oc(f))){var d=Mc(e,this,t,f);return e.index--,d}if(!e.skipRuntimeError&&ja(h)&&h.isRuntimeError())return Lc(e,this.last,h);a.set(this.row,this.col,h)}}this.col=s}(i=r[++this.index])&&(this.row=i.startRow,this.col=i.startCol)}o.add(this.ref);var v=new Ss(this.ref,a);return t.push(v),Sc(this.last),this.last}}]),t}(Ts);function Rc(e,t){return e-t}function Cc(e,t,r,n,a,o){var i=e.length-1;i>=0&&e[i].startRow===t&&e[i].endRow===r&&e[i].endCol===n?e[i].endCol=a:e.push(new Qi(t,r,n,a,o))}var wc=function(){function e(){(0,y.Z)(this,e),this.map=new Map}return(0,_.Z)(e,[{key:"splitAndAdd",value:function(e){var t=this.map.get(e.hostId);t||(t=[],this.map.set(e.hostId,t));for(var r=[],n=e.startRow,a=e.endRow,o=e.startCol;o<e.endCol;o++)if(t[o]){var i=t[o],u=su(i,n,Rc,!0);u%2!=0&&u++;var s=su(i,a,Rc,!0);s%2==0&&s++;for(var l=n,c=u;c<s;c+=2)i[c]>l&&Cc(r,l,i[c],o,o+1,e.hostId),l=Uo(l,i[c+1]);l<a&&Cc(r,l,a,o,o+1,e.hostId),-1===s||n>i[s]?i.splice(s+1,0,n,a):(u>s&&u>=2&&(u-=2),i[u]=Ho(i[u],n),i[s]=Uo(i[s],a),s-u>1&&i.splice(u+1,s-u-1))}else t[o]=[n,a],Cc(r,n,a,o,o+1,e.hostId);return r}},{key:"split",value:function(e){var t=this.map.get(e.hostId);t||(t=[],this.map.set(e.hostId,t));for(var r=[],n=e.startRow,a=e.endRow,o=e.startCol;o<e.endCol;o++)if(t[o]){var i=t[o],u=su(i,n,Rc,!0);u%2!=0&&u++;var s=su(i,a,Rc,!0);s%2==0&&s++;for(var l=n,c=u;c<s;c+=2)i[c]>l&&Cc(r,l,i[c],o,o+1,e.hostId),l=Uo(l,i[c+1]);l<a&&Cc(r,l,a,o,o+1,e.hostId)}else Cc(r,n,a,o,o+1,e.hostId);return r}},{key:"add",value:function(e){var t=this.map.get(e.hostId);t||(t=[],this.map.set(e.hostId,t));for(var r=e.startRow,n=e.endRow,a=e.startCol;a<e.endCol;a++)if(t[a]){var o=t[a],i=su(o,r,Rc,!0);i%2!=0&&i++;var u=su(o,n,Rc,!0);u%2==0&&u++,-1===u||r>o[u]?o.splice(u+1,0,r,n):(i>u&&i>=2&&(i-=2),o[i]=Ho(o[i],r),o[u]=Uo(o[u],n),u-i>1&&o.splice(i+1,u-i-1))}else t[a]=[r,n]}}]),e}(),Ec=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this,a,o))).value=e,i.offsetRow=r,i.offsetCol=n,i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"customType",get:function(){return"SlicedMatrixVar"}}]),(0,_.Z)(t,[{key:"at",value:function(e,t){return this.value.at(e+this.offsetRow,t+this.offsetCol)}},{key:"getVarByPos",value:function(e,t,r){return this.value.getVarByPos(e+this.offsetRow,t+this.offsetCol,r)}}]),t}(ms),kc=100,Tc=1e4;function Sc(e){e.count=e.count-1}function Ac(e,t,r,n,a){if(no(n))return new mc(e,t,n.start,n.end,n.expr,t.ref,n.scope,n.isArray);if(n instanceof ks)return new gc(e,t,n,a);if(to(n)){var o=Vc(t,e,r,n.getRef(),e.isPreRef());return e!==o&&t.index--,o}if(n=za(n)?Ic(n):n.toValidVar(),r.push(n),a)if(function(e){return!!(32&e.$$type)&&!e.getRef()}(n)){if(n.setHash(a),n.size()>=kc&&t.funcCache.op.set(a,n),n.size()>1e4){t.funcCache.matrix=t.funcCache.matrix||new Ce.z6B(1/0);var i=t.funcCache.matrix;for(i.set(a,1);i.size()>20;){var u=i.removeOldest();u&&t.funcCache.op.remove(u)}}}else ja(n)||t.funcCache.op.set(a,n);return Sc(e),e}function Ic(e){var t=Math.abs(e.getValue()),r=e;return isNaN(t)?r=it.NUM_ERR_VAR:t>Us?r=r.getValue()>0?Ys:qs:t<22250738585073e-321&&(r.value=0),r}function Oc(e){if(e.isFormula()){var t=e.getState().cache;return e.isArrayFormula()&&t?e.getVar():null==t?void 0:t.getVar()}if(uo(e)||so(e)){var r=e.formula;return!r||r.getState().cache?e.getVar():void 0}return e}function Vc(e,t,r,n,a,o){var i=n.hostId?e.workbook.getSheetFromId(n.hostId):n.hostName?e.workbook.getSheetFromName(n.hostName):null;if(!i||!Ci(n))return r.push(Vl("",-1,"")),Sc(t),t;if(!a)return r.push(new Fs(n)),Sc(t),t;var u=n;1===oi(u)||!t.isArray&&2&a||(u=$i(n,i));var s=e.disableCalcRef;if(2&a){if(u!==n&&!Ci(u))return r.push(Vl("",-1,"")),Sc(t),t;if(!t.isArray){var l=xs(e.ref,u);if(!l)return r.push(it.VALUE_ERR_VAR),Sc(t),t;u=l;var c=i.getVar(u.startRow,u.startCol),h=Oc(c);if(void 0===h&&s&&(h=it.NULL_VAR),h){if(!e.skipRuntimeError&&ja(h)&&h.isRuntimeError())return Lc(e,t,h);var f=h;if(qa(h)){var d=t.expectedType();d&&(h=Fc(e.service,h,d))}if(1&a){var v=bc(e,i).values;v.set(u.startRow,u.startCol,f);var p=new Ss(u,v);r.push(p)}else{var m,g=null===(m=i.getActualFormatter(u.startRow,u.startCol))||void 0===m?void 0:m.getFormatCode();g&&(h=h.clone()).setSpecialInfo(Object.assign({},h.getSpecialInfo(),{customData:{autoFormat:g}})),r.push(h)}return Sc(t),t}return Mc(e,t=new yc(t,c,a,u,o),r,c)}}for(var y=bc(e,i),_=y.values,R=y.ranges,C=u.startRow,w=u.startCol,E=R.split(u),k=0;k<E.length;k++)for(var T=E[k],S=C;S<T.endRow;S++)for(var A=w;A<T.endCol;A++){var I=_.get(S,A);if(!I){var O=i.getVar(S,A);if(void 0===(I=Oc(O))&&s&&(I=it.NULL_VAR),!I){if(o&&e.index--,uo(O)||so(O)){var V=O.formula;if(!V)throw new Error("ProxyFormulaVar must have formula");O=V}return Mc(e,new _c(t,e,u,i,E,k,S,A),r,O)}if(!e.skipRuntimeError&&ja(I)&&I.isRuntimeError())return Lc(e,t,I);_.set(S,A,I)}}R.add(u);var N=new Ss(u,_);return r.push(N),Sc(t),t}var Nc=function(){function e(t,r){(0,y.Z)(this,e),this.rowCount=t,this.arr=new Array(t*r)}return(0,_.Z)(e,[{key:"has",value:function(e,t){return void 0!==this.arr[e+t*this.rowCount]}},{key:"set",value:function(e,t,r){if(!(e>=this.rowCount)){var n=e+t*this.rowCount;n>=this.arr.length||(this.arr[n]=r)}}},{key:"get",value:function(e,t){if(!(e>=this.rowCount))return this.arr[e+t*this.rowCount]}}]),e}();function bc(e,t){var r=e.cache.get(t.id());if(!r){var n=t.getRowCount(),a=t.getColumnCount();r={values:new Nc(n,a),ranges:new wc},e.cache.set(t.id(),r)}return r}function Mc(e,t,r,n){(so(n)||uo(n))&&(n=n.formula);var a=n.getRef().hash(!1,!0);if(e.visited.get(a)){var o=function(e,t,r,n){for(;r&&e.ref.hash(!0,!0)!==t;)r=r.circle(e,n),e.visited.delete(e.ref.hash(!0,!0));for(;r&&e.ref.hash(!0,!0)===t;)r=r.circle(e,n),e.visited.delete(t);return r}(e,a,t,r);return e.index++,o}var i=n.formula.expression,u=e.ref,s=new fc(t,e,n);return i?(t=new mc(s,e,i.length-1,0,i,u),e.index++,t):(Sc(s),r.push(it.NULL_VAR),s)}function Fc(e,t,r){if(t.$$type===r)return t;var n;switch(r){case 2:n=t.toNumberVar(e);break;case 4:n=t.toStringVar();break;case 8:n=t.toBooleanVar()}if(n&&1!==n.$$type){var a=t.getSpecialInfo();return a&&n.setSpecialInfo(a),n}return null}function Zc(e,t,r){if(za(t))return t;if(!r||!Ga(t)){var n=t.toNumberVar(e);if(n&&1!==n.$$type)return t.getSpecialInfo()&&n.setSpecialInfo(t.getSpecialInfo()),n}return null}function xc(e,t){if(Wa(e))return e;if(!t||!Ga(e)){var r=e.toStringVar();if(r&&1!==r.$$type)return r}return null}function Dc(e){if(Ga(e))return e;var t=e.toBooleanVar();return t&&1!==t.$$type?t:null}function Pc(e,t){if(2079&e.$$type)return e;if(ao(e))return cc();if(oo(e)){if(t){var r=t.formula.formula.params;return r&&r[e.index]?hc(r[e.index]):it.NAME_ERR_VAR}return it.NAME_ERR_VAR}return it.VALUE_ERR_VAR}function $c(e,t,r,n){var a=e.rowCount(),o=e.colCount();return t>=a&&1===a&&(t=0),r>=o&&1===o&&(r=0),t>=a||r>=o?n||it.NA_ERR_VAR:e.at(t,r)}function Lc(e,t,r){for(var n=t;n;)n=n instanceof fc?n.do(e,[r]):n.last;return null}function Bc(e,t,r){var n=e[t];null!=n?"object"==(0,R.Z)(n)&&Object.assign(n,r):e[t]=r}function Uc(e){switch(e[it.TractorFormulaCacheProps.customType]){case"SheetImageVar":return ds.deserialize(e);case"PivotTableDataVar":return Cs.deserialize(e);default:return null}}function Hc(e){var t,r,n=null!==(t=null===(r=e.getState().cache)||void 0===r?void 0:r.getInfo())&&void 0!==t?t:null;if(null==n)return null;var a={};if(null!=n.customDepends&&n.customDepends.length>0){for(var o=e.getRef(),i=n.customDepends,u=[],s=0;s<i.length;++s){var l=i[s],c=void 0;if(wu(l))c=l;else{var h=void 0,f=o.sheet();f&&(h=l.hostId===f.id()?f:Ps(f.parent,l)),c=Eu(l,h)}u.push(JSON.stringify(is(c,{ref:o})))}a[it.TractorCacheFormulaInfoProps.customDepends]=u}return Array.isArray(n.cacheKeys)&&n.cacheKeys.length>0&&(a[it.TractorCacheFormulaInfoProps.customData]=JSON.stringify(n.cacheKeys)),(0,it.isEmptyObject)(a)?null:a}function zc(e,t,r,n){var a,o=t.getInfo();if(o&&r){var i=r[it.TractorCacheFormulaInfoProps.customDepends];if(i){a=[];for(var u=0;u<i.length;u++)a.push(ls(JSON.parse(i[u]),n,n.parent.getSheetFromId.bind(n.parent)))}}o&&Array.isArray(o.customData)&&(o.cacheKeys=o.customData,delete o.customData);var s=a||null;e.getCustomDepends()!==s&&(e.registerCustomDepends(s),e.getFormulaService().calcEngine.dynamicRefManager.updateDynamicRefs(e,e.getRef(),s)),o&&(o.customDepends=a,t.setInfo(o))}var Wc,Gc=String.raw(ke||(ke=(0,h.Z)(["R[-?(?:0|[1-9][0-9]*)]"],["R\\[-?(?:0|[1-9][0-9]*)\\]"]))),jc="R".concat("[1-9][0-9]{0,6}"),Yc=String.raw(Te||(Te=(0,h.Z)(["C[-?(?:0|[1-9][0-9]*)]"],["C\\[-?(?:0|[1-9][0-9]*)\\]"]))),qc="C".concat("[1-9][0-9]{0,4}"),Jc=String.raw(Se||(Se=(0,h.Z)(["(?:",")|(?:",")"])),Gc,jc),Kc=String.raw(Ae||(Ae=(0,h.Z)(["(?:",")|(?:",")"])),Yc,qc),Xc=/[ \t\r\n]*(?::|\uFF1A)[ \t\r\n]*/,Qc=new RegExp("(?:".concat(Jc,")(?:").concat(Kc,")")),eh=new RegExp("(?:".concat(Qc.source,")")+Xc.source+"(?:".concat(Qc.source,")")),th=new RegExp("(?:".concat(Jc,")")+Xc.source+"(?:".concat(Jc,")")),rh=new RegExp("(?:".concat(Kc,")")+Xc.source+"(?:".concat(Kc,")")),nh=new RegExp("(?:".concat(th.source,")|(?:").concat(rh.source,")|(?:").concat(eh.source,")|(?:").concat(Qc.source,")")),ah=String.raw(Ie||(Ie=(0,h.Z)(["$?",""],["\\$?",""])),"[1-9][0-9]{0,6}"),oh=String.raw(Oe||(Oe=(0,h.Z)(["$?",""],["\\$?",""])),"[a-zA-Z]{1,3}"),ih=/[ \t\r\n]*(?::|\uFF1A)[ \t\r\n]*/,uh=new RegExp("(?:".concat(oh,")(?:").concat(ah,")")),sh=new RegExp("(?:".concat(uh.source,")")+ih.source+"(?:".concat(uh.source,")")),lh=new RegExp("(?:".concat(ah,")")+ih.source+"(?:".concat(ah,")")),ch=new RegExp("(?:".concat(oh,")")+ih.source+"(?:".concat(oh,")")),hh=new RegExp("(?:".concat(lh.source,")|(?:").concat(ch.source,")|(?:").concat(sh.source,")|(?:").concat(uh.source,")"));!function(e){e.NAME="Name",e.ERROR_CONSTANT="ErrorConstant",e.REF_CONSTANT="RefConstant",e.FUNCTION_NAME="FunctionName",e.LOGICAL_CONSTANT="LogicalConstant",e.LOGICAL_TRUE="LogicalTrue",e.LOGICAL_FALSE="LogicalFalse",e.NUMERICAL_CONSTANT="NumericalConstant",e.STRING_CONSTANT="StringConstant",e.OPEN_PAREN="OpenParen",e.CLOSE_PAREN="CloseParen",e.OPEN_BRACE="OpenBrace",e.CLOSE_BRACE="CloseBrace",e.COLON="Colon",e.EXCLAMATION_MARK="ExclamationMark",e.COMMA="Comma",e.SEMICOLON="SemiColon",e.ADDITION_OPERATOR="AdditionOperator",e.PLUS="Plus",e.MINUS="Minus",e.MULTIPLICATION_OPERATOR="MultiplicationOperator",e.MULTIPLY="Multiply",e.DIVIDE="Divide",e.PERCENT="Percent",e.POWER="Power",e.CONCATENATE="Concatenate",e.COMPARISON_OPERATOR="ComparisonOperator",e.LESS_THAN_EQUALS="LessThanEquals",e.GREATER_THAN_EQUALS="GreaterThanEquals",e.NOT_EQUALS="NotEquals",e.LESS_THAN="LessThan",e.GREATER_THAN="GreaterThan",e.EQUALS="Equals",e.WHITE_SPACE="WhiteSpace",e.SINGLE_SHEET_PREFIX="SingleSheetPrefix",e.QUOTED_SINGLE_SHEET_PREFIX="QuotedSingleSheetPrefix",e.LOCAL_REFERENCE_A1="LocalReferenceA1",e.LOCAL_REFERENCE_R1C1="LocalReferenceR1C1",e.EXTERNAL_REFERENCE_A1="ExternalReferenceA1",e.EXTERNAL_REFERENCE_R1C1="ExternalReferenceR1C1",e.FIELD_NAME_REFERENCE_A1="FieldNameLocalReferenceA1"}(Wc||(Wc={}));var fh=String.raw(Ve||(Ve=(0,h.Z)(["[^\\/!*:[]'();{}#\"=<>&+-^%, \r\n\t]*"],["[^\\\\\\/!\\*:\\[\\]\\'\\(\\);{}#\"=<>&\\+\\-\\^%,\\uFF08\\uFF09\\uFF1A\\uFF01\\uFF0C\\uFF1B \\r\\n\\t]*"]))),dh=String.raw(Ne||(Ne=(0,h.Z)(["[^\\/?!*:[]'();{}#\"=<>&+-^%, \r\n\t]+"],["[^\\\\\\/\\?!\\*:\\[\\]\\'\\(\\);{}#\"=<>&\\+\\-\\^%,\\uFF08\\uFF09\\uFF1A\\uFF01\\uFF0C\\uFF1B \\r\\n\\t]+"]))),vh=String.raw(be||(be=(0,h.Z)(["[^\\/?.!*:[]'();{}#\"=<>&+-^%, \r\n\t]+"],["[^\\\\\\/\\?.!\\*:\\[\\]\\'\\(\\);{}#\"=<>&\\+\\-\\^%,\\uFF08\\uFF09\\uFF1A\\uFF01\\uFF0C\\uFF1B \\r\\n\\t]+"]))),ph=(0,Ct.createToken)({name:"Name",pattern:new RegExp("".concat(vh).concat(fh))}),mh=(0,Ct.createToken)({name:"ErrorConstant",pattern:/#NULL!|#DIV\/0!|#VALUE!|#NAME\?|#NUM!|#N\/A/}),gh=(0,Ct.createToken)({name:"RefConstant",pattern:/#REF!/}),yh=(0,Ct.createToken)({name:"LogicalConstant",pattern:Ct.Lexer.NA}),_h=(0,Ct.createToken)({name:"LogicalTrue",pattern:/TRUE/i,longer_alt:ph,categories:yh}),Rh=(0,Ct.createToken)({name:"LogicalFalse",pattern:/FALSE/i,longer_alt:ph,categories:yh}),Ch=(0,Ct.createToken)({name:"NumericalConstant",pattern:/(?:[0-9]+(\.[0-9]*)?|\.[0-9]+)(?:E[+-]?[0-9]+)?/i}),wh=(0,Ct.createToken)({name:"StringConstant",pattern:/"(?:[^"]|"")*"/}),Eh=(0,Ct.createToken)({name:"OpenParen",pattern:/(?:\(|\uFF08)[ \t\r\n]*/}),kh=(0,Ct.createToken)({name:"CloseParen",pattern:/[ \t\r\n]*(?:\)|\uFF09)/}),Th=(0,Ct.createToken)({name:"FunctionName",pattern:new RegExp(String.raw(Me||(Me=(0,h.Z)(["(?:[A-Za-z_])(?:[A-Za-z_.0-9])*",""])),Eh.PATTERN.source))}),Sh=(0,Ct.createToken)({name:"OpenBrace",pattern:/{[ \t\r\n]*/}),Ah=(0,Ct.createToken)({name:"CloseBrace",pattern:/[ \t\r\n]*}/}),Ih=(0,Ct.createToken)({name:"Colon",pattern:/[ \t\r\n]*(?::|\uFF1A)[ \t\r\n]*/}),Oh=(0,Ct.createToken)({name:"ExclamationMark",pattern:/[ \t\r\n]*(?:!|\uFF01)[ \t\r\n]*/}),Vh=(0,Ct.createToken)({name:"Comma",pattern:/[ \t\r\n]*(?:,|\uFF0C)[ \t\r\n]*/}),Nh=(0,Ct.createToken)({name:"SemiColon",pattern:/[ \t\r\n]*(?:;|\uFF1B)[ \t\r\n]*/}),bh=(0,Ct.createToken)({name:"AdditionOperator",pattern:Ct.Lexer.NA}),Mh=(0,Ct.createToken)({name:"Plus",pattern:/[ \t\r\n]*\+[ \t\r\n]*/,categories:bh}),Fh=(0,Ct.createToken)({name:"Minus",pattern:/[ \t\r\n]*-[ \t\r\n]*/,categories:bh}),Zh=(0,Ct.createToken)({name:"MultiplicationOperator",pattern:Ct.Lexer.NA}),xh=(0,Ct.createToken)({name:"Multiply",pattern:/[ \t\r\n]*\*[ \t\r\n]*/,categories:Zh}),Dh=(0,Ct.createToken)({name:"Divide",pattern:/[ \t\r\n]*\/[ \t\r\n]*/,categories:Zh}),Ph=(0,Ct.createToken)({name:"Percent",pattern:/[ \t\r\n]*%[ \t\r\n]*/}),$h=(0,Ct.createToken)({name:"Power",pattern:/[ \t\r\n]*\^[ \t\r\n]*/}),Lh=(0,Ct.createToken)({name:"Concatenate",pattern:/[ \t\r\n]*&[ \t\r\n]*/}),Bh=(0,Ct.createToken)({name:"ComparisonOperator",pattern:Ct.Lexer.NA}),Uh=(0,Ct.createToken)({name:"LessThanEquals",pattern:/[ \t\r\n]*<=[ \t\r\n]*/,categories:Bh}),Hh=(0,Ct.createToken)({name:"GreaterThanEquals",pattern:/[ \t\r\n]*>=[ \t\r\n]*/,categories:Bh}),zh=(0,Ct.createToken)({name:"NotEquals",pattern:/[ \t\r\n]*<>[ \t\r\n]*/,categories:Bh}),Wh=(0,Ct.createToken)({name:"LessThan",pattern:/[ \t\r\n]*<[ \t\r\n]*/,categories:Bh}),Gh=(0,Ct.createToken)({name:"GreaterThan",pattern:/[ \t\r\n]*>[ \t\r\n]*/,categories:Bh}),jh=(0,Ct.createToken)({name:"Equals",pattern:/[ \t\r\n]*=[ \t\r\n]*/,categories:Bh}),Yh=(0,Ct.createToken)({name:"WhiteSpace",pattern:new RegExp("[ \t\r\n]+")}),qh=(0,Ct.createToken)({name:"SingleSheetPrefix",pattern:new RegExp("(?:".concat(dh,")").concat(Oh.PATTERN.source))}),Jh=(0,Ct.createToken)({name:"QuotedSingleSheetPrefix",pattern:new RegExp("(?:".concat(/'(?:[^']|'')*'/.source,")").concat(Oh.PATTERN.source))}),Kh=(0,Ct.createToken)({name:"LocalReferenceA1",pattern:hh,longer_alt:ph}),Xh=(0,Ct.createToken)({name:"LocalReferenceR1C1",pattern:nh,longer_alt:ph}),Qh=(0,Ct.createToken)({name:"ExternalReferenceA1",pattern:new RegExp("(?:(".concat(qh.PATTERN.source,")|(").concat(Jh.PATTERN.source,"))(?:(").concat(Kh.PATTERN.source,")|(").concat(gh.PATTERN.source,"))"))}),ef=(0,Ct.createToken)({name:"ExternalReferenceR1C1",pattern:new RegExp("(?:(".concat(qh.PATTERN.source,")|(").concat(Jh.PATTERN.source,"))(?:(").concat(Xh.PATTERN.source,")|(").concat(gh.PATTERN.source,"))"))}),tf=(0,Ct.createToken)({name:"FieldNameLocalReferenceA1",pattern:new RegExp("(?:".concat(/'(?:[^']|'')*'/.source,")")),longer_alt:Qh}),rf=(0,Ct.createToken)({name:"FieldNameLocalReferenceA1",pattern:new RegExp("(?:".concat(/'(?:[^']|'')*'/.source,")")),longer_alt:ef}),nf=[Th,tf,Qh,Kh,Ch,_h,Rh,yh,wh,Eh,kh,Sh,Ah,Ih,Oh,Vh,Nh,Mh,Fh,xh,Dh,Ph,$h,Lh,Uh,Hh,zh,Wh,Gh,jh,mh,gh,Jh,qh,ph,bh,Zh,Bh,Yh];var af=function(){var e={};return nf.forEach((function(t){e[t.name]=t})),e.LocalReferenceR1C1=Xh,e.ExternalReferenceR1C1=ef,e}(),of=nf.map((function(e,t){return e===Qh?ef:e===Kh?Xh:e===tf?rf:e})),uf=[Th,Ch,_h,Rh,yh,wh,Eh,kh,Sh,Ah,Ih,Oh,Vh,Nh,Mh,Fh,xh,Dh,Ph,$h,Lh,Uh,Hh,zh,Wh,Gh,jh,mh,gh,Jh,qh,ph,Qh,Kh,bh,Zh,Bh,Yh],sf=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,null,[{key:"getTractorLexerA1",value:function(){return null==this.tractorLexerA1&&(this.tractorLexerA1=new t(nf,{skipValidations:!0})),this.tractorLexerA1}},{key:"getTractorLexerR1C1",value:function(){return null==this.tractorLexerR1C1&&(this.tractorLexerR1C1=new t(of,{skipValidations:!0})),this.tractorLexerR1C1}},{key:"dispose",value:function(){this.tractorLexerA1=null,this.tractorLexerR1C1=null}}]),t}(Ct.Lexer);function lf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"A1";switch(t){case"A1":var r=sf.getTractorLexerA1();return{lexingResult:r.tokenize(e),lexer:r};case"R1C1":var n=sf.getTractorLexerR1C1();return{lexingResult:n.tokenize(e),lexer:n};default:throw Error("RefStyle is not found!")}}var cf=["LocalReferenceA1","LocalReferenceR1C1","ExternalReferenceA1","ExternalReferenceR1C1","FieldNameLocalReferenceA1"],hf=["AdditionOperator","Plus","Minus","MultiplicationOperator","Multiply","Divide","Percent","Power","Concatenate","ComparisonOperator","LessThanEquals","GreaterThanEquals","NotEquals","LessThan","GreaterThan","Equals"];function ff(){return it.REF_ERR_VAR}function df(e,t){var r,n=t.visit(e.lhs),a=t.visit(e.rhs),o=n,i=a;n.rowFrom()>a.rowFrom()&&(o=(r=[a,n])[0],i=r[1]);var u=4&o.refStatus(),s=8&i.refStatus(),l=t.context,c=l.ref,h=l.relativeRef?o.rowFrom()-c.startRow:o.rowFrom();return new iu(h,i.rowFrom()-o.rowFrom()+1,t.context.ref.sheet(),u|s)}function vf(e,t){var r,n=t.visit(e.lhs),a=t.visit(e.rhs),o=n,i=a;n.colFrom()>a.colFrom()&&(o=(r=[a,n])[0],i=r[1]);var u=1&o.refStatus(),s=2&i.refStatus(),l=t.context,c=l.ref,h=l.relativeRef?o.colFrom()-c.startCol:o.colFrom();return new nu(h,i.colFrom()-o.colFrom()+1,t.context.ref.sheet(),u|s)}function pf(e,t){var r,n;t.context.refStyle&&"R1C1"===t.context.refStyle?(r=t.visit(e.r1C1Row),n=t.visit(e.r1C1Column)):(r=t.visit(e.a1Row),n=t.visit(e.a1Column));var a=t.context,o=a.ref,i=a.relativeRef,u=i?r.rowFrom()-o.startRow:r.rowFrom(),s=i?n.colFrom()-o.startCol:n.colFrom();return new uu(u,s,t.context.ref.sheet(),r.refStatus()|n.refStatus())}function mf(e,t){var r,n=t.visit(e.lhs),a=t.visit(e.rhs),o=n,i=a,u=n.rowFrom(),s=a.rowFrom();(u>s||u===s&&n.colFrom()>a.colFrom())&&(o=(r=[a,n])[0],i=r[1]);var l=o,c=i,h=5&l.refStatus(),f=10&c.refStatus(),d=t.context,v=d.ref,p=d.relativeRef,m=p?l.rowFrom()-v.startRow:l.rowFrom(),g=p?l.colFrom()-v.startCol:l.colFrom();return new ou(m,g,c.rowFrom()-l.rowFrom()+1,c.colFrom()-l.colFrom()+1,t.context.ref.sheet(),h|f)}function gf(e,t){var r;if(e.QuotedSingleSheetPrefix){var n=e.QuotedSingleSheetPrefix[0].image;r=n.substring(1,n.length-2).replace(/\'\'/g,"'")}else if(e.SingleSheetPrefix){var a=e.SingleSheetPrefix[0].image;r=a.substring(0,a.length-1)}var o=t.context.spread.getSheetFromName(r),i=t.visit(e.localReference);return i instanceof eu?(i.setSheet(o),null==o&&(i.sheetName=r),i):it.REF_ERR_VAR}var yf,_f="[1-9][0-9]{0,6}";!function(e){e.A1_RELATIVE_COLUMN="A1RelativeColumn",e.A1_RELATIVE_ROW="A1RelativeRow",e.R1C1_RELATIVE_COLUMN="R1C1RelativeColumn",e.R1C1_RELATIVE_ROW="R1C1RelativeRow",e.R1C1_ABSOLUTE_COLUMN="R1C1AbsoluteColumn",e.R1C1_ABSOLUTE_ROW="R1C1AbsoluteRow",e.WHITE_SPACE_IN_REF="WhiteSpaceInRef",e.DOLLAR="Dollar",e.COLON="Colon",e.REF_CONSTANT="RefConstant",e.SINGLE_SHEET_PREFIX="SingleSheetPrefix",e.QUOTED_SINGLE_SHEET_PREFIX="QuotedSingleSheetPrefix"}(yf||(yf={}));var Rf=(0,Ct.createToken)({name:"A1RelativeColumn",pattern:/[a-zA-Z]{1,3}/,longer_alt:af.SingleSheetPrefix}),Cf=(0,Ct.createToken)({name:"A1RelativeRow",pattern:new RegExp(_f),longer_alt:af.SingleSheetPrefix}),wf=(0,Ct.createToken)({name:"R1C1RelativeColumn",pattern:/C\[-?(?:0|[1-9][0-9]*)\]/}),Ef=(0,Ct.createToken)({name:"R1C1RelativeRow",pattern:/R\[-?(?:0|[1-9][0-9]*)\]/}),kf=(0,Ct.createToken)({name:"R1C1AbsoluteColumn",pattern:new RegExp("C".concat("[1-9][0-9]{0,4}")),longer_alt:af.SingleSheetPrefix}),Tf=(0,Ct.createToken)({name:"R1C1AbsoluteRow",pattern:new RegExp("R".concat(_f)),longer_alt:af.SingleSheetPrefix}),Sf=(0,Ct.createToken)({name:"WhiteSpaceInRef",pattern:/[ \t\r\n]+/,group:Ct.Lexer.SKIPPED}),Af=(0,Ct.createToken)({name:"Dollar",pattern:/\$/}),If=[Sf,Rf,Cf,Af,af.Colon,af.RefConstant,af.QuotedSingleSheetPrefix,af.SingleSheetPrefix],Of=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,null,[{key:"getRefLexerA1",value:function(){return null==this.refLexerA1&&(this.refLexerA1=new t(If,{skipValidations:!0})),this.refLexerA1}},{key:"getRefLexerR1C1",value:function(){return null==this.refLexerR1C1&&(this.refLexerR1C1=new t(Vf,{skipValidations:!0})),this.refLexerR1C1}},{key:"dispose",value:function(){this.refLexerA1=null,this.refLexerR1C1=null}}]),t}(Ct.Lexer),Vf=[Sf,wf,Ef,kf,Tf,af.Colon,af.RefConstant,af.QuotedSingleSheetPrefix,af.SingleSheetPrefix];function Nf(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"A1",r=Of.getRefLexerA1(),n=Of.getRefLexerR1C1();switch(t){case"A1":return{lexingResult:r.tokenize(e),lexer:r};case"R1C1":return{lexingResult:n.tokenize(e),lexer:n};default:throw Error("RefStyle is not found!")}}var bf=[Sf,Rf,Cf,wf,Ef,kf,Tf,Af,af.Colon,af.RefConstant,af.QuotedSingleSheetPrefix,af.SingleSheetPrefix];var Mf,Ff=function(){var e={};return bf.forEach((function(t){e[t.name]=t})),e}(),Zf=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"A1";(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,e,{skipValidations:!0,maxLookahead:5}))).refStyle=n;var a=(0,c.Z)(r);return a.RULE("reference",(function(){a.OR([{ALT:function(){return a.SUBRULE(a.localReference)}},{ALT:function(){return a.SUBRULE(a.externalReference)}}])})),a.RULE("localReference",(function(){switch(r.refStyle){case"A1":a.OR([{ALT:function(){return a.SUBRULE(a.a1ColumnReference)}},{ALT:function(){return a.SUBRULE(a.a1RowReference)}},{ALT:function(){return a.SUBRULE(a.a1AreaReference)}},{ALT:function(){return a.SUBRULE(a.a1CellReference)}},{ALT:function(){return a.CONSUME(Ff.RefConstant)}}]);break;case"R1C1":a.OR([{ALT:function(){return a.SUBRULE(a.r1C1ColumnReference)}},{ALT:function(){return a.SUBRULE(a.r1C1RowReference)}},{ALT:function(){return a.SUBRULE(a.r1C1AreaReference)}},{ALT:function(){return a.SUBRULE(a.r1C1CellReference)}},{ALT:function(){return a.CONSUME(Ff.RefConstant)}}]);break;default:throw Error("RefStyle is not found!")}})),a.RULE("externalReference",(function(){switch(r.refStyle){case"A1":case"R1C1":a.OR([{ALT:function(){return a.CONSUME(Ff.SingleSheetPrefix)}},{ALT:function(){return a.CONSUME(Ff.QuotedSingleSheetPrefix)}}]);break;default:throw Error("RefStyle is not found!")}a.SUBRULE(a.localReference)})),a.RULE("a1ColumnReference",(function(){a.SUBRULE(a.a1Column,{LABEL:"lhs"}),a.CONSUME(Ff.Colon),a.SUBRULE2(a.a1Column,{LABEL:"rhs"})})),a.RULE("a1RowReference",(function(){a.SUBRULE(a.a1Row,{LABEL:"lhs"}),a.CONSUME(Ff.Colon),a.SUBRULE2(a.a1Row,{LABEL:"rhs"})})),a.RULE("a1AreaReference",(function(){a.SUBRULE(a.a1CellReference,{LABEL:"lhs"}),a.CONSUME(Ff.Colon),a.SUBRULE2(a.a1CellReference,{LABEL:"rhs"})})),a.RULE("a1CellReference",(function(){a.SUBRULE(a.a1Column),a.SUBRULE(a.a1Row)})),a.RULE("a1Column",(function(){a.OR([{ALT:function(){return a.CONSUME(Ff.A1RelativeColumn)}},{ALT:function(){return a.SUBRULE(a.a1AbsoluteColumn)}}])})),a.RULE("a1AbsoluteColumn",(function(){a.CONSUME(Ff.Dollar),a.CONSUME(Ff.A1RelativeColumn)})),a.RULE("a1Row",(function(){a.OR([{ALT:function(){return a.CONSUME(Ff.A1RelativeRow)}},{ALT:function(){return a.SUBRULE(a.a1AbsoluteRow)}}])})),a.RULE("a1AbsoluteRow",(function(){a.CONSUME(Ff.Dollar),a.CONSUME(Ff.A1RelativeRow)})),a.RULE("r1C1ColumnReference",(function(){a.SUBRULE(a.r1C1Column,{LABEL:"lhs"}),a.CONSUME(Ff.Colon),a.SUBRULE2(a.r1C1Column,{LABEL:"rhs"})})),a.RULE("r1C1RowReference",(function(){a.SUBRULE(a.r1C1Row,{LABEL:"lhs"}),a.CONSUME(Ff.Colon),a.SUBRULE2(a.r1C1Row,{LABEL:"rhs"})})),a.RULE("r1C1AreaReference",(function(){a.SUBRULE(a.r1C1CellReference,{LABEL:"lhs"}),a.CONSUME(Ff.Colon),a.SUBRULE2(a.r1C1CellReference,{LABEL:"rhs"})})),a.RULE("r1C1CellReference",(function(){a.SUBRULE(a.r1C1Row),a.SUBRULE(a.r1C1Column)})),a.RULE("r1C1Column",(function(){a.OR([{ALT:function(){return a.CONSUME(Ff.R1C1RelativeColumn)}},{ALT:function(){return a.CONSUME(Ff.R1C1AbsoluteColumn)}}])})),a.RULE("r1C1Row",(function(){a.OR([{ALT:function(){return a.CONSUME(Ff.R1C1RelativeRow)}},{ALT:function(){return a.CONSUME(Ff.R1C1AbsoluteRow)}}])})),r.performSelfAnalysis(),r}return(0,p.Z)(t,e),(0,_.Z)(t,null,[{key:"getRefParserA1",value:function(){return null==this.refParserA1&&(this.refParserA1=new t(If,"A1")),this.refParserA1}},{key:"getRefParserR1C1",value:function(){return null==this.refParserR1C1&&(this.refParserR1C1=new t(Vf,"R1C1")),this.refParserR1C1}},{key:"dispose",value:function(){this.refParserA1=null,this.refParserR1C1=null}}]),t}(Ct.CstParser);!function(e){e.reference="reference",e.localReference="localReference",e.externalReference="externalReference",e.a1ColumnReference="a1ColumnReference",e.a1RowReference="a1RowReference",e.a1AreaReference="a1AreaReference",e.a1CellReference="a1CellReference",e.a1Column="a1Column",e.a1AbsoluteColumn="a1AbsoluteColumn",e.a1Row="a1Row",e.a1AbsoluteRow="a1AbsoluteRow",e.r1C1ColumnReference="r1C1ColumnReference",e.r1C1RowReference="r1C1RowReference",e.r1C1AreaReference="r1C1AreaReference",e.r1C1CellReference="r1C1CellReference",e.r1C1Column="r1C1Column",e.r1C1Row="r1C1Row"}(Mf||(Mf={}));var xf=null,Df=null;function Pf(){if(null!=xf)return xf;if(null==Df){var e=Zf.getRefParserA1().getBaseCstVisitorConstructor();Df=function(e){return function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"visitTree",value:function(e,t){this.context=t;var r=this.visit(e);return this.context=null,r}},{key:"reference",value:function(e){if(void 0!==e.localReference)return this.visit(e.localReference);if(void 0!==e.externalReference)return this.visit(e.externalReference);throw new Error("Invalid token in the reference expression!")}},{key:"localReference",value:function(e){if(void 0!==e.a1ColumnReference)return this.visit(e.a1ColumnReference);if(void 0!==e.a1RowReference)return this.visit(e.a1RowReference);if(void 0!==e.a1AreaReference)return this.visit(e.a1AreaReference);if(void 0!==e.a1CellReference)return this.visit(e.a1CellReference);if(void 0!==e.RefConstant)return ff();throw new Error("Invalid token in the localReference expression!")}},{key:"externalReference",value:function(e){return gf(e,this)}},{key:"a1ColumnReference",value:function(e){return vf(e,this)}},{key:"a1RowReference",value:function(e){return df(e,this)}},{key:"a1CellReference",value:function(e){return pf(e,this)}},{key:"a1AreaReference",value:function(e){return mf(e,this)}},{key:"a1Column",value:function(e){if(void 0!==e.A1RelativeColumn)return this.visitA1RelativeColumn(e);if(void 0!==e.a1AbsoluteColumn)return this.visit(e.a1AbsoluteColumn);throw new Error("Invalid token in the a1Column expression!")}},{key:"a1Row",value:function(e){if(void 0!==e.A1RelativeRow)return this.visitA1RelativeRow(e);if(void 0!==e.a1AbsoluteRow)return this.visit(e.a1AbsoluteRow);throw new Error("Invalid token in the a1Row expression!")}},{key:"a1AbsoluteColumn",value:function(e){var t=e.A1RelativeColumn[0].image,r=(0,Ce.pen)(t);if(r>=bo)throw new Error('Column number cannot be greater than "XFD"!');return new nu(r,1,this.context.ref.sheet(),3)}},{key:"a1AbsoluteRow",value:function(e){var t=parseInt(e.A1RelativeRow[0].image,10)-1;if(t>=No)throw new Error("Row number cannot be greater than 1048576!");return new iu(t,1,this.context.ref.sheet(),12)}},{key:"visitA1RelativeColumn",value:function(e){var t=e.A1RelativeColumn[0].image,r=(0,Ce.pen)(t);if(r>=bo)throw new Error('Column number cannot be greater than "XFD"!');return new nu(r,1,this.context.ref.sheet())}},{key:"visitA1RelativeRow",value:function(e){var t=parseInt(e.A1RelativeRow[0].image,10)-1;if(t>=No)throw new Error("Row number cannot be greater than 1048576!");return new iu(t,1,this.context.ref.sheet())}}]),t}(e)}(e)}return xf=new Df}var $f=1048575;var Lf=null,Bf=null;function Uf(){if(null!=Lf)return Lf;if(null==Bf){var e=Zf.getRefParserA1().getBaseCstVisitorConstructor();Bf=function(e){return function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"visitTree",value:function(e,t){this.context=t;var r=this.visit(e);return this.context=null,r}},{key:"reference",value:function(e){if(void 0!==e.localReference)return this.visit(e.localReference);if(void 0!==e.externalReference)return this.visit(e.externalReference);throw new Error("Invalid token in the reference expression!")}},{key:"localReference",value:function(e){if(void 0!==e.r1C1RowReference)return this.visit(e.r1C1RowReference);if(void 0!==e.r1C1ColumnReference)return this.visit(e.r1C1ColumnReference);if(void 0!==e.r1C1AreaReference)return this.visit(e.r1C1AreaReference);if(void 0!==e.r1C1CellReference)return this.visit(e.r1C1CellReference);if(void 0!==e.RefConstant)return ff();throw new Error("Invalid token in the localReference expression!")}},{key:"externalReference",value:function(e){return gf(e,this)}},{key:"r1C1ColumnReference",value:function(e){return vf(e,this)}},{key:"r1C1RowReference",value:function(e){return df(e,this)}},{key:"r1C1CellReference",value:function(e){return pf(e,this)}},{key:"r1C1AreaReference",value:function(e){return mf(e,this)}},{key:"r1C1Column",value:function(e){if(void 0!==e.R1C1RelativeColumn)return this.visitR1C1RelativeColumn(e);if(void 0!==e.R1C1AbsoluteColumn)return this.visitR1C1AbsoluteColumn(e);throw new Error("Invalid token in the r1C1Column expression!")}},{key:"r1C1Row",value:function(e){if(void 0!==e.R1C1RelativeRow)return this.visitR1C1RelativeRow(e);if(void 0!==e.R1C1AbsoluteRow)return this.visitR1C1AbsoluteRow(e);throw new Error("Invalid token in the r1C1Row expression!")}},{key:"visitR1C1RelativeColumn",value:function(e){var t=e.R1C1RelativeColumn[0].image,r=parseInt(t.substring(2,t.length-1),10),n=this.context.ref.colFrom()+r;if(0>n||n>16383)throw new Error("Relative R1C1 column number is out of range!");return new nu(n,1,this.context.ref.sheet())}},{key:"visitR1C1AbsoluteColumn",value:function(e){var t=e.R1C1AbsoluteColumn[0].image,r=parseInt(t.substring(1),10)-1;if(r>16383)throw new Error("Column number cannot be greater than 16384!");return new nu(r,1,this.context.ref.sheet(),3)}},{key:"visitR1C1RelativeRow",value:function(e){var t=e.R1C1RelativeRow[0].image,r=parseInt(t.substring(2,t.length-1),10),n=this.context.ref.rowFrom()+r;if(0>n||n>$f)throw new Error("Relative R1C1 row number is out of range!");return new iu(n,1,this.context.ref.sheet())}},{key:"visitR1C1AbsoluteRow",value:function(e){var t=e.R1C1AbsoluteRow[0].image,r=parseInt(t.substring(1),10)-1;if(r>$f)throw new Error("Row number cannot be greater than 1048576!");return new iu(r,1,this.context.ref.sheet(),12)}}]),t}(e)}(e)}return Lf=new Bf}var Hf=null,zf=null;function Wf(){if(null!=Hf)return Hf;if(null==zf){var e=Zf.getRefParserA1().getBaseCstVisitorConstructor();zf=function(e){return function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"visitRefConstant",value:function(e){return null}},{key:"reference",value:function(e){if(e.localReference)return this.visit(e.localReference);if(e.externalReference)return this.visit(e.externalReference);throw new Error("Invalid token in the reference expression!")}},{key:"localReference",value:function(e){if(e.a1ColumnReference)return this.visit(e.a1ColumnReference);if(e.a1RowReference)return this.visit(e.a1RowReference);if(e.a1AreaReference)return this.visit(e.a1AreaReference);if(e.a1CellReference)return this.visit(e.a1CellReference);if(e.RefConstant)return this.visitRefConstant(e.RefConstant);throw new Error("Invalid token in the localReference expression!")}},{key:"externalReference",value:function(e){var t,r=this.visit(e.localReference[0]);if(null==r)return null;if(e.QuotedSingleSheetPrefix){var n=e.QuotedSingleSheetPrefix[0].image;t=n.substring(1,n.length-2).replace(/\'\'/g,"'")}else if(e.SingleSheetPrefix){var a=e.SingleSheetPrefix[0].image;t=a.substring(0,a.length-1)}return r.sheetName=t,r}},{key:"a1ColumnReference",value:function(e){var t,r=this.visit(e.lhs),n=this.visit(e.rhs),a=r,o=n;return r.col>n.col&&(a=(t=[n,r])[0],o=t[1]),{type:Ce.xj7.COL,col:a.col,colCount:o.col-a.col+1}}},{key:"a1RowReference",value:function(e){var t,r=this.visit(e.lhs),n=this.visit(e.rhs),a=r,o=n;return r.row>n.row&&(a=(t=[n,r])[0],o=t[1]),{type:Ce.xj7.ROW,row:a.row,rowCount:o.row-a.row+1}}},{key:"a1AreaReference",value:function(e){var t=this.visit(e.lhs),r=this.visit(e.rhs),n=Math.min(t.row,r.row),a=Math.max(t.row,r.row),o=Math.min(t.col,r.col),i=Math.max(t.col,r.col);return{type:Ce.xj7.NORMAL,row:n,col:o,rowCount:a-n+1,colCount:i-o+1}}},{key:"a1CellReference",value:function(e){var t=this.visit(e.a1Row).row,r=this.visit(e.a1Column).col;return{type:Ce.xj7.CELL,row:t,col:r,rowCount:1,colCount:1}}},{key:"a1Column",value:function(e){if(e.A1RelativeColumn)return this.visitA1RelativeColumn(e);if(e.a1AbsoluteColumn)return this.visit(e.a1AbsoluteColumn);throw new Error("Invalid token in the a1Column expression!")}},{key:"a1Row",value:function(e){if(e.A1RelativeRow)return this.visitA1RelativeRow(e);if(e.a1AbsoluteRow)return this.visit(e.a1AbsoluteRow);throw new Error("Invalid token in the a1Row expression!")}},{key:"visitA1RelativeColumn",value:function(e){var t=e.A1RelativeColumn[0].image,r=(0,Ce.pen)(t);return{type:Ce.xj7.COL,col:r,colCount:1}}},{key:"a1AbsoluteColumn",value:function(e){return this.visitA1RelativeColumn(e)}},{key:"visitA1RelativeRow",value:function(e){var t=parseInt(e.A1RelativeRow[0].image,10)-1;return{type:Ce.xj7.ROW,row:t,rowCount:1}}},{key:"a1AbsoluteRow",value:function(e){return this.visitA1RelativeRow(e)}}]),t}(e)}(e)}return Hf=new zf}var Gf=255;function jf(){for(var e=[95,48,46,63,36,92,65,97,162,170,181,186,192,216,248,546,592,688,699,720,736,750,890,902,904,908,910,931,976,986,1024,1164,1223,1227,1232,1272,1329,1369,1377,1488,1520,1569,1600,1649,1749,1765,1786,1808,1810,1920,2309,2365,2384,2392,2437,2447,2451,2474,2482,2486,2524,2527,2544,2565,2575,2579,2602,2610,2613,2616,2649,2654,2674,2693,2701,2703,2707,2730,2738,2741,2749,2768,2784,2821,2831,2835,2858,2866,2870,2877,2908,2911,2949,2958,2962,2969,2972,2974,2979,2984,2990,2999,3077,3086,3090,3114,3125,3168,3205,3214,3218,3242,3253,3294,3296,3333,3342,3346,3370,3424,3461,3482,3507,3517,3520,3585,3634,3647,3713,3716,3719,3722,3725,3732,3737,3745,3749,3751,3754,3757,3762,3773,3776,3782,3804,3840,3904,3913,3976,4096,4131,4137,4176,4256,4304,4352,4447,4520,4608,4616,4680,4682,4688,4696,4698,4704,4744,4746,4752,4784,4786,4792,4800,4802,4808,4816,4824,4848,4880,4882,4888,4896,4936,5024,5121,5743,5761,5792,6016,6107,6176,6272,7680,7840,7936,7960,7968,8008,8016,8025,8027,8029,8031,8064,8118,8126,8130,8134,8144,8150,8160,8178,8182,8255,8319,8352,8450,8455,8458,8469,8473,8484,8486,8488,8490,8495,8499,8544,12293,12321,12337,12344,12353,12445,12449,12549,12593,12704,13312,19968,40960,44032,63744,64256,64275,64285,64287,64298,64312,64318,64320,64323,64326,64467,64848,64914,65008,65075,65101,65129,65136,65140,65142,65284,65313,65343,65345,65381,65474,65482,65490,65498,65504,65509],t=[95,57,46,63,36,92,90,122,165,170,181,186,214,246,543,563,685,696,705,721,740,750,890,902,906,908,929,974,983,1011,1153,1220,1224,1228,1269,1273,1366,1369,1415,1514,1522,1594,1610,1747,1749,1766,1788,1808,1836,1957,2361,2365,2384,2401,2444,2448,2472,2480,2482,2489,2525,2529,2547,2570,2576,2600,2608,2611,2614,2617,2652,2654,2676,2699,2701,2705,2728,2736,2739,2745,2749,2768,2784,2828,2832,2856,2864,2867,2873,2877,2909,2913,2954,2960,2965,2970,2972,2975,2980,2986,2997,3001,3084,3088,3112,3123,3129,3169,3212,3216,3240,3251,3257,3294,3297,3340,3344,3368,3385,3425,3478,3505,3515,3517,3526,3632,3635,3654,3714,3716,3720,3722,3725,3735,3743,3747,3749,3751,3755,3760,3763,3773,3780,3782,3805,3840,3911,3946,3979,4129,4135,4138,4181,4293,4342,4441,4514,4601,4614,4678,4680,4685,4694,4696,4701,4742,4744,4749,4782,4784,4789,4798,4800,4805,4814,4822,4846,4878,4880,4885,4894,4934,4954,5108,5740,5750,5786,5866,6067,6107,6263,6312,7835,7929,7957,7965,8005,8013,8023,8025,8027,8029,8061,8116,8124,8126,8132,8140,8147,8155,8172,8180,8188,8256,8319,8367,8450,8455,8467,8469,8477,8484,8486,8488,8493,8497,8505,8579,12295,12329,12341,12346,12436,12446,12542,12588,12686,12727,19893,40869,42124,55203,64045,64262,64279,64285,64296,64310,64316,64318,64321,64324,64433,64829,64911,64967,65019,65076,65103,65129,65138,65140,65276,65284,65338,65343,65370,65470,65479,65487,65495,65500,65505,65510],r=new Array(65534).fill(!1),n=0;n<e.length;n++)for(var a=t[n],o=e[n];o<=a;o++)r[o]=!0;return r}var Yf=null;function qf(e,t){var r=e.trim();if(function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e.length>Gf||0===e.length)return!1;if(t)return!0;var r=e.toUpperCase();if("TRUE"===r||"FALSE"===r)return!1;var n=/^[^~/@` !-,:->\^\-\[\]\\]*$/;if(/^[0-9.?]/.test(e)||!n.test(e))return!1;null==Yf&&(Yf=jf());for(var a=0,o=0;o<e.length;o++)Yf[e.charCodeAt(o)]&&(a+=1);return a===e.length}(r)){var n=it.NAME_ERR_VAR.clone();return n.setSpecialInfo({errorInfo:r}),n}return null}function Jf(e,t,r){var n=e.trim();if(function(e){return!(e.length>Gf||0===e.length)}(n)){if(null!=r&&r.has(n)){var a=new ou(0,0,1,1,t.spread.getActiveSheet());return a.setNamespace(n),a}var o=it.NAME_ERR_VAR.clone();return o.setSpecialInfo({errorInfo:n}),o}return null}var Kf=new RegExp("^(".concat(af.LocalReferenceA1.PATTERN.source,")$")),Xf=new RegExp("^(".concat(af.ExternalReferenceA1.PATTERN.source,")$")),Qf=new RegExp("^(".concat(af.LocalReferenceR1C1.PATTERN.source,")$")),ed=new RegExp("^(".concat(af.ExternalReferenceR1C1.PATTERN.source,")$"));function td(e){var t=e.trim();return Kf.test(t)||Xf.test(t)||Qf.test(t)||ed.test(t)}function rd(e){var t=af.LocalReferenceA1,r=af.ExternalReferenceA1,n=af.LocalReferenceR1C1,a=af.ExternalReferenceR1C1,o=[];return(o=Array.from(e.matchAll(new RegExp(a.PATTERN.source,"g")))).length||((o=Array.from(e.matchAll(new RegExp(r.PATTERN.source,"g")))).length||((o=Array.from(e.matchAll(new RegExp(n.PATTERN.source,"g")))).length||(o=Array.from(e.matchAll(new RegExp(t.PATTERN.source,"g")))).length)),o}function nd(e,t){t.refStyle||(t.refStyle="A1");var r,n=Nf(e,t.refStyle).lexingResult;switch(t.refStyle){case"A1":r=Zf.getRefParserA1();break;case"R1C1":r=Zf.getRefParserR1C1();break;default:throw Error("RefStyle is not found!")}if(n.errors.length>0)return console.log("lexing error: ",n.errors[0].message),null;r.input=n.tokens;var a=r.reference();return r.errors.length>0?(console.log("parsing error: ",r.errors[0].message),null):(t&&"R1C1"===t.refStyle?Uf():Pf()).visitTree(a,t)}function ad(e,t){if(!td(e))return qf(e);try{return nd(e,t)}catch(e){return null}}function od(e){if(!td(e))return null;var t=Nf(e,"A1").lexingResult,r=Zf.getRefParserA1();r.input=t.tokens;var n=r.reference();return t.errors.length>0||r.errors.length>0?null:Wf().visit(n)}function id(e,t){var r=null;switch(e.type){case Ce.xj7.ROW:var n=e.row+1;r="".concat(n,":").concat(n+e.rowCount-1);break;case Ce.xj7.COL:r="".concat((0,Ce.hdC)(e.col),":").concat((0,Ce.hdC)(e.col+e.colCount-1));break;case Ce.xj7.CELL:var a=e.row+1;r="".concat((0,Ce.hdC)(e.col)).concat(a);break;case Ce.xj7.NORMAL:var o=e.row+1,i=o+e.rowCount-1;r="".concat((0,Ce.hdC)(e.col)).concat(o,":").concat((0,Ce.hdC)(e.col+e.colCount-1)).concat(i);break;default:return null}var u=(null==t?void 0:t.escapeSheetNameFunc)||Bo;return(!t||t.isShowSheetName)&&e.hasOwnProperty("sheetName")&&e.sheetName.length>0&&(r="".concat(u(e.sheetName),"!").concat(r)),r}var ud=new Set,sd=new Set(["OFFSET","INDEX"]);function ld(e){for(var t=e.length-1;t>=0;t--){var r=e[t];if(!r.isOp())return!1;var n=r.op();if(ud.has(n.name))return!0;if(!(n instanceof it.ParenOp))return!1}return!1}function cd(e){for(var t=e.length-1;t>=0;t--){var r=e[t];if("OG1"!==r){if(r.startsWith("M"))return!0;if(!r.startsWith("F"))return!1;var n=r.split(":")[1];if(""===n||void 0===n)return!1;if(ud.has(n))return!0;break}}return!1}function hd(e){var t=e.getSpecialInfo();return null!=(null==t?void 0:t.link)?t.link:e.getValue()}function fd(e){var t=e.getValue();if("string"==typeof t){var r=od(t);if(r){var n=id(r,{isShowSheetName:!0});if(n)return n}return t}}function dd(e,t){for(var r=e.getRef(),n=e.getFormulaService(),a=[],o=[],i=t.length-1;i>1;i--){var u=t[i];if(u.isOp()&&"IMPORTRANGE"===u.op().name){if(2!==u.getArgCount())return;a.push(i)}}if(a.length){for(var s=0;s<a.length;s++){var l=a[s];try{var c=vd(t,l);if(2!==c.length)return;var h=uv(av(n.spread,n),e),f=[],d=l-c[1];iv(h,new mc(new md(null),h,d+c[1]-1,d,t,r),f);var v=fd(f.pop());if("string"!=typeof v)return;var p=d-c[0];iv(h,new mc(new md(null),h,p+c[0]-1,p,t,r),f);var m=hd(f.pop());if("string"!=typeof m)return;o.push({url:m,range:v,isSyncStyle:!1})}catch(e){return}}return o}}function vd(e,t){var r=e[t];if(!r.isOp())return[];var n=r.getArgCount();if(0===n)return[];var a=new Array(n);t--;for(var o=0;o<n;o++){var i=pd(e,t);a[n-o-1]=i,t-=i}return a}function pd(e,t){return e[t].isOp()?vd(e,t).reduce((function(e,t){return e+t}),0)+1:1}var md=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"do",value:function(e,t){return t.length&&(t[t.length-1]=t[t.length-1].at(0,0)),null}},{key:"isPreRef",value:function(){return 3}}]),t}(Ts);function gd(e,t){var r=t.toUpperCase();if(it.ERROR_VAR_MAP[r])return it.ERROR_VAR_MAP[r];if(it.BOOLEAN_VAR_MAP[r])return it.BOOLEAN_VAR_MAP[r];var n=""===t?go:new it.StringVar(t),a=n.toNumberVar(e);return a.isNumber()&&!function(e){for(var t=0,r=0,n=e.length-1;n>=0;n--){var a=e[n];if(!/\d/.test(a)){r=-1;break}("0"!==a||r>0)&&(r+=1),t="0"===a?t+1:0}return(r-=t)>15}(t)?a:n}function yd(e,t){return e.isString()?"S".concat(e.getValue()):e.isError()?"E".concat(e.errorType):e.isNull()?"E":!t&&e.isNumber()?"".concat(e.getCompareValue()):"".concat(e.getValue())}var _d=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).op=r,n.count=r.getArgCount(),n.isArray=e.isArray||ud.has(r.operator.name),n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"do",value:function(e,t){var r=this.op;e.isArray=e.isArray||this.isArray;var n=e.isArray;e.info.customData&&(e.info.customData=void 0);var a,o,i=r.getArgCount(),u=i>0?t.splice(t.length-i,i).reverse():[],s=[],l=!1,c=r.operator,h=c.$$minOperands,f=c.$$maxOperands,d=c.$$expanded;if(i<h||i>f){var v=it.ErrorCode.ARGUMENTS_COUNT_SHOULD_BE_BETWEEN;return h===f?v=it.ErrorCode.ARGUMENTS_COUNT_SHOULD_BE_EXACTLY:f===Co&&(v=it.ErrorCode.ARGUMENTS_COUNT_SHOULD_BE_AT_LEAST),Ac(this.last,e,t,it.tractorErrorVarCreators[v]({funcName:r.operator.name,argCount:i,requiredOperandCount:h,totalOperandCount:f}))}if(i>0)for(var p=r.operator.$$paramsDesc,m=0;m<i;++m){var y=p[m]||p[p.length-1],_=u[m];if(!e.skipRuntimeError&&ja(_)&&_.isRuntimeError())return Lc(e,this.last,_);if(256&y&&96&_.$$type)if(n&&1!==_.size())s.push([m,y,_]),l=!0;else if(ro(_)&&!eo(_)){var R=Qa(_)?null:xs(e.ref,_.getRef());if(R){if(to(_))throw new Error("unexpected UnCalculatedGridVar at argv[".concat(m,'] while calculating function "').concat(r.operator.name,'"'));_=_.get(R.startRow,R.startCol)}else _=it.VALUE_ERR_VAR;qa(_)&&(_=Fc(e.service,_,14&y)||_)}else _=_.at(0,0);if(255&_.$$type&y){if(640===_.$$type&&256&y){var C=e.formula.formula.params;if(_=C&&_.index<C.length?hc(C[_.index]):it.NAME_ERR_VAR,!(16&y)){if(!n)return Ac(this.last,e,t,_);s.push([m,y,_]),a=a||_}}}else if(16===_.$$type){if(!n)return Ac(this.last,e,t,_);s.push([m,y,_]),a=a||_}else{if(64==(96&y)&&(64&_.$$type||(_=Sl(r.operator.name,m+1)),!(16&y))){if(!n)return Ac(this.last,e,t,_);s.push([m,y,_]),a=a||_}if(31&_.$$type){var w=14&y;if(w&&_.$$type!==w){if(w!==Ro.Number&&w!==Ro.String&&w!==Ro.Boolean)throw new Error("unexpected type ".concat(_.$$type," (").concat(_.constructor.name,") at argv[").concat(m,'] while calculating function "').concat(r.operator.name,'", expecting ').concat(w));var E=Fc(e.service,_,w);if(!(E||(E=Rl(r.operator.name,m+1,El(_),wl(_),Cl(w)),16&y))){if(!n)return Ac(this.last,e,t,E);s.push([m,y,E]),a=a||E}_=E}}else if(128&_.$$type){if(640===_.$$type){var k=e.formula.formula.params;_=k&&_.index<k.length?hc(k[_.index]):it.NAME_ERR_VAR}else _=Rl(r.operator.name,m+1,El(_),wl(_),Cl(110&y));if(!(16&y)){if(!n)return Ac(this.last,e,t,_);s.push([m,y,_]),a=a||_}}}u[m]=_}if(n&&!l&&a)return Ac(this.last,e,t,a);var T=function(e,t,r){if(0===e.$$cacheType||0===t.length||1===e.$$cacheType&&!r)return null;for(var n=1,a=[],o=0,i=t.length;o<i;o++){var u=t[o];if(!Ba(u)){var s=u.rowCount(),l=u.colCount();if(n=Math.max(n,s*l),Ja(u)){if(!Qa(u)&&1===s&&1===l){var c=u.at(0,0);if(ao(c))return null;a.push(yd(c,!0));continue}if(u.hash){var h=u.hash();if(h){if(h.length>1e3)return null;a.push(h);continue}}}if(to(u)){var f=u.hash();if(f){a.push(f);continue}}return null}a.push(yd(u,!0))}return n<kc&&!r?null:"".concat(e.name,"_").concat(r?1:0,"(").concat(a.join(","),")")}(r.operator,u,n);if(T&&(o=e.funcCache.op.get(T)))return Ac(this.last,e,t,o,T);try{if(n&&s.length>0){if(r.operator.arrayFunc){var S=r.operator.arrayFunc(e,u);if(S)return Ac(this.last,e,t,S,T)}for(var A=1,I=1,O=0;O<s.length;O++){var V=s[O][2];A=Math.max(A,V.rowCount()),I=Math.max(I,V.colCount())}for(var N=new Array(A),b=Il(r.operator.name),M=new Rd(N,A,I,b,T,d),F=0;F<A;++F){var Z=N[F]=new Array(I);e:for(var x=0;x<I;++x){for(var D=0;D<s.length;++D){var P=(0,g.Z)(s[D],3),$=P[0],L=P[1],B=P[2],U=$c(B,F,x,b);if(!qa(U)||!ro(B)||128&L||(U=Fc(e.service,U,14&L)),255&U.$$type&L)u[$]=U;else{if(16===U.$$type){Z[x]=U;continue e}var H=14&L;if(H!==Ro.Number&&H!==Ro.String&&H!==Ro.Boolean)throw new Error("unexpected type ".concat(U.$$type," (").concat(U.constructor.name,") at [").concat(F,", ").concat(x,"] inside argv[").concat($,'] while calculating function "').concat(r.operator.name,'" in array mode, expecting ').concat(H));var z=Fc(e.service,U,H);if(!(z||(z=Rl(r.operator.name,$+1,El(U),wl(U),Cl(H)),16&L))){Z[x]=z;continue e}u[$]=z}}var W=r.operator.func(e,u);if(!e.skipRuntimeError&&ja(W)&&W.isRuntimeError())return Lc(e,this.last,W);M.add(F,x,W)}}return M.needCustomCalc()?Ac(this.last,e,t,M.getResult(),T):1===A&&1===I?Ac(this.last,e,t,N[0][0],T):(M.checkAndFill(),o=new gs(N,T),Ac(this.last,e,t,o,T))}var G=r.operator;return o=G.func(e,u),G.$$calcCustomData&&(e.info.customData||(e.info.customData=G.$$calcCustomData(e,u))),e.info.customData&&o.setSpecialInfo({customData:e.info.customData}),Ac(this.last,e,t,o,T)}catch(a){return console.log("[SHEET LOG] calc error",a),Lc(e,this.last,it.tractorErrorVarCreators[it.ErrorCode.DEFAULT_RUNTIME_ERROR]("Unknown error occurred during calculation."))}}},{key:"expectedType",value:function(){var e=this.op.operator.$$paramsDesc;if(!e.length)return null;var t=e[Math.min(this.count-1,e.length-1)];return 256&t&&!(128&t)?14&t:null}},{key:"circle",value:function(e,t){var r=this.op.getArgCount()-this.count;return t.splice(t.length-r,r),this.last}},{key:"isLazy",value:function(){var e=this.op.operator;if(e.$$lazy){var t=e.$$paramsDesc,r=t[Math.min(this.count-1,t.length-1)];if(1024&r)return!(2048&r&&this.isArray)}return!1}},{key:"isPreRef",value:function(){var e=this.op.operator.$$paramsDesc;if(!e.length)return 0;var t=e[Math.min(this.count-1,e.length-1)];return 256&t?this.isArray?1:2:t&(128|Ro.Ref)?0:1}}]),t}(Ts),Rd=function(){function e(t,r,n,a,o,i){(0,y.Z)(this,e),this.rowCount=r,this.colCount=n,this.na=a,this.hash=o,this.expanded=i,this.refs=[],this.expressions=[],this.refsIdx=[],this.exprIdx=[],this.calcStructs=[],this.maxRowCount=0,this.maxColCount=0,this.diffLength=!1,this.result=t}return(0,_.Z)(e,[{key:"add",value:function(e,t,r){var n,a;return to(r)?(this.refsIdx.push({i:e,j:t,idx:this.refs.length}),void this.refs.push(r.getRef())):no(r)?(this.exprIdx.push({i:e,j:t,idx:this.expressions.length}),void this.expressions.push(r)):r instanceof ks?(this.calcStructs.push({i:e,j:t,refIdx:this.refs.length,refCount:r.refs.length,exprIdx:this.expressions.length,exprCount:r.exprs.length,struct:r}),(n=this.refs).push.apply(n,(0,m.Z)(r.refs)),void(a=this.expressions).push.apply(a,(0,m.Z)(r.exprs))):(r=za(r)?Ic(r):r.toValidVar(),void this.addToResult(e,t,r))}},{key:"addToResult",value:function(e,t,r){if(!this.expanded||1===r.size())return this.result[e][t]=r.at(0,0),void(this.expanded&&(this.maxRowCount=Math.max(this.maxRowCount,this.rowCount),this.maxColCount=Math.max(this.maxColCount,this.colCount)));if(this.rowCount>1&&this.colCount>1)this.result[e][t]=$c(r,e,t,this.na);else if(1!==this.rowCount){if(1===this.colCount){var n=r.colCount();this.result[e]=this.result[e]||[];for(var a=0;a<n;a++)this.result[e][a]=$c(r,e,a,this.na);return this.maxColCount>0&&this.maxColCount!==n&&(this.diffLength=!0),void(this.maxColCount=Math.max(this.maxColCount,n))}}else{var o=r.rowCount();if(1===this.colCount)for(var i=r.colCount(),u=0;u<o;u++){this.result[u]=this.result[u]||[];for(var s=0;s<i;s++)this.result[u][s]=$c(r,u,s,this.na)}else{for(var l=0;l<o;l++)this.result[l]=this.result[l]||[],this.result[l][t]=$c(r,l,t,this.na);this.maxRowCount>0&&this.maxRowCount!==o&&(this.diffLength=!0),this.maxRowCount=Math.max(this.maxRowCount,o)}}}},{key:"checkAndFill",value:function(){if(this.diffLength)for(var e=Math.max(this.maxRowCount,this.rowCount),t=Math.max(this.maxColCount,this.colCount),r=0;r<e;r++)if(this.result[r])for(var n=this.result[r].length;n<t;n++)this.result[r][n]=it.NULL_VAR;else this.result[r]=new Array(t).fill(it.NULL_VAR)}},{key:"resize",value:function(e,t,r){var n=this.result,a=this.rowCount,o=this.colCount;if(this.rowCount=e,this.colCount=t,null!==r&&(r=this.na),n.length=e,r&&a<e)if(Ba(r))for(var i=a;i<e;++i)for(var u=n[i]||(n[i]=new Array(t)),s=0;s<t;++s)u[s]=r;else for(var l=a;l<e;++l){n[l]=new Array(t);for(var c=0;c<t;++c)this.addToResult(l,c,r)}if(t<o)for(var h=0;h<e;++h){var f=n[h];f&&(f.length=t)}else if(r&&o<t)if(Ba(r))for(var d=0;d<a;++d)for(var v=n[d]||(n[d]=new Array(t)),p=o;p<t;++p)v[p]=r;else for(var m=0;m<a;++m)for(var g=o;g<t;++g)this.addToResult(m,g,r)}},{key:"needCustomCalc",value:function(){return 0!==this.refs.length||0!==this.expressions.length}},{key:"getResult",value:function(){return new ks(this.refs,this.expressions,this)}},{key:"next",value:function(t,r){for(var n=0;n<this.refsIdx.length;n++){var a=this.refsIdx[n],o=a.i,i=a.j,u=t[a.idx];this.addToResult(o,i,u)}for(var s=0;s<this.exprIdx.length;s++){var l=this.exprIdx[s],c=l.i,h=l.j,f=r[l.idx];this.addToResult(c,h,f)}for(var d=null,v=0;v<this.calcStructs.length;v++){var p=this.calcStructs[v],m=p.i,g=p.j,y=p.refIdx,_=p.refCount,R=p.exprIdx,C=p.exprCount,w=p.struct,E=t.slice(y,y+_),k=r.slice(R,R+C),T=w.item.next(E,k);Ba(T)||Ja(T)?this.addToResult(m,g,T):(d||(d=new e(this.result,this.rowCount,this.colCount,this.na,this.hash,this.expanded)),d.add(m,g,T))}return d?d.getResult():1===this.rowCount&&1===this.colCount?this.result[0][0]:(this.checkAndFill(),new gs(this.result,this.hash))}}]),e}();var Cd=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,e.rowCount(),e.colCount()))).ref=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"customType",get:function(){return"RefMatrixVar"}}]),(0,_.Z)(t,[{key:"getVarByPos",value:function(e,t,r){return this.ref.getVarByPos(e,t,r)}}]),t}(ms),wd=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).ref=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"customType",get:function(){return"SheetRefVar"}}]),(0,_.Z)(t,[{key:"getSheetByRange",value:function(e){return e.sheet()||Ce.d$b[Ce.O6N.REF_INVALID_CELL_REFERENCE]({funcName:"",index:-1,value:""})}},{key:"toNumberVar",value:function(e){return this.nth(0).toNumberVar(e)}},{key:"toStringVar",value:function(){return this.nth(0).toStringVar()}},{key:"toBooleanVar",value:function(){return this.nth(0).toBooleanVar()}},{key:"isValid",value:function(){return this.getRef().isValid()}},{key:"toValidVar",value:function(){return this.isValid()?this:Ce.d$b[Ce.O6N.REF_INVALID_CELL_REFERENCE]({funcName:"",index:-1,value:""})}},{key:"iter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skipEmptyRef:!0};return void 0===e.skipEmptyRef&&(e.skipEmptyRef=!0),new rs([this.getRef()],e)}},{key:"iterWithPos",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skipEmptyRef:!0};void 0===e.skipEmptyRef&&(e.skipEmptyRef=!0);var t=new rs([this.getRef()],e),r=new Array(3);return t.map((function(e){return r[0]=e,r[1]=t.getCurrRow(),r[2]=t.getCurrCol(),r}))}},{key:"size",value:function(){return this.getRef().size(!0)}},{key:"getRawVarByIndex",value:function(e){var t=this.getRef(),r=this.getSheetByRange(t);if(r instanceof it.ErrorVar)return r;var n=t.colCount();return r.getVar(t.rowFrom()+Math.floor(e/n),t.colFrom()+e%n)}},{key:"getVarByPos",value:function(e,t,r){var n=this.getRef(),a=n.sheet().getVar(e+n.rowFrom(),t+n.colFrom());return Ba(a)?a:ts(a.getVar(r),r)}},{key:"nth",value:function(e,t){var r=this.getRawVarByIndex(e);return Ba(r)?r:ts(r.getVar(t),t)}},{key:"getRef",value:function(){return this.ref}},{key:"getVar",value:function(e){var t=this.getRef();if(!t.isValidRefInSheet(!0))return Ce.d$b[Ce.O6N.REF_INVALID_CELL_REFERENCE]({funcName:"",index:-1,value:""});if(1===this.size())return this.nth(0,e);if(!e)return Ce.d$b[Ce.O6N.INVALID_CELL_REFERENCE]({funcName:"",index:-1,value:""});var r=e.ref,n=r.rowFrom(),a=r.colFrom(),o=t.rowFrom(),i=t.colFrom(),u=t.rowTo(),s=t.colTo();return a>=i&&a<=s&&n>=o&&n<=u?t.sheet().getVar(n,a).getVar(e):a<i&&(n<o||n>u)||a>s&&(n<o||n>u)?it.VALUE_ERR_VAR:a>=i&&a<=s?o!==u?it.VALUE_ERR_VAR:t.sheet().getVar(o,a).getVar(e):n>=o&&n<=u?i!==s?it.VALUE_ERR_VAR:t.sheet().getVar(n,i).getVar(e):it.VALUE_ERR_VAR}},{key:"getValue",value:function(e){return this.getVar(e).getValue()}},{key:"rowCount",value:function(){return this.getRef().rowCount()}},{key:"colCount",value:function(){return this.getRef().colCount()}},{key:"toRefMatrix",value:function(){return new Cd(this)}},{key:"toPrimitiveMatrix",value:function(e){for(var t=this.rowCount(),r=this.colCount(),n=[],a=0;a<t;a++){n[a]||(n[a]=[]);for(var o=0;o<r;o++)n[a][o]=this.getVarByPos(a,o,e)}return new gs(n)}},{key:"isRef",value:function(){return!0}},{key:"equals",value:function(e){return e instanceof t&&this.getRef().equal(e.getRef())}},{key:"iterIf",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{skipEmptyRef:!0},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:rs;void 0===r.skipEmptyRef&&(r.skipEmptyRef=!0);var a=this.getRef(),o=new n([a],r),i={row:void 0,col:void 0};return o.filter((function(n){return i.row=o.getCurrRow(),i.col=o.getCurrCol(),e.every((function(e){return e(n,r,t,a,i)}))}))}},{key:"getFormatterByPos",value:function(e,t,r){var n=this.getRef();e+=n.rowFrom(),t+=n.colFrom();var a=this.getSheetByRange(n);return a instanceof it.ErrorVar?a:a.getActualFormatter(e,t,r)}},{key:"getValueByPos",value:function(e,t,r){return this.getVarByPos(e,t,r).getValue()}},{key:"clone",value:function(){return new t(this.getRef().clone())}}]),t}(it.BaseCustomCollectionVar);function Ed(e){return e instanceof ms}function kd(e){return e.isCustomCollection()&&"PrimitiveMatrixVar"===e.customType}function Td(e){return e instanceof wd}function Sd(e){return e.isCustomCollection()&&"ProxyRefVar"===e.customType}function Ad(e,t,r){var n=e.colCount(),a=Math.min(Math.max(0,t),n-1),o=Math.min(Math.max(1,r),n-a);if(0===a&&n===o)return e;if(Xa(e)){var i=e.getRef();return new Ss(new Qi(i.startRow,i.endRow,i.startCol+a,i.startCol+a+o,i.hostId,i.hostName,i.status),e.cache)}return new Ec(e,0,a,e.rowCount(),o)}function Id(e,t,r){var n=e.rowCount(),a=Math.min(Math.max(0,t),n-1),o=Math.min(Math.max(1,r),n-a);if(0===a&&n===o)return e;if(Xa(e)){var i=e.getRef();return new Ss(new Qi(i.startRow+a,i.startRow+a+o,i.startCol,i.endCol,i.hostId,i.hostName,i.status),e.cache)}return new Ec(e,a,0,o,e.colCount())}var Od=it.VAR_TYPE.NULL,Vd=it.VAR_TYPE.NUMBER,Nd=it.VAR_TYPE.STRING,bd=it.VAR_TYPE.BOOL,Md=it.VAR_TYPE.ERROR,Fd=it.VAR_TYPE.PRIMITIVE,Zd=it.VAR_TYPE.COLLECTION,xd=it.VAR_TYPE.FORMULA,Dd=it.VAR_TYPE.OPERATOR,Pd=(it.VAR_TYPE.THROW,it.VAR_TYPE.ASYNC),$d=(it.VAR_TYPE.UNPREDICTABLE,it.VAR_TYPE.CUSTOM_PRIMITIVE),Ld=it.VAR_TYPE.CUSTOM_COLLECTION,Bd=it.VAR_TYPE.BASIC,Ud=it.VAR_TYPE.ATOM,Hd=it.VAR_TYPE.ALL,zd=Math.floor;function Wd(e,t){return t+e*bo}function Gd(e){return{row:zd(e/bo),col:e%bo}}function jd(e,t){return"".concat(e,",").concat(t)}var Yd=function(){function e(){(0,y.Z)(this,e),this._set=new Set}return(0,_.Z)(e,[{key:"clear",value:function(){return this._set.clear()}},{key:"delete",value:function(e,t){return this._set.delete(Wd(e,t))}},{key:"forEach",value:function(e){var t=this;this._set.forEach((function(r){var n=Gd(r);e(n.row,n.col,t)}))}},{key:"has",value:function(e,t){return this._set.has(Wd(e,t))}},{key:"add",value:function(e,t){return this._set.add(Wd(e,t)),this}},{key:"size",get:function(){return this._set.size}}]),e}(),qd=function(){function e(){(0,y.Z)(this,e),this._map=new Map}return(0,_.Z)(e,[{key:"clear",value:function(){return this._map.clear()}},{key:"delete",value:function(e,t){if(0!==this._map.size)return this._map.delete(Wd(e,t))}},{key:"forEach",value:function(e){var t=this;this._map.forEach((function(r,n){var a=Gd(n);e(r,a.row,a.col,t)}))}},{key:"has",value:function(e,t){return 0!==this._map.size&&this._map.has(Wd(e,t))}},{key:"set",value:function(e,t,r){return this._map.set(Wd(e,t),r),this}},{key:"get",value:function(e,t){return this._map.get(Wd(e,t))}},{key:"size",get:function(){return this._map.size}}]),e}();function Jd(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"A1",n=Eu(e);return n.toString({isShowSheetName:t,refStyle:r,ref:n})}function Kd(e,t,r){if(!qo(e,t)||!Yo(e,t))return!1;if(zo(t,e))return!0;var n=bi(e,t);return n.forEach((function(e){r.add(new Qi(e.startRow,e.endRow,e.startCol,e.endCol,e.hostId,e.hostName,e.status))})),0!==n.length}function Xd(e,t){return Array.from(e.entries()).map((function(e,r,n){return{start:e[0],end:r<n.length-1?n[r+1][0]:t,data:e[1]}}))}function Qd(e,t,r,n,a,o,i){for(var u=o.sheetId,s=o.isAddOp,l=o.isRowOp,c=o.offsetRatio,h=o.boundaryKeys,f=!a||l&&a.isCol()||!l&&a.isRow(),d=!r,v=!!r&&r.hostId!==u,p=h.startKey,m=h.endKey,g=[],y=null,_=null,R=t||[null],C=n||[null],w=new Map,E=0,k=R.length;E<k;E++){var T=R[E],S=T?T.data[0]:0,A=T?T.data[1]:0,I=void 0;if(!T||T.start===e[p]&&T.end===e[m]?I=e:((y=y||e.clone())[p]=T.start,y[m]=T.end,I=y),e.hostId===u&&!s&&A){if(A>=I[m]-I[p])continue;I===e&&(I=I.clone()),I[p]+=A}if(f||d)g.push({start:I[p]+S*c,end:I[m]+S*c,data:[a,{mountMove:S,depMove:0,resize:0,effectLine:0,invalidDep:!1}]});else if(v)ev(w,I[p],I[m],{mountMove:S,depMove:0,resize:0,effectLine:0,invalidDep:!1});else{if(!r||!a)continue;for(var O=I===e?r:wi(I,a),V=0,N=0,b=C.length;N<b;N++){var M=C[N],F=M?M.data[0]:0,Z=M?M.data[1]:0,x=void 0;if(!M||M.start===r[p]&&M.end===r[m]?x=r:((_=_||r.clone())[p]=M.start,_[m]=M.end,x=_),O===x||Yo(O,x)){var D=O===x?x:Ko(x,O);if(0!==Z){var P=x[p],$=P+Z;if(s?P>O[p]&&P<O[m]:$>O[p]){var L=Uo(r[p],s?P-1:P),B=Ho(r[m],s?P+1:$),U=x.clone();U[p]=L,U[m]=B;var H=s?Oi(U,a,I,l):Si(U,a,I);if(Ri(H,h)&&Yo(H,I)){var z=Ko(H,I);if(s){var W=wi(z,a)[p]<P?V:F;ev(w,z[p],z[m],{mountMove:S,depMove:W,resize:Z,effectLine:P,invalidDep:!1})}else{for(var G=Xo(z),j=Zi(a,l),Y=z[p];Y<z[m];Y++){G[p]=Y,G[m]=j?z[m]:Y+1;var q=j?a:wi(G,a),J=q[p]<P?V:F-Z+q[p]-P,K=Math.abs(Ho(q[m],$)-Uo(q[p],P));if(ev(w,G[p],G[m],{mountMove:S,depMove:J,resize:K,effectLine:P,invalidDep:q[p]>=P&&q[m]<=$}),j)break}D===x&&(D=x.clone()),D[p]=Uo($,D[p])}}}}var X=D===x?I:Ko(I,Ai(D,a,e,l));if(X[p]>=X[m])V=F;else{if(ev(w,X[p],X[m],{mountMove:S,depMove:F,resize:0,effectLine:x[p],invalidDep:!1}),X[p]===I[p]&&X[m]===I[m])break;V=F}}}}}return a&&!f&&w.forEach((function(e){var t,r=e.start,n=e.end,o=e.data,u=o.mountMove,s=o.depMove,h=o.resize,d=o.effectLine,v=o.invalidDep,y=u-s,_=vi(a.status),R=l?ui:si,C=Fi(_,R[0]),w=Fi(_,R[1]);if(f||0===y&&0===h&&(!w&&!C||0===s))t=a;else{var E=function(e,t,r,n,a){var o=vi(e.status),i=t?ui:si,u=t?ci:hi,s=e[u.startKey],l=e[u.endKey];return Fi(o,i[1])?e[u.startKey]>=r&&(s+=a):s+=n,Fi(o,i[0])?e[u.endKey]>=r&&(l+=a):l+=n,[s,l]}(a,l,d,-y*c,s*c),k=E[0],T=E[1];0!==h&&(function(e,t,r,n){var a=Ii(e,n),o=a.startKey,i=a.endKey,u=a.startLock,s=a.endLock;return u&&!s&&r+e[i]<=e[o]||s&&!u&&t+e[o]>=e[i]?o:i}(a,r,r+1,l)===p?k+=h*c:T+=h*c),v&&(T=w&&C||!w&&!C?k:k=-1);var S=ei(l?k:a.startRow,l?T:a.endRow,l?a.startCol:k,l?a.endCol:T,a.hostId,a.hostName,a.status,a.getHostIdentifier());(t=i[S])||((t=a.clone())[p]=k,t[m]=T,t.key=S)}g.push({start:r+u*c,end:n+u*c,data:[t,o]})})),g}function ev(e,t,r,n){var a=jd(t,r),o=e.get(a);o?o.data.resize+=n.resize:e.set(a,{start:t,end:r,data:n})}var tv,rv,nv=new it.ErrorVar(it.ErrorType.RUNTIME_ERROR,it.ErrorConstant.RUNTIME_ERROR,Ce.O6N.REACHED_CALC_LIMIT);function av(e,t){return{workbook:e,service:t,visited:new Map,funcCache:{criterion:new Ce.z6B(150),op:new Ce.z6B(200),matrix:void 0,result:new Ce.z6B(150),range:new Ce.z6B(150),speedup:new Ce.z6B(5),search:new Ce.z6B(100),index:{},condfmt:new Ce.z6B(150),image:void 0},cache:new Map,skipRuntimeError:!1}}function ov(e,t){if(!e.getState().cache&&e.formula.expression){var r=uv(t,e);iv(r,new fc(null,r,e),[])}}function iv(e,t,r){for(;t;)if(0!==t.count)if(e.depth>2e4){for(;t.last;)t=t.last;r.length=0,r.push(nv),Sc(t)}else{var n=e.expression[e.index];if(t.isLazy()&&n.type&Dd){for(var a,o=e.index,i=-1;o>=e.end;o--){var u=e.expression[o];if(u.type===Dd?-1===i?i=u.getArgCount():i+=u.getArgCount()-1:i--,i<=0)break}var s=new vc(e.index,o--,e.expression,t.isArray);s.scope=null===(a=e.parameterScope)||void 0===a?void 0:a.slice(),r.push(s),Sc(t),e.index=o}else{if(Sd(n)){var l=n.getSheetRef(e.formula.getRefMap());if(!wu(l)&&eo(l)){r.push(l),Sc(t),e.index--;continue}t=Vc(e,t,r,Qi.fromGridRange(Ei(e.ref,l)),t.isPreRef(),!0),e.index--;continue}switch(n.type){case Zd:if(n.isRef())throw new Error("unexpected ref expression: ".concat(n.constructor.name," in calcFormula"));r.push(n),Sc(t);break;case Ud:r.push(n),Sc(t);break;case Dd:t=new _d(t,n);break;default:if(oo(n)&&e.parameterScope&&e.parameterScope[n.index]){var c=e.parameterScope[n.index];if(to(c)){var h=t.isPreRef();t=Vc(e,t,r,c.getRef(),h,!0);break}if(oo(c)){var f=e.formula.formula.params;c=f&&f[n.index]?hc(f[n.index]):it.NAME_ERR_VAR}r.push(c)}else r.push(n);Sc(t)}e.index--}}else if(null===(t=t.do(e,r)))return}function uv(e,t){var r=t.formula.expression;return e.isArray=!1,e.info={},e.expression=r,e.formula=t,e.ref=e.customRef||t.getRef(),e.start=r.length-1,e.end=0,e.index=r.length-1,e.depth=0,e}!function(e){e.afterFormulaCalc="afterFormulaCalc",e.afterWaitAsyncCalc="afterWaitAsyncCalc",e.formulaCalcFinished="formulaCalcFinished"}(tv||(tv={})),function(e){e[e.import=0]="import",e[e.image=1]="image",e[e.ai=2]="ai",e[e.importRange=3]="importRange",e[e.pinyin=4]="pinyin"}(rv||(rv={}));var sv,lv=function(e){function t(e,r,n){var a,o=n.formula;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,r,it.NULL_VAR,e))).ignoreApplyCache=!1,a.formula=o,a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"isArrayFormula",value:function(){return!1}},{key:"isImportRange",value:function(){return null!=this.formula.externalDataReferenceInfo}},{key:"hasImportRangeId",value:function(){return this.formula.importRangeId}},{key:"getExternalDataReferenceInfo",value:function(){return this.formula.externalDataReferenceInfo}},{key:"getImportRangeMeta",value:function(){return this.formula.importRangeMeta}},{key:"getTokens",value:function(){return this.formula.tokens}},{key:"markDirty",value:function(e){return this.ignoreApplyCache||(this.ignoreApplyCache=!0),(0,f.Z)((0,v.Z)(t.prototype),"markDirty",this).call(this,e)}},{key:"calc",value:function(e){var t,r=this.getState();if(this.service.isSuspended()&&(null==e?void 0:e.executeMode)!==it.ExecuteMode.FORCE)return null!==(t=r.cache)&&void 0!==t?t:it.BaseFormulaVar.SUSPENDED_FORMULA_CACHE;if(r.cache)return r.cache;var n=this.service.globalCtx;return n||(n=av(this.service.spread,this.service),this.service.globalCtx=n),ov(this,n),r.cache}},{key:"getRef",value:function(){return this.ref}},{key:"deserializeCache",value:function(e,r){var n,a=this.getRef().sheet();if(null==a)return null;if(e[it.TractorFormulaCacheProps.customType]){var o=Uc(e);n=o?new it.FormulaCache(o):null}else n=(0,f.Z)((0,v.Z)(t.prototype),"deserializeCache",this).call(this,e,r);return null==n?null:(zc(this,n,e[it.TractorFormulaCacheProps.info]||null,a),n)}},{key:"isEmptyState",value:function(){return!this.state.cache}},{key:"serializeCache",value:function(e){if(this.isDirty())return null;var r=(0,f.Z)((0,v.Z)(t.prototype),"serializeCache",this).call(this);if(null==r)return null;null!=(null==e?void 0:e.customSerializeCacheMethod)&&(r=e.customSerializeCacheMethod({formulaVar:this,serializedCache:r}));var n=Hc(this);return null!=n&&Bc(r,it.TractorFormulaCacheProps.info,n),r}},{key:"getInfo",value:function(){var e=this.getState().cache;return e?e.getInfo():null}},{key:"getDependencies",value:function(){var e=[],t=this.getRefMap();if(t)for(var r in t)e.push(t[r]);var n=this.getCustomDepends();if(null!=n)for(var a=0;a<n.length;a++){var o=n[a];if(!wu(o)){var i=void 0,u=this.getRef().sheet();u&&(i=o.hostId===u.id()?u:Ps(u.parent,o)),o=Eu(o,i)}e.push(o)}return e}},{key:"registerCustomDepends",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.customDepends=e}}]),t}(it.FormulaVar),cv=new it.FormulaCache(it.NULL_VAR);function hv(e){return function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calc",value:function(){return null!==this.state.cache?this.state.cache:dv(this)||function(e){return fv(e,"AI")}(this)?it.BaseFormulaVar.WAIT_ASYNC_FORMULA_CACHE:cv}}]),t}(e)}function fv(e,t){return t=t.toLocaleUpperCase(),!("function"!=typeof e.isFormula||!e.isFormula()||!(e.formula.tokens||[]).find((function(e){return e.includes(t)})))}function dv(e){if(!e.isFormula())return!1;if(e.isImportRange())return!0;var t=e.formula,r=t.expression,n=t.serialization,a="IMPORTRANGE";return r?function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.isOp()&&n.op().name===t)return!0}return!1}(r,a):!!n&&function(e,t){for(var r="F:".concat(t,":"),n=0;n<e.length;n++)if(0===e[n].indexOf(r))return!0;return!1}(n,a)}function vv(e){return!(!e.isFormula()||!(e.formula.tokens||[]).find((function(e){return e.includes("CIMAGE")||e.includes("CIMPORTXML")||e.includes("CIMPORTHTML")||e.includes("CIMPORTDATA")||e.includes("CIMPORTFEED")})))}function pv(e){return fv(e,"PRIVATE_PIVOT_TABLE")}function mv(e){return e instanceof lv}function gv(e){var t;return(0,Ce.gw3)("".concat(null===(t=e.getRef().sheet())||void 0===t?void 0:t.id(),";").concat(e.getId()))}function yv(e,t){var r=t.split(";"),n=(0,g.Z)(r,2),a=n[0],o=n[1],i=parseInt(o,10);if(!isNaN(i))return e.getFormulaFromId(a,i)}!function(e){e[e.NONE=0]="NONE",e[e.HAS_HIDDEN_ROWS=1]="HAS_HIDDEN_ROWS",e[e.HAS_HIDDEN_COLS=2]="HAS_HIDDEN_COLS",e[e.HAS_HIDDEN_ROWS_AND_COLS=3]="HAS_HIDDEN_ROWS_AND_COLS"}(sv||(sv={}));function _v(e,t){var r=e.sheet(),n=[ou.toNormalRange(e)];if(!r)return n;var a,o=e.rowFrom(),i=e.rowTo(),u=yr(t);try{for(u.s();!(a=u.n()).done;){var s=a.value;if(s>=o){if(s>i)break;var l=n.pop();if(l){var c=l.sub(new iu(s,1,r));Array.prototype.push.apply(n,c)}}}}catch(e){u.e(e)}finally{u.f()}return n}function Rv(e){var t=e.sheet(),r=[e];return t&&t.filterModel.hasFilter()?_v(e,t.filterModel.getAllFilteredOutRowsArray()):r}function Cv(e,t,r){if(0===e.length)return 0;var n,a=0,o=yr(e);try{for(o.s();!(n=o.n()).done;){var i=n.value,u=i.rowFrom(),s=i.rowTo(),l=i.colFrom(),c=i.colTo();if(!(1&a))for(var h in t)if(t[h]){var f=Number(h);if(f>=u){if(f>s)break;if(3===(a|=1))return a;break}}if(!(2&a))for(var d in r)if(r[d]){var v=Number(d);if(v>=l){if(v>c)break;if(3===(a|=2))return a;break}}}}catch(e){o.e(e)}finally{o.f()}return a}function wv(e){for(var t=new Set,r=new Set,n=0;n<e.length;n++){var a=e[n],o=a.sheet();o&&(o._getRowInfos().iterActualHidden(a.rowFrom(),a.rowTo()).forEach((function(e){for(var r=0;r<e.count;r++)t.add(e.index+r)})),o._getColInfos().iterActualHidden(a.colFrom(),a.colTo()).forEach((function(e){for(var t=0;t<e.count;t++)r.add(e.index+t)})))}if(t.size||r.size)return{rows:t,cols:r}}function Ev(e){var t=e.sheet();if(!t)return{tl:null,tr:null,bl:null,br:null};var r=t.frozenRowCount(),n=t.frozenColumnCount(),a=e.rowFrom(),o=e.rowTo(),i=e.colFrom(),u=e.colTo(),s=null,l=null,c=null,h=null;a>=r?l=e.rowInterval():o<r?s=e.rowInterval():(s=[a,r-a],l=[r,o-r+1]),i>=n?h=e.colInterval():u<n?c=e.colInterval():(c=[i,n-i],h=[n,u-n+1]);var f=null,d=null,v=null,p=null;return s&&(c&&(f=new ou(s[0],c[0],s[1],c[1],t)),h&&(d=new ou(s[0],h[0],s[1],h[1],t))),l&&(c&&(v=new ou(l[0],c[0],l[1],c[1],t)),h&&(p=new ou(l[0],h[0],l[1],h[1],t))),{tl:f,tr:d,bl:v,br:p}}function kv(e,t){var r,n=[e],a=yr(t);try{for(a.s();!(r=a.n()).done;){var o,i=r.value,u=[],s=yr(n);try{for(s.s();!(o=s.n()).done;){var l=o.value;l.isIntersect(i)?Array.prototype.push.apply(u,l.sub(i)):u.push(l)}}catch(e){s.e(e)}finally{s.f()}n=u}}catch(e){a.e(e)}finally{a.f()}return n}function Tv(e,t){if(0===e.length)return[];var r=[];if(1===e.length)r=t?Rv(e[0]):e;else{if(t){var n,a=yr(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;Array.prototype.push.apply(r,Rv(o))}}catch(e){a.e(e)}finally{a.f()}}else r=e;var i=function(e){var t,r={},n={},a=[],o=yr(e);try{for(o.s();!(t=o.n()).done;){var i,u=kv(t.value,a),s=yr(u);try{for(s.s();!(i=s.n()).done;)for(var l=i.value,c=l.rowFrom();c<=l.rowTo();++c)r[c]=r[c]?r[c]+l.colCount():l.colCount()}catch(e){s.e(e)}finally{s.f()}var h,f=yr(u);try{for(f.s();!(h=f.n()).done;)for(var d=h.value,v=d.colFrom();v<=d.colTo();++v)n[v]=n[v]?n[v]+d.rowCount():d.rowCount()}catch(e){f.e(e)}finally{f.f()}Array.prototype.push.apply(a,u)}}catch(e){o.e(e)}finally{o.f()}return{rowCountMap:r,colCountMap:n}}(r),u=i.rowCountMap,s=i.colCountMap,l=e[0].sheet(),c=Object.keys(u).map((function(e){return Number(e)})),h=Object.keys(s).map((function(e){return Number(e)})),f=c.length,d=h.length;r=c.every((function(e){return u[e]===d}))&&h.every((function(e){return s[e]===f}))?function(e,t,r){if(0===e.length||0===t.length)return[];for(var n=[],a=[],o=e[0],i=t[0],u=0;u<e.length-1;++u)e[u]+1!==e[u+1]&&(n.push([o,e[u]-o+1]),o=e[u+1]);n.push([o,e[e.length-1]-o+1]);for(var s=0;s<t.length-1;++s)t[s]+1!==t[s+1]&&(a.push([i,t[s]-i+1]),i=t[s+1]);a.push([i,t[t.length-1]-i+1]);for(var l=[],c=0,h=n;c<h.length;c++){var f,d=h[c],v=yr(a);try{for(v.s();!(f=v.n()).done;){var p=f.value;l.push(new ou(d[0],p[0],d[1],p[1],r))}}catch(e){v.e(e)}finally{v.f()}}return l}(c,h,l):t?Rv(e[e.length-1]):[e[e.length-1]]}return Nv(r)}function Sv(e){var t=new Set,r=new Set;if(!e||0===e.length||1===e.length)return{rows:t,cols:r};for(var n=1,a=e.length,o=0;o<a-1;++o){var i=e[o],u=e[o+1];if(i.rowFrom()!==u.rowFrom())break;for(var s=i.colTo()+1;s<u.colFrom();++s)r.add(s);++n}for(var l=0;l<a-n;l+=n)for(var c=e[l],h=e[l+n],f=c.rowTo()+1;f<h.rowFrom();++f)t.add(f);return{rows:t,cols:r}}function Av(e,t){return{row:e.rowFrom(),col:e.colFrom(),row_count:e.rowCount(t),col_count:e.colCount(t)}}function Iv(e){return{row:e.row,col:e.col,row_count:e.rowCount,col_count:e.colCount}}function Ov(e,t){var r,n,a=1,o=[],i=yr(e);try{for(i.s();!(n=i.n()).done;){var u=n.value;void 0===r?r=u:r+a===u?++a:r+a<u&&(o.push(new iu(r,a,t)),r=u,a=1)}}catch(e){i.e(e)}finally{i.f()}return void 0!==r&&o.push(new iu(r,a,t)),o}function Vv(e,t){var r=e.sheet(),n=new ou(e.rowFrom(),e.colFrom(),e.rowCount(!0),e.colCount(!0),r);if(!r)return{filteredRows:new Set,range:n};var a,o=r.filterModel.getAllFilteredOutRowsArray(),i=new Set,u=yr(o);try{for(u.s();!(a=u.n()).done;){var s=a.value;n.rowFrom()<=s&&s<=n.rowTo(!0)&&(i.add(s),t&&n.setRowCount(n.rowCount(!0)+1))}}catch(e){u.e(e)}finally{u.f()}return{filteredRows:i,range:n}}function Nv(e){return e.map((function(e){return ou.toNormalRange(e)}))}var bv=function(e,t,r){if(!e)return"";var n=e.filter((function(e){return e.isValidRefInSheet()})).map((function(e){var n=Mv(e,t);return r&&(n="'".concat(e.sheetName,"'!").concat(n)),n}));return n.join()},Mv=function(e,t){return e instanceof eu?(t?(e instanceof nu||e instanceof iu||e instanceof au)&&(e=ou.toNormalRange(e)):e instanceof ou&&1===e.rowCount()&&1===e.colCount()&&(e=new uu(e.rowFrom(),e.colFrom(),e.sheet())),e.toString({refStyle:"A1",ref:e})):""},Fv=function(e){return/^([a-zA-Z]+\d+):([a-zA-Z]\d+)$/.test(e)&&(e=e.replace(/^(.+):(.+)$/,(function(e,t,r){return t===r?t:e}))),e};function Zv(e,t){if(!e)return"";var r=e.getSelections(),n="name"===t.type,a=bv(r,!1,n);return n&&(a=a.replace("'".concat(t.value,"'!"),"")),"id"===t.type?t.value===e.id()?a:"'".concat(e.id(),"'!").concat(a):a}function xv(e,t,r,n,a){if(!t||!e)return"";if(t===it.ErrorConstant.REF)return t;var o=a||e.getActiveSheet();if(!o)return"";var i=o.rangeStringToRange(t);return i&&i instanceof eu?(function(e){return!(!e||e>15||e<1)}(r)&&i.setRefStatus(r),null==n&&(n=o.name()!==i.sheetName),i.toString({ref:i,isShowSheetName:n})):""}function Dv(e,t,r){return xv(e,t,15,r)}function Pv(e,t,r,n){return Dv(e,Mv(t,r),n)}function $v(e,t,r,n){if(!t||!t.length)return"";var a=t.filter((function(e){return e.isValidRefInSheet()})).map((function(t){return Pv(e,t,r,n)}));return a.join()}function Lv(e,t,r,n){if(!t||!t.length)return[];var a=t.filter((function(e){return e.isValidRefInSheet()})).map((function(t){return Pv(e,t,r,n)}));return a}var Bv=function(e,t,r){if(!e)return[];var n=e.filter((function(e){return e.isValidRefInSheet()})).map((function(e){var n=Mv(e,t);return r&&(n="'".concat(e.sheetName,"'!").concat(n)),n}));return n};function Uv(e,t,r){var n=t||e[0]&&e[0].sheet();if(!n)return e;var a,o=[],i=[[]],u=function(e,t,r){i[e]||(i[e]=[]),r?i[e][t]=1:delete i[e][t]},s=yr(e);try{for(s.s();!(a=s.n()).done;){var l=a.value;if(l.sheet()===n)if([Ce.xj7.NORMAL,Ce.xj7.CELL].includes(l.rgType))for(var c=l.rowFrom(),h=l.colFrom(),f=l.rowCount(r),d=l.colCount(r),v=1;v<=f;v++)for(var p=1;p<=d;p++)u(c+v-1,h+p-1,!0);else o.push(l);else o.push(l)}}catch(e){s.e(e)}finally{s.f()}for(var g=function(){var e=null;return i.some((function(t,r){return t.some((function(t,n){return!!t&&(e=[r,n],!0)}))})),e},y=function(e,t){for(var r=0,a=0,o=1,s=1,l=function(){var n=e+r,l=t+a,c=l+1,h=n+1;return i[n]&&i[n][l]&&(0===r&&(s=a+1),0===a&&(o=r+1),a<s&&r<o&&u(n,l,!1)),i[n]&&i[n][c]?(a++,!0):(a=0,!(!i[h]||!i[h][l]||(r++,0)))},c=l();c;)c=l();return new ou(e,t,o,s,n)},_=g();_;){var R=y.apply(void 0,(0,m.Z)(_));R&&o.push(R),_=g()}return o}function Hv(e){var t=[],r=[];try{var n,a=e[0].target,o=yr(e);try{for(o.s();!(n=o.n()).done;){for(var i=n.value,u=i.target,s=i.count,l=0;l<s;l++)t[u+l]=!0;a=Math.min(a,u)}}catch(e){o.e(e)}finally{o.f()}for(var c,h=t.length,f=0,d=a;d<h;)t[d]?1===++f&&(c=d):f>0&&(r.push({target:c,count:f}),f=0),d++;f>0&&r.push({target:c,count:f})}catch(e){return console.error("this is a unexpected removing duplicated row col error. Pleace check!"),[]}return r}function zv(e,t){return null!==e.cellModel.iterVisibleContent(t.rowFrom(),t.colFrom(),t.rowTo(),t.colTo()).first_if((function(t){var r=(0,g.Z)(t,2),n=r[0],a=r[1],o=a.row,i=a.col,u=e._getModel().getVarByContent(n,o,i);return!!((Wp(u)||jp(u))&&u.getArrayRef().size()>1)}))}function Wv(e,t){var r=e.filterModel;if(t){var n=e.viewsModel.getViewById(t);n&&(r=n.getFilterModel())}var a=r.getValidFilterRules(),o=[];return(0,m.Z)(a).forEach((function(e){var t=(0,g.Z)(e,1)[0],n=r.getFilterInfo(t);n&&o.push(n)})),o}function Gv(e,t,r,n,a,o){var i=e.viewsModel.activeView,u=!(!i||(0,Ce.y_b)(i.getId())),s=e.parent.editable;if(Ce.Ps3.getSheetPivotAllowFilter()&&(!s||u))return!1;var l=e.getPivotTableManager();if(!l.hasPivotTable())return!1;var c,h=new ou(t,r,n,a,e),f=yr(l.getPivotInfoMap());try{for(f.s();!(c=f.n()).done;){var d=(0,g.Z)(c.value,2),v=d[0],p=d[1];if(null==o||!o.includes(v)){var m=p.contentRange,y=p.pageRange,_=p.row,R=p.col;if(h.containCell(_,R))return!0;if(null!=m&&m.isIntersect(h))return!0;if(null!=y&&y.isIntersect(h))return!0}}}catch(e){f.e(e)}finally{f.f()}return!1}var jv=function(e,t){return{rowFrom:e.rowFrom(),rowTo:e.rowTo(t),rowCount:e.rowCount(t),colFrom:e.colFrom(),colTo:e.colTo(t),colCount:e.colCount(t)}};function Yv(e,t){var r=e.getRowCount();if(t<0||t>=r)return t+1;var n=e._rowInfos.firstVisible(t+1,r-1);return n?n.index:t+1}function qv(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=e.getRowCount(),i=e.getColumnCount();if(t>=o)return!1;for(var u=Math.min(i-1,n),s=r;s<=u;s++){var l,c=!1,h=yr(a);try{for(h.s();!(l=h.n()).done;){var f=l.value;if(f.containCell(t,s)){c=!0;break}}}catch(e){h.e(e)}finally{h.f()}if(!c){var d=e.getSpan(t,s),v=t,p=s;if(d&&(v=d.rowFrom(),p=d.colFrom()),e.hasContent(v,p))return!0}}return!1}function Jv(e,t,r){if(e>t)return 0;var n,a=0,o=yr(r);try{for(o.s();!(n=o.n()).done;){var i=n.value,u=jv(i),s=u.rowFrom,l=s+u.rowCount-1,c=Math.min(l,t)-Math.max(s,e)+1;a+=c>0?c:0}}catch(e){o.e(e)}finally{o.f()}return a}function Kv(e,t,r,n){var a=e.getRowCount(),o=t.colFrom(),i=t.colTo();if(r>=a)return r;for(var u=r,s=Yv(e,u);s<a&&(!Gv(e,s,o,1,i)&&qv(e,s,o,i,n));)s=Yv(e,u=s);return u}var Xv=function(e){return e.viewsModel.getViewList().map((function(e){return{id:e.getId(),name:e.getName(),range:e.getFilterModel().filterRange}}))},Qv=function(e,t,r){var n=r.targetRange,a=jv(t,!0),o=a.rowTo,i=a.colFrom,u=a.colTo,s=a.colCount,l=jv(n,!0),c=l.rowFrom,h=l.rowTo,f=l.colFrom,d=l.colTo;if(Gv(e,c,i,l.rowCount,s))return!1;if(d<i||f>u)return!1;var v=Yv(e,o);return o<h&&c<=v};function ep(e,t,r){var n=r.targetRangeArr,a=r.ignoreRanges,o=(0,m.Z)(n);o.sort((function(e,t){return e.rowFrom()-t.rowFrom()}));for(var i=t.clone(),u=t.rowFrom(),s=0,l=o;s<l.length;s++){var c=l[s];if(Qv(e,i,{targetRange:c})){var h=Kv(e,i,c.rowTo(!0),a);i.setRowCount(h-u+1)}}return i.rowTo(!0)}var tp=function(e,t,r){var n=r.sourceRange,a=r.targetRange,o=t.rowFrom(),i=Yv(e,t.rowTo()),u=a.rowFrom(),s=n.rowTo(),l=t.clone(),c=n.rowCount(),h=t.rowTo(),f=!1;i===u&&(f=!0,h=Kv(e,t,i-1),l.setRowCount(h-o+1)),Qv(e,l,{targetRange:n})&&(f=!0,h=Kv(e,l,s));var d=Yv(e,h);return o<u&&u<=d&&(h+=c),{shouldExtend:f,targetRow:h-=Jv(o,d,[n])}},rp=function(e,t,r,n,a,o,i){var u=t.rowFrom(),s=t.clone(),l=t.clone();s.setRowCount(r-u+1);var c,h,f=Av(s,!0),d=Av(l,!0),v=e.id();if(Gv(e,s.rowFrom(),s.colFrom(),s.rowCount(),s.colCount()))return{actions:[],oldActions:[]};if(o&&i?(c=[(0,Ce.eRv)(v,{range:f,view_id:i})],h=[(0,Ce.eRv)(v,{range:d,view_id:i})]):(c=[{action:"setFilter",sheet_id:v,target:f,value:null}],h=[{action:"setFilter",sheet_id:v,target:d,value:null}]),n)if(i){var p=e.viewsModel.getViewById(i).getFilterModel(),m=p.getInfo().range.clone();m.setRowCount(r-u+1),p.setRange(ou.toNormalRange(m).toSimpleObj(),!1)}else{var g=e.sheetFilterModel.getInfo();g&&g.range.setRowCount(r-u+1)}return a&&(c=[]),{actions:c,oldActions:h}},np=function(e,t,r,n,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=e.id(),u=Av(r);o&&t.push((0,Ce.VCn)(i,{view_id:n,name:a})),t.push((0,Ce.eRv)(i,{range:u,view_id:n}));var s=Wv(e,n);s&&s.forEach((function(e){var r=e.col,a=e.type,o=e.compare,s=e.expected,l=e.contents;t.push((0,Ce.eRv)(i,{filter_value:{col:r,type:0===a?null:a,compare:o,expected:s,contents:l},range:u,view_id:n}))})),e.viewsModel.getActiveViewId()===n&&t.push((0,Ce.fdi)(i,n))},ap=function(e,t){var r=e.sheetFilterModel,n=r.getInfo();if(n){var a=n.range;t.push({action:"setFilter",sheet_id:e.id(),target:Av(a),value:null}),(0,m.Z)(r.getValidFilterRules()).forEach((function(r){var n=(0,g.Z)(r,1)[0],o=e.sheetFilterModel.getFilterInfo(n);o&&t.push({action:"setFilter",sheet_id:e.id(),target:Av(a),value:o})}))}},op=function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=[];return n&&r?np(e,o,t,n,r,a):ap(e,o),o},ip=function(e,t,r,n){return r&&n?{actions:[(0,Ce.h_E)(e.id(),{view_id:n,name:r})],oldActions:op(e,t,r,n,!0)}:e.sheetFilterModel.getInfo()?{actions:[{action:"delFilter",sheet_id:e.id()}],oldActions:op(e,t)}:{actions:[],oldActions:[]}},up=function(e,t){var r=t.sourceRange,n=t.targetRange,a=e.rowFrom(),o=e.rowCount(),i=n.rowFrom(),u=Jv(0,a-1,[r]),s=0;i>=0&&i<=a&&(s=n.rowCount());var l=s-u,c=e.clone();return c.setRowFrom(a+l),c.setRowCount(o),{adjustRange:c,offset:l}},sp=function(e,t,r,n,a){var o=(0,m.Z)(r);o.sort((function(e,t){return e.rowFrom()-t.rowFrom()}));var i,u=jv(t).rowFrom,s=t.clone(),l=!1,c=yr(o);try{for(c.s();!(i=c.n()).done;){var h=i.value,f=jv(h),d=f.rowFrom,v=f.rowCount,p=d+v-1;if(d<=u&&u<=p)return ip(e,t,n,a);var g=new iu(d,v,e);if(!l&&t.intersect(g)&&(l=!0),Qv(e,s,{targetRange:g})){l=!0;var y=Kv(e,s,p);s.setRowCount(y-u+1)}}}catch(e){c.e(e)}finally{c.f()}if(!l)return{actions:[],oldActions:[]};var _=Jv(s.rowFrom(),s.rowTo(!0),r),R=s.rowTo(!0)-_,C=function(e,t){var r=t.filterRange,n=t.deleteRowsArr,a=t.targetRow,o=t.viewId,i=t.viewName,u=r.rowFrom(),s=r.rowCount(),l=Jv(0,u-1,n),c=r.clone();return c.setRowFrom(u-l),c.setRowCount(s),rp(e,c,a-l,!1,!1,i,o).actions}(e,{filterRange:t,deleteRowsArr:r,targetRow:R,viewId:a,viewName:n});return{actions:C,oldActions:rp(e,t,R,!1,!1,n,a).oldActions}},lp=function(e,t,r,n,a){var o,i=jv(t),u=i.colFrom,s=i.colTo,l={actions:[],oldActions:[]},c=yr(r);try{for(c.s();!(o=c.n()).done;){var h=o.value,f=jv(h),d=f.colFrom,v=f.colTo;if(d<=u&&s<=v)return ip(e,t,n,a);if(d>=u&&d<=s||v>=u&&v<=s){(0,Ce.hTd)(l.oldActions,op(e,t,n,a));break}}}catch(e){c.e(e)}finally{c.f()}return l},cp=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{executeLocal:!1},a={actions:[],oldActions:[]};try{var o=n.executeLocal,i=e.sheetFilterModel.filterRange;if(null!=i&&i.isValid()){var u=ep(e,i,{targetRangeArr:t,ignoreRanges:r});if(u>i.rowTo(!0)){var s=rp(e,i,u,!!o,!1),l=s.actions,c=s.oldActions;(0,Ce.hTd)(a.actions,l),(0,Ce.hTd)(a.oldActions,c)}}var h,f=Xv(e),d=yr(f);try{for(d.s();!(h=d.n()).done;){var v=h.value,p=v.name,m=v.id,g=v.range;if(null!=g&&g.isValid()){var y=ep(e,g,{targetRangeArr:t,ignoreRanges:r});if(y>g.rowTo(!0)){var _=rp(e,g,y,!!o,!1,p,m),R=_.actions,C=_.oldActions;(0,Ce.hTd)(a.actions,R),(0,Ce.hTd)(a.oldActions,C)}}}}catch(e){d.e(e)}finally{d.f()}}catch(e){console.error("extendFilterHelper.ts: getFilterExtendChangeSetsByMultiRange error")}return a},hp=function(e,t){var r={actions:[],oldActions:[]};try{var n=t.rowTo(),a=e.sheetFilterModel.filterRange;if(null!=a&&a.isValid()&&Qv(e,a,{targetRange:t})){var o=rp(e,a,n,!0),i=o.actions,u=o.oldActions;(0,Ce.hTd)(r.actions,i),(0,Ce.hTd)(r.oldActions,u)}var s,l=yr(Xv(e));try{for(l.s();!(s=l.n()).done;){var c=s.value,h=c.name,f=c.id,d=c.range;if(Qv(e,d,{targetRange:t})){var v=rp(e,d,n,!0,!1,h,f),p=v.actions,m=v.oldActions;(0,Ce.hTd)(r.actions,p),(0,Ce.hTd)(r.oldActions,m)}}}catch(e){l.e(e)}finally{l.f()}}catch(e){console.error("extendFilterHelper.ts: getFilterExtendChangeSetsByRemoveDuplication error")}return r};var fp=function(e,t){var r=e.filterModel&&e.filterModel.getFilterRules();r&&r.size>0&&r.forEach((function(r,n){var a=r.getCompareTypeAndConditionTypeForEnum(),o=(0,g.Z)(a,2),i=o[0],u=o[1];if(1===i||0===u){for(var s=[],l=t.rowInterval(),c=(0,g.Z)(l,2),h=c[0],f=c[1],d=h+1;d<h+f;d++)s.push(e.getText(d,n));var v,p=!0,y=yr((0,m.Z)(r.params));try{e:for(y.s();!(v=y.n()).done;){var _,R=v.value,C=yr(s);try{for(C.s();!(_=C.n()).done;){if(_.value===R){p=!1;break e}}}catch(e){C.e(e)}finally{C.f()}}}catch(e){y.e(e)}finally{y.f()}if(p){var w=e.filterModel.filterRange,E=e.viewsModel&&e.viewsModel.activeView;e.setFilterView(null==E?void 0:E.getId(),!0,{range:w.toJSON(),col:n,value:null})}}}))},dp=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).index=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"customType",get:function(){return"ParamVar"}}]),(0,_.Z)(t,[{key:"clone",value:function(){return new t(this.index)}},{key:"toNumberVar",value:function(){throw new Error("ParameterVar can not convert toNumberVar")}},{key:"toStringVar",value:function(){throw new Error("ParameterVar can not convert toStringVar")}},{key:"toBooleanVar",value:function(){throw new Error("ParameterVar can not convert toBooleanVar")}},{key:"getValue",value:function(){return it.NAME_ERR_VAR.getValue()}},{key:"getVar",value:function(e){var t;if(null==e)return it.NAME_ERR_VAR;var r=e.parameterScope;return null==r?it.NAME_ERR_VAR:null!==(t=r[this.index])&&void 0!==t?t:it.NAME_ERR_VAR}},{key:"serialize",value:function(){return it.NAME_ERR_VAR.serialize()}},{key:"serializeValue",value:function(){return null}}]),t}(it.BaseCustomPrimitiveVar);function vp(e){return e.isCustomPrimitive()&&"ParamVar"===e.customType}function pp(e,t){if(dv(t)){var r=e.parent.importRangeManager.getMetaFromFormula(t);if(r)return{spreadToken:r.spreadToken,ref:r.ref,isSyncStyle:r.isSyncStyle,importRangeId:r.importRangeId,spreadSource:r.spreadSource}}}dp.prototype.$$type=640;var mp=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this))).expression=e,n.params=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"customType",get:function(){return"LambdaVar"}}]),(0,_.Z)(t,[{key:"clone",value:function(){return new t(this.expression,this.params)}},{key:"toNumberVar",value:function(){throw new Error("LambdaVar can not convert toNumberVar")}},{key:"toStringVar",value:function(){throw new Error("LambdaVar can not convert toStringVar")}},{key:"toBooleanVar",value:function(){throw new Error("LambdaVar can not convert toBooleanVar")}},{key:"getVar",value:function(e){throw new Error("LambdaVar can not getVar")}},{key:"getValue",value:function(e){throw new Error("LambdaVar can not getValue")}},{key:"serializeValue",value:function(){return null}},{key:"getParams",value:function(){return this.params}}]),t}(it.BaseCustomPrimitiveVar);mp.prototype.$$type=1152;var gp=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="InvokeFunctionOp",e.operands=1,e.optionOperands=254,e.resultType=it.VAR_TYPE.ALL,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.OPERATOR|it.VAR_TYPE.CUSTOM_PRIMITIVE,customType:{primitive:["LambdaVar"]}},{type:it.VAR_TYPE.ALL}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=wo([{type:Ro.Any,singleValue:!0,nullable:!0},{type:Ro.Any,nullable:!0,errorable:!0}]),e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(ja(r))return r;if(!function(e){return 1152===e.$$type}(r))return new it.ErrorVar(it.ErrorType.NA,it.ErrorConstant.NA,Ce.O6N.INVALID_CALL_TO_NON_FUNCTION);var n=r.getParams();if(t.length!==n.length+1)return Ce.d$b[Ce.O6N.WRONG_NUMBER_OF_ARGUMENTS_TO_CALL_FOLLOWING_LAMBDA_FUNCTION]({funcName:"LAMBDA",argCount:t.length-1,requiredOperandCount:n.length});var a=r.expression;if(t.length>1)for(var o=a.scope||(a.scope=[]),i=1;i<t.length;i++)o[n[i-1].index]=t[i];return a}}]),t}(it.OpBase);function yp(e){for(var t=e.tokens,r=e.refStringGen,n=e.params,a="",o=0;o<t.length;o++){var i=t[o];switch(i[0]){case"R":a+=r(i);break;case"C":a+=i.slice(1);break;case"P":null!=n&&(a+=n[i.slice(1)]);break;default:throw new Error("unknown token ".concat(i[0]))}}return a}function _p(e,t,r){return yp({tokens:e.tokens,refStringGen:function(e){return t[e].toString(r)},params:e.params})}function Rp(e,t,r,n,a){var o=Ps(e,r);return o?function(e,t,r,n){var a,o,i=t.getCellFormatter(r,n);if(i&&!(0,Ee.isDefaultFormatter)(i)){var u=e.clone();return u.setSpecialInfo({customData:{autoFormat:i.getFormatCode()}}),u}var s=null===(a=e.getSpecialInfo())||void 0===a||null===(o=a.customData)||void 0===o?void 0:o.autoFormat;if(s){var l=e.clone();return l.setSpecialInfo({customData:{autoFormat:s}}),l}return e}(t,o,n+r.startRow,a+r.startCol):t}function Cp(e){return ud.add(e),function(e){return e}}function wp(e,t,r,n){if(Qa(t))return it.VALUE_ERR_VAR;var a=t.rowCount(),o=t.colCount();if("number"==typeof r&&r>=1&&(a=Math.min(a,r)),"number"==typeof n&&n>=1&&(o=Math.min(o,n)),ro(t)){for(var i,u=t.getRef(),s=[],l=0;l<a;l++){s[l]||(s[l]=[]);for(var c=0;c<o;c++){var h=t.at(l,c);s[l][c]=Rp(e.workbook,h,u,l,c)}}if(!a||!o)return 1===t.size()?new gs([[]]):it.REF_ERR_VAR;e.info&&(e.info.customData=null===(i=s[0][0].getSpecialInfo())||void 0===i?void 0:i.customData),t=new gs(s)}return!Ja(t)||a===t.rowCount()&&o===t.colCount()?t:new Ec(t,0,0,a,o)}var Ep=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,"PRIVATE_MATRIX"))).$$minOperands=1,n.$$maxOperands=Co,n.$$lazy=!1,n.$$cacheType=0,n.$$paramsDesc=[415],n._rowCount=e,n._colCount=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"rowCount",value:function(){return this._rowCount}},{key:"colCount",value:function(){return this._colCount}},{key:"func",value:function(e,t){for(var r=[],n=0;n<this._rowCount;n++){for(var a=[],o=0;o<this._colCount;o++)a.push(t[n*this._colCount+o]);r.push(a)}return new gs(r)}}]),t}(it.FuncOpBase);Ep=Vu([Cp("PRIVATE_MATRIX")],Ep);function kp(e,t){var r=e.getRefMap(),n=e.formula.tokens;if(null==n)throw new Error("failed to decompile formula without tokens");return yp({tokens:n,refStringGen:function(n){return r&&r[n]?ku(r[n],e.getRef()).toString(t):it.REF_ERR_VAR.getValue()},params:e.formula.params})}function Tp(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.refType,a=void 0===n?0:n,o=r.shouldContainExternalDataReference,i=void 0===o||o,u=r.isMutation,s=void 0!==u&&u,l=e.formula.tokens;if(null==l)throw new Error("Tokens not found in formula");var c=e.getRef().sheet(),h=c&&c.parent.importRangeManager;if(!c||!h)throw new Error("ImportRangeManager not found");var f={v:1,refs:null},d=e.getRefMap(),v=null;if(null!=d){var p={};for(var m in v=new Map,d){var g=d[m];if(v.set(g,m),s){var y=!1;y=g.sheet()?g.sheet()!==t.ref.sheet():g.hostName!==t.ref.hostName;var _=g.toGridJSON(!!y);p[m]=_}else p[m]=is(ku(g,t.ref),t,a)}f.refs=p}var R=e.formula.params;null!==R&&(f.params=R);var C=e.formula.serialization;if(f.tree=null!=C?C:Sp(e.formula.expression,v),Wp(e)&&(f.flag=1),i){var w=pp(c,e);w&&(f.externalDataReference=w)}return f.tokens=l,f}function Sp(e,t){for(var r=[],n=0;n<e.length;n++){var a=e[n];if(Ed(a))bp(a,r);else{if(a.isOp()){var o=a.op(),i=o.name;if(o instanceof it.FuncOpBase){o instanceof Ep?bp(o,r):r.push("F:".concat(i,":").concat(a.getArgCount()));continue}if(o instanceof it.BinaryOpBase){r.push("OB".concat(i));continue}if(o instanceof it.PrefixUnaryOpBase){r.push("OP".concat(i));continue}if(o instanceof it.SuffixUnaryOpBase){r.push("OS".concat(i));continue}if(o instanceof it.ParenOp){r.push("OG".concat(a.getArgCount()));continue}if(o instanceof gp){r.push("OI".concat(a.getArgCount()));continue}}switch(a.type){case it.VAR_TYPE.NUMBER:Ip(a,r);break;case it.VAR_TYPE.STRING:Ap(a,r);break;case it.VAR_TYPE.BOOL:Op(a,r);break;case it.VAR_TYPE.NULL:Vp(r);break;case it.VAR_TYPE.ERROR:Np(a,r);break;case it.VAR_TYPE.CUSTOM_COLLECTION:Td(a)?Mp(a,r,t):Sd(a)&&Fp(a,r);break;case it.VAR_TYPE.CUSTOM_PRIMITIVE:vp(a)&&Zp(a,r)}}}return r}function Ap(e,t){t.push("S".concat(e.getValue()))}function Ip(e,t){t.push("D".concat(e.getValue()))}function Op(e,t){t.push("B"+(e.getValue()?1:0))}function Vp(e){e.push("N")}function Np(e,t){var r=e.getSpecialInfo();r&&"string"==typeof r.errorInfo?t.push("E:".concat(e.errorType,":").concat(r.errorInfo,":").concat(e.errorCode)):t.push("E:".concat(e.errorType,"::").concat(e.errorCode))}function bp(e,t){t.push("M:".concat(e.rowCount(),":").concat(e.colCount()))}function Mp(e,t,r){var n=r.get(e.getRef());if(null==n)throw new Error("ref not found in map");t.push(n)}function Fp(e,t){t.push(e.id)}function Zp(e,t){t.push("P".concat(e.index))}var xp,Dp,Pp,$p,Lp;new Set(["AI_WRITE","AI_DEEPSEEK_WRITE","AI_ASK","AI_CLASSIFY","AI_EXTRACT","AI_IMPORTDATA","AI_INFER","AI_POLISH","AI_SENTIMENT","AI_SUMMARY","AI_TRANSLATE"]);function Bp(e,t,r){if(!e.parent.permissionManager.hasPermission(e.id()))return{showExpandRowCol:!1,showCannotExpandRowCol:!1};var n=new uu(t,r,e);if(!e.protectionModel.getRangePermissions([n]).hasPermission)return{showExpandRowCol:!1,showCannotExpandRowCol:!1};var a=e.getVar(t,r);if(!Wp(a)||!dv(a))return{showExpandRowCol:!1,showCannotExpandRowCol:!1};var o=a.getRawVar();if(!Td(o)&&!Ed(o))return{showExpandRowCol:!1,showCannotExpandRowCol:!1};var i=a.getArrayRef(),u=o.rowCount(),s=o.colCount(),l=i.rowFrom(),c=i.colFrom(),h=i.rowCount(),f=i.colCount();if(u!==h||s!==f)return function(e,t,r){return(e.getRowCount()+t)*(e.getColumnCount()+r)>(0,Ce.$$w)()}(e,u-h,s-f)?{showExpandRowCol:!1,showCannotExpandRowCol:!0}:{showExpandRowCol:!0,showCannotExpandRowCol:!1};var d=e.getRowCount(),v=e.getColumnCount();return l+u>d||c+s>v?{showExpandRowCol:!1,showCannotExpandRowCol:!0}:{showExpandRowCol:!1,showCannotExpandRowCol:!1}}!function(e){e[e.CanExpand=1]="CanExpand",e[e.CanNotExpand=2]="CanNotExpand",e[e.LackRowCol=3]="LackRowCol"}(xp||(xp={})),function(e){e.onMarkDirty="onMarkDirty",e.SetMatrixVar="SetMatrixVar"}(Dp||(Dp={}));var Up=function(e){function t(e,r,n){var a;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r,n))).expandState={arrayFormulaCanExpand:1},a.arrayRef=null,a.disposeRefWatcher=null,a.ignoreExpand=!1,a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"isArrayFormula",value:function(){return!0}},{key:"watchArrayRef",value:function(e){var t=this;this.disposeRefWatcher&&(this.disposeRefWatcher(),this.disposeRefWatcher=null),e.size(!0)>1&&(this.disposeRefWatcher=this.service.calcEngine.depRefManager.watchRef(e,(function(){t.recheck()})))}},{key:"recheck",value:function(){var e=this.arrayRef;if(e&&e.isValid()){var t=e.sheet();if(t){var r=this.getState().cache;if(r){var n=r.getRawVar();if(Ja(n)){var a=e.rowFrom(),o=e.colFrom(),i=n.rowCount(),u=n.colCount(),s=new ou(a,o,i,u,t),l=Hp(t._dataModel,s,this,n),c=this.canArrayExpand();e.equal(s)&&c.arrayFormulaCanExpand===l.arrayFormulaCanExpand&&!function(e,t){var r=t.getExpandRef();if(!r)return!1;if(1!==t.canArrayExpand().arrayFormulaCanExpand)return!1;for(var n=r.rowFrom(),a=r.colFrom(),o=r.rowCount(),i=r.colCount(),u=0;u<o;u++)for(var s=n+u,l=0;l<i;l++){var c=a+l,h=e.getImmutableContent(s,c);if(!h||!h.variant)return!0;if(!uo(h.variant))return!0;if(h.variant.formula!==t)return!0}return!1}(t._dataModel,this)||this.service.addValueChangedFormula(this)}}}}}},{key:"getArrayRef",value:function(){if(!this.state.cache)return this.ref;var e=this.state.cache.getInfo();return e&&e.arrayRef?e.arrayRef:this.ref}},{key:"getExpandRef",value:function(){return this.arrayRef}},{key:"getVar",value:function(e){var r=(0,f.Z)((0,v.Z)(t.prototype),"getRawVar",this).call(this,e);if(!r.isCollection())return r;var n=this.getRef(),a=n.sheet(),o=n.rowFrom(),i=n.colFrom();switch(this.expandState.arrayFormulaCanExpand){case 1:return Pc(r.at(0,0));case 3:var u=Bp(a,o,i),s=u.showExpandRowCol,l=u.showCannotExpandRowCol,c=JSON.stringify(this.expandState);return s?Ce.d$b[Ce.O6N.ARRAYFORMULA_EXPAND_LACK_ROW_COL_NOT_EXCEED_LIMIT](c):l?Ce.d$b[Ce.O6N.ARRAYFORMULA_EXPAND_LACK_ROW_COL_EXCEED_LIMIT](c):Ce.d$b[Ce.O6N.ARRAYFORMULA_EXPAND_LACK_ROW_COL](c);default:var h=this.expandState,d=h.row,p=h.col,m=new uu(d,p,a).toString({ref:new ou(0,0,1,1,a)});return Ce.d$b[Ce.O6N.ARRAYFORMULA_CAN_NOT_EXPAND]({rangeText:m},JSON.stringify(this.expandState))}}},{key:"canArrayExpand",value:function(){return this.expandState}},{key:"dispose",value:function(){this.disposeRefWatcher&&(this.disposeRefWatcher(),this.disposeRefWatcher=null),zp(this,this.arrayRef||this.getArrayRef()),this.arrayRef=null}},{key:"setArrayCanExpand",value:function(e){this.expandState=e}},{key:"setCurrentArrayRef",value:function(e){this.arrayRef=e}},{key:"fromCache",value:function(e,r){if(!(this.isDirty()||null!=r&&r.forceOverride))return!1;var n=e.a;return null!=n&&(!0!==(null==r?void 0:r.ignoreArrayFormulaCanExpand)&&this.setArrayCanExpand(JSON.parse(n.e)),(0,f.Z)((0,v.Z)(t.prototype),"fromCache",this).call(this,e,r))}},{key:"deserializeCache",value:function(e,r){var n=e.a;if(null==n)return null;var a=e[it.TractorFormulaCacheProps.info];return null!=n.r&&null!=n.c?function(e,t,r,n){var a=t.r,o=t.c,i=t.m,u=t.s;if(null==i||null==a||null==o)return null;for(var s=[],l=0;l<a;l++){s.push([]);for(var c=0;c<o;c++){var h,f=i[l*o+c];if(null==(h=f[it.TractorFormulaCacheProps.customType]?Uc(f):(0,it.deserializeBaseVar)(f,n)))return null;s[l].push(h)}}var d=new gs(s),v=new it.FormulaCache(d,d.getVarByPos(0,0)),p=e.getRef().sheet();return null==p?null:(null!=r&&((0,it.setTractorFormulaInfo)(v,r),zc(e,v,r,p)),null!=u&&d.setSpecialInfo(JSON.parse(u)),v)}(this,n,a,r):(0,f.Z)((0,v.Z)(t.prototype),"deserializeCache",this).call(this,e,r)}},{key:"serializeCache",value:function(e){var t=this.getState().cache;if(null==t)return null;var r=t.getRawVar(),n={};if(!r.isCollection()&&null==(n=r.serialize()))return null;var a=(0,it.getTractorFormulaInfo)(this);return null!=a&&Bc(n,it.TractorFormulaCacheProps.info,a),null!=(a=Hc(this))&&Bc(n,it.TractorFormulaCacheProps.info,a),a=function(e){var t,r,n=null!==(t=null===(r=e.getState().cache)||void 0===r?void 0:r.getInfo())&&void 0!==t?t:null;return null==n||null==n.arrayRef?null:{r:JSON.stringify(is(n.arrayRef,{ref:e.getRef()}))}}(this),null!=a&&Bc(n,it.TractorFormulaCacheProps.info,a),n=function(e,t,r){var n=t.getState().cache;if(null==n)return null;var a={e:JSON.stringify(t.canArrayExpand())},o=n.getRawVar();if(!Ha(o))return Bc(e,"a",a),e;try{for(var i=[],u=o.rowCount(),s=o.colCount(),l=0;l<u;++l)for(var c=0;c<s;++c){var h=Pc(o.at(l,c)).serialize();if(null==h)return null;i.push(h)}var f=t.getArrayRef();a.m=i,null!=r&&r.ignoreRowColLimit?(a.r=f.rowCount(!0),a.c=f.colCount(!0)):(a.r=f.rowCount(),a.c=f.colCount());var d=o.getSpecialInfo();d&&!(0,it.isEmptyObject)(d)&&(a.s=JSON.stringify(d))}catch(t){if(!ja(t))return null;var v=t.serialize();e[it.TractorFormulaCacheProps.value]=v,a.m=[v],a.r=1,a.c=1}return Bc(e,"a",a),e}(n,this,e),this.specialInfo&&!(0,it.isEmptyObject)(this.specialInfo)&&(n[it.TractorFormulaCacheProps.specialInfo]=JSON.stringify(this.specialInfo)),n}},{key:"calc",value:function(e){var r;return this.service.isSuspended()&&(null==e?void 0:e.executeMode)!==it.ExecuteMode.FORCE&&dv(this)?null!==(r=this.state.cache)&&void 0!==r?r:it.BaseFormulaVar.WAIT_ASYNC_FORMULA_CACHE:(0,f.Z)((0,v.Z)(t.prototype),"calc",this).call(this,e)}}],[{key:"setUnsetMatrixVarMode",value:function(e){t.unsetMatrixVarMode=e}},{key:"getUnsetMatrixVarMode",value:function(){return t.unsetMatrixVarMode}}]),t}(lv);function Hp(e,t,r,n){var a=t.rowFrom(),o=t.colFrom();if(e.getVar(a,o)!==r)return{arrayFormulaCanExpand:2,row:a,col:o};var i=n.rowCount(),u=n.colCount(),s=t.rowCount(),l=t.colCount();if(i!==s||u!==l)return{arrayFormulaCanExpand:3,rowCount:i-s,colCount:u-l};var c=e.getRowCount(),h=e.getColumnCount();if(a+i>c||o+u>h)return{arrayFormulaCanExpand:3,rowCount:c-(a+i),colCount:h-(o+u)};var f=t.sheet(),d=f.parent.calcEngine.pivotCalculateEngine,v=e.orderedIterCellWithPos(a,o,i,u).first_if((function(e){var t=(0,g.Z)(e,2),n=t[0],i=t[1],u=i.row,s=i.col,l=n.variant;if(u===a&&s===o){if(l&&Wp(l)&&l===r)return!1}else{if(l&&uo(l)&&l.formula===r)return!1;if(l&&co(l))return Boolean(d.getFormulaByPos(u,s,f.id()))}return n.hasContent()}));if(null==v)return{arrayFormulaCanExpand:1};var p=v[1];return{arrayFormulaCanExpand:2,row:p.row,col:p.col}}function zp(e,t){var r=t.sheet();if(r){var n=t.rowFrom(),a=t.colFrom(),o=r._dataModel,i=r.getCalcEngine();1!==t.size()&&(o.iterContentWithPos(n,a,t.rowCount(),t.colCount()).forEach((function(t){var r=(0,g.Z)(t,2),n=r[0],a=r[1],i=a.row,u=a.col;n.variant&&uo(n.variant)&&n.variant.formula===e&&o.setVariant(i,u,null)})),i.arrayFormulaExpand(t),r.dispatch("RangeChanged",{range:t,type:0}))}}function Wp(e){return e instanceof Up}Up.unsetMatrixVarMode=Dp.SetMatrixVar,Up.checkArrayFormulaExpandStateInModel=function(e,t){if(!Wp(t)||t.ignoreExpand)return!1;var r=t.state.cache;if(!r)return!1;var n=t.getRef(),a=n.sheet();if(null==a||!n.isValidRefInSheet(!0))return!1;var o=r.getRawVar();if(1===o.rowCount()&&1===o.colCount())return o!==Ce.aHq||1===t.canArrayExpand().arrayFormulaCanExpand;var i=n.rowFrom(),u=n.colFrom(),s=o.rowCount(),l=o.colCount(),c=new ou(i,u,s,l,a);return 1===Hp(a._dataModel,c,t,o).arrayFormulaCanExpand},Up.handleValueChanged=function(e){if(Wp(e)&&!e.ignoreExpand){var t=e.state.cache;if(null!=t){var r=e.getRef(),n=r.sheet();if(null!=n&&r.isValidRefInSheet(!0)){var a=t.getRawVar(),o=e.arrayRef;if(e.disposeRefWatcher&&(e.disposeRefWatcher(),e.disposeRefWatcher=null),1!==a.rowCount()||1!==a.colCount()){var i=r.rowFrom(),u=r.colFrom(),s=a.rowCount(),l=a.colCount(),c=new ou(i,u,s,l,n);t.setInfo(Object.assign({},t.getInfo(),{arrayRef:c}));var h=Hp(n._dataModel,c,e,a),f=h.arrayFormulaCanExpand;if(dv(e)){var d=Promise.resolve();3===f?d=d.then((function(){return function(e,t,r,n){if(!dv(t))return!1;var a=t.getRef(),o=a.rowFrom(),i=a.colFrom(),u=e.parent,s=u.importRangeManager,l=u.importRangeManagerV3;if(!dv(t)||t.hasImportRangeId()||Ce.Ps3.getImportRangeV2Enable()){var c=s.getIdFromFormula(t);if(!c)return!1;var h="".concat(c,"_").concat(o,"_").concat(i);if(!s.getImportRangeAutoExpand(h))return!1;s.collectImportRangeFrontError("importrange_add_row_col"),s.finishImportRangeAutoExpand(h)}else{var f=l.formula2ImportRange.get(gv(t));if(!f||1!==f.size)return!1;var d=f.values().next().value;if(!d)return!1;var v="".concat(d,"_").concat(o,"_").concat(i),p=l.importRangeAutoExpandSet;if(!p||!p.has(v))return!1;l.collectImportRangeFrontError("importrange_add_row_col"),p.delete(v)}return e.parent.commandManager().execute({cmd:Ce.rvF.ADD_ROW_AND_COL,sheetId:e.id(),addRowCount:r,addColCount:n})}(n,e,h.rowCount,h.colCount)})):function(e,t){if(t.isImportRange()){var r=e.parent.importRangeManager,n=r.getIdFromFormula(t);null!=n&&r.finishImportRangeAutoExpand(n)}}(n,e),d.then((function(e){if(1!==f&&!e){var t=n.parent.importRangeManager,r="";switch(f){case 3:r="lack_row_or_col";break;case 2:r="can_not_expand";break;default:r="unknown_array_expand_error"}t.collectImportRangeFrontError(r)}})),1===f&&Promise.resolve().then((function(){e.getArrayRef()===c&&function(e){try{var t=e.sheet();if(null==t)return;var r=t.parent.getActiveSheet();if(!r||t.id()!==r.id())return;var n=t.parent.commandManager();if(!n)return;var a=[],o=cp(t,[e],void 0,{executeLocal:!0}).oldActions;(0,Ce.hTd)(a,o),a.length>0&&n.execute({cmd:"setFilter",sheetId:t.id(),range:null,col:null,value:null,_changesets:[],_oldChangesets:a})}catch(e){console.error("extendFilterHelper.ts: extendFilterRangeCommand error")}}(c)}))}var v=e.canArrayExpand().arrayFormulaCanExpand;if(e.setArrayCanExpand(h),null!=o&&(1!==f&&1===v||!c.contain(o))&&zp(e,o),1===f){var p=function(e,t){var r=!0,n=t.rowFrom(),a=t.colFrom(),o=t.rowCount(),i=t.colCount(),u=t.sheet();if(!u)return r;for(var s=u._dataModel,l=0;l<o;l++)for(var c=0;c<i;c++)if(0!==l||0!==c){var h=s.getImmutableContent(n+l,a+c);h&&null!=h.variant&&uo(h.variant)&&h.variant.formula===e?(h.variant.getOffsetRow()===l&&h.variant.getOffsetCol()===c||(h.variant.setOffset({row:l,col:c}),r=!1),h.variant.updateCacheValue()&&(r=!1)):(s.setVariant(n+l,a+c,new Gp(e,l,c)),r=!1)}return r}(e,c);1===c.size()||p||(n.getCalcEngine().arrayFormulaExpand(c),n.dispatch("RangeChanged",{range:c,type:0}))}else 2===f&&1===v&&n.dispatch("RangeChanged",{range:c,type:0});e.setCurrentArrayRef(c),e.watchArrayRef(c)}else{if(function(e,t,r){if(t!==Ce.aHq)return!0;if(!r)return!1;var n=e.getRef();return!r.containCell(n.rowFrom(),n.colFrom())}(e,a,o)){if(null!=o){var m=o.colCount(),g=o.rowCount();(m>1||g>1)&&zp(e,o)}e.setArrayCanExpand({arrayFormulaCanExpand:1})}e.setCurrentArrayRef(null)}}}}};var Gp=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).formula=e,r.offsetRow=n,r.offsetCol=a,r.type=it.VAR_TYPE.FORMULA,r.value=it.NULL_VAR,r.value=r.getCalcVar(),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getCalcVar",value:function(){var e=this.formula.getState().cache;return e?Pc(e.getRawVar().at(this.offsetRow,this.offsetCol)):it.NULL_VAR}},{key:"getArrayRef",value:function(){return this.formula.getArrayRef()}},{key:"canArrayExpand",value:function(){return this.formula.canArrayExpand()}},{key:"isFormula",value:function(){return!1}},{key:"hasCache",value:function(){return!!this.formula.getState().cache}},{key:"updateCacheValue",value:function(){var e=this.getCalcVar(),t=!e.equals(this.value);return this.value=e,t}},{key:"getValue",value:function(){return this.value.getValue()}},{key:"getRawVar",value:function(){return this.formula.getRawVar()}},{key:"getVar",value:function(){return this.value}},{key:"isProxyArrayFormula",value:function(){return!0}},{key:"isSameFormula",value:function(e){return e instanceof Up?this.formula===e:e instanceof t&&this.formula===e.formula}},{key:"isInRange",value:function(e,t){var r=this.getArrayRef();return e<=r.rowTo()&&e>=r.rowFrom()&&t<=r.colTo()&&t>=r.colFrom()}},{key:"isInCorrectPosition",value:function(e,t){var r=this.getArrayRef();return!!this.isInRange(e,t)&&e-r.rowFrom()===this.offsetRow&&t-r.colFrom()===this.offsetCol}},{key:"fixOffset",value:function(e,t){var r=this.getArrayRef();this.isInRange(e,t)&&this.setOffset({row:e-r.rowFrom(),col:t-r.colFrom()})}},{key:"setOffset",value:function(e){var t=!1;"number"==typeof e.col&&e.col>=0&&(this.offsetCol=e.col,t=!0),"number"==typeof e.row&&e.row>=0&&(this.offsetRow=e.row,t=!0),t&&this.updateCacheValue()}},{key:"getOffset",value:function(){return{row:this.offsetRow,col:this.offsetCol}}},{key:"getOffsetRow",value:function(){return this.offsetRow}},{key:"getOffsetCol",value:function(){return this.offsetCol}},{key:"serialize",value:function(){return null}}]),t}(it.BaseVar);function jp(e){return e instanceof Gp}Gp.prototype.$$type=8320,function(e){e[e.None=0]="None",e[e.Shrink=1]="Shrink",e[e.Cover=2]="Cover",e[e.Circle=3]="Circle",e[e.ImportRange=4]="ImportRange",e[e.LessThanTwo=5]="LessThanTwo",e[e.CoverSource=6]="CoverSource",e[e.SourceHasPivot=7]="SourceHasPivot",e[e.ServiceCalcLoading=8]="ServiceCalcLoading",e[e.UnSupportVersion=9]="UnSupportVersion",e[e.FormulaError=10]="FormulaError",e[e.Loading=11]="Loading"}(Pp||(Pp={})),function(e){e[e.rowGrandTotal=0]="rowGrandTotal",e[e.colGrandTotal=1]="colGrandTotal",e[e.rowSubtotal=2]="rowSubtotal",e[e.colSubtotal=3]="colSubtotal",e[e.rowLabel=4]="rowLabel",e[e.colLabel=5]="colLabel"}($p||($p={})),function(e){e.Loading="Loading",e.Loaded="Loaded"}(Lp||(Lp={}));function Yp(e){if(e){if(e.formatter)return{isAuto:!1,formatter:e.formatter};if(e.autoFormatter)return{isAuto:!0,formatter:e.autoFormatter}}return{formatter:null,isAuto:!1}}function qp(e,t,r){if(r){var n=Yp(e).formatter;if(null!=t&&n instanceof Ee.Formatter)return{value:t=n.getEditingText(t),formatter:n}}return{value:Ee.GeneralFormatter.getEditingText(t)}}function Jp(e,t,r){if(e===Ce.KqL.General){var n=Ar._getType(t);e=r&&(0,Ee.isTextFormatter)(r)?Ce.KqL.Left:"boolean"===n?Ce.KqL.Center:"number"===n||"date"===n?Ce.KqL.Right:Ce.KqL.Left}return e}function Kp(e,t){var r;if(!t)return null;var n=!!co(t)&&(null===(r=e.getPivotTableManager().getPivotInfoByName(t.blockToken))||void 0===r?void 0:r.errorState)===Pp.FormulaError;if((t.isFormula()||jp(t)||n)&&t.getVar().isError()){var a=t.getVar();return!a.isError()||a.errorCode!==it.SUSPENDED_ERR_VAR.errorCode&&a.errorCode!==it.WAIT_ASYNC_ERR_VAR.errorCode?{suggestion:a,state:1}:null}return null}var Xp=new Map;function Qp(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e.fontSize===t.fontSize&&e.fontStyle===t.fontStyle&&e.fontWeight===t.fontWeight&&(!(!r||t.fontFamily&&(t.fontFamily,0))||e.fontFamily===t.fontFamily)}function em(e){var t=Xp.get(e);if(void 0!==t)return t;var r=Ca._scaleFont(e,1);return r.fontFamily,delete r.fontFamily,Xp.set(e,r),r}var tm,rm,nm,am=/pt/i;function om(e){if(void 0!==e){if("number"==typeof e)return e;var t=parseFloat(e);return Number.isNaN(t)?void 0:am.test(e)?Math.floor(96*t/72):Math.floor(t)}}function im(e){return void 0===e?void 0:"number"==typeof e?e:"bold"===e?700:"normal"===e?400:parseInt(e,10)||400}function um(e){if(e)return e["font-weight"]||e["font-style"]||e["font-size"]?{fontStyle:e["font-style"]||e.fontStyle,fontSize:om(e["font-size"]||e.fontSize),fontWeight:im(e["font-weight"]||e.fontWeight)}:"string"==typeof e.fontSize||"string"==typeof e.fontWeight?{fontFamily:e.fontFamily,fontStyle:e.fontStyle,fontSize:om(e.fontSize),fontWeight:im(e.fontWeight)}:e}function sm(e){var t={};if(void 0!==e._textDecoration){var r=e._textDecoration;0!=(r&Ce.aBM.lineThrough)?t.strikethrough="true":t.strikethrough="",0!=(r&Ce.aBM.underline)?t.underline="true":t.underline=""}var n=e.fontInfo;return n.fontWeight&&(700===n.fontWeight?t.bold="true":t.bold=""),n.fontStyle&&("italic"===n.fontStyle?t.italic="true":t.italic=""),n.fontSize&&(t.fontsize=n.fontSize+"px"),void 0!==e._foreColor&&(t.textcolor=e._foreColor),void 0!==n.fontFamily&&(t.fontfamily=n.fontFamily),t}function lm(e,t){if(!t)return e;var r=e,n=[Im[pm],Im[gm]],a=!1;return n.forEach((function(n){void 0===r[n]&&void 0!==t[n]&&(a||(r=e.clone(!0),a=!0),r[n]=t[n])})),r}function cm(e,t,r){var n=["fontStyle","fontWeight","fontSize"],a=["foreColor","textDecoration"],o=new Array(r.length);return r.forEach((function(r,i){var u=r.style;if(u){if(!(u instanceof Om))throw new Error("The segmemnt style is not type of Style, did you pass SegementForChangeset to this?");var s=!1,l={};a.forEach((function(r){var n=e[r],a=t[r],o=u[r];o===n&&o!==a&&(l[r]=a,s=!0)}));var c={};n.forEach((function(r){var n,a,o,i=null===(n=e._font)||void 0===n?void 0:n[r],s=null===(a=t._font)||void 0===a?void 0:a[r],l=null===(o=u._font)||void 0===o?void 0:o[r];l===i&&l!==s&&(c[r]=s)})),(0,me.default)(c,{})||(l.fontInfo=c,s=!0),s&&(o[i]=Om.withUpdateStyle(u,l))}})),o}function hm(){return!!Ce.Ps3.getSheetFontDataCleanEnable&&!Ce.Ps3.getSheetFontDataCleanEnable()}!function(e){e[e.unset=0]="unset",e[e.none=1]="none",e[e.thin=2]="thin",e[e.medium=3]="medium",e[e.thick=4]="thick",e[e.dotted=5]="dotted",e[e.dashed=6]="dashed",e[e.double=7]="double",e[e.hair=8]="hair",e[e.dashDot=9]="dashDot",e[e.dashDotDot=10]="dashDotDot",e[e.slantDashDot=11]="slantDashDot",e[e.mediumDashed=12]="mediumDashed",e[e.mediumDashDot=13]="mediumDashDot",e[e.mediumDashDotDot=14]="mediumDashDotDot"}(tm||(tm={})),function(e){e[e.OVERFLOW=0]="OVERFLOW",e[e.AUTOWRAP=1]="AUTOWRAP",e[e.WORDCLIP=2]="WORDCLIP"}(rm||(rm={})),function(e){e.TOP="Top",e.RIGHT="Right",e.BOTTOM="Bottom",e.LEFT="Left"}(nm||(nm={}));var fm=["Top","Right","Bottom","Left"],dm=function(){function e(t,r,n){(0,y.Z)(this,e),this.color=t,this.width=r,(0,ye.default)(n)||(this.lineStyle=n)}return(0,_.Z)(e,[{key:"_clone",value:function(){return new e(this.color,this.width,this.lineStyle)}},{key:"toJSON",value:function(){var e={},t=this.color,r=this.width,n=this.lineStyle;return e.color=t,e.width=r,(0,ye.default)(n)||(e.lineStyle=n),e}},{key:"equals",value:function(e){return this===e||!!e&&this.color===e.color&&this.width===e.width&&this.lineStyle===e.lineStyle}}],[{key:"fromJSON",value:function(t){if(t)return new e(t.color,t.width,t.lineStyle)}}]),e}(),vm=function(){function e(t,r,n,a){(0,y.Z)(this,e),this.fontFamily=a,this.fontSize=t,this.fontStyle=r,this.fontWeight=n}return(0,_.Z)(e,[{key:"getHash",value:function(e){return Fa([this.fontSize,this.fontStyle,this.fontWeight,this.fontFamily],e)}},{key:"equals",value:function(e){return this===e||!!e&&this.fontSize===e.fontSize&&this.fontStyle===e.fontStyle&&this.fontWeight===e.fontWeight&&this.fontFamily===e.fontFamily}},{key:"toFontString",value:function(){return this._cachedFontString||(this._cachedFontString=function(e,t){var r,n,a;a=400===e.fontWeight?"normal":700===e.fontWeight?"bold":(null===(r=e.fontWeight)||void 0===r?void 0:r.toString())||null;var o=null!==(n=e.fontFamily)&&void 0!==n?n:null;return t||(o=(0,Ce.M10)()),Ca._buildFontString({fontFamily:o,fontWeight:a,fontSize:e.fontSize?"".concat(Aa(e.fontSize),"pt"):null,fontStyle:e.fontStyle||null,fontVariant:null,lineHeight:"1.5"},t)}(this)),this._cachedFontString}},{key:"getActual",value:function(){return{fontFamily:this.fontFamily||(0,Ce.M10)(),fontSize:this.fontSize||Ce.OvR,fontStyle:this.fontStyle||"normal",fontWeight:this.fontWeight||400}}},{key:"toJSON",value:function(){var e={};return this.fontFamily&&(e.fontFamily=this.fontFamily),this.fontSize&&(e.fontSize=this.fontSize),this.fontStyle&&(e.fontStyle=this.fontStyle),this.fontWeight&&(e.fontWeight=this.fontWeight),e}}],[{key:"getOrCreateStyleFont",value:function(t,r,n,a){var o,i=Fa("".concat(t,"_").concat(r,"_").concat(n,"_").concat(a)),u=this.styleFontCache.get(i);return void 0===u&&(u=[],this.styleFontCache.set(i,u)),u.length>0&&(o=u.find((function(e){return e.fontSize===t&&e.fontStyle===r&&e.fontWeight===n&&e.fontFamily===a}))),void 0===o&&(o=new e(t,r,n,a),u.push(o)),o}},{key:"valueOf",value:function(e,t,r,n){var a,o;return"string"==typeof e?(o=(a=em(e)).fontSize,t=a.fontStyle,n=a.fontFamily,r=a.fontWeight):o=e,this.getOrCreateStyleFont(o,t,r,n)}},{key:"withUpdate",value:function(e,t){var r,n,a,o;return t=um(t),this.valueOf((null===(r=t)||void 0===r?void 0:r.fontSize)||(null==e?void 0:e.fontSize),(null===(n=t)||void 0===n?void 0:n.fontStyle)||(null==e?void 0:e.fontStyle),(null===(a=t)||void 0===a?void 0:a.fontWeight)||(null==e?void 0:e.fontWeight),(null===(o=t)||void 0===o?void 0:o.fontFamily)||(null==e?void 0:e.fontFamily))}},{key:"fromJSON",value:function(e){var t=(e=um(e)).fontFamily;return t&&(t=void 0),this.valueOf(e.fontSize,e.fontStyle,e.fontWeight,t)}}]),e}();vm.styleFontCache=new Map,vm.EMPTY=vm.valueOf();var pm="formatter",mm="fontInfo",gm="autoFormatter",ym="borderLeft",_m="borderTop",Rm="borderRight",Cm="borderBottom",wm="wordWrap",Em="textDecoration",km="dropdown",Tm="diagonal",Sm="font",Am={_vAlign:"vAlign",_hAlign:"hAlign",_textDecoration:Em,_foreColor:"foreColor",_font:mm,_borderLeft:ym,_borderTop:_m,_borderRight:Rm,_borderBottom:Cm,_wordWrap:wm,_backColor:"backColor",_hideLink:"hideLink",_dropdown:km,_formatter:pm,_autoFormatter:gm,_diagonal:Tm,_diagonalUp:"diagonalUp",_diagonalDown:"diagonalDown",_textRotation:"textRotation"},Im=(0,pe.Z)(Am),Om=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"clone",value:function(t){var r=new e;for(var n in Am){var a=this[n];void 0!==a&&(r[n]=!t&&(null==a?void 0:a._clone)instanceof Function&&a._clone()||a)}return r._default=this._default,r}},{key:"getHash",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=e;for(var r in Am){var n=this[r];switch(Am[r]){case pm:case gm:t=n?Fa(n.getFormatCode(),t):t;break;case km:case mm:t=n?Fa(n.getHash(),t):t;break;default:t=Fa(n,t)}}return t}},{key:"equals",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!e)return!1;if(this===e)return!0;for(var r in Am){var n=this[r],a=e[r];if(t||Am[r]!==Em){if(n&&n.equals){if(null==a||!n.equals(a))return!1}else if(!(0,me.default)(n,a))return!1}else if(!this._textDecorationLooseEquals(n,a))return!1}return!0}},{key:"_textDecorationLooseEquals",value:function(e,t){return e===t||void 0===e&&0===t||0===e&&void 0===t}},{key:"toJSON",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!0===e||!this.equals(this._default)){var t={};if(this._formatter instanceof Ee.Formatter){var r,n=null!==(r=this._formatter.toJSON())&&void 0!==r?r:{formatCached:"General"};t[pm]=n}for(var a in this._font&&(hm()?t[Sm]=this._font.toFontString():t[mm]=this._font.toJSON()),Am){var o=Am[a];if(o!==pm&&o!==mm){var i=this[a];void 0!==i&&(t[o]=i&&i.toJSON instanceof Function?i.toJSON():i)}}return 0!==Object.keys(t).length?t:void 0}}},{key:"setDefault",value:function(e){this._default=e}},{key:"isDefault",value:function(){return this.equals(this._default||Mm())}},{key:"toFasterHAlign",value:function(e){return this._hAlign===Ce.KqL.General?e.getValue()instanceof Array?Ce.KqL.Left:Jp(this.hAlign,e.getValue(),this.formatter):this._hAlign}},{key:"_updateFromJSON",value:function(e,t){if(e){var r=function(e,t){return t?vm.fromJSON(t):e?vm.valueOf(e):null}(e[Sm],e[mm]);for(var n in r&&(this._font=r),Am){var a=Am[n],o=e[a];if(void 0!==o)switch(a){case pm:if(!t)throw new Error("Unexpected behaviour, trying to update formatter without formatter service");this[n]=Nm(t,o);break;case gm:if(!t)throw new Error("Unexpected behaviour, trying to update formatter without formatter service");var i=Nm(t,o);this._setAutoFormatter(i);break;case Tm:case ym:case _m:case Rm:case Cm:this[n]=dm.fromJSON(o);break;case km:break;case wm:this[n]=Vm(o);break;case mm:break;default:this[n]=null!==o?o:void 0}}}}},{key:"_setAutoFormatter",value:function(e){var t;null!==(t=e)&&void 0!==t&&t.toJSON()||(e=void 0),this._autoFormatter=e}},{key:"vAlign",get:function(){return this._vAlign}},{key:"hAlign",get:function(){return this._hAlign}},{key:"textDecoration",get:function(){return this._textDecoration}},{key:"foreColor",get:function(){return this._foreColor}},{key:"backColor",get:function(){return this._backColor}},{key:"borderLeft",get:function(){return this._borderLeft}},{key:"borderTop",get:function(){return this._borderTop}},{key:"borderRight",get:function(){return this._borderRight}},{key:"borderBottom",get:function(){return this._borderBottom}},{key:"diagonal",get:function(){return this._diagonal}},{key:"diagonalUp",get:function(){return this._diagonalUp}},{key:"diagonalDown",get:function(){return this._diagonalDown}},{key:"textRotation",get:function(){return this._textRotation}},{key:"wordWrap",get:function(){return this._wordWrap}},{key:"fontInfo",get:function(){var e;return(null===(e=this._font)||void 0===e?void 0:e.getActual())||{}}},{key:"rawFont",get:function(){return this._font}},{key:"fontSizePx",get:function(){var e;return null===(e=this._font)||void 0===e?void 0:e.fontSize}},{key:"hideLink",get:function(){return!0===this._hideLink}},{key:"dropdown",get:function(){return this._dropdown}},{key:"formatter",get:function(){return this._formatter}},{key:"autoFormatter",get:function(){return this._autoFormatter}},{key:"locked",get:function(){}}],[{key:"withUpdateStyle",value:function(e,t,r){if(!t||(0,me.default)(t,{}))return e;var n=t.fontInfo,a=t.textDecoration,o=(0,s.Z)(t,fr),i=e.clone();if(n&&(i._font=vm.withUpdate(i._font,n),delete o.font),a&&!(0,ve.default)(a)){var u=e._textDecoration;o.textDecoration=Ca._updateTextDecoration(u,a)}else"textDecoration"in t&&(o.textDecoration=a);return i._updateFromJSON(o,r),i}},{key:"withDropdown",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((0,me.default)(e._dropdown,t))return e;var n=e.clone();return(r||t)&&(n._dropdown=null==t?void 0:t.clone()),n}},{key:"delBorder",value:function(e,t){var r=e.clone();if("borderLeft"===t)r._borderLeft=void 0;else if("borderRight"===t)r._borderRight=void 0;else if("borderTop"===t)r._borderTop=void 0;else{if("borderBottom"!==t)throw new Error("Unreachable Code");r._borderBottom=void 0}return r}},{key:"withBorders",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,a=t.borderLeft,o=t.borderRight,i=t.borderBottom,u=t.borderTop,s=t.diagonal,l=t.diagonalUp,c=t.diagonalDown,h=e.clone(),f=function(e,t){(t||r)&&(h[e]=t)};return f("_borderLeft",a),f("_borderBottom",i),f("_borderRight",o),f("_borderTop",u),n&&["noborder","diagonalup","diagonaldown"].includes(n)&&(f("_diagonal",s),f("_diagonalUp",l),f("_diagonalDown",c)),h}},{key:"withAutoFormatter",value:function(e,t){var r;if(null!==(r=t)&&void 0!==r&&r.toJSON()||(t=void 0),(0,me.default)(e.autoFormatter,t))return e;var n=e.clone();return n._autoFormatter=t,n}},{key:"withFormatter",value:function(e,t){if((0,me.default)(e.formatter,t))return e;var r=e.clone();return r._formatter=t||void 0,r}},{key:"newStyle",value:function(e,t,r){return!e||(0,me.default)(e,{})?(null==t?void 0:t.clone())||Mm().clone():this.withUpdateStyle(t||Mm(),e,r)}},{key:"newStyleWithoutDefault",value:function(t,r,n){return this.withUpdateStyle(r||new e,t,n)}},{key:"fromJSON",value:function(t,r,n){if(!r)return(null==n?void 0:n.clone())||new e;var a=(null==n?void 0:n.clone())||new e;return a._updateFromJSON(r,t),a}},{key:"extractCommonStyle",value:function(e){if(!e||e.length<=0)return{commonStyle:void 0,hasDifference:!1};var t,r=!1,n=e[0],a=Object.assign.apply(Object,[{}].concat((0,m.Z)(this.possibleCommonProperties.map((function(e){return(0,l.Z)({},e,n[e])})))));n._font&&(t=Object.assign.apply(Object,[{}].concat((0,m.Z)(this.possibleFontProperties.map((function(e){var t;return(0,l.Z)({},e,null===(t=n._font)||void 0===t?void 0:t[e])}))))));for(var o=1;o<e.length;o++){var i,u=e[o],s=yr(this.possibleCommonProperties);try{for(s.s();!(i=s.n()).done;){var c=i.value;if(a.hasOwnProperty(c)){var h=a[c],f=u[c];h===f||"object"==(0,R.Z)(h)&&h.equals instanceof Function&&h.equals(f)||(delete a[c],r=!0)}}}catch(e){s.e(e)}finally{s.f()}if(t){var d,v=yr(this.possibleFontProperties);try{for(v.s();!(d=v.n()).done;){var p,g=d.value;if(t.hasOwnProperty(g))t[g]!==(null===(p=u._font)||void 0===p?void 0:p[g])&&(delete t[g],r=!0)}}catch(e){v.e(e)}finally{v.f()}}}return"{}"===JSON.stringify(t)&&(t=void 0),t||"{}"!==JSON.stringify(a)?{commonStyle:{fontInfo:t,foreColor:a._foreColor,backColor:a._backColor,textDecoration:a._textDecoration},hasDifference:r}:{commonStyle:void 0,hasDifference:r}}},{key:"composeStyles",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];if(void 0===n||n.length<=0)return e;var o=function(e,t){for(var r in Am){var n=t[r];Am[r]!==mm?void 0===e[r]&&(n&&n._clone instanceof Function?e[r]=n._clone()||n:e[r]=n):e[r]=vm.withUpdate(n,e[r])}e._default||(e._default=t._default)},i=null===(t=n[0])||void 0===t?void 0:t.clone();if(i){for(var u=1;u<n.length;u++)n[u]&&o(i,n[u]);return e&&o(i,e),i}return e}}]),e}();function Vm(e){return!1===e?0:!0===e?1:"object"==(0,R.Z)(e)?null!=e&&e.wrap?Vm(e.wrap):0:e}function Nm(e,t){return"string"==typeof t?""===t?(0,Ee.createFormatter)(e):(0,Ee.createFormatter)(e,t):t instanceof Ee.Formatter?t:null!==t&&"object"==(0,R.Z)(t)?Ee.Formatter.fromJSON(e,t):void 0}Om.EMPTY=new Om,Om.possibleCommonProperties=["_foreColor","_backColor","_textDecoration"],Om.possibleFontProperties=["fontSize","fontStyle","fontWeight"];var bm=null;function Mm(){if(bm)return bm;var e=new Om;return e._font=vm.valueOf(Ce.OvR,"normal",400),e._vAlign=Ce.g$I.Bottom,e._hAlign=Ce.KqL.General,e._wordWrap=0,e.setDefault(e),Object.freeze(e),bm=e}function Fm(e){return void 0!==e}function Zm(e){return document.createElement(e)}function xm(e,t,r,n){var a=function(a,o){this.hasOwnProperty("_ps")||(this._ps={});var i=this._ps;if(0===arguments.length)return void 0!==i[e]?i[e]:t;if(!1===o||!n||n.call(this,a)){var u=void 0!==i[e]?i[e]:t;u!==a&&(i[e]=a,!1!==o&&r&&r.call(this,a,u))}return this};return a.isDefault=function(e){return e===t},a}function Dm(e,t){var r={_ps:{}};return Ar._each(e,(function(e){!function(e,t,r){Object.defineProperty(e,t,{get:function(){return this._ps[t]},set:function(e){var n=this._ps[t];n!==e&&(this._ps[t]=e,r&&r(t,e,n))},enumerable:!0})}(r,e,t)})),r}var Pm=function(){};Pm._getColor=function(e,t){if(e&&t){var r=e._currentTheme;if(r)return r.getColor(t)}return t},Pm._getFont=function(e,t){if(e&&t){var r=e._currentTheme;return r?r.getFont(t):t}return null};var $m="worksheet/sheetDataModel",Lm="worksheet",Bm="worksheet/watchedRefHub",Um="worksheet/getService",Hm="worksheet/I18N",zm="worksheet/stageTracker",Wm=Symbol("SheetDep/Moirae"),Gm=function(){function e(t){(0,y.Z)(this,e),this.sheet=t}return(0,_.Z)(e,[{key:"getFormatCode",value:function(e,t){return this.sheet.getFormatCode(e,t)}},{key:"getActualFormatter",value:function(e,t){return this.sheet.getActualFormatter(e,t)}},{key:"getInternationalText",value:function(e,t){return this.sheet.getInternationalText(e,t)}},{key:"getValue",value:function(e,t){return this.sheet.getValue(e,t)}},{key:"getValueWithStringFormatter",value:function(e,t){var r=this.sheet.getActualFormatter(e,t),n=this.getValue(e,t);return null!=r&&r.getFormatters().find((function(e){return"@"===e.getFormatCode()}))?"".concat(n):n}},{key:"getText",value:function(e,t){return this.sheet.getText(e,t)}},{key:"getStyle",value:function(e,t){return this.sheet.getStyleWithConditionalFormat(e,t)}},{key:"getSpan",value:function(e,t){return this.sheet.getSpan(e,t)}},{key:"getSegmentArray",value:function(e,t){return this.sheet.getSegmentArray(e,t)}},{key:"getCellFormatter",value:function(e,t){return this.sheet.getCellFormatter(e,t)}},{key:"getSheet",value:function(){return this.sheet}}]),e}();Gm=Vu([(0,st.b)(),Nu(0,(0,lt.f)(Lm))],Gm);var jm=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"getSelections",value:function(){var e;return(e=this.sheet).getSelections.apply(e,arguments)}},{key:"setSelection",value:function(){var e;return(e=this.sheet).setSelection.apply(e,arguments)}},{key:"getResponsableFilterRange",value:function(e){var t=this.getSelections()[0];if(t){var r,n=this.sheet.getColumnCount(),a=this.sheet.getRowCount(),o=t.rowFrom(),i=t.colFrom(),u=t.rowCount(),s=t.colCount(),l=!1,c=!1,h=!1,f=!1;if(1===u&&s===n)return new ou(o,0,a-o,n,this.sheet);1===u&&1===s||null!==(r=this.sheet.getSpan(o,i))&&void 0!==r&&r.equal(t)?(l=!0,c=!0,h=!0,f=!0):1===u&&s>1&&(c=!0);var d=this.sheet,v=d.viewsModel.activeView,p=!(!v||(0,Ce.y_b)(v.getId())),m=d.parent.editable,g=Object.assign({isExcludePivotTable:!Ce.Ps3.getSheetPivotAllowFilter()||m&&!p},e);return this.getResponsableRange(t,{up:l,down:c,left:h,right:f},g)}return t}},{key:"getResponsableRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{up:!0,down:!0,left:!0,right:!0},r=arguments.length>2?arguments[2]:void 0;this.stageTracker(Ce.FHD.GET_RESPONSABLE_RANGE,0);for(var n=this.sheet.getRowCount(),a=this.sheet.getColumnCount(),o=e.clone(),i=new Map,u=this.getCellsInSpan(this.sheet.getSpans()),s=!0;s;)s=!1,t.left&&(s=s||this.expandLeft(o,u,i,r)),t.up&&(s=s||this.expandUp(o,u,i,r)),t.right&&(s=s||this.expandRight(o,u,i,a,r)),t.down&&(s=s||this.expandDown(o,u,i,n,r));return this.stageTracker(Ce.FHD.GET_RESPONSABLE_RANGE,1,{row:o.rowFrom(),col:o.colFrom(),row_count:o.rowCount(),col_count:o.colCount(),cell_count:o.rowCount()*o.colCount()}),o}},{key:"getCellsInSpan",value:function(e){var t=this,r={};return e.forEach((function(e){for(var n=e.rowFrom(),a=e.colFrom(),o=e.rowCount(),i=e.colCount(),u=t.sheetFacade.getValue(n,a),s=n+o,l=a+i,c=n;c<s;c++)for(var h=a;h<l;h++)r[c]||(r[c]={}),r[c][h]={span:e,value:u}})),r}},{key:"expandRight",value:function(e,t,r,n,a){var o=e.colFrom()+e.colCount();return!(o>=n||!this.hasValueInRowOrCol(t,{rowOrCol:"row",position:o},e.rowFrom(),e.rowFrom()+e.rowCount(),r,a)||(e.setColCount(e.colCount()+1),0))}},{key:"expandDown",value:function(e,t,r,n,a,o){var i=e.rowFrom()+e.rowCount();return!(i>=n)&&(o&&this.sheet._isRowFilterOut(i)||!!this.hasValueInRowOrCol(t,{rowOrCol:"col",position:i},e.colFrom(),e.colFrom()+e.colCount(),r,a))&&(e.setRowCount(e.rowCount()+1),!0)}},{key:"expandUp",value:function(e,t,r,n){var a=e.rowFrom()-1;return!(a<0||!this.hasValueInRowOrCol(t,{rowOrCol:"col",position:a},e.colFrom(),e.colFrom()+e.colCount(),r,n)||(e.setRowFrom(a),e.setRowCount(e.rowCount()+1),0))}},{key:"expandLeft",value:function(e,t,r,n){var a=e.colFrom()-1;return!(a<0||!this.hasValueInRowOrCol(t,{rowOrCol:"row",position:a},e.rowFrom(),e.rowFrom()+e.rowCount(),r,n)||(e.setColFrom(a),e.setColCount(e.colCount()+1),0))}},{key:"hasValueInRowOrCol",value:function(e,t,r,n,a,o){for(var i="col"===t.rowOrCol?"row-".concat(t.position):"col-".concat(t.position),u=a.get(i),s=r;s<n;)if(u&&s>=u.start&&s<u.end)s=u.end;else{if("col"===t.rowOrCol&&this.hasValue(e,t.position,s,o))return!0;if("row"===t.rowOrCol&&this.hasValue(e,s,t.position,o))return!0;s++}return a.set(i,{start:r,end:n}),!1}},{key:"cellhasVisibleStyle",value:function(e,t){var r=this.sheet.getImmutableStyle(e,t),n=r.backColor,a=r.borderBottom,o=r.borderLeft,i=r.borderRight,u=r.borderTop,s=r.diagonal,l=r.diagonalUp,c=r.diagonalDown;return!!(n||a||o||i||u||s&&(l||c))}},{key:"cellHasValue",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.sheetFacade.getSegmentArray(e,t)||this.sheetFacade.getValue(e,t);return r?null!==n&&("string"!=typeof n||""!==n.trim()):""!==n&&null!==n}},{key:"hasValue",value:function(e,t,r,n){var a=this,o=n||{isIncludeStyle:!1,trimValue:!1,isExcludePivotTable:!1,isIncludeDropdown:!1,isIncludeEmptySpan:!1,isIncludeSparkline:!1,isIncludeFormula:!1},i=o.isIncludeStyle,u=o.isIncludeEmptySpan,s=o.trimValue,l=o.isExcludePivotTable,c=o.isIncludeDropdown,h=o.isIncludeSparkline,f=o.isIncludeFormula,d=this.sheet.getPivotTableManager();if(l&&d.hasPivotTableAtCell(t,r))return!1;return(function(e,t,r){return Boolean(e[t]&&e[t][r])}(e,t,r)?u||function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e[t]&&e[t][r]?e[t][r].value:null;return n?null!==a&&("string"!=typeof a||""!==a.trim()):""!==a&&null!==a}(e,t,r,s):a.cellHasValue(t,r,s))||i&&a.cellhasVisibleStyle(t,r)||c&&a.sheet.dataValidationService.hasDropdown(t,r)||h&&a.sheet.getSparklineByCell(t,r)||f&&a.sheet.hasFormula(t,r)}}]),e}();Vu([(0,lt.f)(Lm)],jm.prototype,"sheet",void 0),Vu([(0,lt.f)(Gm)],jm.prototype,"sheetFacade",void 0),Vu([(0,lt.f)(zm)],jm.prototype,"stageTracker",void 0),jm=Vu([(0,st.b)()],jm);var Ym=function(e,t){try{if(!e)return!1;var r=e.colFrom(),n=e.colCount();if(!t)return{rowFrom:e.rowFrom()+1,colFrom:r,rowCount:e.rowCount()-1,colCount:n};var a=t.colFrom(),o=t.colCount();return!(r<=a&&n>=o)&&{rowFrom:t.rowFrom()+1,colFrom:a,rowCount:t.rowCount()-1,colCount:o}}catch(e){return!1}};function qm(e,t){return-1===e||-1===t?-1:e>t?e:t}function Jm(e,t){return e<t?e:t}var Km=-1;function Xm(e,t){if(e&&t){var r=Jm(e.row,t.row),n=qm(e.row_end,t.row_end),a=Jm(e.col,t.col),o=qm(e.col_end,t.col_end);return{row:r,col:a,row_end:n,col_end:o,row_count:-1===n?-1:n-r+1,col_count:-1===o?-1:o-a+1}}return e||t}function Qm(e){if(!e)throw Error("formatToRange:Target Cannot Be NULL");var t=Object.assign({row:0,row_count:Km,row_end:Km,col:0,col_count:Km,col_end:Km},e);return function(e){var t=e.row,r=e.col,n=e.row_count,a=e.col_count;return null!=t&&null!=n&&(null==r||0===r)&&null==a}(e)?(t.row_end=e.row+e.row_count-1,t.col=0,t.col_count=Km,t.col_end=Km):function(e){var t=e.row,r=e.col,n=e.row_count,a=e.col_count;return(null==t||0===t)&&null==n&&null!=r&&null!=a}(e)?(t.col_end=e.col+e.col_count-1,t.row=0,t.row_count=Km,t.row_end=Km):(function(e){var t=e.row,r=e.col,n=e.row_count,a=e.col_count;return null!=t&&null!=r&&null!=n&&0!==n&&null!=a&&0!==a}(e)?(t.row_count=e.row_count,t.col_count=e.col_count):(t.row_count=1,t.col_count=1),t.row_end=e.row+t.row_count-1,t.col_end=e.col+t.col_count-1),t}function eg(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{up:!0,down:!0,left:!0,right:!0},n=arguments.length>3?arguments[3]:void 0;return e.inject(jm).getResponsableRange(t,r,n)}function tg(e,t){return e.inject(jm).getResponsableFilterRange(t)}var rg,ng=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this)))._info=e,r._isReverse=n,r._isReverse?r._count=r._info.count+1:r._count=-1,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"next",value:function(){return this._isReverse?this.reverseNext():this.normalNext()}},{key:"normalNext",value:function(){return this._count++,this._count<0||this._count>=this._info.count?null:this._info.index+this._count}},{key:"reverseNext",value:function(){return this._count--,this._count<=0||this._count>this._info.count?null:this._info.index+this._count-this._info.count}}]),t}(_t.FIterator);function ag(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={RETURN_DOM_FRAGMENT:!1,RETURN_DOM:!1};return ot().sanitize(e,Object.assign({},t,{},r))}!function(e){e[e.Equal=0]="Equal",e[e.GreaterThan=1]="GreaterThan",e[e.LessThan=-1]="LessThan"}(rg||(rg={}));var og=dn._Types._isNullOrUndefined;function ig(e,t,r,n,a){return e===t?0:"string"===n&&"string"===a?function(e,t,r){var n=(0,Ce.$1K)().compare(e.toLowerCase(),t.toLowerCase());return 0===n?0:n>0?r?1:-1:r?-1:1}(e,t,r):function(e,t,r,n){var a="number"===n,o="string"===r,i="string"===n;return r===n||"number"!==r&&!a?!("boolean"!==r||!i)||(!o||"boolean"!==n)&&(o&&i?1===(0,Ce.$1K)().compare(e.toLowerCase(),t.toLowerCase()):e>t):a}(e,t,n,a)?r?1:-1:r?-1:1}function ug(e,t,r){var n=0,a=(0,R.Z)(e),o=(0,R.Z)(t),i=og(e)||"number"===a&&isNaN(e),u=og(t)||"number"===o&&isNaN(t);return i||u?i&&u?n=0:i&&!u?n=1:!i&&u&&(n=-1):n=ig(e,t,r,a,o),n}function sg(e){return e instanceof Date&&(e=e.getTime()),e}function lg(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return[e]},n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=function(e){return a&&"function"==typeof a?a(e):e.sort((function(e,t){return ug(r(e)[0],r(t)[0],!0)}))},i=[];if(t.length){var u=function(){var a,u=t.join(" "),s=[function(e){return e.toLowerCase()===u.toLowerCase()},function(e){return e.toLowerCase().includes(u.toLowerCase())},function(e){var r=e.toLowerCase().split(/\s+/);return t.some((function(e){return r.includes(e.toLowerCase())}))},function(e){return t.some((function(t){return e.toLowerCase().includes(t.toLowerCase())}))}],l=[],c=u.split(/\s+/).map((function(e){return Number(e)})).filter((function(e){return!isNaN(e)})),h=yr(e);try{var f=function(){var e=a.value,t=r(e),o=Array.isArray(t)?t:[t];!function(){var t,r=yr(new Set(o));try{for(r.s();!(t=r.n()).done;){var a=t.value;if("number"==typeof a&&c.includes(a))return l[0]=l[0]||[],void l[0].push(e);for(var u=0,h=s.length;u<h;u++)if(s[u](String(a)))return l[u]=l[u]||[],void l[u].push(e);if(null!=n&&n(e))return void i.push(e)}}catch(e){r.e(e)}finally{r.f()}}()};for(h.s();!(a=h.n()).done;)f()}catch(e){h.e(e)}finally{h.f()}return{v:l.flatMap((function(e){return o(e)})).concat(i)}}();if("object"===(0,R.Z)(u))return u.v}return o(e)}var cg,hg=function(){function e(t){(0,y.Z)(this,e),this.value=t}return(0,_.Z)(e,[{key:"rowCount",value:function(){return this.value.length}},{key:"colCount",value:function(){return this.value.length>0?this.value[0].length:0}},{key:"size",value:function(){return this.rowCount()*this.colCount()}}]),e}();!function(e){e[e.setSelection=0]="setSelection",e[e.addSelection=1]="addSelection",e[e.setActiveCell=2]="setActiveCell",e[e.clearSelection=3]="clearSelection",e[e.expandSelectedRange=4]="expandSelectedRange"}(cg||(cg={}));var fg=function(){function e(){(0,y.Z)(this,e),this.hooks=new Map}return(0,_.Z)(e,[{key:"setHook",value:function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.hooks.get(e)||[],a=n.length,o=n.length-1;o>=0&&r>n[o][1];o--)a=o;n.splice(a,0,[t,r]),this.hooks.set(e,n)}},{key:"getHooks",value:function(e){var t=this.hooks.get(e);return t?t.map((function(e){return e[0]})):[]}},{key:"removeHook",value:function(e,t){var r=this.hooks.get(e);if(r){for(var n=-1,a=r.length-1;a>=0;a--)if(t===r[a][0]){n=a;break}-1!==n&&r.splice(n,1)}}}]),e}(),dg=["=","+"];function vg(e){return(e=e.trim()).length>1&&dg.some((function(t){return e.startsWith(t)}))}var pg=sa,mg=document,gg=parseInt,yg=isNaN;var _g={_cancelDefault:function(e){return e.preventDefault?(e.preventDefault(),e.stopPropagation()):(e.cancelBubble=!1,e.returnValue=!1),!1},_getRelativeOffset:function(e,t){var r=0,n=0;if(e!==t){var a=pg(e).offset(),o=pg(t).offset();r=a.left-o.left,n=a.top-o.top}return{_top:n,_left:r}},_defProperty:xm,_isDefined:Fm,_parseText2Value:ca};_g._isStringNumber=la,_g._parseText2Value=ca,_g._getValueAndStyleFromEditing=function(e,t,r,n,a,o){var i=e.getActualStyle(t,r);"string"==typeof n&&!o&&e.getReminder(t,r)&&(i=i.formatter?Om.withFormatter(i,e.getReminderFormatter(t,r)):Om.withAutoFormatter(i,(0,Ee.getPreferredFormatter)(e.formatterService,n).formatter));var u=ca(e.formatterService,i,n,a),s=u&&u.autoFormatter,l=u&&u.value,c=e.getStyleWithDropdown(t,r)||e.getDefaultStyle();return{value:l,styleWithDropdown:c=Om.withAutoFormatter(c,s)}},_g._getPreferredZIndex=function(e){for(var t=mg.body,r=e;r&&r.parentElement&&r.parentElement!==t;)r=r.parentElement;var n,a=1e3;return r&&r.parentElement===t&&(n=gg(pg(r).css("z-index")),yg(n)||(a+=n)),a},_g._createElement=Zm,_g._createOptions=Dm;var Rg=function(){function e(t,r,n,a){(0,y.Z)(this,e),this.list=t,this.isValid=r,this.isEnableOptionColor=n,this.color=a}return(0,_.Z)(e,[{key:"toJSON",value:function(){var e={};return null!=this.list&&(e.list=this.list.slice(0)),void 0!==this.isValid&&(e.isValid=this.isValid),void 0!==this.isEnableOptionColor&&(e.isEnableOptionColor=this.isEnableOptionColor),null!=this.color&&(e.color=this.color.slice(0)),e}},{key:"clone",value:function(){return new e(this.list&&this.list.slice(),this.isValid,this.isEnableOptionColor,this.color&&this.color.slice())}},{key:"setValid",value:function(t){return this.isValid===t?this:new e(this.list,t,this.isEnableOptionColor,this.color)}},{key:"equals",value:function(e){return!!e&&(this===e||this.isValid===e.isValid&&this.isEnableOptionColor===e.isEnableOptionColor&&this.arrayEqual(this.list,e.list)&&this.arrayEqual(this.color,e.color))}},{key:"isSameDropdown",value:function(e){return!!e&&(this===e||this.isEnableOptionColor===e.isEnableOptionColor&&this.arrayEqual(this.list,e.list)&&this.arrayEqual(this.color,e.color))}},{key:"getHash",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return void 0===this._hash&&(this._hash=[this.isValid,this.isEnableOptionColor,this.list,this.color].reduce((function(e,t){return Fa(t,e)}),e)),this._hash}},{key:"arrayEqual",value:function(e,t){var r=void 0===e?-1:e.length;if(r!==(void 0===t?-1:t.length))return!1;for(var n=0;n<r;n++)if(e[n]!==t[n])return!1;return!0}}],[{key:"fromJSON",value:function(t){return new e(t.list,t.isValid,t.isEnableOptionColor,t.color)}}]),e}();function Cg(e){return new Promise((function(t){var r=new Image;r.crossOrigin="use-credentials",r.onload=function(){var n=r.width,a=r.height;t([e,{width:n,height:a}])},r.onerror=function(){t([e,{width:0,height:0}])},r.src=e}))}function wg(e,t,r){return Eg(e,t,r)||kg(e,t,r)}function Eg(e,t,r){return Sg(e.getSegmentArray(t,r))}function kg(e,t,r){return Tg(e.getVar(t,r))}function Tg(e){var t,r,n;if(!(null!=e&&null!==(t=e.isFormula)&&void 0!==t&&t.call(e)||null!=e&&null!==(r=e.isProxyArrayFormula)&&void 0!==r&&r.call(e)))return!1;var a=null==e||null===(n=e.getVar)||void 0===n?void 0:n.call(e);return a&&vs(a)||!1}function Sg(e){var t;return Array.isArray(e)&&1===e.length&&(null===(t=e[0])||void 0===t?void 0:t.type)===Ce.K6s.EMBED_IMAGE}function Ag(e,t){var r;return(r="en"===t&&e.en_name||e.name)?"@"+r:e.text}function Ig(e,t){return e.type===Ce.K6s.TEXT?e.text=(0,Ce.ATv)(e.text):function(e){return Sg([e])}(e)&&(e.link=Ce.Ps3.replaceImageDataSrc(e.link)),Vg(e)?Ag(e,t):e.text||""}var Og=function(){function e(t,r){(0,y.Z)(this,e),this.spread=t,this.segmentArray=[],this.segmentArray=e.convertSegmentArrayFromChangeset(this.spread,r)}return(0,_.Z)(e,[{key:"getSegmentArray",value:function(){return this.segmentArray}},{key:"getText",value:function(e){return this.segmentArray.reduce((function(t,r){return Vg(r)?t+Ig(r,e):t+r.text}),"")}},{key:"getVar",value:function(e){var t="",r=0,n=!1,a=null;if(1===this.segmentArray.length&&this.segmentArray[0].type===Ce.K6s.EMBED_IMAGE)return new ds(new fs(this.segmentArray[0]));for(var o=0;o<this.segmentArray.length;++o){var i,u=this.segmentArray[o],s=Vg(u)?Ig(u,e):u.text;void 0!==s&&(t+=s,u.type===Ce.K6s.MENTION||u.type===Ce.K6s.URL?(r++,a=u.type===Ce.K6s.URL?null!==(i=u.link)&&void 0!==i?i:u.text:u.link):s.trim().length>0&&(n=!0))}var l=new it.StringVar(t);if(n||null==a||1!==r)return l;try{a=decodeURIComponent(a)}catch(e){}return l.setSpecialInfo({link:a}),l}},{key:"clone",value:function(){return new e(this.spread,(0,m.Z)(this.segmentArray))}}],[{key:"convertSegmentArrayFromChangeset",value:function(e,t){var r=this;return t.map((function(t){var n=Object.assign({},t);if(t.style&&!(t.style instanceof Om)){var a=Om.fromJSON(e.formatterService,t.style);a?n.style=a:delete n.style}if(t.texts){var o=r.convertSegmentArrayFromChangeset(e,t.texts);o.length?n.texts=o:delete n.texts}return n}))}},{key:"getSegmentArray4Changeset",value:function(e){var t=this;return Array.isArray(e)?e.map((function(e){var r=Object.assign({},e);if(e.style&&e.style.toJSON){var n=e.style.toJSON();n?r.style=n:delete r.style}if(e.texts){var a=t.getSegmentArray4Changeset(e.texts);a.length?r.texts=a:delete r.texts}return r})):e}}]),e}();function Vg(e){return e.type===Ce.K6s.MENTION&&0===e.mentionType}function Ng(e){return!!(Vg(e)&&e.name&&e.en_name)}function bg(e){return Array.isArray(e)&&e.some((function(e){return Ng(e)}))}function Mg(e){return e.type===Ce.K6s.MENTION&&void 0!==Ce.HA_[e.mentionType]}var Fg=function(){function e(t,r,n,a,o){(0,y.Z)(this,e),this.table=t,this.rowFrom=r,this.colFrom=n,this.rowTo=a,this.colTo=o,this.row=-1,this.col=-1,this.rowTo=Math.min(a,t.length-1),this.row=r,this.col=n-1}return(0,_.Z)(e,[{key:"next",value:function(){for(;this.isValid();){if(this.col++,(!this.table[this.row]||this.col>=this.table[this.row].length||this.col>this.colTo)&&!this.nextRow())return null;var e=this.table[this.row];if(null==e)return null;var t=e[this.col];if(null!=t)return t}return null}},{key:"isValid",value:function(){return this.row<=this.rowTo}},{key:"value",value:function(){var e=this.table[this.row]&&this.table[this.row][this.col];return null!=e?e:null}},{key:"nextRow",value:function(){do{this.row++}while(!this.table[this.row]&&this.rowTo>=this.row);return this.col=this.colFrom,this.rowTo>=this.row}}]),e}(),Zg=function(){function e(){(0,y.Z)(this,e),this.table=[]}return(0,_.Z)(e,[{key:"set",value:function(e,t,r){this.table[e]||(this.table[e]=[]),this.table[e][t]=r}},{key:"getRow",value:function(e){return this.table[e]||null}},{key:"get",value:function(e,t){var r=this.table[e];if(null==r)return null;var n=r[t];return void 0===n?null:n}},{key:"clear",value:function(e,t,r,n){for(var a=Math.min(r+e,Wg.rowSize),o=Math.min(n+t,Wg.colSize),i=e;i<a;i++)if(this.table[i]&&!(this.table[i].length<t))if(this.table[i].length<t+n)0===t?delete this.table[i]:this.table[i].length=t;else for(var u=t;u<o;u++)this.table[i][u]=null}},{key:"clearRow",value:function(e,t){for(var r=Math.min(t+e,Wg.rowSize);e<r;e++)this.table[e]=null}},{key:"swapRow",value:function(e,t,r){var n=this.table[e];this.table[e]=t.table[r],t.table[r]=n}},{key:"swapCol",value:function(e,t,r){this.table.map((function(n,a){n=n||[],t.table[a]=t.table[a]||[];var o=n[e];n[e]=t.table[a][r],t.table[a][r]=o}))}},{key:"swapCell",value:function(e,t,r,n,a){var o=this.get(e,t),i=r.get(n,a);this.set(e,t,i),r.set(n,a,o)}},{key:"reset",value:function(){this.table=[]}},{key:"setSize",value:function(e){this.table.length=e}},{key:"getSize",value:function(){return this.table.length}},{key:"iter",value:function(e,t,r,n){return new Fg(this.table,e,t,r,n)}},{key:"isEmpty",value:function(){return 0===this.table.length}}]),e}(),xg=Math.pow(2,32),Dg=64,Pg=63,$g=Math.pow(2,31)-1,Lg=Math.pow(2,32)-1;function Bg(e){return 0|(e>$g?e/Dg:e>>6)}function Ug(e){return e>Lg?e%Dg:e&Pg}function Hg(e){return 0|(e>$g?e/8:e>>3)}function zg(e){return e>Lg?e%8:7&e}var Wg=function(){function e(){(0,y.Z)(this,e),this.model=new Zg}return(0,_.Z)(e,[{key:"iterModel",value:function(e,t,r,n){return this.model.iter(e,t,r,n)}},{key:"set",value:function(e,t,r){if(!(e<0||t<0||void 0===e||void 0===t)){var n=0|(e>$g?e/Dg:e>>6),a=0|(t>$g?t/8:t>>3),o=this.model.get(n,a);o||(o=new Zg,this.model.set(n,a,o)),o.set(e>Lg?e%Dg:e&Pg,t>Lg?t%8:7&t,r)}}},{key:"get",value:function(e,t){if(e<0||t<0||void 0===e||void 0===t)return null;var r=0|(e>$g?e/Dg:e>>6),n=0|(t>$g?t/8:t>>3),a=this.model.get(r,n);return a?a.get(e>Lg?e%Dg:e&Pg,t>Lg?t%8:7&t):null}},{key:"getRow",value:function(e){return this.model.getRow(e)}},{key:"clear",value:function(e,t,r,n){var a=this.model.table;if(0!==a.length)for(var o=this.blockOffset(e,t),i=this.blockOffset(e+r-1,t+n-1),u=Math.min(a.length,i[0]+1),s=o[0];s<u;s++){var l=a[s];if(l)for(var c=Math.min(l.length,i[2]+1),h=o[2];h<c;h++){var f=l[h];if(f){var d=s===o[0]?o[1]:0,v=h===o[2]?o[3]:0,p=s===i[0]?i[1]-d+1:Dg-d,m=h===i[2]?i[3]-v+1:8-v;p===Dg&&8===m?f.reset():f.clear(d,v,p,m),f.isEmpty()&&delete l[h]}}}}},{key:"isEmpty",value:function(){return this.model.isEmpty()}},{key:"setSize",value:function(e){this.model.setSize(e)}},{key:"getSize",value:function(){return this.model.getSize()}},{key:"reset",value:function(){this.model.reset()}},{key:"addRow",value:function(e,t,r){if(0!==t){for(var n=this.rowBlockOffset(e),a=(0,g.Z)(n,2),o=a[0],i=a[1],u=this.model.table,s=u.length-1;s>=o;s--)if(u[s]){var l=u[s];for(var c in l){var h=parseInt(c,10);if(l[c]){var f=s>o?0:i,d=Dg-f;this.MoveBlockDataByRow(l[c],s*Dg,8*h,f,d,t)}}}u.length=Math.min(u.length,this.rowBlockOffset(r)[0]+1)}}},{key:"addCol",value:function(e,t){if(0!==t){var r=this.colBlockOffset(e),n=(0,g.Z)(r,2),a=n[0],o=n[1],i=this.model.table;for(var u in i)if(i[u]&&!(i[u].length<a))for(var s=parseInt(u,10),l=i[u],c=i[u].length-1;c>=a;c--)if(l[c]){var h=l[c],f=c>a?0:o,d=8-f;this.MoveBlockDataByCol(h,s*Dg,8*c,f,d,t)}}}},{key:"delRow",value:function(e,t,r,n){if(0!==t){!n&&this.clear(e,0,t,xg);for(var a=this.rowBlockOffset(e+t),o=(0,g.Z)(a,2),i=o[0],u=o[1],s=this.model.table,l=s.length,c=i;c<l;c++){var h=s[c];if(h)for(var f in h){var d=parseInt(f,10);if(h[d]){var v=c>i?0:u,p=Dg-v;this.MoveBlockDataByRow(h[d],c*Dg,8*d,v,p,-t)}}}var m=this.rowBlockOffset(r)[0]+1;m>=0&&(s.length=Math.min(s.length,m))}}},{key:"delCol",value:function(e,t,r){if(0!==t){!r&&this.clear(0,e,xg,t);var n=this.model.table;for(var a in n){var o=n[a];if(o)for(var i=parseInt(a,10),u=o.length,s=this.colBlockOffset(e+t),l=(0,g.Z)(s,2),c=l[0],h=l[1],f=c;f<u;f++)if(o[f]){var d=f>c?0:h,v=8-d;this.MoveBlockDataByCol(o[f],i*Dg,8*f,d,v,-t)}}}}},{key:"swapRow",value:function(e,t){var r=this.rowBlockOffset(e),n=(0,g.Z)(r,2),a=n[0],o=n[1],i=this.rowBlockOffset(t),u=(0,g.Z)(i,2),s=u[0],l=u[1],c=this.model.table[a]||[],h=this.model.table[s]||[];if(0!==c.length||0!==h.length)for(var f=Math.max(c.length,h.length),d=0;d<f;d++){var v=this.gainBlock({rowBlock:a,colBlock:d}),p=this.gainBlock({rowBlock:s,colBlock:d});v.swapRow(o,p,l)}}},{key:"swapCol",value:function(e,t){var r=this,n=this.colBlockOffset(e),a=(0,g.Z)(n,2),o=a[0],i=a[1],u=this.colBlockOffset(t),s=(0,g.Z)(u,2),l=s[0],c=s[1];this.model.table.map((function(e,t){var n=r.gainBlock({rowBlock:t,colBlock:o}),a=r.gainBlock({rowBlock:t,colBlock:l});n.swapCol(i,a,c)}))}},{key:"swapCell",value:function(e,t,r,n){var a=Bg(e),o=Hg(t),i=Bg(r),u=Hg(n),s=this.gainBlockPos(a,o),l=this.gainBlockPos(i,u),c=Ug(e),h=zg(t),f=Ug(r),d=zg(n);s.swapCell(c,h,l,f,d)}},{key:"iter",value:function(e,t,r,n){return new jg(this,e,t,e+r-1,t+n-1)}},{key:"orderedIter",value:function(e,t,r,n){return new Yg(this,e,t,e+r-1,t+n-1)}},{key:"orderedIterWithPos",value:function(e,t,r,n){var a=new Yg(this,e,t,e+r-1,t+n-1);return a.map((function(e){return[e,a.position()]}))}},{key:"iterWithPos",value:function(e,t,r,n){var a=new jg(this,e,t,e+r-1,t+n-1);return a.map((function(e){return[e,a.position()]}))}},{key:"getImporter",value:function(){return null}},{key:"getExporter",value:function(e,t,r,n){return null}},{key:"getSerializer",value:function(e,t,r,n){return null}},{key:"rowBlockOffset",value:function(e){return[0|(e>$g?e/Dg:e>>6),e>Lg?e%Dg:e&Pg]}},{key:"colBlockOffset",value:function(e){return[0|(e>$g?e/8:e>>3),e>Lg?e%8:7&e]}},{key:"blockOffset",value:function(e,t){var r=this.rowBlockOffset(e),n=this.colBlockOffset(t);return r.concat(n)}},{key:"MoveBlockDataByRow",value:function(e,t,r,n,a,o){var i=o<0?n:n+a-1,u=o<0?1:-1,s=this.blockOffset(t+i+o,r),l=this.gainBlock(this.convertBlockPositionToMap(s));if(a===Dg&&0===n&&0==(o>Lg?o%Dg:o&Pg))l.table=e.table,e.table=[];else for(var c=0;c<a;c++)(s[1]===Dg||s[1]<0)&&(s=this.blockOffset(t+i+o,r),l=this.gainBlock(this.convertBlockPositionToMap(s))),l.table[s[1]]=e.table[i],e.table[i]=[],i+=u,s[1]+=u}},{key:"convertBlockPositionToMap",value:function(e){return{rowBlock:e[0],rowOffset:e[1],colBlock:e[2],colOffset:e[3]}}},{key:"MoveBlockDataByCol",value:function(e,t,r,n,a,o){var i=o<0?n:n+a-1,u=o<0?1:-1,s=this.blockOffset(t,r+i+o),l=this.gainBlock(this.convertBlockPositionToMap(s));if(8===a&&0===n&&0==(o>Lg?o%8:7&o))l.table=e.table,e.table=[];else for(var c=0;c<a;c++){(8===s[3]||s[3]<0)&&(s=this.blockOffset(t,r+i+o),l=this.gainBlock(this.convertBlockPositionToMap(s)));for(var h=0;h<Dg;h++)(l.table[h]||e.table[h])&&(l.table[h]||(l.table[h]=[]),e.table[h]?(l.table[h][s[3]]=e.table[h][i],e.table[h][i]=null):l.table[h][s[3]]&&(l.table[h][s[3]]=null));i+=u,s[3]+=u}}},{key:"gainBlock",value:function(e){var t=this.model.table,r=t[e.rowBlock];t[e.rowBlock]||(r=t[e.rowBlock]=[]);var n=r[e.colBlock];return n||(n=r[e.colBlock]=new Zg),n}},{key:"gainBlockPos",value:function(e,t){var r=this.model.table,n=r[e];r[e]||(n=r[e]=[]);var a=n[t];return a||(a=n[t]=new Zg),a}}]),e}();Wg.rowSize=Dg,Wg.colSize=8;var Gg,jg=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this))).table=e,i.rowFrom=r,i.colFrom=n,i.rowTo=a,i.colTo=o,i.cellPosition={row:0,col:0},i.reset(),i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"reset",value:function(){return this.blockIter=this.table.iterModel(0|(this.rowFrom>$g?this.rowFrom/Dg:this.rowFrom>>6),0|(this.colFrom>$g?this.colFrom/8:this.colFrom>>3),0|(this.rowTo>$g?this.rowTo/Dg:this.rowTo>>6),0|(this.colTo>$g?this.colTo/8:this.colTo>>3)),this.dataIter=null,this.cellPosition.row=0,this.cellPosition.col=0,this}},{key:"next",value:function(){if(!this.isValid())return null;for(;!this.dataIter||null===this.dataIter.next();){var e=this.blockIter.next();if(!e)return null;var t=this.blockIter,r=t.row,n=t.col,a=r===(this.rowFrom>$g?this.rowFrom/Dg:this.rowFrom>>6),o=n===(this.colFrom>$g?this.colFrom/8:this.colFrom>>3),i=r===(this.rowTo>$g?this.rowTo/Dg:this.rowTo>>6),u=n===(this.colTo>$g?this.colTo/8:this.colTo>>3);this.dataIter=new Fg(e.table,a?this.rowFrom>Lg?this.rowFrom%Dg:this.rowFrom&Pg:0,o?this.colFrom>Lg?this.colFrom%8:7&this.colFrom:0,i?this.rowTo>Lg?this.rowTo%Dg:this.rowTo&Pg:63,u?this.colTo>Lg?this.colTo%8:7&this.colTo:7)}return this.dataIter.value()}},{key:"position",value:function(){var e=this.blockIter,t=this.dataIter?this.dataIter.row:0,r=this.dataIter?this.dataIter.col:0;return this.cellPosition.row=e.row*Dg+t,this.cellPosition.col=8*e.col+r,this.cellPosition}},{key:"isValid",value:function(){return this.blockIter.isValid()}},{key:"value",value:function(){var e;return(null===(e=this.dataIter)||void 0===e?void 0:e.value())||null}}]),t}(_t.FIterator),Yg=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this))).model=e,i.rowFrom=r,i.colFrom=n,i.rowTo=a,i.colTo=o,i.cellPosition={row:r,col:n-1},i.blockRowTo=0|(a>$g?a/Dg:a>>6),i.blockColTo=0|(o>$g?o/8:o>>3),i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"next",value:function(){if(!this.isValid())return this.val=null,null;for(var e=null;null===e;){if(!this.iter())return this.val=null,null;for(var t=0|(this.cellPosition.row>$g?this.cellPosition.row/Dg:this.cellPosition.row>>6),r=0|(this.cellPosition.col>$g?this.cellPosition.col/8:this.cellPosition.col>>3);!this.model.getRow(t)||!this.model.getRow(t)[r];)if(r<this.blockColTo)r++,this.cellPosition.col=8*r;else{if(!(this.cellPosition.row<this.rowTo))return this.val=null,null;this.cellPosition.row++,this.cellPosition.col=this.colFrom,t=0|(this.cellPosition.row>$g?this.cellPosition.row/Dg:this.cellPosition.row>>6),r=0|(this.cellPosition.col>$g?this.cellPosition.col/8:this.cellPosition.col>>3)}var n=this.model.getRow(t)[r],a=this.cellPosition.row>Lg?this.cellPosition.row%Dg:this.cellPosition.row&Pg,o=this.cellPosition.col>Lg?this.cellPosition.col%8:7&this.cellPosition.col;n.getRow(a)?e=n.get(a,o):this.cellPosition.col+=8-o-1}return this.val=e,e}},{key:"iter",value:function(){return this.cellPosition.col<this.colTo?(this.cellPosition.col++,!0):this.cellPosition.row<this.rowTo?(this.cellPosition.row++,this.cellPosition.col=this.colFrom,!0):(this.cellPosition.col++,this.cellPosition.row++,!1)}},{key:"isValid",value:function(){return this.cellPosition.row<=this.rowTo&&this.cellPosition.col<=this.colTo}},{key:"position",value:function(){return this.cellPosition}},{key:"value",value:function(){return this.val}}]),t}(_t.FIterator),qg=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];(0,y.Z)(this,e),this.models=t}return(0,_.Z)(e,[{key:"addModel",value:function(e){return this.models.push(e),this}},{key:"removeModels",value:function(e){for(var t=new Set,r=0,n=e.length;r<n;r++)t.add(e[r]);for(var a=this.models.length-1;a>=0;a--)t.has(this.models[a])&&this.models.splice(a,1);return this}},{key:"orderedIter",value:function(e,t,r,n){throw new Error("Method not implemented.")}},{key:"orderedIterWithPos",value:function(e,t,r,n){throw new Error("Method not implemented.")}},{key:"iter",value:function(){throw new Error("not implement")}},{key:"set",value:function(){throw new Error("not support!")}},{key:"get",value:function(){throw new Error("not support!")}},{key:"clear",value:function(e,t,r,n){throw new Error("Method not implemented.")}},{key:"isEmpty",value:function(){throw new Error("Method not implemented.")}},{key:"iterWithPos",value:function(e,t,r,n){throw new Error("Method not implemented.")}},{key:"addRow",value:function(e,t,r){for(var n=0;n<this.models.length;n++)this.models[n].addRow(e,t,r)}},{key:"delRow",value:function(e,t,r){for(var n=0;n<this.models.length;n++)this.models[n].delRow(e,t,r)}},{key:"addCol",value:function(e,t){for(var r=0;r<this.models.length;r++)this.models[r].addCol(e,t)}},{key:"delCol",value:function(e,t){for(var r=0;r<this.models.length;r++)this.models[r].delCol(e,t)}},{key:"swapRow",value:function(e,t){for(var r=0;r<this.models.length;r++)this.models[r].swapRow(e,t)}},{key:"swapCol",value:function(e,t){for(var r=0;r<this.models.length;r++)this.models[r].swapCol(e,t)}},{key:"swapCell",value:function(e,t,r,n){for(var a=0;a<this.models.length;a++)this.models[a].swapCell(e,t,r,n)}},{key:"getImporter",value:function(){var e,t=[],r=yr(this.models);try{for(r.s();!(e=r.n()).done;){var n=e.value.getImporter();n&&t.push(n)}}catch(e){r.e(e)}finally{r.f()}return new Xg(t)}},{key:"getExporter",value:function(e,t,r,n){var a,o=[],i=yr(this.models);try{for(i.s();!(a=i.n()).done;){var u=a.value.getExporter(e,t,r,n);u&&o.push(u)}}catch(e){i.e(e)}finally{i.f()}return new Kg(o)}},{key:"serialize",value:function(e,t,r,n,a){var o=this.models.map((function(a){var o;return null===(o=a.getSerializer)||void 0===o?void 0:o.call(a,e,t,r,n)})).filter((function(e){return null==e?void 0:e.validSerializer(a)}));return new Jg(o)}},{key:"serializeToMutations",value:function(e,t,r,n,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.models.map((function(a){var o;return null===(o=a.getSerializer)||void 0===o?void 0:o.call(a,e,t,r,n)})).forEach((function(e){return null==e?void 0:e.serializeToMutations(a,o)}))}}]),e}(),Jg=function(){function e(t){var r,n,a,o=this;(0,y.Z)(this,e),this.resultPos={row:0,col:0},this.serializers=t.filter((function(e){var t=e.iter;if(t.next(),null===t.value())return!1;var r=t.position();return(!a||o.cmp(a,r)>0)&&(a=r),!0})),this.targetPosition={row:(null===(r=a)||void 0===r?void 0:r.row)||0,col:(null===(n=a)||void 0===n?void 0:n.col)||0}}return(0,_.Z)(e,[{key:"cmp",value:function(e,t){return e.row===t.row&&e.col===t.col?0:e.row>t.row||e.row===t.row&&e.col>t.col?1:-1}},{key:"serializeCell",value:function(e,t){for(var r,n=this.serializers,a=this.targetPosition,o=0;o<n.length;++o){var i=n[o],u=i.iter;if(0===this.cmp(a,u.position())){var s=u.value();i.serializeCell(e,s,t),u.next()}var l=u.position();(!r||this.cmp(r,l)>0)&&(r=l),null!==u.value()||(n.splice(o,1),o--)}return r?(this.resultPos.row=this.targetPosition.row,this.resultPos.col=this.targetPosition.col,this.targetPosition.row=r.row,this.targetPosition.col=r.col,this.resultPos):null}}]),e}(),Kg=function(){function e(t){(0,y.Z)(this,e),this.exporters=t}return(0,_.Z)(e,[{key:"exportExtraInfo",value:function(e){var t,r=yr(this.exporters);try{for(r.s();!(t=r.n()).done;){t.value.exportExtraInfo(e)}}catch(e){r.e(e)}finally{r.f()}}},{key:"exportCells",value:function(e,t){for(var r=0;r<this.exporters.length;r++)this.exporters[r].exportCells(e,t)}},{key:"setExportType",value:function(e){var t,r=yr(this.exporters);try{for(r.s();!(t=r.n()).done;){t.value.setExportType(e)}}catch(e){r.e(e)}finally{r.f()}}}]),e}(),Xg=function(){function e(t){(0,y.Z)(this,e),this.importers=t}return(0,_.Z)(e,[{key:"importExtraInfo",value:function(e,t){for(var r=0,n=this.importers.length;r<n;r++)this.importers[r].importExtraInfo(e,t)}},{key:"importCell",value:function(e,t,r,n){for(var a=0,o=this.importers.length;a<o;a++)this.importers[a].importCell(e,t,r,n)}}]),e}();!function(e){e.CheckCell="CheckCell",e.CheckInput="CheckInput"}(Gg||(Gg={}));var Qg="dataValidation";var ey=new it.FormulaCache(it.NULL_VAR,it.NULL_VAR),ty=function(){function e(t,r,n,a,o){(0,y.Z)(this,e),this.sheet=o,this.dvFormula=null,this._hasFormulaForCheckCellValidInit=!1,this.fromJSON(t,r,n,a)}return(0,_.Z)(e,null,[{key:"isValidJSON",value:function(e){var t=e.options;if((0,de.Z)(t)){var r=t.handledWayOnInvalidData,n=t.helpText;if(Cr(t,"handledWayOnInvalidData")&&("number"!=typeof r||3===r))return!1;if(Cr(t,"helpText")&&("string"!=typeof n||""===n))return!1}return!0}}]),(0,_.Z)(e,[{key:"destroy",value:function(){this._setFormula(null),this._hasFormulaForCheckCellValidInit=!1}},{key:"toJSON",value:function(e){var t=this,r=this.toJSONImplement(e);if(e.returnDependentSheets){var n=new Set,a=this.dvFormula?this.dvFormula.getRefMap():null;a&&Object.values(a).forEach((function(e){var r=e.sheet();r&&r.id()!==t.sheet.id()&&n.add(r.id())})),0!==n.size&&(r.dependentSheets=Array.from(n))}return r}},{key:"checkOptionsValid",value:function(){return this.isOptionError=!1,!0}},{key:"checkCellValid",value:function(e,t){this.checkOptionsValid();var r=null;if(this.dvFormula){var n=new uu(e,t,this.sheet),a=av(this.sheet.parent,this.sheet.getCalcEngine().formulaService),o=this.dvFormula;a.customRef=n,a.disableCalcRef=!0,o.resetState();var i=this.sheet.getImmutableContent(e,t);if(!i||function(e){var t=e.multipleValues,r=e.segmentArray,n=e.variant;return!(t||r||n&&n!==it.NULL_VAR)}(i))r=this._getResultWhileCellIsEmpty();else{ov(o,a);var u=o.getState().cache.getRawVar();r=this._getResultWhileCalcCorrectly(u,"CheckCell",i)}}else r=this._getResultWhileFmlErr();return r}},{key:"checkInputValid",value:function(e){var t=e.row,r=e.col,n=e.editingText;if(!n)return!0;var a=this._getFormulaArgsForCheckInput(n),o=a.validateObj,i=a.formatCode;if("string"!=typeof o&&"number"!=typeof o)return!1;var u=this._initFormulaForCheckInput(o,i,t,r);if(!u)return!0;var s=av(this.sheet.parent,this.sheet.getCalcEngine().formulaService);s.disableCalcRef=!0,ov(u,s);var l=u.getState().cache.getRawVar();return this._getResultWhileCalcCorrectly(l,"CheckInput").getValue()}},{key:"_setFormula",value:function(e,t){this.dvFormula=e,this._afterFormulaForCheckCellChanged&&this._afterFormulaForCheckCellChanged(t)}},{key:"initFormulaForCheckCell",value:function(e){if(!this._hasFormulaForCheckCellValidInit){var t={ref:new uu(-1,-1,this.sheet),spread:this.sheet.parent,enableCalculation:!0},r=this._getFormulaStr("PRIVATE_GET_REF()"),n=this.sheet.getCalcEngine().compile(r,t),a=null==e?void 0:e.preventRegisterFml;if(n.formulaVar&&n.formulaVar.isFormula()){var o=n.formulaVar;a||(o.getState().cache=ey),this._setFormula(o,a)}else console.error("COMPILE_FORMULA_VAR_ERROR",(0,Ce.XP5)(r)),Ce.Ps3.moirae.ravenCatch("COMPILE_FORMULA_VAR_ERROR",{tags:{key:"COMPILE_FORMULA_VAR_ERROR"}});this._hasFormulaForCheckCellValidInit=!0}}},{key:"_initFormulaForCheckInput",value:function(e,t,r,n){var a=null,o={ref:new uu(r,n,this.sheet),enableCalculation:!0,spread:this.sheet.parent},i=this._getFormulaStr(e,t),u=this.sheet.getCalcEngine().compile(i,o);return u.formulaVar&&u.formulaVar.isFormula()?a=u.formulaVar:(console.error("COMPILE_FORMULA_VAR_ERROR",(0,Ce.XP5)(i)),Ce.Ps3.moirae.ravenCatch("COMPILE_FORMULA_VAR_ERROR",{tags:{key:"COMPILE_FORMULA_VAR_ERROR"}})),a}},{key:"onOp",value:function(e){}}]),e}();function ry(e,t){var r=new it.BooleanVar(e);return t&&r.setSpecialInfo({listValidateInfo:new hg([t])}),r}ty=Vu([function(e){return e}],ty);var ny,ay=function(e){function t(e,r,n,a){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,void 0,r,n,a))}return(0,p.Z)(t,e),(0,_.Z)(t,null,[{key:"isValidJSON",value:function(e){if(!ty.isValidJSON(e))return!1;if(Cr(e,"operator"))return!1;var t=e.formulas,r=e.options;if(!Array.isArray(t))return!1;var n,a=yr(t);try{for(a.s();!(n=a.n()).done;){if("string"!=typeof n.value)return!1}}catch(e){a.e(e)}finally{a.f()}if(!(0,de.Z)(r))return!1;var o=r.supportMultipleValues,i=r.ignoreCase,u=r.shouldHighlightValidData,s=r.isDropdownIconHiddenInCell;return"boolean"==typeof o&&"boolean"==typeof i&&"boolean"==typeof u&&(!Cr(r,"isDropdownIconHiddenInCell")||!0===s)}}]),(0,_.Z)(t,[{key:"_getFormulaStr",value:function(e){return"PRIVATE_LIST_VALIDATION(".concat(e,", ").concat(this._getListArgs(),", ").concat(this._getSupportMultipleValuesArgs(),", ").concat(this._getIgnoreCaseArgs(),")")}},{key:"_getResultWhileFmlErr",value:function(){return ry(!1)}},{key:"_getResultWhileCellIsEmpty",value:function(){return ry(!0)}},{key:"_getResultWhileFmlServiceSuspended",value:function(){return ry(!0)}},{key:"_getSupportMultipleValuesArgs",value:function(){return!0===this.options.supportMultipleValues?"TRUE":"FALSE"}},{key:"_getIgnoreCaseArgs",value:function(){return!0===this.options.ignoreCase?"TRUE":"FALSE"}},{key:"_getFormulaArgsForCheckInput",value:function(e){var t="";return t=(this.options||{}).supportMultipleValues&&"string"==typeof e?e.split(",").map((function(e){return(0,Ce.dNX)(e)})).join('","'):(0,Ce.dNX)(e),{validateObj:'{"'.concat(t,'"}')}}}]),t}(ty);function oy(e,t){if(null!==e&&"object"==(0,R.Z)(e)&&!Object.isFrozen(e)){Object.freeze(e);var r,n=yr(Object.getOwnPropertyNames(e));try{for(n.s();!(r=n.n()).done;){var a=r.value;t&&t.has(a)||oy(e[a],t)}}catch(e){n.e(e)}finally{n.f()}}}ay=Vu([function(e){return e}],ay);var iy=ny=function(e){function t(e,r,n){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,"list",e,r,n))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"formulas",get:function(){return this._initialFormulas}}],[{key:"isValidJSON",value:function(e){if(!ay.isValidJSON(e))return!1;var t=e.options;if(t.shouldHighlightValidData){var r=t.listItemColorMap;if(!(0,de.Z)(r))return!1}return!0}}]),(0,_.Z)(t,[{key:"fromJSON",value:function(e,t,r,n){this.type=e,this.operator=t,this._initialFormulas=r,this.options=n}},{key:"toJSONImplement",value:function(e){var t=e.needDeepClone,r=t?ga(this.formulas):this.formulas,n=t?ga(this.options):this.options;return{type:this.type,formulas:r,options:n}}},{key:"clone",value:function(){return new ny(ga(this.formulas),ga(this.options),this.sheet)}},{key:"freezeRef",value:function(){var e={writable:!1,configurable:!1};oy(this.type),oy(this.operator),oy(this._initialFormulas),oy(this.options),Object.defineProperties(this,{type:e,operator:e,_initialFormulas:e,options:e})}},{key:"getHash",value:function(){return Fa(this.toJSON({needDeepClone:!1}))}},{key:"_getListArgs",value:function(){return'{"'.concat(this.formulas.map((function(e){return(0,Ce.dNX)(e)})).join('","'),'"}')}},{key:"_getResultWhileCalcCorrectly",value:function(e){var t,r=this;if(!e.isBool())return ry(!1);var n=null===(t=e.getSpecialInfo())||void 0===t?void 0:t.listValidationFuncInfo;if(n){var a=n.map((function(e){var t=e.segmentArray,n=e.variant,a=e.text,o={segmentArray:t,variant:n,text:a};if(r.options.shouldHighlightValidData){var i=r.options.listItemColorMap,u=a.toUpperCase();if("FALSE"===u||"TRUE"===u){for(var s in i)if(s.toUpperCase()===u){o.color=i[s];break}}else{var l=i[a];l&&(o.color=l)}}return o}));return ry(e.getValue(),a)}return ry(e.getValue())}},{key:"getDropdownListData",value:function(){var e=this.options&&this.options.shouldHighlightValidData,t={list:(0,ge.Z)(this.formulas).filter(Boolean),colorMap:{},isEnableOptionColor:e,isSupportMultipleValue:this.options&&this.options.supportMultipleValues};return this.options.shouldHighlightValidData&&(t.colorMap=this.options.listItemColorMap),t}},{key:"getListItem",value:function(){return this.formulas}}]),t}(ay);iy=ny=Vu([function(e){return e}],iy);var uy,sy,ly=function(){function e(t,r){(0,y.Z)(this,e),this._colors=t,this._refRange=r}return(0,_.Z)(e,[{key:"onOp",value:function(e){e instanceof vu?this._onRowColOp(e):"DelRowOp"===e.instanceType&&this._handleDelRows(e)}},{key:"_onRowColOp",value:function(e){switch(e.segOpType()){case"add":e.isRowType()?this._handleColorsWhileAddRows(e):this._handleColorsWhileAddCols(e);break;case"delete":e.isRowType()?this._handleColorsWhileDelRows(e):this._handleColorsWhileDelCols(e)}}},{key:"_handleColorsWhileAddRows",value:function(e){var t=e.from()-this._refRange.rowFrom();if(this._refRange instanceof nu?0<=t&&t<=this._refRange.rowCount(!0):0<t&&t<this._refRange.rowCount(!0)){for(var r,n=[],a=e.size(),o=this._refRange.colCount(!0),i=t;i<t+a;++i){for(var u=[],s=0;s<o;++s)u.push((0,Ce.N$c)(i*o+s));n.push(u)}(r=this._colors).splice.apply(r,[t,0].concat(n))}}},{key:"_handleColorsWhileAddCols",value:function(e){var t=e.from()-this._refRange.colFrom();if(this._refRange instanceof iu?0<=t&&t<=this._refRange.colCount(!0):0<t&&t<this._refRange.colCount(!0))for(var r=e.size(),n=this._refRange.colCount(!0)+r,a=0;a<this._colors.length;++a){for(var o,i=[],u=t;u<t+r;++u)i.push((0,Ce.N$c)(a*n+u));(o=this._colors[a]).splice.apply(o,[t,0].concat(i))}}},{key:"_handleDelRows",value:function(e){for(var t=e.ranges,r=this._refRange.rowFrom(),n=t.length-1;n>=0;n--){var a=t[n].target-r,o=t[n].count;if(a<0&&(o+=a,a=0),!(a>=this._colors.length)){if(!(o>0))break;this._colors.splice(a,o)}}}},{key:"_handleColorsWhileDelRows",value:function(e){var t=e.from()-this._refRange.rowFrom(),r=e.size();t<0&&(r+=t,t=0),this._colors.splice(t,r)}},{key:"_handleColorsWhileDelCols",value:function(e){var t=e.from()-this._refRange.colFrom(),r=e.size();t<0&&(r+=t,t=0);for(var n=0;n<this._colors.length;++n)this._colors[n].splice(t,r)}}]),e}(),cy=2e3,hy=uy=function(e){function t(e,r,n){var a;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,"listFromRange",e,r,n)))._refRangeInFormula=null,a.dispose=null,a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"formulas",get:function(){return this._refRangeInFormula?[this._refRangeInFormula.toString({refStyle:"A1",ref:new uu(-1,-1,this.sheet)})]:this._initialFormulas}}],[{key:"isValidJSON",value:function(e){if(!ay.isValidJSON(e))return!1;var t=e.formulas,r=e.options;if(1!==t.length)return!1;if(r.shouldHighlightValidData){var n=r.colors;if(!Array.isArray(n))return!1}else if(Cr(r,"colors"))return!1;return!0}}]),(0,_.Z)(t,[{key:"fromJSON",value:function(e,t,r,n){var a=new uu(-1,-1,this.sheet),o=this.sheet.parent,i=ad(r[0],{spread:o,refStyle:"A1",ref:a});if(i)if(i.isRef()){i.setRefStatus(15);var u=i;r[0]=u.toString({refStyle:"A1",ref:a})}else r[0]=i.getValue();else r[0]=it.ErrorConstant.REF;if(n.shouldHighlightValidData)if(i&&!i.isError()){var s=i;this._fixColorsByRefRange(n.colors,s)}else n.colors.splice(0,n.colors.length);this.type=e,this.operator=t,this._initialFormulas=r,this.options=n}},{key:"freezeRef",value:function(){var e={writable:!1,configurable:!1};oy(this.type),oy(this.operator),oy(this.options,new Set(["colors"])),Object.defineProperties(this,{type:e,operator:e,_initialFormulas:e,options:e})}},{key:"getHash",value:function(){var e;return this.options.shouldHighlightValidData?delete(e=Object.assign({},this.options)).colors:e=this.options,Fa({type:this.type,options:e})}},{key:"toJSONImplement",value:function(e){var t,r=e.needDeepClone,n=e.refSheet;t=n&&this._refRangeInFormula?[this._refRangeInFormula.toString({refStyle:"A1",ref:new uu(-1,-1,n)})]:r?ga(this.formulas):this.formulas;var a=r?ga(this.options):this.options;return{type:this.type,formulas:t,options:a}}},{key:"clone",value:function(){return new uy(ga(this.formulas),ga(this.options),this.sheet)}},{key:"_getListArgs",value:function(){return this.formulas[0]}},{key:"checkOptionsValid",value:function(){var e;return this.options.shouldHighlightValidData?(this.isOptionError=!this._refRangeInFormula||(null===(e=this._refRangeInFormula)||void 0===e?void 0:e.size())>cy,!this.isOptionError):(this.isOptionError=!1,!0)}},{key:"_getResultWhileCalcCorrectly",value:function(e){var t,r=this;if(!e.isBool())return ry(!1);var n=null===(t=e.getSpecialInfo())||void 0===t?void 0:t.listValidationFuncInfo;if(n){var a=n.map((function(e){var t=e.segmentArray,n=e.variant,a=e.text,o=e.index,i={segmentArray:t,variant:n,text:a};if(r.options.shouldHighlightValidData&&o>=0){var u=r.options.colors;if(u.length>0){var s=u[0].length,l=u[Math.floor(o/s)];if(l){var c=l[o%s];c&&(i.color=c)}}}return i}));return ry(e.getValue(),a)}return ry(e.getValue())}},{key:"getListItem",value:function(e){var t=null;if(this._refRangeInFormula)t=this._refRangeInFormula;else{var r=new uu(-1,-1,this.sheet),n=this.sheet.parent,a=ad(this.formulas[0],{spread:n,refStyle:"A1",ref:r});a&&a.isRef()&&(t=a)}if(!t)return[];var o=t.sheet();if(!o)return[];for(var i=[],u=t.rowFrom(),s=t.colFrom(),l=t.rowTo(),c=t.colTo(),h=Boolean(e&&e.preventUseTextCache),f=u;f<=l;++f)for(var d=s;d<=c;++d)i.push(o.getText(f,d,void 0,h,void 0));return i}},{key:"_fixColorsByRefRange",value:function(e,t){for(var r=t.colCount(!0),n=0;n<e.length;++n){var a=e[n].length,o=r-a;if(o>0)for(var i=a;i<r;++i)e[n].push((0,Ce.N$c)(n*r+i));else if(o<0)for(var u=0;u<-o;++u)e[n].pop()}var s=t.rowCount(!0),l=s-e.length;if(l>0)for(var c=e.length;c<s;++c){for(var h=[],f=0;f<r;++f)h.push((0,Ce.N$c)(c*r+f));e.push(h)}else if(l<0)for(var d=0;d<-l;++d)e.pop()}},{key:"_getRefRangeInFormula",value:function(e){if(!e)return null;var t=e.formula.expression;if(5!==(null==t?void 0:t.length))return null;var r=t[1];if(Sd(r)){var n=r.getSheetRef(e.getRefMap());return n.isError()?null:n}return Td(r)?r.getRef():null}},{key:"_afterFormulaForCheckCellChanged",value:function(e){var t=this;if(this.dispose&&(this.dispose(),this.dispose=null),this._refRangeInFormula&&delete this._refRangeInFormula.afterSheetChanged,this.dvFormula){var r=this.dvFormula.getRefMap();if(!r)return;var n={};Object.keys(r).forEach((function(e){n[e]=r[e].clone()})),this.dvFormula.setRefMap(n);var a=this._getRefRangeInFormula(this.dvFormula);this.options.shouldHighlightValidData&&a&&(a instanceof iu||a instanceof nu)&&(a.afterSheetChanged=function(){t.options.shouldHighlightValidData&&t._fixColorsByRefRange(t.options.colors,a)}),this._refRangeInFormula=a}else this._initialFormulas[0]=this.formulas[0],this._refRangeInFormula=null;this._refRangeInFormula&&!e&&(this.dispose=this.sheet.getCalcEngine().depRefManager.watchRef(this._refRangeInFormula,(function(){t.sheet.dispatch("DataValidationFormulaMarkDirty",t)}),(function(e,r){return t.beforeFormulaRefArgChanged(e,r),!0}),(function(e,r){t.afterFormulaRefArgChanged(e,r)})))}},{key:"beforeFormulaRefArgChanged",value:function(e,t){if(this.options.shouldHighlightValidData){var r=this._refRangeInFormula;if(r===e){var n=r;r instanceof iu&&t instanceof vu&&"add"===t.segOpType()&&!t.isRowType()&&(n=Object.create(r,{colCount:{value:function(){return r.colCount()-t.size()}}})),r instanceof nu&&t instanceof vu&&"add"===t.segOpType()&&t.isRowType()&&(n=Object.create(r,{rowCount:{value:function(){return r.rowCount()-t.size()}}})),new ly(this.options.colors,n).onOp(t)}}}},{key:"afterFormulaRefArgChanged",value:function(e,t){if(this.options.shouldHighlightValidData){var r=this._refRangeInFormula;r===e&&"DelSheetOp"!==t.type()&&this._fixColorsByRefRange(this.options.colors,r)}}},{key:"onOp",value:function(e){if(this._refRangeInFormula){var t=this._refRangeInFormula;e.effectedRef().every((function(e){return!e.isIntersect(t)}))||(this.beforeFormulaRefArgChanged(t,e),t.onOp(e),this.afterFormulaRefArgChanged(t,e))}}},{key:"assignListOptionsWithColor",value:function(){var e=this.formulas[0]||"",t=this.sheet;if(!e||!this.options.shouldHighlightValidData||!t)return[];var r=this.options.colors,n=(0,fe.Z)(r),a=null,o=(a=this._refRangeInFormula?this._refRangeInFormula:t.rangeStringToRange(e))&&a.sheet();if(!a||!o)return[];for(var i=[],u=0,s=a.rowFrom(),l=a.colFrom(),c=a.rowTo(),h=a.colTo(),f=s;f<=c;++f)for(var d=l;d<=h;++d){var v=o.getText(f,d);i.push({id:u,value:v,color:n[u++]||""})}return i}},{key:"getDropdownListData",value:function(){var e={},t=(0,ge.Z)(this.getListItem()).filter(Boolean);return this.options.shouldHighlightValidData&&(e=this.assignListOptionsWithColor().reduce((function(e,t){return e[t.value]||(e[t.value]=t.color),e}),{})),{list:t,colorMap:e,isEnableOptionColor:this.options.shouldHighlightValidData,isSupportMultipleValue:this.options.supportMultipleValues}}}]),t}(ay);function fy(e,t){var r=new it.BooleanVar(e);return r.setSpecialInfo({checkboxInfo:t}),r}hy=uy=Vu([function(e){return e}],hy);var dy,vy=sy=function(e){function t(e,r,n){var a;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,"checkbox",void 0,e,r,n))).shouldDelWhileClearValue=!0,a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"formulas",get:function(){return this._initialFormulas}}],[{key:"isValidJSON",value:function(e){if(!ty.isValidJSON(e))return!1;if(Cr(e,"operator"))return!1;var t=e.formulas,r=e.options;if(!Array.isArray(t)||2!==t.length)return!1;var n,a=yr(t);try{for(a.s();!(n=a.n()).done;){if("number"!=typeof n.value)return!1}}catch(e){a.e(e)}finally{a.f()}return!(0,de.Z)(r)||0!==Object.keys(r).length}}]),(0,_.Z)(t,[{key:"fromJSON",value:function(e,t,r,n){this.type=e,this.operator=t,this._initialFormulas=r,this.options=n}},{key:"toJSONImplement",value:function(e){var t=e.needDeepClone,r={type:this.type,formulas:t?ga(this.formulas):this.formulas};return this.options&&(r.options=t?ga(this.options):this.options),r}},{key:"clone",value:function(){return new sy(ga(this.formulas),ga(this.options),this.sheet)}},{key:"freezeRef",value:function(){var e={writable:!1,configurable:!1};oy(this.type),oy(this.operator),oy(this._initialFormulas),oy(this.options),Object.defineProperties(this,{type:e,operator:e,_initialFormulas:e,options:e})}},{key:"getHash",value:function(){return Fa(this.toJSON({needDeepClone:!1}))}},{key:"_getFormulaStr",value:function(e){var t=(0,g.Z)(this.formulas,2),r=t[0],n=t[1];return"PRIVATE_CHECKBOX(".concat(e,",").concat(r,",").concat(n,")")}},{key:"_getResultWhileFmlErr",value:function(){return fy(!1,{visible:!1})}},{key:"_getResultWhileCellIsEmpty",value:function(){return fy(!0,{visible:!0,checked:!1})}},{key:"_getResultWhileFmlServiceSuspended",value:function(){return fy(!0,{visible:!1})}},{key:"_getResultWhileCalcCorrectly",value:function(e,t,r){return"CheckCell"===t&&r&&function(e){var t=e.multipleValues,r=e.segmentArray;return!(t||!r||1!==r.length||r[0].type!==Ce.K6s.EMBED_IMAGE)}(r)?fy(!1,{visible:!1}):e}},{key:"_getFormulaArgsForCheckInput",value:function(e){var t=(0,he.Z)(e);return{validateObj:isNaN(t)?'"'.concat((0,Ce.dNX)(e),'"'):t}}}]),t}(ty);function py(e,t,r){var n,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o="TRUE()";if(!r)return o;e=a?"LEN(".concat(e,")"):e;var i=r.map((function(e){return e.value})),u="NOT(AND(NOT(ISNUMBER(".concat(e,")), ISNUMBER(").concat(i[0],")))");return null!==(n={equalTo:"AND(".concat(e," = ").concat(i[0],", NOT(ISBLANK(").concat(e,")))"),notEqualTo:"AND(OR(NOT(".concat(e," = ").concat(i[0],"), ISBLANK(").concat(e,")), ").concat(u,")"),lessThan:"AND(".concat(e," < ").concat(i[0],", ").concat(u,")"),lessThanOrEqualTo:"AND(".concat(e," <= ").concat(i[0],", ").concat(u,")"),greaterThan:"AND(".concat(e," > ").concat(i[0],", ").concat(u,")"),greaterThanOrEqualTo:"AND(".concat(e," >= ").concat(i[0],", ").concat(u,")"),between:"AND(OR(\n      AND(".concat(e," >= ").concat(i[0],", ").concat(e," <= ").concat(i[1],"),\n      AND(").concat(e," >= ").concat(i[1],", ").concat(e," <= ").concat(i[0],")\n    ),\n      NOT(ISBLANK(").concat(e,"))\n    )"),notBetween:"NOT(OR(\n      AND(".concat(e," >= ").concat(i[0],", ").concat(e," <= ").concat(i[1],"),\n      AND(").concat(e," >= ").concat(i[1],", ").concat(e," <= ").concat(i[0],")\n    ))")}[t])&&void 0!==n?n:o}function my(e,t){var r=["between","notBetween"].includes(e);return[!r&&1===t.length,r&&2===t.length].some(Boolean)}vy=sy=Vu([function(e){return e}],vy);var gy,yy=dy=function(e){function t(e,r,n,a){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,"number",e,r,n,a))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"formulas",get:function(){return this._initialFormulas}}]),(0,_.Z)(t,[{key:"fromJSON",value:function(e,t,r,n){this.type=e,this.operator=t,this._initialFormulas=r,this.options=n}},{key:"toJSONImplement",value:function(e){var t=e.needDeepClone,r={type:this.type,options:t?ga(this.options):this.options,operator:t?ga(this.operator):this.operator};return"isAValidNumber"!==this.operator&&(r.formulas=t?ga(this.formulas):this.formulas),r}},{key:"clone",value:function(){return new dy(ga(this.operator),ga(this.formulas),ga(this.options),this.sheet)}},{key:"freezeRef",value:function(){var e={writable:!1,configurable:!1};oy(this.type),oy(this.operator),oy(this._initialFormulas),oy(this.options),Object.defineProperties(this,{type:e,operator:e,_initialFormulas:e,options:e})}},{key:"getHash",value:function(){return Fa(this.toJSON({needDeepClone:!1}))}},{key:"_getResultWhileFmlErr",value:function(){return new it.BooleanVar(!1)}},{key:"_getResultWhileCellIsEmpty",value:function(){return new it.BooleanVar(!0)}},{key:"_getResultWhileFmlServiceSuspended",value:function(){return new it.BooleanVar(!0)}},{key:"_getResultWhileCalcCorrectly",value:function(e){return e.isBool()?e:new it.BooleanVar(!1)}},{key:"_getFormulaStr",value:function(e,t){var r;t=null!==(r=t)&&void 0!==r?r:"";var n="PRIVATE_IS_INT(".concat(e,")");if("isAValidNumber"===this.operator){var a="AND(\n        ISNUMBER(".concat(e,'),\n        OR(\n          PRIVATE_FORMATTER_VALIDATION("null", "').concat(t,'"),\n          PRIVATE_FORMATTER_VALIDATION("general", "').concat(t,'"),\n          PRIVATE_FORMATTER_VALIDATION("digital", "').concat(t,'")\n        )\n      )');return a=this.isOnlyReceiveInteger?"AND(".concat(n,", ").concat(a,")"):a,"OR(ISBLANK(".concat(e,"), ").concat(a,")")}var o=py(e,this.operator,this.formulas);return o=this.isOnlyReceiveInteger?"AND(".concat(n,", ").concat(o,")"):o,"OR(ISBLANK(".concat(e,"), ").concat(o,")")}},{key:"_getFormulaArgsForCheckInput",value:function(e){var t=ca(this.sheet.formatterService,null,e);if(!t)return{validateObj:e};var r=t.value,n=t.autoFormatter;return{validateObj:(0,ve.default)(r)?r:'"'.concat((0,Ce.dNX)(r),'"'),formatCode:n&&n.getFormatCode()}}},{key:"isOnlyReceiveInteger",get:function(){return 1===this.options.validNumType}}],[{key:"isValidJSON",value:function(e){var t=e.type,r=e.formulas,n=e.operator,a=e.options,o=Cr(e,"formulas");return!([[t,n,a].every(Boolean),[(0,ce.Z)(n),(0,de.Z)(a)].every(Boolean),!o||Array.isArray(r)&&r.every((function(e){return(0,ve.default)(e.value)}))].some((0,le.Z)(Boolean))||"isAValidNumber"===n&&o||"isAValidNumber"!==n&&!Array.isArray(r)||"isAValidNumber"!==n&&!my(n,r))}}]),t}(ty);yy=dy=Vu([function(e){return e}],yy);var _y,Ry=gy=function(e){function t(e,r,n,a){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,"date",e,r,n,a))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"formulas",get:function(){return this._initialFormulas}}]),(0,_.Z)(t,[{key:"fromJSON",value:function(e,t,r,n){this.type=e,this.operator=t,this._initialFormulas=r,this.options=n}},{key:"getFormattedValue",value:function(e){if(e){var t=e.value,r=e.autoFormatter;return(0,Ee.createFormatter)(this.sheet.formatterService,null==r?void 0:r.formatCached).format(t)}}},{key:"toJSONImplement",value:function(e){var t=e.needDeepClone,r={type:this.type,options:t?ga(this.options):this.options,operator:t?ga(this.operator):this.operator};return"isAValidDate"!==this.operator&&(r.formulas=t?ga(this.formulas):this.formulas),r}},{key:"clone",value:function(){return new gy(ga(this.operator),ga(this.formulas),ga(this.options),this.sheet)}},{key:"freezeRef",value:function(){var e={writable:!1,configurable:!1};oy(this.type),oy(this.operator),oy(this._initialFormulas),oy(this.options),Object.defineProperties(this,{type:e,operator:e,_initialFormulas:e,options:e})}},{key:"getHash",value:function(){return Fa(this.toJSON({needDeepClone:!1}))}},{key:"_getResultWhileFmlErr",value:function(){return new it.BooleanVar(!1)}},{key:"_getResultWhileCellIsEmpty",value:function(){return new it.BooleanVar(!0)}},{key:"_getResultWhileFmlServiceSuspended",value:function(){return new it.BooleanVar(!0)}},{key:"_getResultWhileCalcCorrectly",value:function(e){return e.isBool()?e:new it.BooleanVar(!1)}},{key:"_getFormulaStr",value:function(e,t){var r;return t=null!==(r=t)&&void 0!==r?r:"","OR(ISBLANK(".concat(e,"), ").concat("isAValidDate"===this.operator?"AND(\n          ISNUMBER(".concat(e,'),\n          PRIVATE_FORMATTER_VALIDATION("dateTime", "').concat(t,'")\n        )'):py(e,this.operator,this.formulas),")")}},{key:"_getFormulaArgsForCheckInput",value:function(e){var t=ca(this.sheet.formatterService,null,e);if(!t)return{validateObj:e};var r=t.value,n=t.autoFormatter;return{validateObj:(0,ve.default)(r)?r:'"'.concat((0,Ce.dNX)(r),'"'),formatCode:n&&n.getFormatCode()}}}],[{key:"isValidJSON",value:function(e){var t=e.type,r=e.formulas,n=e.operator,a=e.options,o=Cr(e,"formulas");return!([[t,n,a].every(Boolean),[(0,ce.Z)(n),(0,de.Z)(a)].every(Boolean),!o||Array.isArray(r)&&r.every((function(e){return(0,ve.default)(e.value)}))].some((0,le.Z)(Boolean))||"isAValidDate"===n&&o||"isAValidDate"!==n&&!Array.isArray(r)||"isAValidDate"!==n&&!my(n,r))}}]),t}(ty);Ry=gy=Vu([function(e){return e}],Ry);var Cy,wy=_y=function(e){function t(e,r,n,a){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,"textLength",e,r,n,a))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"formulas",get:function(){return this._initialFormulas}}]),(0,_.Z)(t,[{key:"fromJSON",value:function(e,t,r,n){this.type=e,this.operator=t,this._initialFormulas=r,this.options=n}},{key:"toJSONImplement",value:function(e){var t=e.needDeepClone,r={type:this.type,formulas:t?ga(this.formulas):this.formulas,operator:t?ga(this.operator):this.operator};return this.options&&(r.options=t?ga(this.options):this.options),r}},{key:"clone",value:function(){return new _y(ga(this.operator),ga(this.formulas),ga(this.options),this.sheet)}},{key:"freezeRef",value:function(){var e={writable:!1,configurable:!1};oy(this.type),oy(this.operator),oy(this._initialFormulas),oy(this.options),Object.defineProperties(this,{type:e,operator:e,_initialFormulas:e,options:e})}},{key:"getHash",value:function(){return Fa(this.toJSON({needDeepClone:!1}))}},{key:"_getFormulaArgsForCheckInput",value:function(e){var t=ca(this.sheet.formatterService,null,e);if(!t)return{validateObj:e};var r=t.value,n=t.autoFormatter;return{validateObj:(0,ve.default)(r)?r:'"'.concat((0,Ce.dNX)(r),'"'),formatCode:n&&n.getFormatCode()}}},{key:"_getResultWhileFmlErr",value:function(){return new it.BooleanVar(!1)}},{key:"_getResultWhileCellIsEmpty",value:function(){return new it.BooleanVar(!0)}},{key:"_getResultWhileFmlServiceSuspended",value:function(){return new it.BooleanVar(!0)}},{key:"_getResultWhileCalcCorrectly",value:function(e){return e.isBool()?e:new it.BooleanVar(!1)}},{key:"_getFormulaStr",value:function(e){return"OR(ISBLANK(".concat(e,"), ").concat(py(e,this.operator,this.formulas,!0),")")}}],[{key:"isValidJSON",value:function(e){var t=e.type,r=e.formulas,n=e.operator,a=e.options;return![[t,r,n].every(Boolean),[(0,ye.default)(a),(0,de.Z)(a)].some(Boolean),[(0,ce.Z)(n)].every(Boolean),Array.isArray(r)&&r.every((function(e){return(0,ve.default)(e.value)}))].some((0,le.Z)(Boolean))&&!!my(n,r)}}]),t}(ty);function Ey(e,t){if(!ky(e))return null;switch(e.type){case"list":var r=e.options,n=e.formulas;return new iy(n,r,t);case"listFromRange":var a=e.options,o=e.formulas;return new hy(o,a,t);case"checkbox":var i=e.options,u=e.formulas;return new vy(u,i,t);case"number":var s=e.formulas,l=e.operator,c=e.options;return new yy(l,s,c,t);case"date":var h=e.formulas,f=e.operator,d=e.options;return new Ry(f,h,d,t);case"textLength":var v=e.formulas,p=e.operator,m=e.options;return new wy(p,v,m,t);default:return null}}function ky(e){switch(e.type){case"list":return iy.isValidJSON(e);case"listFromRange":return hy.isValidJSON(e);case"checkbox":return vy.isValidJSON(e);case"number":return yy.isValidJSON(e);case"date":return Ry.isValidJSON(e);case"textLength":return wy.isValidJSON(e);default:return!1}}function Ty(e,t){return"object"==(0,R.Z)(e)&&"object"==(0,R.Z)(t)?null===e||null===t?Sy(e,t):Array.isArray(e)&&Array.isArray(t)?function(e,t){if(e.length!==t.length)return!1;for(var r=e.length,n=0;n<r;){if(!Ty(e[n],t[n]))return!1;n++}return!0}(e,t):function(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r=Object.keys(e),n=r.length,a=0;a<n;){if(!Ty(e[r[a]],t[r[a]]))return!1;a++}return!0}(e,t):Sy(e,t)}function Sy(e,t){return e===t}wy=_y=Vu([function(e){return e}],wy),function(e){e[e.None=0]="None",e[e.HeadMerged=1]="HeadMerged",e[e.TailMerged=2]="TailMerged",e[e.HeadSplitted=4]="HeadSplitted",e[e.TailSplitted=8]="TailSplitted"}(Cy||(Cy={}));var Ay=function(){function e(t){(0,y.Z)(this,e),this._hooks=t,this._map=new Map}return(0,_.Z)(e,[{key:"size",get:function(){return this._map.size}}]),(0,_.Z)(e,[{key:"has",value:function(e){return this._map.has(e)}},{key:"set",value:function(e,t){var r=this._hooks.afterRefChanged,n=this._map.get(e)||null,a=this._map.set(e,t);return r&&r(n,t),a}},{key:"get",value:function(e){return this._map.get(e)}},{key:"forEach",value:function(e){return this._map.forEach(e)}}]),e}(),Iy=function(){function e(t){(0,y.Z)(this,e),this.hashToRefs=new Map,this.idToRef=new Ay({afterRefChanged:this.afterRefChanged?this.afterRefChanged.bind(this):void 0}),this.refToId=new Map,this.refCounter=new Map,this.maxId=0,this.useRefCounter=!1,"number"==typeof t&&(this.maxId=t)}return(0,_.Z)(e,[{key:"freezeRef",value:function(e){Object.freeze(e)}},{key:"setHash",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.getHash(e),n=this.hashToRefs.get(r),a=!0;if(void 0===n)a=!1,n=new Set,this.hashToRefs.set(r,n);else if(t)for(var o=n.entries(),i=o.next();!i.done;){if(this.equals(e,i.value[0]))return{ref:i.value[0],hasSet:!0};i=o.next()}return this.freezeRef(e),n.add(e),{ref:e,hasSet:a}}},{key:"getIdByRef",value:function(e){return this.refToId.get(e)}},{key:"getById",value:function(e){return this.idToRef.get(e)}},{key:"getByVal",value:function(e){var t=this.getHash(e),r=this.hashToRefs.get(t);if(void 0!==r)for(var n=r.entries(),a=n.next();!a.done;){if(this.equals(e,a.value[0]))return a.value[0];a=n.next()}}},{key:"add",value:function(e){var t=this.setHash(e),r=t.ref;return t.hasSet&&this.refToId.has(r)||(this.maxId++,this.idToRef.set(this.maxId,r),this.refToId.set(r,this.maxId)),this.useRefCounter&&this.incRefCounter(r),{ref:r,id:this.toId(r)}}},{key:"foreach",value:function(e){this.idToRef.forEach(e)}},{key:"addById",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null!=t){var n=this.setHash(t,r),a=n.ref;if(this.maxId<e&&(this.maxId=e),this.idToRef.has(e)){var o=this.idToRef.get(e);if(this.refToId.delete(o),this.useRefCounter){var i=this.refCounter.get(o)||0;this.refCounter.set(a,i),this.refCounter.delete(o)}}return this.idToRef.set(e,a),this.refToId.set(a,e),{ref:a,id:e}}}},{key:"toId",value:function(e){return this.refToId.get(e)}},{key:"decRefCounter",value:function(e){if(!this.useRefCounter)return!1;var t=this.refCounter.get(e);return!!t&&(this.refCounter.set(e,t-1),!0)}},{key:"incRefCounter",value:function(e){if(!this.useRefCounter)return!1;var t=this.refCounter.get(e)||0;return this.refCounter.set(e,t+1),!0}},{key:"setUseRefCounter",value:function(e){this.useRefCounter=e}},{key:"getUseRefCounter",value:function(){return this.useRefCounter}},{key:"setCounterById",value:function(e,t){if(!this.useRefCounter)return!1;if(!(0,ve.default)(t))return!1;var r=this.getById(e);return!!r&&(this.refCounter.set(r,t),!0)}},{key:"getCounterById",value:function(e){if(!this.useRefCounter)return 0;var t=this.getById(e);return t&&this.refCounter.get(t)||0}},{key:"toJSON",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],r={};return t?this.foreach((function(t,n){var a=JSON.parse(JSON.stringify(t));if(r[n]=a,e.useRefCounter){var o=e.refCounter.get(t);r[n].refCount=o||0}})):this.foreach((function(t,n){if(r[n]=t,e.useRefCounter){var a=e.refCounter.get(t);r[n].refCount=a||0}})),r}},{key:"toArray",value:function(e){for(var t=new Array(Math.max(0,this.maxId)).fill(null),r=0;r<=this.maxId;r++){var n=this.idToRef.get(r);n&&(t[r]=e?n:this.serializeRef(n))}return t}},{key:"findSameRefs",value:function(e){var t=this,r=[];return this.foreach((function(n){t.equals(e,n)&&r.push(n)})),r}},{key:"isEmpty",value:function(){return 0===this.refToId.size}},{key:"serializeRef",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"getRefCount",value:function(){return this.idToRef.size}}]),e}(),Oy=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,-1))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getHash",value:function(e){return Fa(e)}},{key:"equals",value:function(e,t){return Ty(e,t)}}]),t}(Iy),Vy=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).refs=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setDefaultRef",value:function(e){this.defaultRef=e}},{key:"getDefaultRef",value:function(){return this.defaultRef}},{key:"getRefMgr",value:function(){return this.refs}},{key:"setRef",value:function(e,t,r){if(null!=r){var n=this.refs.add(r).id;return this.set(e,t,n),n}this.set(e,t,null)}},{key:"getRef",value:function(e,t){var r=this.get(e,t);return null==r?null:this.refs.getById(r)||null}},{key:"setById",value:function(e,r,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return a?!!this.refs.getById(n)&&(this.set(e,r,n,a),!0):((0,f.Z)((0,v.Z)(t.prototype),"set",this).call(this,e,r,n),!0)}},{key:"iterRef",value:function(e,t,r,n){var a=this;return this.iter(e,t,r,n).map((function(e){return a.refs.getById(e)||null})).filter((function(e){return null!=e}))}},{key:"iterRefWithPos",value:function(e,t,r,n){var a=this;return this.iterWithPos(e,t,r,n).map((function(e){return[a.refs.getById(e[0]),e[1]]}))}},{key:"clearCellRef",value:function(e,t){if(this.refs.getUseRefCounter()){var r=this.getRef(e,t);r&&this.refs.decRefCounter(r)}}},{key:"set",value:function(e,r,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];a&&this.clearCellRef(e,r),(0,f.Z)((0,v.Z)(t.prototype),"set",this).call(this,e,r,n)}},{key:"clear",value:function(e,r,n,a){for(var o=this.iter(e,r,n,a);o.next();){var i=o.position();this.clearCellRef(i.row,i.col)}(0,f.Z)((0,v.Z)(t.prototype),"clear",this).call(this,e,r,n,a)}}]),t}(Wg);function Ny(e){for(var t in e)return null!=e[t]&&"number"==typeof e[t].refCount;return!1}function by(e){for(var t in e)return!1;return!0}function My(e,t,r,n){var a=t.segmentArray;if(a)return new Og(e,a).getText(e.userLanguage);var o=t.variant,i=o?o.getValue(n):"";return(r.formatter||(0,Ee.createFormatter)(e.formatterService)).format(i)}function Fy(e,t,r,n){var a=e.getActualFormatter(t,r),o=n.segmentArray,i=n.variant;return{text:My(e.parent,{segmentArray:o,variant:i},{formatter:a}),variant:i||null,segmentArray:o||null}}var Zy,xy,Dy,Py=function(){var e=new Map([{formatName:"01/08/2017",formatCode:"dd/mm/yyyy"},{formatName:"01/08/17",formatCode:"dd/mm/yy"},{formatName:"1/8/17",formatCode:"d/m/yy"},{formatName:"1.8.17",formatCode:"d.m.yy"},{formatName:"01 August 2017",formatCode:"dd mmmm yyyy"},{formatName:"1 August 2017",formatCode:"d mmmm yyyy"},{formatName:"2017/8/1",formatCode:"yyyy/m/d"},{formatName:"201781 ",formatCode:"yyyy/mm/dd aaaa"},{formatName:"201781",formatCode:"yyyymd"},{formatName:"20178",formatCode:"yyyym"},{formatName:"81",formatCode:"md"},{formatName:"",formatCode:"aaaa"},{formatName:"",formatCode:"aaa"},{formatName:"17/8/1",formatCode:"yy/m/d"},{formatName:"8/1",formatCode:"m/d"},{formatName:"8/1/17",formatCode:"m/d/yy"},{formatName:"08/01/17",formatCode:"mm/dd/yy"},{formatName:"2017",formatCode:"yyyy"},{formatName:"17",formatCode:"yy"}].map((function(e){return[e.formatName,{formatCode:e.formatCode,name:e.formatName,teaName:"date(".concat(e.formatCode,")"),type:5,formatterName:e.formatName}]})));return function(){var e=Ce.Ps3.getLanguage().toLowerCase();return"zh"===e||"zh-hk"===e||"zh-tw"===e?["201781 ","201781","2017/8/1","17/8/1","20178","81","8/1","","","8/1/17","08/01/17","2017","17"]:"ja"===e?["201781","2017/8/1","20178","81","8/1","8/1/17","08/01/17"]:["01/08/2017","01/08/17","1/8/17","1.8.17","01 August 2017","1 August 2017"]}().map((function(t){var r=e.get(t);if(!r)throw new Error("item: ".concat(t,", must be defined"));return r}))};function $y(){return void 0===Zy&&(Zy=[{formatCode:"General",name:cr("sheet.conventional"),teaName:"general",type:0,formatterName:"general",isMatch:function(e,t){return/^general$/i.test(t)}},{formatCode:"@",name:cr("sheet.plain_text"),teaName:"plain_text",type:1,formatterName:"plain_text"},{formatCode:"0",name:cr("LarkCCM_Sheets_Toolbar_NumberRounded_Menu"),format:"1024",teaName:"number_without_separator",type:2,formatterName:"digital_without_separator"},{formatCode:"#,##0",name:cr("LarkCCM_Sheets_Toolbar_Number_Separator_Menu"),format:"1,024",teaName:"number",type:2,formatterName:"digital"},{formatCode:"#,##0.00",name:cr("LarkCCM_Sheets_Toolbar_Number_Decimal_Menu"),format:"1,024.56",teaName:"number(rounded)",type:2,formatterName:"digital_round",isMatch:function(e,t){return/^#,##0\.0+$/.test(t)}},{formatCode:"0%",name:cr("LarkCCM_Sheets_Toolbar_PercentageRounded_Menu"),format:"10%",teaName:"percentage(rounded)",type:3,formatterName:"percentage_rounded"},{formatCode:"0.00%",name:cr("LarkCCM_Sheets_Toolbar_Percentage_Decimal_Menu"),format:"10.24%",teaName:"percentage",type:3,formatterName:"percentage",isMatch:function(e,t){return/^0\.0+%$/.test(t)}},{formatCode:"0.00E+00",name:cr("sheet.scientific_count"),format:"1.02E+03",teaName:"scientific",type:2,formatterName:"scientific",isMatch:function(e,t){return/^0(\.0+)*E\+00$/.test(t)}},{formatCode:"#,##0",name:cr("LarkCCM_Sheets_Toolbar_CNY_Menu"),format:"1,024",teaName:"cny(rounded)",type:4,formatterName:"cyn_rounded"},{formatCode:"#,##0.00",name:cr("LarkCCM_Sheets_Toolbar_CNY_Decimal_Menu"),format:"1,024.56",teaName:"cny",type:4,formatterName:"cyn",isMatch:function(e,t){return/^#,##0\.0+$/.test(t)}},{formatCode:"$#,##0",name:cr("sheet.currency_dollar_rounded"),format:"$1,024",teaName:"dollar(rounded)",type:4,formatterName:"dollar_rounded"},{formatCode:"$#,##0.00",name:cr("LarkCCM_Sheets_Toolbar_USD_Decimal_Menu"),format:"$1,024.56",teaName:"dollar",type:4,formatterName:"dollar",isMatch:function(e,t){return/^\$#,##0\.0+$/.test(t)}},{formatCode:cr("sheet.format_code.date_with_slash"),name:cr("sheet.date"),format:cr("sheet.format_text.date_with_slash"),teaName:"date(yyyy/mm/dd)",type:5,formatterName:"date_with_slash",isMatch:function(e,t){var r=(0,Ee.createFormatter)(e.formatterService,t);return(0,Ee.hasDate)(r)&&!(0,Ee.hasTime)(r)}},{formatCode:cr("sheet.format_code.date_with_hyphen"),name:cr("sheet.date"),format:cr("sheet.format_text.date_with_hyphen"),teaName:"date(yyyy-mm-dd)",type:5,formatterName:"date_with_hyphen",isMatch:function(e,t){var r=(0,Ee.createFormatter)(e.formatterService,t);return(0,Ee.hasDate)(r)&&!(0,Ee.hasTime)(r)}},{formatCode:"HH:mm:ss",name:cr("sheet.time"),format:"23:24:25",teaName:"time",type:5,formatterName:"time",isMatch:function(e,t){var r=(0,Ee.createFormatter)(e.formatterService,t);return!(0,Ee.hasDate)(r)&&(0,Ee.hasTime)(r)}},{formatCode:cr("sheet.format_code.date_time"),name:cr("sheet.data_time"),format:cr("sheet.format_text.date_time"),teaName:"datetime",type:5,formatterName:"date_time",isMatch:function(e,t){var r=(0,Ee.createFormatter)(e.formatterService,t);return(0,Ee.hasDate)(r)&&(0,Ee.hasTime)(r)}}].concat((0,m.Z)(Py()))),Zy}function Ly(){return void 0===xy&&(xy=new Map($y().map((function(e){return[e.formatterName,e]})))),xy}function By(e){return(void 0===Dy&&(Dy=new Map($y().map((function(e){return[e.formatCode,e]})))),Dy).get(e)}function Uy(e){return Ly().get(e)}function Hy(e){return Ly().get(e).formatCode}function zy(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Number.isNaN(e)&&(e=2);var n=0===e?"":".".concat("0".repeat(e)),a=r||t?"#,##":"",o="".concat(a,"0").concat(n);if(r){var i=(0,Ce.MAs)().get(r);if(!i)throw Error("currencyInfo is not found");var u=i.position,s=i.symbol,l=i.locale;o=u===Ce.Gvu.prefix?"[$-".concat(l,"]").concat(s).concat(a,"0").concat(n):"".concat(a,"0").concat(n).concat(s,"[$-").concat(l,"]")}return["".concat(o,"_);(").concat(o,")"),o]}function Wy(e,t){null!=t&&"string"!=typeof t&&(t=t.formatCached||Hy("general"));var r,n=yr($y());try{for(n.s();!(r=n.n()).done;){var a=r.value;if(a.isMatch&&a.isMatch(e,t))return a.formatCode}}catch(e){n.e(e)}finally{n.f()}return t}var Gy=function(e,t){if(!e)return!1;var r=e.getSelections();return function(e,t,r){var n=(r||{}).includeAutoFormatter,a=void 0===n||n;return t.some((function(t){return!!e.iterStyle(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()).first_if((function(e){var t=e.formatter,r=e.autoFormatter;return!!Boolean(t)||a&&Boolean(r)}))}))}(e,r,t)},jy=function(e,t){if(!e)return new Set;var r=e.getSelections();return function(e,t,r){var n=(r||{}).includeAutoFormatter,a=void 0===n||n,o=new Set;return t.forEach((function(t){e.iterStyle(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()).forEach((function(e){var t=e.formatter,r=e.autoFormatter;t?o.add(t.getFormatCode()):a&&r&&o.add(r.getFormatCode())}))})),o}(e,r,t)},Yy=function(e){var t="";if(e.workbook.locale){var r=(0,Ce.sBS)(e.workbook.locale);r&&(t=r[1].symbol)}e.info||(e.info={}),e.info.customData=Object.assign({},e.info.customData,{autoFormat:t+"#,##0.00"})},qy=[r_,u_];function Jy(e,t,r,n,a){var o,i=null==a?void 0:a.skipFormulaCompile,u=null==a?void 0:a.formulaCompileCtx,s=null==a?void 0:a.stringVarRefMap;if((0,de.Z)(n)&&n.tokens&&n.tree){var l=e.parent.calcEngine;try{return l.deserializeFormula(n,new ou(t,r,1,1,e))}catch(e){console.log("value2variant deserializeFormula err: ",e)}}return o=i?qy:[r_,function(n){return function(e){return e.length>1&&("="===e[0]||"+"===e[0])}(n)?n_(e,t,r,n,u):null},u_],Ky(n,o,s)}function Ky(e,t,r){if((0,se.Z)(e))return it.BOOLEAN_VAR_MAP[e?it.BooleanConstant.TRUE:it.BooleanConstant.FALSE];if((0,ve.default)(e))return new it.NumberVar(e);if((0,ce.Z)(e)){var n=(0,Ce.$ES)(e);t||(t=qy);for(var a=0;a<t.length;a++){var o=t[a](n);if(null!=o)return o}return r?r.add(n):new it.StringVar(n)}return e instanceof Date?new it.NumberVar(we.SheetDate.fromUTCDate(e).toNumber()):e instanceof we.SheetDate?new it.NumberVar(e.toNumber()):e instanceof it.BaseVar?e:null}var Xy=it.ERROR_VAR_MAP,Qy=it.BOOLEAN_VAR_MAP,e_=it.BooleanConstant.TRUE,t_=it.BooleanConstant.FALSE;function r_(e){var t=e.toUpperCase();if("#"===e[0]){var r=Xy[t];if(r)return r}return t===e_?Qy[e_]:t===t_?Qy[t_]:null}function n_(e,t,r,n,a){var o="="===n[0]?n.substring(1):n,i=Object.assign({ref:new ou(t,r,1,1,e),spread:e.parent},a),u=e.getCalcEngine().compile(o,i),s=u.errors,l=u.formulaVar;return s?new it.StringVar(n):l}var a_=/^\/OADate\((-?\d+\.?\d*)\)\//,o_="/OADate",i_=o_.length;function u_(e){for(var t=0;t<i_;t++)if(e[t]!==o_[t])return null;var r=a_.exec(e);return null!=r&&r[1]?new it.NumberVar(parseFloat(r[1])):null}var s_=",",l_=function(){function e(t){(0,y.Z)(this,e),this._spread=t,this.list=[]}return(0,_.Z)(e,[{key:"fromJSON",value:function(e){var t=this;if(e&&e.length)return this.clear(),e.forEach((function(e){var r={};Array.isArray(e.value)?r.segmentArray=e.value:r.variant=Ky(e.value),e.autoFormatter&&(r.autoFormatter=t.importFormatter(e.autoFormatter)),t.add(r)})),this}},{key:"toJSON",value:function(){var e=[];return this.list.forEach((function(t){var r;if(t.segmentArray)r=t.segmentArray;else{if(!t.variant)return;r=t.variant.getValue()}if(t.autoFormatter){var n=t.autoFormatter.getFormatCode();if(n)return void e.push({value:r,autoFormatter:n})}e.push({value:r})})),e}},{key:"clone",value:function(){var t=new e(this._spread);return t.fromJSON(this.toJSON()),t}},{key:"fromSingleValue",value:function(e,t){if(this.clear(),e.segmentArray)this.addBySegmentArray(e.segmentArray,t);else if(e.variant)if(e.variant.isString()){var r=e.variant.getValue();this.addByText(r,t)}else{var n={variant:e.variant};t&&(n.autoFormatter=t),this.add(n)}return this}},{key:"fromString",value:function(e,t){return this.clear(),this.addByText(e,t),this}},{key:"addByTextNoSplit",value:function(e,t){var r=(0,Ce.Tcw)(e);Array.isArray(r)&&1===r.length?this.addBySegmentArray(r,t):this.add(this.stringToMultipleValue(e,t))}},{key:"addStringMultipleValue",value:function(e,t){this.add(this.stringToMultipleValue(e,t))}},{key:"addByText",value:function(e,t){var r=this;e&&e.split(s_).forEach((function(e){if(e){var n=(0,Ce.Tcw)(e);Array.isArray(n)?r.addBySegmentArray(n,t):r.add(r.stringToMultipleValue(n,t))}}))}},{key:"add",value:function(e){this.list.push(e)}},{key:"forEach",value:function(e){for(var t=this.list.length,r=0;r<t;)e(this.get(r),r),r++}},{key:"get",value:function(e){return this.list[e]}},{key:"set",value:function(e,t){this.list[e]=t}},{key:"clear",value:function(){this.list=[]}},{key:"stringToMultipleValue",value:function(e,t){var r=(0,Ee.getPreferredFormatter)(this._spread.formatterService,e,t),n=r.value,a=r.formatter,o={variant:Ky(n)};return t?o.autoFormatter=t:a&&!function(e,t){if(e){var r=e.getFormatCode();return t.includes(r)}return!1}(a,["@","General"])&&(o.autoFormatter=a),o}},{key:"addBySegmentArray",value:function(t,r){var n=this,a=[],o=t.length;t.forEach((function(t,i){if(t.type===Ce.K6s.TEXT&&e.isTextCanSplit(t.text)){var u=t.text.split(s_),s=u.shift(),l=u.pop();a.length?(s&&a.push(n.createTextSegment(s)),n.add({segmentArray:a}),a=[]):s&&n.addByText(s,r),n.addByText(u.join(s_),r),l&&(i===o-1?n.addByText(l,r):a.push(n.createTextSegment(l)))}else a.push(t)})),a.length&&this.add({segmentArray:a})}},{key:"getFirstItem",value:function(){return this.get(0)||{variant:null}}},{key:"toStringArray",value:function(t){var r=this;return this.list.map((function(n){return e.multipleValueItemToString(r._spread,n,t)})).filter((function(e){return!!e}))}},{key:"mergeToString",value:function(e){return this.toStringArray(e).join(s_)}},{key:"itemToText",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{formatter:null};return e.multipleValueItemToString(this._spread,t,r)}},{key:"mergeToSingleValue",value:function(t){var r=this;if(this.list.length<=1)return this.getFirstItem();if(this.list.some((function(e){return!!e.segmentArray}))){var n=[];return this.list.forEach((function(a,o){if(a.segmentArray)Array.prototype.push.apply(n,a.segmentArray);else{var i=e.multipleValueItemToString(r._spread,a,t);n.push(r.createTextSegment(i))}o!==r.list.length-1&&n.push(r.createTextSegment(s_))})),{segmentArray:n}}return{variant:new it.StringVar(this.mergeToString(t))}}},{key:"createTextSegment",value:function(e){return{type:Ce.K6s.TEXT,text:e}}},{key:"importFormatter",value:function(e){return"string"==typeof e?""===e?(0,Ee.createFormatter)(this._spread.formatterService):(0,Ee.createFormatter)(this._spread.formatterService,e):e instanceof Ee.Formatter?e:(0,Ee.createFormatter)(this._spread.formatterService)}},{key:"length",get:function(){return this.list.length}},{key:"spread",get:function(){return this._spread}}],[{key:"isCanSingleToMultiple",value:function(t,r,n){var a=r.variant,o=r.segmentArray;if(o)return o.some((function(t){return t.type===Ce.K6s.TEXT&&e.isTextCanSplit(t.text)}));if(a){if(!a.isString())return!1;var i=e.multipleValueItemToString(t,{segmentArray:r.segmentArray,variant:r.variant,autoFormatter:n||void 0},{formatter:n||null});return e.isTextCanSplit(i)}return!1}},{key:"isTextCanSplit",value:function(e){return e.indexOf(s_)>=0}},{key:"multipleValueItemToString",value:function(e,t,r){return My(e,{variant:t.variant,segmentArray:t.segmentArray},{formatter:r.formatter||t.autoFormatter||null})}}]),e}();function c_(e){4===e&&(e=0);var t=0;switch(e){case 0:case 6:t=511;break;case 1:t=1;break;case 2:t=24;break;case 3:t=2;break;case 5:t=128}return t}function h_(e,t){var r,n=e.getListItem(t);if(e.options.shouldHighlightValidData){var a={},o=e.options.colors;if(o.length>0)for(var i=0;i<n.length;++i){var u=o[0].length,s=o[Math.floor(i/u)];if(s){var l=s[i%u];if(l){var c=n[i];a[c]||(a[c]=l)}}}var h=Object.assign({},e.options);delete h.colors,r=Object.assign({},h,{listItemColorMap:a})}else r=e.options;return new iy(n,r,e.sheet)}function f_(e){if(null==e)throw Error("[SHEET ERROR] Dropdown Data Invalid, can not be transformed! ");var t=e.list,r=function(e){var t=e.isEnableOptionColor,r=e.list,n=e.color;if(!t||!r||!n)return{shouldHighlightValidData:!1};var a={};return r.forEach((function(e,t){a[e]=n[t]})),{listItemColorMap:a,shouldHighlightValidData:!0}}(e);return{type:"list",formulas:Array.isArray(t)?(0,m.Z)(t):[],options:Object.assign({supportMultipleValues:!1,ignoreCase:!1},r)}}var d_=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,null,[{key:"isSameDataValidationJSON",value:function(e,t){return e.type===t.type&&(0,me.default)(e,t)}},{key:"findRanges",value:function(e,t,r){var n,a=[],o=r.range;0!==e.size&&(n=r.iterVisible?t.cellModel.iterVisibleDataValidation(o.rowFrom(),o.colFrom(),o.rowTo(),o.colTo()):t._getModel().iterDataValidationWithPos(o.rowFrom(),o.colFrom(),o.rowCount(),o.colCount()),a=this.findDataValidationRefRange(e,t,n));return a}},{key:"contentContainValues",value:function(e,t,r,n){return r.getTextWithValues(e,t,!0).map((function(e){return e.text})).some((function(e){return n.includes(e)}))}},{key:"findDataValidationRefRange",value:function(e,t,r){var n=[];return r.forEach((function(r){var a=(0,g.Z)(r,2),o=a[0],i=a[1],u=i.row,s=i.col;e.has(o)&&n.push(new uu(u,s,t))})),n}}]),e}();function v_(e,t,r,n){var a=e.getDataValidation(t,r);if(!a||!A_(a))return!1;if(e.getMultipleValues(t,r))return!1;var o=e.getImmutableContent(t,r);if(!o)return!1;var i=e.getActualFormatter(t,r,n,!0)||void 0;return l_.isCanSingleToMultiple(e.parent,o,i)}function p_(e,t,r,n){var a=e.getImmutableContent(t,r),o=e.getActualFormatter(t,r,n,!0)||void 0,i=new l_(e.parent);return a&&i.fromSingleValue(a,o),i}function m_(e,t,r,n,a,o,i,u){var s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,l="",c="";if(e&&(l&&(l+="_"),l+="checkbox"),t&&(l&&(l+="_"),l+="list_single"),r&&(l&&(l+="_"),l+="list_multiple"),n&&(c&&(c+="_"),c+="colored"),a&&(c&&(c+="_"),c+="default"),l){var h={action:"apply_valid_rule",valid_type:l,source:o};c&&(h.op_item=c),Ce.Ps3.collectSuiteEvent("sheet_opration",h)}128&c_(s)&&u&&i&&Ce.Ps3.ccmEventTracking&&Ce.Ps3.ccmEventTracking("ccm_sheet_content_page_click",Object.assign({},(0,Ce.dK5)(),{click:"add_data_valid_cell",target:"none",action_type:o,valid_num:i,valid_type:u}))}function g_(e,t,r,n,a){e.iterContentWithPos(t,r,n,a).forEach((function(t){var r=(0,g.Z)(t,2),n=r[0],a=r[1],o=a.row,i=a.col,u=n.multipleValues;if(u){var s=e.getDataValidation(o,i);if(!s||!A_(s)){var l=e.getUserFormatter(o,i)||null,c=u.mergeToSingleValue({formatter:l}),h=c.segmentArray,f=c.variant,d=null;h?d=h:f&&(d=f.getValue()),e.setValue(o,i,d)}}}))}function y_(e,t,r,n){var a=e.getActualFormatter(t,r,n,!0),o=e.getImmutableContent(t,r);if(o){var i=o.multipleValues,u=o.segmentArray;return i?i.mergeToSingleValue({formatter:a}).segmentArray:u}}function __(e){return"list"===e.type}function R_(e){return"listFromRange"===e.type}function C_(e){return"checkbox"===e.type}function w_(e){return"date"===e.type}function E_(e){return"number"===e.type}function k_(e){return"textLength"===e.type}function T_(e){return __(e)||R_(e)}function S_(e){return"list"===e.type||"listFromRange"===e.type}function A_(e){return T_(e)&&e.options.supportMultipleValues}function I_(e){return S_(e)&&e.options.supportMultipleValues}function O_(e){return T_(e)&&!e.options.supportMultipleValues}function V_(e,t,r){var n,a=[],o=e._getModel(),i=function(e,t){var r,n=[e],a=yr(t);try{for(a.s();!(r=a.n()).done;){var o,i=r.value,u=[],s=yr(n);try{for(s.s();!(o=s.n()).done;){var l=o.value;(0,Ce.hTd)(u,l.sub(i))}}catch(e){s.e(e)}finally{s.f()}n=u}}catch(e){a.e(e)}finally{a.f()}return n}(new au(e),r),u=new Set(o.findSameDataValidation(t)),s=yr(i);try{for(s.s();!(n=s.n()).done;){var l,c=n.value,h=yr(Uv(d_.findRanges(u,e,{iterVisible:!1,range:c}),e));try{for(h.s();!(l=h.n()).done;){var f=l.value;a.push(f)}}catch(e){h.e(e)}finally{h.f()}}}catch(e){s.e(e)}finally{s.f()}return a}function N_(e){return e&&e.options&&(!e.options.handledWayOnInvalidData||2&e.options.handledWayOnInvalidData)}function b_(e){var t,r=null==e||null===(t=e.options)||void 0===t?void 0:t.handledWayOnInvalidData;return!!r&&1&r&&!N_(e)}function M_(e){return!(e&&!T_(e))&&(null==e?void 0:e.options)&&e.options.supportMultipleValues}function F_(e){return e&&w_(e)&&!!e.options.isDatePickerVisibleInCell}function Z_(e){var t,r=null===(t=e.getSpecialInfo())||void 0===t?void 0:t.checkboxInfo;return Boolean(r&&r.visible)}function x_(e,t,r){var n=[],a=t.sheetView().getVisibleRangeWithFrozen()||new ou(0,0,0,0,r);return r.cellModel.iterVisibleDataValidation(a.rowFrom(),a.colFrom(),a.rowTo(),a.colTo()).forEach((function(t){var a=(0,g.Z)(t,2),o=a[0],i=a[1];if(e!==o){var u=e.toJSON({needDeepClone:!1}),s=o.toJSON({needDeepClone:!1});(0,me.default)(u,s)&&n.push(new ou(i.row,i.col,1,1,r))}else n.push(new ou(i.row,i.col,1,1,r))})),n}var D_=function(){function e(t){(0,y.Z)(this,e),this.iter=t,this.exportType=0}return(0,_.Z)(e,[{key:"exportCells",value:function(e,t){for(var r=this.iter.next();null!==r;r=this.iter.next()){var n=this.iter.position(),a=e(n.row,n.col);this.exportToCell(a,r,t)}}},{key:"exportExtraInfo",value:function(e){}},{key:"setExportType",value:function(e){this.exportType=e}},{key:"exportToCell",value:function(e,t,r){}}]),e}(),P_="#bacefd";function $_(e,t){var r,n=function(e){return e?{handledWayOnInvalidData:e.handledWayOnInvalidData,helpText:e.helpText}:void 0}(e.options);switch(e.type){case"list":case"listFromRange":var a={supportMultipleValues:e.options.supportMultipleValues,ignoreCase:e.options.ignoreCase,isDropdownIconHiddenInCell:e.options.isDropdownIconHiddenInCell,shouldHighlightValidData:e.options.shouldHighlightValidData},o=e.options.shouldHighlightValidData;if("list"===e.type){for(var i,u,s=e.formulas,l=0;l<s.length;l++){var c=s[l],h=t.strings.addValue(c);if(u||(u=new Array(s.length)),u[l]=h,o&&e.options.listItemColorMap){var f,d=e.options.listItemColorMap[c];i||(i=new Array(s.length)),i[l]=t.colors.addValue(null!==(f=d)&&void 0!==f?f:P_)}}r={type:Ce.B2l.DataValidationConditionType.DataValidationConditionType_List,listDataValidation:{listSourceType:Ce.B2l.ListSourceType.ListSourceType_Items,listItemFormula:{listItemIds:u,listItemColorIds:i},options:a,tips:n}}}else{var v;if(o&&e.options.colors.length)for(var p=e.options.colors,m=0;m<p.length;m++)for(var g=p[m],y=0;y<g.length;y++){var _,R=g[y];v||(v=new Array(p.length*g.length)),v[m*g.length+y]=t.colors.addValue(null!==(_=R)&&void 0!==_?_:P_)}r={type:Ce.B2l.DataValidationConditionType.DataValidationConditionType_List,listDataValidation:{listSourceType:Ce.B2l.ListSourceType.ListSourceType_Range,listRangeFormula:{refRangeString:e.formulas[0],listItemColorIds:v},options:a,tips:n}}}break;case"number":r={type:Ce.B2l.DataValidationConditionType.DataValidationConditionType_Number,numberDataValidation:{operator:B_(e.operator),formulas:H_(e.formulas),options:{validNumType:e.options.validNumType},tips:n}};break;case"date":r={type:Ce.B2l.DataValidationConditionType.DataValidationConditionType_Date,dateDataValidation:{operator:B_(e.operator),formulas:H_(e.formulas),options:{isDatePickerVisibleInCell:e.options.isDatePickerVisibleInCell},tips:n}};break;case"textLength":r={type:Ce.B2l.DataValidationConditionType.DataValidationConditionType_TextLength,textLengthDataValidation:{operator:B_(e.operator),formulas:H_(e.formulas),tips:n}};break;case"checkbox":r={type:Ce.B2l.DataValidationConditionType.DataValidationConditionType_Checkbox,checkboxDataValidation:{formulas:e.formulas,tips:n}}}return r}function L_(e,t,r){var n,a,o=t.valueRefDelta,i=t.resourceRefDelta;switch(e.type){case Ce.B2l.DataValidationConditionType.DataValidationConditionType_List:var u=e.listDataValidation,s=u.listSourceType,l=u.listItemFormula,c=u.listRangeFormula,h=u.options,f=u.tips;if(s===Ce.B2l.ListSourceType.ListSourceType_Items){var d,v,p;if(null!=l&&null!==(d=l.listItemIds)&&void 0!==d&&d.length){p=new Array(l.listItemIds.length);for(var g=0;g<l.listItemIds.length;g++){var y,_,R,C=o.strings[l.listItemIds[g]];if(p[g]=C,null!=h&&h.shouldHighlightValidData)if(v||(v={}),null!==(y=l.listItemColorIds)&&void 0!==y&&y.length&&null!==(_=i.colors)&&void 0!==_&&_.length){var w=l.listItemColorIds[g];v[C]=i.colors[w]}else(null===(R=l.listItemColors)||void 0===R?void 0:R.length)&&(v[C]=l.listItemColors[g])}}a={type:"list",formulas:p,options:Object.assign({},z_(f),{},W_(h),{listItemColorMap:v})}}else if(s===Ce.B2l.ListSourceType.ListSourceType_Range){var E,k,T,S;if(null!=h&&h.shouldHighlightValidData)if(S=[],null!=c&&null!==(E=c.listItemColorIds)&&void 0!==E&&E.length)for(var A=c.listItemColorIds,I=function(e,t){if(!t)return 0;var r=new uu(-1,-1,e),n=ad(t,{spread:e.parent,refStyle:"A1",ref:r});return n&&n.isRef()?n.colCount(!0):0}(r,c.refRangeString),O=A.length/I,V=0;V<O;V++)for(var N=0;N<I;N++){var b=A[V*I+N];S[V]||(S[V]=[]),S[V].push(i.colors[b])}else if(null!=c&&null!==(k=c.listRangeColors)&&void 0!==k&&null!==(T=k.rows)&&void 0!==T&&T.length)for(var M=c.listRangeColors.rows,F=0;F<M.length;F++){var Z=M[F];Z.cols&&S.push((0,m.Z)(Z.cols))}a={type:"listFromRange",formulas:[null==c?void 0:c.refRangeString],options:Object.assign({},z_(f),{},W_(h),{colors:S})}}break;case Ce.B2l.DataValidationConditionType.DataValidationConditionType_Number:var x=e.numberDataValidation,D=x.options,P=x.formulas,$=x.operator,L=x.tips,B=H_(P);a={type:"number",operator:U_($,!1),options:Object.assign({},z_(L),{validNumType:null==D?void 0:D.validNumType})},B&&(a.formulas=B);break;case Ce.B2l.DataValidationConditionType.DataValidationConditionType_Date:var U=e.dateDataValidation;a={type:"date",operator:U_(null==U?void 0:U.operator,!0),formulas:H_(U.formulas),options:Object.assign({},z_(U.tips),{isDatePickerVisibleInCell:null==U||null===(n=U.options)||void 0===n?void 0:n.isDatePickerVisibleInCell})};break;case Ce.B2l.DataValidationConditionType.DataValidationConditionType_TextLength:var H=e.textLengthDataValidation,z=H.operator,W=H.formulas,G=H.tips;a={type:"textLength",operator:U_(z),formulas:H_(W),options:z_(G)};break;case Ce.B2l.DataValidationConditionType.DataValidationConditionType_Checkbox:var j=e.checkboxDataValidation;a={type:"checkbox",formulas:j.formulas,options:z_(j.tips)}}return a}function B_(e){switch(e){case"isAValidNumber":case"isAValidDate":return Ce.B2l.DataValidationOperator.NumberDataValidationOperator_IsValid;case"between":return Ce.B2l.DataValidationOperator.NumberDataValidationOperator_Between;case"notBetween":return Ce.B2l.DataValidationOperator.NumberDataValidationOperator_NotBetween;case"equalTo":return Ce.B2l.DataValidationOperator.NumberDataValidationOperator_EqualTo;case"notEqualTo":return Ce.B2l.DataValidationOperator.NumberDataValidationOperator_NotEqualTo;case"greaterThan":return Ce.B2l.DataValidationOperator.NumberDataValidationOperator_GreaterThan;case"lessThan":return Ce.B2l.DataValidationOperator.NumberDataValidationOperator_LessThan;case"greaterThanOrEqualTo":return Ce.B2l.DataValidationOperator.NumberDataValidationOperator_GreaterThanOrEqualTo;case"lessThanOrEqualTo":return Ce.B2l.DataValidationOperator.NumberDataValidationOperator_LessThanOrEqualTo;default:return}}function U_(e,t){switch(e){case Ce.B2l.DataValidationOperator.NumberDataValidationOperator_IsValid:return t?"isAValidDate":"isAValidNumber";case Ce.B2l.DataValidationOperator.NumberDataValidationOperator_Between:return"between";case Ce.B2l.DataValidationOperator.NumberDataValidationOperator_NotBetween:return"notBetween";case Ce.B2l.DataValidationOperator.NumberDataValidationOperator_EqualTo:return"equalTo";case Ce.B2l.DataValidationOperator.NumberDataValidationOperator_NotEqualTo:return"notEqualTo";case Ce.B2l.DataValidationOperator.NumberDataValidationOperator_GreaterThan:return"greaterThan";case Ce.B2l.DataValidationOperator.NumberDataValidationOperator_LessThan:return"lessThan";case Ce.B2l.DataValidationOperator.NumberDataValidationOperator_GreaterThanOrEqualTo:return"greaterThanOrEqualTo";case Ce.B2l.DataValidationOperator.NumberDataValidationOperator_LessThanOrEqualTo:return"lessThanOrEqualTo";default:return}}function H_(e){var t=[];return null!=e&&e.forEach((function(e){var r,n=null===(r=e.autoFormatter)||void 0===r?void 0:r.formatCached;t.push({value:e.value,autoFormatter:n?{formatCached:n}:void 0})})),t.length?t:void 0}function z_(e){var t,r;return!e||void 0===e.handledWayOnInvalidData&&void 0===e.helpText?void 0:{handledWayOnInvalidData:null!==(t=e.handledWayOnInvalidData)&&void 0!==t?t:void 0,helpText:null!==(r=e.helpText)&&void 0!==r?r:void 0}}function W_(e){return e?{supportMultipleValues:e.supportMultipleValues,ignoreCase:e.ignoreCase,isDropdownIconHiddenInCell:!!e.isDropdownIconHiddenInCell||void 0,shouldHighlightValidData:e.shouldHighlightValidData}:void 0}var G_=function(){function e(t,r,n,a,o){(0,y.Z)(this,e),this.model=t,this.rowFrom=r,this.colFrom=n,this.rowCount=a,this.colCount=o,this.iter=t.orderedIter(r,n,a,o)}return(0,_.Z)(e,[{key:"validSerializer",value:function(e){return!(!this.iter||!this.serializeCell)}},{key:"serializeToMutations",value:function(e){}}]),e}(),j_=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"freezeRef",value:function(e){e.freezeRef()}},{key:"afterRefChanged",value:function(e,t){e&&e.destroy(),t.initFormulaForCheckCell()}},{key:"getHash",value:function(e){return e.getHash()}},{key:"equals",value:function(e,t){if(e===t)return!0;var r=e.toJSON({needDeepClone:!1}),n=t.toJSON({needDeepClone:!1});return(0,me.default)(r,n)}},{key:"toJSON",value:function(){var e=this,t={};return this.foreach((function(r,n){if(t[n]=r.toJSON({needDeepClone:!0,returnDependentSheets:!0}),e.getUseRefCounter()){var a=e.getCounterById(n);t[n].refCount=a}})),t}},{key:"toArray",value:function(){for(var e=new Array(this.maxId).fill(null),t=this.toJSON(),r=0;r<=this.maxId;r++)t[r]&&(e[r]=t[r]);return e}}]),t}(Iy),Y_=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getValidationId",value:function(e){return this.getValidationRefAndId(e).id}},{key:"getValidationJson",value:function(e){return this.getValidationRefAndId(e).ref}},{key:"getValidationRefAndId",value:function(e){this.validationJsonCache||(this.validationJsonCache=new Map);var t=this.validationJsonCache.get(e);if(t)return t;var r=e.toJSON({needDeepClone:!0}),n=this.add(r);return this.validationJsonCache.set(e,n),n}},{key:"equals",value:function(e,t){return(0,me.default)(e,t)}},{key:"getHash",value:function(e){return Fa(e)}}]),t}(Iy),q_=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,new j_)))._sheet=e,r.setRefCounterState(),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getSerializer",value:function(e,t,r,n){return new K_(this,e,t,r,n)}},{key:"getExporter",value:function(e,t,r,n){return new X_(this,e,t,r,n)}},{key:"getImporter",value:function(){return new J_(this,this._sheet)}},{key:"setRefCounterState",value:function(){var e=this._sheet.isRefCountValid();this.refs.setUseRefCounter(e)}}]),t}(Vy),J_=function(){function e(t,r){(0,y.Z)(this,e),this._dataValidationModel=t,this._sheet=r,this._style2DataValidation={},this._dropdown2DataValidation={}}return(0,_.Z)(e,[{key:"importExtraInfo",value:function(e,t){this._dataValidationModel.setRefCounterState();var r=e.dataValidations;r&&this._importDataValidation(r),this._style2DataValidation={},this._dropdown2DataValidation={};var n=e.entities;n&&this._importFromDropdown(n)}},{key:"importCell",value:function(e,t,r,n){var a;if(r.dataValidationId?a=r.dataValidationId:r.styleId&&(a=this._style2DataValidation[r.styleId]),null!=a&&(this._dataValidationModel.setById(e,t,a),n)){this._dataValidationModel.getRefMgr().setUseRefCounter(!0);var o=this._dataValidationModel.getRefMgr().getById(a);if(!o)throw new Error("dataValidation not exist");if(!this._dataValidationModel.getRefMgr().incRefCounter(o))throw new Error("dataValidation incResult failed")}}},{key:"_importDataValidation",value:function(e){if(e){var t=Ny(e);for(var r in e){var n=e[r],a=Ey(n,this._sheet);if(a){var o=parseInt(r,10);if(this._dataValidationModel.getRefMgr().addById(o,a,!1),t){var i=n.refCount;this._dataValidationModel.getRefMgr().setCounterById(o,i)}}}}}},{key:"_importFromDropdown",value:function(e){var t=e.styles,r=e.dropdowns;for(var n in t)if(null!=t[n]){var a=t[n].dropdown;if(r&&void 0!==a){var o=this._getOrCreatedDataValidation(r,a);o&&(this._style2DataValidation[n]=o)}}}},{key:"_getOrCreatedDataValidation",value:function(e,t){if(this._dropdown2DataValidation.hasOwnProperty(t))return this._dropdown2DataValidation[t];var r=e[t];if(r){var n=Ey(f_(r),this._sheet);if(n){var a=this._dataValidationModel.getRefMgr().add(n).id;return this._dropdown2DataValidation[t]=a,a}}}}]),e}(),K_=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serializeCell",value:function(e,t,r){var n=r.cellValueRefHelper,a=this.model.getRefMgr().getById(t);a&&(r.isForShortcut&&this.serializeDataValidationForShortcut(e,a,r)||n.dataValidations.checkValuesRefId(t,(function(t){e.dataValidationId=t}),(function(){var t=$_(a.toJSON({needDeepClone:!1}),n);if(t){var r=n.dataValidations.add(t).id;return e.dataValidationId=r,r}})))}},{key:"serializeDataValidationForShortcut",value:function(e,t,r){if("listFromRange"!==t.type||!r.cellPosition)return!1;var n=t.checkCellValid(r.cellPosition.row,r.cellPosition.col);if(!n.getValue())return!1;var a=function(e,t){var r,n=null===(r=t.getSpecialInfo())||void 0===r?void 0:r.listValidateInfo,a=null==n?void 0:n.value[0];if(!a)return null;var o,i=[];if(e.options.shouldHighlightValidData){var u={};a.forEach((function(e,t){var r,n=e.text,a=e.color;i.push(n),u[n]=null!==(r=a)&&void 0!==r?r:""}));var s=Object.assign({},e.options);delete s.colors,o=Object.assign({},s,{listItemColorMap:u})}else a.forEach((function(e){i.push(e.text)})),o=e.options;return new iy(i,o,e.sheet)}(t,n);if(!a)return!1;var o=r.cellValueRefHelper,i=$_(a.toJSON({needDeepClone:!1}),o);if(i){var u=o.dataValidations.add(i).id;e.dataValidationId=u}return!0}}]),t}(G_),X_=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this,e.iter(r,n,a,o))))._model=e,i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exportExtraInfo",value:function(e){var t=this._model.getRefMgr().toJSON();delete e.dataValidations,by(t)||(e.dataValidations=t)}},{key:"exportToCell",value:function(e,t){null!=e&&null!=t&&(e.dataValidationId=t)}}]),t}(D_),Q_=new Set(["refCount"]),eR=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getHash",value:function(e){var t=Object.assign({},e);delete t.style,delete t.texts;var r=Fa(t,0,Q_);return e.style&&e.style.getHash&&(r=Fa(e.style.getHash(),r)),e.texts&&e.texts.forEach((function(t){var n=Object.assign({},t);delete n.style,r=Fa(n,r),e.style&&e.style.getHash&&(r=Fa(e.style.getHash(),r))})),r}},{key:"equals",value:function(e,t){var r=Object.keys(e).filter((function(e){return!Q_.has(e)})),n=Object.keys(t).filter((function(e){return!Q_.has(e)}));if(r.length!==n.length)return!1;var a,o=yr(r);try{for(o.s();!(a=o.n()).done;){var i=a.value;if("style"===i){var u=e[i],s=t[i];if(u&&s&&u.equals(s))continue;return!1}if("texts"===i){var l=e[i],c=t[i];if(l.length!==c.length)return!1;for(var h=l.length,f=0;f<h;f++){var d=l[f],v=c[f];if(d.type!==Ce.K6s.TEXT||d.type!==v.type||v.text!=v.text)return!1;var p=d.style,m=v.style;if(void 0===p&&void 0!==m||void 0!==p&&void 0===m||!p.equals(m))return!1}}if(e[i]!==t[i])return!1}}catch(e){o.e(e)}finally{o.f()}return!0}},{key:"toJSON",value:function(){var e=this,t={};return this.foreach((function(r,n){var a=Object.assign({},r);t[n]=a,e.useRefCounter&&(t[n].refCount=e.refCounter.get(r)||0)})),t}}]),t}(Iy),tR=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getHash",value:function(e){return e.getHash()}},{key:"equals",value:function(e,t){return e.equals(t)}}]),t}(Iy),rR=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getHash",value:function(e){return e.getHash()}},{key:"equals",value:function(e,t){return e.equals(t)}},{key:"toJSON",value:function(){var e=this,t={};return this.foreach((function(r,n){var a=r.toJSON(!0);t[n]=a,a&&e.useRefCounter&&(t[n].refCount=e.refCounter.get(r)||0)})),t}}]),t}(Iy),nR=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getHash",value:function(e){return e?1024*(e.style||0)+(e.dropdown||0):0}},{key:"equals",value:function(e,t){return e.dropdown===t.dropdown&&e.style===t.style}}]),t}(Iy),aR=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new nR;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,n))).sheet=e,r.styleDropdownRefMgr=n,r.styleRefMgr=new rR,r.dropdownRefMgr=new tR,r.setRefCounterState(),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setRefCounterState",value:function(){var e=this.sheet.isRefCountValid();this.styleDropdownRefMgr.setUseRefCounter(e)}},{key:"setStyle",value:function(e,t,r){r&&r.isDefault()&&(r=null);var n=this.getRef(e,t);if(r){var a=this.styleRefMgr.add(r).id;n?this.setRef(e,t,{style:a,dropdown:n.dropdown}):this.setRef(e,t,{style:a})}else n&&n.dropdown?this.setRef(e,t,{dropdown:n.dropdown}):this.setRef(e,t,null)}},{key:"setStyleById",value:function(e,t,r){var n=this.getRef(e,t);n?this.setRef(e,t,{style:r,dropdown:n.dropdown}):this.setRef(e,t,{style:r})}},{key:"getStyle",value:function(e,t){var r=this.getRef(e,t);return r&&r.style&&this.styleRefMgr.getById(r.style)||null}},{key:"setDefaultStyle",value:function(e){this.defaultStyle=e}},{key:"getDefaultStyle",value:function(){return this.defaultStyle}},{key:"setDropdown",value:function(e,t,r){var n=this.getRef(e,t);if(r){var a=this.dropdownRefMgr.add(r).id;n?this.setRef(e,t,{style:n.style,dropdown:a}):this.setRef(e,t,{dropdown:a})}else n&&n.style?this.setRef(e,t,{style:n.style}):this.setRef(e,t,null)}},{key:"getDropdown",value:function(e,t){var r=this.getRef(e,t);return r&&r.dropdown&&this.dropdownRefMgr.getById(r.dropdown)||null}},{key:"getStyleRefMgr",value:function(){return this.styleRefMgr}},{key:"getDropdownRefMgr",value:function(){return this.dropdownRefMgr}},{key:"getSheet",value:function(){return this.sheet}},{key:"getImporter",value:function(){return new oR(this)}},{key:"getExporter",value:function(e,t,r,n){return new uR(this,e,t,r,n)}},{key:"getSerializer",value:function(e,t,r,n){return new iR(this,e,t,r,n)}},{key:"iterDropdown",value:function(e,r,n,a){var o=this;return(0,f.Z)((0,v.Z)(t.prototype),"iterRef",this).call(this,e,r,n,a).filter((function(e){return null!=e.dropdown})).map((function(e){return o.dropdownRefMgr.getById(e.dropdown)})).filter((function(e){return null!=e}))}},{key:"iterStyle",value:function(e,r,n,a){var o=this;return(0,f.Z)((0,v.Z)(t.prototype),"iterRef",this).call(this,e,r,n,a).filter((function(e){return null!=e.style})).map((function(e){return o.styleRefMgr.getById(e.style)})).filter((function(e){return null!=e}))}},{key:"iterDropdownWithPos",value:function(e,r,n,a){var o=this;return(0,f.Z)((0,v.Z)(t.prototype),"iterRefWithPos",this).call(this,e,r,n,a).filter((function(e){return null!=e[0].dropdown})).map((function(e){return[o.dropdownRefMgr.getById(e[0].dropdown),e[1]]})).filter((function(e){return null!=e[0]}))}},{key:"iterStyleWithPos",value:function(e,r,n,a){var o=this;return(0,f.Z)((0,v.Z)(t.prototype),"iterRefWithPos",this).call(this,e,r,n,a).filter((function(e){return null!=e[0].style})).map((function(e){return[o.styleRefMgr.getById(e[0].style),e[1]]})).filter((function(e){return null!=e[0]}))}},{key:"foreachDropdown",value:function(e){this.dropdownRefMgr.foreach(e)}}]),t}(Vy),oR=function(){function e(t){(0,y.Z)(this,e),this.styleDropdownModel=t,this.hasWarnNotExist=!1}return(0,_.Z)(e,[{key:"importExtraInfo",value:function(e,t){if(this.styleDropdownModel.setRefCounterState(),"object"==(0,R.Z)(e.entities)){var r;if(this.importDropdowns(e.entities.dropdowns),t&&t.defaults&&t.defaults.style){var n=this.styleDropdownModel.getSheet().parent.formatterService;(r=Om.fromJSON(n,t.defaults.style,Mm())).setDefault(r)}this.importStyles(e.entities.styles,r)}}},{key:"importCell",value:function(e,t,r,n){if(r.styleId){var a=this.styleDropdownModel.getRefMgr().getById(r.styleId);if(!a)return void(this.hasWarnNotExist||(this.styleDropdownModel.getSheet().getLogger().warn("styleId not exist: ".concat(r.styleId)),this.hasWarnNotExist=!0));if(n&&(console.warn("style buildRefCounter set, something wrong"),this.styleDropdownModel.getRefMgr().setUseRefCounter(!0),!this.styleDropdownModel.getRefMgr().incRefCounter(a)))throw new Error("style incResult failed");if(a.dropdown)return void(a.style&&this.styleDropdownModel.setRef(e,t,{style:a.style}));this.styleDropdownModel.setById(e,t,r.styleId)}}},{key:"importDropdowns",value:function(e){if(e)for(var t in e){var r=e[t],n=parseInt(t,10),a=r.list,o=r.isValid,i=r.isEnableOptionColor,u=r.color;this.styleDropdownModel.getDropdownRefMgr().addById(n,new Rg(a,o,i,u))}}},{key:"importStyles",value:function(e,t){if(e){var r=Ny(e);for(var n in e){var a=e[n],o=parseInt(n,10),i=void 0,u=a&&a.dropdown;u&&(i=parseInt(a.dropdown,10),delete a.dropdown);var s=this.styleDropdownModel.getSheet().parent.formatterService,l=Om.fromJSON(s,a,t||Mm());if(l.equals(t||Mm()))this.styleDropdownModel.getRefMgr().addById(o,{dropdown:i});else{var c=this.styleDropdownModel.getStyleRefMgr().add(l).id;this.styleDropdownModel.getRefMgr().addById(o,{style:c,dropdown:i})}r&&this.styleDropdownModel.getRefMgr().setCounterById(o,e[n].refCount),u&&(a.dropdown=u)}}}}]),e}(),iR=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serializeCell",value:function(e,t,r){var n=this.model.getRefMgr().getById(t);if(e&&void 0!==(null==n?void 0:n.style)){var a=this.model.getStyleRefMgr().getById(n.style);a&&(e.styleId=r.cellFormatRefHelper.pushStyle(a,t))}}}]),t}(G_),uR=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this,e.iter(r,n,a,o)))).model=e,i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exportExtraInfo",value:function(e){var t=this,r={},n={};this.model.getRefMgr().foreach((function(e,a){var o=e.style,i=e.dropdown;r[a]={};var u=o&&t.model.getStyleRefMgr().getById(o);if(u&&(r[a]=u.toJSON(!0)),r[a]&&(t.model.getRefMgr().getUseRefCounter()&&(r[a].refCount=t.model.getRefMgr().getCounterById(a)),i)){var s=t.model.getDropdownRefMgr().getById(i);s&&(t.model.getRefMgr().getUseRefCounter()?(r[a].dropdown=i,n[i]?n[i].refCount+=t.model.getRefMgr().getCounterById(a):(n[i]=s.toJSON(),n[i].refCount=t.model.getRefMgr().getCounterById(a))):(r[a].dropdown=i,n[i]=s.toJSON()))}})),e.entities&&(delete e.entities.styles,delete e.entities.dropdowns,by(e.entities)&&delete e.entities);var a=10*(by(r)?0:1)+(by(n)?0:1);11===a?e.entities=Object.assign({},e.entities,{styles:r,dropdowns:n}):10===a&&(e.entities=Object.assign({},e.entities,{styles:r}))}},{key:"exportToCell",value:function(e,t){var r=this.model.getRefMgr().getById(t);null==e||null==t||null==r||null==r.style&&null==r.dropdown||(e.styleId=t)}}]),t}(D_);function sR(e){if(e)for(var t=0;t<e.length;t++)if(e[t].type===Ce.K6s.EMBED_IMAGE)return e[t];return null}function lR(e,t,r){return kg(e,t,r)?cR(e,t,r):null}function cR(e,t,r){var n,a=e.getVar(t,r),o=null==a?void 0:a.getValue();if((null==o?void 0:o.type)===Ce.K6s.EMBED_IMAGE)return o;var i=null===(n=a.getVar)||void 0===n?void 0:n.call(a);if(i&&RR(i)){var u=i.getValue();return null!=u&&u.link?Object.assign({},u,{type:Ce.K6s.EMBED_IMAGE}):null}return null}function hR(e,t){return e.map((function(e){return function(e,t){if(e.style){var r=function(e,t){var r,n,a,o;"true"===t.bold?r=700:""===t.bold&&(r=400),"true"===t.italic?n="italic":""===t.italic&&(n="normal"),t.fontsize&&(a=om(t.fontsize)),t.fontfamily&&(t.fontfamily,0)&&(o=t.fontfamily);var i=e.clone();i._font=vm.valueOf(a,n,r,o);var u=i._textDecoration||Ce.aBM.none;return"true"===t.underline?u|=Ce.aBM.underline:""===t.underline&&(u&=~Ce.aBM.underline),"true"===t.strikethrough?u|=Ce.aBM.lineThrough:""===t.strikethrough&&(u&=~Ce.aBM.lineThrough),i._textDecoration=u,t.textcolor&&(i._foreColor=t.textcolor),i._wordWrap=0,i}(t.getDefaultStyle(),e.style);e.style=r}if(e.texts){var n=hR(e.texts,t);0!==n.length?e.texts=n:delete e.texts}return e}(e,t)}))}function fR(e,t){var r=sm(t);return e.map((function(e){var n=Object.assign({},e);if(n.style=Object.assign({},r),e.style)for(var a=sm(e.style),o=0;o<Ce.cvC.length;o++){var i=Ce.cvC[o],u=a[i];["textcolor","fontsize","fontfamily"].includes(i)?void 0!==u&&(n.style[i]=u):void 0!==u&&("true"===u?n.style[i]="true":delete n.style[i])}if(n.texts){var s=fR(n.texts,t);0!==s.length?n.texts=s:delete n.texts}return n.style&&0===Object.keys(n.style).length&&delete n.style,n}))}function dR(e){if(!Array.isArray(e))return!1;for(var t=0;t<e.length;t++){var r=e[t];if(r.type!==Ce.K6s.TEXT)return!1;if(null!=r.style||null!=r.styleId)return!1}return!0}function vR(e,t,r,n){return e.length&&gR(e)?pR(e,t,r,n).style:t}function pR(e,t,r,n){e=Og.convertSegmentArrayFromChangeset(r.parent,e);var a,o=new Set,i=[],u=[],l=!1;t=t||r.getDefaultStyle();for(var c=a=n?Om.withUpdateStyle(t,n,r.formatterService):t,h=0;h<e.length;h++){var f=Object.assign({},e[h]);if(f.type!==Ce.K6s.TEXT||"\n"!==f.text){var d=f.style&&f.style.clone&&f.style.clone()||a.clone(),v=Om.withUpdateStyle(d,n,r.formatterService);if(l||d.equals(v)||(l=!0),f.style=v,c=v,f.texts){var p=pR(f.texts,d,r,n),g=p.value,y=p.style,_=p.hasChanged;_&&(l=_),f.style=y,c=v,"string"==typeof g?(delete f.texts,l=!0):(f.texts=g,delete f.style)}var R=Object.assign({},f);delete R.style,u.push(R),i.push(f),f.style?o.add(f.style):o.add(a)}else{f.style=c;f.style;var C=(0,s.Z)(f,dr);u.push(C),i.push(f)}}var w=Om.extractCommonStyle((0,m.Z)(o)),E=w.commonStyle,k=w.hasDifference;E&&(a=Om.withUpdateStyle(a,E,r.formatterService));var T=i;k||(dR(u)?(T=u.reduce((function(e,t){return e+t.text}),""),l=!0):T=u),l||a.equals(t)||(l=!0);var S=[],A=null;if(Array.isArray(T))for(var I=0;I<T.length;I++){var O=T[I];O.type===Ce.K6s.TEXT?null!==A?A.style&&O.style&&A.style.equals(O.style)?A.text=A.text+O.text:(S.push(O),A=O):(A=O,S.push(O)):(A=null,S.push(O))}return{value:S.length?S:T,style:a,hasChanged:l}}function mR(e){for(var t=[],r=0;r<e.length;r++){var n=Object.assign({},e[r]);if(delete n.style,n.texts){var a=mR(n.texts);"string"==typeof a||0===a.length?delete n.texts:n.texts=a}t.push(n)}return dR(t)?t.reduce((function(e,t){return e+t.text}),""):t}function gR(e){for(var t=0;t<e.length;t++){var r=e[t];if(null==r.style){if(Array.isArray(r.texts)&&gR(r.texts))continue;return!1}}return!0}function yR(e){if(e&&e.variant){var t=e.variant.getVar();if(t&&"function"==typeof t.getSpecialInfo){var r,n=null===(r=t.getSpecialInfo())||void 0===r?void 0:r.linkInfo;if(n&&n.link)return[{type:"url",text:null!=t.getValue()?t.getValue().toString():"",link:n.link}]}}return null}function _R(e){if(!e||!e.variant)return null;var t=e.variant.getVar();return RR(t)?[Object.assign({},t.getValue(),{text:""})]:null}function RR(e){return e.isCustomPrimitive()&&"SheetImageVar"===e.customType}var CR,wR,ER,kR,TR,SR,AR=[];function IR(e,t,r){if(function(e,t,r){for(var n=0;n<AR.length;n++)if(AR[n](e,t,r))return!0;return!1}(e,t,r))return!1;var n=e.getSafeValue(t,r);if(Array.isArray(n)&&n.some((function(e){return e.type===Ce.K6s.MENTION})))return!1;var a=e.getValue(t,r);return OR(e,a)}function OR(e,t){if("string"!=typeof t)return!1;var r=function(e,t){try{if((0,Ee.isBigNumber)(t))return 1;var r=(0,Ee.getPreferredFormatter)(e.formatterService,t),n=r.formatter,a=r.value;return(0,ve.default)(a)?1:(0,Ee.isDateTimeFormatter)(n)&&a instanceof we.SheetDate?2:0}catch(e){return 0}}(e,t);return 1===r||2===r}function VR(e){return Ce.O6N.DATA_NOT_READY===e||Ce.O6N.SHEET_AI_TAG_DATABASE_LOADING===e||Ce.O6N.IMPORT_ERR_PEDDING===e||Ce.O6N.IMPORT_ERR_CRAWL_WAITING===e||Ce.O6N.IMPORT_ERR_CRAW_RUNNING===e}AR.push((function(e,t,r){return e.hasMultipleValues(t,r)})),AR.push((function(e,t,r){var n=e.getStyle(t,r);if(!n.formatter)return!1;var a=n.formatter.toJSON();return!!a&&"@"===a.formatCached})),AR.push((function(e,t,r){return e.getPivotTableManager().hasPivotTableAtCell(t,r)})),function(e){e[e.GENERAL=0]="GENERAL",e[e.NUMBER=1]="NUMBER",e[e.DATE=2]="DATE"}(CR||(CR={}));var NR=function(){function e(){(0,y.Z)(this,e),this.table=[]}return(0,_.Z)(e,[{key:"orderedIter",value:function(e,t,r,n){return new MR(this.table,e,t,e+r-1,t+n-1)}},{key:"orderedIterWithPos",value:function(e,t,r,n){var a=function(e,t,r,n,a){return a<=1?new bR(e,t,r,t+n-1,r+a-1):new MR(e,t,r,t+n-1,r+a-1)}(this.table,e,t,r,n);return a.map((function(e){return[e,a.position()]}))}},{key:"iterWithPos",value:function(e,t,r,n){var a=this.iter(e,t,r,n);return a.map((function(e){return[e,a.position()]}))}},{key:"addRow",value:function(e,t,r){if(0!==t){var n=new Array(t);this.table.forEach((function(t){t&&t.length>e&&((0,Ce.b$t)(t,e,0,n),t.length=Math.min(t.length,r))}))}}},{key:"delRow",value:function(e,t,r){0!==t&&this.table.forEach((function(n){n&&n.length>e&&(n.length<=e+t?n.length=e:n.splice(e,t),r>=0&&(n.length=Math.min(n.length,r)))}))}},{key:"addCol",value:function(e,t){this.isEmpty()||(0,Ce.b$t)(this.table,e,0,new Array(t))}},{key:"delCol",value:function(e,t){e>=this.table.length||0===t||(t<this.table.length-e?this.table.splice(e,t):this.table.length=e)}},{key:"iter",value:function(e,t,r,n){return new bR(this.table,e,t,e+r-1,t+n-1)}},{key:"getImporter",value:function(){return null}},{key:"getExporter",value:function(e,t,r,n){return null}},{key:"isEmpty",value:function(){return 0===this.table.length}},{key:"set",value:function(e,t,r){e<0||t<0||(this.table[t]||(this.table[t]=[]),this.table[t][e]=r)}},{key:"get",value:function(e,t){var r=this.table[t];if(null==r)return null;var n=r[e];return void 0===n?null:n}},{key:"clear",value:function(e,t,r,n){for(var a=r+e,o=Math.min(n+t,this.table.length),i=t;i<o;i++)if(this.table[i]&&!(this.table[i].length<e))if(this.table[i].length<e+r)this.table[i].length=e;else for(var u=e;u<a;u++)this.table[i][u]=null}},{key:"clearRow",value:function(e,t){var r=e+t-1;this.table.forEach((function(t){if(t&&t.length>e)if(t.length<r)t.length=e;else for(var n=e;n<=r;n++)t[n]=null}))}},{key:"clearCol",value:function(e,t){for(var r=Math.min(t+e,this.table.length);e<r;)this.table[e]=null,e++}},{key:"swapRow",value:function(e,t){this.table.forEach((function(r){if(r&&!(r.length<=Math.min(e,t))){var n=r[e];r[e]=r[t],r[t]=n}}))}},{key:"swapCol",value:function(e,t){var r=this.table[e];this.table[e]=this.table[t],this.table[t]=r}},{key:"swapCell",value:function(e,t,r,n){var a=this.get(e,t),o=this.get(r,n);this.set(e,t,o),this.set(r,n,a)}},{key:"reset",value:function(){this.table=[]}},{key:"getRowLength",value:function(e){var t=this.table[e];return t?t.length:0}}]),e}();var bR=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this))).table=e,i.rowFrom=r,i.rowTo=a,i.colTo=o,i.isDone=!1,i.colTo=Math.min(o,e.length-1),i.cellPosition={row:r-1,col:n},i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"next",value:function(){for(;this.isValid();){if(this.cellPosition.row++,(!this.table[this.cellPosition.col]||this.cellPosition.row>=this.table[this.cellPosition.col].length||this.cellPosition.row>this.rowTo)&&!this.nextCol())return this.isDone=!0,null;var e=this.table[this.cellPosition.col];if(null==e)return null;var t=e[this.cellPosition.row];if(null!=t)return t}return this.isDone=!0,null}},{key:"isValid",value:function(){return this.cellPosition.col<=this.colTo}},{key:"value",value:function(){if(this.isDone)return null;var e=this.table[this.cellPosition.col]&&this.table[this.cellPosition.col][this.cellPosition.row];return null==e?null:e}},{key:"nextCol",value:function(){do{this.cellPosition.col++}while(!this.table[this.cellPosition.col]&&this.colTo>=this.cellPosition.col);return this.cellPosition.row=this.rowFrom,this.colTo>=this.cellPosition.col}},{key:"position",value:function(){return this.cellPosition}}]),t}(_t.FIterator),MR=function(e){function t(e,r,n,a,o){var i;(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this))).table=e,i.colFrom=n,i.rowTo=a,i.colTo=o,i.validCols=new Set,i.isDone=!1,i.colTo=Math.min(o,e.length-1),i.cellPosition={row:r,col:n};for(var u=i.colFrom;u<=i.colTo;u++)i.table[u]&&i.validCols.add(u);return i.colIter=i.validCols.values(),i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"next",value:function(){for(;this.isValid();){for(var e=void 0,t=null;null==t;){var r=this.colIter.next();if(e=r.value,r.done)break;this.cellPosition.col=e,this.cellPosition.row>=this.table[e].length?this.validCols.delete(e):t=this.table[e][this.cellPosition.row]}if(null!=t)return t;this.cellPosition.row++,this.colIter=this.validCols.values()}return this.isDone=!0,null}},{key:"isValid",value:function(){return this.cellPosition.row<=this.rowTo}},{key:"value",value:function(){if(this.isDone)return null;var e=this.table[this.cellPosition.col]&&this.table[this.cellPosition.col][this.cellPosition.row];return null==e?null:e}},{key:"position",value:function(){return this.cellPosition}}]),t}(_t.FIterator);function FR(e){return{get numFmt(){var t=xR(e.formatter);return void 0!==t?{formatCode:t}:void 0},get autoNumFmt(){var t=xR(e.autoFormatter);return void 0!==t?{formatCode:t}:void 0},get font(){var t=e.rawFont,r=e.foreColor,n=e.textDecoration,a={name:null==t?void 0:t.fontFamily,bold:void 0!==(null==t?void 0:t.fontWeight)?t.fontWeight>=700:void 0,italic:void 0!==(null==t?void 0:t.fontStyle)?["italic","oblique"].includes(t.fontStyle):void 0,strike:void 0!==n?!!(n&wt.TextDecoration.Mid):void 0,underline:void 0!==n?!!(n&wt.TextDecoration.Bottom):void 0,color:void 0!==r?{rgb:r}:void 0,size:null==t?void 0:t.fontSize};if(void 0!==a.name||void 0!==a.bold||void 0!==a.italic||void 0!==a.strike||void 0!==a.underline||void 0!==a.color||void 0!==a.size)return a},get fill(){return void 0!==e.backColor?{color:{rgb:e.backColor}}:void 0},get border(){var t=e.borderBottom,r=e.borderLeft,n=e.borderRight,a=e.borderTop,o=e.diagonal,i=e.diagonalUp,u=e.diagonalDown,s={left:DR(r),right:DR(n),top:DR(a),bottom:DR(t),diagonal:DR(o),diagonalUp:i,diagonalDown:u};if(void 0!==s.left||void 0!==s.right||void 0!==s.top||void 0!==s.bottom||void 0!==s.diagonal||void 0!==s.diagonalUp||void 0!==s.diagonalDown)return s},get alignment(){var t=e.wordWrap,r=e.hAlign,n=e.vAlign,a={horizontal:$R(r),vertical:BR(n),textRotation:e.textRotation,wrapText:HR(t)};if(void 0!==a.horizontal||void 0!==a.vertical||void 0!==a.wrapText||void 0!==a.textRotation)return a},get otherFmt(){return void 0!==e._hideLink?{hideLink:e._hideLink}:void 0}}}function ZR(e){var t,r,n,a=e.numFmt,o=e.autoNumFmt,i=e.font,u=e.fill,s=e.border,l=e.alignment,c=e.otherFmt;void 0===(null==i?void 0:i.strike)&&void 0===(null==i?void 0:i.underline)||(n=Ce.aBM.none,null!=i&&i.strike&&(n|=Ce.aBM.lineThrough),(null==i?void 0:i.underline)&&(n|=Ce.aBM.underline));var h=i?function(e){var t=!1,r={};return e.size&&(r.fontSize=e.size,t=!0),e.name&&(r.fontFamily=e.name,t=!0),e.italic&&(r.fontStyle="italic",t=!0),e.bold&&(r.fontWeight=wt.FontWeight.bold,t=!0),t?r:void 0}(i):void 0;return{backColor:null==u||null===(t=u.color)||void 0===t?void 0:t.rgb,foreColor:null==i||null===(r=i.color)||void 0===r?void 0:r.rgb,fontInfo:h,vAlign:UR(null==l?void 0:l.vertical),hAlign:LR(null==l?void 0:l.horizontal),textDecoration:n,wordWrap:zR(null==l?void 0:l.wrapText),formatter:void 0!==(null==a?void 0:a.formatCode)?{formatCached:a.formatCode}:void 0,autoFormatter:void 0!==(null==o?void 0:o.formatCode)?{formatCached:o.formatCode}:void 0,borderLeft:PR(null==s?void 0:s.left),borderTop:PR(null==s?void 0:s.top),borderRight:PR(null==s?void 0:s.right),borderBottom:PR(null==s?void 0:s.bottom),diagonal:PR(null==s?void 0:s.diagonal),diagonalUp:null==s?void 0:s.diagonalUp,diagonalDown:null==s?void 0:s.diagonalDown,textRotation:null==l?void 0:l.textRotation,hideLink:null==c?void 0:c.hideLink}}function xR(e){var t;if(e)return e instanceof Ee.Formatter?(null!==(t=e.toJSON())&&void 0!==t?t:{formatCached:"General"}).formatCached:null==e?void 0:e.formatCached}function DR(e){if(e&&(e.color||e.lineStyle))return{color:{rgb:e.color},style:e.lineStyle}}function PR(e){var t,r;if(e&&(e.color||e.style))return{color:null!==(t=null===(r=e.color)||void 0===r?void 0:r.rgb)&&void 0!==t?t:"",lineStyle:e.style,width:1}}function $R(e){switch(e){case Ce.KqL.Left:return Ce.B2l.HorizontalAlignment.HorizontalAlignment_left;case Ce.KqL.Right:return Ce.B2l.HorizontalAlignment.HorizontalAlignment_right;case Ce.KqL.Center:return Ce.B2l.HorizontalAlignment.HorizontalAlignment_center;default:return}}function LR(e){switch(e){case Ce.B2l.HorizontalAlignment.HorizontalAlignment_left:return Ce.KqL.Left;case Ce.B2l.HorizontalAlignment.HorizontalAlignment_right:return Ce.KqL.Right;case Ce.B2l.HorizontalAlignment.HorizontalAlignment_center:return Ce.KqL.Center;default:return}}function BR(e){switch(e){case Ce.g$I.Top:return Ce.B2l.VerticalAlignment.VerticalAlignment_top;case Ce.g$I.Bottom:return Ce.B2l.VerticalAlignment.VerticalAlignment_bottom;case Ce.g$I.Center:return Ce.B2l.VerticalAlignment.VerticalAlignment_center;default:return}}function UR(e){switch(e){case Ce.B2l.VerticalAlignment.VerticalAlignment_top:return Ce.g$I.Top;case Ce.B2l.VerticalAlignment.VerticalAlignment_bottom:return Ce.g$I.Bottom;case Ce.B2l.VerticalAlignment.VerticalAlignment_center:return Ce.g$I.Center;default:return}}function HR(e){switch(e){case 0:return Ce.B2l.WrapTextType.WrapTextType_OVERFLOW;case 1:return Ce.B2l.WrapTextType.WrapTextType_AUTOWRAP;case 2:return Ce.B2l.WrapTextType.WrapTextType_WORDCLIP;default:return}}function zR(e){switch(e){case Ce.B2l.WrapTextType.WrapTextType_OVERFLOW:return 0;case Ce.B2l.WrapTextType.WrapTextType_AUTOWRAP:return 1;case Ce.B2l.WrapTextType.WrapTextType_WORDCLIP:return 2;default:return}}function WR(e){if(e){var t=e.themeType===Ce.fW_.pro?Ce.B2l.SparklineThemeType.SparklineThemeType_PRO:e.themeType;return Object.assign({},e,{themeType:t})}}function GR(e,t,r){return"".concat(e?e.join():"",":").concat(t?t.join():"",":").concat(r||"")}!function(e){e.Number="D",e.String="S",e.Bool="B",e.Null="N",e.Error="E",e.Ref="R",e.Matrix="M",e.Operator="O",e.Func="F",e.Param="P"}(wR||(wR={})),function(e){e.BinaryOp="B",e.SuffixUnary="S",e.PrefixUnary="P",e.Paren="G",e.InvokeFunctionOp="I"}(ER||(ER={})),function(e){e.Constant="C",e.Reference="R",e.Param="P"}(kR||(kR={})),function(e){e[e.Array=1]="Array"}(TR||(TR={})),function(e){e[e.hasSubtotal=1]="hasSubtotal",e[e.hasAggregate=2]="hasAggregate",e[e.hasArrayFunction=4]="hasArrayFunction"}(SR||(SR={}));var jR={enumerable:!1,writable:!0,configurable:!0};function YR(e,t){Object.defineProperty(e,0,jR),e[0]=t}var qR=function(){function e(t){var r,n,a,o,i,u,s,l=this,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},h=arguments.length>2?arguments[2]:void 0,f=arguments.length>3&&void 0!==arguments[3]&&arguments[3];(0,y.Z)(this,e),this.alwaysCalcOp=h,this.enableCalculation=f,this.tokens=null,this.serialization=null,this.expression=null,this.importRangeMeta=null,this.externalDataReferenceInfo=null,this.status=0,this.tokens=null!==(r=t.tokens)&&void 0!==r?r:null,this.serialization=null!==(n=t.serialization)&&void 0!==n?n:null,this.expression=null!==(a=t.expression)&&void 0!==a?a:null,this.params=null!==(o=t.params)&&void 0!==o?o:null,this.importRangeId=null!==(i=t.importRangeId)&&void 0!==i?i:null,this.importRangeMeta=null!==(u=t.importRangeMeta)&&void 0!==u?u:null,this.externalDataReferenceInfo=null!==(s=t.externalDataReferenceInfo)&&void 0!==s?s:null,Object.entries(c).forEach((function(e){var t=(0,g.Z)(e,2),r=t[0],n=t[1],a=SR[r];n&&(l.status=l.status|a)}))}return(0,_.Z)(e,[{key:"hash",value:function(){return this.key||(this.key=GR(this.tokens,this.params,this.importRangeId))}},{key:"getStatus",value:function(e){return Boolean(this.status&e)}},{key:"getAlwaysCalcOp",value:function(){return this.alwaysCalcOp}},{key:"getHashObject",value:function(){var e,t;return{tokens:this.tokens,params:this.params,importRangeId:null!==(e=null===(t=this.importRangeMeta)||void 0===t?void 0:t.importRangeId)&&void 0!==e?e:this.importRangeId}}},{key:"hasSubtotal",get:function(){return this.getStatus(SR.hasSubtotal)}},{key:"hasAggregate",get:function(){return this.getStatus(SR.hasAggregate)}},{key:"hasArrayFunction",get:function(){return this.getStatus(SR.hasArrayFunction)}}]),e}(),JR=function(){function e(){(0,y.Z)(this,e),this.pool={}}return(0,_.Z)(e,[{key:"save",value:function(e,t){this.pool[e]=t}},{key:"get",value:function(e){return this.pool[e]||null}},{key:"add",value:function(e){var t=this.getHash(e);return this.pool[t]||(this.save(t,e),e)}},{key:"clear",value:function(){this.pool={}}}]),e}(),KR=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this))).formulaRefManager=e,n.refMapRefManager=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"add",value:function(e){return this.formulaRefManager.add(e.formula),e.refMap&&this.refMapRefManager.add(e.refMap),(0,f.Z)((0,v.Z)(t.prototype),"add",this).call(this,e)}},{key:"save",value:function(e,r){YR(r,e),(0,f.Z)((0,v.Z)(t.prototype),"save",this).call(this,e,r)}},{key:"updateRefMap",value:function(e,t){var r=this.getHash(e,!1),n=e.refMap;if(n){var a=this.refMapRefManager.getHash(n),o=t(n);o&&this.refMapRefManager.updateRefMapHash(a,o);var i=this.getHash(e,!1);return r!==i&&(this.pool[r]=void 0,this.save(i,e)),o}}},{key:"equals",value:function(e,t){return e.formula===t.formula&&e.refMap===t.refMap||this.getHash(e)===this.getHash(t)}},{key:"getHash",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e[0];if(t&&r)return r;var n=e.formula,a=e.refMap;return this.formulaRefManager.getHash(n)+(a?this.refMapRefManager.getHash(a):"")}}]),t}(JR),XR=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"equals",value:function(e,t){return e===t||this.getHash(e)===this.getHash(t)}},{key:"getHash",value:function(e){return e.hash()}},{key:"getByVal",value:function(e){var t=GR(e.tokens,e.params,e.importRangeId);return this.get(t)}}]),t}(JR),QR=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).relativeCache={},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"onRangeChange",value:function(e){var t=e.hash(!0);this.relativeCache[t]&&(this.relativeCache[t]=void 0)}},{key:"updateRefMapHash",value:function(e,t){var r=this.get(e);if(r&&r===t){var n=this.getHash(t,!1);n!==e&&(this.pool[e]=void 0,this.save(n,t))}}},{key:"getHash",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=e[0];return t&&r?r:this.calcRefMapHash(e)}},{key:"save",value:function(e,r){YR(r,e),(0,f.Z)((0,v.Z)(t.prototype),"save",this).call(this,e,r)}},{key:"equals",value:function(e,t){return this.getHash(e)===this.getHash(t)}},{key:"calcRefMapHash",value:function(e){var t=Object.keys(e);t.length>1&&t.sort();for(var r=0,n=t.length;r<n;r++){var a=t[r],o=e[a],i=o.hash(!0,!0);this.relativeCache[i]||(this.relativeCache[i]=o),t[r]=a+i+";"}return t.join()}}]),t}(JR),eC=[it.ErrorType.RUNTIME_ERROR],tC=it.VAR_TYPE.NUMBER,rC=it.VAR_TYPE.STRING,nC=it.VAR_TYPE.BOOL,aC=it.VAR_TYPE.ERROR,oC=Ce.B2l.CellValueType.CellValueType_Number,iC=Ce.B2l.CellValueType.CellValueType_String,uC=Ce.B2l.CellValueType.CellValueType_Bool,sC=Ce.B2l.CellValueType.CellValueType_Error,lC=Ce.B2l.CellValueType.CellValueType_EmbedImage,cC=Ce.B2l.CellValueType.CellValueType_RichString,hC=Ce.B2l.CellValueType.CellValueType_Formula,fC=function(){function e(t,r,n){(0,y.Z)(this,e),this._segmentArray=t,this._variant=r,this._multipleValues=n,Object.freeze(this),Object.freeze(this._segmentArray)}return(0,_.Z)(e,[{key:"hasContent",value:function(){return!!(this._segmentArray||this._variant||this._multipleValues)}},{key:"segmentArray",get:function(){return this._segmentArray}},{key:"variant",get:function(){return this._variant}},{key:"multipleValues",get:function(){return this._multipleValues}},{key:"formulaVar",get:function(){return null!=this._variant&&this._variant.isFormula()?this._variant:null}}]),e}();function dC(e){return null==e}function vC(e){return!!e&&e instanceof Up}function pC(e){return!!e&&e instanceof Gp}function mC(e){var t=r.g;return t&&t.window.isNotBrowser?e:Ce.Ps3.replaceImageDataSrc(e)}function gC(e){var t=r.g;t&&t.window.isNotBrowser||Ce.Ps3.collectSuiteEvent("sheet_drive_dirty_data",{driveToken:Ce.Ps3.encryptTea(e)})}function yC(e){if(!e)return"";var t=e.match(/\/box\/stream\/download(\/v2)?\/(all|cover)\/([A-Za-z0-9]*)/);return t&&t[t.length-1]?t[t.length-1]:""}function _C(e,t){e&&e.isFormula()&&(t.unRegisterFml(e),vC(e)&&e.dispose())}function RC(e,t,r,n,a,o){var i,u=e.parent.importRangeManager;if(pC(n)&&null!==(i=n.formula.getExpandRef())&&void 0!==i&&i.containCell(t,r))return null;if(n.type&it.VAR_TYPE.BASIC){var s=e._dataModel.getVarByContent(a,t,r);if(null!=s&&pC(s)&&s.hasCache()&&s.getValue()===n.getValue()&&s.isInCorrectPosition(t,r))return null}else if(n.isFormula()){if(dv(n)&&n.getExternalDataReferenceInfo()){var l=u.getMetaFromFormula(n);if(null==l)return console.error("meta is not found"),null;if(u.isImportRangeNumExceedLimitWithRangeCache([l]))return Ce.Ps3.Toast.error({key:"crossTableError_num",closable:!0,content:cr("CreationDoc_Sheets_ImportrangeToLimit",Ce.Ps3.getSheetImportRangeCountLimit())}),null;u.setImportRangeFormula(n,l)}o.registerFml(n),vC(n)&&e.parent.setWorkbookHasArrayFormula(!0)}return n}var CC=function(){function e(t){(0,y.Z)(this,e),this.sheet=t,this.mention=new eR,this.image=new eR,this.attachment=new eR,this.style=new rR,this.dataModel=new NR,this.setRefCounterState()}return(0,_.Z)(e,[{key:"isEmpty",value:function(){return this.dataModel.isEmpty()}},{key:"iter",value:function(e,t,r,n){return this.dataModel.iter(e,t,r,n)}},{key:"set",value:function(e,t,r){this.dataModel.set(e,t,r)}},{key:"addRow",value:function(e,t,r){this.dataModel.addRow(e,t,r)}},{key:"delRow",value:function(e,t,r){0!==t&&(this.clear(e,0,t,this.sheet.getColumnCount()),this.dataModel.delRow(e,t,r))}},{key:"addCol",value:function(e,t){this.dataModel.addCol(e,t)}},{key:"delCol",value:function(e,t){0!==t&&(this.clear(0,e,this.sheet.getRowCount(),t),this.dataModel.delCol(e,t))}},{key:"swapRow",value:function(e,t){this.dataModel.swapRow(e,t)}},{key:"swapCol",value:function(e,t){this.dataModel.swapCol(e,t)}},{key:"swapCell",value:function(e,t,r,n){this.dataModel.swapCell(e,t,r,n)}},{key:"orderedIter",value:function(e,t,r,n){return this.dataModel.orderedIter(e,t,r,n)}},{key:"orderedIterWithPos",value:function(e,t,r,n){return this.dataModel.orderedIterWithPos(e,t,r,n)}},{key:"iterWithPos",value:function(e,t,r,n){return this.dataModel.iterWithPos(e,t,r,n)}},{key:"getRowLength",value:function(e){return this.dataModel.getRowLength(e)}},{key:"getSerializer",value:function(e,t,r,n){return new SC(this.sheet,{mention:this.mention,image:this.image,style:this.style,attachment:this.attachment},this,e,t,r,n)}},{key:"getExporter",value:function(e,t,r,n){return new AC(this.sheet,{mention:this.mention,image:this.image,style:this.style,attachment:this.attachment},this,e,t,r,n)}},{key:"getImporter",value:function(){return new IC(this.sheet,{mention:this.mention,image:this.image,style:this.style,attachment:this.attachment},this)}},{key:"setRefCounterState",value:function(){var e=this.sheet.isRefCountValid();this.mention.setUseRefCounter(e),this.image.setUseRefCounter(e),this.attachment.setUseRefCounter(e),this.style.setUseRefCounter(e)}},{key:"getSegmentArray",value:function(e,t,r){var n=this.getImmutableNode(e,t,r);return n&&!dC(n.segmentArray)?n.segmentArray.map((function(e){return Object.assign({},e)})):null}},{key:"getImmutableSegmentArray",value:function(e,t,r){var n=this.getImmutableNode(e,t,r);return n&&!dC(n.segmentArray)?n.segmentArray:null}},{key:"get",value:function(e,t,r){return this.getImmutableNode(e,t,r)}},{key:"getImmutableNode",value:function(e,t,r){var n=this.sheet.getPivotTableManager(),a=n.getPivotTableNameByCell(e,t);if(r||!a)return this.dataModel.get(e,t);var o=Ky(n.getCellValue(e,t))||it.NULL_VAR,i=this.sheet.getCalcEngine().pivotCalculateEngine.getFormula(a);return new fC(null,new lo(e,t,o,a,i),null)}},{key:"hasContent",value:function(e,t,r){var n=this.sheet.getPivotTableManager().getPivotTableNameByCell(e,t);if(r||!n){var a=this.dataModel.get(e,t);return!(!a||!(a.variant&&!a.variant.isNull()||a.segmentArray&&a.segmentArray.length>0||a.multipleValues&&a.multipleValues.length>0))}return!0}},{key:"getVar",value:function(e,t,r){if(!r){var n=this.sheet.getPivotTableManager(),a=n.getPivotTableNameByCell(e,t);if(a){var o=Ky(n.getCellValue(e,t))||it.NULL_VAR,i=this.sheet.getCalcEngine().pivotCalculateEngine.getFormula(a);return new lo(e,t,o,a,i)}}var u=this.dataModel.get(e,t);return u?u.variant:null}},{key:"setSegmentArray",value:function(e,t,r){var n=this.dataModel.get(e,t);if(this.clearCellRef(e,t),null==r){if(!n)return;this.set(e,t,new fC(null,n.variant,n.multipleValues))}else n?this.set(e,t,new fC(this.segmentArrayToRef(r),n.variant,n.multipleValues)):this.set(e,t,new fC(this.segmentArrayToRef(r),null,null))}},{key:"getMultipleValues",value:function(e,t){var r=this.dataModel.get(e,t);return r&&null!=r.multipleValues?r.multipleValues:null}},{key:"setMultipleValues",value:function(e,t,r){var n=this.dataModel.get(e,t);if(null==r){if(!n)return;void 0!==n.variant&&null!==n.variant||void 0!==n.segmentArray&&null!==n.segmentArray?this.set(e,t,new fC(n.segmentArray,n.variant,null)):this.clear(e,t,1,1)}else{for(var a=0;a<r.length;a++){var o=r.get(a);o.segmentArray&&r.set(a,Object.assign({},o,{segmentArray:this.segmentArrayToRef(o.segmentArray)}))}n?this.set(e,t,new fC(n.segmentArray,n.variant,r)):this.set(e,t,new fC(null,null,r))}}},{key:"setVariant",value:function(e,t,r,n){void 0===n&&(n=this.dataModel.get(e,t)),n?null==n.segmentArray&&null==n.multipleValues&&null==r?this.clear(e,t,1,1):this.set(e,t,new fC(n.segmentArray,r,n.multipleValues)):r&&this.set(e,t,new fC(null,r,null))}},{key:"setNodeValue",value:function(e,t,r){if(this.clearCellRef(e,t),r){var n=r.multipleValues,a=r.segmentArray,o=r.variant;if(n||a||o){if(n)for(var i=0;i<n.length;i++){var u=n.get(i);u.segmentArray&&n.set(i,Object.assign({},u,{segmentArray:this.segmentArrayToRef(u.segmentArray)}))}null!==a?this.set(e,t,new fC(this.segmentArrayToRef(a),o,n)):this.set(e,t,new fC(null,o,n))}else this.clear(e,t,1,1)}else this.clear(e,t,1,1)}},{key:"clearCellRef",value:function(e,t){var r=this,n=this.getImmutableNode(e,t);if(n){this.clearSegmentArrayCount(n.segmentArray);var a=n.multipleValues;a&&a.forEach((function(e){e&&e.segmentArray&&r.clearSegmentArrayCount(e.segmentArray)}))}}},{key:"clearSegmentArrayCount",value:function(e){var t=this;e&&e.map((function(e){if(e.type){switch(e.type){case"mention":if(!t.mention.getUseRefCounter())break;t.mention.decRefCounter(e)||console.warn("mention decRefCounter failed");break;case"embed-image":if(!t.image.getUseRefCounter())break;t.image.decRefCounter(e)||console.warn("image decRefCounter failed");break;case"attachment":if(!t.attachment.getUseRefCounter())break;t.attachment.decRefCounter(e)}e.style&&t.style.decRefCounter(e.style),e.texts&&t.clearSegmentArrayCount(e.texts)}}))}},{key:"clear",value:function(e,t,r,n){for(var a=this.iter(e,t,r,n);a.next();){var o=a.position();this.clearCellRef(o.row,o.col)}this.dataModel.clear(e,t,r,n)}},{key:"segmentArrayToRef",value:function(e){var t=this;return e.map((function(e){var r=e=Object.assign({},e);switch(r.styleId&&delete r.styleId,e.style&&(e.style instanceof Om||(e.style=Om.fromJSON(t.sheet.parent.formatterService,e.style)),e.style=t.style.add(e.style).ref),e.texts&&(e.texts=t.segmentArrayToRef(e.texts)),e.type){case Ce.K6s.MENTION:r=t.mention.add(e).ref;break;case Ce.K6s.EMBED_IMAGE:e.link=mC(e.link),r=t.image.add(e).ref;break;case Ce.K6s.ATTACHMENT:r=t.attachment.add(e).ref}return r}))}}]),e}(),wC=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).variantModel=new NR,e.segmentModel=new NR,e.multiValModel=new NR,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"isEmpty",value:function(){return this.variantModel.isEmpty()&&this.segmentModel.isEmpty()&&this.multiValModel.isEmpty()}},{key:"iter",value:function(e,t,r,n){return new kC([this.variantModel.iter(e,t,r,n),this.segmentModel.iter(e,t,r,n),this.multiValModel.iter(e,t,r,n)])}},{key:"set",value:function(e,t,r){r?(this.setVariant(e,t,r.variant),r.segmentArray?this.segmentModel.set(e,t,Object.freeze(r.segmentArray)):this.segmentModel.clear(e,t,1,1),r.multipleValues?this.multiValModel.set(e,t,r.multipleValues):this.multiValModel.clear(e,t,1,1)):this.clear(e,t,1,1)}},{key:"addRow",value:function(e,t,r){this.variantModel.addRow(e,t,r),this.segmentModel.addRow(e,t,r),this.multiValModel.addRow(e,t,r)}},{key:"delRow",value:function(e,t,r){0!==t&&(this.clear(e,0,t,this.sheet.getColumnCount()),this.variantModel.delRow(e,t,r),this.segmentModel.delRow(e,t,r),this.multiValModel.delRow(e,t,r))}},{key:"addCol",value:function(e,t){this.variantModel.addCol(e,t),this.segmentModel.addCol(e,t),this.multiValModel.addCol(e,t)}},{key:"delCol",value:function(e,t){0!==t&&(this.clear(0,e,this.sheet.getRowCount(),t),this.variantModel.delCol(e,t),this.segmentModel.delCol(e,t),this.multiValModel.delCol(e,t))}},{key:"swapRow",value:function(e,t){this.variantModel.swapRow(e,t),this.segmentModel.swapRow(e,t),this.multiValModel.swapRow(e,t)}},{key:"swapCol",value:function(e,t){this.variantModel.swapCol(e,t),this.segmentModel.swapCol(e,t),this.multiValModel.swapCol(e,t)}},{key:"swapCell",value:function(e,t,r,n){this.variantModel.swapCell(e,t,r,n),this.segmentModel.swapCell(e,t,r,n),this.multiValModel.swapCell(e,t,r,n)}},{key:"orderedIter",value:function(e,t,r,n){return new TC([this.variantModel.orderedIter(e,t,r,n),this.segmentModel.orderedIter(e,t,r,n),this.multiValModel.orderedIter(e,t,r,n)])}},{key:"orderedIterWithPos",value:function(e,t,r,n){var a=this.orderedIter(e,t,r,n);return a.map((function(e){return[e,a.position()]}))}},{key:"iterWithPos",value:function(e,t,r,n){var a=this.iter(e,t,r,n);return a.map((function(e){return[e,a.position()]}))}},{key:"getRowLength",value:function(e){return Math.max(this.variantModel.getRowLength(e),this.segmentModel.getRowLength(e),this.multiValModel.getRowLength(e))}},{key:"getSegmentArray",value:function(e,t,r){var n=this.segmentModel.get(e,t);if(n){for(var a=new Array(n.length),o=0;o<n.length;o++)a[o]=Object.assign({},n[o]);return a}return null}},{key:"getImmutableSegmentArray",value:function(e,t,r){return this.segmentModel.get(e,t)}},{key:"getImmutableNode",value:function(e,t,r){var n=this.sheet.getPivotTableManager(),a=n.getPivotTableNameByCell(e,t);if(r||!a){var o=this.variantModel.get(e,t),i=this.segmentModel.get(e,t),u=this.multiValModel.get(e,t);return o||i||u?new fC(i,o,u):null}var s=Ky(n.getCellValue(e,t))||it.NULL_VAR,l=this.sheet.getCalcEngine().pivotCalculateEngine.getFormula(a);return new fC(null,new lo(e,t,s,a,l),null)}},{key:"hasContent",value:function(e,t,r){var n=this.sheet.getPivotTableManager().getPivotTableNameByCell(e,t);if(r||!n){var a=this.variantModel.get(e,t),o=this.segmentModel.get(e,t),i=this.multiValModel.get(e,t);return!!(a&&!a.isNull()||o&&o.length>0||i&&i.length>0)}return!0}},{key:"getVar",value:function(e,t,r){if(r)return this.variantModel.get(e,t);var n=this.sheet.getPivotTableManager(),a=n.getPivotTableNameByCell(e,t);if(a){var o=Ky(n.getCellValue(e,t))||it.NULL_VAR,i=this.sheet.getCalcEngine().pivotCalculateEngine.getFormula(a);return new lo(e,t,o,a,i)}return this.variantModel.get(e,t)}},{key:"setSegmentArray",value:function(e,t,r){if(this.clearCellRef(e,t),r){var n=Object.freeze(this.segmentArrayToRef(r));this.segmentModel.set(e,t,n)}else this.segmentModel.clear(e,t,1,1)}},{key:"getMultipleValues",value:function(e,t){return this.multiValModel.get(e,t)}},{key:"setMultipleValues",value:function(e,t,r){if(r){for(var n=0;n<r.length;n++){var a=r.get(n);a.segmentArray&&r.set(n,Object.assign({},a,{segmentArray:this.segmentArrayToRef(a.segmentArray)}))}this.multiValModel.set(e,t,r)}else this.multiValModel.clear(e,t,1,1)}},{key:"setVariant",value:function(e,t,r){r?this.variantModel.set(e,t,r):this.variantModel.clear(e,t,1,1)}},{key:"setNodeValue",value:function(e,t,r){this.clearCellRef(e,t),r&&(r.variant||r.segmentArray||r.multipleValues)?(this.setVariant(e,t,r.variant),this.setSegmentArray(e,t,r.segmentArray),this.setMultipleValues(e,t,r.multipleValues)):this.clear(e,t,1,1)}},{key:"clearCellRef",value:function(e,t){var r=this,n=this.getImmutableSegmentArray(e,t);n&&this.clearSegmentArrayCount(n);var a=this.getMultipleValues(e,t);a&&a.forEach((function(e){e&&e.segmentArray&&r.clearSegmentArrayCount(e.segmentArray)}))}},{key:"clear",value:function(e,t,r,n){for(var a=this.iter(e,t,r,n);a.next();){var o=a.position();this.clearCellRef(o.row,o.col)}this.variantModel.clear(e,t,r,n),this.segmentModel.clear(e,t,r,n),this.multiValModel.clear(e,t,r,n)}}]),t}(CC),EC=function(e){function t(e){var r;(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this)))._iters=e,r._done=0;var n=e[0].position();return r._pos={row:n.row,col:n.col},r._val=new Array(e.length).fill(null),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"position",value:function(){return this._pos}},{key:"next",value:function(){for(var e,t,r=this._iters,n=this._val,a=this._done,o=this._pos,i=0;i<r.length;++i)if(!(a&1<<i)){var u=r[i];if(this.cmp(o,u.position())>=0){var s=u.next();if(n[i]=s,null===s){a|=1<<i;var l=u.position();(!t||this.cmp(t,l)<0)&&(t=l);continue}}var c=u.position();if(e){var h=this.cmp(e,c);if(h<0)n[i]=null;else{if(h>0){e=c;for(var f=0;f<i;++f)n[f]=null}null===n[i]&&(n[i]=u.value())}}else e=c,null===n[i]&&(n[i]=u.value())}if(e?(o.row=e.row,o.col=e.col):t&&(o.row=t.row,o.col=t.col),this._done=a,null===n[0]&&null===n[1]&&null===n[2])return null;for(var d=new fC(n[1],n[0],n[2]),v=0;v<n.length;++v)n[v]=null;return d}},{key:"value",value:function(){var e=this._iters,t=this.position(),r=0===this.cmp(t,e[0].position())?e[0].value():null,n=0===this.cmp(t,e[1].position())?e[1].value():null,a=0===this.cmp(t,e[2].position())?e[2].value():null;return null===r&&null===n&&null===a?null:new fC(n,r,a)}},{key:"cellPosition",get:function(){return this._pos}}]),t}(_t.FIterator),kC=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"cmp",value:function(e,t){return e.col-t.col||e.row-t.row}}]),t}(EC),TC=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"cmp",value:function(e,t){return e.row-t.row||e.col-t.col}}]),t}(EC),SC=function(e){function t(e,r,n,a,o,i,u){var s;return(0,y.Z)(this,t),(s=(0,d.Z)(this,(0,v.Z)(t).call(this,n,a,o,i,u))).sheet=e,s.refMgrOptions=r,s}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"isIgnoreCellNode",value:function(e,t){return!t.isForShortcut&&pC(e.variant)}},{key:"serializeCell",value:function(e,t,r){var n=this;if(!this.isIgnoreCellNode(t,r)){var a=t.segmentArray,o=t.variant,i=t.multipleValues,u=e,s=r.cellValueRefHelper,l=r.cellFormatRefHelper;if(a){var c=a[0];(null==c?void 0:c.type)===Ce.K6s.EMBED_IMAGE?this.serializeEmbedImage(c,u,r):(u.valueType=cC,u.valueId=this.serializeSegmentArray(a,r))}else if(o)if(o.isFormula())r.isForShortcut?this.serializeFormulaForShortcut(o,u,r):this.serializeFormula(o,u,r);else if(r.isForShortcut&&pC(o))this.serializeFormulaForShortcut(o,u,r);else if(r.isForShortcut&&co(o)){var h=this.sheet.getPivotTableManager().getPivotInfoByName(o.blockToken);if(h&&h.errorState!==Pp.None){var f=h.errorState===Pp.ServiceCalcLoading?Ce.B2l.ErrorTipsType.ErrorTipsType_PivotServiceCalcLoading:Ce.B2l.ErrorTipsType.ErrorTipsType_FormulaError,d=o.getVar();this.serializeNormalCell(d,u,r,f)}}else this.serializeNormalCell(o,u,r);if(null!=i&&i.length){var v=[],p=[],m=[],g=[];i.forEach((function(e){var t,a=i.itemToText(e);if(a){var o,u,c=e.autoFormatter,h=e.segmentArray,f=null!==(t=null==c?void 0:c.getFormatCode())&&void 0!==t?t:"";g.push(s.strings.addValue(a)),m.push(l.addMultipleFormat(f)),h?(o=cC,u=n.serializeSegmentArray(h,r)):n.serializeNormalVariant(e.variant,s,(function(e,t){o=e,u=t})),p.push(o),v.push(u)}})),u.extendValueId=s.selectedMultipleValues.add({selectedIds:v,selectedTypeList:p,selectedAutoFormats:m,selectedValueIds:g}).id,u.extendType=Ce.B2l.CellExtendType.CellExtendType_Select}}}},{key:"serializeNormalVariant",value:function(e,t,r,n){var a=e.getValue();if(null!==a)switch(e.type){case tC:r(oC,t.numbers.addValue(a));break;case rC:r(iC,t.strings.addValue(a));break;case nC:r(uC,a?1:0);break;case aC:var o=e;r(sC,t.errorValues.add(function(e,t){var r,n,a;return{type:e.errorType,code:e.errorCode,description:e.desc,message:null==e||null===(r=e.info)||void 0===r?void 0:r.message,args:null!=e&&null!==(n=e.info)&&void 0!==n&&n.args?JSON.stringify(null==e||null===(a=e.info)||void 0===a?void 0:a.args):void 0,errorTipsType:t}}(o,n)).id)}}},{key:"serializeNormalCell",value:function(e,t,r,n){var a=r.cellValueRefHelper;if(this.serializeNormalVariant(e,a,(function(e,r){t.valueType=e,t.valueId=r}),n),r.isForShortcut){var o=e.getSpecialInfo();if(o){var i=JSON.stringify(o);t.formulaSpecialInfoId=a.formulaSpecialInfoStrings.addValue(i)}}}},{key:"serializeFormula",value:function(e,t,r){if(e.isFormula()){var n=r.cellValueRefHelper,a=this.sheet.parent,o=a.getFormulaId&&a.getFormulaId(e,this.sheet.id());null!=o&&(t.formulaId=o);var i,u,s=e.formula.hash();n.formulaDatas.checkValuesRefId(s,(function(e){i=e}),(function(){if(u=Tp(e,{ref:e.getRef(),isNotShowErrRef:!1},{refType:1,shouldContainExternalDataReference:!1,isMutation:!0}),dv(e)){var t=a.importRangeManager;u.importRangeId=t.getIdFromFormula(e)}var r={v:u.v,flag:u.flag,tree:u.tree,tokens:u.tokens,importRangeId:u.importRangeId,importRangeMeta:u.externalDataReference,params:u.params};return i=n.formulaDatas.add(r).id}));var l,c=e.getRefMap();if(c){var h=function(e){return e[0]}(c);n.formulaRefMaps.checkValuesRefId(h,(function(e){l=e}),(function(){return u=u||Tp(e,{ref:e.getRef(),isNotShowErrRef:!1},{refType:1,shouldContainExternalDataReference:!1,isMutation:!0}),l=n.formulaRefMaps.add({refs:u.refs}).id}))}t.valueType=hC,t.valueId=n.formulas.checkValuesRefId(i,l,(function(){return{formulaDataId:i,formulaRefMapId:l}}))}}},{key:"serializeFormulaForShortcut",value:function(e,t,r){if(e.isFormula()||pC(e)||co(e)){var n,a=e.getVar();if(a.isError()&&VR(a.errorCode))n=Ce.B2l.ErrorTipsType.ErrorTipsType_Info;else{var o=Kp(this.sheet,e);o&&0!==o.state&&(n=Ce.B2l.ErrorTipsType.ErrorTipsType_FormulaError)}if(!n&&vs(a)){var i=a.getValue();this.serializeEmbedImage(i,t,r)}else this.serializeNormalCell(a,t,r,n)}}},{key:"serializeEmbedImage",value:function(e,t,r){var n=r.cellValueRefHelper;t.valueType=lC;var a=this.image.getIdByRef(e);n.embedImages.checkValuesRefId(a,(function(e){t.valueId=e}),(function(){var r=n.embedImages.add({token:e.fileToken,size:{w:Number(e.width),h:Number(e.height)},link:e.link}).id;return t.valueId=r,r}))}},{key:"serializeSegmentArray",value:function(e,t){var r,n=this,a=t.cellValueRefHelper,o=t.cellFormatRefHelper,i=[],u=[],s=0,l=yr(e);try{var c=function(){var e=r.value,l=o.pushStyleFont(e.style,n.style.getIdByRef(e.style));switch(s+=e.text.length,i.push(e.text),e.type){case Ce.K6s.MENTION:var c,h,f=n.mention.getIdByRef(e);a.mentionInfosSerialize.checkValuesRefId(f,(function(e){c=e}),(function(){var t={};return 0===e.mentionType?(t.mentionType=Ce.B2l.MENTION_TYPE.MENTION_TYPE_USER,t.mentionUserInfo={userInfo:{id:e.token,name:e.name,enName:e.en_name,avatarUrl:e.link},mentionNotify:e.mentionNotify,notNotify:e.not_notify,blockNotify:e.block_notify,isExternal:e.is_external}):e.mentionType>0&&(t.mentionType=Ce.B2l.MENTION_TYPE.MENTION_TYPE_FILE,t.mentionFileInfo={token:e.token,link:e.link,fileType:e.mentionType,iconInfo:e.iconInfo}),c=a.mentionInfosSerialize.add(t).id})),a.mentionsSerialize.checkValuesRefId(f,(function(e){h=e}),(function(){return h=a.mentionsSerialize.add({mentionId:e.mentionId,mentionInfoId:c}).id})),u.push({runType:Ce.B2l.CellRunType.CellRunType_Mention,endPos:s,fontId:l,refId:h});break;case Ce.K6s.ATTACHMENT:var d,v=n.attachment.getIdByRef(e);a.attachments.checkValuesRefId(v,(function(e){d=e}),(function(){var t=a.attachments.add({fileToken:e.fileToken,mimeType:e.mimeType,size:e.size}).id;return d=t,t})),u.push({runType:Ce.B2l.CellRunType.CellRunType_Attachment,endPos:s,fontId:l,refId:d});break;case Ce.K6s.URL:n.serializeUrlSegment(e,u,t,s);break;default:u.push({runType:Ce.B2l.CellRunType.CellRunType_Text,endPos:s,fontId:l})}};for(l.s();!(r=l.n()).done;)c()}catch(e){l.e(e)}finally{l.f()}var h=i.join(""),f=a.strings.addValue(h);return a.richStrings.addValue(f,u)}},{key:"serializeUrlSegment",value:function(e,t,r,n){var a,o,i=r.cellValueRefHelper,u=r.cellFormatRefHelper,s=-1;if(null!==(a=e.cellPosition)&&void 0!==a&&a.sheetId)if(e.cellPosition.rangeId){var l="".concat(e.cellPosition.sheetId,"-").concat(e.cellPosition.rangeId),c=Ce.B2l.HyperlinkType.HyperlinkType_Range;s=i.hyperlinks.checkValuesRefId(l,c,(function(){return{url:l,type:c}}))}else{var h=e.cellPosition.sheetId,f=Ce.B2l.HyperlinkType.HyperlinkType_Worksheet;s=i.hyperlinks.checkValuesRefId(h,f,(function(){return{url:h,type:f}}))}else if(e.link){var d=e.link,v=Ce.B2l.HyperlinkType.HyperlinkType_Normal;s=i.hyperlinks.checkValuesRefId(d,v,(function(){return{url:d,type:v}}))}else{var p=e.text,m=Ce.B2l.HyperlinkType.HyperlinkType_Normal;s=i.hyperlinks.checkValuesRefId(p,m,(function(){return{url:p,type:m}}))}var g=u.pushStyleFont(e.style,this.style.getIdByRef(e.style));if(null!==(o=e.texts)&&void 0!==o&&o.length){var y,_=0,R=yr(e.texts);try{for(R.s();!(y=R.n()).done;){var C,w=y.value,E=u.pushStyleFont(w.style,this.style.getIdByRef(w.style));_+=w.text.length,t.push({runType:Ce.B2l.CellRunType.CellRunType_Hyperlink,endPos:n-e.text.length+_,fontId:null!==(C=E)&&void 0!==C?C:g,refId:s})}}catch(e){R.e(e)}finally{R.f()}}else t.push({runType:Ce.B2l.CellRunType.CellRunType_Hyperlink,endPos:n,fontId:g,refId:s})}},{key:"mention",get:function(){return this.refMgrOptions.mention}},{key:"image",get:function(){return this.refMgrOptions.image}},{key:"attachment",get:function(){return this.refMgrOptions.attachment}},{key:"style",get:function(){return this.refMgrOptions.style}}]),t}(G_),AC=function(e){function t(e,r,n,a,o,i,u){var s;return(0,y.Z)(this,t),(s=(0,d.Z)(this,(0,v.Z)(t).call(this,n.iter(a,o,i,u)))).sheet=e,s.refMgrOptions=r,s}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exportToCell",value:function(e,t,r){var n=this;if(t.multipleValues&&(e.multipleValues=t.multipleValues.toJSON().map((function(e){return Array.isArray(e.value)&&(e.value=n.segmentArrayToRefId(e.value)),e}))),t.segmentArray)e.value=this.segmentArrayToRefId(t.segmentArray);else if(t.variant){if(pC(t.variant)){if(0!==this.exportType){e.value=t.variant.getValue();var a=t.variant.getVar().getSpecialInfo();a&&a.customData&&a.customData.autoFormat&&(e.autoFormat=a.customData.autoFormat)}return}if(t.variant.isFormula())switch(this.exportType){case 0:var o=t.variant;e.formula=this.sheet.getCalcEngine().decompile(o,{ref:o.getRef(),isNotShowErrRef:!1}),e.formulaData=Tp(o,{ref:o.getRef(),isNotShowErrRef:!1},{refType:0,shouldContainExternalDataReference:!1});var i=this.sheet.parent.getFormulaId&&this.sheet.parent.getFormulaId(o,this.sheet.id());if(null!=i&&(e.formulaId=i),dv(t.variant)){var u=this.sheet.parent.importRangeManager;e.formulaData.importRangeId=u.getIdFromFormula(t.variant)}break;case 1:case 2:e.isCalcError=t.variant.getVar().isError(),e.value=t.variant.getValue();var s=t.variant.getInfo();s&&s.customData&&s.customData.autoFormat&&(e.autoFormat=s.customData.autoFormat);break;case 3:this.exportFormulaToDataRange(t.variant,e,r)}else{var l=t.variant.getValue(r);null!==l&&(e.value=l)}}}},{key:"exportExtraInfo",value:function(e){this.exportImages(e),this.exportMentions(e),this.exportAttachments(e),this.exportSegmentStyles(e)}},{key:"segmentArrayToRefId",value:function(e){var t=this;return e.map((function(e){if(!e)return e;switch(e.type){case Ce.K6s.MENTION:return{type:Ce.K6s.MENTION,id:t.mention.getIdByRef(e)};case Ce.K6s.EMBED_IMAGE:return{type:Ce.K6s.EMBED_IMAGE,id:t.image.getIdByRef(e)};case Ce.K6s.ATTACHMENT:return{type:Ce.K6s.ATTACHMENT,id:t.attachment.getIdByRef(e)}}var r=Object.assign({},e);return e.style&&(r.styleId=t.style.getIdByRef(e.style)),delete r.style,e.texts&&(r.texts=t.segmentArrayToRefId(e.texts)),r}))}},{key:"exportMentions",value:function(e){for(var t=this.mention.toJSON(),r=0,n=Object.keys(t);r<n.length;r++){var a=t[n[r]];a.style&&(a.styleId=this.style.getIdByRef(a.style),delete a.style)}delete e.mention,by(t)||(e.mention=t)}},{key:"exportImages",value:function(e){for(var t=this.image.toJSON(),r=0,n=Object.keys(t);r<n.length;r++){var a=t[n[r]];a.style&&(a.styleId=this.style.getIdByRef(a.style),delete a.style)}delete e.image,by(t)||(e.image=t)}},{key:"exportSegmentStyles",value:function(e){var t=this.style.toJSON();e.entities=e.entities||{},delete e.entities.segmentStyles,by(t)||(e.entities.segmentStyles=t)}},{key:"exportAttachments",value:function(e){for(var t=this.attachment.toJSON(),r=0,n=Object.keys(t);r<n.length;r++){var a=t[n[r]];a.style&&(a.styleId=this.style.getIdByRef(a.style),delete a.style)}delete e.attachment,by(t)||(e.attachment=t)}},{key:"exportFormulaToDataRange",value:function(e,t,r){try{var n=e.getVar(r),a=ts(n,r);t.isCalcError=a.isError(),t.value=n.getValue(r)}catch(e){if(!(e&&e instanceof it.BaseVar&&e.isError()&&eC.includes(e.errorType)))throw e;t.isCalcError=!1,t.value=e.getValue()}var o=e.getInfo();return o&&o.customData&&o.customData.autoFormat&&(t.autoFormat=o.customData.autoFormat),t}},{key:"mention",get:function(){return this.refMgrOptions.mention}},{key:"image",get:function(){return this.refMgrOptions.image}},{key:"attachment",get:function(){return this.refMgrOptions.attachment}},{key:"style",get:function(){return this.refMgrOptions.style}}]),t}(D_),IC=function(){function e(t,r,n){(0,y.Z)(this,e),this.sheet=t,this.refMgrOptions=r,this.block=n,this.hasWarnNotExist=!1}return(0,_.Z)(e,[{key:"importCell",value:function(e,t,r,n){if(dR(r.value)){var a=r.value;r.value=a.reduce((function(e,t){return e+t.text}),"")}var o=Array.isArray(r.value),i=null,u=null,s=null;if(r.multipleValues&&(i=this.importMultipleValues(r.multipleValues,n)),o)u=this.importSegmentArray(r.value,n);else if(r.formula&&""!==r.formula){var l=this.importFormula(e,t,r);l&&(s=l)}else if(null!=r.value){var c=r.value;c&&"object"==(0,R.Z)(c)&&c._calcError&&(c=it.ERROR_VAR_MAP[c._calcError]||c._calcError),c instanceof it.BaseVar||null===c||(s=Jy(this.sheet,e,t,c,{skipFormulaCompile:!0,stringVarRefMap:this.sheet._dataModel.getStringVarRefMap()}));var h=this.sheet.getCalcEngine().formulaSpace;if(_C(this.block.getVar(e,t,!0),h),s){var f=RC(this.sheet,e,t,s,null,h);f&&(s=f)}}(u||s||i)&&this.block.set(e,t,new fC(u,s,i)),null!=r.formulaId&&s instanceof lv&&this.sheet.parent.setFormulaCache&&this.sheet.parent.setFormulaCache(s,this.sheet,r.formulaId)}},{key:"importFormula",value:function(e,t,r){var n,a=this.sheet.getCalcEngine();if(r.formulaData)n=a.deserializeFormula(r.formulaData,new ou(e,t,1,1,this.sheet));else{var o="="===r.formula[0]?"":"=";n=Jy(this.sheet,e,t,o+r.formula,{skipFormulaCompile:!1})}var i=a.formulaSpace;_C(this.block.getVar(e,t,!0),i);var u=RC(this.sheet,e,t,n,null,i);return u&&u.isFormula()&&a.formulaRefService.cacheRange(u.formula,u.getRef()),u}},{key:"importExtraInfo",value:function(e){this.block.setRefCounterState(),this.importSegmentStyles(e),this.importMentions(e),this.importImages(e),this.importAttachments(e)}},{key:"importSegmentArray",value:function(e,t){var r=this,n=this.sheet.getLogger();return e.map((function(e){switch(e.type){case Ce.K6s.MENTION:var a=r.mention.getById(e.id);if(!a)return r.hasWarnNotExist||(n.warn("mentionId not exist: ".concat(e.id)),r.hasWarnNotExist=!0),{type:"text",text:""};if(t&&(console.warn("mention buildRefCounter set, something wrong"),r.mention.setUseRefCounter(!0),!r.mention.incRefCounter(a)))throw new Error("mention incRefCounter failed");return a;case Ce.K6s.EMBED_IMAGE:var o=r.image.getById(e.id);if(!o)return r.hasWarnNotExist||(n.warn("imageId not exist: ".concat(e.id)),r.hasWarnNotExist=!0),{type:"text",text:""};if(t&&(console.warn("image buildRefCounter set, something wrong"),r.image.setUseRefCounter(!0),!r.image.incRefCounter(o)))throw new Error("image incRefCounter failed");return o;case Ce.K6s.ATTACHMENT:var i=r.attachment.getById(e.id);if(!i)return r.hasWarnNotExist||(n.warn("attachment not exist: ".concat(e.id)),r.hasWarnNotExist=!0),{type:"text",text:""};if(t&&(r.attachment.setUseRefCounter(!0),!r.attachment.incRefCounter(i)))throw new Error("attachment incRefCounter failed");return i;default:if(!Object.values(Ce.K6s).includes(e.type))return{type:Ce.K6s.TEXT,text:""};var u=Object.assign({},e);return delete u.style,e.styleId&&(u.style=r.style.getById(e.styleId),delete u.styleId),e.texts&&(u.texts=r.importSegmentArray(e.texts,t)),u}}))}},{key:"importMultipleValues",value:function(e,t){var r=this,n=e.map((function(e){return Array.isArray(e.value)?Object.assign({},e,{value:r.importSegmentArray(e.value,t)}):e})),a=new l_(this.sheet.parent);return a.fromJSON(n),a}},{key:"importImages",value:function(e){if(e.image){var t=Ny(e.image);for(var r in e.image){var n=Object.assign({},e.image[r]);if(n.link=mC(n.link),!n.fileToken){var a=yC(decodeURIComponent(n.link));a&&(gC(a),n.fileToken=a)}if(delete n.style,void 0!==n.styleId&&(n.style=this.style.getById(n.styleId),delete n.styleId),t){var o=n.refCount;this.image.addById(Number(r),n),this.image.setCounterById(Number(r),o)}else this.image.addById(Number(r),n)}}}},{key:"importMentions",value:function(e){if(e.mention){var t=Ny(e.mention);for(var r in e.mention){var n=Object.assign({},e.mention[r]);if(this.setStyle2Segment(n),t){var a=n.refCount;this.mention.addById(Number(r),n),this.mention.setCounterById(Number(r),a)}else this.mention.addById(Number(r),n)}}}},{key:"importSegmentStyles",value:function(e){if(e.entities){var t=e.entities.segmentStyles,r=Ny(t);for(var n in t){var a=Object.assign({},t[n]),o=Om.fromJSON(this.sheet.parent.formatterService,a);if(r){var i=a.refCount;delete a.refCount,o&&this.style.addById(Number(n),o),o&&this.style.setCounterById(Number(n),i)}else o&&this.style.addById(Number(n),o)}}}},{key:"importAttachments",value:function(e){if(e.attachment){var t=Ny(e.attachment);for(var r in e.attachment){var n=Object.assign({},e.attachment[r]);if(this.setStyle2Segment(n),t){var a=n.refCount;this.attachment.addById(Number(r),n),this.attachment.setCounterById(Number(r),a)}else this.attachment.addById(Number(r),n)}}}},{key:"setStyle2Segment",value:function(e){var t=this;return delete e.style,void 0!==e.styleId&&(e.style=this.style.getById(e.styleId),delete e.styleId),e.texts&&(e.texts=e.texts.map((function(e){var r=Object.assign({},e);if(e.styleId){var n=t.style.getById(e.styleId);n&&(r.style=n)}return r})),0===e.texts.length&&delete e.texts),e}},{key:"deserializeSegmentArray",value:function(e,t){var r,n=this,a=t.valueRefDelta,o=t.resourceRefDelta,i=t.formatDelta,u=a.richStrings[e],s=a.strings[u.textId],l=0,c=null,h=-1;return null!==(r=u.runs)&&void 0!==r&&r.forEach((function(e){c||(c=[]);var r,a=s.substring(l,e.endPos);switch(l=e.endPos,void 0!==e.fontId&&t.cellFormatRefHelper.fonts.checkValuesRefId(e.fontId,(function(e){r=n.style.getById(e)}),(function(){var t=i.fonts[e.fontId];r=Om.fromJSON(n.sheet.parent.formatterService,ZR({font:t}));var a=n.style.add(r);return r=a.ref,a.id})),e.runType){case Ce.B2l.CellRunType.CellRunType_Text:var u={type:Ce.K6s.TEXT,style:r,text:a};c.push(u);break;case Ce.B2l.CellRunType.CellRunType_Mention:var f=n.deserializeMention(e.refId,t,a,r,e.fontId);c.push(f);break;case Ce.B2l.CellRunType.CellRunType_Hyperlink:var d,v=o.hyperlinks[e.refId];if(v.type===Ce.B2l.HyperlinkType.HyperlinkType_Range){var p=v.url.split("-");d={sheetId:p[0],rangeId:p[1]}}else v.type===Ce.B2l.HyperlinkType.HyperlinkType_Worksheet&&(d={sheetId:v.url});if(h!==e.refId)c.push({type:Ce.K6s.URL,text:a,style:r,link:v.type===Ce.B2l.HyperlinkType.HyperlinkType_Normal?v.url:void 0,cellPosition:d});else{var m=c[c.length-1];m.texts||(m.texts=[{type:Ce.K6s.TEXT,style:m.style,text:m.text}],delete m.style),m.texts.push({type:Ce.K6s.TEXT,style:r,text:a}),m.text+=a}h=e.refId;break;case Ce.B2l.CellRunType.CellRunType_Attachment:var g=n.deserializeAttachment(e.refId,t,a,r);c.push(g)}e.runType!==Ce.B2l.CellRunType.CellRunType_Hyperlink&&(h=-1)})),c}},{key:"deserializeMention",value:function(e,t,r,n,a){var o,i,u=this,s=t.cellValueRefHelper,l=t.resourceRefDelta,c=l.mentions[e],h=c.mentionId,f=c.mentionInfoId;return s.mentionInfosDeserialize.checkValuesRefId(f,(function(e){o=s.mentionInfosDeserialize.getById(e)}),(function(){var e=l.mentionInfos[f];o=function(e){var t,r,n,a,o=e.mentionType===Ce.B2l.MENTION_TYPE.MENTION_TYPE_USER,i=e.mentionUserInfo,u=e.mentionFileInfo;return{type:Ce.K6s.MENTION,text:"",link:(o?null==i||null===(t=i.userInfo)||void 0===t?void 0:t.avatarUrl:null==u?void 0:u.link)||"",token:(o?null==i||null===(r=i.userInfo)||void 0===r?void 0:r.id:null==u?void 0:u.token)||"",mentionType:(o?0:Number(null==u?void 0:u.fileType))||0,not_notify:null==i?void 0:i.notNotify,block_notify:null==i?void 0:i.blockNotify,mentionNotify:null==i?void 0:i.mentionNotify,iconInfo:null==u?void 0:u.iconInfo,is_external:null==i?void 0:i.isExternal,category:o?"at-user-block":void 0,name:null==i||null===(n=i.userInfo)||void 0===n?void 0:n.name,en_name:null==i||null===(a=i.userInfo)||void 0===a?void 0:a.enName}}(e);var t=s.mentionInfosDeserialize.add(o);return o=t.ref,t.id})),s.mentionsDeserialize.checkValuesRefId(e,(function(e){i=s.mentionsDeserialize.getById(e)}),(function(){var e=Object.assign({type:Ce.K6s.MENTION,link:"",token:"",mentionType:0},o,{text:r,mentionId:h}),t=s.mentionsDeserialize.add(e);return i=t.ref,t.id})),s.getMentionWithStyleRefManager(a).checkValuesRefId(e,(function(e){i=u.mention.getById(e)}),(function(){var e=Object.assign({},i,{style:n}),t=u.mention.add(e);return i=t.ref,t.id})),i||{type:"text",text:""}}},{key:"deserializeAttachment",value:function(e,t,r,n){var a=t.resourceRefDelta.attachments[e],o={type:Ce.K6s.ATTACHMENT,style:n,text:r,fileToken:a.fileToken||"",mimeType:a.mimeType||"",size:a.size||0};return this.attachment.add(o).ref}},{key:"deserializeEmbedImage",value:function(e,t){var r,n,a=this,o=t.cellValueRefHelper,i=t.resourceRefDelta;return null!==(r=i.embedImages)&&void 0!==r&&r.length?(o.embedImages.checkValuesRefId(e,(function(e){n=a.image.getById(e)}),(function(){var t=i.embedImages[e],r={type:Ce.K6s.EMBED_IMAGE,height:t.size.h,width:t.size.w,text:"",link:t.link,fileToken:t.token},o=a.image.add(r);return n=o.ref,o.id})),n||{type:Ce.K6s.TEXT,text:""}):{type:Ce.K6s.TEXT,text:""}}},{key:"mention",get:function(){return this.refMgrOptions.mention}},{key:"image",get:function(){return this.refMgrOptions.image}},{key:"attachment",get:function(){return this.refMgrOptions.attachment}},{key:"style",get:function(){return this.refMgrOptions.style}}]),e}(),OC=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).sheet=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getExporter",value:function(e,t,r,n){return new NC(this,this.sheet,e,t,r,n)}},{key:"getImporter",value:function(){return new bC(this)}},{key:"getSerializer",value:function(e,t,r,n){return new VC(this,this.sheet,e,t,r,n)}}]),t}(Wg),VC=function(e){function t(e,r,n,a,o,i){var u;return(0,y.Z)(this,t),(u=(0,d.Z)(this,(0,v.Z)(t).call(this,e,n,a,o,i))).block=e,u.sheet=r,u}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serializeToMutations",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t.ignoreComment){var r=this.block.iter(0,0,this.sheet.getRowCount(),this.sheet.getColumnCount());r.forEach((function(t){var n=r.position(),a={startRow:n.row,startCol:n.col};t.forEach((function(t){var r=t.id,n=t.isResolved;e.push({type:Ce.B2l.MutationType.MutationType_AddComment,addComment:{value:{id:r,cell:a,isResolved:n}}})}))}))}}}]),t}(G_),NC=function(e){function t(e,r,n,a,o,i){var u;return(0,y.Z)(this,t),(u=(0,d.Z)(this,(0,v.Z)(t).call(this,e.iter(n,a,o,i)))).block=e,u.sheet=r,u}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exportToCell",value:function(e,t){}},{key:"exportExtraInfo",value:function(e){var t={},r=this.block.iter(0,0,this.sheet.getRowCount(),this.sheet.getColumnCount());r.forEach((function(e){var n=r.position();if(e){var a=t[n.row];a||(a=t[n.row]={}),a[n.col]=e}})),delete e.comment,by(t)||(e.comment=t)}}]),t}(D_),bC=function(){function e(t){(0,y.Z)(this,e),this.block=t}return(0,_.Z)(e,[{key:"importCell",value:function(e,t,r,n){}},{key:"importExtraInfo",value:function(e){if(e.comment)for(var t in e.comment)if(e.comment[t])for(var r in e.comment[t]){var n,a=null===(n=e.comment[t][r])||void 0===n?void 0:n.filter((function(e){return-1===e.id.indexOf("-")}));a&&this.block.set(Number(t),Number(r),a)}}}]),e}(),MC={hour:9,minute:0,second:0,millisecond:0};function FC(e,t){if(!e)return null;var r=new zC((0,Tt.v4)());if(r.fromJSON(e),void 0!==t){if(!("number"==typeof t&&t>=we.SheetDate.MIN_DATE_VALUE&&t<=we.SheetDate.MAX_DATE_VALUE))return null;r.setExpireTime(xC(t))}return r}function ZC(e){return e.id=(0,Tt.v4)(),e}function xC(e){var t=new we.SheetDate(e).time;return kt()().year(t.year).month(t.month-1).date(t.date).hour(t.hours).minute(t.minutes).second(t.seconds).millisecond(t.milliseconds).valueOf()}function DC(e){return we.SheetDate.fromLocalDate(e).toNumber()}function PC(e){Ce.Ps3.collectSuiteEvent&&Ce.Ps3.collectSuiteEvent("sheet_opration",e)}var $C=[{id:6,text:cr("smartable.reminder.day_of_event"),getNotifyTime:function(e){return kt()(e).set(MC).valueOf()}},{id:7,text:cr("smartable.reminder.1_day_before"),getNotifyTime:function(e){return kt()(e).subtract(1,"days").set(MC).valueOf()}},{id:8,text:cr("smartable.reminder.2_day_before"),getNotifyTime:function(e){return kt()(e).subtract(2,"days").set(MC).valueOf()}},{id:9,text:cr("smartable.reminder.1_week_before"),getNotifyTime:function(e){return kt()(e).subtract(1,"weeks").set(MC).valueOf()}}],LC=[{id:0,text:cr("smartable.reminder.at_time_of_event"),getNotifyTime:function(e){return e}},{id:1,text:cr("smartable.reminder.remind_before_min",5),getNotifyTime:function(e){return kt()(e).subtract(5,"minutes").valueOf()}},{id:2,text:cr("smartable.reminder.remind_before_min",15),getNotifyTime:function(e){return kt()(e).subtract(15,"minutes").valueOf()}},{id:3,text:cr("smartable.reminder.remind_before_min",30),getNotifyTime:function(e){return kt()(e).subtract(30,"minutes").valueOf()}},{id:4,text:cr("smartable.reminder.1_hour_before"),getNotifyTime:function(e){return kt()(e).subtract(1,"hours").valueOf()}},{id:5,text:cr("smartable.reminder.remind_before_hour",2),getNotifyTime:function(e){return kt()(e).subtract(2,"hours").valueOf()}},{id:10,text:cr("reminder.popover.beforeDay",1),getNotifyTime:function(e){return kt()(e).subtract(1,"days").valueOf()}},{id:11,text:cr("reminder.popover.beforeDay",2),getNotifyTime:function(e){return kt()(e).subtract(2,"days").valueOf()}},{id:12,text:cr("reminder.popover.beforeWeek",1),getNotifyTime:function(e){return kt()(e).subtract(1,"weeks").valueOf()}}],BC=$C.concat(LC).reduce((function(e,t){return e[t.id]=t,e}),{});function UC(){var e=cr("sheet.format_code.date_time");return e&&"sheet.format_code.date_time"!==e?e:"yyyy/MM/dd HH:mm:ss"}var HC,zC=function(){function e(t){(0,y.Z)(this,e),this.expireTime=0,this.notifyTime=0,this.notifyStrategy=0,this.notifyUsers=[],this.id=t}return(0,_.Z)(e,null,[{key:"fromReminder",value:function(t){var r=new e(t.id);return r.fromChangeset(t.toChangeset()),r}}]),(0,_.Z)(e,[{key:"setExpireTime",value:function(e){this.expireTime=e,this.setNotifyTimeByStrategy(this.notifyStrategy)}},{key:"setNotifyTime",value:function(e){this.notifyTime=e}},{key:"setNotifyStrategy",value:function(e){this.notifyStrategy=e,this.setNotifyTimeByStrategy(e)}},{key:"setNotifyTimeByStrategy",value:function(e){var t=function(e){var t=BC[e];if(!t)throw new Error("invalid notify strategy id: ".concat(e));return t}(e);this.notifyTime=t.getNotifyTime(this.expireTime)}},{key:"getNotifyStrategy",value:function(){return this.notifyStrategy}},{key:"setNotifyUsers",value:function(e){this.notifyUsers=e}},{key:"getNotifyUsers",value:function(){return this.notifyUsers}},{key:"getNotifyUserIds",value:function(){return this.notifyUsers.map((function(e){return e.id}))}},{key:"setNotifyText",value:function(e){this.notifyText=e}},{key:"getNotifyText",value:function(){return this.notifyText}},{key:"removeNotifyText",value:function(){delete this.notifyText}},{key:"serialize",value:function(){return{expireTime:this.expireTime,notifyStrategyType:this.notifyStrategy+1,notifyTime:this.notifyTime,notifyText:this.notifyText,notifyUserIds:this.notifyUsers.map((function(e){return e.id})),id:this.id}}},{key:"deserialize",value:function(e){var t;this.expireTime=e.expireTime,this.setNotifyStrategy(e.notifyStrategyType-1),this.notifyTime=e.notifyTime,this.notifyText=e.notifyText,this.notifyUsers=(null===(t=e.notifyUserIds)||void 0===t?void 0:t.map((function(e){return{id:e}})))||[]}},{key:"toJSON",value:function(){var e={notifyUsers:this.notifyUsers.slice()};return this.assignReminderExceptUser(e,!1),e}},{key:"fromJSON",value:function(e){this.assignReminderExceptUser(e,!0),this.notifyUsers=e.notifyUsers.slice()}},{key:"fromJSONExceptUserDetails",value:function(e){this.assignReminderExceptUser(e,!0),this.notifyUsers=e.notifyUserIds.map((function(e){return{id:e}}))}},{key:"toJSONExceptUserDetails",value:function(){var e={notifyUserIds:this.notifyUsers.map((function(e){return e.id}))};return this.assignReminderExceptUser(e,!1),e}},{key:"toChangeset",value:function(){var e={id:this.id,notifyUsers:this.notifyUsers.slice()};return this.assignReminderExceptUser(e,!1),e}},{key:"fromChangeset",value:function(e){this.assignReminderExceptUser(e,!0),this.notifyUsers=e.notifyUsers.slice()}},{key:"assignReminderExceptUser",value:function(e,t){t?(this.notifyTime=e.notifyTime,this.notifyStrategy=e.notifyStrategy,this.expireTime=e.expireTime,void 0!==e.notifyText&&(this.notifyText=e.notifyText)):(e.notifyTime=this.notifyTime,e.notifyStrategy=this.notifyStrategy,e.expireTime=this.expireTime,void 0!==this.notifyText&&(e.notifyText=this.notifyText))}}]),e}(),WC=1e3,GC=500,jC=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).sheet=e,r.reminders=new Map,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"set",value:function(e,r,n){var a=this.get(e,r);(a||n)&&(0,f.Z)((0,v.Z)(t.prototype),"set",this).call(this,e,r,n),a&&this.reminders.delete(a.id),n&&this.reminders.set(n.id,n)}},{key:"setReminderById",value:function(e,t){this.reminders.set(e,t)}},{key:"getReminderById",value:function(e){return this.reminders.get(e)}},{key:"delRow",value:function(e,r,n){this.removeReminderInRange(e,0,r,xg),(0,f.Z)((0,v.Z)(t.prototype),"delRow",this).call(this,e,r,n)}},{key:"delCol",value:function(e,r){this.removeReminderInRange(0,e,xg,r),(0,f.Z)((0,v.Z)(t.prototype),"delCol",this).call(this,e,r)}},{key:"removeReminderInRange",value:function(e,t,r,n){var a=this;this.iter(e,t,r,n).forEach((function(e){a.reminders.delete(e.id)}))}},{key:"isEmpty",value:function(){return 0===this.count()}},{key:"count",value:function(){return this.reminders.size}},{key:"values",value:function(){return this.reminders.values()}},{key:"entries",value:function(){return this.reminders.entries()}},{key:"getImporter",value:function(){return new JC(this)}},{key:"getExporter",value:function(e,t,r,n){return new qC(this,e,t,r,n)}},{key:"getSerializer",value:function(e,t,r,n){return new YC(this,e,t,r,n)}}]),t}(Wg),YC=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serializeCell",value:function(e,t,r){e.reminderId=r.cellValueRefHelper.reminderIds.addValue(t.id)}},{key:"serializeToMutations",value:function(e){var t,r=yr(this.model.entries());try{for(r.s();!(t=r.n()).done;){var n=(0,g.Z)(t.value,2)[1];e.push({type:Ce.B2l.MutationType.MutationType_AddReminder,addReminder:{value:n.serialize()}})}}catch(e){r.e(e)}finally{r.f()}}}]),t}(G_),qC=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this,e.iter(r,n,a,o)))).block=e,i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exportToCell",value:function(e,t){e&&t&&(e.reminderId=t.id)}},{key:"exportExtraInfo",value:function(e){var t,r={},n=yr(this.block.entries());try{for(n.s();!(t=n.n()).done;){var a=(0,g.Z)(t.value,2),o=a[0],i=a[1];r[o]=i.toJSONExceptUserDetails()}}catch(e){n.e(e)}finally{n.f()}delete e.reminders,(0,ue.default)(r)||(e.reminders=r)}}]),t}(D_),JC=function(){function e(t){(0,y.Z)(this,e),this.block=t}return(0,_.Z)(e,[{key:"importCell",value:function(e,t,r,n){if(r.reminderId){var a=this.block.getReminderById(r.reminderId);a&&this.block.set(e,t,a)}}},{key:"importExtraInfo",value:function(e){for(var t=e.reminders||{},r=Object.keys(t),n=r.length-1;n>=0;n--){var a=r[n],o=new zC(a);o.fromJSONExceptUserDetails(t[a]),this.block.setReminderById(a,o)}}}]),e}(),KC={LABEL:"lhs"},XC={LABEL:"rhs"},QC={LABEL:"firstArgument"},ew={LABEL:"restArguments"},tw={LABEL:"firstCall"},rw={LABEL:"restCalls"},nw=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"A1";(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,e,{nodeLocationTracking:"onlyOffset",skipValidations:!0,maxLookahead:1}))).refStyle=n;var a=(0,c.Z)(r),o=[];return a.RULE("entry",(function(){o.push(!0),a.OPTION((function(){a.CONSUME(af.WhiteSpace)})),a.SUBRULE(a.formula),a.OPTION2((function(){a.CONSUME2(af.WhiteSpace)})),o.pop()})),a.RULE("formula",(function(){a.SUBRULE(a.concatExp,KC),a.MANY((function(){a.CONSUME(af.ComparisonOperator),a.SUBRULE2(a.concatExp,XC)}))})),a.RULE("concatExp",(function(){a.SUBRULE(a.addExp,KC),a.MANY((function(){a.CONSUME(af.Concatenate),a.SUBRULE2(a.addExp,XC)}))})),a.RULE("addExp",(function(){a.SUBRULE(a.mulExp,KC),a.MANY((function(){a.CONSUME(af.AdditionOperator),a.SUBRULE2(a.mulExp,XC)}))})),a.RULE("mulExp",(function(){a.SUBRULE(a.powExp,KC),a.MANY((function(){a.CONSUME(af.MultiplicationOperator),a.SUBRULE2(a.powExp,XC)}))})),a.RULE("powExp",(function(){a.SUBRULE(a.percentExp,KC),a.MANY((function(){a.CONSUME(af.Power),a.SUBRULE2(a.percentExp,XC)}))})),a.RULE("percentExp",(function(){a.SUBRULE(a.prefixExp),a.MANY((function(){a.CONSUME(af.Percent)}))})),a.RULE("prefixExp",(function(){a.MANY((function(){a.CONSUME(af.AdditionOperator)})),a.SUBRULE(a.baseFormula)})),a.RULE("baseFormula",(function(){a.OR([{ALT:function(){return a.SUBRULE(a.simpleConstant)}},{ALT:function(){return a.SUBRULE(a.matrixConstant)}},{GATE:function(){return!0===o[o.length-1]},ALT:function(){return a.SUBRULE(a.advancedReference)}},{GATE:function(){return!1===o[o.length-1]},ALT:function(){return a.SUBRULE(a.notCommaAdvancedReference)}}])})),a.RULE("advancedReference",(function(){a.SUBRULE(a.intersectExp,KC),a.MANY((function(){a.CONSUME(af.Comma),a.SUBRULE2(a.intersectExp,XC)}))})),a.RULE("intersectExp",(function(){a.SUBRULE(a.rangeExp,KC),a.MANY((function(){a.CONSUME(af.WhiteSpace),a.OPTION((function(){a.SUBRULE2(a.rangeExp,XC)}))}))})),a.RULE("rangeExp",(function(){a.SUBRULE(a.referenceFunction,KC),a.MANY((function(){a.CONSUME(af.Colon),a.SUBRULE2(a.referenceFunction,XC)}))})),a.RULE("notCommaAdvancedReference",(function(){a.SUBRULE(a.notCommaRangeExp,KC),a.MANY((function(){a.CONSUME(af.WhiteSpace),a.SUBRULE2(a.notCommaRangeExp,XC)}))})),a.RULE("notCommaRangeExp",(function(){a.SUBRULE(a.referenceFunction,KC),a.MANY((function(){a.CONSUME(af.Colon),a.SUBRULE2(a.referenceFunction,XC)}))})),a.RULE("referenceFunction",(function(){a.OR(a.c1||(a.c1=[{ALT:function(){switch(r.refStyle){case"A1":a.CONSUME(af.LocalReferenceA1);break;case"R1C1":a.CONSUME(af.LocalReferenceR1C1);break;default:throw Error("RefStyle is not found!")}}},{ALT:function(){switch(r.refStyle){case"A1":a.CONSUME(af.ExternalReferenceA1);break;case"R1C1":a.CONSUME(af.ExternalReferenceR1C1);break;default:throw Error("RefStyle is not found!")}}},{ALT:function(){a.CONSUME(af.FieldNameLocalReferenceA1)}},{ALT:function(){return a.CONSUME(af.RefConstant)}},{ALT:function(){return a.CONSUME(af.Name)}},{ALT:function(){return a.SUBRULE(a.parenExp)}},{ALT:function(){return a.SUBRULE(a.funcExp)}}]))})),a.RULE("parenExp",(function(){a.CONSUME(af.OpenParen),o.push(!0),a.SUBRULE(a.formula),o.pop(),a.CONSUME(af.CloseParen),a.MANY((function(){a.CONSUME(af.OpenParen),a.SUBRULE(a.arguments),a.CONSUME1(af.CloseParen)}))})),a.RULE("funcExp",(function(){a.CONSUME(af.FunctionName),a.SUBRULE(a.arguments,tw),a.CONSUME1(af.CloseParen),a.MANY((function(){a.CONSUME(af.OpenParen),a.SUBRULE1(a.arguments,rw),a.CONSUME1(af.CloseParen)}))})),a.RULE("arguments",(function(){o.push(!1),a.OPTION((function(){a.SUBRULE1(a.formula,QC)})),o.pop(),a.MANY((function(){a.CONSUME(af.Comma),o.push(!1),a.OPTION1((function(){a.SUBRULE2(a.formula,ew)})),o.pop()}))})),a.RULE("simpleConstant",(function(){a.OR([{ALT:function(){return a.CONSUME(af.LogicalConstant)}},{ALT:function(){return a.CONSUME(af.NumericalConstant)}},{ALT:function(){return a.CONSUME(af.StringConstant)}},{ALT:function(){return a.CONSUME(af.ErrorConstant)}}])})),a.RULE("matrixConstant",(function(){a.CONSUME(af.OpenBrace),a.SUBRULE(a.simpleConstantList,KC),a.MANY((function(){a.CONSUME(af.SemiColon),a.SUBRULE1(a.simpleConstantList,XC)})),a.CONSUME(af.CloseBrace)})),a.RULE("simpleConstantList",(function(){o.push(!1),a.SUBRULE(a.formula,KC),o.pop(),a.MANY((function(){a.CONSUME(af.Comma),o.push(!1),a.SUBRULE1(a.formula,XC),o.pop()}))})),r.performSelfAnalysis(),r}return(0,p.Z)(t,e),(0,_.Z)(t,null,[{key:"getTractorParserA1",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nf;return null==this.tractorParserA1&&(this.tractorParserA1=new t(e,"A1")),this.tractorParserA1}},{key:"getTractorParserR1C1",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:of;return null==this.tractorParserR1C1&&(this.tractorParserR1C1=new t(e,"R1C1")),this.tractorParserR1C1}},{key:"dispose",value:function(){this.tractorParserA1=null,this.tractorParserR1C1=null}}]),t}(Ct.CstParser);!function(e){e.entry="entry",e.formula="formula",e.concatExp="concatExp",e.addExp="addExp",e.mulExp="mulExp",e.powExp="powExp",e.percentExp="percentExp",e.prefixExp="prefixExp",e.baseFormula="baseFormula",e.simpleConstant="simpleConstant",e.matrixConstant="matrixConstant",e.advancedReference="advancedReference",e.notCommaAdvancedReference="notCommaAdvancedReference",e.intersectExp="intersectExp",e.rangeExp="rangeExp",e.referenceFunction="referenceFunction",e.notCommaRangeExp="notCommaRangeExp",e.simpleConstantList="simpleConstantList",e.parenExp="parenExp",e.funcExp="funcExp",e.arguments="arguments"}(HC||(HC={}));var aw=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="+",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"opImpl",value:function(e,t){return new it.NumberVar(e.getValue()+t.getValue())}}]),t}(it.NumberBinaryOp),ow=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="-",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"opImpl",value:function(e,t){return new it.NumberVar(e.getValue()-t.getValue())}}]),t}(it.NumberBinaryOp),iw=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="+",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"opImpl",value:function(e,t){var r=e.getValue(),n=t.getValue(),a=it.NumberVar.doubleEqual(r,-n)?0:r+n;return new it.NumberVar(a)}}]),t}(it.NumberBinaryOp),uw=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="-",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"opImpl",value:function(e,t){var r=e.getValue(),n=t.getValue(),a=it.NumberVar.doubleEqual(r,n)?0:r-n;return new it.NumberVar(a)}}]),t}(it.NumberBinaryOp),sw=function(e){return e.replace(/\uFF08/g,"(")},lw=function(e){return e.replace(/\uFF09/g,")")},cw=function(e){return e.replace(/\uFF0C/g,",")},hw=function(e){return e.replace(/\uFF1B/g,";")};function fw(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var dw,vw=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).operands=0,r.optionOperands=256,r.resultType=it.VAR_TYPE.ERROR,r.repeatedLastParam=0,r.paramsDesc=[],r.$$minOperands=0,r.$$maxOperands=Co,r.$$lazy=!1,r.$$paramsDesc=[1279],r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(){return it.tractorErrorVarCreators[it.ErrorCode.UNKNOWN_FUNCTION]({funcName:this.name})}}]),t}(it.FuncOpBase);function pw(e,t,r,n,a,o){var i;return(i=function(t){function r(t){return(0,y.Z)(this,r),(0,d.Z)(this,(0,v.Z)(r).call(this,t||e))}return(0,p.Z)(r,t),r}(it.FuncOpBase)).prototype.operands=t,i.prototype.optionOperands=r,i.prototype.repeatedLastParam=n,i.prototype.resultType=a,i.prototype.paramsDesc=o,i}!function(e){e[e.ImportRangeDatas=0]="ImportRangeDatas",e[e.ImportRangeDatasV3=1]="ImportRangeDatasV3",e[e.ImportFormulas=2]="ImportFormulas",e[e.DocsTitles=3]="DocsTitles"}(dw||(dw={}));var mw,gw=20,yw=18e4;!function(e){e.onDeleteFormula="onDeleteImportRangeFormula",e.onAddFormula="onAddImportRangeFormula",e.onAfterRequest="onAfterRequest",e.onReceiveDataset="onReceiveImportRangeDataset",e.onReceiveData="onReceiveImportRangeData",e.onReceiveDataHash="onReceiveDataHash",e.onRefreshData="onRefreshData",e.onDeactivateImportRange="onDeactivateImportRange",e.onImportRangeValueChanged="onImportRangeValueChanged",e.onDeleteFormulaV3="onDeleteFormulaV3"}(mw||(mw={}));var _w={retriedTimes:0,forceFetch:!1,delayTimeBeforeFetch:0,shouldRetry:!0,retryImportRangeErrorCodes:[Ce.O6N.DATA_NOT_READY]};function Rw(e){var t,r;return{promise:new Promise((function(n,a){t=n,r=a,null!=e&&e(n,a)})),resolve:t,reject:r}}function Cw(e,t){if(Array.isArray(e)){for(var r="",n=0;n<e.length;++n){var a=e[n];"mention"===a.type&&"id"in a&&t.mention?r+=t.mention[a.id].text:"text"in a&&(r+=a.text||"")}return Cw(r,t)}switch((0,R.Z)(e)){case"string":return new it.StringVar(e);case"number":return new it.NumberVar(e);case"boolean":return new it.BooleanVar(e);default:return it.NULL_VAR}}function ww(e){var t,r={};if(!e)return r;var n=hr.concat(e.map((function(e){return hr.from(e.gzip_datatable,"base64")}))),a=(0,Ce.ecX)(n.toString("base64"));return null!=a&&null!==(t=a.entities)&&void 0!==t&&t.styles&&(r.style=a.entities.styles),null!=a&&a.mention&&(r.mention=a.mention),r}function Ew(e,t){return kw.apply(this,arguments)}function kw(){return kw=(0,u.Z)(i().mark((function e(t,r){var n,a,o,u=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=u.length>2&&void 0!==u[2]?u[2]:gw,a=[],o=0;case 3:if(!(o<t.length)){e.next=13;break}if(a.push(t[o]),e.t0=a.length>=n,!e.t0){e.next=10;break}return e.next=9,r(a);case 9:a=[];case 10:o++,e.next=3;break;case 13:if(e.t1=a.length,!e.t1){e.next=17;break}return e.next=17,r(a);case 17:case"end":return e.stop()}}),e)}))),kw.apply(this,arguments)}function Tw(e){return!(e instanceof Ce.rBk)&&e.hasOwnProperty("isNoChange")}function Sw(e){return e.hasOwnProperty("importRangeId")}function Aw(e,t){return e.getCalcEngine().formulaSpace.formulas.has(t)}function Iw(e){var t=e.rowCount,r=e.colCount,n=e.metaToken,a=e.hash,o=e.blocks,i={extraInfo:ww(e.snapshotBlocks),dataTable:[]};if(!o||0===o.length){i.dataTable=[];for(var u=0;u<t;++u)i.dataTable.push(new Array(r).fill(it.NULL_VAR));return{data:i,updateTime:e.updateTime,metaToken:n,hash:a}}for(var s=0,l=0,c=0;c<o.length;++c){for(var h=o[c],f=h.rowsCount,d=h.startRowIndex,v=s;v<d;++v)i.dataTable[v]=new Array(r).fill(it.NULL_VAR);l+=h.gzip_datatable.length;for(var p=(0,Ce.ecX)(h.gzip_datatable),m=d+f,g=s;g<m;++g)if(p.rows[g-s]){i.dataTable[g]||(i.dataTable[g]=[]);for(var y=p.rows[g-s].columns,_=0;_<r;++_){var R=it.NULL_VAR;if(_<y.length&&y[_]){var C=y[_],w=C.value,E=C.styleId,k=C.reminderId;if(R=Cw(w,i.extraInfo),k){var T=UC();if(E&&i.extraInfo.style){var S=i.extraInfo.style[E],A=S.autoFormatter,I=S.formatter,O=(null==I?void 0:I.formatCached)||(null==A?void 0:A.formatCached);O&&"General"!==O&&(T=O)}R.setSpecialInfo({customData:{autoFormat:T}})}else if(E&&i.extraInfo.style){var V=i.extraInfo.style[E],N=V.autoFormatter,b=V.formatter,M=(null==b?void 0:b.formatCached)||(null==N?void 0:N.formatCached);M&&R.setSpecialInfo({customData:{autoFormat:M}})}}i.dataTable[g][_]=R}}else i.dataTable[g]=new Array(r).fill(it.NULL_VAR);s=m}l&&Ce.Ps3.collectSuiteEvent("client_sheet_path_tracker_dev",{trace_code:15,length:l});for(var F=s;F<t;++F)i.dataTable[F]=new Array(r).fill(it.NULL_VAR);return{data:i,updateTime:e.updateTime,metaToken:n,hash:a}}var Ow=1e3,Vw=32,Nw=12e4;var bw=function(){function e(t){(0,y.Z)(this,e),this.requestArray=t}return(0,_.Z)(e,[{key:"resolve",value:function(e){this.requestArray.forEach((function(t){return(0,t.resolve)(e)})),this.requestArray=[]}},{key:"reject",value:function(e){this.requestArray.forEach((function(t){return(0,t.reject)(e)})),this.requestArray=[]}}]),e}(),Mw=function(e){function t(e,r,n){var a;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).requestFn=e,a.spreadToken=n,a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exec",value:function(){return this.requestFn(Array.from(new Set(this.requestArray.map((function(e){return e.importRangeId})))),this.spreadToken)}},{key:"remove",value:function(e){for(var t=this.requestArray.length-1;t>=0;t--){var r=this.requestArray[t];if(r.importRangeId===e)return r.reject(Ce.DZv[Ce.O6N.REQUEST_FAIL]),this.requestArray.splice(t,1),!0}return!1}}]),t}(bw),Fw=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).requestFn=e,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exec",value:function(){return this.requestFn(this.requestArray.map((function(e){return e.params})))}}]),t}(bw),Zw=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).requestFn=e,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exec",value:function(){return this.requestFn(this.requestArray[0].spreadToken,this.requestArray.map((function(e){return e.params})))}}]),t}(bw),xw=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).requestFn=e,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exec",value:function(){var e=new Map;return this.requestArray.forEach((function(t){return t.data.forEach((function(t){e.has(t.token)||e.set(t.token,t)}))})),this.requestFn(Array.from(e.values()))}}]),t}(bw),Dw=function(){function e(t){(0,y.Z)(this,e),this.fetchList=t,this.requestQueue=[],this.requestTime=[],this.pendingCount=0,this.timer=null,this.mergedTimer=null,this.mergedDelayTime=1e3,this.requestPromiseArray=[]}return(0,_.Z)(e,[{key:"setDelayTime",value:function(e){this.mergedDelayTime=e}},{key:"push",value:function(e){var t=this;this.requestPromiseArray.push(e),null===this.mergedTimer&&(this.mergedTimer=setTimeout((function(){return t.processMergeTimer()}),this.mergedDelayTime))}},{key:"processMergeTimer",value:function(){for(;this.requestPromiseArray.length;)this.mergedAndPoll();this.mergedTimer&&clearTimeout(this.mergedTimer),this.mergedTimer=null}},{key:"mergedImpoarRangeDataRequest",value:function(e){var t=this,r={};e.forEach((function(e){var t=e.spreadToken;r[t]?r[t].push(e):r[t]=[e]}));var n=[];return Object.entries(r).forEach((function(e){var r=(0,g.Z)(e,2),a=r[0],o=r[1];return n.push(new Mw(t.fetchList[dw.ImportRangeDatas],o,a))})),n}},{key:"mergedAndPoll",value:function(){var e=[],t=[],r=[],n=[];if(this.requestPromiseArray.forEach((function(a){switch(a.type){case dw.ImportRangeDatas:e.push(a);break;case dw.ImportRangeDatasV3:t.push(a);break;case dw.DocsTitles:r.push(a);break;case dw.ImportFormulas:n.push(a)}})),e.length&&this.fetchList[dw.ImportRangeDatas]){var a=this.mergedImpoarRangeDataRequest(e);(0,Ce.hTd)(this.requestQueue,a)}t.length&&this.fetchList[dw.ImportRangeDatasV3]&&this.requestQueue.push(new Fw(this.fetchList[dw.ImportRangeDatasV3],t)),r.length&&this.fetchList[dw.DocsTitles]&&this.requestQueue.push(new xw(this.fetchList[dw.DocsTitles],r)),n.length&&this.fetchList[dw.ImportFormulas]&&this.requestQueue.push(new Zw(this.fetchList[dw.ImportFormulas],n)),this.requestPromiseArray=[],this.poll()}},{key:"poll",value:function(){for(var e=this;this.requestTime.length>0&&this.requestTime[0]<Date.now()-Ow;)this.requestTime.shift();if(!(this.pendingCount>=6)){if(this.requestTime.length>=Vw)return null!=this.timer&&clearTimeout(this.timer),void(this.timer=setTimeout(this.poll.bind(this),Ow/2));var t=this.requestQueue.shift();if(null!=t){this.requestTime.push(Date.now()),this.pendingCount++;var r=Pw(t.exec.bind(t)).finally((function(){e.pendingCount--,e.poll()}));t.resolve(r),this.poll()}}}},{key:"remove",value:function(e){for(var t=this.requestPromiseArray.length-1;t>=0;t--){var r=this.requestPromiseArray[t];if(Sw(r)&&r.importRangeId===e)return void this.requestPromiseArray.splice(t,1)}for(var n=this.requestQueue.length-1;n>=0;n--){var a=this.requestQueue[n];if(a instanceof Mw&&a.remove(e))return}}},{key:"dispose",value:function(){for(var e=this.requestQueue.length-1;e>=0;e--)this.requestQueue[e].reject(Ce.DZv[Ce.O6N.REQUEST_FAIL]);this.requestQueue=[],null!=this.timer&&clearTimeout(this.timer),this.timer=null,this.mergedTimer&&clearTimeout(this.mergedTimer),this.mergedTimer=null}}]),e}();function Pw(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Nw;return new Promise((function(r,n){var a=setTimeout((function(){console.error("request timeout"),n(Ce.DZv[Ce.O6N.REQUEST_FAIL])}),t),o=e();o?o.then(r).catch(n).finally((function(){clearTimeout(a)})):(r({}),clearTimeout(a))}))}var $w=2147483647,Lw=/[^\x20-\x7E]/,Bw=/[\x2E\u3002\uFF0E\uFF61]/g,Uw={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},Hw=Math.floor,zw=String.fromCharCode;function Ww(e){throw new RangeError(Uw[e])}function Gw(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function jw(e,t,r){var n=0;for(e=r?Hw(e/700):e>>1,e+=Hw(e/t);e>455;n+=36)e=Hw(e/35);return Hw(n+36*e/(e+38))}function Yw(e){return function(e,t){var r=e.split("@"),n="";return r.length>1&&(n=r[0]+"@",e=r[1]),n+function(e,t){for(var r=e.length,n=[];r--;)n[r]=t(e[r]);return n}((e=e.replace(Bw,".")).split("."),t).join(".")}(e,(function(e){return Lw.test(e)?"xn--"+function(e){var t,r,n,a,o,i,u,s,l,c,h,f,d,v,p,m=[];for(f=(e=function(e){for(var t,r,n=[],a=0,o=e.length;a<o;)(t=e.charCodeAt(a++))>=55296&&t<=56319&&a<o?56320==(64512&(r=e.charCodeAt(a++)))?n.push(((1023&t)<<10)+(1023&r)+65536):(n.push(t),a--):n.push(t);return n}(e)).length,t=128,r=0,o=72,i=0;i<f;++i)(h=e[i])<128&&m.push(zw(h));for(n=a=m.length,a&&m.push("-");n<f;){for(u=$w,i=0;i<f;++i)(h=e[i])>=t&&h<u&&(u=h);for(u-t>Hw(($w-r)/(d=n+1))&&Ww("overflow"),r+=(u-t)*d,t=u,i=0;i<f;++i)if((h=e[i])<t&&++r>$w&&Ww("overflow"),h==t){for(s=r,l=36;!(s<(c=l<=o?1:l>=o+26?26:l-o));l+=36)p=s-c,v=36-c,m.push(zw(Gw(c+p%v,0))),s=Hw(p/v);m.push(zw(Gw(s,0))),o=jw(r,d,n==a),r=0,++n}++r,++t}return m.join("")}(e):e}))}function qw(e){return null===e}function Jw(e){return"string"==typeof e}function Kw(e){return"object"==(0,R.Z)(e)&&null!==e}function Xw(e,t){return Object.prototype.hasOwnProperty.call(e,t)}var Qw=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function eE(e){switch((0,R.Z)(e)){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function tE(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var rE=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t};function nE(e,t,r,n){t=t||"&",r=r||"=";var a={};if("string"!=typeof e||0===e.length)return a;var o=/\+/g;e=e.split(t);var i=1e3;n&&"number"==typeof n.maxKeys&&(i=n.maxKeys);var u=e.length;i>0&&u>i&&(u=i);for(var s=0;s<u;++s){var l,c,h,f,d=e[s].replace(o,"%20"),v=d.indexOf(r);v>=0?(l=d.substr(0,v),c=d.substr(v+1)):(l=d,c=""),h=decodeURIComponent(l),f=decodeURIComponent(c),Xw(a,h)?Qw(a[h])?a[h].push(f):a[h]=[a[h],f]:a[h]=f}return a}var aE={parse:EE,resolve:function(e,t){return EE(e,!1,!0).resolve(t)},resolveObject:function(e,t){return e?EE(e,!1,!0).resolveObject(t):t},format:function(e){return Jw(e)&&(e=kE({},e)),TE(e)},Url:oE};function oE(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var iE,uE,sE,lE,cE,hE=/^([a-z0-9.+-]+:)/i,fE=/:[0-9]*$/,dE=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,vE=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),pE=["'"].concat(vE),mE=["%","/","?",";","#"].concat(pE),gE=["/","?","#"],yE=/^[+a-z0-9A-Z_-]{0,63}$/,_E=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,RE={javascript:!0,"javascript:":!0},CE={javascript:!0,"javascript:":!0},wE={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0};function EE(e,t,r){if(e&&Kw(e)&&e instanceof oE)return e;var n=new oE;return n.parse(e,t,r),n}function kE(e,t,r,n){if(!Jw(t))throw new TypeError("Parameter 'url' must be a string, not "+(0,R.Z)(t));var a=t.indexOf("?"),o=-1!==a&&a<t.indexOf("#")?"?":"#",i=t.split(o);i[0]=i[0].replace(/\\/g,"/");var u=t=i.join(o);if(u=u.trim(),!n&&1===t.split("#").length){var s=dE.exec(u);if(s)return e.path=u,e.href=u,e.pathname=s[1],s[2]?(e.search=s[2],e.query=r?nE(e.search.substr(1)):e.search.substr(1)):r&&(e.search="",e.query={}),e}var l,c,h,f,d=hE.exec(u);if(d){var v=(d=d[0]).toLowerCase();e.protocol=v,u=u.substr(d.length)}if(n||d||u.match(/^\/\/[^@\/]+@[^@\/]+/)){var p="//"===u.substr(0,2);!p||d&&CE[d]||(u=u.substr(2),e.slashes=!0)}if(!CE[d]&&(p||d&&!wE[d])){var m,g,y=-1;for(l=0;l<gE.length;l++)-1!==(c=u.indexOf(gE[l]))&&(-1===y||c<y)&&(y=c);for(-1!==(g=-1===y?u.lastIndexOf("@"):u.lastIndexOf("@",y))&&(m=u.slice(0,g),u=u.slice(g+1),e.auth=decodeURIComponent(m)),y=-1,l=0;l<mE.length;l++)-1!==(c=u.indexOf(mE[l]))&&(-1===y||c<y)&&(y=c);-1===y&&(y=u.length),e.host=u.slice(0,y),u=u.slice(y),SE(e),e.hostname=e.hostname||"";var _="["===e.hostname[0]&&"]"===e.hostname[e.hostname.length-1];if(!_){var C=e.hostname.split(/\./);for(l=0,h=C.length;l<h;l++){var w=C[l];if(w&&!w.match(yE)){for(var E="",k=0,T=w.length;k<T;k++)w.charCodeAt(k)>127?E+="x":E+=w[k];if(!E.match(yE)){var S=C.slice(0,l),A=C.slice(l+1),I=w.match(_E);I&&(S.push(I[1]),A.unshift(I[2])),A.length&&(u="/"+A.join(".")+u),e.hostname=S.join(".");break}}}}e.hostname.length>255?e.hostname="":e.hostname=e.hostname.toLowerCase(),_||(e.hostname=Yw(e.hostname)),f=e.port?":"+e.port:"";var O=e.hostname||"";e.host=O+f,e.href+=e.host,_&&(e.hostname=e.hostname.substr(1,e.hostname.length-2),"/"!==u[0]&&(u="/"+u))}if(!RE[v])for(l=0,h=pE.length;l<h;l++){var V=pE[l];if(-1!==u.indexOf(V)){var N=encodeURIComponent(V);N===V&&(N=escape(V)),u=u.split(V).join(N)}}var b=u.indexOf("#");-1!==b&&(e.hash=u.substr(b),u=u.slice(0,b));var M=u.indexOf("?");if(-1!==M?(e.search=u.substr(M),e.query=u.substr(M+1),r&&(e.query=nE(e.query)),u=u.slice(0,M)):r&&(e.search="",e.query={}),u&&(e.pathname=u),wE[v]&&e.hostname&&!e.pathname&&(e.pathname="/"),e.pathname||e.search){f=e.pathname||"";var F=e.search||"";e.path=f+F}return e.href=TE(e),e}function TE(e){var t=e.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var r=e.protocol||"",n=e.pathname||"",a=e.hash||"",o=!1,i="";e.host?o=t+e.host:e.hostname&&(o=t+(-1===e.hostname.indexOf(":")?e.hostname:"["+this.hostname+"]"),e.port&&(o+=":"+e.port)),e.query&&Kw(e.query)&&Object.keys(e.query).length&&(i=function(e,t,r,n){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==(0,R.Z)(e)?tE(rE(e),(function(n){var a=encodeURIComponent(eE(n))+r;return Qw(e[n])?tE(e[n],(function(e){return a+encodeURIComponent(eE(e))})).join(t):a+encodeURIComponent(eE(e[n]))})).join(t):n?encodeURIComponent(eE(n))+r+encodeURIComponent(eE(e)):""}(e.query));var u=e.search||i&&"?"+i||"";return r&&":"!==r.substr(-1)&&(r+=":"),e.slashes||(!r||wE[r])&&!1!==o?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),a&&"#"!==a.charAt(0)&&(a="#"+a),u&&"?"!==u.charAt(0)&&(u="?"+u),r+o+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(u=u.replace("#","%23"))+a}function SE(e){var t=e.host,r=fE.exec(t);r&&(":"!==(r=r[0])&&(e.port=r.substr(1)),t=t.substr(0,t.length-r.length)),t&&(e.hostname=t)}oE.prototype.parse=function(e,t,r){return kE(this,e,t,r)},oE.prototype.format=function(){return TE(this)},oE.prototype.resolve=function(e){return this.resolveObject(EE(e,!1,!0)).format()},oE.prototype.resolveObject=function(e){if(Jw(e)){var t=new oE;t.parse(e,!1,!0),e=t}for(var r,n=new oE,a=Object.keys(this),o=0;o<a.length;o++){var i=a[o];n[i]=this[i]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var u=Object.keys(e),s=0;s<u.length;s++){var l=u[s];"protocol"!==l&&(n[l]=e[l])}return wE[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!wE[e.protocol]){for(var c=Object.keys(e),h=0;h<c.length;h++){var f=c[h];n[f]=e[f]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||CE[e.protocol])n.pathname=e.pathname;else{for(r=(e.pathname||"").split("/");r.length&&!(e.host=r.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==r[0]&&r.unshift(""),r.length<2&&r.unshift(""),n.pathname=r.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var d=n.pathname||"",v=n.search||"";n.path=d+v}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var p,m=n.pathname&&"/"===n.pathname.charAt(0),g=e.host||e.pathname&&"/"===e.pathname.charAt(0),y=g||m||n.host&&e.pathname,_=y,R=n.pathname&&n.pathname.split("/")||[],C=n.protocol&&!wE[n.protocol];if(r=e.pathname&&e.pathname.split("/")||[],C&&(n.hostname="",n.port=null,n.host&&(""===R[0]?R[0]=n.host:R.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===r[0]?r[0]=e.host:r.unshift(e.host)),e.host=null),y=y&&(""===r[0]||""===R[0])),g)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,R=r;else if(r.length)R||(R=[]),R.pop(),R=R.concat(r),n.search=e.search,n.query=e.query;else if(!function(e){return null==e}(e.search))return C&&(n.hostname=n.host=R.shift(),(p=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=p.shift(),n.host=n.hostname=p.shift())),n.search=e.search,n.query=e.query,qw(n.pathname)&&qw(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n;if(!R.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var w=R.slice(-1)[0],E=(n.host||e.host||R.length>1)&&("."===w||".."===w)||""===w,k=0,T=R.length;T>=0;T--)"."===(w=R[T])?R.splice(T,1):".."===w?(R.splice(T,1),k++):k&&(R.splice(T,1),k--);if(!y&&!_)for(;k--;k)R.unshift("..");!y||""===R[0]||R[0]&&"/"===R[0].charAt(0)||R.unshift(""),E&&"/"!==R.join("/").substr(-1)&&R.push("");var S=""===R[0]||R[0]&&"/"===R[0].charAt(0);return C&&(n.hostname=n.host=S?"":R.length?R.shift():"",(p=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=p.shift(),n.host=n.hostname=p.shift())),(y=y||n.host&&R.length)&&!S&&R.unshift(""),R.length?n.pathname=R.join("/"):(n.pathname=null,n.path=null),qw(n.pathname)&&qw(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},oE.prototype.parseHost=function(){return SE(this)},function(e){e[e.NotFirstCreate=0]="NotFirstCreate",e[e.FirstCreate=1]="FirstCreate"}(iE||(iE={})),function(e){e.RequestData="request_data",e.CacheHit="cache_hit"}(uE||(uE={})),function(e){e.Server="server",e.Front="front",e.HeartBeat="heartBeat",e.Refresh="refresh"}(sE||(sE={})),function(e){e.onCreateImportRangeId="onCreateImportRangeId",e.onRequestDocument="onRequestDocument",e.onRequestError="onRequestError",e.onRequestSuccess="onRequestSuccess",e.onDeleteFormula="onDeleteFormula",e.onDeactivateImportRange="onDeactivateImportRange",e.onServerSidePush="onServerSidePush",e.onCacheHitInfoCollect="onCacheHitInfoCollect",e.onRequestSuccessFromHeartBeat="onRequestSuccessFromHeartBeat",e.onRequestErrorFromHeartBeat="onRequestErrorFromHeartBeat"}(lE||(lE={}));var AE=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ce.waj.V2;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).spread=e,r.version=n,r.importRangePerformanceDataMap=new Map,r.onCreateImportRangeId=function(e){r.importRangePerformanceDataMap.set(e,{isFirstCreate:1,startTime:null})},r.onRequestDocument=function(e){var t=r.importRangePerformanceDataMap.get(e),n=window.performance?window.performance.now():Date.now();null==t?r.importRangePerformanceDataMap.set(e,{isFirstCreate:0,startTime:n}):null==t.startTime&&(t.startTime=n)},r.onRequestError=function(e,t){var n=r.importRangePerformanceDataMap.get(e);if(null!=n){var a=n.isFirstCreate,o=n.startTime;if(r.importRangePerformanceDataMap.delete(e),null!=o){var i={isFirstCreate:a,costTime:(window.performance?window.performance.now():Date.now())-o,errorCode:t,source:"front"};Ce.Ps3.collectSuiteEvent("sheet_importrange_cost_time_dev",i)}}},r.onRequestSuccess=function(e,t){var n=r.importRangePerformanceDataMap.get(e);if(null!=n){var a=n.isFirstCreate,o=n.startTime;if(r.importRangePerformanceDataMap.delete(e),null!=o){var i={isFirstCreate:a,costTime:(window.performance?window.performance.now():Date.now())-o,errorCode:0,source:"front"},u=r.getDataInfo(t);Object.assign(i,u),Ce.Ps3.collectSuiteEvent("sheet_importrange_cost_time_dev",i)}}},r.onDeleteFormula=function(e){r.importRangePerformanceDataMap.delete(e)},r.onDeactivateImportRange=function(e){r.importRangePerformanceDataMap.delete(e)},r.onServerSidePush=function(e,t){var n={errorCode:t,source:"server"},a=r.importRangePerformanceDataMap.get(e);if(null!=a){var o=a.isFirstCreate,i=a.startTime;if(null!=i&&1===o){var u=(window.performance?window.performance.now():Date.now())-i;Object.assign(n,{isFirstCreate:o,costTime:u})}}Ce.Ps3.collectSuiteEvent("sheet_importrange_cost_time_dev",n)},r.onCacheHitInfoCollect=function(e,t){Ce.Ps3.collectSuiteEvent("sheet_importrange_stage_dev",{stage:e,source:t})},r.onRequestSuccessFromHeartBeat=function(e){var t={errorCode:0,source:"heartBeat"},n=r.getDataInfo(e);Object.assign(t,n),Ce.Ps3.collectSuiteEvent("sheet_importrange_cost_time_dev",t)},r.onRequestErrorFromHeartBeat=function(e){var t={errorCode:e,source:"heartBeat"};Ce.Ps3.collectSuiteEvent("sheet_importrange_cost_time_dev",t)},r.onCompileImportRange=function(e){Ce.Ps3.collectSuiteEvent("sheet_importrange_compile_infos_dev",{count:e.length})},r.bindEvents(),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"bindEvents",value:function(){this.addListener("onCreateImportRangeId",this.onCreateImportRangeId),this.addListener("onRequestDocument",this.onRequestDocument),this.addListener("onRequestError",this.onRequestError),this.addListener("onRequestSuccess",this.onRequestSuccess),this.addListener("onDeleteFormula",this.onDeleteFormula),this.addListener("onDeactivateImportRange",this.onDeactivateImportRange),this.addListener("onServerSidePush",this.onServerSidePush),this.addListener("onCacheHitInfoCollect",this.onCacheHitInfoCollect),this.addListener("onRequestSuccessFromHeartBeat",this.onRequestSuccessFromHeartBeat),this.addListener("onRequestErrorFromHeartBeat",this.onRequestErrorFromHeartBeat)}},{key:"unbindEvents",value:function(){this.removeListener("onCreateImportRangeId",this.onCreateImportRangeId),this.removeListener("onRequestDocument",this.onRequestDocument),this.removeListener("onRequestError",this.onRequestError),this.removeListener("onRequestSuccess",this.onRequestSuccess),this.removeListener("onDeleteFormula",this.onDeleteFormula),this.removeListener("onDeactivateImportRange",this.onDeactivateImportRange),this.removeListener("onServerSidePush",this.onServerSidePush),this.removeListener("onCacheHitInfoCollect",this.onCacheHitInfoCollect),this.removeListener("onRequestSuccessFromHeartBeat",this.onRequestSuccessFromHeartBeat),this.removeListener("onRequestErrorFromHeartBeat",this.onRequestErrorFromHeartBeat)}},{key:"dispose",value:function(){this.unbindEvents(),this.importRangePerformanceDataMap.clear()}},{key:"getDataInfo",value:function(e){var t=e.data.dataTable,r=t.length,n=t[0].length;return{rowCount:r,colCount:n,size:r*n}}}]),t}(Ce.vpe);function IE(e){for(var t=e.rowCounts,r=e.rowStarts,n=e.tokens,a=e.gzipMap,o=[],i=0;i<n.length;i++)o.push({block_token:n[i],gzip_datatable:a[n[i]],startRowIndex:r[i],rowsCount:t[i]});return o}function OE(e,t){return VE.apply(this,arguments)}function VE(){return VE=(0,u.Z)(i().mark((function e(t,r){var n,a,o,s=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:{},a={},o=function(){var e=(0,u.Z)(i().mark((function e(t){var o,u,s,l,c,h,f;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce.Ps3.serverApi.importRange.requestImportRangeMetas({importrange_ids:t,token:r});case 2:if(void 0===(o=e.sent)){e.next=26;break}e.t0=i().keys(o);case 5:if((e.t1=e.t0()).done){e.next=24;break}if(u=e.t1.value,s=o[u],l=s.importrangeMetaToken,!(c=(0,Ce.rR3)(s.dataType))){e.next=11;break}return a[u]=c,e.abrupt("continue",5);case 11:if(8!==s.dataType){e.next=14;break}return a[u]={isNoChange:!0,updateTime:Date.now()},e.abrupt("continue",5);case 14:if(!(h=n[l])||h.hash!==s.importrangeMeta.hash){e.next=18;break}return a[u]=h,e.abrupt("continue",5);case 18:return e.next=20,NE(r,s);case 20:f=e.sent,n[l]=f,a[u]=f,e.next=5;break;case 24:e.next=27;break;case 26:t.forEach((function(e){return a[e]=null}));case 27:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=4,Ew(t,o);case 4:return e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)}))),VE.apply(this,arguments)}function NE(e,t){return bE.apply(this,arguments)}function bE(){return bE=(0,u.Z)(i().mark((function e(t,r){var n,a,o,s,l,c,h,f,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.importrangeMeta,a=n.rowCounts,o=n.rowStarts,s=n.range,l=n.hash,c=n.dataBlockTokens,h=n.snapshotBlockTokens,f={},d=function(){var e=(0,u.Z)(i().mark((function e(n){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce.Ps3.serverApi.importRange.requestSubBlock({token:t,access_key:r.accessKey,block_tokens:n});case 2:a=e.sent,Object.assign(f,a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=3,Ew(Array.prototype.concat.call(c,h),d);case 3:return e.abrupt("return",{metaToken:r.importrangeMetaToken,accessKey:r.accessKey,hash:l,rowCount:s.RowCount,colCount:s.ColCount,updateTime:Date.now(),blocks:IE({rowCounts:a,rowStarts:o,gzipMap:f,tokens:c}),snapshotBlocks:IE({rowCounts:a,rowStarts:o,gzipMap:f,tokens:h})});case 4:case"end":return e.stop()}}),e)}))),bE.apply(this,arguments)}function ME(){return ME=(0,u.Z)(i().mark((function e(t,r){var n,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n={},0!==t.length){e.next=3;break}return e.abrupt("return",n);case 3:return a=function(){var e=(0,u.Z)(i().mark((function e(t){var a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce.Ps3.serverApi.importRange.requestHeartBeat({token:r,importrange_meta_tokens:t});case 2:a=e.sent,Object.assign(n,a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=6,Ew(t,a);case 6:return e.abrupt("return",n);case 7:case"end":return e.stop()}}),e)}))),ME.apply(this,arguments)}var FE=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:OE;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).workbook=e,r._requestMethod=n,r.importRangeDataMap=new Map,r.importRangeFormulasMap=new Map,r.importRangeReadyToInstantiateMetaMap=new Map,r.importRangePromiseMap=new Map,r.requestDocumentPromiseMap=new Map,r.importRangeHeartBeatInterval=null,r.importRangeHeartBeatIntervalTime=yw,r._isDestroy=!1,r.rangeCache=!0,r.importRangeAutoExpand=new Set,r.shouldHeartBeat=!0,r.monitorImportRangeHeartBeat=(0,u.Z)(i().mark((function e(){var t,n,a,o,u,s,l,c,h,f,d,v,p,y;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.isDestroy){e.next=2;break}return e.abrupt("return");case 2:return a=r.getCurrentSpreadToken(),o=new Set,r.importRangeDataMap.forEach((function(e){e instanceof Ce.rBk||o.add(e.metaToken)})),e.next=6,r.requestImportRangeDataHash((0,m.Z)(o),a);case 6:u=e.sent,s={},l=yr(r.importRangeDataMap),e.prev=9,l.s();case 11:if((c=l.n()).done){e.next=28;break}if(h=(0,g.Z)(c.value,2),f=h[0],!((d=h[1])instanceof Ce.rBk)){e.next=15;break}return e.abrupt("continue",26);case 15:if(null!=r.getMetaFromId(f)){e.next=17;break}return e.abrupt("continue",26);case 17:if(v=d.hash,p=d.metaToken,!u[p]||v===u[p]){e.next=25;break}return e.next=21,r.requestMethod([f],a);case 21:y=e.sent,r.handleImportRangeDatas(y),e.next=26;break;case 25:s[f]={isNoChange:!0,updateTime:Date.now()};case 26:e.next=11;break;case 28:e.next=33;break;case 30:e.prev=30,e.t0=e.catch(9),l.e(e.t0);case 33:return e.prev=33,l.f(),e.finish(33);case 36:r.handleImportRangeDatas(s),null===(t=(n=r).hookAfterHeartBeat)||void 0===t||t.call(n);case 37:case"end":return e.stop()}}),e,null,[[9,30,33,36]])}))),r.updateDependImportRanges=(0,u.Z)(i().mark((function e(){var t,n,a,o,u,s,l,c,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=20,!r.isDestroy){e.next=3;break}return e.abrupt("return");case 3:n=r.getCurrentSpreadToken(),a=[],o=yr(r.importRangeDataMap),e.prev=6,o.s();case 8:if((u=o.n()).done){e.next=19;break}if(s=(0,g.Z)(u.value,2),l=s[0],!(s[1]instanceof Ce.rBk)){e.next=12;break}return e.abrupt("continue",17);case 12:if(!(null!=r.getMetaFromId(l)&&(a.push(l),a.length>=t))){e.next=17;break}return e.next=15,r.requestMethod(a,n);case 15:c=e.sent,r.handleImportRangeDatas(c),a=[];case 17:e.next=8;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(6),o.e(e.t0);case 24:return e.prev=24,o.f(),e.finish(24);case 27:if(!(a.length>=1)){e.next=32;break}return e.next=30,r.requestMethod(a,n);case 30:h=e.sent,r.handleImportRangeDatas(h);case 32:case"end":return e.stop()}}),e,null,[[6,21,24,27]])}))),r.importRangePerformance=new AE(r.workbook),r}var r,n;return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"isDestroy",get:function(){return this._isDestroy}}]),(0,_.Z)(t,[{key:"clearRetryTimer",value:function(e){null!=e.retryTimer&&clearTimeout(e.retryTimer),e.retryTimer=void 0}},{key:"handleRequestError",value:function(e,r,n,a){var o,i=this,u=this.getImportRangePromise(e);if(null!=u){var s=a.retriedTimes||0;if(a.shouldRetry&&null!==(o=a.retryImportRangeErrorCodes)&&void 0!==o&&o.includes(n.code))return function(){i.clearRetryTimer(u);var o=window.setTimeout((function(){u.retryTimer=void 0,i.importRangePromiseMap.delete(e),s>=2?u.reject(n):(a.retriedTimes=++s,i.requestImportRangeData(e,r,a).then(u.resolve).catch(u.reject))}),t.REQUEST_TIMEOUT);u.retryTimer=o}();this.importRangePromiseMap.delete(e),u.reject(n)}}},{key:"setEnableRangeCache",value:function(e){this.rangeCache=e}},{key:"getEnableRangeCache",value:function(){return this.rangeCache}},{key:"initRequestImportRangeMergedQueue",value:function(e){var t;this.requestImportRangeMergedQueue||(this.requestImportRangeMergedQueue=new Dw((t={},(0,l.Z)(t,dw.ImportRangeDatas,this._requestMethod),(0,l.Z)(t,dw.DocsTitles,Ce.Ps3.batchFetchDocsTitles),t)),void 0!==e&&this.requestImportRangeMergedQueue.setDelayTime(e))}},{key:"requestImportRangeData",value:function(e,t,r){var n=this,a=this.getImportRangePromise(e);if(null!=a){if(!r.forceFetch)return a.promise;clearTimeout(a.retryTimer)}this.importRangePerformance.emit("onCacheHitInfoCollect","request_data","front");var o=0,s=null;r.delayTimeBeforeFetch&&(s=function(e,t){var r,n,a=new Promise((function(e,t){r=e,n=t})),o=window.setTimeout((0,u.Z)(i().mark((function t(){return i().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.t0=r,t.next=4,e();case 4:t.t1=t.sent,(0,t.t0)(t.t1),t.next=11;break;case 8:t.prev=8,t.t2=t.catch(0),n(t.t2);case 11:case"end":return t.stop()}}),t,null,[[0,8]])}))),t);return{promise:a,retryTimer:o,cancel:function(){clearTimeout(o),n(new Error("Cancelled"))}}}(this.requestMethod.bind(this,[e],t),r.delayTimeBeforeFetch),o=s.retryTimer);var l=this.getImportRangePromise(e),c=Rw(function(){var a=(0,u.Z)(i().mark((function a(o,u){var h,f;return i().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,null==s){a.next=7;break}return a.next=4,s.promise;case 4:a.t0=a.sent,a.next=10;break;case 7:return a.next=9,n.requestMethod([e],t);case 9:a.t0=a.sent;case 10:if(h=a.t0,null!=l&&l!==c&&c.promise.then(l.resolve).catch(l.reject),null!=h&&!n.isDestroy){a.next=14;break}return a.abrupt("return",(n.importRangePromiseMap.delete(e),void u(null)));case 14:if(!((f=h[e])instanceof Ce.rBk)){a.next=17;break}throw f;case 17:if(n.importRangePromiseMap.delete(e),null!=f){a.next=19;break}return a.abrupt("return",void u(null));case 19:o(f),a.next=27;break;case 22:if(a.prev=22,a.t1=a.catch(0),!(a.t1 instanceof Ce.rBk)){a.next=26;break}return a.abrupt("return",void n.handleRequestError(e,t,a.t1,r));case 26:n.importRangePromiseMap.delete(e),u(a.t1);case 27:case"end":return a.stop()}}),a,null,[[0,22]])})));return function(e,t){return a.apply(this,arguments)}}());return this.importRangePromiseMap.set(e,c),0!==o&&(c.retryTimer=o),c.promise}},{key:"requestMethod",value:function(e,t){var r=this;this.initRequestImportRangeMergedQueue();var n=Rw(),a=n.promise,o=n.resolve,i=n.reject;return e.forEach((function(e){r.requestImportRangeMergedQueue.push({resolve:o,reject:i,spreadToken:t,importRangeId:e,type:dw.ImportRangeDatas})})),a}},{key:"requestDocument",value:function(e,t,r){var n=this;if(null!=r&&r.forceFetch)return this.execRequestDocument(e,t,r);var a=this.requestDocumentPromiseMap.get(e);if(!a){var o=Rw(),i=o.promise,u=o.resolve,s=o.reject;return this.execRequestDocument(e,t,r).then((function(e){return u(e)})).catch((function(e){return s(e)})),this.requestDocumentPromiseMap.set(e,{promise:i,resolve:u,reject:s}),i.finally((function(){return n.requestDocumentPromiseMap.delete(e)})),i}return a.promise}},{key:"execRequestDocument",value:(n=(0,u.Z)(i().mark((function e(r,n){var a,o,u,s,l=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.length>2&&void 0!==l[2]?l[2]:Object.assign({},_w),e.prev=1,this.importRangePerformance.emit("onRequestDocument",r),e.next=5,this.requestImportRangeData(r,n,a);case 5:if(o=e.sent,this.emit("onAfterRequest",r),!Tw(o)){e.next=14;break}if(this.importRangePerformance.emit("onCacheHitInfoCollect","cache_hit","front"),!(null==(s=this.importRangeDataMap.get(r))||s instanceof Ce.rBk)){e.next=11;break}throw s||Ce.DZv[Ce.O6N.REQUEST_FAIL];case 11:s.updateTime=o.updateTime,u=s,e.next=15;break;case 14:u=t.getMergedData(o);case 15:return e.abrupt("return",!this.getMetaFromId(r)||this.isDestroy?null:(this.importRangePerformance.emit("onRequestSuccess",r,u),this.importRangeDataMap.set(r,u),this.markDirtyFormulasById(r),u));case 18:if(e.prev=18,e.t0=e.catch(1),e.t0 instanceof Ce.rBk){e.next=22;break}throw this.importRangePerformance.emit("onRequestError",r,-1),Ce.Ps3.moirae.ravenCatch(e.t0,{tags:{scm:JSON.stringify(window.scm),key:"SHEET_IMPORTRANGE_UNKNOWN_ERROR"},extras:{importRangeId:r}}),this.getMetaFromId(r)&&this.importRangeDataMap.set(r,Ce.DZv[Ce.O6N.REQUEST_FAIL]),e.t0;case 22:return e.abrupt("return",(this.importRangePerformance.emit("onRequestError",r,e.t0.code),this.getMetaFromId(r)&&this.importRangeDataMap.set(r,Ce.DZv[e.t0.code]),e.t0));case 23:case"end":return e.stop()}}),e,this,[[1,18]])}))),function(e,t){return n.apply(this,arguments)})},{key:"setRequestMethod",value:function(e){this._requestMethod=e}},{key:"getRequestMethod",value:function(){return this._requestMethod}},{key:"setImportRangeMeta",value:function(e,t){var r=this.importRangeReadyToInstantiateMetaMap.get(t.importRangeId);if(r){var n=r.findIndex((function(t){return t.sheetId===e.getRef().hostId}));-1!==n&&r.splice(n,1),r.length||this.importRangeReadyToInstantiateMetaMap.delete(t.importRangeId)}}},{key:"setImportRangeFormula",value:function(e,t){this.setImportRangeMeta(e,t);var r=this.importRangeFormulasMap.get(t.importRangeId);r?r.add(e):this.importRangeFormulasMap.set(t.importRangeId,new Set([e])),this.emit("onAddImportRangeFormula",e,t),this.handleRequestInApplyFormula(t),this.importRangeFormulasMap.size>=1&&!this.importRangeHeartBeatInterval&&this.setHeartBeatInterval()}},{key:"handleRequestInApplyFormula",value:function(e){e.hasOwnProperty("spreadName")||this.refreshMetaSpreadName([e]);var t=this.importRangeDataMap.get(e.importRangeId);t&&!(t instanceof Ce.rBk)||this.importRangePromiseMap.get(e.importRangeId)||this.requestDocument(e.importRangeId,this.getCurrentSpreadToken(),{shouldRetry:!0,delayTimeBeforeFetch:3e3,retryImportRangeErrorCodes:[Ce.O6N.DATA_NOT_READY,Ce.O6N.REFERENCE_NOT_EXIST]})}},{key:"setFromJsonImportRangeMeta",value:function(e){var t=this.importRangeReadyToInstantiateMetaMap.get(e.importRangeId);t?t.push(e):this.importRangeReadyToInstantiateMetaMap.set(e.importRangeId,[e])}},{key:"getIdFromFormula",value:function(e){var t;return(null===(t=e.getImportRangeMeta())||void 0===t?void 0:t.importRangeId)||null}},{key:"getDataFromId",value:function(e){return this.importRangeDataMap.get(e)||null}},{key:"getFormulasFromId",value:function(e){return this.importRangeFormulasMap.get(e)||null}},{key:"getMetaFromId",value:function(e){var t=this.importRangeFormulasMap.get(e);if(t&&t.size){var r=t.values().next().value.getImportRangeMeta();if(r)return{spreadToken:r.spreadToken,spreadSource:r.spreadSource,ref:r.ref,isSyncStyle:r.isSyncStyle,importRangeId:r.importRangeId}}var n=this.importRangeReadyToInstantiateMetaMap.get(e);return n&&n[0]?{spreadToken:n[0].spreadToken,spreadSource:n[0].spreadSource,ref:n[0].ref,isSyncStyle:n[0].isSyncStyle,importRangeId:n[0].importRangeId}:null}},{key:"getMetaFromFormula",value:function(e){return e.getImportRangeMeta()||null}},{key:"clearMetaAndData",value:function(e){var t,r=this.getIdFromFormula(e),n=this.getMetaFromFormula(e);if(r&&n){this.requestDocumentPromiseMap.delete(r);var a=this.getImportRangePromise(r);a&&(this.clearRetryTimer(a),null!==(t=this.requestImportRangeMergedQueue)&&void 0!==t&&t.remove(r),this.importRangePromiseMap.delete(r));var o=this.importRangeFormulasMap.get(r);if(null!=o&&o.delete(e),this.emit("onDeleteImportRangeFormula",e,n),this.importRangePerformance.emit("onDeleteFormula",r),0===(null==o?void 0:o.size)){this.importRangeDataMap.delete(r),this.importRangeAutoExpand.delete(r),this.importRangeFormulasMap.delete(r);var i=this.importRangeReadyToInstantiateMetaMap.get(r);i&&i.length||(this.importRangeReadyToInstantiateMetaMap.delete(r),this.emit("onDeactivateImportRange",n),this.importRangePerformance.emit("onDeactivateImportRange",r))}this.importRangeFormulasMap.size<1&&this.clearHeartBeatInterval()}}},{key:"getCurrentSpreadToken",value:function(){return this.workbook.getService(It.UU).token}},{key:"generateAndCacheId",value:function(e,t){var r=this.generateImportRangeMeta(t);if(r){this.setImportRangeMeta(e,r),this.refreshMetaSpreadName([r]);var n=r.importRangeId,a=e.getRef(),o=a.rowFrom(),i=a.colFrom();return this.setImportRangeAutoExpand("".concat(n,"_").concat(o,"_").concat(i)),r}}},{key:"generateImportRangeMeta",value:function(e){var t=aE.parse(e.url).pathname;if(!t)return this.collectImportRangeFrontError("illegal_url"),null;var r=null==t?void 0:t.match(/^.*?\/([^\/]*)$/);if(!r)return this.collectImportRangeFrontError("unMatched_pathname"),null;var n=r[1];if(void 0===n)return this.collectImportRangeFrontError("spreadToken_is_undefined"),null;var a=od(e.range);if(!a||a.type===Ce.xj7.INVALID)return this.collectImportRangeFrontError("illegal_range"),null;var o=Object.assign({},a);return o.hasOwnProperty("sheetName")||(o.sheetName=""),{spreadToken:n,importRangeId:this.generateImportRangeId(e.range,n),ref:o,spreadSource:e.url,isSyncStyle:!1,sheetId:e.sheetID}}},{key:"generateImportRangeId",value:function(e,t){var r=this.rangeCache?At()("".concat(this.getCurrentSpreadToken(),"_").concat(t,"_").concat(e)):At()("".concat(this.getCurrentSpreadToken(),"_").concat(t,"_").concat(e,"_").concat(Date.now(),"_").concat((0,Ce.zsn)(8)));return this.importRangePerformance.emit("onCreateImportRangeId",r),r}},{key:"getImportRangeMetaWithUpdateTime",value:function(e){var t=e.getActiveSheet().id(),r=[],n=[],a=this.getImportRangeIDs(t);for(var o in a){var i=a[o],u=ga(i),s=this.getDataFromId(i.importRangeId);!s||s instanceof Ce.rBk||!s.updateTime||(u.updateTime=s.updateTime),r.push(i),n.push(u)}return r.length<=0||this.refreshMetaSpreadName(r),n}},{key:"batchFetchDocsTitles",value:function(e){var t;if(e.length<=0)return Promise.resolve(null);var r=Rw(),n=r.promise,a=r.resolve,o=r.reject;return this.initRequestImportRangeMergedQueue(),null!==(t=this.requestImportRangeMergedQueue)&&void 0!==t&&t.push({resolve:a,reject:o,data:e,type:dw.DocsTitles}),n}},{key:"refreshMetaSpreadName",value:(r=(0,u.Z)(i().mark((function e(t){var r,n,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.length<=0)){e.next=2;break}return e.abrupt("return");case 2:return n=t.map((function(e){return{token:e.spreadToken,typeNum:3}})),e.next=5,null===(r=this.batchFetchDocsTitles(n))||void 0===r?void 0:r.catch((function(){return null}));case 5:(a=e.sent)&&!this.isDestroy&&t.forEach((function(e){a[e.spreadToken]&&(e.spreadName=a[e.spreadToken].title)}));case 7:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"getImportRangeIDs",value:function(e){for(var t={},r=this.getImportRangeFormulas(),n=0;n<r.length;n++){var a=r[n],o=Object.assign({},a.getImportRangeMeta(),{sheetId:a.getRef().hostId});if(o&&o.sheetId===e){var i=o.importRangeId;t[i]?t[i].refCount++:t[i]=Object.assign({},o,{refCount:1})}}var u,s=yr(this.importRangeReadyToInstantiateMetaMap);try{var l=function(){var r=(0,g.Z)(u.value,2),n=r[0],a=r[1];a&&a.length&&a.forEach((function(r){var a;r.sheetId===e&&(t[n]=Object.assign({},r,{refCount:null!==(a=r.refCount)&&void 0!==a?a:1}))}))};for(s.s();!(u=s.n()).done;)l()}catch(e){s.e(e)}finally{s.f()}return t}},{key:"getAllImportRangeIds",value:function(){var e=new Set;return this.importRangeFormulasMap.forEach((function(t,r){return e.add(r)})),this.importRangeReadyToInstantiateMetaMap.forEach((function(t,r){return e.add(r)})),Array.from(e)}},{key:"countImportRange",value:function(){var e=new Set;return this.importRangeFormulasMap.forEach((function(t,r){return e.add(r)})),this.importRangeReadyToInstantiateMetaMap.forEach((function(t,r){return e.add(r)})),e.size}},{key:"delUnInstantiateMeta",value:function(e){var t,r=yr(this.importRangeReadyToInstantiateMetaMap);try{for(r.s();!(t=r.n()).done;){var n=(0,g.Z)(t.value,2),a=n[0],o=n[1].filter((function(t){return t.sheetId!==e}));o.length>0?this.importRangeReadyToInstantiateMetaMap.set(a,o):this.importRangeReadyToInstantiateMetaMap.delete(a)}}catch(e){r.e(e)}finally{r.f()}}},{key:"refreshImportRangeData",value:function(e){var t=this.getFormulasFromId(e);t&&(this.requestDocument(e,this.getCurrentSpreadToken(),{forceFetch:!0,shouldRetry:!0,retryImportRangeErrorCodes:[Ce.O6N.DATA_NOT_READY,Ce.O6N.REFERENCE_NOT_EXIST]}),t.forEach((function(e){var t;Wp(e)&&(null===(t=e.getRef().sheet())||void 0===t||t.dispatch("RangeChanged",{range:e.getArrayRef()}))})),this.markDirtyFormulasById(e))}},{key:"onImportRangeChange",value:function(e,t){if(this.isImportRangeDataSurvive(e)){var r=this.getFormulasFromId(e);if(r){switch(t){case 0:this.importRangePerformance.emit("onServerSidePush",e,0),this.requestDocument(e,this.getCurrentSpreadToken(),{forceFetch:!0});break;case 13:this.importRangePerformance.emit("onServerSidePush",e,0);break;default:this.importRangeDataMap.delete(e);var n=(0,Ce.rR3)(t)||Ce.DZv[Ce.O6N.REQUEST_FAIL],a=this.getImportRangePromise(e);a&&(window.clearTimeout(a.retryTimer),a.reject(n),this.importRangePromiseMap.delete(e)),this.importRangeDataMap.set(e,Ce.DZv[n.code]),this.importRangePerformance.emit("onServerSidePush",e,n.code)}13!==t&&(r.forEach((function(e){var t;Wp(e)&&(null===(t=e.getRef().sheet())||void 0===t||t.dispatch("RangeChanged",{range:e.getArrayRef()}))})),this.markDirtyFormulasById(e))}}}},{key:"isImportRangeNumExceedLimit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=this.countImportRange()+e>Ce.Ps3.getSheetImportRangeCountLimit();return t&&this.collectImportRangeFrontError("importrange_exceed_limit"),t}},{key:"isImportRangeNumExceedLimitWithRangeCache",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!this.rangeCache)return this.isImportRangeNumExceedLimit(e.length+r);var n=r,a=new Set;return e.forEach((function(e){var r,o=null!==(r=e.importRangeId)&&void 0!==r?r:t.getImportRangeIdByMeta(e),i=t.importRangeFormulasMap.get(o);i&&i.size||a.has(o)||(a.add(o),n++)})),this.isImportRangeNumExceedLimit(n)}},{key:"hasImportRangeDataByMeta",value:function(e){var t=this.getImportRangeIdByMeta(e);if(!this.rangeCache||!t)return!1;var r=this.importRangeDataMap.get(t),n=this.importRangeReadyToInstantiateMetaMap.get(t);return r||n}},{key:"getImportRangeFormulas",value:function(){var e=[];return this.importRangeFormulasMap.forEach((function(t){t.size>1e4?t.forEach((function(t){return e.push(t)})):(0,Ce.hTd)(e,t)})),e}},{key:"requestImportRangeDataHash",value:function(e,t){return function(e,t){return ME.apply(this,arguments)}(e,t)}},{key:"hasSetHookAfterHeartBeat",value:function(){return void 0!==this.hookAfterHeartBeat}},{key:"setHookAfterHeartBeat",value:function(e){this.hookAfterHeartBeat=e}},{key:"handleImportRangeDatas",value:function(e){if(null!=e&&!this.isDestroy){var r=[];for(var n in e){var a=e[n],o=this.importRangeDataMap.get(n);if(this.importRangePerformance.emit("onCacheHitInfoCollect","request_data","heartBeat"),null!=a)if(Tw(a)){if(this.importRangePerformance.emit("onCacheHitInfoCollect","cache_hit","heartBeat"),!o||o instanceof Ce.rBk)continue;o.updateTime=a.updateTime}else{var i=void 0;a instanceof Ce.rBk?(i=a,this.importRangePerformance.emit("onRequestErrorFromHeartBeat",i.code)):(i=t.getMergedData(a),this.importRangePerformance.emit("onRequestSuccessFromHeartBeat",i)),this.importRangeDataMap.set(n,i);var u=this.getFormulasFromId(n);u&&u.size&&(u.size>1e4?u.forEach((function(e){return r.push(e)})):(0,Ce.hTd)(r,u))}}r.length>0&&this.workbook.calcEngine.markDirty(r.map((function(e){return e.getRef()})))}}},{key:"setShouldHeartBeat",value:function(e){this.shouldHeartBeat=e}},{key:"clearHeartBeatInterval",value:function(){this.importRangeHeartBeatInterval&&(window.clearInterval(this.importRangeHeartBeatInterval),this.importRangeHeartBeatInterval=null)}},{key:"setHeartBeatInterval",value:function(){this.shouldHeartBeat&&!this.importRangeHeartBeatInterval&&(this.importRangeHeartBeatInterval=window.setInterval(this.monitorImportRangeHeartBeat,this.importRangeHeartBeatIntervalTime))}},{key:"getImportRangePromise",value:function(e){return this.importRangePromiseMap.get(e)}},{key:"getImportRangeDataPromise",value:function(e){var t;return null===(t=this.requestDocumentPromiseMap.get(e))||void 0===t?void 0:t.promise}},{key:"setImportRangeHeartBeatInterval",value:function(e){this.importRangeHeartBeatIntervalTime=e,this.importRangeHeartBeatInterval&&(this.clearHeartBeatInterval(),this.setHeartBeatInterval())}},{key:"dispose",value:function(){this.clearHeartBeatInterval(),this.importRangePerformance.dispose(),this._isDestroy=!0}},{key:"collectImportRangeCount",value:function(e,t,r){var n=this.getCurrentSpreadToken();Ce.Ps3.collectSuiteEvent("sheet_importrange_count_dev",{count:e,reference_count:t,max_reference_count:r,file_id:Ce.Ps3.encryptTea(n)})}},{key:"collectImportRangeFrontError",value:function(e){Ce.Ps3.collectSuiteEvent("sheet_importrange_front_error_dev",{message:e})}},{key:"setImportRangeAutoExpand",value:function(e){this.importRangeAutoExpand.add(e)}},{key:"getImportRangeAutoExpand",value:function(e){return this.importRangeAutoExpand.has(e)}},{key:"getImportRangeIdByMeta",value:function(e){if(!this.rangeCache)return"";var t=e.ref,r=e.spreadToken,n=id(t,{isShowSheetName:!0});return At()("".concat(this.getCurrentSpreadToken(),"_").concat(r,"_").concat(n))}},{key:"getFormulaCountById",value:function(e){var t,r,n=null!==(t=null===(r=this.importRangeFormulasMap.get(e))||void 0===r?void 0:r.size)&&void 0!==t?t:0,a=this.importRangeReadyToInstantiateMetaMap.get(e);if(!a||!a.length)return n;for(var o=0;o<a.length;o++){var i;n+=null!==(i=a[o].refCount)&&void 0!==i?i:1}return n}},{key:"finishImportRangeAutoExpand",value:function(e){this.importRangeAutoExpand.delete(e)}},{key:"isImportRangeDataSurvive",value:function(e){var t=this.importRangeFormulasMap.get(e);if(!t||!t.size)return!1;if(this.importRangeReadyToInstantiateMetaMap.get(e))return!0;var r,n=yr(t);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(Aw(this.workbook,a))return!0}}catch(e){n.e(e)}finally{n.f()}return!1}},{key:"markDirtyFormulasById",value:function(e){var t=this.importRangeFormulasMap.get(e);t&&this.workbook.calcEngine.markDirty(Array.from(t).map((function(e){return e.getRef()})))}},{key:"reset",value:function(){var e;this.importRangeDataMap.clear(),this.importRangeFormulasMap.clear(),this.importRangeReadyToInstantiateMetaMap.clear(),this.importRangePromiseMap.clear(),this.importRangeAutoExpand.clear(),null!==(e=this.requestImportRangeMergedQueue)&&void 0!==e&&e.dispose(),this.clearHeartBeatInterval()}}]),t}(Ce.vpe);FE.REQUEST_TIMEOUT=1e4,FE.getMergedData=Iw,function(e){e.PrimitiveMatrixVar="PrimitiveMatrixVar",e.RefMatrixVar="RefMatrixVar",e.MixinMatrixVar="MixinMatrixVar",e.SlicedMatrixVar="SlicedMatrixVar",e.FixedSizeMatrixVar="FixedSizeMatrixVar",e.SheetRefVar="SheetRefVar",e.MultipleRefsVar="MultipleRefsVar",e.ProxyRefVar="ProxyRefVar"}(cE||(cE={}));var ZE,xE=Ce.d$b[Ce.O6N.REF_INVALID_CELL_REFERENCE]({funcName:"",index:-1,value:""}),DE=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).id=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"nth",value:function(){return xE}},{key:"size",value:function(){return 0}},{key:"getValue",value:function(){return null}},{key:"getSheetRef",value:function(e){var t;return null!==(t=null==e?void 0:e[this.id])&&void 0!==t?t:xE}},{key:"customType",get:function(){return"ProxyRefVar"}}]),t}(it.BaseCustomCollectionVar),PE=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).operator=e,n.argCount=r,n.type=it.VAR_TYPE.OPERATOR,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"isOp",value:function(){return!0}},{key:"getVar",value:function(e){var t=(0,it.combineCtxArgs)(e,this.args);return this.operator.calc.apply(this.operator,t).toValidVar()}},{key:"getValue",value:function(e){return this.getVar(e).getValue(e)}},{key:"getArgs",value:function(){return this.args}},{key:"getDependencies",value:function(){return this.args}},{key:"op",value:function(){return this.operator}},{key:"serialize",value:function(){return null}},{key:"setOperator",value:function(e){this.operator=e}},{key:"setArgs",value:function(e){this.args=e}},{key:"getArgCount",value:function(){return this.argCount}}]),t}(it.OperatorVar),$E=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e,r.customType="PivotTableDataVar",r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getValue",value:function(e){return this.value}},{key:"toNumberValue",value:function(){return 0}},{key:"toStringValue",value:function(){return""}},{key:"toBooleanValue",value:function(){return!!this.value}}]),t}(it.Primitive),LE=function(e){function t(e){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,new $E(e)))}return(0,p.Z)(t,e),t}(it.CustomPrimitiveVar),BE=function(e){return e.includes("_")},UE=function(e){return dv(e)&&!e.hasImportRangeId()&&!Ce.Ps3.getImportRangeV2Enable()};!function(e){e[e.main=0]="main",e[e.worker=1]="worker",e[e.node=2]="node"}(ZE||(ZE={}));var HE=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).workbook=e,r.V3Enable=!0,r.isDestroy=!1,r.calculateFormula=new Map,r.setCalcFinishedCallback=function(e){return r.handleCalcFinishedCallback=e},r.setThreadEnv=function(e){return r.env=e},r.setRequestMethod=function(e){return r.handleFetchData=e},r.formula2ImportRange=new Map,r.importRangeContentMap=new Map,r.importRangeAutoExpandSet=new Set,r.importRangeAutoCreateSet=new Set,r.handleFormulaCalcFinished=(0,ie.default)((function(){r.calculateFormula.size&&r.workbook.calcEngine&&(2===r.env&&r.calculateFormula.forEach((function(e,t){var n=r.formula2ImportRange.get(t),a=[],o=[];null!=e&&e.forEach((function(e){var t,n=null===(t=r.importRangeContentMap.get(e))||void 0===t?void 0:t.importRangeMeta;n&&a.push(n)})),null!=n&&n.forEach((function(e){var t,n=null===(t=r.importRangeContentMap.get(e))||void 0===t?void 0:t.importRangeMeta;n&&o.push(n)})),r.emit("onImportRangeValueChanged",yv(r.workbook.calcEngine,t),a,o)})),r.calculateFormula.clear(),r.importRangeContentMap.forEach((function(e,t){e.formulas&&e.formulas.size||r.importRangeContentMap.delete(t)})),r.handleCalcFinishedCallback&&r.handleCalcFinishedCallback())}),200),r.importRangePerformance=new AE(r.workbook,Ce.waj.V3),r.workbook.calcEngine.formulaService.addListener("formulaCalcFinished",r.handleFormulaCalcFinished),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"compileImportRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.isDestroy)return null;var n=kp(e,{ref:e.getRef()}),a=this.workbook.calcEngine.compiler.compile(n,{refStyle:"A1",ref:e.getRef(),spread:this.workbook}).externalDataReferenceInfos;if(!a||!a.length)return null;this.importRangePerformance.onCompileImportRange(a);for(var o=[],i=0;i<a.length;i++){var u,s=a[i],l=null!==(u=this.parseUrlString(s.url))&&void 0!==u?u:{},c=l.docsType,h=l.spreadToken,f=this.parseRangeString(s.range);if(!(c&&h&&f&&f.rangeStr))return null;var d=this.generateImportRangeId(f.rangeStr,h,c);if(o.push(d),t&&this.importRangeAutoCreateSet.add(d),r&&1===a.length){var v=e.getRef(),p=v.rowFrom(),m=v.colFrom();this.importRangeAutoExpandSet.add("".concat(d,"_").concat(p,"_").concat(m))}var g=this.importRangeContentMap.get(d);(null==g?void 0:g.importRangeData)&&g.importRangeData instanceof Ce.rBk&&(g.importRangeData=void 0)}return o}},{key:"getDataFromId",value:function(e){var t,r;return null!==(t=null===(r=this.importRangeContentMap.get(e))||void 0===r?void 0:r.importRangeData)&&void 0!==t?t:null}},{key:"getFormulasFromId",value:function(e){var t,r=this,n=new Set,a=null===(t=this.importRangeContentMap.get(e))||void 0===t?void 0:t.formulas;return null!=a&&a.forEach((function(e){var t=yv(r.workbook.calcEngine,e);t&&n.add(t)})),n}},{key:"getCurrentSpreadToken",value:function(){return this.workbook.getService(It.UU).token}},{key:"generateAndCacheId",value:function(e,t){var r,n=null!==(r=this.parseUrlString(e))&&void 0!==r?r:{},a=n.docsType,o=n.spreadToken,i=this.parseRangeString(t);return a&&o&&i&&i.rangeStr?this.generateImportRangeId(i.rangeStr,o,a):null}},{key:"parseUrlString",value:function(e){var t=aE.parse(e).pathname;if(!t)return this.collectImportRangeFrontError("illegal_url"),null;var r=null==t?void 0:t.match(/^\/(.*?)\/([^\/]*)$/);if(!r)return this.collectImportRangeFrontError("unMatched_pathname"),null;var n=r[1];if(void 0===n)return this.collectImportRangeFrontError("docsType_is_undefined"),null;var a=r[2];return void 0===a?(this.collectImportRangeFrontError("spreadToken_is_undefined"),null):{docsType:n,spreadToken:a}}},{key:"parseRangeString",value:function(e){var t=e.lastIndexOf("!");if(-1===t)return null;var r=e.slice(0,t),n=e.slice(t+1);if(/[\/\\?*\[\]:]/.test(r))return null;r.startsWith("'")&&r.endsWith("'")||(r="'".concat(r,"'")),n=n.toUpperCase();var a=od(e="".concat(r,"!").concat(n));return a&&a.type!==Ce.xj7.INVALID?(a.rangeStr=e,a):(this.collectImportRangeFrontError("illegal_range"),null)}},{key:"generateImportRangeId",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sheets";return(0,Ce.gw3)("".concat(t,"_").concat(r,"_").concat(e))}},{key:"getAllImportRangeIds",value:function(){return Array.from(this.importRangeContentMap.keys())}},{key:"countImportRange",value:function(){return this.importRangeContentMap.size}},{key:"refreshImportRangeData",value:function(e){var t=this;e.forEach((function(e){var r=t.importRangeContentMap.get(e);if(r){r.importRangeData=void 0,t.fetchImportRangeDataById(e);var n=r.formulas;n&&n.size&&n.forEach((function(e){var r,n=yv(t.workbook.calcEngine,e);n&&Wp(n)&&(null===(r=n.getRef().sheet())||void 0===r||r.dispatch("RangeChanged",{range:n.getArrayRef()}))})),t.markDirtyFormulasById(e)}}))}},{key:"getImportRangeFormulas",value:function(){var e=this,t=[];return Array.from(this.formula2ImportRange.keys()).forEach((function(r){var n=yv(e.workbook.calcEngine,r);n&&t.push(n)})),t}},{key:"getImportRangePromise",value:function(e){var t;return null===(t=this.importRangeContentMap.get(e))||void 0===t?void 0:t.importRangePromise}},{key:"getImportRangeMetasByFormula",value:function(e){var t=gv(e),r=this.formula2ImportRange.get(t),n=[];if(!r||!r.size)return n;var a,o=yr(r);try{for(o.s();!(a=o.n()).done;){var i=a.value,u=this.importRangeContentMap.get(i);u&&n.push(u.importRangeMeta)}}catch(e){o.e(e)}finally{o.f()}return n}},{key:"dispose",value:function(){this.isDestroy=!0,this.formula2ImportRange.clear(),this.importRangeContentMap.clear(),this.importRangeAutoCreateSet.clear(),this.importRangeAutoExpandSet.clear(),this.importRangePerformance.dispose(),this.handleFormulaCalcFinished.cancel(),this.workbook.calcEngine.formulaService.removeListener("formulaCalcFinished",this.handleFormulaCalcFinished)}},{key:"reset",value:function(){this.formula2ImportRange.clear(),this.importRangeContentMap.clear(),this.importRangeAutoCreateSet.clear(),this.importRangeAutoExpandSet.clear()}},{key:"collectImportRangeCount",value:function(e,t,r){var n=this.getCurrentSpreadToken();Ce.Ps3.collectSuiteEvent("sheet_importrange_count_dev",{count:e,reference_count:t,max_reference_count:r,file_id:Ce.Ps3.encryptTea(n)})}},{key:"collectImportRangeFrontError",value:function(e){Ce.Ps3.collectSuiteEvent("sheet_importrange_front_error_dev",{message:e})}},{key:"isImportRangeDataSurvive",value:function(e){var t,r=null===(t=this.importRangeContentMap.get(e))||void 0===t?void 0:t.formulas;if(!r||!r.size)return!1;var n,a=yr(r);try{for(a.s();!(n=a.n()).done;){var o=n.value,i=yv(this.workbook.calcEngine,o);if(i&&Aw(this.workbook,i))return!0}}catch(e){a.e(e)}finally{a.f()}return!1}},{key:"markDirtyFormulasById",value:function(e){var t,r=this,n=this.workbook.getCalcEngine(),a=null===(t=this.importRangeContentMap.get(e))||void 0===t?void 0:t.formulas,o=[];n&&a&&a.forEach((function(e){var t=yv(r.workbook.calcEngine,e);t&&o.push(t.getRef())})),n.markDirty(o)}},{key:"onImportRangeStatusChange",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"onServerSidePush";if(this.isImportRangeDataSurvive(e)||18===t)switch(t){case 0:return this.importRangePerformance.emit(n,e,0),void this.fetchImportRangeDataById(e).then((function(){return r.markDirtyFormulasById(e)}));case 13:return void this.importRangePerformance.emit(n,e,0);case 8:var a,o=null===(a=this.importRangeContentMap.get(e))||void 0===a?void 0:a.importRangeData;return void(!o||o instanceof Ce.rBk||(o.updateTime=Date.now()));case 18:return void this.importRangeContentMap.forEach((function(e,t){e.importRangeData&&e.importRangeData instanceof Ce.rBk&&(e.importRangeData.code===Ce.O6N.EXIST_FML_LIMIT||e.importRangeData.code===Ce.O6N.DATA_SOURCE_IN_TRASH)&&(e.importRangeData=void 0,r.markDirtyFormulasById(t))}));default:var i;(i=2===t?Ce.DZv[Ce.O6N.REFERENCE_NOT_EXIST_V3]:(0,Ce.rR3)(t))||(console.error("[SHEET LOG] ImportRangeStatusChanged Unknown DataType ",t),i=Ce.DZv[Ce.O6N.REQUEST_FAIL]),this.importRangePerformance.emit(n,e,i.code);var u=this.importRangeContentMap.get(e);if(u){var s=u.importRangeData;u&&s instanceof Ce.rBk&&s.code===i.code||(u.importRangeData=i,this.markDirtyFormulasById(e))}return}}},{key:"fetchImportRangeDataById",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.assign({},_w);if(this.isDestroy)return Promise.reject((0,Ce.i4Q)(Ce.O6N.REQUEST_FAIL,"importrange manager is destroy"));var r=this.importRangeContentMap.get(e);return t.version=Ce.waj.V3,r?(r.importRangePromise||(r.importRangePromise=this.createFetchDataPromise({importRangeId:e,spreadToken:this.getCurrentSpreadToken(),options:t})),r.importRangePromise):Promise.reject((0,Ce.i4Q)(Ce.O6N.REQUEST_FAIL,"content is not found"))}},{key:"createFetchDataPromise",value:function(e){var t=this,r=e.spreadToken,n=e.importRangeId,a=e.options,o=this.importRangeContentMap.get(n);return this.importRangePerformance.emit("onRequestDocument",n),new Promise((function(e,i){t.handleFetchData({spreadToken:r,importRangeId:n,options:a,resolve:e,reject:i,extraInfo:{spreadSource:o.importRangeMeta.spreadSource,rangeStr:o.importRangeMeta.rangeStr}})})).then((function(r){return t.handleFetchDataSuccess(r,e)})).catch((function(r){return t.handleFetchDataError(r,e)}))}},{key:"handleFetchDataSuccess",value:function(e,t){var r=t.importRangeId;if(e instanceof Ce.rBk)throw e;var n=this.importRangeContentMap.get(r);if(!n)throw Error("content is not found");if(n.importRangePromise=void 0,Tw(e)){this.importRangePerformance.emit("onCacheHitInfoCollect","cache_hit","front");var a=n.importRangeData;return a?(a instanceof Ce.rBk||(a.updateTime=e.updateTime),a):(this.importRangePerformance.emit("onRequestError",r,-1),Ce.DZv[Ce.O6N.REQUEST_FAIL])}var o=Iw(e);return n.importRangeData=o,this.importRangePerformance.emit("onRequestSuccess",r,o),o}},{key:"handleFetchDataError",value:function(e,t){var r,n,a=this,o=t.spreadToken,i=t.importRangeId,u=t.options,s=this.importRangeContentMap.get(i);return s&&e instanceof Ce.rBk?(this.importRangePerformance.emit("onRequestError",i,e.code),null===(r=u.retryImportRangeErrorCodes)||void 0===r||!r.includes(e.code)||s.retryTimes&&s.retryTimes>=2?(s.importRangePromise=void 0,s.importRangeData=e,e):(0,Ce.Dc1)(null!==(n=u.delayTimeBeforeFetch)&&void 0!==n?n:0).then((function(){return void 0===s.retryTimes?s.retryTimes=1:s.retryTimes++,a.createFetchDataPromise({spreadToken:o,importRangeId:i,options:u})}))):(s&&(s.importRangePromise=void 0,s.importRangeData=Ce.DZv[Ce.O6N.REQUEST_FAIL]),this.importRangePerformance.emit("onRequestError",i,-1),Ce.Ps3.moirae.ravenCatch(e,{tags:{key:"SHEET_IMPORTRANGE_UNKNOWN_ERROR: ".concat(null==e?void 0:e.message)},extras:{importRangeId:i}}),Ce.DZv[Ce.O6N.REQUEST_FAIL])}},{key:"setImportRangeContent",value:function(e,t,r,n){var a=this.importRangeContentMap.get(t);a?a.formulas.add(e):this.importRangeContentMap.set(t,{importRangeId:t,importRangeMeta:{importRangeId:t,spreadSource:r,spreadToken:this.getCurrentSpreadToken(),rangeStr:n,ref:od(n),isSyncStyle:!1},formulas:new Set([e])});var o=this.formula2ImportRange.get(e);o?o.add(t):this.formula2ImportRange.set(e,new Set([t]))}},{key:"removeFormula2ImportRangeRelationship",value:function(e,t){var r=this.formula2ImportRange.get(e);if(r?(r.delete(t),r.size||this.formula2ImportRange.delete(e)):this.collectImportRangeFrontError("del_formula_error_without_importrange"),this.importRangeContentMap){var n,a=null===(n=this.importRangeContentMap.get(t))||void 0===n?void 0:n.formulas;a?(a.delete(e),a.size||this.importRangeContentMap.delete(t)):this.collectImportRangeFrontError("del_importrange_error_without_formula")}}},{key:"delFormula",value:function(e){var t=this,r=gv(e),n=this.formula2ImportRange.get(r);if(n&&n.size){var a=[];this.importRangeContentMap.size&&n.forEach((function(e){var n,o=null===(n=t.importRangeContentMap.get(e))||void 0===n?void 0:n.importRangeMeta;o&&a.push(o),t.removeFormula2ImportRangeRelationship(r,e)})),this.emit("onDeleteFormulaV3",e,a)}}}]),t}(Ce.vpe);HE.ThreadPromiseMap=new Map;var zE=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$noCache=!0,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=t.slice(),n=0;n<r.length;++n){var a=Ds(r[n],e.ref);if(ja(a))return a;var o=xc(a);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_STRING);r[n]=o}var i=e.workbook;if(!i||!i.importRangeManager)return it.RUNTIME_ERR_VAR;var u=e.formula,s=r[0],l=r[1];return UE(u)&&i.importRangeManagerV3?function(e,t,r,n){var a,o=(null===(a=t.getSpecialInfo())||void 0===a?void 0:a.link)||t.getValue(),i=n.generateAndCacheId(o,r.getValue()),u=gv(e.formula);if(!i)return Ce.d$b[Ce.O6N.IMPORT_RANGE_PARSE_ERROR]();if(!n.calculateFormula.has(u)){var s=n.formula2ImportRange.get(u);n.calculateFormula.set(u,s),null==s||s.forEach((function(e){var t;null===(t=n.importRangeContentMap.get(e))||void 0===t||t.formulas.delete(u)})),n.formula2ImportRange.delete(u)}n.setImportRangeContent(u,i,o,r.getValue());var l=n.importRangeContentMap.get(i),c=null==l?void 0:l.importRangeData;if(c)return function(e,t,r){return r instanceof Ce.rBk?WE(r,t):(e.info&&(e.info.customData=null===(n=r.data.dataTable[0][0].getSpecialInfo())||void 0===n?void 0:n.customData),r.importRangeVar||(r.importRangeVar=new ys(r.data.dataTable,t)),r.importRangeVar);var n}(e,i,c);var h=n.fetchImportRangeDataById(i),f=e.formula;return h.finally((function(){e.service.emit("afterWaitAsyncCalc",f,3)})),e.service.addCalculatingAsyncFormula(f),it.WAIT_ASYNC_ERR_VAR}(e,s,l,i.importRangeManagerV3):function(e,t,r){if(!t.isImportRange())return Ce.d$b[Ce.O6N.IMPORT_RANGE_PARSE_ERROR]();var n=r.importRangeManager,a=n.getMetaFromFormula(t);if(!a)return it.tractorErrorVarCreators[it.ErrorCode.DEFAULT_RUNTIME_ERROR]("Cannot import range without meta.");var o=a.importRangeId,i=n.getDataFromId(o);if(i){return i instanceof Ce.rBk?WE(i,o):(e.info&&(e.info.customData=null===(u=i.data.dataTable[0][0].getSpecialInfo())||void 0===u?void 0:u.customData),new ys(i.data.dataTable,o));var u}var s=n.getImportRangeDataPromise(o);if(!s){var l=n.getCurrentSpreadToken();s=n.requestDocument(o,l)}return s.then((function(t){return t?t instanceof Ce.rBk?WE(t,o):(e.info&&(e.info.customData=null===(r=t.data.dataTable[0][0].getSpecialInfo())||void 0===r?void 0:r.customData),new ys(t.data.dataTable,o)):it.NULL_VAR;var r})).catch((function(e){return WE(e,o)})).finally((function(){e.service.emit("afterWaitAsyncCalc",t,3)})),e.service.addCalculatingAsyncFormula(t),it.WAIT_ASYNC_ERR_VAR}(e,u,i)}}]),t}(pw("IMPORTRANGE",2,0,0,Zd|Pd,[{type:Nd,isMappable:!1},{type:Nd,isMappable:!1}]));function WE(e,t){return e instanceof Ce.rBk?e.code===Ce.O6N.DATA_NOT_READY?(0,Ce.LCc)(e.code,"",{importRangeId:t}):(0,Ce.i4Q)(e.code,"",{importRangeId:t}):(0,Ce.i4Q)(Ce.O6N.REQUEST_FAIL,null==e?void 0:e.message,{importRangeId:t})}zE=Vu([Cp("IMPORTRANGE")],zE);var GE=["PrimitiveMatrixVar","MixinMatrixVar","RefMatrixVar","SlicedMatrixVar","FixedSizeMatrixVar"],jE=["SheetRefVar","MultipleRefsVar"],YE={MATRIX:qE(GE,Ld),SHEET_REF:qE(jE,Ld),MATRIX_AND_SHEET_REF:qE([].concat(GE,jE),Ld)};function qE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ld;return{type:t,customType:{collection:e}}}function JE(e,t,r,n,a){return e.iterContent(t,n,r,a).reduce((function(e,t){var r=e.formulaVar;return(null==r?void 0:r.getVar())===it.SUSPENDED_ERR_VAR&&t.add(r),t}),new Set)}function KE(e,t,r){var n=function(e){var n,a=yr(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(t.delete(i),0===t.size)return r(),void o()}}catch(e){a.e(e)}finally{a.f()}},a=function(e){t.delete(e)};e.formulaService.addListener(it.FormulaEvents.onFormulaValuesChanged,n),e.formulaSpace.addListener(it.FormulaSpaceEvents.onFormulaUnregistered,a);var o=function(){e.formulaService.removeListener(it.FormulaEvents.onFormulaValuesChanged,n),e.formulaSpace.removeListener(it.FormulaSpaceEvents.onFormulaUnregistered,a)};return{unsubscribe:o}}function XE(e,t,r,n,a){var o=JE(e,t,r,n,a);return o.size>0?new Promise((function(t){KE(e.getCalcEngine(),o,(function(){t()}))})):Promise.resolve()}function QE(e,t,r,n){for(var a=0,o=0,i=0;i<t.length;++i)for(var u=t[i],s=ro(u)?u.getRef():null,l=Qa(u)?u.getRefCount():1,c=0;c<l;++c)for(var h=c?u.getRefs()[c]:s,f=h?Ps(e.workbook,h):null,d=c?ni(h):u.rowCount(),v=c?ai(h):u.colCount(),p=0;p<d;++p)for(var m=0;m<v;++m){var g=u.at(p,m,c);if(!r||r(g,p,m,e,h,f)){if(ja(g))return g;za(g)&&(a+=g.getValue(),o++)}}return o?new it.NumberVar(a/o):Hl(n||"")}function ek(e,t,r){for(var n=0,a=0;a<t.length;++a)for(var o=t[a],i=ro(o)?o.getRef():null,u=Qa(o)?o.getRefCount():1,s=0;s<u;++s)for(var l=s?o.getRefs()[s]:i,c=l?Ps(e.workbook,l):null,h=s?ni(l):o.rowCount(),f=s?ai(l):o.colCount(),d=0;d<h;++d)for(var v=0;v<f;++v){var p=o.at(d,v,s);r&&!r(p,d,v,e,l,c)||za(p)&&n++}return new it.NumberVar(n)}function tk(e,t,r){for(var n=0,a=0;a<t.length;++a)for(var o=t[a],i=ro(o)?o.getRef():null,u=Qa(o)?o.getRefCount():1,s=0;s<u;++s)for(var l=s?o.getRefs()[s]:i,c=l?Ps(e.workbook,l):null,h=s?ni(l):o.rowCount(),f=s?ai(l):o.colCount(),d=0;d<h;++d)for(var v=0;v<f;++v){var p=o.at(d,v,s);r&&!r(p,d,v,e,l,c)||qa(p)||n++}return new it.NumberVar(n)}function rk(e,t,r){for(var n=0,a=!1,o=0;o<t.length;++o)for(var i=t[o],u=ro(i)?i.getRef():null,s=Qa(i)?i.getRefCount():1,l=0;l<s;++l)for(var c=l?i.getRefs()[l]:u,h=c?Ps(e.workbook,c):null,f=l?ni(c):i.rowCount(),d=l?ai(c):i.colCount(),v=0;v<f;++v)for(var p=0;p<d;++p){var m=i.at(v,p,l);if(!r||r(m,v,p,e,c,h)){if(ja(m))return m;if(za(m)){var g=m.getValue();(!1===a||n<g)&&(n=g,a=!0)}}}return new it.NumberVar(n)}function nk(e,t,r){for(var n=0,a=!1,o=0;o<t.length;++o)for(var i=t[o],u=ro(i)?i.getRef():null,s=Qa(i)?i.getRefCount():1,l=0;l<s;++l)for(var c=l?i.getRefs()[l]:u,h=c?Ps(e.workbook,c):null,f=l?ni(c):i.rowCount(),d=l?ai(c):i.colCount(),v=0;v<f;++v)for(var p=0;p<d;++p){var m=i.at(v,p,l);if(!r||r(m,v,p,e,c,h)){if(ja(m))return m;if(za(m)){var g=m.getValue();(!1===a||n>g)&&(n=g,a=!0)}}}return new it.NumberVar(n)}function ak(e,t,r){for(var n=1,a=!1,o=0;o<t.length;++o)for(var i=t[o],u=ro(i)?i.getRef():null,s=Qa(i)?i.getRefCount():1,l=0;l<s;++l)for(var c=l?i.getRefs()[l]:u,h=c?Ps(e.workbook,c):null,f=l?ni(c):i.rowCount(),d=l?ai(c):i.colCount(),v=0;v<f;++v)for(var p=0;p<d;++p){var m=i.at(v,p,l);if(!r||r(m,v,p,e,c,h)){if(ja(m))return m;10&m.$$type&&(a=!0,n*=za(m)?m.getValue():m.getValue()?1:0)}}return new it.NumberVar(a?n:0)}function ok(e,t,r){for(var n=0,a=0;a<t.length;++a)for(var o=t[a],i=ro(o)?o.getRef():null,u=Qa(o)?o.getRefCount():1,s=0;s<u;++s)for(var l=s?o.getRefs()[s]:i,c=l?Ps(e.workbook,l):null,h=s?ni(l):o.rowCount(),f=s?ai(l):o.colCount(),d=0;d<h;++d)for(var v=0;v<f;++v){var p=o.at(d,v,s);if(!r||r(p,d,v,e,l,c)){if(ja(p))return p;za(p)&&(n+=p.getValue())}}return new it.NumberVar(n)}function ik(e,t,r,n,a){for(var o=[],i=0,u=0;u<r.length;++u)for(var s=r[u],l=ro(s)?s.getRef():null,c=Qa(s)?s.getRefCount():1,h=0;h<c;++h)for(var f=h?s.getRefs()[h]:l,d=f?Ps(t.workbook,f):null,v=h?ni(f):s.rowCount(),p=h?ai(f):s.colCount(),m=0;m<v;++m)for(var g=0;g<p;++g){var y=s.at(m,g,h);if(!n||n(y,m,g,t,f,d)){if(ja(y))return y;if(za(y)){var _=y.getValue();o.push(_),i+=_}}}if(!o.length)return Hl(a||"");var R=e?o.length:o.length-1;if(R<1)return it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_FUNCTION_EVAL]({funcName:""});for(var C=i/o.length,w=0,E=0;E<o.length;++E)w+=Math.pow(o[E]-C,2);return new it.NumberVar(w/R)}var uk,sk,lk=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).alwaysCalc=!0,e.$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[258,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=!1;return r>100&&(r-=100,n=!0),this.callFunctionByNum(e,r,n,t.slice(1))}},{key:"callFunctionByNum",value:function(e,t,r,n){var a=ju([Yu,Xu,r&&qu,r&&Qu].filter(Boolean));switch(t){case 1:return QE(e,n,a,this.name);case 2:return ek(e,n,a);case 3:return tk(e,n,a);case 4:return rk(e,n,a);case 5:return nk(e,n,a);case 6:return ak(e,n,a);case 7:var o=ik(!1,e,n,a,this.name);if(!za(o))return o;var i=Math.sqrt(o.getValue());return new it.NumberVar(i);case 8:var u=ik(!0,e,n,a,this.name);if(!za(u))return u;var s=Math.sqrt(u.getValue());return new it.NumberVar(s);case 9:return ok(e,n,a);case 10:return ik(!1,e,n,a,this.name);case 11:return ik(!0,e,n,a,this.name);default:return Ce.d$b[Ce.O6N.UNKNOWN_SUBTOTAL_FUNCTION]({funcName:this.name,arg:t})}}}]),t}(pw("SUBTOTAL",2,256,1,Vd,[{type:Vd},YE.MATRIX_AND_SHEET_REF,YE.MATRIX_AND_SHEET_REF]));!function(e){e[e.Head=0]="Head",e[e.Tail=1]="Tail"}(uk||(uk={}));var ck=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"repeatedParam",get:function(){return 0!==this.repeatedLastParam?[uk.Tail,this.repeatedLastParam]:null}}]),t}(it.FuncOpBase);function hk(e){return e instanceof ck}var fk=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LAMBDA",e.operands=1,e.optionOperands=253,e.resultType=Dd,e.repeatedLastParam=1,e.paramsDesc=[{type:Hd},{type:Hd}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!0,e.$$paramsDesc=[1279],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=t.length-1,n=0,a=[],o=new Set,i=e.formula.formula.params;n<r;n++){var u=t[n];if(ja(u))return u;if(!oo(u))return Ce.d$b[Ce.O6N.FORMULA_WITH_INVALID_PARAM]({funcName:this.name,index:n+1});var s=i[u.index].toUpperCase();if(o.has(s))return Ce.d$b[Ce.O6N.FORMULA_WITH_SAME_NAME_PARAMETER]({funcName:this.name});o.add(s),a.push(u)}var l=t[n];if(!no(l)){var c,h=e.index+1+r;(l=new vc(h,h,e.expression,null)).scope=null===(c=e.parameterScope)||void 0===c?void 0:c.slice()}return new mp(l,a)}},{key:"repeatedParam",get:function(){return[uk.Head,1]}}]),t}(ck),dk=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LET",e.operands=1,e.optionOperands=252,e.resultType=it.VAR_TYPE.ATOM,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.ALL},{type:it.VAR_TYPE.ALL},{type:it.VAR_TYPE.ALL}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!0,e.$$paramsDesc=[1279],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t.length;if(r%2==0)return Ce.d$b[Ce.O6N.THE_NUMBER_OF_PARAMETERS_OF_A_FUNCTION_MUST_BE_ODD]({funcName:this.name,count:r});for(var n=new Set,a=e.formula.formula.params,o=0;o<r-1;o+=2){var i=t[o];if(ja(i))return i;if(!oo(i))return Ce.d$b[Ce.O6N.FORMULA_WITH_INVALID_PARAM]({funcName:this.name,index:o+1});var u=a[i.index].toUpperCase();if(n.has(u))return Ce.d$b[Ce.O6N.FORMULA_WITH_SAME_NAME_PARAMETER]({funcName:this.name});n.add(u);var s=t[o+1];oo(s)&&(s=s.index<a.length?hc(a[s.index]):it.NAME_ERR_VAR)}return 1===r?t[0]:new ks([],[t[1]],new vk(t,e.parameterScope))}},{key:"repeatedParam",get:function(){return[uk.Head,2]}}]),t}(ck),vk=function(){function e(t,r){(0,y.Z)(this,e),this.args=t,this.index=0,this.scope=r?r.slice():[]}return(0,_.Z)(e,[{key:"next",value:function(e,t){if(this.scope[this.args[this.index].index]=t[0],this.index+=2,this.index>=this.args.length-1){var r=this.args[this.args.length-1];if(no(r))r.scope=this.scope;else if(oo(r))return this.scope[r.index]||it.NAME_ERR_VAR;return r}var n=this.args[this.index+1];return no(n)?(n.scope=this.scope,new ks([],[n],this)):this.next([],[n])}}]),e}();function pk(e,t,r,n,a){for(var o=[],i=0;i<r.length;++i)for(var u=r[i],s=ro(u)?u.getRef():null,l=Qa(u)?u.getRefCount():1,c=0;c<l;++c)for(var h=c?u.getRefs()[c]:s,f=h?Ps(t.workbook,h):null,d=c?ni(h):u.rowCount(),v=c?ai(h):u.colCount(),p=0;p<d;++p)for(var m=0;m<v;++m){var g=u.at(p,m,c);if(!n||n(g,p,m,t,h,f)){if(ja(g))return g;za(g)&&o.push(g.getValue())}}if(0===o.length)return it.tractorErrorVarCreators[it.ErrorCode.NUM_NO_VALID_DATA]({funcName:a||""});o.sort((function(e,t){return e>t?1:e===t?0:-1}));var y=(e*o.length+4-e)/4-1;if(Number.isInteger(y))return new it.NumberVar(o[y]);var _=o[Math.floor(y)]*(Math.ceil(y)-y)+o[Math.ceil(y)]*(y-Math.floor(y));return new it.NumberVar(_)}function mk(e,t,r,n){if(!Ja(t)){if(ja(t))return t;var a=Zc(e.service,t);if(!a)return Rl(n,1,El(t),wl(t),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);t=a}var o=[],i=t.forEach((function(e){if(za(e))o.push(e.getValue());else if(ja(e))return e}));if(i)return i;var u=r.getValue();if(u<=0||u>o.length)return pl(n,2,u.toString());o.sort((function(e,t){return t-e}));var s=o[u-1];return new it.NumberVar(s)}function gk(e,t,r,n){var a=r.getValue();if(a<0||a>1)return pl(n,2,a.toString());if(Ba(t)){if(ja(t))return t;var o=Zc(e.service,t);if(!o)return Rl(n,1,El(t),wl(t),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);t=o}var i=[],u=t.forEach((function(e){if(za(e))i.push(e.getValue());else if(ja(e))return e}));if(u)return u;var s=i.length;if(0===s)return jl(n);if(1===s)return new it.NumberVar(i[0]);if(i=i.sort((function(e,t){return e-t})),it.NumberVar.doubleEqual(a,1))return new it.NumberVar(i[s-1]);var l=a*(s-1),c=Math.floor(l),h=l-c,f=i[c],d=i[c+1];return new it.NumberVar(f+h*(d-f))}function yk(e,t,r,n){Ja(t)||(t=Zc(e.service,t)||Rl(n,1,El(t),wl(t),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));var a=[],o=t.forEach((function(e){if(za(e))a.push(e.getValue());else if(ja(e))return e}));if(o)return o;var i=r.getValue();if(i<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:n,index:1});if(i>a.length)return it.tractorErrorVarCreators[it.ErrorCode.NUM_OUT_OF_RANGE_PARAMETER]({funcName:n,index:2,value:i.toString()});a.sort((function(e,t){return e-t}));var u=a[i-1];return new it.NumberVar(u)}function _k(e,t,r,n){var a=r.getValue();if(a>4||a<0)return pl(n,2,a.toString());switch(a=Math.floor(a)){case 0:return nk(e,[t]);case 1:case 2:case 3:return pk(a,e,[t],null,n);case 4:return rk(e,[t]);default:return it.NUM_ERR_VAR}}function Rk(e,t,r,n){var a=e.length;if(n&&(t=(0|t)/4),0===a)return jl(r);var o=t*(a+1)-1,i=o%1;if(o<0||a-1<o)return pl(r,2,t.toString());e.sort((function(e,t){return e-t}));var u=Math.floor(o),s=e[u];return new it.NumberVar(0===i?s:s+i*(e[u+1]-s))}function Ck(e){for(var t=[],r=e.rowCount(),n=e.colCount(),a=0;a<r;++a)for(var o=0;o<n;++o){var i=e.at(a,o);if(ja(i))return i;za(i)&&t.push(i.getValue())}return t}function wk(e){for(var t={N:0,M:0,Q:0,sum:0,sum2:0},r=0;r<e.length;r++){var n=e[r],a=n-t.M,o=a/(t.N+1);t.M+=o,t.Q+=t.N*a*o,t.N++,t.sum+=n,t.sum2+=n*n}return t}var Ek=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return kk(e,t[0],t[1],this.name)}}]),t}(pw("PERCENTILE.EXC",2,0,0,Vd,[{type:Zd},{type:Vd}]));function kk(e,t,r,n){var a=r.getValue(),o=Ck(t);return o instanceof it.ErrorVar?o:Rk(o,a,n,!1)}var Tk=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return Sk(e,t[0],t[1],this.name)}}]),t}(pw("QUARTILE.EXC",2,0,0,Vd,[{type:Zd},{type:Vd}]));function Sk(e,t,r,n){var a=r.getValue();if(4<=a||0>=a)return pl(n,2,a.toString());var o=Ck(t);return o instanceof it.ErrorVar?o:Rk(o,a,n,!0)}var Ak=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return Ik(e,t,null,this.name)}}]),t}(pw("MODE",1,256,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}]));function Ik(e,t,r,n){for(var a=1,o=new Map,i=0;i<t.length;++i){var u=t[i];if(ja(u))return u;if(Ba(u))u=Zc(e.service,u)||Rl(n||"",i+1,El(u),wl(u),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);else{if(Qa(u))return Ol(n||"",i+1,"");if(1===u.size()&&qa(u.at(0,0)))return Ql(n||"")}for(var s=Ba(u)?null:u.getRef(),l=s?Ps(e.workbook,s):null,c=u.rowCount(),h=u.colCount(),f=0;f<c;++f)for(var d=0;d<h;++d){var v=u.at(f,d);if(!r||r(v,f,d,e,s,l)){if(ja(v))return v;if(za(v)){var p=v.getValue();if(o.has(p)){var m=o.get(p)+1;a<m&&(a=m),o.set(p,m)}else o.set(p,1)}}}}if(1===a)return ec(n||"");var g,y=yr(o.keys());try{for(y.s();!(g=y.n()).done;){var _=g.value;if(o.get(_)===a)return new it.NumberVar(_)}}catch(e){y.e(e)}finally{y.f()}return it.NA_ERR_VAR}var Ok=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).shouldSkipError=!1,e.alwaysCalc=!0,e.$$minOperands=3,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[258,258,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue());if(r<0||r>19)return Ce.d$b[Ce.O6N.UNKNOWN_AGGREGATE_FUNCTION]({funcName:this.name,arg:r});var n=Math.floor(t[1].getValue());return n<0||n>7?al(this.name,t[1].getValue().toString(),2,"0,1,2,3,4,5,6,7"):this.callFunctionByNum(e,r,n,t.slice(2))}},{key:"ensureRefArgs",value:function(e){for(var t=0;t<e.length;++t)if(qa(e[t]))return bl(this.name,t+1)}},{key:"checkArgs",value:function(e,t,r){if(2!==t.length)return{err:lc(this.name,4,t.length+2)};var n=t[1];if(!Ba(n)&&ja(n=n.at(0,0)))return{err:n};var a=n.toNumberVar(e.service);if(qa(a))return{err:Rl(this.name,4,El(n),wl(n),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE)};var o=t[0],i=[];if(Ba(o)){if(qa(o))return{err:bl(this.name,3)};i.push(o)}else for(var u=Qa(o)?o.getRefCount():1,s=0;s<u;++s)for(var l=s?o.getRefs()[s]:o.getRef(),c=l?Ps(e.workbook,l):null,h=s?ni(l):o.rowCount(),f=s?ai(l):o.colCount(),d=0;d<h;++d)for(var v=0;v<f;++v){var p=o.at(d,v,s);r&&!r(p,d,v,e,l,c)||i.push(p)}return{array:new gs([i]),numVar:a}}},{key:"callFunctionByNum",value:function(e,t,r,n){if(t<14){var a=this.ensureRefArgs(n);if(a)return a}var o=[];r>=0&&r<=3&&o.push(Xu,Ku),[1,3,5,7].includes(r)&&o.push(qu,Qu),[2,3,6,7].includes(r)&&(o.push(Ju),this.shouldSkipError=!0),4===r&&o.push(es);var i=ju(o);switch(t){case 1:return QE(e,n,i,this.name);case 2:return ek(e,n,i);case 3:return tk(e,n,i);case 4:return rk(e,n,i);case 5:return nk(e,n,i);case 6:return ak(e,n,i);case 7:var u=ik(!1,e,n,i,this.name);if(!za(u))return u;var s=Math.sqrt(u.getValue());return new it.NumberVar(s);case 8:var l=ik(!0,e,n,i,this.name);if(!za(l))return l;var c=Math.sqrt(l.getValue());return new it.NumberVar(c);case 9:return ok(e,n,i);case 10:return ik(!1,e,n,i,this.name);case 11:return ik(!0,e,n,i,this.name);case 12:return pk(2,e,n,i,this.name);case 13:for(var h=0;h<n.length;++h){var f=n[h];if(Xa(f)&&1===f.size()&&qa(f.at(0,0)))return Ql(this.name)}return Ik(e,n,i,this.name)}var d=this.checkArgs(e,n,i);if(d.err)return d.err;switch(t){case 14:return mk(e,d.array,d.numVar,this.name);case 15:return yk(e,d.array,d.numVar,this.name);case 16:return gk(e,d.array,d.numVar,this.name);case 17:return _k(e,d.array,d.numVar,this.name);case 18:return kk(0,d.array,d.numVar,this.name);case 19:return Sk(0,d.array,d.numVar,this.name);default:return Ce.d$b[Ce.O6N.UNKNOWN_AGGREGATE_FUNCTION]({funcName:this.name,arg:t})}}}]),t}(pw("AGGREGATE",3,252,1,Vd,[{type:Vd},{type:Vd},{type:Ud},{type:Ud}]));function Vk(e){return function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).hasSubtotal=!1,e.hasAggregate=!1,e.alwaysCalcOp=void 0,e.tokens=[],e.functionCount=new Map,e.nameParamCompileContext=null,e.functionStack=[],e.invokeFunctionCounter=0,e.isArrayFormula=!1,e.importRangeCount=0,e.expression=[],e.hasArrayFunction=!1,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getTokens",value:function(){return this.tokens}},{key:"getRefs",value:function(){return fw(this.refs)?null:this.refs}},{key:"getParams",value:function(){var e,t;return null!==(e=null===(t=this.nameParamCompileContext)||void 0===t?void 0:t.params)&&void 0!==e?e:null}},{key:"resetState",value:function(){this.tokens=[],this.refId=1,this.refs={},this.hasSubtotal=!1,this.hasAggregate=!1,this.isArrayFormula=!1,this.importRangeCount=0,this.hasArrayFunction=!1,this.alwaysCalcOp=void 0,this.nameParamCompileContext=null,this.invokeFunctionCounter=0,this.expression=[],this.functionStack=[]}},{key:"visitTree",value:function(e,t){return this.context=t,this.resetState(),this.visit(e),this.expression}},{key:"entry",value:function(e){var t;this.visit(e.formula),this.isArrayFormula=this.checkArrayFormula(this.expression),null===(t=this.afterVisitEntry)||void 0===t||t.call(this,this.calcEngine,this.expression)}},{key:"formula",value:function(e){this.visitBinaryOp(e,"ComparisonOperator")}},{key:"concatExp",value:function(e){this.visitBinaryOp(e,"Concatenate")}},{key:"addExp",value:function(e){this.visitBinaryOp(e,"AdditionOperator")}},{key:"mulExp",value:function(e){this.visitBinaryOp(e,"MultiplicationOperator")}},{key:"powExp",value:function(e){this.visitBinaryOp(e,"Power")}},{key:"percentExp",value:function(e){var t,r;this.visit(e.prefixExp);for(var n=null!==(t=null===(r=e.Percent)||void 0===r?void 0:r.length)&&void 0!==t?t:0,a=0;a<n;a++){var o=e.Percent[a];this.appendToken(o.image);var i=this.calcEngine.getSuffixUnaryOp(o.image);if(null==i)throw new Error("Invalid token in the percent expression!");this.expression.push(this.visitPercentExp(i))}}},{key:"prefixExp",value:function(e){var t,r,n=this,a=null!==(t=null===(r=e.AdditionOperator)||void 0===r?void 0:r.length)&&void 0!==t?t:0;0!==a&&e.AdditionOperator.forEach((function(e){n.appendToken(e.image)})),this.visit(e.baseFormula);for(var o=a-1;o>=0;o--){var i=e.AdditionOperator[o],u=this.calcEngine.getPrefixUnaryOp(i.image);if(null==u)throw new Error("Invalid token in the prefix expression!");this.expression.push(this.visitPrefixExp(u))}}},{key:"baseFormula",value:function(e){if(void 0!==e.simpleConstant)this.visit(e.simpleConstant);else if(void 0!==e.matrixConstant)this.visit(e.matrixConstant);else if(void 0!==e.advancedReference)this.visit(e.advancedReference);else{if(void 0===e.notCommaAdvancedReference)throw new Error("Invalid token in the baseFormula expression!");this.visit(e.notCommaAdvancedReference)}}},{key:"advancedReference",value:function(e){this.visitRefOp(e,"Comma")}},{key:"intersectExp",value:function(e){this.visitRefOp(e,"WhiteSpace")}},{key:"rangeExp",value:function(e){this.visitRefOp(e,"Colon")}},{key:"notCommaAdvancedReference",value:function(e){this.visitRefOp(e,"WhiteSpace")}},{key:"notCommaRangeExp",value:function(e){this.visitRefOp(e,"Colon")}},{key:"simpleConstant",value:function(e){if(void 0!==e.LogicalConstant){var t=e.LogicalConstant[0].image.toUpperCase();switch(this.appendToken(t),t){case it.BooleanVar.TRUE:this.expression.push(this.visitLogicalConstant(!0));break;case it.BooleanVar.FALSE:this.expression.push(this.visitLogicalConstant(!1))}}else if(void 0!==e.NumericalConstant){var r=(0,it.convertTo15Digits)(parseFloat(e.NumericalConstant[0].image));this.appendToken(String(r).toUpperCase()),this.expression.push(this.visitNumericalConstant(r))}else if(void 0!==e.StringConstant){var n=e.StringConstant[0].image;this.appendToken(n),this.expression.push(this.visitStringConstant(n.slice(1,n.length-1).replace(/""/g,'"')))}else{if(void 0===e.ErrorConstant)throw new Error("Invalid token in the simpleConstant expression!");var a=e.ErrorConstant[0].image;this.visitError(a)}}},{key:"visitError",value:function(e){switch(this.appendToken(e),e){case it.ErrorConstant.NULL:this.expression.push(this.visitErrorConstant(it.NULL_ERR_VAR));break;case it.ErrorConstant.DIV0:this.expression.push(this.visitErrorConstant(it.DIV0_ERR_VAR));break;case it.ErrorConstant.VALUE:this.expression.push(this.visitErrorConstant(it.VALUE_ERR_VAR));break;case it.ErrorConstant.NAME:this.context.error=it.NAME_ERR_VAR,this.expression.push(this.visitErrorConstant(it.NAME_ERR_VAR));break;case it.ErrorConstant.NUM:this.expression.push(this.visitErrorConstant(it.NUM_ERR_VAR));break;case it.ErrorConstant.NA:this.expression.push(this.visitErrorConstant(it.NA_ERR_VAR));break;case it.ErrorConstant.REF:this.expression.push(this.visitErrorConstant(it.REF_ERR_VAR));break;default:this.expression.push(this.visitErrorConstant(it.tractorErrorVarCreators[it.ErrorCode.DEFAULT_RUNTIME_ERROR](e)))}}},{key:"matrixConstant",value:function(e){this.appendToken(e.OpenBrace[0].image),this.visit(e.lhs);var t=1;if(void 0!==e.rhs){for(var r=0;r<e.rhs.length;r++){var n=e.rhs[r],a=e.SemiColon[r].image;this.appendToken(hw(a)),this.visit(n)}t+=e.rhs.length}this.appendToken(e.CloseBrace[0].image),this.expression.push(this.visitFunctionOp(this.calcEngine.getFunctionOp("PRIVATE_ARRAY_LITERAL"),t))}},{key:"simpleConstantList",value:function(e){var t,r;this.visit(e.lhs);for(var n=null!==(t=null===(r=e.rhs)||void 0===r?void 0:r.length)&&void 0!==t?t:0,a=0;a<n;a++){var o=e.Comma[a].image;this.appendToken(cw(o)),this.visit(e.rhs[a])}var i=this.calcEngine.getFunctionOp("PRIVATE_ARRAY_ROW");this.expression.push(this.visitFunctionOp(i,n+1))}},{key:"parenExp",value:function(e){var t=Array.isArray(e.arguments)&&e.arguments.length>0;t&&this.setInvokeFunctionStatus(!0);var r=e.OpenParen[0].image;this.appendToken(sw(r)),this.visit(e.formula);var n=e.CloseParen[0].image;this.appendToken(lw(n)),this.expression.push(this.visitParenOp(this.calcEngine.getParenOp())),t&&(this.setInvokeFunctionStatus(!1),this.visitInvokedFunction(e.arguments,e.OpenParen,e.CloseParen))}},{key:"visitInvokedFunction",value:function(e,t,r){for(var n=0;n<e.length;n++){n!==e.length-1&&this.setInvokeFunctionStatus(!0);var a=t[n].image;this.appendToken(sw(a));var o=e[n];this.visit(o);var i=r[n].image;this.appendToken(lw(i));var u,s=o.children;u=void 0===s.firstArgument&&void 0===s.Comma?1:void 0===s.Comma?2:s.Comma.length+2,this.expression.push(this.visitFunctionOp(this.calcEngine.getInvokeFunctionOp(),u)),n!==e.length-1&&this.setInvokeFunctionStatus(!1)}}},{key:"arguments",value:function(e){var t,r,n=this.functionStack[this.functionStack.length-1];r=n instanceof dk,!(t=n instanceof fk)&&!r||Array.isArray(e.Comma)||(this.nameParamCompileContext.argumentCompileTypes[this.nameParamCompileContext.argumentCompileTypes.length-1]=1);var a=void 0!==e.firstArgument;if(a&&this.visit(e.firstArgument),void 0!==e.Comma){a||this.expression.push(this.visitEmptyArgument());for(var o=0,i=0;i<e.Comma.length;i++){var u;if(t&&i===e.Comma.length-1){var s=this.nameParamCompileContext.argumentCompileTypes.length-1;this.nameParamCompileContext.argumentCompileTypes[s]=1}if(r){var l=this.nameParamCompileContext.argumentCompileTypes.length-1;i%2==0||i===e.Comma.length-1?this.nameParamCompileContext.argumentCompileTypes[l]=1:this.nameParamCompileContext.argumentCompileTypes[l]=0}var c=e.Comma[i];this.appendToken(cw(c.image));var h=null===(u=e.restArguments)||void 0===u?void 0:u[o];null!=h&&h.location.startOffset===c.endOffset+1?(o+=1,this.visit(h)):this.expression.push(this.visitEmptyArgument())}}}},{key:"funcExp",value:function(e){var t=e.FunctionName[0].image,r=this.getFunctionNameFromNode(t.toUpperCase()),n=this.calcEngine.getFunctionOp(r),a=null,o=Array.isArray(e.restCalls)&&e.restCalls.length>0;if(o&&this.setInvokeFunctionStatus(!0),null!=n)this.functionStack.push(n),n instanceof lk?this.hasSubtotal=!0:n instanceof zE?(this.importRangeCount++,this.hasArrayFunction=!0):n instanceof fk||n instanceof dk?(null===this.nameParamCompileContext&&(this.nameParamCompileContext={params:[],argumentCompileTypes:[],stack:[]}),this.nameParamCompileContext.stack.push({}),this.nameParamCompileContext.argumentCompileTypes.push(0)):n instanceof Ok?this.hasAggregate=!0:ud.has(n.name)&&!sd.has(n.name)&&(this.hasArrayFunction=!0),n.alwaysCalc&&(this.alwaysCalcOp||(this.alwaysCalcOp=new Set),this.alwaysCalcOp.add(n)),this.appendToken(sw(t.toUpperCase()));else{if(null!==this.nameParamCompileContext){var i=this.nameParamCompileContext.argumentCompileTypes;if(1===i[i.length-1])for(var u=r.toUpperCase(),s=this.nameParamCompileContext.stack.length-1;s>=0;s--){var l=this.nameParamCompileContext.stack[s][u];if(null!=l){this.appendParamToken(l[0]),this.appendToken("("),a=l[1],this.expression.push(a);break}}}null===a&&this.appendToken(sw(t))}this.visit(e.firstCall);var c=e.firstCall[0].children,h=void 0!==c.Comma?c.Comma.length+1:void 0===c.firstArgument?0:1,f=e.CloseParen[0].image;if(this.appendToken(lw(f)),this.countFunction(r),null!=n){var d,v;this.functionStack.pop(),(n instanceof fk||n instanceof dk)&&(null!==(d=this.nameParamCompileContext)&&void 0!==d&&d.argumentCompileTypes.pop(),null===(v=this.nameParamCompileContext)||void 0===v||v.stack.pop());var p=this.visitFunctionOp(n,h);this.expression.push(p)}else if(null!==a)this.expression.push(this.visitFunctionOp(this.calcEngine.getInvokeFunctionOp(),h+1));else{var m=this.getFunctionNameFromNode(t);this.context.error=it.NAME_ERR_VAR,this.expression.push(this.visitFunctionOp(new vw(m),h))}o&&this.setInvokeFunctionStatus(!1),Array.isArray(e.restCalls)&&e.restCalls.length>0&&this.visitInvokedFunction(e.restCalls,e.OpenParen,e.CloseParen)}},{key:"visitBinaryOp",value:function(e,t){var r,n;this.visit(e.lhs);for(var a=null!==(r=null===(n=e.rhs)||void 0===n?void 0:n.length)&&void 0!==r?r:0,o=0;o<a;o++){var i=e[t][o].image;this.appendToken(i);var u=this.calcEngine.getBinaryOp(i);if(null==u)throw new Error("Invalid token in the binary operator");this.visit(e.rhs[o]),this.expression.push(this.visitBinaryOperator(u))}}},{key:"visitRefOp",value:function(e,t){var r,n;this.visit(e.lhs);for(var a=null!==(r=null===(n=e.rhs)||void 0===n?void 0:n.length)&&void 0!==r?r:0,o=0;o<a;o++){var i=e[t][o].image;this.appendToken(i),this.visit(e.rhs[o]);var u=i.replace(/\r|\n|\t/g," ").trim();0===u.length&&(u=" "),""===u?u=":":""===u&&(u=",");var s=this.calcEngine.getBinaryOp(u);if(null==s)throw new Error("Invalid token in ref operator");this.expression.push(this.visitRefOperator(s))}}},{key:"visitNameRef",value:function(e){var t=e.Name[0].image,r=qf(t,this.context);if(null===r)throw new Error("unexpected error in parse reference");if(this.nameParamCompileContext&&this.nameParamCompileContext.argumentCompileTypes){var n=this.nameParamCompileContext.argumentCompileTypes.length-1,a=t.toUpperCase();if(0===this.nameParamCompileContext.argumentCompileTypes[n]){var o=this.nameParamCompileContext.stack[n],i=this.visitParameterReference(this.nameParamCompileContext.params.length);this.nameParamCompileContext.params.push(t);var u=this.nameParamCompileContext.params.length-1;return null==o[a]&&(o[a]=[u,i]),this.appendParamToken(u),void this.expression.push(i)}for(var s=n;s>=0;s--){var l=this.nameParamCompileContext.stack[s][a];if(null!=l)return this.appendParamToken(l[0]),void this.expression.push(l[1])}return this.appendToken(t),void this.expression.push(this.visitErrorConstant(it.NAME_ERR_VAR))}this.appendToken(t),this.expression.push(this.visitErrorConstant(r))}},{key:"visitFieldNameRef",value:function(e,t){var r=e.FieldNameLocalReferenceA1[0].image,n=Jf(r,this.context,t);if(null==n)throw new Error("unexpected error in parse reference");if(n.isError())this.appendToken(r),this.expression.push(this.visitErrorConstant(n));else{var a=this.appendToken(n);this.expression.push(this.visitReference(a))}}},{key:"visitLocalRef",value:function(e){var t=nd(e,this.context);if(null==t)throw new Error("unexpected error in parse reference");if(t.isError())this.appendToken(e),this.expression.push(this.visitErrorConstant(t));else{var r=this.appendToken(t);this.expression.push(this.visitReference(r))}}},{key:"visitExternalRef",value:function(e){var t=nd(e,this.context);if(null==t)throw new Error("unexpected error in parse reference");if(t.isError())this.appendToken(e),this.expression.push(this.visitErrorConstant(t));else{var r=this.appendToken(t);this.expression.push(this.visitReference(r))}}},{key:"getFunctionNameFromNode",value:function(e){var t=e.trim();return t.substring(0,t.length-1)}},{key:"appendToken",value:function(e){if(e instanceof eu){var t="R"+this.refId++;return this.tokens.push(t),this.refs[t]=e,t}var r=this.tokens.length;if(0===r||"C"!==this.tokens[r-1][0]){var n="C".concat(e);return this.tokens.push(n),n}return this.tokens[r-1]+=e,e}},{key:"appendParamToken",value:function(e){this.tokens.push("P".concat(e))}},{key:"countFunction",value:function(e){var t=this.functionCount.get(e)||0;this.functionCount.set(e,t+1)}},{key:"getFuncStatistics",value:function(){return this.functionCount}},{key:"setInvokeFunctionStatus",value:function(e){e?this.invokeFunctionCounter++:this.invokeFunctionCounter--}}]),t}(e)}function Nk(e){return function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"afterVisitEntry",value:function(e,t){var r=t[t.length-1];if(r.isOp()){var n=r.op();n instanceof aw?(n=e.getPrecisionAddOp(),r.setOperator(n)):n instanceof ow&&(n=e.getPrecisionSubOp(),r.setOperator(n))}}},{key:"checkArrayFormula",value:function(e){return ld(e)}},{key:"visitPercentExp",value:function(e){return this.visitSheetOperatorVar(e,1)}},{key:"visitPrefixExp",value:function(e){return this.visitSheetOperatorVar(e,1)}},{key:"visitLogicalConstant",value:function(e){return new it.BooleanVar(e)}},{key:"visitNumericalConstant",value:function(e){return new it.NumberVar(e)}},{key:"visitStringConstant",value:function(e){return new it.StringVar(e)}},{key:"visitErrorConstant",value:function(e){return e}},{key:"visitMatrixSimpleConstantWithRef",value:function(e){return it.REF_ERR_VAR}},{key:"visitMatrixSimpleConstantWithNumber",value:function(e,t){return new it.NumberVar("+"===e?t:-t)}},{key:"visitParameterReference",value:function(e){return"number"==typeof e?new dp(e):e}},{key:"visitParenOp",value:function(e){return this.visitSheetOperatorVar(e,1)}},{key:"visitEmptyArgument",value:function(){return ho}},{key:"visitFunctionOp",value:function(e,t){return this.visitSheetOperatorVar(e,t)}},{key:"visitBinaryOperator",value:function(e){return this.visitSheetOperatorVar(e,2)}},{key:"visitRefOperator",value:function(e){return this.visitSheetOperatorVar(e,2)}},{key:"visitReference",value:function(e){return new DE(e)}},{key:"visitSheetOperatorVar",value:function(e,t){return new PE(e,t)}}]),t}(e)}function bk(e){return function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"checkArrayFormula",value:function(e){return cd(e)}},{key:"visitPercentExp",value:function(e){return this.visitOperatorVar(e,1)}},{key:"visitPrefixExp",value:function(e){return this.visitOperatorVar(e,1)}},{key:"visitLogicalConstant",value:function(e){return this.visitBooleanVar(e)}},{key:"visitNumericalConstant",value:function(e){return this.visitNumberVar(e)}},{key:"visitStringConstant",value:function(e){return this.visitStringVar(e)}},{key:"visitErrorConstant",value:function(e){return this.visitErrorVar(e)}},{key:"visitMatrixSimpleConstantWithRef",value:function(e){return this.visitErrorVar(it.REF_ERR_VAR)}},{key:"visitMatrixSimpleConstantWithNumber",value:function(e,t){switch(e){case"+":return this.visitNumberVar(t);case"-":return this.visitNumberVar(-t)}return null}},{key:"visitParameterReference",value:function(e){return this.visitParameterVar(e)}},{key:"visitParenOp",value:function(e){return this.visitOperatorVar(e,1)}},{key:"visitEmptyArgument",value:function(){return this.visitNullVar()}},{key:"visitFunctionOp",value:function(e,t){return this.visitOperatorVar(e,t)}},{key:"visitBinaryOperator",value:function(e){return this.visitOperatorVar(e,2)}},{key:"visitRefOperator",value:function(e){return this.visitOperatorVar(e,2)}},{key:"visitReference",value:function(e){return this.visitReferenceVar(e)}},{key:"visitOperatorVar",value:function(e,t){var r=e.name,n="";return e instanceof it.FuncOpBase?n="F:".concat(r,":").concat(t):e instanceof it.BinaryOpBase?n="OB".concat(r):e instanceof it.PrefixUnaryOpBase?n="OP".concat(r):e instanceof it.SuffixUnaryOpBase?n="OS".concat(r):e instanceof it.ParenOp?n="OG".concat(t):e instanceof gp&&(n="OI".concat(t)),n}},{key:"visitNumberVar",value:function(e){return"D".concat(e)}},{key:"visitStringVar",value:function(e){return"S".concat(e)}},{key:"visitBooleanVar",value:function(e){return"B"+(e?1:0)}},{key:"visitNullVar",value:function(){return"N"}},{key:"visitErrorVar",value:function(e){var t=e.getSpecialInfo();return t&&"string"==typeof t.errorInfo?"E:".concat(e.errorType,":").concat(t.errorInfo,":").concat(e.errorCode):"E:".concat(e.errorType,"::").concat(e.errorCode)}},{key:"visitReferenceVar",value:function(e){return e}},{key:"visitParameterVar",value:function(e){return"number"==typeof e?"P".concat(e):e}}]),t}(e)}!function(e){e[e.Parameter=0]="Parameter",e[e.Expression=1]="Expression"}(sk||(sk={}));function Mk(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=t.sheet();if(null==o)throw new Error("failed to deserialize: sheet not found in ref");if(r&&!n)throw new Error('When serializing a transposed range, there must be a "sourceCell".');var i={ref:t};if(null==e.refs)return{formulaData:e,formulaText:_p(e,null,i)};for(var u={},s=Object.keys(e.refs),l=r?a?Zk(e,a,{ref:n}):[!1,void 0]:[!0,void 0],c=(0,g.Z)(l,2),h=c[0],f=c[1],d=0;d<s.length;d++){var v=s[d],p=e.refs[v],m=void 0;m=r?xk(p,t,n,h,null==f?void 0:f.get(v)):ls(p,o,(function(e){return o.getParent().getSheetFromId(e)}),i),u[v]=m,e.refs[v]=is(m,i)}return{formulaData:e,formulaText:_p(e,u,i)}}function Fk(e,t,r,n){var a={},o=0;for(var i in e){var u=e[i];a[i]=ls(u,t,r,n),o++}return 0===o?null:a}function Zk(e,t,r){var n=Object.keys(e.refs),a=t.sheet(),o=new Map;return[n.some((function(n){var i=ls(e.refs[n],a,(function(e){return a.getParent().getSheetFromId(e)}),r);return o.set(n,i),t.isIntersect(i)})),o]}function xk(e,t,r,n,a){var o,i,u={ref:r},s=r.sheet();a=a||ls(e,s,(function(e){return s.getParent().getSheetFromId(e)}),u);var l=0==(e.type&os);if(!n&&!l)return a.setSheet(a.sheet()),a;var c,h=a.rowFrom()-r.rowFrom(),f=a.colFrom()-r.colFrom(),d=t.offset(f,h),v=Number(a.refStatus()).toString(2).padStart(4,"0").split("");return o=[v[2],v[0]],v[0]=o[0],v[2]=o[1],i=[v[3],v[1]],v[1]=i[0],v[3]=i[1],(c=1===a.rowCount()&&1===a.colCount()?new uu(d.rowFrom(),d.colFrom(),t.sheet()):new ou(d.rowFrom(),d.colFrom(),a.colCount(!0),a.rowCount(!0),t.sheet())).setRefStatus(parseInt(v.join(""),2)),c}function Dk(e){return new it.ErrorVar(it.ErrorType.RUNTIME_ERROR,it.ErrorConstant.RUNTIME_ERROR,Ce.O6N.DESERIALIZE_FORMULA_ERROR,{message:e})}function Pk(e,t,r){if(t||r){var n=e.parent.importRangeManager,a=null;if(t?a=n.getMetaFromId(t):r&&(a=r),a){var o=a,i=o.spreadSource,u=o.ref,s=o.isSyncStyle,l=id(u);if(!l)throw new Error("range is null");return{importRangeMeta:a,externalDataReferenceInfo:{url:i,range:l,isSyncStyle:s}}}}}function $k(e,t){var r;return!1===(null===(r=Object.getOwnPropertyDescriptor(e,"externalDataReference"))||void 0===r?void 0:r.writable)?e=Object.assign({},e,{externalDataReference:t}):e.externalDataReference=t,e}function Lk(e,t,r){var n;if(!function(e,t){for(var r=t.tree,n=r.length-1;n>=0;n--)if(r[n].includes(e))return!0;return!1}("F:IMPORTRANGE",t))return t;var a=e.parent,o=a.calcEngine,i=a.importRangeManager;if(a.importRangeManagerV3.V3Enable)return t.externalDataReference&&(t=$k(t,void 0)),t;var u=o.deserializeFormula(t,r,{enableCalculation:!0,useCache:!1}),s={ref:r,spread:a},l=u.formula,c=l.tokens,h=l.serialization,f=l.expression,d=l.params,v=dd(u,u.formula.expression);if(!v||!v.length)return $k(t,null);var p=null!==(n=v[0])&&void 0!==n?n:u.getExternalDataReferenceInfo(),m={sheetID:e.id(),url:p.url,range:p.range},g=i.generateAndCacheId(u,m);return Tp(u=o.createFormula(r,{refMap:u.refMap,formula:new qR({tokens:c,serialization:h,expression:f,params:d,importRangeId:null==g?void 0:g.importRangeId,importRangeMeta:g,externalDataReferenceInfo:p}),isArrayFormula:Wp(u)}),s)}var Bk={B:function(e,t){var r=t.isRoot,n=t.calcEngine,a=n.getBinaryOp(e);return r&&(a instanceof ow&&(a=n.getPrecisionSubOp()),a instanceof aw&&(a=n.getPrecisionAddOp())),[a,2]},S:function(e,t){return[t.calcEngine.getSuffixUnaryOp(e),1]},P:function(e,t){return[t.calcEngine.getPrefixUnaryOp(e),1]},G:function(e,t){return[t.calcEngine.getParenOp(),Number(e)]},I:function(e,t){return[t.calcEngine.getInvokeFunctionOp(),Number(e)]}};var Uk,Hk=[{deserializeRefs:function(e,t,r,n){return null==e?null:Fk(e,t,(function(e){return t.getParent().getSheetFromId(e)}),Object.assign({ref:r},n))},deserializeTree:function(e,t,r){for(var n,a=e.length,o=new Array(a),i=!1,u=!1,s=!1,l=Object.assign({},r,{refs:t}),c=a-1;c>=0;c--){var h=e[c],f=r.visitFunctions[h[0]];if(null==f)throw new Error("Failed to deserialize: Unknown var ".concat(h[0]));var d=f(h,l,c===e.length-1);if(d.isOp()){var v=d.op(),p=v.name;"SUBTOTAL"===p?i=!0:"AGGREGATE"===p?u=!0:ud.has(p)&&!sd.has(p)&&(s=!0),v.alwaysCalc&&(n||(n=new Set),n.add(v))}o[c]=d}return[o,n,i,u,s]},deserializeParams:function(e){return null==e?null:e.map((function(e,t){return new dp(t)}))},visitFunctions:{B:function(e){return new it.BooleanVar("1"===e[1])},D:function(e){return new it.NumberVar(Number(e.substring(1)))},S:function(e){return new it.StringVar(e.substring(1))},N:function(){return ho},E:function(e){var t=e.split(":"),r=Number(t[1]),n=t[2]||null,a=function(e){switch(e){case it.ErrorType.NULL:return it.NULL_ERR_VAR;case it.ErrorType.DIV0:return it.DIV0_ERR_VAR;case it.ErrorType.VALUE:return it.VALUE_ERR_VAR;case it.ErrorType.REF:return it.REF_ERR_VAR;case it.ErrorType.NAME:return it.NAME_ERR_VAR;case it.ErrorType.NUM:return it.NUM_ERR_VAR;case it.ErrorType.NA:return it.NA_ERR_VAR;default:return Dk("Unknown error type, ".concat(e))}}(r);return null!=n&&(a=a.clone()).setSpecialInfo({errorInfo:n}),a},R:function(e,t){var r=t.refs;if(null==(r?r[e]:null))throw new Error("Failed to deserialize: refVar not found");return new DE(e)},M:function(e){var t=e.split(":"),r=Number(t[1]||0),n=Number(t[2]||0),a=new Ep(r,n);return new PE(a,r*n)},O:function(e,t,r){var n,a,o=t.calcEngine,i=e[1],u=e.substring(2),s=Bk[i],l=null,c=0;if(null!=s&&(n=s(u,{isRoot:r,calcEngine:o}),l=(a=(0,g.Z)(n,2))[0],c=a[1]),!l)throw new Error("Failed to deserialize: Unknown operator ".concat(e));return new PE(l,c)},F:function(e,t){var r=t.calcEngine,n=e.split(":"),a=r.getFunctionOp(n[1])||new vw(n[1]),o=Number(n[2]||0);return new PE(a,o)},P:function(e,t){var r=t.params,n=Number(e.slice(1));if(null==r)return Dk("Unknown lambda Param, ".concat(e));var a=r[n];return null!=a?a:Dk("Unknown lambda Param, ".concat(e))}}}];function zk(e,t,r,n,a){var o,i=t.sheet();if(null==i)throw new Error("Failed to deserialize: sheet not found in ref");var u=i.getParent().calcEngine,s=null===(o=null==n?void 0:n.enableCalculation)||void 0===o||o,l=a?r.fromMutation(e,t,i,a,n):r.fromJSON(e,t,i,n),c=(0,g.Z)(l,2),h=c[0],f=c[1],d=u.createFormula(t,{refMap:f,enableCalculation:s,formula:h}),v=i.parent.importRangeManager;return h.importRangeMeta&&v.setImportRangeMeta(d,h.importRangeMeta),d}!function(e){e.LexicalAnalysis="LexicalAnalysis",e.SyntaxAnalysis="SyntaxAnalysis",e.SemanticAnalysis="SemanticAnalysis"}(Uk||(Uk={}));var Wk=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,null,[{key:"now",value:function(){return void 0===window.performance?Date.now():window.performance.now()}}]),e}(),Gk=function(){function e(t){(0,y.Z)(this,e),this.calcEngine=t,this.isCollectPerformance=!0,this.performanceData={formulaCount:0,LexicalAnalysis:0,SyntaxAnalysis:0,SemanticAnalysis:0},this.A1Instance=null,this.SerializationA1Instance=null,this.R1C1Instance=null,this.SerializationR1C1Instance=null,this.builder=this.getVisitBuilderA1Instance()}return(0,_.Z)(e,[{key:"getVisitBuilderA1Instance",value:function(){if(null!=this.A1Instance)return this.A1Instance;var e=function(e){return function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"referenceFunction",value:function(e){if(void 0!==e.LocalReferenceA1){var t=e.LocalReferenceA1[0].image;this.visitLocalRef(t)}else if(void 0!==e.ExternalReferenceA1){var r=e.ExternalReferenceA1[0].image;this.visitExternalRef(r)}else if(void 0!==e.RefConstant)this.visitError(it.REF_ERR_VAR.getValue());else if(void 0!==e.Name)this.visitNameRef(e);else if(void 0!==e.parenExp)this.visit(e.parenExp);else{if(void 0===e.funcExp)throw new Error("Invalid token in the referenceFunction expression!");this.visit(e.funcExp)}}}]),t}(Vk(Nk(e)))}(nw.getTractorParserA1().getBaseCstVisitorConstructor());return this.A1Instance=new e,this.A1Instance}},{key:"getSerializationVisitBuilderA1Instance",value:function(){if(null!=this.SerializationA1Instance)return this.SerializationA1Instance;var e=function(e){return function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).serialization=[],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"referenceFunction",value:function(e){if(void 0!==e.LocalReferenceA1){var t=e.LocalReferenceA1[0].image;this.visitLocalRef(t)}else if(void 0!==e.ExternalReferenceA1){var r=e.ExternalReferenceA1[0].image;this.visitExternalRef(r)}else if(void 0!==e.RefConstant)this.visitError(it.REF_ERR_VAR.getValue());else if(void 0!==e.Name)this.visitNameRef(e);else if(void 0!==e.parenExp)this.visit(e.parenExp);else{if(void 0===e.funcExp)throw new Error("Invalid token in the referenceFunction expression!");this.visit(e.funcExp)}}}]),t}(Vk(bk(e)))}(nw.getTractorParserA1().getBaseCstVisitorConstructor());return this.SerializationA1Instance=new e,this.SerializationA1Instance}},{key:"getVisitBuilderR1C1Instance",value:function(){if(null!=this.R1C1Instance)return this.R1C1Instance;var e=function(e){return function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"referenceFunction",value:function(e){if(void 0!==e.LocalReferenceR1C1){var t=e.LocalReferenceR1C1[0].image;this.visitLocalRef(t)}else if(void 0!==e.ExternalReferenceR1C1){var r=e.ExternalReferenceR1C1[0].image;this.visitExternalRef(r)}else if(void 0!==e.RefConstant)this.visitError(it.REF_ERR_VAR.getValue());else if(void 0!==e.Name)this.visitNameRef(e);else if(void 0!==e.parenExp)this.visit(e.parenExp);else{if(void 0===e.funcExp)throw new Error("Invalid token in the referenceFunction expression!");this.visit(e.funcExp)}}}]),t}(Vk(Nk(e)))}(nw.getTractorParserR1C1().getBaseCstVisitorConstructor());return this.R1C1Instance=new e,this.R1C1Instance}},{key:"getSerializationVisitBuilderR1C1Instance",value:function(){if(null!=this.SerializationR1C1Instance)return this.SerializationR1C1Instance;var e=function(e){return function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).serialization=[],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"referenceFunction",value:function(e){if(void 0!==e.LocalReferenceR1C1){var t=e.LocalReferenceR1C1[0].image;return this.visitLocalRef(t)}if(void 0!==e.ExternalReferenceR1C1){var r=e.ExternalReferenceR1C1[0].image;return this.visitExternalRef(r)}if(void 0===e.RefConstant){if(void 0!==e.Name)return this.visitNameRef(e);if(void 0!==e.parenExp)return this.visit(e.parenExp);if(void 0!==e.funcExp)return this.visit(e.funcExp);throw new Error("Invalid token in the referenceFunction expression!")}this.visitError(it.REF_ERR_VAR.getValue())}}]),t}(Vk(bk(e)))}(nw.getTractorParserR1C1().getBaseCstVisitorConstructor());return this.SerializationR1C1Instance=new e,this.SerializationR1C1Instance}}]),(0,_.Z)(e,[{key:"startCollectPerformance",value:function(){this.isCollectPerformance=!0,this.performanceData.formulaCount=0,this.performanceData.LexicalAnalysis=0,this.performanceData.SyntaxAnalysis=0,this.performanceData.SemanticAnalysis=0}},{key:"stopCollectPerformance",value:function(){this.isCollectPerformance=!1}},{key:"collectPerformanceData",value:function(e){this.isCollectPerformance&&(this.performanceData.formulaCount+=1,this.performanceData.LexicalAnalysis+=e.LexicalAnalysis,this.performanceData.SyntaxAnalysis+=e.SyntaxAnalysis,this.performanceData.SemanticAnalysis+=e.SemanticAnalysis)}},{key:"getPerformanceData",value:function(){var e=this.performanceData.formulaCount;return 0===e?null:{formulaCount:e,timeCost:this.performanceData.LexicalAnalysis+this.performanceData.SyntaxAnalysis+this.performanceData.SemanticAnalysis,LexicalAnalysis:this.performanceData.LexicalAnalysis/e,SyntaxAnalysis:this.performanceData.SyntaxAnalysis/e,SemanticAnalysis:this.performanceData.SemanticAnalysis/e}}},{key:"compile",value:function(e,t){var r,n,a,o,i;void 0===t.refStyle&&(t.refStyle="A1");var u,s,l=null===(r=t.enableCalculation)||void 0===r||r,c=[],h=Wk.now(),f=this.compileTokens(e,t.refStyle),d=Wk.now(),v=f.lexer,p=yr(null!==(i=f.errors)&&void 0!==i?i:[]);try{for(p.s();!(u=p.n()).done;){var m=u.value;c.push(m)}}catch(e){p.e(e)}finally{p.f()}switch(t.refStyle){case"A1":s=nw.getTractorParserA1(),this.setVisitBuilder(l?this.getVisitBuilderA1Instance():this.getSerializationVisitBuilderA1Instance());break;case"R1C1":s=nw.getTractorParserR1C1(),this.setVisitBuilder(l?this.getVisitBuilderR1C1Instance():this.getSerializationVisitBuilderR1C1Instance());break;default:throw Error("RefStyle is not found!")}s.input=f.tokens;var y,_=s.entry(),R=Wk.now(),C=yr(s.errors);try{for(C.s();!(y=C.n()).done;){var w=y.value;c.push(w)}}catch(e){C.e(e)}finally{C.f()}if(c.length>0)return{formulaVar:null,lexer:v,parser:s,errors:c};var E=null;try{E=this.builder.visitTree(_,t)}catch(e){c.push(e)}if(0!==c.length)return{formulaVar:null,lexer:v,parser:s,errors:c};var k=t.ref.sheet(),T=this.builder.importRangeCount,S=Boolean(k&&(null===(n=k.parent.importRangeManagerV3)||void 0===n?void 0:n.V3Enable));if(T>1&&k){var A=k.parent.importRangeManager;if(!1===S)return A.collectImportRangeFrontError("import_range_num_greaten_than_one"),{formulaVar:null,lexer:v,parser:s,errors:[new Error("importRangeNum is greater than one")]}}var I=null,O=null;l?I=E:O=E;var V=null!==(a=this.compileImportRange(t.ref,O,I))&&void 0!==a?a:null,N=this.calcEngine.formulaRefService.fromBuilder(this.builder,t.ref,O,I,!S&&V?V[0]:null,l,null!==(o=t.useCache)&&void 0!==o?o:1!==T),b=(0,g.Z)(N,2),M=b[0],F=b[1],Z=this.calcEngine.createFormula(t.ref,{formula:M,refMap:F,enableCalculation:l,isArrayFormula:this.builder.isArrayFormula}),x=Wk.now();return null!=E&&this.collectPerformanceData({LexicalAnalysis:d-h,SyntaxAnalysis:R-d,SemanticAnalysis:x-R}),{formulaVar:Z,lexer:v,parser:s,errors:0===c.length?null:c,externalDataReferenceInfos:V}}},{key:"compileImportRange",value:function(e,t,r){var n;if(this.builder.importRangeCount){r=null!==(n=r)&&void 0!==n?n:function(e,t){for(var r=t.refs,n=t.calcEngine,a=t.version,o=t.params,i=[],u=Hk[a-1],s=u.visitFunctions,l={refs:r,calcEngine:n,visitFunctions:s,params:(0,u.deserializeParams)(o)},c=0;c<e.length;++c){var h=e[c],f=(0,s[h[0]])(h,l,c===e.length-1);i.push(f)}return i}(t,{params:this.builder.getParams(),version:1,calcEngine:this.calcEngine,refs:this.builder.getRefs()});var a=this.calcEngine.formulaRefService.fromBuilder(this.builder,e,t,r,null,!0,!1),o=(0,g.Z)(a,2),i=o[0],u=o[1];return dd(this.calcEngine.createFormula(e,{formula:i,refMap:u,isArrayFormula:this.builder.isArrayFormula}),r)}}},{key:"compileTokens",value:function(e,t){var r=lf(e,t),n=r.lexingResult,a=n.tokens,o=n.errors;return{tokens:a,lexer:r.lexer,errors:0===o.length?null:o}}},{key:"setVisitBuilder",value:function(e){null!=e&&(this.builder=e,this.builder.calcEngine=this.calcEngine)}}]),e}(),jk=function(){function e(t,r,n){(0,y.Z)(this,e),this.data=t,this.refs=t.refs?Fk(t.refs,r,n):null}return(0,_.Z)(e,[{key:"getRefs",value:function(){return this.refs}},{key:"exportRefs",value:function(e){return this.refs?function(e,t){var r={};for(var n in e)r[n]=is(e[n],{ref:t});return r}(this.refs,e):null}},{key:"formulaData",get:function(){return this.data}}]),e}();var Yk=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,new rR))}return(0,p.Z)(t,e),t}(Vy);function qk(e){return e.replace(/https?:\/\//,"bdDriveImg://")}function Jk(){var e=function(){},t=function(){};return[new Promise((function(r,n){e=r,t=n})),e,t]}var Kk,Xk=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,n=setInterval((function(){try{e()&&(clearInterval(n),t())}catch(e){clearInterval(n),t()}}),r)},Qk=function(){function e(){(0,y.Z)(this,e),this._isTestMode=!1,this._storeName="faster-shadow-recording","undefined"!=typeof window&&!0!==window.isNotBrowser&&(this._isTestMode="true"===localStorage.getItem(this._storeName))}return(0,_.Z)(e,[{key:"convertFont",value:function(e){return this._isTestMode?e.replace(/-apple-system, /,"").replace(/BlinkMacSystemFont, /,""):e}},{key:"isTest",get:function(){return this._isTestMode}}]),e}(),eT=new Qk;!function(e){e[e.NO=0]="NO",e[e.ALL_CELL=1]="ALL_CELL",e[e.ALL_NORMAL=2]="ALL_NORMAL",e[e.ALL_ROW=3]="ALL_ROW",e[e.ALL_COL=4]="ALL_COL",e[e.MIXED=5]="MIXED"}(Kk||(Kk={}));var tT={currentRgType:Ce.xj7.CELL,multiSelectType:0};function rT(e){var t,r,n=e.getSelections();if(!n)return tT;var a=null==n?void 0:n[0];if(!a)return tT;var o=a.rgType,i=e.getRowCount(),u=e.getColumnCount(),s=a.rowCount(),l=a.colCount();if(r=o===Ce.xj7.NORMAL?1===s&&1===l?Ce.xj7.CELL:0===a.rowFrom()&&i===s&&0===a.colFrom()&&u===l?Ce.xj7.ALL:0===a.rowFrom()&&i===s?Ce.xj7.COL:0===a.colFrom()&&u===l?Ce.xj7.ROW:Ce.xj7.NORMAL:0===a.rowFrom()&&i===s&&0===a.colFrom()&&u===l?Ce.xj7.ALL:o,!n||n.length<=1)t=0;else{var c=n.map((function(e){return e.rgType})),h=!1,f=!1;if(c.every((function(e){return e===Ce.xj7.NORMAL}))){var d=n.map((function(e){return e.rowCount()+e.colCount()}));h=d.every((function(e){return 2===e})),f=d.every((function(e){return e>2}))}var v=c.every((function(e){return e===Ce.xj7.COL})),p=c.every((function(e){return e===Ce.xj7.ROW}));t=h?1:f?2:v?4:p?3:5}return{currentRgType:r,multiSelectType:t}}function nT(e,t,r,n){function a(t,r){var n=e.getValue(t,r);return""!==n&&null!=n}function o(t,r){var n=e.getSpans(new uu(t,r,e));return n&&n.length>0?a(n[0].rowFrom(),n[0].colFrom()):a(t,r)}function i(e,t,r){for(var n=r.withValue,a=e+u,i=t+s,h=!1;a>=0&&a<l&&i>=0&&i<c;){if(n!==o(a,i)){h=!0;break}a+=u,i+=s}return{row:a-u,col:i-s,found:h}}var u=0,s=0,l=e.getRowCount(),c=e.getColumnCount();switch(n){case 0:u=-1;break;case 3:u=1;break;case 1:s=-1;break;default:s=1}var h=i(t,r,{withValue:!0,direction:n});return(function(t,r,n,a){var o=e.getSpans(new uu(t,r,e));return!!(o&&o.length>0)&&o[0].containCell(n,a)}(t,r,h.row,h.col)||t===h.row&&r===h.col)&&(h=i(h.row,h.col,{withValue:!1,direction:n})).found?{row:h.row+u,col:h.col+s}:{row:h.row,col:h.col}}function aT(){return r.g&&r.g.window.isNotBrowser}function oT(){return r.g&&r.g.window.isNotBrowser&&r.g.window.isMobileSSR}var iT;function uT(e,t){var r=t.floatImageSetting;return{action:"setFloatImage",sheet_id:e,target:{row:r.row,col:r.col},value:t}}function sT(e,t){return{action:"delFloatImage",sheet_id:t,value:{floatImageId:e}}}function lT(e){var t=new Map;return e.forEach((function(e){var r=e.floatImageSetting,n=Wd(r.row,r.col),a=t.get(n);a?t.set(n,[].concat((0,m.Z)(a),[e])):t.set(n,[e])})),t}function cT(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=t.floatImageModel,a={};r?n.validFloatImageIds.forEach((function(e){a[e]=n.getFloatImageById(e)})):a=n.getFloatImageMap();var o=e.toJSON(),i=o.row,u=o.col,s=o.rowCount,l=o.colCount,c=i+s-1,h=u+l-1;return Object.values(a).filter((function(e){var r=e.floatImageSetting,n=r.row,a=r.col,o=r.width,s=r.height,l=r.x,f=r.y;if(n<i||a<u||n>c||a>h)return!1;for(var d=0,v=0,p=a;p<=h;p++)d+=t.getColumnWidth(p);for(var m=n;m<=c;m++)v+=t.getRowHeight(m);return d>=l+o&&v>=f+s}))}function hT(e,t,r,n){var a=n.id(),o=e.floatImageSetting,i=o.x,u=o.y,s=n.getColumnWidth(r),l=n.getRowHeight(t),c=Math.min(s,i),h=Math.min(l,u),f=(0,Re.default)(Object.assign({},o,{x:c,y:h,row:t,col:r}));return{sheetId:a,floatImageId:(0,Ce.zsn)(10),floatImageSetting:f}}function fT(e,t,r){if(1===r){var n=[];t.forEach((function(e){var t=e.target,r=t+e.count-1;n.push([t,r])}));var a=e.getColumnCount(),o=e.getVisibleColCount(0,a),i=dT(n),u=0;return i.forEach((function(t){var r=t[0],n=t[1];u+=e.getVisibleColCount(r,n)})),o===u}var s=[];t.forEach((function(e){var t=e.target,r=t+e.count-1;s.push([t,r])}));var l=e.getRowCount(),c=e.getVisibleRowCount(0,l),h=dT(s),f=0;return h.forEach((function(t){var r=t[0],n=t[1];f+=e.getVisibleRowCount(r,n)})),c===f}function dT(e){var t=[];e.sort((function(e,t){return e[0]-t[0]}));for(var r=e[0],n=1;n<e.length;n++){var a=e[n];r[1]>=a[0]?r[1]=Math.max(a[1],r[1]):(t.push(r),r=a)}return t.push(r),t}function vT(e,t,r){for(var n=t+r;t<n;){if(e.isRowOrColHidden(t,!1))return!0;t++}return!1}function pT(e,t,r){for(var n=t+r;t<n;){if(e.isRowOrColHidden(t,!0))return!0;t++}return!1}!function(e){e[e.Row=0]="Row",e[e.Col=1]="Col"}(iT||(iT={}));var mT={showHideRow:!1,showUnhideRow:!1,showHideCol:!1,showUnhideCol:!1};function gT(e){var t=e.getSelections();if(!t||!t.length)return mT;var r=e.getRowCount(),n=e.getColumnCount(),a=t[0];if(!a)return mT;var o=a.rowFrom(),i=a.colFrom(),u=a.rowCount(),s=a.colCount(),l=i<=0&&s===n,c=o<=0&&u===r,h={};if(l&&c)h=Object.assign({},h,{showUnhideCol:vT(e,i,s),showUnhideRow:pT(e,o,u)});else{if(l){var f=[];t.forEach((function(e){f.push({target:e.rowFrom(),count:e.rowCount()})}));var d=fT(e,f,0);h=Object.assign({},h,{showHideRow:!d,showUnhideRow:pT(e,o,u)})}if(c){var v=[];t.forEach((function(e){v.push({target:e.colFrom(),count:e.colCount()})}));var p=fT(e,v,1);h=Object.assign({},h,{showHideCol:!p,showUnhideCol:vT(e,i,s)})}}return h}var yT=function(){return Ce.Ps3.getPivotLimitEnable()?100:50};function _T(e,t,r,n){return n?new ou(t,r,n.rowCount,n.colCount,e):new ou(t,r,1,1,e)}function RT(e,t,r,n,a){if(a&&n)return{pageRange:new ou(t,r,n.rowCount,n.colCount,e),contentRange:new ou(t+n.rowCount+1,r,a.rowCount,a.colCount,e)};if(a&&!n)return{contentRange:new ou(t,r,a.rowCount,a.colCount,e)};if(!a&&n)return{pageRange:new ou(t,r,n.rowCount,n.colCount,e)};return{pageRange:new ou(t,r,1,1,e),contentRange:new ou(t+2,r,10,5,e),spanRange:new ou(t+7,r+1,1,4,e)}}function CT(e,t,r,n,a,o){var i=e.getPivotTableManager();if(!i.hasPivotTable())return!1;var u,s=new ou(t,r,n,a,e),l=yr(i.getPivotInfoMap());try{for(l.s();!(u=l.n()).done;){var c=(0,g.Z)(u.value,2),h=c[0],f=c[1];if(!(null!=o&&o.includes(h)||f.isHidden)){var d=f.contentRange,v=f.pageRange,p=f.row,m=f.col;if(s.containCell(p,m))return!0;if(null!=d&&d.isIntersect(s))return!0;if(null!=v&&v.isIntersect(s))return!0}}}catch(e){l.e(e)}finally{l.f()}return!1}function wT(e,t,r,n,a,o){var i=e.getPivotTableManager();if(!i.hasPivotTable())return!1;var u,s=new ou(t,r,n,a,e),l=yr(i.getPivotInfoMap());try{for(l.s();!(u=l.n()).done;){var c=(0,g.Z)(u.value,2),h=c[0],f=c[1];if(!o.includes(h)){var d=f.contentRange,v=f.pageRange,p=f.row,m=f.col;if(s.containCell(p,m))return!0;if(null!=d&&d.isIntersect(s))return!0;if(null!=v&&v.isIntersect(s))return!0}}}catch(e){l.e(e)}finally{l.f()}return!1}function ET(e,t,r,n,a,o){var i=e.getPivotTableManager();if(!i.hasPivotTable())return!1;var u,s=new ou(t,r,n,a,e),l=yr(i.getPivotInfoMap());try{for(l.s();!(u=l.n()).done;){var c=(0,g.Z)(u.value,2),h=c[0],f=c[1];if(h!==o){var d=f.contentRange,v=f.pageRange;if((!d||s.contain(d))&&(!v||s.contain(v)))return!0}}}catch(e){l.e(e)}finally{l.f()}return!1}function kT(e,t,r,n,a,o){var i=e.getPivotTableManager();if(!i.hasPivotTable())return[];var u,s=[],l=new ou(t,r,n,a,e),c=yr(i.getPivotInfoMap());try{for(c.s();!(u=c.n()).done;){var h=(0,g.Z)(u.value,2),f=h[0],d=h[1],v=d.pageRange,p=d.contentRange,m=d.row,y=d.col;f!==o&&(l.containCell(m,y)||(null==v?void 0:v.isIntersect(l))||(null==p?void 0:p.isIntersect(l)))&&s.push(f)}}catch(e){c.e(e)}finally{c.f()}return s}function TT(e,t){var r,n=e.getPivotTableManager().getPivotInfoByName(t);if(n){var a=n.pageRange,o=n.contentRange;a&&o?r=a.clone().union(o):a?r=a.clone():o&&(r=o.clone())}return r}function ST(e,t){var r=e.getPivotTableManager();if(!r.hasPivotTable())return[];var n,a=[],o=yr(r.getPivotInfoMap());try{for(o.s();!(n=o.n()).done;){var i=(0,g.Z)(n.value,1)[0],u=TT(e,i);u&&t.contain(u)&&a.push(i)}}catch(e){o.e(e)}finally{o.f()}return a}function AT(e,t){var r=e.getPivotTableManager();if(r.hasPivotTable()){var n,a=function(e,t){return e.isIntersect(t)&&!e.contain(t)},o=yr(r.getPivotInfoMap());try{for(o.s();!(n=o.n()).done;){var i=(0,g.Z)(n.value,2)[1],u=i.pageRange,s=i.contentRange;if(u&&s){if(a(t,u.union(s)))return!0}else{if(u&&a(t,u))return!0;if(s&&a(t,s))return!0}}}catch(e){o.e(e)}finally{o.f()}return!1}}function IT(e,t,r,n,a){return a?new ou(n?t+n.rowCount+1:t,r,a.rowCount,a.colCount,e):new ou(t+2,r,10,5,e)}function OT(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e,r){for(var n=e instanceof eu?e.rowFrom():e.startRow,a=e instanceof eu?e.colFrom():e.startCol,o=e instanceof eu?n+e.rowCount():e.endRow,i=e instanceof eu?a+e.colCount():e.endCol,u=n;u<o;u++)for(var s=a;s<i;s++)t&&t(u,s,r)}))}var VT=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9;(0,y.Z)(this,e),this.size=0,this.maxSize=Math.max(4,t),this.minSize=Math.max(2,Math.ceil(.4*this.maxSize)),this.clear()}return(0,_.Z)(e,[{key:"all",value:function(){var e=[];return $T(this.root,e),e}},{key:"isEmpty",value:function(){return 0===this.root.children.length}},{key:"search",value:function(e,t){var r=this.root;if(void 0===t&&(t=[]),!Yo(e,r.ref))return t;for(var n=[];r;){for(var a=0;a<r.children.length;a++){var o=r.children[a];Yo(e,o.ref)&&(r.leaf?t.push(o):zo(e,o.ref)?$T(o,t):n.push(o))}r=n.pop()}return t}},{key:"insert",value:function(e){return this.add(e,this.root.height-1),this.size++,this}},{key:"insertItems",value:function(e){if(this.size+=e.length,e.length<this.minSize){for(var t=0,r=e.length;t<r;t++)this.add(e[t],this.root.height-1);return this}var n=UT(e.slice(),0,e.length-1,0,this.maxSize);if(this.root.children.length)if(this.root.height===n.height)this.root=BT(this.root,n);else{if(this.root.height<n.height){var a=this.root;this.root=n,n=a}this.add(n,this.root.height-n.height-1)}else this.root=n;return this}},{key:"remove",value:function(e){var t,r=this.root,n=[],a=[],o=0,i=!1;for(this.size--;r||n.length;){if(r||(r=n.pop(),t=n[n.length-1],o=a.pop(),i=!0),r.leaf){var u=r.children.indexOf(e);if(-1!==u)return r.children.splice(u,1),n.push(r),this.condense(n),this}i||r.leaf||!zo(r.ref,e.ref)?t?(o++,r=t.children[o],i=!1):r=void 0:(n.push(r),a.push(o),o=0,t=r,r=r.children[0])}return this}},{key:"removeItems",value:function(e){for(var t=0,r=e.length;t<r;t++)this.remove(e[t]);return this}},{key:"update",value:function(){return zT(this.root),this}},{key:"getSize",value:function(){return this.size}},{key:"clear",value:function(){return this.root=PT([]),this.size=0,this}},{key:"add",value:function(e,t){var r=[],n=function(e,t,r,n){for(;n.push(t),!t.leaf&&n.length-1!==r;){for(var a=void 0,o=1/0,i=1/0,u=0;u<t.children.length;u++){var s=t.children[u],l=oi(s.ref),c=xT(e.ref,s.ref)-l;c<i?(i=c,o=l<o?l:o,a=s):c===i&&l<o&&(o=l,a=s)}t=a||t.children[0]}return t}(e,this.root,t,r);for(n.children.push(e),ti(n.ref,e.ref);t>=0&&r[t].children.length>this.maxSize;)this.split(r,t),t--;for(var a=t;a>=0;a--)ti(r[a].ref,e.ref)}},{key:"split",value:function(e,t){var r=e[t],n=r.children.length,a=this.minSize;!function(e,t,r){LT(e,t,r,MT)<LT(e,t,r,FT)&&e.children.sort(MT)}(r,a,n);var o=function(e,t,r){for(var n,a=1/0,o=1/0,i=t;i<=r-t;i++){var u=bT(e,0,i),s=bT(e,i,r),l=DT(u,s),c=oi(u)+oi(s);l<a?(a=l,n=i,o=c<o?c:o):l===a&&c<o&&(o=c,n=i)}return n||r-t}(r,a,n),i=PT(r.children.splice(o,r.children.length-o));i.height=r.height,i.leaf=r.leaf,NT(r),NT(i),t?e[t-1].children.push(i):this.root=BT(r,i)}},{key:"condense",value:function(e){for(var t,r=e.length-1;r>=0;r--)0===e[r].children.length?r>0?(t=e[r-1]).children.splice(t.children.indexOf(e[r]),1):this.clear():NT(e[r])}}]),e}();function NT(e){bT(e,0,e.children.length,e.ref)}function bT(e,t,r,n){n||(n={startRow:1/0,endRow:-1/0,startCol:1/0,endCol:-1/0});for(var a=t;a<r;a++)ti(n,e.children[a].ref);return n}function MT(e,t){return e.ref.startCol-t.ref.startCol}function FT(e,t){return e.ref.startRow-t.ref.startRow}function ZT(e){return e.endCol-e.startCol+(e.endRow-e.startRow)}function xT(e,t){return(Math.max(t.endCol,e.endCol)-Math.min(t.startCol,e.startCol))*(Math.max(t.endRow,e.endRow)-Math.min(t.startRow,e.startRow))}function DT(e,t){var r=Math.max(e.startCol,t.startCol),n=Math.max(e.startRow,t.startRow),a=Math.min(e.endCol,t.endCol),o=Math.min(e.endRow,t.endRow);return Math.max(0,a-r)*Math.max(0,o-n)}function PT(e){return{children:e,height:1,leaf:!0,ref:{startRow:1/0,endRow:-1/0,startCol:1/0,endCol:-1/0}}}function $T(e,t){if(e.leaf)for(var r=0,n=e.children.length;r<n;r++)t.push(e.children[r]);else for(var a=0,o=e.children.length;a<o;a++)$T(e.children[a],t)}function LT(e,t,r,n){e.children.sort(n);for(var a=bT(e,0,t),o=bT(e,r-t,r),i=ZT(a)+ZT(o),u=t;u<r-t;u++)ti(a,e.children[u].ref),i+=ZT(a);for(var s=r-t-1;s>=t;s--)ti(o,e.children[s].ref),i+=ZT(o);return i}function BT(e,t){var r=PT([e,t]);return r.height=e.height+1,r.leaf=!1,NT(r),r}function UT(e,t,r,n,a){var o,i=r-t+1;if(i<=a)return NT(o=PT(e.slice(t,r+1))),o;var u=a;0===n&&(n=Math.ceil(Math.log(i)/Math.log(u)),u=Math.ceil(i/Math.pow(u,n-1))),(o=PT([])).leaf=!1,o.height=n;var s=Math.ceil(i/u),l=s*Math.ceil(Math.sqrt(u));HT(e,t,r,l,MT);for(var c=t;c<=r;c+=l){var h=Math.min(c+l-1,r);HT(e,c,h,s,FT);for(var f=c;f<=h;f+=s){var d=Math.min(f+s-1,h);o.children.push(UT(e,f,d,n-1,a))}}return NT(o),o}function HT(e,t,r,n,a){for(var o=[t,r];o.length;)if(!((r=o.pop())-(t=o.pop())<=n)){var i=t+Math.ceil((r-t)/n/2)*n;(0,Ot.Z)(e,i,t,r,a),o.push(t,i,i,r)}}function zT(e){if(e.leaf)NT(e);else{for(var t=0,r=e.children.length;t<r;t++)zT(e.children[t]);NT(e)}}var WT=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return"rgba(".concat(e.r,", ").concat(e.g,", ").concat(e.b,", ").concat(t,")")},GT=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Nt()(e).toRgb()};function jT(e,t,r){if(r){if(0===t)return r[0];var n=GT(r[t-1]),a=GT(r[t]),o=function(e){return void 0===e?1:e};if(n&&a){var i=Math.round(n.r+(a.r-n.r)*e),u=Math.round(n.g+(a.g-n.g)*e),s=Math.round(n.b+(a.b-n.b)*e),l=Math.round(o(n.a)+(o(a.a)-o(n.a))*e);return WT({r:i,g:u,b:s},l)}}return!1}function YT(e){return e&&(e.backColor||e.foreColor||void 0!==e.textDecoration||e.font)}function qT(e){return e&&void 0!==e.iconType&&void 0!==e.iconLevel}function JT(e){return e&&void 0!==e.percent&&void 0!==e.originPoint}Symbol("CONDITIONAL_FORMAT_FORMULA");var KT,XT={r:247,g:105,b:100,a:1};!function(e){e.None="none"}(KT||(KT={}));var QT,eS,tS=KT.None,rS={duplicateValues:!0,cellIs:!0,containsBlanks:!0,containsText:!0,notContainsBlanks:!0,timePeriod:!0,uniqueValues:!0,dataBar:!0,colorScale:!0,rank:!0,aboveAverage:!0,expression:!0,iconSet:!0};function nS(e){switch(e.type){case QT.DataBar:return"dataBar";case QT.ValueGroup:return function(e){if(QT.ValueGroup!==e.type)return null;switch(e.ruleType){case Ce.yC8.IsTop:case Ce.yC8.IsBottom:return"rank";case Ce.yC8.AboveAverage:case Ce.yC8.BelowAverage:return"aboveAverage";default:return null}}(e);case QT.ColorScales:return"colorScale";case QT.Formula:return"expression";case QT.IconGroup:return"iconSet";case Ce.CPf.Number:return"cellIs";case Ce.CPf.Date:return"timePeriod";case Ce.CPf.Content:return function(e){if(Ce.CPf.Content!==e.type)return null;switch(e.operator){case Ce.MO8.IsDuplicate:return"duplicateValues";case Ce.MO8.EndsWith:case Ce.MO8.StartsWith:case Ce.MO8.Contains:case Ce.MO8.DoesNotContain:case Ce.MO8.Is:return"containsText";case Ce.MO8.IsEmpty:return"containsBlanks";case Ce.MO8.IsNotEmpty:return"notContainsBlanks";case Ce.MO8.IsUnique:return"uniqueValues";default:return null}}(e);default:return null}}function aS(e,t){return t.map((function(t){var r=(0,Ee.inferPreferredFormatter)(e.formatterService,t).value;return r instanceof we.SheetDate?"".concat(r.toNumber()):(0,ve.default)(r)?"".concat(r):'"'.concat((0,Ce.dNX)(t),'"')}))}function oS(e,t){try{var r=t.condition,n=t.format;switch(r.type){case Ce.CPf.Date:case Ce.CPf.Number:case Ce.CPf.Content:case QT.DataBar:case QT.ColorScales:case QT.ValueGroup:case QT.Formula:case QT.IconGroup:var a=nS(r),o=function(e){var t=e.bold,r=void 0!==t&&t,n=e.backColor,a=e.foreColor,o=e.italic,i=void 0!==o&&o,u=e.lineThrough,s=void 0!==u&&u,l=e.underLine,c=void 0!==l&&l,h={};n&&"transparent"!==n&&(h.backColor=n),a&&"transparent"!==a&&(h.foreColor=a);var f=function(e,t){var r=[];return e&&r.push("bold"),t&&r.push("italic"),r.length>0&&r.join(" ")}(r,i);f&&(h.font=f);var d=function(e,t){return e||t?(e?2:0)|(t?1:0):0}(s,c);return d&&(h.textDecoration=d),h}(n),i=function(e,t,r,n){switch(r.type){case QT.DataBar:var a=r.minType,o=r.minValue,i=r.maxValue,u=r.maxType,s=r.hideValue,l=n.negativeColor,c=n.positiveColor,h=n.isGradient;return[{hideValue:s,gradient:h,color:l,value:o,valueType:a},{hideValue:s,gradient:h,color:c,value:i,valueType:u}];case QT.ColorScales:var f,d=r.minValue,v=r.midValue,p=r.maxValue,m=n.valueFormats;return tS===v.valueType?[{valueType:d.valueType,value:d.value,color:m[0].backColor},{valueType:p.valueType,value:p.value,color:m[1].backColor}]:[{valueType:d.valueType,value:d.value,color:m[0].backColor},{valueType:v.valueType,value:v.value,color:m[1].backColor},{valueType:p.valueType,value:p.value,color:null===(f=m[2])||void 0===f?void 0:f.backColor}];case QT.ValueGroup:var g=r.ruleType,y=r.value,_=r.valueType;return[Ce.yC8.IsTop,Ce.yC8.IsBottom].includes(g)?[{isBottom:Ce.yC8.IsBottom===g,valueType:_,value:y}]:[{operator:Ce.qO2[g]}];case QT.Formula:return[{formula:[r.formula]}];case QT.IconGroup:var R=r.iconRules,C=n.iconType,w=n.hideValue,E=n.reverseIcons;return R.map((function(e){var t=e.valueType,r=e.value,n=e.operator;return{iconType:C,hideValue:w,valueType:t,operator:n,value:r,reverseIcons:E}}));case Ce.CPf.Number:case Ce.CPf.Content:case Ce.CPf.Date:var k=r.operator,T=r.values,S=Ce.hWC[r.type][k];switch(t){case"cellIs":return[{operator:S,formula:aS(e,T),plaintext:T}];case"containsText":return[{operator:S,text:T[0]}];case"timePeriod":return[{operator:S,timePeriod:Ce.hrX[k]}]}}return[]}(e,a,r,n);return!!a&&{ruleType:a,attrs:i,format:o};default:return!1}}catch(e){return console.error(e),Ce.Ps3.collectSuiteEvent("client_sheet_conditional_format_exception",{stage:"setting_to_rule",type:"p0",setting_type:(0,oe.default)(t,"condition.type",""),error_name:e&&e.name,error_msg:e&&e.message,error_stack:e&&e.stack}),!1}}function iS(e){var t=(0,Ce.zsn)(Ce.w8i);return uS(e,t)?iS(e):t}function uS(e,t){return e.conditionalFormatModel.getRuleById(t)}!function(e){e.Cell="Cell",e.ValueGroup="ValueGroup",e.Formula="Formula",e.ColorScales="ColorScales",e.DataBar="DataBar",e.IconGroup="IconGroup"}(QT||(QT={})),function(e){e.HIGHLIGHT_CELL="highlight_cell",e.FIRST_LAST_RULE="first_last_rule",e.CUSTOM_FORMULA="custom_formula",e.COLOR_SCALE="color_scale",e.DATA_BAR="data_bar",e.ICON_SET="icon_set"}(eS||(eS={}));var sS=function(e){var t,r={highlight_cell:["duplicateValues","uniqueValues","cellIs","containsText","timePeriod","containsBlanks","notContainsBlanks"],first_last_rule:["rank","aboveAverage"],custom_formula:["expression"],color_scale:["colorScale"],data_bar:["dataBar"],icon_set:["iconSet"]};return Object.keys(r).some((function(n){return r[n].some((function(r){return e===r&&(t=n),!!t})),!!t})),t};function lS(e,t){e.forEach((function(e){Ce.Ps3.ccmEventTracking&&Ce.Ps3.ccmEventTracking("ccm_sheet_content_page_click",{click:"edit_condition_format_range",target:"none",format_type:sS(e.rule.ruleType),edit_method:t})}))}var cS=function(e,t){Ce.Ps3.ccmEventTracking("ccm_sheet_content_page_click",Object.assign({},(0,Ce.dK5)(),{click:"clear_condition_format",target:"none",action_type:e,sub_click:t}))},hS=function(e,t){return!!e&&!(0===e.conditionalFormatModel.getRulesByRange(t).length)},fS=function(e){if(!e)return!1;var t=e.getSelections();return hS(e,t)},dS=function(e){if(!e)return!1;var t=e.getSelections().map((function(t){return new ou(t.rowFrom(),0,t.rowCount(),e.getColumnCount()-1,e)}));return hS(e,t)},vS=function(e){if(!e)return!1;var t=e.getSelections().map((function(t){return new ou(0,t.colFrom(),e.getRowCount()-1,t.colCount(),e)}));return hS(e,t)};var pS=["containsText","containsBlanks","notContainsBlanks","timePeriod","cellIs"],mS=["expression"],gS=function(){function e(t){(0,y.Z)(this,e),this.initialized=!1,this.style={},this.attrs=[],this.rangeRTree=new VT,this.watchFormulaRefMap=!1,this.formulaVar=null,this.cellToFormulaResult=new qd,this.disposeFns=[],this.errorReported=!1;var r=t.sheet,n=t.ranges,a=t.cfId,o=t.style,i=t.attrs,u=t.hasRef;this.sheet=r,this.cfId=a,this.style=o,this.attrs=i||[],this.hasRef=u,this.setRanges(n)}return(0,_.Z)(e,[{key:"isInit",value:function(){return this.initialized}},{key:"init",value:function(){this.initialized=!0;var e=this.sheet.getCalcEngine().conditionRefManager,t=this.ranges.length;this.ranges=this.ranges.filter((function(e){return e.isValid()})),t!==this.ranges.length&&(this.formulaVar=null);var r=this.ranges.map((function(e){return e.clone()}));this.nodes=e.addRuleRanges(this,r)}},{key:"initFormula",value:function(){}},{key:"subBaseRanges",value:function(e){return function(e,t){var r=[],n=new VT;n.insertItems(t.map((function(e){return{ref:e}})));var a,o=yr(e);try{for(o.s();!(a=o.n()).done;){var i=a.value,u=new VT,s=[{ref:i}];u.insert(s[0]);var l,c=yr(n.search(i));try{for(c.s();!(l=c.n()).done;){var h=l.value;do{u.removeItems(s);var f,d=[],v=yr(s);try{for(v.s();!(f=v.n()).done;){var p=f.value.ref;d.push.apply(d,(0,m.Z)(p.sub(h.ref)))}}catch(e){v.e(e)}finally{v.f()}u.insertItems(d.map((function(e){return{ref:e}}))),s=u.search(h.ref)}while(s.length)}}catch(e){c.e(e)}finally{c.f()}r.push.apply(r,(0,m.Z)(u.all().map((function(e){return e.ref}))))}}catch(e){o.e(e)}finally{o.f()}return r}(this.getRanges(),e)}}]),(0,_.Z)(e,[{key:"getSheetId",value:function(){return this.sheet.id()}},{key:"logCalcError",value:function(){this.errorReported||(function(e,t){console.log(t),Ce.Ps3.moirae.ravenCatch("".concat(e,"_ERROR"),{tags:{key:t}})}(this.ruleType),this.errorReported=!0)}},{key:"getFormatStyle",value:function(e,t){return this.isMatch(e,t)?this.style:null}},{key:"destroy",value:function(){this.clearRef(),this.clear(),this.disposeFns.forEach((function(e){return e()})),this.disposeFns=[]}},{key:"clearRef",value:function(){this.nodes&&(this.sheet.getCalcEngine().conditionRefManager.removeRuleRanges(this,this.nodes),this.nodes=void 0)}},{key:"toJSON",value:function(){var e=this.style,t=this.cfId,r=this.attrs,n=this.hasRef,a={cfId:t,ruleType:this.ruleType,ranges:this.getRanges().map((function(e){return gu(e,!0)})),style:(0,Re.default)(e),hasRef:n,attrs:r.length?(0,Re.default)(r):void 0};return Object.keys(a).forEach((function(e){return void 0===a[e]&&delete a[e]})),a}},{key:"getFormulaVar",value:function(){if(!this.formulaVar){var e=this.genFormulaVarInstance();e&&this.setFormulaVar(e)}return this.formulaVar}},{key:"getRanges",value:function(){return this.ranges}},{key:"getValue",value:function(e,t){var r;return null!==(r=this.cellToFormulaResult.get(e,t))&&void 0!==r?r:null}},{key:"isMatch",value:function(e,t){if(function(e){return!!e&&!(!e.isError()||e.errorCode!==it.ErrorCode.SUSPENDED)}(this.formulaVar))return this.logCalcError(),!1;var r=this.getValue(e,t);return this.isValueMatch(r)}},{key:"calcWithCellByCell",value:function(e,t){var r=this,n=this.sheet,a=new uu(-1,-1,n);e.skipRuntimeError=!0,e.visited.clear(),OT(t,(function(t,n){if(!r.cellToFormulaResult.has(t,n)){a.setRowFrom(t),a.setColFrom(n);var o=r.getFormulaVar();if(o){r.setCalcRange(a),o.resetState();try{ov(o,e);var i=o.getVar(),u=o.getValue();!ja(i)&&r.isValueMatch(u)?r.cellToFormulaResult.set(t,n,u):r.cellToFormulaResult.set(t,n,null)}catch(e){Ce.Ps3.collectSuiteEvent("client_sheet_conditional_format_exception",{stage:"get_format_style",type:"p0",rule_type:r.ruleType,error_name:e&&e.name,error_msg:e&&e.message,error_stack:e&&e.stack})}}}}))}},{key:"toPrimitiveMatrixVar",value:function(e){return Ja(e)||Wa(e)||Ga(e)?e:null}},{key:"calcWithArrayFormula",value:function(e,t){var r=this,n=this.getFormulaVar();n&&n.isArrayFormula()&&(e.skipRuntimeError=!0,e.visited.clear(),t.forEach((function(t){try{n.resetState(),r.setCalcRange(t),ov(n,e);var a=n.getRawVar(),o=r.toPrimitiveMatrixVar(a);OT(t,(function(e,n){if(!r.cellToFormulaResult.has(e,n))if(ja(a))r.cellToFormulaResult.set(e,n,null);else if(o){var i=function(e,t,r){return{newRow:e-r.rowFrom(),newClo:t-r.colFrom()}}(e,n,t),u=i.newRow,s=i.newClo,l=o.at(u,s),c=l.getValue();!ja(l)&&r.isValueMatch(c)?r.cellToFormulaResult.set(e,n,c):r.cellToFormulaResult.set(e,n,null)}}))}catch(e){Ce.Ps3.collectSuiteEvent("client_sheet_conditional_format_exception",{stage:"get_format_style",type:"p0",rule_type:r.ruleType,error_name:e&&e.name})}})))}},{key:"getCalcRange",value:function(e){var t=this.getRanges();return e?t.map((function(t){return t.intersect(e)})).filter(Boolean):t}},{key:"calc",value:function(e,t){var r,n=this,a=this.sheet.getParent(),o=null!==(r=e)&&void 0!==r?r:av(a,a.calcEngine.formulaService),i=this.getCalcRange(t);if(pS.includes(this.ruleType))return this.calcWithArrayFormula(o,i);if(mS.includes(this.ruleType))return this.calcWithCellByCell(o,i);var u=this.getFormulaVar();u&&(o.skipRuntimeError=!0,o.visited.clear(),i.forEach((function(e){try{u.resetState(),n.setCalcRange(e),ov(u,o);var t=u.getVar(),r=u.getValue();OT(e,(function(e,a){if(!n.cellToFormulaResult.has(e,a))if(ja(t))n.cellToFormulaResult.set(e,a,null);else{var o=r.get(e,a);n.isValueMatch(o)?n.cellToFormulaResult.set(e,a,o):n.cellToFormulaResult.set(e,a,null)}}))}catch(e){Ce.Ps3.collectSuiteEvent("client_sheet_conditional_format_exception",{stage:"get_format_style",type:"p0",rule_type:n.ruleType,error_name:e&&e.name})}})))}},{key:"isIntersect",value:function(e){var t=this;return(Array.isArray(e)?e:[e]).some((function(e){return t.rangeRTree.search(e).length>0}))}},{key:"setRanges",value:function(e){var t=this.sheet;this.ranges=e.map((function(e){if(e instanceof eu)return e;switch(e.type){case Ce.xj7.ROW:return new iu(e.row,e.rowCount,t);case Ce.xj7.COL:return new nu(e.col,e.colCount,t);case Ce.xj7.ALL:return new au(t);case Ce.xj7.CELL:return new uu(e.row,e.col,t);case Ce.xj7.NORMAL:default:return new ou(e.row,e.col,e.rowCount,e.colCount,t)}})).filter((function(e){return e.isValid()})),this.resetRtree()}},{key:"getAttr",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.attrs&&this.attrs[e]||{}}},{key:"watchRanges",value:function(e,t){var r=this,n=this.getRanges(),a=this.sheet.getCalcEngine();this.disposeFns.push(a.conditionDependencyRefManager.watchRefs(n,(function(e,t,r){}),void 0,(function(n,a){r.handleOnOpRange(a),r.resetRtree(),null==t||t(n,a);var o=r.getCalcRange(n);r.ranges===o&&(o=o.map((function(e){return e.clone()}))),"MoveRangeOP"!==a.instanceType||n.hostId===r.sheet.id()?(r.clearRef(),e(o),r.initialized=!1):e(o)})))}},{key:"watchFormulaVar",value:function(e,t){var r=this,n=this.sheet.getCalcEngine(),a=this.getFormulaVar();if(a){var o=a.getRefMap();if(o){var i=new Map,u=a.getRef();for(var s in o){var l=ku(o[s],u);i.set(l,s)}this.disposeFns.push(n.conditionDependencyRefManager.watchRefs(Array.from(i.keys()),(function(e,t,r){}),void 0,(function(e,n){r.resetRtree(),r.handleOnOpRange(n);var o=i.get(e);if(o){var s=a.getRefMap(),l={};for(var c in s)l[c]=o!==c?s[c]:Tu(e,u);a.setRefMap(l),null==t||t(e,n)}})))}}}},{key:"watch",value:function(e,t){this.watchFormulaRefMap&&this.watchFormulaVar(e,t),this.watchRanges(e,t)}},{key:"clear",value:function(){var e;this.cellToFormulaResult.clear(),null===(e=this.formulaVar)||void 0===e||e.resetState()}},{key:"resetRtree",value:function(){this.rangeRTree.clear(),this.rangeRTree.insertItems(this.ranges.map((function(e){return{ref:e}})))}},{key:"setFormulaVar",value:function(e){e.isArrayFormula()&&(e.ignoreExpand=!0),this.formulaVar=e}},{key:"genFormulaVarInstanceByString",value:function(e){var t,r=this.sheet,n={ref:this.getRef(),spread:r.parent,enableCalculation:!r.options.canUseWorker},a=r.getCalcEngine().compile(e,n);return a.formulaVar&&a.formulaVar.isFormula()&&(t=a.formulaVar),t}},{key:"genFormulaVarInstanceByFormulaData",value:function(e){var t=this.sheet.getCalcEngine(),r=this.getRef();return t.deserializeFormula(e,r,{enableCalculation:!0,useCache:!1})}},{key:"genFormulaVarInstance",value:function(){var e=this.getFormulaDataOrString();return"string"==typeof e?this.genFormulaVarInstanceByString(e):this.genFormulaVarInstanceByFormulaData(e)}},{key:"getRef",value:function(){return new ou(-1,-1,1,1,this.sheet)}},{key:"getRangeStrings",value:function(){return this.ranges.map((function(e){return bv([e])}))}},{key:"isValueMatch",value:function(e){return null!==e&&!1!==e&&void 0!==e}},{key:"getCellRefIDs",value:function(){var e;return Object.keys((null===(e=this.getFormulaVar())||void 0===e?void 0:e.getRefMap())||{R1:0})}},{key:"setCalcRange",value:function(e){var t=this.getFormulaVar();if(t){var r=t.getRef(),n=t.getRefMap()||{},a=Tu(e,r),o=Object.assign({},n);this.getCellRefIDs().forEach((function(e){o[e]=a})),t.setRefMap(o)}}},{key:"handleOnOpRange",value:function(e){this.sheet.dispatch("ConditionalFormatChanged",{type:"RangeChange",rangeOp:e,affectedRanges:e.effectedRef()})}}]),e}(),yS=(Fe={},(0,l.Z)(Fe,Ce.B2l.AttrValueType.AttrValueType_MIN_VALUE,"minValue"),(0,l.Z)(Fe,Ce.B2l.AttrValueType.AttrValueType_MAX_VALUE,"maxValue"),(0,l.Z)(Fe,Ce.B2l.AttrValueType.AttrValueType_NUM,"num"),(0,l.Z)(Fe,Ce.B2l.AttrValueType.AttrValueType_PERCENTILE,"percentile"),(0,l.Z)(Fe,Ce.B2l.AttrValueType.AttrValueType_PERCENT,"percent"),(0,l.Z)(Fe,Ce.B2l.AttrValueType.AttrValueType_FORMULA,"formula"),(0,l.Z)(Fe,Ce.B2l.AttrValueType.AttrValueType_AUTO,"auto"),Fe),_S={minValue:Ce.B2l.AttrValueType.AttrValueType_MIN_VALUE,maxValue:Ce.B2l.AttrValueType.AttrValueType_MAX_VALUE,num:Ce.B2l.AttrValueType.AttrValueType_NUM,percentile:Ce.B2l.AttrValueType.AttrValueType_PERCENTILE,percent:Ce.B2l.AttrValueType.AttrValueType_PERCENT,formula:Ce.B2l.AttrValueType.AttrValueType_FORMULA,auto:Ce.B2l.AttrValueType.AttrValueType_AUTO},RS={"3Arrows":Ce.B2l.IconGroupType.IconGroupType_ARROWS_3,"3ArrowsGray":Ce.B2l.IconGroupType.IconGroupType_ARROWS_GRAY_3,"3Triangles":Ce.B2l.IconGroupType.IconGroupType_TRIANGLES_3,"4ArrowsGray":Ce.B2l.IconGroupType.IconGroupType_ARROWS_GRAY_4,"4Arrows":Ce.B2l.IconGroupType.IconGroupType_ARROWS_4,"5ArrowsGray":Ce.B2l.IconGroupType.IconGroupType_ARROWS_GRAY_5,"5Arrows":Ce.B2l.IconGroupType.IconGroupType_ARROWS_5,"3Circles":Ce.B2l.IconGroupType.IconGroupType_CIRCLES_3,"3MultiGraphics":Ce.B2l.IconGroupType.IconGroupType_MULTI_GRAPHICS_3,"4Circles":Ce.B2l.IconGroupType.IconGroupType_CIRCLES_4,"5Circles":Ce.B2l.IconGroupType.IconGroupType_CIRCLES_5,"2Status":Ce.B2l.IconGroupType.IconGroupType_STATUS_2,"3Status":Ce.B2l.IconGroupType.IconGroupType_STATUS_3,"2CommentStatus":Ce.B2l.IconGroupType.IconGroupType_COMMENT_STATUS_2,"3Flags":Ce.B2l.IconGroupType.IconGroupType_FLAGS_3,"3Stars":Ce.B2l.IconGroupType.IconGroupType_STARS_3,"3HeartShaped":Ce.B2l.IconGroupType.IconGroupType_HEART_SHAPED_3,"3Mood":Ce.B2l.IconGroupType.IconGroupType_MOOD_3,"5CirclesRatio":Ce.B2l.IconGroupType.IconGroupType_CIRCLES_RATIO_5},CS=(Ze={},(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_ARROWS_3,"3Arrows"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_ARROWS_GRAY_3,"3ArrowsGray"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_TRIANGLES_3,"3Triangles"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_ARROWS_GRAY_4,"4ArrowsGray"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_ARROWS_4,"4Arrows"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_ARROWS_GRAY_5,"5ArrowsGray"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_ARROWS_5,"5Arrows"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_CIRCLES_3,"3Circles"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_MULTI_GRAPHICS_3,"3MultiGraphics"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_CIRCLES_4,"4Circles"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_CIRCLES_5,"5Circles"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_STATUS_2,"2Status"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_STATUS_3,"3Status"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_COMMENT_STATUS_2,"2CommentStatus"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_FLAGS_3,"3Flags"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_STARS_3,"3Stars"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_HEART_SHAPED_3,"3HeartShaped"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_MOOD_3,"3Mood"),(0,l.Z)(Ze,Ce.B2l.IconGroupType.IconGroupType_CIRCLES_RATIO_5,"5CirclesRatio"),Ze),wS={greaterThan:Ce.B2l.IconsRuleOperatorType.IconsRuleOperatorType_GREATER,greaterThanOrEqual:Ce.B2l.IconsRuleOperatorType.IconsRuleOperatorType_GREATER_OR_EQUAL,lessThan:Ce.B2l.IconsRuleOperatorType.IconsRuleOperatorType_LESS,lessThanOrEqual:Ce.B2l.IconsRuleOperatorType.IconsRuleOperatorType_LESS_OR_EQUAL},ES=(xe={},(0,l.Z)(xe,Ce.B2l.IconsRuleOperatorType.IconsRuleOperatorType_GREATER,"greaterThan"),(0,l.Z)(xe,Ce.B2l.IconsRuleOperatorType.IconsRuleOperatorType_GREATER_OR_EQUAL,"greaterThanOrEqual"),(0,l.Z)(xe,Ce.B2l.IconsRuleOperatorType.IconsRuleOperatorType_LESS,"lessThan"),(0,l.Z)(xe,Ce.B2l.IconsRuleOperatorType.IconsRuleOperatorType_LESS_OR_EQUAL,"lessThanOrEqual"),xe),kS=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="iconSet",e.watchFormulaRefMap=!0,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serialize",value:function(){return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_ICON_SET,iconSet:this.attrs.map((function(e){return{iconType:RS[e.iconType],hideValue:e.hideValue,valueType:_S[e.valueType],operator:wS[e.operator],value:""===e.value||null===e.value||void 0===e.value||isNaN(e.value)?void 0:Number(e.value),reverseIcons:e.reverseIcons}}))}}},{key:"getCalcRange",value:function(e){return this.attrs.every((function(e){return"num"===e.valueType}))?(0,f.Z)((0,v.Z)(t.prototype),"getCalcRange",this).call(this,e):this.getRanges()}},{key:"getCellRefIDs",value:function(){return["R1"]}},{key:"isValueMatch",value:function(e){return(0,ve.default)(e)&&e>=0}},{key:"getFormulaDataOrString",value:function(){var e=this.attrs;if(!Array.isArray(e))return"";var t=this.getRanges(),r=t.length,n={R1:{type:0,col:0,row:0,rowCount:1,colCount:1}},a=[];e.forEach((function(e){var t=e.operator,r=e.value,n=e.valueType;a.push("S".concat(t),"D".concat(r||0),"S".concat(n))}));for(var o=["R1","D".concat(e.length)].concat(a),i=0;i<r;i++){var u="R".concat(i+2);n[u]=gu(t[i]),o.push(u)}return o.push("F:PRIVATE_CONDITION_ICONS:".concat(2+a.length+r)),{v:1,refs:n,tree:o,tokens:[]}}},{key:"isValid",value:function(e,t){return!(!this.sheet.hasCheckbox(e,t)&&!this.sheet.getReminder(e,t))}},{key:"getFormatStyle",value:function(e,t){if(!this.isMatch(e,t)||this.isValid(e,t))return null;var r=this.attrs;if(!Array.isArray(r)||r.length<=0)return null;var n=r[0].iconType,a=r[0].reverseIcons||!1,o=this.getValue(e,t);return(0,ve.default)(o)?function(e,t,r){if(r){var n=t-1-e.iconLevel;return Object.assign({},e,{iconLevel:n})}return e}({iconType:n,iconLevel:o},r.length+1,a):null}}]),t}(gS);function TS(e,t,r){t.getAllRules().forEach((function(t,n){var a=null!=r&&r.useNewConditionFormat?(0,Ce.zsn)(Ce.w8i):t.cfId,o=t.getRanges().map((function(e){return e.toGridJSON(!1)}));e.push({type:Ce.B2l.MutationType.MutationType_AddConditionalFormatting,addConditionalFormatting:{value:{id:a,ranges:o,style:SS(t.style),rule:t.serialize()},index:n}})}))}function SS(e){if(e){var t,r,n,a;if(e.font){var o=e.font.split(" ");o.includes("bold")&&(t=!0),o.includes("italic")&&(r=!0)}2!==e.textDecoration&&3!==e.textDecoration||(n=!0),1!==e.textDecoration&&3!==e.textDecoration||(a=!0),e.bold&&(t=!0),e.italic&&(r=!0),(e.strike||e.lineThrough)&&(n=!0),(e.underline||e.underLine)&&(a=!0);var i=e.backColor?{color:{rgb:e.backColor}}:void 0,u={color:e.foreColor?{rgb:e.foreColor}:void 0,strike:n,underline:a,italic:r,bold:t},s={fill:i,font:void 0!==u.bold||void 0!==u.italic||void 0!==u.strike||void 0!==u.underline||void 0!==u.color?u:void 0};return void 0!==s.fill||void 0!==s.font?s:void 0}}function AS(e){var t;if(e){var r=e.fill,n=e.font,a={};if(null!=r&&null!==(t=r.color)&&void 0!==t&&t.rgb&&(a.backColor=r.color.rgb),n){var o;null!==(o=n.color)&&void 0!==o&&o.rgb&&(a.foreColor=n.color.rgb),n.strike&&(a.textDecoration=2),n.underline&&(a.textDecoration=a.textDecoration?3:1);var i=[];n.bold&&i.push("bold"),n.italic&&i.push("italic"),a.font=i.length?i.join(" "):void 0}return void 0!==a.backColor||void 0!==a.foreColor||void 0!==a.textDecoration||void 0!==a.font?a:void 0}}function IS(e){if(e&&void 0!==e.iconType&&void 0!==e.iconLevel)return{iconType:RS[e.iconType],iconLevel:e.iconLevel}}function OS(e){if(e)return{iconType:CS[e.iconType],iconLevel:e.iconLevel}}function VS(e){if(e&&void 0!==e.color&&void 0!==e.percent&&void 0!==e.originPoint)return{gradient:e.isGradient,color:{rgb:e.color},percent:e.percent,originPoint:e.originPoint}}function NS(e){var t,r;if(e)return{isGradient:e.gradient,color:null!==(t=null===(r=e.color)||void 0===r?void 0:r.rgb)&&void 0!==t?t:"",percent:e.percent,originPoint:e.originPoint}}var bS=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getSerializer",value:function(e,t,r,n){return new FS(this,e,t,r,n)}},{key:"getImporter",value:function(){return new MS(this)}}]),t}(Wg),MS=function(){function e(t){(0,y.Z)(this,e),this.conditionalFormatStyleModel=t}return(0,_.Z)(e,[{key:"importExtraInfo",value:function(e,t){}},{key:"importCell",value:function(e,t,r,n){}},{key:"deserializeConditionalFormatting",value:function(e,t,r){if(r){var n=r.conditionalFormatStyle,a=r.iconsStyle,o=r.dataBarStyleInfo,i=Object.assign({},AS(n),{},OS(a),{},NS(o));this.conditionalFormatStyleModel.set(e,t,i)}}}]),e}(),FS=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serializeCell",value:function(e,t,r){r.isForShortcut&&this.serializeDataValidationForShortcut(e,t,r)}},{key:"validSerializer",value:function(e){return!!e.isForShortcut&&(0,f.Z)((0,v.Z)(t.prototype),"validSerializer",this).call(this,e)}},{key:"serializeDataValidationForShortcut",value:function(e,t,r){if(t){var n={conditionalFormatStyle:SS(t),iconsStyle:IS(t),dataBarStyleInfo:VS(t)},a=r.cellValueRefHelper;e.conditionalFormattingResultId=a.conditionalFormattingResults.add(n).id}}}]),t}(G_),ZS=function(){function e(){(0,y.Z)(this,e),this.map=new Map}return(0,_.Z)(e,[{key:"add",value:function(e){var t=this.map.get(e);return t?t[1]++:(t=[new it.StringVar(e),1],this.map.set(e,t)),t[0]}},{key:"has",value:function(e){return this.map.has(e)}},{key:"del",value:function(e){var t=this.map.get(e);t&&(t[1]>1?t[1]--:this.map.delete(e))}},{key:"clear",value:function(){this.map.clear()}}]),e}();function xS(e){if(0!==e.length)return e}function DS(e,t){return e.endPos===t.endPos&&e.runType===t.runType&&e.fontId===t.fontId&&e.refId===t.refId}var PS=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).values=[],e.valuesMap=new Map,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getHash",value:function(e){return function(e){if(!e)return 149417;for(var t=Za(104579,0),r=0;r<e.length;r++){var n=e[r];t=Za((n.endPos||433)+(n.runType||863)+(n.fontId||349)+(n.refId||937),t)}return t}(e)}},{key:"equals",value:function(e,t){if((null==e?void 0:e.length)!==(null==t?void 0:t.length))return!1;if(!e||!t)return!0;for(var r=0;r<e.length;r++)if(!e[r]||!t[r]||!DS(e[r],t[r]))return!1;return!0}},{key:"addValue",value:function(e,t){var r=this.valuesMap.get(e);if(void 0===r){var n=this.values.push({textId:e,runs:t})-1;return this.valuesMap.set(e,n),n}if("number"==typeof r){var a=this.values[r],o=new Map;o.set(this.add(a.runs).id,r),this.valuesMap.set(e,o),r=o}var i=this.add(t).id,u=r.get(i);return void 0===u&&(u=this.values.push({textId:e,runs:t})-1,r.set(i,u)),u}},{key:"toArray",value:function(){return this.values}}]),t}(Iy),$S=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).valuesRefMap=new Map,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"checkValuesRefId",value:function(e,t,r){var n=void 0!==e?this.preCheckValueRefId(e):void 0;if(void 0!==n)t(n);else{var a=r();void 0!==e&&void 0!==a&&this.bindValueRefId(e,a)}}},{key:"bindValueRefId",value:function(e,t){this.valuesRefMap.set(e,t)}},{key:"preCheckValueRefId",value:function(e){return this.valuesRefMap.get(e)}}]),t}(Oy),LS=function(){function e(){(0,y.Z)(this,e),this.values=[],this.valuesMap=new Map}return(0,_.Z)(e,[{key:"addValue",value:function(e){var t=this.valuesMap.get(e);return void 0!==t||(t=this.values.push(e)-1,this.valuesMap.set(e,t)),t}},{key:"getIdByRef",value:function(e){var t=this.valuesMap.get(e);return void 0!==t?t:-1}},{key:"toArray",value:function(){return this.values}}]),e}(),BS=function(){function e(){(0,y.Z)(this,e),this.values=[],this.valuesMap=new Map}return(0,_.Z)(e,[{key:"checkValuesRefId",value:function(e,t,r){var n=this.valuesMap.get(e);n||(n=new Map,this.valuesMap.set(e,n));var a=n.get(t);return void 0!==a||(a=this.values.push(r())-1,n.set(t,a)),a}},{key:"toArray",value:function(){return this.values}}]),e}(),US=function(){function e(){(0,y.Z)(this,e),this.numbers=new LS,this.strings=new LS,this.richStrings=new PS,this.embedImages=new $S,this.dataValidations=new $S,this.mentionsDeserialize=new $S,this.mentionInfosDeserialize=new $S,this.mentionsWithStyleDeserialize=new Map,this.mentionsSerialize=new $S,this.mentionInfosSerialize=new $S,this.hyperlinks=new BS,this.attachments=new $S,this.formulas=new BS,this.formulaDatas=new $S,this.formulaRefMaps=new $S,this.errorValues=new $S,this.extendValues=new LS,this.notes=new $S,this.reminderIds=new LS,this.selectedMultipleValues=new $S,this.colors=new LS,this.conditionalFormattingResults=new $S,this.formulaSpecialInfoStrings=new LS}return(0,_.Z)(e,[{key:"getMentionWithStyleRefManager",value:function(e){var t=this.mentionsWithStyleDeserialize.get(e);return t||(t=new $S,this.mentionsWithStyleDeserialize.set(e,t)),t}},{key:"getAllValueRefs",value:function(){return{numbers:xS(this.numbers.toArray()),strings:xS(this.strings.toArray()),richStrings:xS(this.richStrings.toArray()),formulas:xS(this.formulas.toArray()),formulaDatas:xS(this.formulaDatas.toArray(!0)),formulaRefMaps:xS(this.formulaRefMaps.toArray(!0)),errorValues:xS(this.errorValues.toArray(!0))}}},{key:"getAllResourceRefs",value:function(){return{embedImages:xS(this.embedImages.toArray(!0)),dataValidations:xS(this.dataValidations.toArray(!0)),mentions:xS(this.mentionsSerialize.toArray(!0)),mentionInfos:xS(this.mentionInfosSerialize.toArray(!0)),hyperlinks:xS(this.hyperlinks.toArray()),attachments:xS(this.attachments.toArray(!0)),extendValues:xS(this.extendValues.toArray()),notes:xS(this.notes.toArray()),reminderIds:xS(this.reminderIds.toArray()),selectedMultipleValues:xS(this.selectedMultipleValues.toArray(!0)),colors:xS(this.colors.toArray()),conditionalFormattingResults:xS(this.conditionalFormattingResults.toArray(!0)),formulaSpecialInfoStrings:xS(this.formulaSpecialInfoStrings.toArray())}}}]),e}(),HS=function(){function e(){(0,y.Z)(this,e),this.cellFormats=new $S,this.numberFormats=new Oy,this.fonts=new $S,this.fills=new Oy,this.borders=new Oy,this.alignments=new Oy,this.hideLinks=new Oy,this.multipleFormatMap=new Map}return(0,_.Z)(e,[{key:"pushStyle",value:function(e,t){var r,n=this;if(e)return this.cellFormats.checkValuesRefId(t,(function(e){r=e}),(function(){var t=n.getCellFormatting(e);return r=n.pushCellFormatting(t)})),r}},{key:"pushStyleFont",value:function(e,t){var r,n=this;if(e)return this.fonts.checkValuesRefId(t,(function(e){r=e}),(function(){var t=FR(e).font;if(t)return r=n.pushFont(t)})),r}},{key:"getAllRefs",value:function(){return{cellFormats:xS(this.cellFormats.toArray(!0)),numberFormats:xS(this.numberFormats.toArray(!0)),fonts:xS(this.fonts.toArray(!0)),fills:xS(this.fills.toArray(!0)),borders:xS(this.borders.toArray(!0)),alignments:xS(this.alignments.toArray(!0)),hideLinks:xS(this.hideLinks.toArray(!0))}}},{key:"addMultipleFormat",value:function(e){var t=this.multipleFormatMap.get(e);return void 0===t&&(t=this.pushNumberFormat({formatCode:e}),this.multipleFormatMap.set(e,t)),t}},{key:"getCellFormatting",value:function(e){var t=FR(e),r={numFmtId:this.pushNumberFormat(t.numFmt),fontId:this.pushFont(t.font),fillId:this.pushFill(t.fill),borderId:this.pushBorder(t.border),alignmentId:this.pushCellAlignment(t.alignment),autoNumFmtId:this.pushNumberFormat(t.autoNumFmt),hideLinkId:this.pushHideLink(t.otherFmt)};if(void 0!==r.numFmtId||void 0!==r.fontId||void 0!==r.fillId||void 0!==r.borderId||void 0!==r.alignmentId||void 0!==r.autoNumFmtId||void 0!==r.hideLinkId)return r}},{key:"pushCellFormatting",value:function(e){return e?this.cellFormats.add(e).id:void 0}},{key:"pushNumberFormat",value:function(e){return e?this.numberFormats.add(e).id:void 0}},{key:"pushFont",value:function(e){return e?this.fonts.add(e).id:void 0}},{key:"pushFill",value:function(e){return e?this.fills.add(e).id:void 0}},{key:"pushBorder",value:function(e){return e?this.borders.add(e).id:void 0}},{key:"pushCellAlignment",value:function(e){return e?this.alignments.add(e).id:void 0}},{key:"pushHideLink",value:function(e){return e?this.hideLinks.add(e).id:void 0}}]),e}(),zS=function(){function e(t,r,n,a){(0,y.Z)(this,e),this.cellValueRefHelper=new US,this.cellFormatRefHelper=new HS,this.cellRefs=[],this.pValueRefDelta=t,this.pResourceRefDelta=r,this.pFormatDelta=n,this.isApplySnapshot=a}return(0,_.Z)(e,[{key:"valueRefDelta",get:function(){var e;return null!==(e=this.pValueRefDelta)&&void 0!==e?e:this.cellValueRefHelper.getAllValueRefs()}},{key:"resourceRefDelta",get:function(){var e;return null!==(e=this.pResourceRefDelta)&&void 0!==e?e:this.cellValueRefHelper.getAllResourceRefs()}},{key:"formatDelta",get:function(){var e;return null!==(e=this.pFormatDelta)&&void 0!==e?e:this.cellFormatRefHelper.getAllRefs()}}]),e}(),WS=function(){function e(t){(0,y.Z)(this,e),this.keys=t,this.root=[],this.lastKey=t[t.length-1]}return(0,_.Z)(e,[{key:"insertNode",value:function(e,t){var r=e[t];return r||(e[t]=r=[]),r}},{key:"calcObjectHashValue",value:function(e,t){for(var r=this.keys,n=this.lastKey,a=this.root,o=this.root,i=0,u=0;u<r.length-1;u++){var s=r[u];i=void 0===e[s]?0:e[s]+1,a=o,o=this.insertNode(a,i)}return void 0===(o=(a=o)[i=void 0===e[n]?0:e[n]+1])&&(a[i]=t()),a[i]}}]),e}();function GS(e,t,r,n,a){var o=function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,a=Object.assign({},t),o=r.endRow-r.startRow,i=r.endCol-r.startCol,u=t.endRow-t.startRow,s=t.endCol-t.startCol,l=t.startRow-r.startRow,c=t.startCol-r.startCol,h=u*s,f=function(t,r,n,a){for(var o=0;o<t;o++){var u=n+Math.floor(o/r),s=a+Math.floor(o%r),l=u*i+s;e[o]=e[l]}e.length=t};return u<o&&s>=i-n?(f(u*i,i,l,0),a.startCol=r.startCol,a.endCol=r.endCol):s<i-n?f(h,s,l,c):Object.assign(a,r),a}(e,t=jS(t,n),r=jS(r,n)),i=a.cellRefs,u=a.valueRefDelta,s=a.resourceRefDelta,l=a.formatDelta;return{type:Ce.B2l.MutationType.MutationType_SetRangeValues,setRangeValues:{range:o,valueRefDelta:u,resourceRefDelta:s,formatDelta:l,cells:{cellIds:e,cells:i}}}}function jS(e,t){return e.startRow-=t.row,e.startCol-=t.col,e.endRow-=t.row,e.endCol-=t.col,e}function YS(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ce.fW_.brand;return{type:Ce.bPy.Line,themeType:e,nonNumShowAs:Ce.v5m.Zero,emptyShowAs:Ce.v5m.Space,lineWidth:2,showGradient:!0,extremumMax:{type:Ce.yre.auto},extremumMin:{type:Ce.yre.auto},containHiddenCells:!1,seriesColor:qS[e][0],points:{lastPoint:{color:qS[e][1],visible:!1},negativePoint:{color:qS[e][1],visible:!1},markersPoint:{color:qS[e][1],visible:!1},firstPoint:{color:qS[e][1],visible:!1},highPoint:{color:qS[e][1],visible:!1},lowPoint:{color:qS[e][1],visible:!1}},axis:{color:"N900",reverse:!1,visible:!1},showRadius:!0}}var qS=(De={},(0,l.Z)(De,Ce.fW_.brand,["B500","R400"]),(0,l.Z)(De,Ce.fW_.fresh,["ccmtoken-sheet-minichart-fresh-cyan","ccmtoken-sheet-minichart-fresh-yellow"]),(0,l.Z)(De,Ce.fW_.light,["ccmtoken-sheet-minichart-bright-purple","ccmtoken-sheet-minichart-bright-yellow"]),(0,l.Z)(De,Ce.fW_.pro,["ccmtoken-sheet-minichart-professional-blue","ccmtoken-sheet-minichart-professional-red"]),(0,l.Z)(De,Ce.fW_.soft,["ccmtoken-sheet-minichart-pastel-blue","ccmtoken-sheet-minichart-pastel-yellow"]),De),JS=function(){function e(t){if((0,y.Z)(this,e),t)for(var r=0,n=Object.entries(t);r<n.length;r++){var a=(0,g.Z)(n[r],2),o=a[0],i=a[1];null!=i&&(this[o]=i)}this.defaultSparklineConfig=YS(this.themeType)}return(0,_.Z)(e,[{key:"setType",value:function(e){this.type=e}},{key:"getType",value:function(){var e;return null!==(e=this.type)&&void 0!==e?e:this.defaultSparklineConfig.type}},{key:"setThemeType",value:function(e){this.themeType=e,this.defaultSparklineConfig=YS()}},{key:"getThemeType",value:function(){var e;return null!==(e=this.themeType)&&void 0!==e?e:this.defaultSparklineConfig.themeType}},{key:"setLineWidth",value:function(e){this.lineWidth=e}},{key:"getLineWidth",value:function(){var e;return null!==(e=this.lineWidth)&&void 0!==e?e:this.defaultSparklineConfig.lineWidth}},{key:"setShowGradient",value:function(e){this.showGradient=e}},{key:"getShowGradient",value:function(){var e;return null!==(e=this.showGradient)&&void 0!==e?e:this.defaultSparklineConfig.showGradient}},{key:"setShowRadius",value:function(e){this.showRadius=e}},{key:"getShowRadius",value:function(){var e;return null!==(e=this.showRadius)&&void 0!==e?e:this.defaultSparklineConfig.showRadius}},{key:"setPoint",value:function(e,t,r){this.points||(this.points={}),this.points[e]||(this.points[e]={}),this.points[e].visible=t,this.points[e].color=r}},{key:"setPointsColor",value:function(e,t){this.setPoint("lastPoint",e,t),this.setPoint("negativePoint",e,t),this.setPoint("markersPoint",e,t),this.setPoint("firstPoint",e,t),this.setPoint("highPoint",e,t),this.setPoint("lowPoint",e,t)}},{key:"getPoint",value:function(e){var t,r;return Object.assign({},null===(t=YS(this.getThemeType()).points)||void 0===t?void 0:t[e],{},null===(r=this.points)||void 0===r?void 0:r[e])}},{key:"setSeriesColor",value:function(e){this.seriesColor=e}},{key:"getSeriesColor",value:function(){var e,t;return null!==(e=null!==(t=this.seriesColor)&&void 0!==t?t:qS[this.getThemeType()][0])&&void 0!==e?e:YS(this.getThemeType()).seriesColor}},{key:"setExtremumMax",value:function(e,t){this.extremumMax||(this.extremumMax={}),this.extremumMax.type=e,void 0!==t&&(this.extremumMax.value=t)}},{key:"setExtremumMin",value:function(e,t){this.extremumMin||(this.extremumMin={}),this.extremumMin.type=e,void 0!==t&&(this.extremumMin.value=t)}},{key:"getExtremumMax",value:function(){return Object.assign({},this.defaultSparklineConfig.extremumMax,{},this.extremumMax)}},{key:"getExtremumMin",value:function(){return Object.assign({},this.defaultSparklineConfig.extremumMin,{},this.extremumMin)}},{key:"setAxisColor",value:function(e){this.axis||(this.axis={}),this.axis.color=e}},{key:"setAxisVisible",value:function(e){this.axis||(this.axis={}),this.axis.visible=e}},{key:"setAxisReverse",value:function(e){this.axis||(this.axis={}),this.axis.reverse=e}},{key:"getAxisConfig",value:function(){return Object.assign({},this.defaultSparklineConfig.axis,{},this.axis)}},{key:"setDefaultSparklineConfig",value:function(e){this.defaultSparklineConfig=e}},{key:"setNonNumShowAs",value:function(e){this.nonNumShowAs=e}},{key:"setEmptyShowAs",value:function(e){this.emptyShowAs=e}},{key:"setContainHiddenCells",value:function(e){this.containHiddenCells=e}},{key:"getNonNumShowAs",value:function(){var e;return null!==(e=this.nonNumShowAs)&&void 0!==e?e:this.defaultSparklineConfig.nonNumShowAs}},{key:"getEmptyShowAs",value:function(){var e;return null!==(e=this.emptyShowAs)&&void 0!==e?e:this.defaultSparklineConfig.emptyShowAs}},{key:"getContainHiddenCells",value:function(){var e;return null!==(e=this.containHiddenCells)&&void 0!==e?e:this.defaultSparklineConfig.containHiddenCells}},{key:"getRawConfig",value:function(){for(var e={themeType:this.themeType,nonNumShowAs:this.nonNumShowAs,emptyShowAs:this.emptyShowAs,containHiddenCells:this.containHiddenCells,seriesColor:this.seriesColor,points:this.points,lineWidth:this.lineWidth,type:this.type,axis:this.axis,showGradient:this.showGradient,extremumMax:this.extremumMax,extremumMin:this.extremumMin,showRadius:this.showRadius},t=0,r=Object.keys(e);t<r.length;t++){var n=r[t];void 0===e[n]&&delete e[n]}return e}},{key:"getConfig",value:function(){return(0,ae.Z)(this.defaultSparklineConfig,{themeType:this.themeType,nonNumShowAs:this.nonNumShowAs,emptyShowAs:this.emptyShowAs,containHiddenCells:this.containHiddenCells,seriesColor:this.seriesColor,points:this.points,lineWidth:this.lineWidth,type:this.type,axis:this.axis,showGradient:this.showGradient,extremumMax:this.extremumMax,extremumMin:this.extremumMin})}}]),e}();function KS(){return"_".concat(Math.random().toString(36).substr(2,9))}function XS(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return function(n,a,o){var i=n.getId(),u=t?o:-o,s=n.getPosition(),l=s.row,c=s.col;t||(r&&l>=a&&l<a+o&&e.deleteSparklineInSparklineModel(i),!r&&c>=a&&c<a+o&&e.deleteSparklineInSparklineModel(i)),r&&l>=a&&n.updatePosition(l+u,c),!r&&c>=a&&n.updatePosition(l,c+u)}}function QS(){return"sp"+KS()}function eA(){return"gp"+KS()}function tA(e,t,r){var n=e.parent;if(null==t||null==n)return null;try{var a=ad(t,{spread:n,refStyle:"A1",ref:new ou(0,0,1,1,e)});return a&&!a.isError()&&a.isValid()&&a.isValidRefInSheet()?r&&!a.isValidBoundaryInsideSheet()?null:a:null}catch(e){return null}}var rA,nA=function(){function e(t,r,n,a,o){if((0,y.Z)(this,e),this.sourceRange=null,this.sheet=t,this.id=a||QS(),this.groupId=o||eA(),r){this.position=n;var i=tA(t,r);this.sourceRange=i}}return(0,_.Z)(e,[{key:"getId",value:function(){return this.id}},{key:"updateGroupId",value:function(e){this.groupId=e}},{key:"getGroupId",value:function(){return this.groupId}},{key:"getSourceRange",value:function(){var e;return(null===(e=this.sourceRange)||void 0===e?void 0:e.sheet())!==this.sheet?null:this.sourceRange}},{key:"getSource",value:function(){var e,t;return(null===(e=this.sourceRange)||void 0===e?void 0:e.sheet())!==this.sheet?it.ErrorConstant.REF:(null===(t=this.sourceRange)||void 0===t?void 0:t.toString({ref:this.sourceRange}))||it.ErrorConstant.REF}},{key:"updatePosition",value:function(e,t){void 0!==e&&(this.position={row:e,col:this.position.col}),void 0!==t&&(this.position={row:this.position.row,col:t})}},{key:"getPosition",value:function(){return this.position}},{key:"updateSource",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.sheet;this.sourceRange=tA(t,e)}},{key:"toJSON",value:function(){return{id:this.id,groupId:this.groupId,source:this.getSource(),position:Object.assign({},this.position)}}}]),e}(),aA=function(){function e(){(0,y.Z)(this,e),this.sparklineGroupConfigMap=new Map,this.sparklineGroupConfigReferCountMap=new Map,this.groupIdMap=new Map}return(0,_.Z)(e,[{key:"addGroup",value:function(e,t){var r=Fa(t);this.groupIdMap.set(e,r);var n=new JS(t),a=this.sparklineGroupConfigReferCountMap.get(r)||0;return this.sparklineGroupConfigMap.has(r)?this.sparklineGroupConfigReferCountMap.set(r,a+1):(this.sparklineGroupConfigMap.set(r,n),this.sparklineGroupConfigReferCountMap.set(r,1)),n}},{key:"removeGroupById",value:function(e){if(this.groupIdMap.has(e)){var t=this.groupIdMap.get(e);this.groupIdMap.delete(e);var r=this.sparklineGroupConfigReferCountMap.get(t)||0;r>1?this.sparklineGroupConfigReferCountMap.set(t,r-1):(this.sparklineGroupConfigMap.delete(t),this.sparklineGroupConfigReferCountMap.delete(t))}}},{key:"getConfigObjById",value:function(e){var t=this.groupIdMap.get(e);return t&&this.sparklineGroupConfigMap.get(t)||null}},{key:"getRawConfigById",value:function(e){var t=this.getConfigObjById(e);return(null==t?void 0:t.getRawConfig())||null}},{key:"getConfigById",value:function(e){var t=this.getConfigObjById(e);return(null==t?void 0:t.getConfig())||null}},{key:"updateGroupConfig",value:function(e,t){if(this.groupIdMap.has(e)){var r=this.getRawConfigById(e),n=this.groupIdMap.get(e),a=this.sparklineGroupConfigReferCountMap.get(n)||0;a<=1?(this.sparklineGroupConfigReferCountMap.delete(n),this.sparklineGroupConfigMap.delete(n)):this.sparklineGroupConfigReferCountMap.set(n,a-1);var o=(0,ne.Z)((0,Re.default)(r),t);Object.keys(t).forEach((function(e){var r=t[e];null===r?delete o[e]:["extremumMax","extremumMain","axis","points"].includes(e)&&Object.keys(r).forEach((function(t){var n=r[t];null===n?delete o[e][t]:"object"==(0,R.Z)(n)&&Object.keys(n).forEach((function(r){null===n[r]&&delete o[e][t][r]}))}))}));var i=new JS(o),u=Fa(o);if(this.groupIdMap.set(e,u),this.sparklineGroupConfigMap.has(u)){var s=this.sparklineGroupConfigReferCountMap.get(u)||0;this.sparklineGroupConfigReferCountMap.set(u,s+1)}else this.sparklineGroupConfigMap.set(u,i),this.sparklineGroupConfigReferCountMap.set(u,1),this.groupIdMap.set(e,u)}}}]),e}(),oA="";!function(e){e[e.Null=0]="Null",e[e.Positive=1]="Positive",e[e.PositiveAndZero=2]="PositiveAndZero",e[e.Negative=3]="Negative",e[e.NegativeAndZero=4]="NegativeAndZero",e[e.Mix=5]="Mix"}(rA||(rA={}));var iA=function(){function e(t){var r=this;(0,y.Z)(this,e),this.sheet=t,this.disposerMap=new Map,this.cacheMap=new Map,this.idRangeMap=new Map,this.groupExtremumMap=new Map,this.dirtyRect=[],this.subscriber=null,this.markDirtyRect=(0,ie.default)((function(){var e,t,n,a=yr(r.dirtyRect);try{for(a.s();!(n=a.n()).done;){var o=n.value;t=t?t.union(o):o}}catch(e){a.e(e)}finally{a.f()}null!==(e=r.markDirtyCallback)&&void 0!==e&&e.call(r,t),r.dirtyRect=[]}),50,{trailing:!0}),this.depRefManager=t.parent.calcEngine.depRefManager,this.subscriber=t.subscribe({OutlineStateChanged:this.handleOutlineChange,RowVisible:this.handleRowVisibleChange,ColumnVisibleChanged:this.handleColVisibleChange})}return(0,_.Z)(e,[{key:"getSourceRangeById",value:function(e){return this.idRangeMap.get(e)}},{key:"addListener",value:function(e,t){var r,n=this;this.idRangeMap.set(e,t);var a=this.depRefManager.watchRef(t,(function(){return n.markSourceRangeDirtyById(e)}));null!==(r=this.disposerMap.get(e))&&void 0!==r&&r(),this.disposerMap.set(e,a)}},{key:"removeListener",value:function(e){var t;this.idRangeMap.delete(e),null!==(t=this.disposerMap.get(e))&&void 0!==t&&t(),this.disposerMap.delete(e)}},{key:"markSourceRangeDirtyById",value:function(e){var t=this.sheet.getSparklineById(e);if(t)if(t.getSourceRange()){var r=t.getPosition(),n=r.row,a=r.col,o=new bt.FRect(a,n,1,1);this.dirtyRect.push(o),this.cacheMap.delete(e),this.groupExtremumMap.delete(t.getGroupId()),this.markDirtyRect()}else this.removeListener(e)}},{key:"handleOutlineChange",value:function(e){var t,r=e.range,n=yr(this.idRangeMap);try{for(n.s();!(t=n.n()).done;){var a=(0,g.Z)(t.value,2),o=a[0],i=a[1];r.isIntersect(i)&&this.markSourceRangeDirtyById(o)}}catch(e){n.e(e)}finally{n.f()}}},{key:"handleRowVisibleChange",value:function(e){var t,r=null,n=yr(e.changes);try{for(n.s();!(t=n.n()).done;){var a=t.value,o=a.row,i=a.count;r=r?r.union(new iu(o,i,this.sheet)):new iu(o,i,this.sheet)}}catch(e){n.e(e)}finally{n.f()}r&&this.handleOutlineChange({range:r})}},{key:"handleColVisibleChange",value:function(e){var t,r=null,n=yr(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,o=a.col,i=a.count;r=r?r.union(new nu(o,i,this.sheet)):new nu(o,i,this.sheet)}}catch(e){n.e(e)}finally{n.f()}r&&this.handleOutlineChange({range:r})}},{key:"setCache",value:function(e,t){this.cacheMap.set(e,t)}},{key:"getCache",value:function(e){return this.cacheMap.get(e)}},{key:"removeCache",value:function(e,t){this.cacheMap.delete(e),this.groupExtremumMap.delete(t)}},{key:"clearCache",value:function(){this.cacheMap.clear(),this.groupExtremumMap.clear()}},{key:"getDataById",value:function(e){var t=this.sheet.getSparklineModel(),r=this.sheet.getSparklineById(e);if(!r)return null;var n=r.getGroupId(),a=t.getSparklineGroupByGroupId(n);if(!a)return null;var o=this.createSourceDataCache(e,a);if(!o)return null;var i=a.getExtremumMax().type,u=a.getExtremumMin().type,s={data:o.data,selfExtremum:[o.min||0,o.max||0],extremum:[o.min||0,o.max||0],valueType:o.valueType};if(i===Ce.yre.group){var l,c,h=(null===(l=this.groupExtremumMap.get(n))||void 0===l?void 0:l.max)||(null===(c=this.createGroupExtremumCache(n,a))||void 0===c?void 0:c.max);if(void 0===h)return null;s.extremum[1]=h}if(u===Ce.yre.group){var f,d,v=(null===(f=this.groupExtremumMap.get(n))||void 0===f?void 0:f.min)||(null===(d=this.createGroupExtremumCache(n,a))||void 0===d?void 0:d.min);if(void 0===v)return null;s.extremum[0]=v}return s}},{key:"createGroupExtremumCache",value:function(e,t){if(this.groupExtremumMap.has(e))return this.groupExtremumMap.get(e);var r,n,a,o=yr(this.sheet.getSparklinesByGroupId(e));try{for(o.s();!(a=o.n()).done;){var i=a.value,u=this.createSourceDataCache(i.getId(),t);void 0!==(null==u?void 0:u.max)&&(r=void 0===r?u.max:Math.max(u.max,r)),void 0!==(null==u?void 0:u.min)&&(n=void 0===n?u.min:Math.min(u.min,n))}}catch(e){o.e(e)}finally{o.f()}if(void 0!==r&&void 0!==n){var s={max:r,min:n};return this.groupExtremumMap.set(e,s),s}return null}},{key:"createSourceDataCache",value:function(e,t){if(this.cacheMap.has(e))return this.cacheMap.get(e);var r=this.idRangeMap.get(e);if(!r)return null;var n=this._getRawData(r),a=this._processRawData(n,t);return this.setCache(e,a),a}},{key:"_getRawData",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e4,r=this.sheet,n=r.getHiddenRows(),a=r.getHiddenCols(),o=r.filterModel.getAllFilteredOutRowsArray(),i=e.toJSON(),u=i.row,s=i.col,l=i.rowCount,c=i.colCount,h=[],f=0,d=0;d<l;d++)for(var v=0;v<c;v++){f++;var p=u+d,m=s+v,g=r.getValue(p,m);if(h.push({value:g,isFiltered:o.includes(p),isHidden:!(!n[p]&&!a[m])}),f>=t)return h}return h}},{key:"_processRawData",value:function(e,t){for(var r,n,a=t.getEmptyShowAs(),o=t.getNonNumShowAs(),i=t.getContainHiddenCells(),u=!!t.getAxisConfig().reverse,s=[],l=function(e){switch(e){case Ce.v5m.Link:return oA;case Ce.v5m.Zero:return 0;case Ce.v5m.Space:default:return}},c=rA.Null,h=function(e){r=void 0===r?e:Math.max(e,r),n=void 0===n?e:Math.min(e,n),0===e?c===rA.Negative?c=rA.NegativeAndZero:c===rA.Positive&&(c=rA.PositiveAndZero):c===rA.Null?c=e>0?rA.Positive:rA.Negative:(e>0&&[rA.Negative,rA.NegativeAndZero].includes(c)||e<0&&[rA.Positive,rA.PositiveAndZero].includes(c))&&(c=rA.Mix)},f=function(e){return"string"==typeof e&&""===e.trim()},d=0;d<e.length;d++){var v=e[d],p=v.value,m=v.isFiltered,g=v.isHidden;if(i||!m&&!g)if((0,re.Z)(p))s.push(l(a)),a===Ce.v5m.Zero&&h(0);else if(f(p)||Number.isNaN(Number(p)))s.push(l(o)),o===Ce.v5m.Zero&&h(0);else{var y=Number(p);s.push(y),h(y)}}return u&&s.reverse(),{data:s,min:n,max:r,valueType:c}}},{key:"dispose",value:function(){var e;this.disposerMap.forEach((function(e){return e()})),this.disposerMap.clear(),this.cacheMap.clear(),this.idRangeMap.clear(),this.groupExtremumMap.clear(),null!==(e=this.subscriber)&&void 0!==e&&e.unsubscribe(),this.markDirtyRect.cancel(),delete this.sheet,delete this.sheetFormulaService,delete this.markDirtyCallback,delete this.subscriber,delete this.dirtyRect,delete this.disposerMap,delete this.cacheMap,delete this.idRangeMap,delete this.groupExtremumMap}}]),e}();Vu([(0,Mt.Bind)()],iA.prototype,"handleOutlineChange",null),Vu([(0,Mt.Bind)()],iA.prototype,"handleRowVisibleChange",null),Vu([(0,Mt.Bind)()],iA.prototype,"handleColVisibleChange",null);var uA=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).sparklines=new Map,r.sparklinesGroupMap=new Map,r.groupMgr=new aA,r.sheet=e,r.dataMgr=new iA(e),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"addGroupById",value:function(e,t){this.groupMgr.addGroup(e,t),this.sparklinesGroupMap.set(e,new Set)}},{key:"deleteGroupById",value:function(e){var t,r=this;this.groupMgr.removeGroupById(e);var n=this.sparklinesGroupMap.get(e);null!=n&&null!==(t=n.forEach)&&void 0!==t&&t.call(n,(function(e){r.deleteSparklineById(e)})),this.sparklinesGroupMap.delete(e)}},{key:"deleteGroupInSparklineModel",value:function(e){var t,r=this;this.groupMgr.removeGroupById(e);var n=this.sparklinesGroupMap.get(e);null!=n&&null!==(t=n.forEach)&&void 0!==t&&t.call(n,(function(e){r.deleteSparklineInSparklineModel(e)})),this.sparklinesGroupMap.delete(e)}},{key:"getSparklineGroupByGroupId",value:function(e){return this.groupMgr.getConfigObjById(e)}},{key:"getSparklineGroupBySparklineId",value:function(e){var t=this.sparklines.get(e);if(t){var r=t.getGroupId();return this.getSparklineGroupByGroupId(r)||null}return null}},{key:"createSparkline",value:function(e,t,r,n){var a=new nA(this.sheet,e,t,r,n);return this.addSparklineById(a.getId(),a),a}},{key:"addSparklineById",value:function(e,t){var r=t.getPosition(),n=r.row,a=r.col;this.sparklines.set(e,t),this.set(n,a,t);var o=t.getGroupId();if(this.sparklinesGroupMap.has(o))this.sparklinesGroupMap.get(o).add(e);else{var i=new Set;i.add(e),this.sparklinesGroupMap.set(o,i)}}},{key:"set",value:function(e,r,n){(0,f.Z)((0,v.Z)(t.prototype),"set",this).call(this,e,r,n);var a=n.getSourceRange();a&&this.dataMgr.addListener(n.getId(),a),this.sheet.dispatch("SparklineAdd",{id:n.getId(),sheetId:this.sheet.id()})}},{key:"delete",value:function(e,r,n){n.getSourceRange()&&this.dataMgr.removeListener(n.getId()),(0,f.Z)((0,v.Z)(t.prototype),"get",this).call(this,e,r)===n&&(0,f.Z)((0,v.Z)(t.prototype),"set",this).call(this,e,r,null),this.sheet.dispatch("SparklineDelete",{id:n.getId(),sheetId:this.sheet.id(),cell:{row:e,col:r},groupId:n.getGroupId()})}},{key:"setSparklineById",value:function(e,t,r,n){var a=this.sparklines.get(e);if(a){var o=null==a?void 0:a.getGroupId();if(t&&t!==o){var i,u=this.sparklinesGroupMap.get(o);null!=u&&u.delete(e),!(null!=u&&u.size)&&this.deleteGroupById(o),a.updateGroupId(t);var s=this.sparklinesGroupMap.get(t);null!=s&&null!==(i=s.add)&&void 0!==i&&i.call(s,e),this.sheet.dispatch("SparklineGroupConfigChanged",{groupId:t,sheetId:this.sheet.id()})}if(r){var l=a.getPosition();this.delete(l.row,l.col,a),a.updatePosition(r.row,r.col),this.set(r.row,r.col,a)}if(n){var c=a.getGroupId(),h=a.getPosition(),f=h.row,d=h.col;this.delete(f,d,a),this.createSparkline(n,{row:f,col:d},e,c),this.sheet.dispatch("SparklineGroupConfigChanged",{groupId:c,sheetId:this.sheet.id()})}}}},{key:"getSparklineById",value:function(e){return this.sparklines.get(e)||null}},{key:"getSparklineByPosition",value:function(e,t){return(0,m.Z)(this.sparklines.values()).find((function(r){var n=r.getPosition(),a=n.row,o=n.col;return a===e&&o===t}))||null}},{key:"getSparklineGroupIdByCell",value:function(e,t){var r=this.getSparklineByCell(e,t);return r?r.getGroupId():null}},{key:"getSparklineByCell",value:function(e,t){return this.get(e,t)}},{key:"setSparklineByCell",value:function(e,t,r){r.updatePosition(e,t),this.addSparklineById(r.getId(),r)}},{key:"deleteSparklineByCell",value:function(e,t){var r=this.getSparklineByCell(e,t);r&&this.deleteSparklineById(r.getId())}},{key:"deleteSparklineById",value:function(e){var t=this.sparklines.get(e);if(t){var r=t.getPosition(),n=r.row,a=r.col;this.delete(n,a,t),this.deleteSparklineInSparklineModel(e);var o=t.getGroupId();if(o){var i=this.sparklinesGroupMap.get(o);(null==i||!i.size)&&this.deleteGroupById(o)}}}},{key:"deleteSparklineInSparklineModel",value:function(e){var t,r,n=this.sparklines.get(e);if(n){this.sparklines.delete(e),r=null==n?void 0:n.getGroupId();var a=this.sparklinesGroupMap.get(r);if(null!=a&&null!==(t=a.delete)&&void 0!==t&&t.call(a,e),r){var o=this.sparklinesGroupMap.get(r);(null==o||!o.size)&&this.deleteGroupInSparklineModel(r)}}}},{key:"getSparklinesByGroupId",value:function(e){var t=this,r=this.sparklinesGroupMap.get(e),n=[];return null!=r&&r.forEach((function(e){t.sparklines.has(e)&&n.push(t.sparklines.get(e))})),n}},{key:"getSparklineRawConfig",value:function(e){return this.groupMgr.getRawConfigById(e)}},{key:"getSparklineConfig",value:function(e){return this.groupMgr.getConfigById(e)}},{key:"addRow",value:function(e,r,n){this.addRowCol(e,r),(0,f.Z)((0,v.Z)(t.prototype),"addRow",this).call(this,e,r,n)}},{key:"addCol",value:function(e,r){this.addRowCol(e,r,!1),(0,f.Z)((0,v.Z)(t.prototype),"addCol",this).call(this,e,r)}},{key:"addRowCol",value:function(e,t){var r,n,a,o,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];i?(r=e,a=this.sheet.getRowCount()-e,n=0,o=this.sheet.getColumnCount()):(r=0,a=this.sheet.getRowCount(),n=e,o=this.sheet.getColumnCount()-e);var u=XS(this,!0,i);this.iter(r,n,a,o).forEach((function(r){u(r,e,t)}))}},{key:"delRow",value:function(e,r,n){this.removeRowCol(e,r),(0,f.Z)((0,v.Z)(t.prototype),"delRow",this).call(this,e,r,n),this.sheet.dispatch("SparklineDelRowCol",{sheetId:this.sheet.id()})}},{key:"delCol",value:function(e,r){this.removeRowCol(e,r,!1),(0,f.Z)((0,v.Z)(t.prototype),"delCol",this).call(this,e,r),this.sheet.dispatch("SparklineDelRowCol",{sheetId:this.sheet.id()})}},{key:"swapRow",value:function(e,r){this.iter(e,0,1,this.sheet.getColumnCount()).forEach((function(e){e.updatePosition(r)})),(0,f.Z)((0,v.Z)(t.prototype),"swapRow",this).call(this,e,r)}},{key:"swapCol",value:function(e,r){this.iter(0,e,this.sheet.getRowCount(),1).forEach((function(e){e.updatePosition(void 0,r)})),(0,f.Z)((0,v.Z)(t.prototype),"swapCol",this).call(this,e,r)}},{key:"swapCell",value:function(e,r,n,a){var o=this.get(e,r);o&&o.updatePosition(n,a);var i=this.get(n,a);i&&i.updatePosition(e,r),(0,f.Z)((0,v.Z)(t.prototype),"swapCell",this).call(this,e,r,n,a)}},{key:"removeRowCol",value:function(e,t){var r,n,a,o,i=this,u=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],s=XS(this,!1,u);u?(r=e,a=this.sheet.getRowCount()+t-e,n=0,o=this.sheet.getColumnCount()):(r=0,a=this.sheet.getRowCount(),n=e,o=this.sheet.getColumnCount()+t-e),this.iterWithPos(r,n,a,o).forEach((function(r){var n=(0,g.Z)(r,2),a=n[0],o=n[1],l=u?o.row:o.col;e<=l&&l<e+t?i.deleteSparklineById(a.getId()):s(a,e,t)}))}},{key:"updateGroupConfig",value:function(e,t){this.groupMgr.updateGroupConfig(e,t),this.sheet.dispatch("SparklineGroupConfigChanged",{groupId:e,sheetId:this.sheet.id()})}},{key:"fromJSON",value:function(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var n=(0,g.Z)(r[t],2),a=n[0],o=n[1],i=o.sparklines,u=void 0===i?{}:i,s=o.config,l=void 0===s?{}:s;this.addGroupById(a,l);for(var c=0,h=Object.entries(u);c<h.length;c++){var f=(0,g.Z)(h[c],2),d=f[0],v=f[1],p=this.createSparkline(v.source,v.position,d,a);this.addSparklineById(p.getId(),p)}}}},{key:"toJSON",value:function(){var e,t=this,r={},n=yr(this.sparklinesGroupMap);try{var a=function(){var n=(0,g.Z)(e.value,2),a=n[0],o=n[1],i={};r[a]=i;var u=t.getSparklineRawConfig(a);u&&(i.config=u),o.forEach((function(e){var r=t.sparklines.get(e),n=r.getSource(),a=r.getPosition();i.sparklines?i.sparklines[e]={source:n,position:a}:i.sparklines=(0,l.Z)({},e,{source:n,position:a})}))};for(n.s();!(e=n.n()).done;)a()}catch(e){n.e(e)}finally{n.f()}return r}},{key:"getGroupConfigJSON",value:function(e){var t=this.getSparklineRawConfig(e),r=this.getSparklinesByGroupId(e).reduce((function(e,t){return e[t.getId()]={source:t.getSource(),position:t.getPosition()},e}),{})||{};return t?{config:t,sparklines:r}:{sparklines:r}}},{key:"getDataManager",value:function(){return this.dataMgr}},{key:"getExporter",value:function(e,t,r,n){return new sA(this,this.sheet,e,t,r,n)}},{key:"getImporter",value:function(){return new lA(this)}},{key:"getSparklinesGroupMap",value:function(){return this.sparklinesGroupMap}}]),t}(Wg),sA=function(e){function t(e,r,n,a,o,i){var u;return(0,y.Z)(this,t),(u=(0,d.Z)(this,(0,v.Z)(t).call(this,e.iter(n,a,o,i)))).block=e,u.sheet=r,u}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exportToCell",value:function(){}},{key:"exportExtraInfo",value:function(e){this.block.isEmpty()||(e.sparklineGroup=this.block.toJSON())}}]),t}(D_),lA=function(){function e(t){(0,y.Z)(this,e),this.block=t}return(0,_.Z)(e,[{key:"importCell",value:function(){}},{key:"importExtraInfo",value:function(e){e.sparklineGroup&&this.block.fromJSON(e.sparklineGroup)}}]),e}(),cA=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this))).sheet=e,n.contentModel=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getCellNoteJSON",value:function(e,t){var r=this.get(e,t);if(null!=r&&r.value){var n=this.segmentToJSON(r.value);return Object.assign({},r,{value:n})}return r}},{key:"setNoteFromJSON",value:function(e,t,r){if(r){var n=this.segmentFromJSON(r.value);this.set(e,t,Object.assign({},r,{value:n}))}else this.set(e,t,r)}},{key:"getSerializer",value:function(e,t,r,n){return new hA(this,e,t,r,n)}},{key:"getExporter",value:function(e,t,r,n){return new fA(this,e,t,r,n)}},{key:"getImporter",value:function(){return new dA(this)}},{key:"segmentFromJSON",value:function(e){var t=this;return e.map((function(e){return(e=Object.assign({},e)).style&&(e.style instanceof Om||(e.style=Om.fromJSON(t.sheet.parent.formatterService,e.style))),e}))}},{key:"segmentToJSON",value:function(e){return e.map((function(e){return(e=Object.assign({},e)).style&&e.style instanceof Om&&(e.style=e.style.toJSON()),e}))}}]),t}(Wg),hA=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serializeCell",value:function(e,t,r){if(t.value){var n={w:t.width,h:t.height};e.noteId=r.cellValueRefHelper.notes.add({frameSize:n,valueType:Ce.B2l.NoteValueType.NoteValueType_RichString,valueId:this.getRefValue(r,t)}).id}}},{key:"getRefValue",value:function(e,t){var r=t.value;return this.getRichStringValue(e,r)}},{key:"getRichStringValue",value:function(e,t){return this.model.contentModel.getSerializer(this.rowFrom,this.colFrom,this.rowCount,this.colCount).serializeSegmentArray(t,e)}}]),t}(G_),fA=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this,e.iter(r,n,a,o)))).block=e,i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exportToCell",value:function(e,t){if(e&&null!=t&&t.value&&!by(t)){var r=this.block.segmentToJSON(t.value);e.note=Object.assign({},t,{value:r})}}}]),t}(D_),dA=function(){function e(t){(0,y.Z)(this,e),this.block=t}return(0,_.Z)(e,[{key:"importCell",value:function(e,t,r,n){var a=r.note;if(null!=a&&a.value){var o=this.block.segmentFromJSON(a.value);this.block.set(e,t,Object.assign({},a,{value:o}))}}},{key:"importExtraInfo",value:function(){}}]),e}(),vA=Object.keys(Ce.Wa0).length/2,pA=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getStyleId",value:function(e){return this.getStyleRefAndId(e).id}},{key:"getStyleJson",value:function(e){return this.getStyleRefAndId(e).ref}},{key:"getStyleRefAndId",value:function(e){this.styleJsonCache||(this.styleJsonCache=new Map);var t=this.styleJsonCache.get(e);if(t)return t;var r=e.toJSON(!0),n=this.add(r);return this.styleJsonCache.set(e,n),n}},{key:"equals",value:function(e,t){var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(var a=0,o=r;a<o.length;a++){var i=o[a],u=e[i],s=t[i];switch(i){case pm:case gm:if((0,oe.default)(u,"formatCached")!==(0,oe.default)(s,"formatCached"))return!1;continue;case _m:case Rm:case Cm:case ym:if((0,oe.default)(u,"color")===(0,oe.default)(s,"color")&&(0,oe.default)(u,"width")===(0,oe.default)(s,"color"))return!1;continue}if(i===mm)return Qp(e[i],t[i]);if(e[i]!==t[i])return!1}return!0}},{key:"getHash",value:function(e){return Fa(e)}},{key:"serializeRef",value:function(e){var t=[null];!hm()&&e.hasOwnProperty("fontInfo")?t[0]=e.fontInfo:e.hasOwnProperty("font")&&(t[0]=e.font);for(var r=!1,n=vA;n>=1;n--)e.hasOwnProperty(Ce.Wa0[n])?(r=!0,t[n]=e[Ce.Wa0[n]]):r&&(t[n]=null);return t}}],[{key:"deserialize",value:function(e){for(var t={},r=0;r<e.length;r++){var n={},a=e[r];if(a){for(var o=0;o<a.length;o++)if(!(0,re.Z)(a[o])){if(o===Ce.Wa0.font){var i=a[0];"string"==typeof i?n.font=i:n.fontInfo=i;continue}n[Ce.Wa0[o]]=a[o]}t[r]=n}}return t}}]),t}(Iy),mA=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,new pA))).sheet=e,r.setRefCounterState(),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setRefCounterState",value:function(){var e=this.sheet.isRefCountValid();this.refs.setUseRefCounter(e)}},{key:"deserializeCell",value:function(e,t,r,n){var a=this,o=n.cellValueRefHelper,i=n.resourceRefDelta;o.conditionalFormattingResults.checkValuesRefId(r,(function(r){a.setById(e,t,r,!1)}),(function(){var n=i.conditionalFormattingResults[r];if(n){var o=n.conditionalFormatStyle,u=n.iconsStyle,s=n.dataBarStyleInfo,l=AS(o),c=OS(u),h=NS(s);if(l||c||h){var f=Object.assign({},l,{},c,{},h);return a.setRef(e,t,f)}}}))}},{key:"getExporter",value:function(e,t,r,n){return new gA(this,e,t,r,n)}}]),t}(Vy),gA=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this,e.iter(r,n,a,o)))).block=e,i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serializeCell",value:function(e,t,r){var n=this;if(r.isForShortcut){var a=r.cellValueRefHelper;a.conditionalFormattingResults.checkValuesRefId(t,(function(t){e.conditionalFormattingResultId=t}),(function(){var r=n.block.getRefMgr().getById(t);if(r){var o={conditionalFormatStyle:SS(r),iconsStyle:IS(r),dataBarStyleInfo:VS(r)};return e.conditionalFormattingResultId=a.conditionalFormattingResults.add(o).id,e.conditionalFormattingResultId}}))}}}]),t}(D_),yA=sa.isEmptyObject,_A=dn._Types._isNullOrUndefined,RA={refType:1},CA="wordWrap";function wA(e){return e.rowCount}function EA(e){return e.colCount}function kA(e){return!!e&&e instanceof Gp}var TA=function(){function e(t,r,n,a){(0,y.Z)(this,e),this._dirtySuspended=0,this.rowCount=t,this.colCount=r,this.name=a,this._defaultDataNode=null,this._dirtySuspended=0,this._sheet=n;var o=Ce.Ps3.getModelMemOptimizeEnabled();this.contentModel=new(o?wC:CC)(this._sheet),this.styleDropdownModel=new aR(this._sheet),this.composedStyleCache=new Yk,this.dataValidationModel=new q_(this._sheet),this.commentModel=new OC(this._sheet),this.noteModel=new cA(this._sheet,this.contentModel),this.extralModel=new Wg,this.reminderModel=new jC(this._sheet),this.conditionalFormatStyleModel=new bS,this.conditionalFormatStyleRefModel=new mA(this._sheet),this.sparklineModel=new uA(this._sheet),this.composer=new qg,this.composer.addModel(this.contentModel).addModel(this.dataValidationModel).addModel(this.styleDropdownModel).addModel(this.composedStyleCache).addModel(this.commentModel).addModel(this.noteModel).addModel(this.extralModel).addModel(this.reminderModel).addModel(this.sparklineModel).addModel(this.conditionalFormatStyleModel).addModel(this.conditionalFormatStyleRefModel),this.importer=this.composer.getImporter(),this.stringVarRefMap=new ZS}return(0,_.Z)(e,[{key:"addModels",value:function(e){var t=this;return e.forEach((function(e){return t.composer.addModel(e)})),this}},{key:"removeModels",value:function(e){return this.composer.removeModels(e),this}},{key:"sheet",value:function(){return this._sheet}},{key:"getRowCount",value:function(){return this.rowCount}},{key:"getColumnCount",value:function(){return this.colCount}},{key:"setDefaultNodeData",value:function(e){this._defaultDataNode=e}},{key:"setRowCount",value:function(e){this.rowCount=e}},{key:"setColumnCount",value:function(e){this.colCount=e}},{key:"getSegmentArray",value:function(e,t,r){return this.contentModel.getSegmentArray(e,t,r)}},{key:"getImmutableSegmentArray",value:function(e,t,r){return this.contentModel.getImmutableSegmentArray(e,t,r)}},{key:"getMultipleValues",value:function(e,t){return this.contentModel.getMultipleValues(e,t)}},{key:"getFormula",value:function(e,t,r,n){var a=this.contentModel.getVar(e,t,n);return a&&a.isFormula()?kp(a,r||{ref:a.getRef()}):""}},{key:"getFormulaData",value:function(e,t,r,n,a){var o=this.contentModel.getVar(e,t,n);if(o&&o.isFormula())return Tp(o,r||{ref:o.getRef()},a?RA:void 0)}},{key:"setVar",value:function(e,t,r,n,a){if(e<0||t<0||e>=this.rowCount||t>=this.colCount)this._sheet.parent.logger.warn("setVar outside, pos ".concat(e,",").concat(t,", sheet ").concat(this._sheet._id_,",").concat(this.rowCount,",").concat(this.colCount));else{var o,i;if(void 0===r&&(r=null),r&&"object"==(0,R.Z)(r)&&r._calcError&&(r=it.ERROR_VAR_MAP[r._calcError]||r._calcError),!(r instanceof it.BaseVar)&&null!==r)n&&(o=n.ctx,i=n.skipCompile),r=Jy(this._sheet,e,t,r,{skipFormulaCompile:i,formulaCompileCtx:o,stringVarRefMap:this.stringVarRefMap});var u=this.contentModel.getVar(e,t,!0);u&&u.isString()&&this.stringVarRefMap&&this.stringVarRefMap.del(u.getValue());var s=this._sheet.getCalcEngine().formulaSpace,l=null;if(_C(u,s),r){var c=this.getImmutableContent(e,t,!0);if(!(l=RC(this._sheet,e,t,r,c,s)))return}a?this.contentModel.setNodeValue(e,t,{variant:l,segmentArray:a.segmentArray,multipleValues:a.multipleValues}):null===a?l?(this.contentModel.setVariant(e,t,l),this.contentModel.setMultipleValues(e,t,null),this.contentModel.setSegmentArray(e,t,null)):this.contentModel.clear(e,t,1,1):this.contentModel.setVariant(e,t,l)}}},{key:"setSegmentArray",value:function(e,t,r){var n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.getImmutableContent(e,t);if(!(e<0||e>=this.rowCount||t<0||t>=this.colCount)){var o={segmentArray:r,multipleValues:(null==a?void 0:a.multipleValues)||null,variant:(null==a?void 0:a.variant)||null};if(!r||0===r.length)return this.contentModel.setNodeValue(e,t,o),void this.composedStyleCache.setRef(e,t,null);var i=new Og(this._sheet.parent,r);o.segmentArray=i.getSegmentArray();var u=i.getVar(this._sheet.parent.userLanguage),s=null===(n=u.getSpecialInfo())||void 0===n?void 0:n.link,l=u.isCustomPrimitive()&&"SheetImageVar"===u.customType;s||l?(o.variant=u,this.setVar(e,t,u,{skipCompile:!0},o)):this.setVar(e,t,i.getText(this._sheet.parent.userLanguage),{skipCompile:!0},o),this.composedStyleCache.setRef(e,t,null)}}},{key:"setMultipleValues",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.getImmutableContent(e,t);if(!(e<0||e>=this.rowCount||t<0||t>=this.colCount)){var a={multipleValues:r,segmentArray:(null==n?void 0:n.segmentArray)||null,variant:(null==n?void 0:n.variant)||null};if(!r||0===r.length)return _C(this.contentModel.getVar(e,t),this._sheet.getCalcEngine().formulaSpace),void this.contentModel.setNodeValue(e,t,a);var o=this._sheet.getUserFormatter(e,t)||null,i=r.mergeToSingleValue({formatter:o}),u=i.segmentArray,s=i.variant;u?this.setSegmentArray(e,t,u,a):s?this.setVar(e,t,s,{skipCompile:!0},a):this.contentModel.setNodeValue(e,t,a)}}},{key:"setVariant",value:function(e,t,r){e<0||e>=this.rowCount||t<0||t>=this.colCount||this.contentModel.setVariant(e,t,r)}},{key:"setNodeValue",value:function(e,t,r){this.contentModel.setNodeValue(e,t,r)}},{key:"getImmutableContent",value:function(e,t,r){return this.contentModel.getImmutableNode(e,t,r)}},{key:"setConditionalFormatStyle",value:function(e,t,r){r&&"object"==(0,R.Z)(r)?this.conditionalFormatStyleRefModel.setRef(e,t,r):this.conditionalFormatStyleRefModel.set(e,t,r)}},{key:"getConditionalFormatStyle",value:function(e,t){return this.conditionalFormatStyleRefModel.getRef(e,t)||null}},{key:"clearConditionalFormatStyle",value:function(e,t,r,n){this.conditionalFormatStyleRefModel.clear(e,t,r,n)}},{key:"getDefaultStyle",value:function(){return this.styleDropdownModel.getDefaultStyle()}},{key:"setDefaultStyle",value:function(e){return this.styleDropdownModel.setDefaultStyle(e)}},{key:"getStyle",value:function(e,t,r){if(-1===e&&-1===t)return this.getDefaultStyle();if(-1===e&&t>=0)return null;if(e>=0&&-1===t)return null;var n=this.composedStyleCache.getRef(e,t);if(!r&&n)return n;var a,o=this._sheet.getPivotTableManager(),i=o.hasPivotTableAtCell(e,t),u=this.getSegmentArray(e,t),s=this.styleDropdownModel.getStyle(e,t),l=this.getWordWrapValue(e,t),c=!s&&l===(null===(a=this.getDefaultStyle())||void 0===a?void 0:a.wordWrap);if(null===l||c||(s=Om.withUpdateStyle(s||this.getDefaultStyle(),{wordWrap:l})),!r&&i)return o.composePivotStyle(s,e,t);if(Array.isArray(u)&&u.length&&gR(u)){var h=pR(u,s,this._sheet).style;return this.composedStyleCache.setRef(e,t,h),h}return this.composedStyleCache.setRef(e,t,s),s}},{key:"getCellStyle",value:function(e,t,r){if(-1===e&&-1===t)return this.getDefaultStyle();if(-1===e&&t>=0)return null;if(e>=0&&-1===t)return null;var n,a=this._sheet.getPivotTableManager(),o=a.hasPivotTableAtCell(e,t),i=this.styleDropdownModel.getStyle(e,t),u=this.getWordWrapValue(e,t),s=!i&&u===(null===(n=this.getDefaultStyle())||void 0===n?void 0:n.wordWrap);return null===u||s||(i=Om.withUpdateStyle(i||this.getDefaultStyle(),{wordWrap:u})),!r&&o?a.composePivotStyle(i,e,t):i}},{key:"getStyleWithoutPartialStyle",value:function(e,t){return this.styleDropdownModel.getStyle(e,t)}},{key:"setStyle",value:function(e,t,r){if(-1===e&&-1===t)this.styleDropdownModel.setDefaultStyle(r);else{if(-1===e&&t>=0)return;if(e>=0&&-1===t)return;e>=0&&e<this.rowCount&&t>=0&&t<this.colCount&&this.styleDropdownModel.setStyle(e,t,r)}this.composedStyleCache.setRef(e,t,null)}},{key:"setStyleById",value:function(e,t,r){e<0||e>=this.rowCount||t<0||t>=this.colCount||(this.styleDropdownModel.setStyleById(e,t,r),this.composedStyleCache.setRef(e,t,null))}},{key:"setDataValidationById",value:function(e,t,r){e<0||e>=this.rowCount||t<0||t>=this.colCount||this.dataValidationModel.setById(e,t,r,!0)}},{key:"resetStyle",value:function(e,t){e<0||e>=this.rowCount||t<0||t>=this.colCount||(this.styleDropdownModel.setStyle(e,t,null),this.composedStyleCache.setRef(e,t,null))}},{key:"isEmpytComment",value:function(){return this.commentModel.isEmpty()}},{key:"getComment",value:function(e,t){return this.commentModel.get(e,t)}},{key:"setComment",value:function(e,t,r){this.commentModel.set(e,t,r)}},{key:"getCellNoteJSON",value:function(e,t){return this.noteModel.getCellNoteJSON(e,t)}},{key:"getCellNote",value:function(e,t){return this.noteModel.get(e,t)}},{key:"setCellNote",value:function(e,t,r){return this.noteModel.setNoteFromJSON(e,t,r)}},{key:"clearCellNote",value:function(e,t,r,n){return this.noteModel.clear(e,t,r,n)}},{key:"isEmpytDropdown",value:function(){return this.styleDropdownModel.isEmpty()}},{key:"getDataValidationId",value:function(e,t,r){var n=this._sheet.getPivotTableManager();return!r&&n.hasPivotTableAtCell(e,t)?null:this.dataValidationModel.get(e,t)}},{key:"getDataValidation",value:function(e,t,r){var n=this._sheet.getPivotTableManager();return!r&&n.hasPivotTableAtCell(e,t)?null:this.dataValidationModel.getRef(e,t)}},{key:"setDataValidation",value:function(e,t,r){e<0||e>=this.rowCount||t<0||t>=this.colCount||this.dataValidationModel.setRef(e,t,r)}},{key:"getValidationRefCount",value:function(){return this.dataValidationModel.getRefMgr().getRefCount()}},{key:"eachValidationRef",value:function(e){this.dataValidationModel.getRefMgr().foreach(e)}},{key:"getDropdown",value:function(e,t,r){var n=this._sheet.getPivotTableManager();return!r&&n.hasPivotTableAtCell(e,t)?null:this.styleDropdownModel.getDropdown(e,t)}},{key:"getStyleDropdownModel",value:function(){return this.styleDropdownModel}},{key:"getDataValidationModel",value:function(){return this.dataValidationModel}},{key:"setDropdown",value:function(e,t,r){if(!(e<0||e>=this.rowCount||t<0||t>=this.colCount))return null==r?this.styleDropdownModel.setDropdown(e,t,null):this.styleDropdownModel.setDropdown(e,t,r)}},{key:"removeDropdown",value:function(e,t){if(!(e<0||e>=this.rowCount||t<0||t>=this.colCount))return this.styleDropdownModel.setDropdown(e,t,null)}},{key:"findSameDataValidation",value:function(e){return this.dataValidationModel.getRefMgr().findSameRefs(e)}},{key:"updateReference",value:function(e,t,r){var n=OA(e,t,this._sheet);if(null!==n){if("dataValidation"===e)return this.updateReferenceCore(this.dataValidationModel.getRefMgr(),n,r,e);throw Error("[SHEET ERROR] Don't support ref model type: "+e)}}},{key:"updateReferenceCore",value:function(e,t,r,n){var a=e.findSameRefs(t),o=a.map((function(t){return e.getIdByRef(t)})).filter((function(e){return null!=e})),i=[];if("dataValidation"===n){var u=new ou(0,0,this._sheet.getRowCount(),this._sheet.getColumnCount(),this._sheet),s=new Set(a);i=d_.findRanges(s,this._sheet,{iterVisible:!1,range:u})}for(var l=0;l<o.length;l++){var c=OA(n,r,this._sheet);if(null===c)throw Error("[SHEET ERROR]  Can't instantiate a invalid new ref");e.addById(o[l],c,!1)}return i}},{key:"iterContent",value:function(e,t,r,n,a){return!a&&CT(this._sheet,e,t,r,n)?new VA(this._sheet,this.contentModel,e,t,e+r-1,t+n-1):this.contentModel.iter(e,t,r,n)}},{key:"iterContentWithPos",value:function(e,t,r,n,a){if(!a&&CT(this._sheet,e,t,r,n)){var o=new VA(this._sheet,this.contentModel,e,t,e+r-1,t+n-1);return o.map((function(e){return[e,o.position()]}))}return this.contentModel.iterWithPos(e,t,r,n)}},{key:"iterStyle",value:function(e,t,r,n){return CT(this._sheet,e,t,r,n)?new NA(this._sheet,this.styleDropdownModel,e,t,e+r-1,t+n-1):this.styleDropdownModel.iterStyle(e,t,r,n)}},{key:"iterStyleWithPos",value:function(e,t,r,n){if(CT(this._sheet,e,t,r,n)){var a=new NA(this._sheet,this.styleDropdownModel,e,t,e+r-1,t+n-1);return a.map((function(e){return[e,a.position()]}))}return this.styleDropdownModel.iterStyleWithPos(e,t,r,n)}},{key:"iterDropdown",value:function(e,t,r,n){return this.styleDropdownModel.iterDropdown(e,t,r,n)}},{key:"iterDropdownWithPos",value:function(e,t,r,n){return this.styleDropdownModel.iterDropdownWithPos(e,t,r,n)}},{key:"iterComment",value:function(e,t,r,n){return this.commentModel.iter(e,t,r,n)}},{key:"iterCommentWithPos",value:function(e,t,r,n){return this.commentModel.iterWithPos(e,t,r,n)}},{key:"iterNote",value:function(e,t,r,n){return this.noteModel.iter(e,t,r,n)}},{key:"iterNoteWithPos",value:function(e,t,r,n){return this.noteModel.iterWithPos(e,t,r,n)}},{key:"iterReminder",value:function(e,t,r,n){return this.reminderModel.iter(e,t,r,n)}},{key:"iterReminderWithPos",value:function(e,t,r,n){return this.reminderModel.iterWithPos(e,t,r,n)}},{key:"iterDataValidation",value:function(e,t,r,n){return this.dataValidationModel.iterRef(e,t,r,n)}},{key:"iterDataValidationWithPos",value:function(e,t,r,n){return this.dataValidationModel.iterRefWithPos(e,t,r,n)}},{key:"iterSegmentArrayWithPos",value:function(e,t,r,n){return this.contentModel.iterWithPos(e,t,r,n).filter((function(e){var t=(0,g.Z)(e,2),r=t[0];t[1];return null!==r.segmentArray}))}},{key:"iterSparklineWithPos",value:function(e,t,r,n){return this.sparklineModel.iterWithPos(e,t,r,n)}},{key:"getSparklineGroupByGroupId",value:function(e){return this.sparklineModel.getSparklineGroupByGroupId(e)}},{key:"getSparklineGroupBySparklineId",value:function(e){return this.sparklineModel.getSparklineGroupBySparklineId(e)}},{key:"getSparklineConfigByGroupId",value:function(e,t){return t?this.sparklineModel.getSparklineConfig(e):this.sparklineModel.getSparklineRawConfig(e)}},{key:"getSparklineById",value:function(e){return this.sparklineModel.getSparklineById(e)}},{key:"getSparklinesByGroupId",value:function(e){return this.sparklineModel.getSparklinesByGroupId(e)}},{key:"getSparklineByCell",value:function(e,t){return this.sparklineModel.getSparklineByCell(e,t)}},{key:"getComposer",value:function(){return this.composer}},{key:"getExtralValue",value:function(e,t,r){var n=this.extralModel.get(e,t);return n&&n[r]}},{key:"setExtralValue",value:function(e,t,r,n){var a=this.extralModel.get(e,t)||{};a&&a[r]!==n&&(a[r]=n),this.extralModel.set(e,t,a)}},{key:"removeExtralValue",value:function(e,t,r){var n=this.extralModel.get(e,t);n&&void 0!==n[r]&&delete n[r]}},{key:"clearExtralValue",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.extralModel.clear(e,t,r,n)}},{key:"setWordWrapValue",value:function(e,t,r){this.setExtralValue(e,t,CA,r),this.removeComposedStyleCache(e,t,1,1)}},{key:"getWordWrapValue",value:function(e,t){return this.getExtralValue(e,t,CA)}},{key:"removeWorkWrapValue",value:function(e,t,r,n){if(this.extralModel.getSize()){for(var a=e;a<r;a++)for(var o=t;o<n;o++)this.removeExtralValue(a,o,CA);this.removeComposedStyleCache(e,t,r-e+1,n-t+1)}}},{key:"hasContent",value:function(e,t){var r=this.getImmutableContent(e,t);return!(!r||(!r.variant||r.variant.isNull())&&!(r.segmentArray&&r.segmentArray.length>0)&&!(r.multipleValues&&r.multipleValues.length>0))}},{key:"hasMultipleValues",value:function(e,t){return!!this.contentModel.getMultipleValues(e,t)}},{key:"getVar",value:function(e,t,r){var n=this._sheet.getPivotTableManager(),a=n.getPivotTableNameByCell(e,t);if(r||!a){var o=this.contentModel.getMultipleValues(e,t);if(o)return this.getVarByMultipleValue(o,e,t);var i=this.contentModel.getVar(e,t,!0);if(i)return i;var u=this.contentModel.getImmutableSegmentArray(e,t);return u?new Og(this._sheet.parent,u).getVar(this._sheet.parent.userLanguage):it.NULL_VAR}var s=n.getCellValue(e,t),l=this._sheet.getCalcEngine().pivotCalculateEngine.getFormula(a),c=Ky(s)||it.NULL_VAR;return new lo(e,t,c,a,l)}},{key:"getVarByContent",value:function(e,t,r,n){var a=this._sheet.getPivotTableManager(),o=a.getPivotTableNameByCell(t,r);if(n||!o)return e?e.multipleValues?this.getVarByMultipleValue(e.multipleValues,t,r):this.getVarBySingleValue(e):it.NULL_VAR;var i=a.getCellValue(t,r),u=this._sheet.getCalcEngine().pivotCalculateEngine.getFormula(o),s=Ky(i)||it.NULL_VAR;return new lo(t,r,s,o,u)}},{key:"getVarByMultipleValue",value:function(e,t,r){if(e.length>1){var n=this._sheet.getUserFormatter(t,r)||null,a=e.mergeToString({formatter:n});return a&&""!==a?new it.StringVar(a):it.NULL_VAR}var o=e.getFirstItem();return this.getVarBySingleValue(o)}},{key:"getVarBySingleValue",value:function(e){return e.variant?e.variant:e.segmentArray?new Og(this._sheet.parent,e.segmentArray).getVar(this._sheet.parent.userLanguage):it.NULL_VAR}},{key:"removeComposedStyleCache",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.composedStyleCache.clear(e,t,r,n)}},{key:"getValue",value:function(e,t,r,n){var a=this.getVar(e,t,n);return a?(kA(a)&&(a.isInCorrectPosition(e,t)||(this.setVar(e,t,null),a=it.NULL_VAR)),a.getValue(r)):null}},{key:"isArrayFormula",value:function(e,t){return function(e){return!!e&&e instanceof Up}(this.getVar(e,t))}},{key:"isProxyArrayFormula",value:function(e,t,r){return kA(this.getVar(e,t,r))}},{key:"addRows",value:function(e,t){var r=wA(this);0<=e&&e<=r&&t>=0&&(this.rowCount+=t,this.composer.addRow(e,t,this.rowCount))}},{key:"deleteRows",value:function(e,t){var r=wA(this);0<=e&&e<r&&t>0&&(e+t>r&&(t=r-e),this.rowCount-=t,this.composer.delRow(e,t,this.rowCount))}},{key:"addColumns",value:function(e,t){var r=EA(this);0<=e&&e<=r&&t>=0&&(this.colCount+=t),this.composer.addCol(e,t)}},{key:"deleteColumns",value:function(e,t){var r=EA(this);0<=e&&e<r&&t>0&&(e+t>r&&(t=r-e),this.colCount-=t),this.composer.delCol(e,t)}},{key:"setReminderById",value:function(e,t){this.reminderModel.setReminderById(e,t)}},{key:"setReminder",value:function(e,t,r){this.reminderModel.set(e,t,r)}},{key:"getReminder",value:function(e,t){return this.reminderModel.get(e,t)}},{key:"getReminderCount",value:function(){return this.reminderModel.count()}},{key:"getAllReminders",value:function(){return Array.from(this.reminderModel.values())}},{key:"isEmptyReminder",value:function(){return this.reminderModel.isEmpty()}},{key:"isRowContentEmpty",value:function(e){return null==this.iterContent(e,0,1,this._sheet.getColumnCount()).next()}},{key:"isColContentEmpty",value:function(e){return null==this.iterContent(0,e,this._sheet.getRowCount(),1).next()}},{key:"iterCell",value:function(e,t,r,n){return this.iterContent(e,t,r,n)}},{key:"orderedIterCell",value:function(e,t,r,n){return this._sheet.getPivotTableManager().isIntersectPivotTable(e,t,r,n)?new VA(this._sheet,this.contentModel,e,t,e+r-1,t+n-1):this.contentModel.orderedIter(e,t,r,n)}},{key:"orderedIterCellWithPos",value:function(e,t,r,n){if(this._sheet.getPivotTableManager().isIntersectPivotTable(e,t,r,n)){var a=new VA(this._sheet,this.contentModel,e,t,e+r-1,t+n-1);return a.map((function(e){return[e,a.position()]}))}return this.contentModel.orderedIterWithPos(e,t,r,n)}},{key:"swapNode",value:function(e,t,r,n){return!(e*r<0||t*n<0||(t<0&&n<0?this.swapRow(e,r):e<0&&r<0?this.swapCol(t,n):this.swapCell(e,t,r,n),0))}},{key:"swapRow",value:function(e,t){this.composer.swapRow(e,t)}},{key:"swapCol",value:function(e,t){this.composer.swapCol(e,t)}},{key:"swapCell",value:function(e,t,r,n){this.composer.swapCell(e,t,r,n)}},{key:"getExporter",value:function(e,t,r,n){return this.composer.getExporter(e,t,r,n)}},{key:"genBlockTable",value:function(e,t){var r=[],n=Number.MAX_VALUE,a=0;return e.exportCells((function(e,t){var o=r[e];return o||(o=r[e]={columns:[]}),o=o.columns,e>a&&(a=e),e<n&&(n=e),o[t]?o[t]:o[t]={}}),t),a>=n?(r.splice(0,n),{startRowIndex:n,rowsCount:a-n+1,data:{rows:r}}):null}},{key:"serialize",value:function(){var e,t,r,n,a,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=o.gridRange,u=o.isForShortcut,s=o.gridOffset,l=o.customSheetId,c=l||this._sheet.id(),h={sheetId:c,startRow:null!==(e=null==i?void 0:i.startRow)&&void 0!==e?e:0,startCol:null!==(t=null==i?void 0:i.startCol)&&void 0!==t?t:0,endRow:null!==(r=null==i?void 0:i.endRow)&&void 0!==r?r:this.rowCount||xg,endCol:null!==(n=null==i?void 0:i.endCol)&&void 0!==n?n:this.colCount||xg},f=null!==(a=s)&&void 0!==a?a:{row:h.startRow,col:h.startCol},d=h.endRow-h.startRow,v=h.endCol-h.startCol,p=new Array(d),m=Object.assign({valueType:void 0,extendType:void 0,noteId:void 0,extendValueId:void 0,reminderId:void 0,dataValidationId:void 0,formulaId:void 0,styleId:void 0,valueId:void 0},u?{conditionalFormattingResultId:void 0,formulaSpecialInfoId:void 0}:{}),g={sheetId:c,startRow:xg,startCol:xg,endRow:-1,endCol:-1},y=new zS,_=y.cellRefs;y.isForShortcut=u;var R=new Array(d*v).fill(0),C=Object.assign({},m),w=Object.keys(m).filter((function(e){return"formulaId"!==e})),E=new WS(w);E.calcObjectHashValue(m,(function(){return _.push(m),0}));for(var k=this.composer.serialize(h.startRow,h.startCol,d,v,y),T=0,S=Math.max,A=Math.min,I=null;null!==(I=k.serializeCell(C,y));){var O=I.row,V=I.col;g.startRow=A(g.startRow,O),g.startCol=A(g.startCol,V),g.endRow=S(g.endRow,O+1),g.endCol=S(g.endCol,V+1);var N=0;void 0!==C.formulaId?(_.push(Object.assign({},C)),N=_.length-1):N=E.calcObjectHashValue(C,(function(){return _.push(Object.assign({},C)),_.length-1})),R[(O-h.startRow)*v+(V-h.startCol)]=N,0!==N&&T++,C.valueType=void 0,C.valueId=void 0,C.formulaId=void 0,C.extendType=void 0,C.extendValueId=void 0,C.styleId=void 0,C.dataValidationId=void 0,C.reminderId=void 0,C.noteId=void 0,u&&(C.conditionalFormattingResultId=void 0,C.formulaSpecialInfoId=void 0)}if(T<=0)return{mutation:{},recommendSplitRowIndex:-1};for(var b=Math.floor(d/2),M=0,F=0;F<p.length;F++){var Z=p[F]||0;if(M>=Math.floor(T/2)){b=F;break}M+=Z}return{mutation:GS(R,g,h,f,y),recommendSplitRowIndex:b+h.startRow}}},{key:"deserializeCell",value:function(e,t,r,n){void 0!==r.valueType&&this.deserializeCellContent(e,t,r,n),void 0!==r.reminderId&&this.deserializeReminder(e,t,r.reminderId,n),void 0!==r.dataValidationId&&this.deserializeDataValidation(e,t,r.dataValidationId,n),void 0!==r.styleId&&this.deserializeStyle(e,t,r.styleId,n),void 0!==r.noteId&&this.deserializeNote(e,t,r.noteId,n),void 0!==r.conditionalFormattingResultId&&this.deserializeConditionalFormattingResult(e,t,r.conditionalFormattingResultId,n)}},{key:"deserializeCellV1",value:function(e,t,r,n){var a,o,i,u,s;void 0!==(null===(a=r.value)||void 0===a?void 0:a.valueType)&&this.deserializeCellContent(e,t,r.value,n),void 0!==(null===(o=r.reminder)||void 0===o?void 0:o.reminderId)&&this.deserializeReminderV1(e,t,r.reminder.reminderId),void 0!==(null===(i=r.dataValidation)||void 0===i?void 0:i.dataValidationId)&&this.deserializeDataValidation(e,t,r.dataValidation.dataValidationId,n),void 0!==(null===(u=r.style)||void 0===u?void 0:u.styleId)&&this.deserializeStyle(e,t,r.style.styleId,n),void 0!==(null===(s=r.note)||void 0===s?void 0:s.noteId)&&this.deserializeNote(e,t,r.note.noteId,n)}},{key:"deserializeSegment",value:function(e,t,r){var n=null;switch(e){case Ce.B2l.CellValueType.CellValueType_EmbedImage:n=[this.contentModel.getImporter().deserializeEmbedImage(t,r)];break;case Ce.B2l.CellValueType.CellValueType_RichString:n=this.contentModel.getImporter().deserializeSegmentArray(t,r)}return n}},{key:"deserializeVariantNormal",value:function(e,t,r){var n=null;switch(e){case Ce.B2l.CellValueType.CellValueType_String:n=this.stringVarRefMap.add(r.strings[t]);break;case Ce.B2l.CellValueType.CellValueType_Number:n=new it.NumberVar(r.numbers[t]);break;case Ce.B2l.CellValueType.CellValueType_Bool:n=it.BOOLEAN_VAR_MAP[t?it.BooleanConstant.TRUE:it.BooleanConstant.FALSE];break;case Ce.B2l.CellValueType.CellValueType_Error:var a;if(null!==(a=r.errorValues)&&void 0!==a&&a.length){var o=r.errorValues[t];if(o){n=function(e){var t=e.message||e.args||e.errorTipsType?{message:e.message,args:e.args?JSON.parse(e.args):void 0,errorTipsType:e.errorTipsType}:void 0;return new it.ErrorVar(e.type,e.description,e.code,t)}(o);break}}var i=it.error2DescriptionMap[t];i&&(n=it.ERROR_VAR_MAP[i])}return n}},{key:"deserializeFormula",value:function(e,t,r,n,a){var o=a.valueRefDelta,i=a.cellValueRefHelper,u=null;switch(r){case Ce.B2l.CellValueType.CellValueType_Formula:var s=o.formulas[n],l=s.formulaDataId,c=s.formulaRefMapId,h=null!=l&&o.formulaDatas?o.formulaDatas[l]:{},f=null!=c&&o.formulaRefMaps?o.formulaRefMaps[c]:{};u=this.sheet().parent.calcEngine.deserializeFormula(h,new ou(e,t,1,1,this._sheet),{isGridJSON:!0},{formulaDataId:l,formulaRefMapId:c,cellValueRefHelper:i,refs:f.refs});break;case Ce.B2l.CellValueType.CellValueType_FormulaString:var d=o.formulaStrings[n],v="="===d[0]?"":"=";u=n_(this._sheet,e,t,v+d)}return u}},{key:"deserializeCellContent",value:function(e,t,r,n){var a=n.resourceRefDelta,o=r.valueType,i=r.valueId,u=this.deserializeVariantNormal(o,i,n.valueRefDelta);u||(u=this.deserializeFormula(e,t,o,i,n));var s=this.deserializeSegment(r.valueType,r.valueId,n);if(u||s){var l,c,h;if(!n.isApplySnapshot){var f=this.contentModel.getVar(e,t,!0);if(f)_C(f,this._sheet.getCalcEngine().formulaSpace),f.isString()&&this.stringVarRefMap.del(f.getValue())}try{var d=r.formulaSpecialInfoId;if(void 0!==d&&a.formulaSpecialInfoStrings){var v=a.formulaSpecialInfoStrings[d];if(v){var p,m=JSON.parse(v);null===(p=u)||void 0===p||p.setSpecialInfo(m)}}}catch(e){console.error(e)}var g=this.deserializeMultipleValues(r,n);if(null!==(l=u)&&void 0!==l&&l.isFormula()){var y=this._sheet.getCalcEngine(),_=y.formulaSpace,R=RC(this._sheet,e,t,u,null,_);R&&R.isFormula()&&(y.formulaRefService.cacheRange(R.formula,R.getRef()),u=R)}var C=new fC(s,u,g);this.contentModel.set(e,t,C),void 0!==r.formulaId&&u instanceof lv&&(null===(c=(h=this._sheet.parent).setFormulaCache)||void 0===c||c.call(h,u,this._sheet,r.formulaId))}}},{key:"deserializeMultipleValues",value:function(e,t){var r=this;if(e.extendType!==Ce.B2l.CellExtendType.CellExtendType_Select)return null;var n=t.valueRefDelta,a=t.resourceRefDelta,o=t.formatDelta,i=new l_(this.sheet().parent),u=a.selectedMultipleValues?a.selectedMultipleValues[e.extendValueId]:void 0;if(!u){var s;if(null!==(s=a.extendValues)&&void 0!==s&&s.length){var l=a.extendValues[e.extendValueId];i.fromJSON(JSON.parse(l))}return i}var c=u.selectedValueIds,h=u.selectedAutoFormats,f=u.selectedIds,d=u.selectedTypeList,v=function(e){return n.strings[e]},p=function(e){var t=o.numberFormats[h[e]].formatCode;return t?(0,Ee.createFormatter)(r._sheet.formatterService,t):void 0};if(f)for(var m=0;m<f.length;m++){var g=f[m],y=d[m],_=this.deserializeVariantNormal(y,g,n)||void 0,R=this.deserializeSegment(y,g,t)||void 0,C=p(m);i.add({variant:_,autoFormatter:C,segmentArray:R})}else if(c)for(var w=0;w<c.length;w++){var E=v(c[w]),k=p(w);i.addByTextNoSplit(E,k)}return i}},{key:"deserializeReminder",value:function(e,t,r,n){var a,o=n.resourceRefDelta;if(null!==(a=o.reminderIds)&&void 0!==a&&a.length){var i=o.reminderIds[r],u=this.reminderModel.getReminderById(i);u&&this.reminderModel.set(e,t,u)}}},{key:"deserializeReminderV1",value:function(e,t,r){var n=this.reminderModel.getReminderById(r);n&&this.reminderModel.set(e,t,n)}},{key:"deserializeDataValidation",value:function(e,t,r,n){var a,o=this,i=n.resourceRefDelta,u=n.cellValueRefHelper;(null===(a=i.dataValidations)||void 0===a?void 0:a.length)&&u.dataValidations.checkValuesRefId(r,(function(r){o.dataValidationModel.setById(e,t,r,!1)}),(function(){var a=L_(i.dataValidations[r],n,o.sheet());if(a){var u=Ey(a,o.sheet());if(u)return o.dataValidationModel.setRef(e,t,u)}}))}},{key:"deserializeStyle",value:function(e,t,r,n){var a=this,o=n.cellFormatRefHelper,i=n.formatDelta;o.cellFormats.checkValuesRefId(r,(function(r){a.styleDropdownModel.setById(e,t,r,!1)}),(function(){var n,o,u,s=ZR(function(e,t){var r=e.cellFormats[t];return{numFmt:e.numberFormats&&e.numberFormats[r.numFmtId],autoNumFmt:e.numberFormats&&e.numberFormats[r.autoNumFmtId],font:e.fonts&&e.fonts[r.fontId],fill:e.fills&&e.fills[r.fillId],border:e.borders&&e.borders[r.borderId],alignment:e.alignments&&e.alignments[r.alignmentId],otherFmt:e.hideLinks&&e.hideLinks[r.hideLinkId]}}(i,r)),l=a.sheet().parent,c=l.formatterService,h=null===(n=l.defaults)||void 0===n?void 0:n.defaultStyle;!h&&(null===(o=l.defaults)||void 0===o?void 0:o.style)&&((h=Om.fromJSON(c,null===(u=l.defaults)||void 0===u?void 0:u.style,Mm())).setDefault(h),l.defaults.defaultStyle=h);var f=Om.fromJSON(c,s,h),d=a.styleDropdownModel.getStyleRefMgr().add(f).id;return a.styleDropdownModel.setRef(e,t,{style:d})}))}},{key:"deserializeNote",value:function(e,t,r,n){var a,o,i,u=null===(a=n.resourceRefDelta.notes)||void 0===a?void 0:a[r];if(u){var s=this.getNoteValue(u,n);s&&this.setCellNote(e,t,{value:s,width:(null===(o=u.frameSize)||void 0===o?void 0:o.w)||0,height:(null===(i=u.frameSize)||void 0===i?void 0:i.h)||0})}}},{key:"getNoteValue",value:function(e,t){return e.valueType===Ce.B2l.NoteValueType.NoteValueType_RichString?this.contentModel.getImporter().deserializeSegmentArray(e.valueId,t):null}},{key:"getRowLength",value:function(e){return this.contentModel.getRowLength(e)}},{key:"deserializeConditionalFormattingResult",value:function(e,t,r,n){this.conditionalFormatStyleRefModel.deserializeCell(e,t,r,n)}},{key:"serializeExtraInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.composer.serializeToMutations(0,0,this.rowCount||xg,this.colCount||xg,e,t)}},{key:"toJSON",value:function(e,t,r){var n={},a={},o=this.composer.getExporter(0,0,this.rowCount||xg,this.colCount||xg);o.exportCells((function(e,t){var r=a[e];return r||(r=a[e]={}),r[t]?r[t]:r[t]={}})),o.exportExtraInfo(t),yA(a)||(n.dataTable=a);var i=this.getDefaultStyle().toJSON(),u={};return void 0!==i&&(u.style=i),n.defaultDataNode=u,t.data=n,t}},{key:"fromJSON",value:function(e,t){var r,n=this;if("object"==(0,R.Z)(e)){this._dirtySuspended++,_A(e.name)||(this.name=e.name);var a=this._sheet.parent.formulaCacheManager,o=e.data&&e.data.formulaCacheTable||e.formulaCacheTable;o&&(null!=a&&a.setSheetManager(this._sheet.id()),null!=a&&a.loadFormulaCacheBlock(this._sheet.id(),o)),this.importer.importExtraInfo(e,t);var i,u,s=e.data&&e.data.dataTable||e.dataTable,l=wA(this),c=EA(this);if(s)for(var h=0;h<l;h++)if(i=s[h])for(var f=0;f<c;f++)(u=i[f])&&this.importer.importCell(h,f,u);var d,v,p=null==e||null===(r=e.data)||void 0===r?void 0:r.dataTableBlockInfos;p&&p.forEach((function(e){for(var t=e.table,r=e.startRowIndex,a=0,o=t.rows.length;a<o;a++)if((d=t.rows[a])&&d.columns){v=r+a;for(var i=0,s=d.columns.length;i<s;i++)(u=d.columns[i])&&n.importer.importCell(v,i,u)}}));var m=e.data&&e.data.defaultDataNode;if(m&&m.style){var g=Om.fromJSON(this._sheet.parent.formatterService,m.style);this.setDefaultStyle(g)}this._dirtySuspended--}}},{key:"getName",value:function(){return this.name}},{key:"getStringVarRefMap",value:function(){return this.stringVarRefMap}}]),e}();function SA(e,t,r,n,a){var o=t.sheet().parent;if(o){var i=o.logger;i&&r>=t.getRowCount()&&(i.warn("set rowCount ".concat(t.getRowCount()," to row ").concat(r+1)),t.setRowCount(r+1)),i&&n>=t.getColumnCount()&&(i.warn("set colCount ".concat(t.getColumnCount()," to col ").concat(n+1," ")),t.setColumnCount(n+1)),t.importer.importCell(r,n,e,a)}}function AA(e,t,r,n){var a=t.calcEngine.reactivitySpace;a.ignoreDirty(!0);var o,i,u,s,l,c,h,f,d=r.rows;for(o=0,i=d.length;o<i;o++)if(l=d[o])for(f=o+n,c=l.columns,u=0,s=l.columns.length;u<s;u++)(h=c[u])&&SA(h,e,f,u,!1);a.ignoreDirty(!1)}function IA(e,t,r,n){var a=n.token,o=n.split,i=n.onRowDataApplied,u=r.id?r.id():"",s=r.parent;if(s&&u){var l=s.fiberTaskScheduler,c=s.getCalcEngine().reactivitySpace;if(o){var h=_t.ArrayIter.fromArray(Object.keys(e)).do(d);l.add(u,h),l.run()}else for(var f in e)d(f)}function d(r){var n=Number(r);c.ignoreDirty(!0),function(e,t,r,n){for(var a in e){var o=Number(a);SA(e[a],r,t,o,!1)}}(e[r],n,t),c.ignoreDirty(!1),i&&i(r,a)}}function OA(e,t,r){return"dataValidation"===e?Ey(t,r):null}var VA=function(e){function t(e,r,n,a,o,i){var u;return(0,y.Z)(this,t),(u=(0,d.Z)(this,(0,v.Z)(t).call(this)))._sheet=e,u.model=r,u.rowTo=o,u.colTo=i,u.innerIter=new ns(n,a,o-n+1,i-a+1),u}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getPivotTableToken",value:function(){return this._sheet.getPivotTableManager().getPivotTableNameByCell(this.row,this.col)}},{key:"hasPivotTableContent",value:function(){return this._sheet.getPivotTableManager().hasPivotTableAtCell(this.row,this.col)}},{key:"getPivotTableContent",value:function(){return this._sheet.getPivotTableManager().getCellValue(this.row,this.col)}},{key:"next",value:function(){if(!this.isValid())return null;for(var e=null;null===e;){if(!this.iter())return null;for(var t=this.getPivotTableToken(),r=this.model.get(this.row,this.col);;){if(!this.isValid())return null;if(t||r)break;this.iter(),t=this.getPivotTableToken(),r=this.model.get(this.row,this.col)}if(t){var n=this.getPivotTableContent(),a=this._sheet.getCalcEngine().pivotCalculateEngine.getFormula(t),o=Ky(n)||it.NULL_VAR;e=new fC(null,new lo(this.row,this.col,o,t,a),null)}else r&&(e=r)}return e}},{key:"iter",value:function(){return this.innerIter.next()}},{key:"position",value:function(){return this.innerIter.position()}},{key:"isValid",value:function(){return this.row<=this.rowTo&&this.col<=this.colTo}},{key:"row",get:function(){return this.innerIter.cellPosition.row}},{key:"col",get:function(){return this.innerIter.cellPosition.col}},{key:"cellPosition",get:function(){return this.innerIter.cellPosition}}]),t}(_t.FIterator),NA=function(e){function t(e,r,n,a,o,i){var u;return(0,y.Z)(this,t),(u=(0,d.Z)(this,(0,v.Z)(t).call(this)))._sheet=e,u.table=r,u.rowFrom=n,u.colFrom=a,u.rowTo=o,u.colTo=i,u.innerIter=new ns(n,a,o-n+1,i-a+1),u}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"hasPivotTable",value:function(){return this._sheet.getPivotTableManager().hasPivotTableAtCell(this.row,this.col)}},{key:"getPivotTableStyle",value:function(){return this._sheet.getPivotTableManager().getCellStyle(this.row,this.col)}},{key:"next",value:function(){if(!this.isValid())return null;for(var e=null;null===e;){if(!this.iter())return null;for(var t=this.hasPivotTable(),r=this.table.getStyle(this.row,this.col);;){if(!this.isValid())return null;if(t||r)break;this.iter(),t=this.hasPivotTable(),r=this.table.getStyle(this.row,this.col)}t?e=this._sheet.getPivotTableManager().composePivotStyle(r,this.row,this.col):r&&(e=r)}return e}},{key:"iter",value:function(){return this.innerIter.next()}},{key:"isValid",value:function(){return this.row<=this.rowTo&&this.col<=this.colTo}},{key:"position",value:function(){return this.innerIter.position()}},{key:"row",get:function(){return this.innerIter.cellPosition.row}},{key:"col",get:function(){return this.innerIter.cellPosition.col}},{key:"cellPosition",get:function(){return this.innerIter.cellPosition}}]),t}(_t.FIterator);function bA(e,t,r){var n=e.getPivotTableManager().getPivotInfoByName(t);return null==n?void 0:n[r]}function MA(e){for(var t=e.sheets,r=0,n=0;n<t.length;n++)r+=Object.keys(t[n].embeddedBlocksModel.getBlocksMap()).length;return r}var FA,ZA,xA=function(e,t){return"".concat(e,"-").concat(t,"-").concat((0,Ft.Ki)())},DA=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this)))._sheet=e,r._lastNonNullColumn=-1,r._lastNonNullRow=-1,r.rowCache=new Map,r.rowSet=new Map,r.colSet=new Map,r.pivotSpans=new Map,Object.setPrototypeOf((0,c.Z)(r),t.prototype),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"_onSpanAdded",value:function(e,t){this._lastNonNullRow=Math.max(this._lastNonNullRow,e.rowTo()),this._lastNonNullColumn=Math.max(this._lastNonNullColumn,e.colTo());var r=e.rowFrom(),n=e.colFrom(),a=e.rowTo(!0),o=e.colTo(!0);this.setCache(r,n,e);for(var i=r;i<=a;i++){var u=this.rowSet.get(i);u||(u=new Set,this.rowSet.set(i,u)),u.add(e)}for(var s=n;s<=o;s++){var l=this.colSet.get(s);l||(l=new Set,this.colSet.set(s,l)),l.add(e)}t&&this.pivotSpans.set(e,!0)}},{key:"getCache",value:function(e,t){var r=this.rowCache.get(e);return r?r.get(t):null}},{key:"setCache",value:function(e,t,r){this.rowCache.has(e)||this.rowCache.set(e,new Map),this.rowCache.get(e).set(t,r)}},{key:"deleteCache",value:function(e,t){var r=this.rowCache.get(e);r&&(r.delete(t),0===r.size&&this.rowCache.delete(e))}},{key:"_onSpanRemoved",value:function(e){var t=e.rowFrom(),r=e.colFrom(),n=e.rowTo(!0),a=e.colTo(!0);this.deleteCache(t,r),this._sheet.dispatch("SpanRemoved",e);for(var o=t;o<=n;o++){var i=this.rowSet.get(o);i&&(i.delete(e),0===i.size&&this.rowSet.delete(o))}for(var u=r;u<=a;u++){var s=this.colSet.get(u);s&&(s.delete(e),0===s.size&&this.colSet.delete(u))}}},{key:"toArray",value:function(e){var t=this,r=[];return this.forEach((function(e){return r.push(e)})),e?r.filter((function(e){return!t.pivotSpans.has(e)})):r}},{key:"find",value:function(e,t){var r=this.getCache(e,t);if(r)return r;var n=this.rowSet.get(e),a=this.colSet.get(t);if(!n||!a)return null;for(var o=(n.size<a.size?n:a).entries(),i=o.next();i.value;i=o.next()){var u=i.value[0];if(u.containCell(e,t))return u}return null}},{key:"get",value:function(e,t){return this.find(e,t)||new ou(e,t,1,1,this._sheet)}},{key:"remove",value:function(e){var t=this.indexOf(e);t>=0&&this.removeSpan(t,1)}},{key:"update",value:function(e,t){this._onSpanRemoved(this[e]),this[e]=t,this._onSpanAdded(t)}},{key:"addSpan",value:function(e,t){1===e.rowCount(!0)&&1===e.colCount(!0)||this.pivotSpans.has(e)||(this._onSpanAdded(e,t),this.push(e))}},{key:"removeSpan",value:function(e,t){for(var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=0,a=0;a<Math.min(this.length-e,t)&&n<t;a++){var o=this[e+a];o&&(r&&this.pivotSpans.has(o)||(this._onSpanRemoved(o),this.splice(e+a,1),this.pivotSpans.delete(o),a--,n++))}return n}},{key:"removePivotRange",value:function(e){for(var t=this.length-1;t>=0;t--)this[t].equal(e)&&this.removeSpan(t,1,!1)}},{key:"copy",value:function(e,t,r,n,a,o){for(var i=this,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{copyMoveMode:0},s=u.copyMoveMode,l=u.ignoredRows,c=this.length,h=[],f=Boolean(4&s&&l),d=f?l.size:0,v=f?Ov(l,this._sheet):[],p=function(u){var s=i[u],p=s.colFrom(),g=s.rowFrom();if((-1===e||e<=g&&g<e+a)&&(-1===t||t<=p&&p<t+o)){var y=r+g-e,_=n+p-t,R=s.rowCount(),C=s.colCount();if(f){var w,E=yr(l);try{for(E.s();!(w=E.n()).done;){var k=w.value;if(k<=y)++y;else if(y<k&&k<=y+R-1);else if(y+R-1<k)break}}catch(e){E.e(e)}finally{E.f()}}h.push(new ou(y,_,R,C,i._sheet))}else(-1===e||r<=g&&g<r+a+d)&&(-1===t||n<=p&&p<n+o)&&v.every((function(e){return!e.contain(s)}))&&(i.removeSpan(u,1),u--,c--);m=u},m=0;m<c;m++)p(m);for(var g=0;g<h.length;g++){var y=h[g];if(!this.isValid(this.slice(0),0,this.length,y,!0))throw Ce.PnZ.fromCode(Ce.XFC.APPLY_FAIL_SPAN_CONFLICT);this.addSpan(y)}}},{key:"isValid",value:function(e,t,r,n){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=t;o<r&&o<e.length;o++)if(e[o].isIntersect(n)){try{a&&console.error("CellRange Error: from=".concat(JSON.stringify(e[o].toJSON()),",\n            to=").concat(JSON.stringify(n.toJSON())))}catch(e){}return Ce.Ps3.collectSuiteEvent("sheet_add_span_model_invalid"),!1}return!0}},{key:"each",value:function(e,t,r,n,a){for(var o=0,i=this.length;o<i;o++){if(e>=0||t>=0)for(;o<i&&!this[o].isIntersect(new ou(e,t,r,n,this._sheet));)o++;if(o<i&&a&&!1===a(this[o]))break}}},{key:"getSpans",value:function(e,t){var r=this;if(!e)return this.slice(0);var n=this.getIntersectSpansInfo(e.rowFrom(),e.colFrom(),e.rowCount(),e.colCount()),a=[];return n.containedSpans.forEach((function(e){t&&r.pivotSpans.has(e)||a.push(e)})),n.hasPartSpans.forEach((function(e){t&&r.pivotSpans.has(e)||a.push(e)})),a}},{key:"getSpansByRow",value:function(e){var t=this.rowSet.get(e);return t?Array.from(t):[]}},{key:"getSpansByCol",value:function(e){var t=this.colSet.get(e);return t?Array.from(t):[]}},{key:"hasPartSpans",value:function(e,t,r,n,a){return this.getIntersectSpansInfo(e,t,r,n,a).hasPartSpans.size>0}},{key:"getIntersectSpansInfo",value:function(e,t,r,n,a){if(this.length<=r&&this.length<=n)return this.getIntersectSpansInfoByIterAll(e,t,r,n,a);var o=this.getCacheListArray(this.rowSet,e,r),i=this.getCacheListArray(this.colSet,t,n);return this.getListArrayTotalCount(o)<this.getListArrayTotalCount(i)?this.getIntersectSpansInfoByCache(o,e,t,r,n,a):this.getIntersectSpansInfoByCache(i,e,t,r,n,a)}},{key:"getCacheListArray",value:function(e,t,r){for(var n=[],a=t;a<t+r;a++){var o=e.get(a);o&&n.push(o)}return n}},{key:"getListArrayTotalCount",value:function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r].size;return t}},{key:"getIntersectSpansInfoByIterAll",value:function(e,t,r,n,a){for(var o=new Set,i=new Set,u=new ou(e,t,r,n,this._sheet),s=0;s<this.length;s++){var l=this[s];a&&this.pivotSpans.has(l)||l.isIntersect(u)&&(-1!==e&&(l.rowFrom()<e||l.rowFrom()+l.rowCount()>e+r)||-1!==t&&(l.colFrom()<t||l.colFrom()+l.colCount()>t+n)?i.add(l):o.add(l))}return{containedSpans:o,hasPartSpans:i}}},{key:"getIntersectSpansInfoByCache",value:function(e,t,r,n,a,o){for(var i=new Set,u=new Set,s=new ou(t,r,n,a,this._sheet),l=0;l<e.length;l++)for(var c=e[l].entries(),h=c.next();h.value;h=c.next()){var f=h.value[0];o&&this.pivotSpans.has(f.id())||f.isIntersect(s)&&(-1!==t&&(f.rowFrom()<t||f.rowFrom()+f.rowCount()>t+n)||-1!==r&&(f.colFrom()<r||f.colFrom()+f.colCount()>r+a)?u.add(f):i.add(f))}return{containedSpans:i,hasPartSpans:u}}},{key:"hasSpans",value:function(e,t,r,n){var a=!1;return this.each(e,t,r,n,(function(){return a=!0,!1})),a}},{key:"clearAll",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=0,n=0;n<this.length;n++){var a=this[n],o=e.contain(a),i=e.intersect(a);!o&&!i||t&&this.pivotSpans.has(a)?(this[r]=this[n],r++):(this._onSpanRemoved(a),this.pivotSpans.delete(a))}var u=this.length-r;return this.length=r,u}},{key:"clear",value:function(e,t,r,n){for(var a=0;a<this.length;a++){var o=this[a],i=o.rowFrom(),u=o.colFrom();(-1===e||e<=i&&i<e+r)&&(-1===t||t<=u&&u<t+n)&&this.removeSpan(a,1)>0&&a--}}},{key:"move",value:function(e,r,n,a,o,i){for(var u=this,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{copyMoveMode:0},l=s.copyMoveMode,c=s.ignoredRows,h=!1,f=!1,d=new t(this._sheet),v=[],p=this.length,m=Boolean(4&l&&c),g=m?c.size:0,y=m?Ov(c,this._sheet):[],_=function(t){var s=u[t],l=s.rowFrom(),p=s.colFrom(),_=u._sheet.getPivotTableManager(),R=null==_?void 0:_.getPivotTableNameByCell(l,p);if(!bA(u._sheet,R,"isCopy")&&!u.pivotSpans.has(s))if((-1===e||e<=l&&l<e+o)&&(-1===r||r<=p&&p<r+i)){var C=n+l-e,w=a+p-r,E=s.rowCount(),k=s.colCount();if(m){var T,S=yr(c);try{for(S.s();!(T=S.n()).done;){var A=T.value;if(A<=C)++C;else if(C<A&&A<=C+E-1);else if(C+E-1<A)break}}catch(e){S.e(e)}finally{S.f()}}var I=new ou(C,w,E,k,u._sheet);v.push(I),h=!0}else(-1===e||n<=l&&l<n+o+g)&&(-1===r||a<=p&&p<a+i)&&y.every((function(e){return!e.contain(s)}))?f=!0:d.push(s)},R=0;R<p;R++)_(R);if(f&&this.clear(n,a,o,i),h){if(v.length>0)for(var C=0;C<v.length;C++){var w=v[C];if(!this.isValid(d.slice(0),0,d.length,w,!0))throw Ce.PnZ.fromCode(Ce.XFC.MOVE_RANGE_CONFLICT_SPAN)}this.clear(e,r,o,i);for(var E=0;E<v.length;E++)this.addSpan(v[E])}}},{key:"isEmpty",value:function(){return this.length<=0}},{key:"isPivotSpan",value:function(e){return this.pivotSpans.has(e)}},{key:"addRows",value:function(e,t){for(var r=this,n=[],a=this.length-1;a>=0;--a){var o=this[a];this.pivotSpans.has(o)||(o.rowFrom()>=e?(this.removeSpan(a,1),n.push(o.offset(t,0))):e<=o.rowTo()&&(this.removeSpan(a,1),n.push(new ou(o.rowFrom(),o.colFrom(),o.rowCount()+t,o.colCount(),this._sheet))))}n.forEach((function(e){return r.addSpan(e)}))}},{key:"addColumns",value:function(e,t){for(var r=this,n=[],a=this.length-1;a>=0;--a){var o=this[a];this.pivotSpans.has(o)||(o.colFrom()>=e?(this.removeSpan(a,1),n.push(o.offset(0,t))):o.colFrom()<e&&e<=o.colTo()&&(this.removeSpan(a,1),n.push(new ou(o.rowFrom(),o.colFrom(),o.rowCount(),o.colCount()+t,this._sheet))))}n.forEach((function(e){return r.addSpan(e)}))}},{key:"removeRows",value:function(e,t){for(var r=this,n=[],a=this.length-1;a>=0;--a){var o=this[a];if(!this.pivotSpans.has(o)){var i={row:o.rowFrom(),col:o.colFrom(),rowCount:o.rowCount(!0),colCount:o.colCount(!0)},u=e,s=e+t;this.removeSpan(a,1),s<=i.row?i.row-=t:u<i.row?(i.row-=i.row-u,i.rowCount-=s-i.row-1):u<i.row+i.rowCount&&(i.rowCount-=Math.min(i.row+i.rowCount-u,t));var l=new ou(i.row,i.col,i.rowCount,i.colCount,this._sheet);this.isLegalSpan(l)&&n.push(l)}}n.forEach((function(e){return r.addSpan(e)}))}},{key:"removeColumns",value:function(e,t){for(var r=this,n=[],a=this.length-1;a>=0;--a){var o=this[a];if(!this.pivotSpans.has(o)){var i={row:o.rowFrom(),col:o.colFrom(),rowCount:o.rowCount(!0),colCount:o.colCount(!0)},u=e,s=e+t;this.removeSpan(a,1),s<=i.col?i.col-=t:u<i.col?(i.col-=i.col-u,i.colCount-=s-i.col-1):u<i.col+i.colCount&&(i.colCount-=Math.min(i.col+i.colCount-u,t));var l=new ou(i.row,i.col,i.rowCount,i.colCount,this._sheet);this.isLegalSpan(l)&&n.push(l)}}n.forEach((function(e){return r.addSpan(e)}))}},{key:"isLegalSpan",value:function(e){return e.rowCount()*e.colCount()>1}},{key:"toJSON",value:function(){var e=this.toArray(!0).map((function(e){return e.toJSON()}));return 0===e.length?void 0:e}},{key:"fromJSON",value:function(e){if(e){this.length=0;for(var t=0;t<e.length;t++){var r=e[t];this.addSpan(new ou(r.row,r.col,r.rowCount,r.colCount,this._sheet))}}}},{key:"iter",value:function(e,t,r,n,a){return new PA(e,t,r,n,this,this._sheet,a)}}]),t}((0,a.Z)(Array)),PA=function(e){function t(e,r,n,a,o,i,u){var s;return(0,y.Z)(this,t),(s=(0,d.Z)(this,(0,v.Z)(t).call(this))).spanModel=o,s.sheet=i,s.ignorePivot=u,s.i=-1,s.length=0,s.length=s.spanModel.length,s.target=new ou(e,r,n-e+1,a-r+1,s.sheet),s}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"next",value:function(){for(this.i++;this.i<this.length;){var e=this.spanModel[this.i];if(this.ignorePivot&&this.spanModel.isPivotSpan(e))this.i++;else{if(e.isIntersect(this.target))return e;this.i++}}return null}}]),t}(_t.FIterator),$A=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this)))._sheet=e,r.activeSelectedRangeIndex=-1,Object.setPrototypeOf((0,c.Z)(r),t.prototype),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"find",value:function(e,r){var n=this;return(0,f.Z)((0,v.Z)(t.prototype),"find",this).call(this,(function(t){return t.contain(new ou(e,r,1,1,n._sheet))}))||null}},{key:"clear",value:function(){this.splice(0,this.length),this.activeSelectedRangeIndex=-1}},{key:"add",value:function(e){this.push(e),this.activeSelectedRangeIndex=this.length-1}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"fromArray",value:function(e){var t=this;this.clear(),e.forEach((function(e){return t.add(e)}))}},{key:"toJSON",value:function(){if(this.length){var e={length:this.length};return 0!==this.activeSelectedRangeIndex&&(e.activeSelectedRangeIndex=this.activeSelectedRangeIndex),this.forEach((function(t,r){e[r]=t.toJSON()})),e}}},{key:"fromJSON",value:function(e,t){this.clear();for(var r=e.length||1,n=0;n<r;n++){var a=e[n];a?this.add(new ou(a.row,a.col,a.rowCount,a.colCount,t)):this.add(new ou(0,0,1,1,t))}this.activeSelectedRangeIndex=e.activeSelectedRangeIndex||0}},{key:"_isColumnSelected",value:function(e){return this.some((function(t){var r=t.sheet();return!!(r&&t.rowCount()===r.getRowCount()&&e>=t.colFrom()&&e<=t.colTo())}))}},{key:"_isRowSelected",value:function(e){return this.some((function(t){var r=t.sheet();return!!(r&&t.colCount()===r.getColumnCount()&&e>=t.rowFrom()&&e<=t.rowTo())}))}}]),t}((0,a.Z)(Array)),LA=1e4,BA=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120;(0,y.Z)(this,e),this.axisModel=t,this.blockSize=r,this.posMap=new Ce.z6B(LA),this.blockDistanceMap=new Ce.z6B(LA),this._lastPosInfo={pos:0,distance:0},this._stackLevel=0,this._maxPos=0,this._maxDistance=0}return(0,_.Z)(e,[{key:"getDistance",value:function(e){if(e<=0)return 0;e>this.axisModel.length&&(e=this.axisModel.length);var t=this.posMap.get(e,!1);if(null!=t)return t;var r=0,n=0;this._lastPosInfo.pos<e&&(r=this._lastPosInfo.pos,n=this._lastPosInfo.distance);for(var a=this.axisModel.iter(r,e),o=null,i=a.next();null!==i;i=a.next())(o=i).value&&o.count&&(n+=o.value*o.count);return null!==o&&o.index+o.count>e&&(n-=(o.index+o.count-e)*o.value),this._lastPosInfo.pos=e,this._lastPosInfo.distance=n,this._updateMaxPos(e),this.posMap.set(e,n),n}},{key:"getPos",value:function(e){if(e<=0)return{pos:0,offset:0};var t=this.axisModel.length;if(!isFinite(e))return{pos:t-1,offset:0};var r=Math.floor(e/this.blockSize),n=e%this.blockSize,a=this.blockSize*r,o=this.blockDistanceMap.get(a,!1);if(this._stackLevel<200)if(o){if(0===n)return o}else this._stackLevel++,a=0===n?this.blockSize*(r-1):a,o=this.getPos(a);else a=0,o={pos:0,offset:0};for(var i=a-o.offset,u={pos:o.pos,offset:o.offset},s=o.pos,l=this.axisModel.iter(s,this.axisModel.length),c=l.next();null!==c&&i<e;c=l.next()){var h=c.value*c.count;if(i+h>=e){var f=Math.floor((e-i)/c.value);u.pos+=f,i+=f*c.value,u.offset=e-i;break}u.pos+=c.count,u.offset=0,i+=h}return 0===n&&(this.blockDistanceMap.set(e,u),this._updateMaxDistance(e)),u.pos=Math.min(u.pos,t-1),this._stackLevel=0,u}},{key:"clear",value:function(){this.posMap.clear(),this.blockDistanceMap.clear(),this._lastPosInfo={pos:0,distance:0},this._maxDistance=0,this._maxPos=0}},{key:"clearFrom",value:function(e){if(0!==e){if(this._maxPos>=e){for(;this._maxPos>=e;)this.posMap.remove(this._maxPos),this._maxPos--;this._lastPosInfo.pos=this._maxPos,this._lastPosInfo.distance=this.getDistance(this._maxPos)}for(var t=this.getDistance(e-1);this._maxDistance>t;)this.blockDistanceMap.remove(this._maxDistance),this._maxDistance-=this.blockSize}else this.clear()}},{key:"_updateMaxPos",value:function(e){this._maxPos<e&&(this._maxPos=e)}},{key:"_updateMaxDistance",value:function(e){this._maxDistance<e&&(this._maxDistance=e)}}]),e}();!function(e){e[e.RED=0]="RED",e[e.BLACK=1]="BLACK"}(FA||(FA={}));var UA=function e(){(0,y.Z)(this,e)},HA=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"left",value:function(e){return null!==e?e.left:null}},{key:"right",value:function(e){return null!==e?e.right:null}},{key:"parent",value:function(e){return null!==e?e.parent:null}},{key:"setLeft",value:function(e,t){return null!==e?(e.left=t,e.left):null}},{key:"setRight",value:function(e,t){return null!==e?(e.right=t,e.right):null}},{key:"setParent",value:function(e,t){return null!==e?(e.parent=t,e.parent):null}},{key:"color",value:function(e){return null!==e?e.color:null}},{key:"setColor",value:function(e,t){return null!==e?(e.color=t,e.color):null}},{key:"reset",value:function(e,t,r,n,a){this.setLeft(e,t),this.setRight(e,r),this.setParent(e,n),void 0!==a&&this.setColor(e,a)}},{key:"isRoot",value:function(e){return this.color(e)===FA.BLACK&&this.parent(this.parent(e))===e}},{key:"isHeader",value:function(e){return this.color(e)===FA.RED&&this.parent(this.parent(e))===e}},{key:"root",value:function(e){for(;!this.isRoot(e);)e=this.parent(e);return e}},{key:"header",value:function(e){for(;!this.isHeader(e);)e=this.parent(e);return e}},{key:"leftMostChild",value:function(e){for(;this.left(e);)e=this.left(e);return e}},{key:"rightMostChild",value:function(e){for(;this.right(e);)e=this.right(e);return e}},{key:"next",value:function(e){if(this.isHeader(e))return this.left(e);if(this.right(e))return this.leftMostChild(this.right(e));for(var t=this.parent(e);e===this.right(t);)e=t,t=this.parent(e);return this.right(e)===t?e:t}},{key:"prev",value:function(e){if(this.isHeader(e))return this.right(e);if(this.left(e))return this.rightMostChild(this.left(e));for(var t=this.parent(e);e===this.left(t);)e=t,t=this.parent(e);return this.left(e)===t?e:t}},{key:"deep",value:function(e,t){for(var r=0;t?e!==t:!this.isHeader(e);e=this.parent(e))r+=1;return r}},{key:"rotateLeft",value:function(e,t){var r=this.right(t),n=this.left(r);this.setRight(t,n),n&&this.setParent(n,t);var a=this.parent(t);this.setParent(r,a),a===e?this.setParent(e,r):this.left(a)===t?this.setLeft(a,r):this.setRight(a,r),this.setLeft(r,t),this.setParent(t,r)}},{key:"rotateRight",value:function(e,t){var r=this.left(t),n=this.right(r);this.setLeft(t,n),n&&this.setParent(n,t);var a=this.parent(t);this.setParent(r,a),a===e?this.setParent(e,r):this.left(a)===t?this.setLeft(a,r):this.setRight(a,r),this.setRight(r,t),this.setParent(t,r)}},{key:"insertFixUp",value:function(e,t){for(;t!==this.parent(e)&&this.color(this.parent(t))===FA.RED;){var r=this.parent(t),n=this.parent(r);if(this.left(n)===r){var a=this.right(n);if(!a||this.color(a)!==FA.RED){if(t===this.right(r)){this.rotateLeft(e,r);var o=t;t=r,r=o}this.setColor(r,FA.BLACK),this.setColor(n,FA.RED),this.rotateRight(e,n);break}this.setColor(r,FA.BLACK),this.setColor(a,FA.BLACK),this.setColor(n,FA.RED),t=n}else{var i=this.left(n);if(!i||this.color(i)!==FA.RED){if(t===this.left(r)){this.rotateRight(e,r);var u=t;t=r,r=u}this.setColor(r,FA.BLACK),this.setColor(n,FA.RED),this.rotateLeft(e,n);break}this.setColor(r,FA.BLACK),this.setColor(i,FA.BLACK),this.setColor(n,FA.RED),t=n}}this.color(this.parent(e))===FA.RED&&this.setColor(this.parent(e),FA.BLACK)}},{key:"eraseSwap",value:function(e,t){var r=this.leftMostChild(this.right(t)),n=this.parent(t),a=this.left(t),o=this.right(r);if(r===this.right(t))this.setParent(t,r),this.setRight(r,t);else{var i=this.right(t),u=this.parent(r);this.setParent(t,u),this.setRight(r,i),this.setParent(i,r),this.setLeft(u,t)}this.setLeft(t,null),this.setRight(t,o),this.setParent(r,n),this.setLeft(r,a),this.setParent(a,r),o&&this.setParent(o,t),n===e?this.setParent(n,r):this.left(n)===t?this.setLeft(n,r):this.setRight(n,r);var s=this.color(t);this.setColor(t,this.color(r)),this.setColor(r,s)}},{key:"eraseFixUp",value:function(e,t){for(;t!==this.parent(e);){if(this.color(t)===FA.RED){this.setColor(t,FA.BLACK);break}var r=this.parent(t);if(this.left(r)===t){var n=this.right(r);this.color(n)===FA.RED&&(this.rotateLeft(e,r),this.setColor(r,FA.RED),this.setColor(n,FA.BLACK),n=this.right(r));var a=this.right(n);if(!a||this.color(a)===FA.BLACK){var o=this.left(n);if(!o||this.color(o)===FA.BLACK){this.setColor(n,FA.RED),t=r;continue}this.rotateRight(e,n),this.setColor(n,FA.RED),this.setColor(o,FA.BLACK),n=this.right(r),a=this.right(n)}this.rotateLeft(e,r),this.setColor(n,this.color(r)),this.setColor(r,FA.BLACK),this.setColor(a,FA.BLACK);break}var i=this.left(r);this.color(i)===FA.RED&&(this.rotateRight(e,r),this.setColor(r,FA.RED),this.setColor(i,FA.BLACK),i=this.left(r));var u=this.left(i);if(!u||this.color(u)===FA.BLACK){var s=this.right(i);if(!s||this.color(s)===FA.BLACK){this.setColor(i,FA.RED),t=r;continue}this.rotateLeft(e,i),this.setColor(i,FA.RED),this.setColor(s,FA.BLACK),i=this.left(r),u=this.left(i)}this.rotateRight(e,r),this.setColor(i,this.color(r)),this.setColor(r,FA.BLACK),this.setColor(u,FA.BLACK);break}}},{key:"eraseCut",value:function(e,t){var r=this.left(t);r||(r=this.right(t));var n=this.parent(t);r&&this.setParent(r,n),n===e?r?(this.setParent(e,r),this.color(r)===FA.RED&&this.setColor(r,FA.BLACK)):this.setParent(e,e):this.left(n)===t?this.setLeft(n,r):this.setRight(n,r),this.left(e)===t&&(this.right(t)?this.setLeft(e,this.leftMostChild(this.right(t))):this.setLeft(e,this.parent(t))),this.right(e)===t&&(this.left(t)?this.setRight(e,this.rightMostChild(this.left(t))):this.setRight(e,this.parent(t)))}},{key:"insert",value:function(e,t,r){if(t===e)(t=this.right(e))===e?this.reset(e,r,r,r):(this.setRight(t,r),this.setRight(e,r));else if(this.left(t)){for(t=this.left(t);this.right(t);)t=this.right(t);this.setRight(t,r)}else this.setLeft(t,r),t===this.left(e)&&this.setLeft(e,r);return this.reset(r,null,null,t,FA.RED),this.insertFixUp(e,r),r}},{key:"insertToRight",value:function(e,t,r){if(t===e)(t=this.left(e))===e?this.reset(e,r,r,r):(this.setLeft(t,r),this.setLeft(e,r));else if(this.right(t)){for(t=this.right(t);this.left(t);)t=this.left(t);this.setLeft(t,r)}else this.setRight(t,r),t===this.right(e)&&this.setRight(e,r);return this.reset(r,null,null,t,FA.RED),this.insertFixUp(e,r),r}},{key:"insertRoot",value:function(e,t){return this.reset(e,t,t,t),this.reset(t,null,null,e,FA.BLACK),t}},{key:"insertLeft",value:function(e,t,r){return this.setLeft(t,r),t===this.left(e)&&this.setLeft(e,r),this.reset(r,null,null,t,FA.RED),this.insertFixUp(e,r),r}},{key:"insertRight",value:function(e,t,r){return this.setRight(t,r),t===this.right(e)&&this.setRight(e,r),this.reset(r,null,null,t,FA.RED),this.insertFixUp(e,r),r}},{key:"erase",value:function(e,t){return this.left(t)&&this.right(t)&&this.eraseSwap(e,t),this.eraseFixUp(e,t),this.eraseCut(e,t),t}}]),e}(),zA=function(){function e(t,r){(0,y.Z)(this,e),this.node=t,this._policy=r}return(0,_.Z)(e,[{key:"next",value:function(){return this.node=this._policy.next(this.node),this}},{key:"postNext",value:function(){var e=this.copy();return this.next(),e}},{key:"prev",value:function(){return this.node=this._policy.prev(this.node),this}},{key:"postPrev",value:function(){var e=this.copy();return this.prev(),e}},{key:"equal",value:function(e){return this.node===e.getNode()}},{key:"getNode",value:function(){return this.node}}]),e}(),WA=function(){function e(t){(0,y.Z)(this,e),this._header=t,this.resetHeader()}return(0,_.Z)(e,[{key:"resetHeader",value:function(){var e=this.header();this.policy().reset(e,e,e,e,FA.RED)}},{key:"policy",value:function(){return this._policy||(this._policy=new HA),this._policy}},{key:"header",value:function(){return this._header}},{key:"root",value:function(){return this.policy().parent(this.header())}},{key:"leftMost",value:function(){return this.policy().left(this.header())}},{key:"rightMost",value:function(){return this.policy().right(this.header())}},{key:"insert",value:function(e,t){return this.policy().insert(this.header(),e,t)}},{key:"erase",value:function(e){return this.policy().erase(this.header(),e)}},{key:"deep",value:function(e){return this.policy().deep(this.header(),e)}}]),e}();!function(e){e[e.Outer=0]="Outer",e[e.Inner=1]="Inner"}(ZA||(ZA={}));var GA=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),t}(UA),jA=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).posPolicy=ZA.Outer,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"off",value:function(e){return null!==e?e.off:0}},{key:"setOff",value:function(e,t){return null!==e?(e.off=t,e.off):0}},{key:"data",value:function(e){return null!==e?e.data:null}},{key:"setData",value:function(e,t){return null!==e?(e.data=t,e.data):null}},{key:"cmpPos",value:function(e,t){return this.posPolicy===ZA.Outer?t>=e:this.posPolicy===ZA.Inner&&e<t}},{key:"findInsertPos",value:function(e,t){var r=this.parent(e);if(r===e)return{node:r,pos:t};for(var n=e;r;)if(this.off(r)<t)t-=this.off(r),r=this.right(r);else{if(!(t<this.off(r)))return{node:null,pos:t};n=r,r=this.left(r)}return{node:n,pos:t}}},{key:"position",value:function(e,t){for(var r=e,n=this.off(r),a=this.parent(r);a!==t;a=this.parent(a))this.right(a)===r&&(n+=this.off(a)),r=a;return n}},{key:"findOuter",value:function(e,t){var r=this.parent(e);if(r===e)return e;for(var n=t,a=e;r;)this.cmpPos(this.off(r),n)?(n-=this.off(r),r=this.right(r)):(a=r,r=this.left(r));return a}},{key:"findInner",value:function(e,t){var r=this.parent(e);if(r===e)return e;for(var n=t,a=e;r;)this.cmpPos(this.off(r),n)?(n-=this.off(r),a=r,r=this.right(r)):r=this.left(r);return a}},{key:"insertSpace",value:function(e,t,r){var n=this.parent(e);if(n!==e)for(var a=t;n;)this.cmpPos(this.off(n),a)?(a-=this.off(n),n=this.right(n)):(this.setOff(n,this.off(n)+r),n=this.left(n))}},{key:"eraseSpace",value:function(e,t,r){var n=this.parent(e);if(n!==e)for(var a=t;n;)this.cmpPos(this.off(n),a)?(a-=this.off(n),n=this.right(n)):(this.setOff(n,this.off(n)-r),n=this.left(n))}},{key:"rotateLeft",value:function(e,r){var n=this.right(r);this.setOff(n,this.off(n)+this.off(r)),(0,f.Z)((0,v.Z)(t.prototype),"rotateLeft",this).call(this,e,r)}},{key:"rotateRight",value:function(e,r){var n=this.left(r);this.setOff(r,this.off(r)-this.off(n)),(0,f.Z)((0,v.Z)(t.prototype),"rotateRight",this).call(this,e,r)}},{key:"eraseSwap",value:function(e,r){for(var n=this.right(r);this.left(n);)n=this.left(n);var a=this.off(n);this.setOff(n,this.off(r)+a),this.setOff(r,0);for(var o=this.parent(n);o!==r;o=this.parent(o))this.setOff(o,this.off(o)-a);(0,f.Z)((0,v.Z)(t.prototype),"eraseSwap",this).call(this,e,r)}},{key:"eraseCut",value:function(e,r){if(this.right(r))for(var n=this.off(r),a=this.right(r);a;a=this.left(a))this.setOff(a,this.off(a)+n);(0,f.Z)((0,v.Z)(t.prototype),"eraseCut",this).call(this,e,r)}}]),t}(HA),YA=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"copy",value:function(){return new t(this.node,this._policy)}},{key:"data",value:function(){return this._policy.data(this.node)}},{key:"setData",value:function(e){this._policy.setData(this.node,e)}}]),t}(zA),qA=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e)))._header=e,n.posPolicy=r,n.resetHeader(),n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"resetHeader",value:function(){var e=this.header();return this.policy().setOff(e,0),(0,f.Z)((0,v.Z)(t.prototype),"resetHeader",this).call(this)}},{key:"policy",value:function(){return this._policy||(this._policy=new jA),this._policy.posPolicy=this.posPolicy,this._policy}},{key:"doEraseSpace",value:function(e,t){for(var r=this,n=[],a=this.policy().findOuter(this.header(),e),o=this.policy().findOuter(this.header(),e+t);a!==o;)a&&n.push(a),a=this.policy().next(a);var i=[];return n.forEach((function(e){var t=r.position(e);r.policy().erase(r.header(),e),r.policy().setOff(e,t),r.policy().reset(e,null,null,null),i.push({pos:t,data:e.data})})),this.policy().eraseSpace(this.header(),e,t),i}},{key:"allocNode",value:function(e,t){var r=new GA;return this.policy().setOff(r,e),this.policy().setData(r,t),r}},{key:"insertFloat",value:function(e,t){var r=this.policy().findInsertPos(this.header(),e);if(r.node){var n=this.allocNode(r.pos,t);return this.policy().insert(this.header(),r.node,n),new YA(n,this.policy())}return this.end()}},{key:"insertSpace",value:function(e,t){this.policy().insertSpace(this.header(),e,t)}},{key:"eraseSpace",value:function(e,t,r){var n=this.doEraseSpace(e,t);r&&r(n)}},{key:"eraseFloat",value:function(e){this.policy().erase(this.header(),e.getNode())}},{key:"position",value:function(e){return e instanceof YA?this.policy().position(e.getNode(),this.header()):e instanceof GA?this.policy().position(e,this.header()):-1}},{key:"findOuter",value:function(e){return new YA(this.policy().findOuter(this.header(),e),this.policy())}},{key:"findInner",value:function(e){return new YA(this.policy().findInner(this.header(),e),this.policy())}},{key:"setDefaultData",value:function(e){return this.policy().setData(this.header(),e)}},{key:"begin",value:function(){return new YA(this.leftMost(),this.policy())}},{key:"end",value:function(){return new YA(this.header(),this.policy())}},{key:"rbegin",value:function(){return new YA(this.rightMost(),this.policy())}}]),t}(WA),JA=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ZA.Outer;return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,new GA,e))}return(0,p.Z)(t,e),t}(qA),KA=function(e){function t(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4?arguments[4]:void 0;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).axisDataTree=e,r.from=n,r.to=a,r.isReverse=o,r.baseIterKey=i,r.isReverse?(r.outerIter=r.axisDataTree.findOuter(a),r.innerIter=r.axisDataTree.findInner(a)):(r.outerIter=r.axisDataTree.findOuter(n),r.innerIter=r.axisDataTree.findInner(n)),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"next",value:function(){return this.isReverse?this.backward():this.forward()}},{key:"backward",value:function(){if(this.currOuterPos()<=this.from)return null;var e=this.data();if(this.outerIter.postPrev(),this.innerIter.postPrev(),this.baseIterKey)for(var t=this.data();e&&t&&e.value[this.baseIterKey]===t.value[this.baseIterKey];)e.count+=t.count,this.outerIter.postPrev(),this.innerIter.postPrev(),t=this.data();return e}},{key:"forward",value:function(){if(this.currInnerPos()>this.to)return null;var e=this.data();if(this.outerIter.postNext(),this.innerIter.postNext(),this.baseIterKey)for(var t=this.data();e&&t&&e.value[this.baseIterKey]===t.value[this.baseIterKey];)e.count+=t.count,this.outerIter.postNext(),this.innerIter.postNext(),t=this.data();return e}},{key:"data",value:function(){var e=this.currOuterPos(),t=this.currInnerPos(),r=this.currOuterData();if(!r)return null;var n={value:this.baseIterKey?(0,l.Z)({},this.baseIterKey,r[this.baseIterKey]):r,index:t,count:e-t};return this.isInRange(this.from,t,e)&&(n.index=this.from,n.count=e-this.from),this.isInRange(this.to,t,e)&&(n.count=this.to-n.index+1),this.isReverse&&(n.index=n.index+n.count-1),n}},{key:"currOuterPos",value:function(){return this.axisDataTree.position(this.outerIter)}},{key:"currInnerPos",value:function(){return this.axisDataTree.position(this.innerIter)}},{key:"currOuterData",value:function(){return this.outerIter.data()}},{key:"isInRange",value:function(e,t,r){return e<r&&e>=t}}]),t}(_t.FIterator);function XA(e,t,r,n){if(!(r>=n)){var a=r+n>>1,o=t[a],i=o.endIndex,u=o.info,s=e.rbegin();i===e.position(s)?s.setData(u):e.insertFloat(i,u),XA(e,t,r,a),XA(e,t,a+1,n)}}function QA(e,t){var r,n=[],a=0,o=yr(e);try{for(o.s();!(r=o.n()).done;){var i=r.value;i.startIndex>a&&n.push({startIndex:a,endIndex:i.startIndex,info:{}}),n.push(i),a=i.endIndex}}catch(e){o.e(e)}finally{o.f()}return a<t&&n.push({startIndex:a,endIndex:t,info:{}}),n}function eI(e,t){if(e===t)return!0;var r,n=yr(new Set([].concat((0,m.Z)(Object.keys(e)),(0,m.Z)(Object.keys(t)))));try{for(n.s();!(r=n.n()).done;){var a=r.value;if(e[a]!==t[a])return!1}}catch(e){n.e(e)}finally{n.f()}return!0}var tI=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return null},a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:120;(0,y.Z)(this,e),this.getDefaultSize=t,this.length=r,this.forceSetSize=n,this.cacheBlockSize=a,this._autoSizeChangeHandlers=[],this.forceAutoFitSize=!1,this.axisDistance=new BA(this,this.cacheBlockSize),this.axisDataTree=new JA,this.setItems([],this.length)}return(0,_.Z)(e,[{key:"addItems",value:function(e,t){this.axisDataTree.insertSpace(e,t),this.axisDataTree.insertFloat(e,this.getInfo(e)),this.axisDataTree.insertFloat(e+t,{}),this.length+=t,this.clearCache()}},{key:"deleteItems",value:function(e,t){var r=this,n=Math.min(t,this.length-e);n<=0||(this.axisDataTree.eraseSpace(e,n,(function(t){t.length>0&&r.axisDataTree.insertFloat(e,t[0].data)})),this.length-=n,this.clearCache())}},{key:"clearCache",value:function(){this.axisDistance.clear()}},{key:"updateCache",value:function(e){this.axisDistance.clearFrom(e)}},{key:"toJSON",value:function(){for(var e=new Array(this.length),t=this.axisDataTree.begin(),r=this.axisDataTree.end(),n=0;t&&!t.equal(r);){var a=this.axisDataTree.position(t),o=(0,te.Z)(t.data());null==o||delete o.excluded,null==o||delete o.autoFitSize;var i=o&&0===Object.keys(o).length?null:o;e.fill(i,n,a),n=a,t.next()}return e.every((function(e){return null===e}))?[]:e}},{key:"serialize",value:function(e,t){for(var r=this.axisDataTree.begin(),n=this.axisDataTree.end(),a=0;r&&!r.equal(n);){var o=this.axisDataTree.position(r),i={customSize:void 0,hidden:void 0};aI(r.data(),i,t),void 0===i.customSize&&void 0===i.hidden&&void 0===i.formId||e.push({range:{start:a,end:o},info:i}),a=o,r.next()}}},{key:"deserialize",value:function(e){this.clearCache(),this.clearAxisTree();var t=e.map((function(e){var t=e.info,r=e.range;return{info:nI(t)||{},startIndex:(null==r?void 0:r.start)||0,endIndex:(null==r?void 0:r.end)||0}}));t=QA(t,this.length),XA(this.axisDataTree,t,0,t.length)}},{key:"setItems",value:function(e,t){this.clearCache(),this.clearAxisTree(),this.length=t;var r=function(e,t){for(var r=[],n=0;n<e.length;n++){var a=e[n];if(a){var o=r[r.length-1];o&&eI(a,o.info)&&o.endIndex===n?o.endIndex+=1:r.push({startIndex:n,endIndex:n+1,info:a})}}return QA(r,t)}(e,t);XA(this.axisDataTree,r,0,r.length)}},{key:"getRawSize",value:function(e){var t;return null===(t=this.getInfo(e))||void 0===t?void 0:t.fixedSize}},{key:"getSize",value:function(e){var t=this.forceSetSize(e);if(null!==t)return t;if(e<0||e>=this.length)return 0;var r=this.getInfo(e);return this.getSizeFromInfo(r)}},{key:"getActualSize",value:function(e){var t=this.getInfo(e);return t&&void 0!==t.fixedSize?Math.floor(t.fixedSize):0}},{key:"updateExcluded",value:function(e){var t=this;this.resetAllExcluded(),this.mergeConsecutiveNumbers(e).forEach((function(e){var r=e.start,n=e.count;t.setExcluded(r,!0,n)}))}},{key:"setExcluded",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;r>1?this.batchSetAxisData(e,r,(function(e){return Object.assign({},e,{excluded:t})})):this.setAxisData(e,t,"excluded")}},{key:"setSize",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.updateCache(e),n>1)this.batchSetAxisData(e,n,(function(e){return r.getNewSizeInfo(e,t)}));else{var a=this.getInfo(e),o=this.getNewSizeInfo(a,t);this.setAxisData(e,o)}}},{key:"swap",value:function(e,t){var r=this.getInfo(e),n=this.getInfo(t);this.setItem(t,r),this.setItem(e,n)}},{key:"onAutoSizeChange",value:function(e){this._autoSizeChangeHandlers.push(e)}},{key:"setAutoFitSize",value:function(e,t){var r=this.getSize(e),n=this.getInfo(e);this.setAxisData(e,t,"autoFitSize");var a={after:t};return n&&(a.before=n.autoFitSize),r!==t&&a.before!==a.after&&this._autoSizeChangeHandlers.forEach((function(t){return t(e,a)})),r!==t&&0!==r&&(this.updateCache(e),!0)}},{key:"getVisible",value:function(e){return this.getVisibleFromInfo(this.getInfo(e))}},{key:"getFId",value:function(e){var t,r,n=null===(t=this.getInfo(e))||void 0===t?void 0:t.fId;return null!==n&&(r=n),r}},{key:"setVisible",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.updateCache(e),r>1?this.batchSetAxisData(e,r,(function(e){return Object.assign({},e,{visible:t})})):this.setAxisData(e,t,"visible")}},{key:"setFId",value:function(e,t){this.setAxisData(e,t,"fId"),this.updateCache(e)}},{key:"getRowColIndexByFId",value:function(e){for(var t=this.axisDataTree.begin(),r=this.axisDataTree.end();t&&!t.equal(r);){var n;if((null===(n=t.data())||void 0===n?void 0:n.fId)===e)return this.axisDataTree.position(t)-1;t.next()}return-1}},{key:"iter",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e=Math.max(0,e),t=Math.min(this.length-1,t),new KA(this.axisDataTree,e,t,n).map((function(e){var t;return{value:null!==(t=e.value)&&void 0!==t&&t.excluded?0:r.getSizeFromInfo(e.value),index:e.index,count:e.count}}))}},{key:"iterVisible",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return e=Math.max(0,e),t=Math.min(this.length-1,t),new KA(this.axisDataTree,e,t,n,"visible").map((function(e){return{value:r.getVisibleFromInfo(e.value),index:e.index,count:e.count}}))}},{key:"iterHidden",value:function(){var e=this;return new KA(this.axisDataTree,0,this.length-1).filter((function(t){return!e.getVisibleFromInfo(t.value)}))}},{key:"iterActualVisible",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.iter(e,t,r).filter((function(e){return!!e.value}))}},{key:"iterActualHidden",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.iter(e,t,r).filter((function(e){return!e.value}))}},{key:"iterContinuousActualVisible",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new rI(this.iterActualVisible(e,t,r))}},{key:"firstVisible",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.iter(e,t,r).first_if((function(e){return!!e.value}))}},{key:"iterEachActualVisible",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.iterActualVisible(e,t,r).map((function(e){return new ng(e,r)})).flatten()}},{key:"getDistance",value:function(e,t){var r=this.axisDistance.getDistance(e);return this.axisDistance.getDistance(t)-r}},{key:"getPos",value:function(e,t){var r=this.axisDistance.getDistance(e);return this.axisDistance.getPos(r+t).pos}},{key:"clearAxisTree",value:function(){var e=this.axisDataTree.rbegin(),t=this.axisDataTree.position(e);this.axisDataTree.eraseSpace(0,t)}},{key:"getNewSizeInfo",value:function(e,t){var r=Object.assign({},e);return 0===t?delete r.fixedSize:r.fixedSize=t,r}},{key:"setAxisData",value:function(e,t,r){var n=this.axisDataTree.findOuter(e),a=n.data(),o=r?Object.assign({},a,(0,l.Z)({},r,t)):t;a&&eI(o,a)||(this.handleStart(e,a),this.handleEnd(e,n,o))}},{key:"handleStart",value:function(e,t){var r=this.axisDataTree.findInner(e);e!==this.axisDataTree.position(r)&&this.axisDataTree.insertFloat(e,t)}},{key:"handleEnd",value:function(e,t,r){var n=e+1;n!==this.axisDataTree.position(t)?t=this.axisDataTree.insertFloat(n,r):t.setData(r),this.mergeAdjacent(t)}},{key:"batchSetAxisData",value:function(e,t,r){var n=e+t-1,a=n+1,o=this.getInfo(e),i=this.axisDataTree.findOuter(e),u=this.axisDataTree.position(i),s=this.axisDataTree.findOuter(n);if(this.handleStart(e,o),a>u)for(;i&&!i.equal(s);){var l=r(i.data());i.setData(l),this.mergePrev(i),i.next()}var c=r(s.data());this.handleEnd(n,i,c)}},{key:"mergeConsecutiveNumbers",value:function(e){var t=[];if(0===e.size)return t;for(var r=Array.from(e).sort((function(e,t){return e-t})),n=r[0],a=1,o=1;o<r.length;o++)r[o]===r[o-1]+1?a++:(t.push({start:n,count:a}),n=r[o],a=1);return t.push({start:n,count:a}),t}},{key:"resetAllExcluded",value:function(){for(var e=this.axisDataTree.begin(),t=this.axisDataTree.end();e&&!e.equal(t);){var r=e.data();null!=r&&r.excluded&&(null==r||delete r.excluded,e.setData(r),this.mergePrev(e)),e.next()}this.clearCache()}},{key:"mergeAdjacent",value:function(e){this.mergePrev(e),this.mergeNext(e)}},{key:"mergePrev",value:function(e){var t=e.data(),r=e.copy().prev(),n=r.data();return!(!n||!eI(t,n)||(this.axisDataTree.eraseFloat(r),0))}},{key:"mergeNext",value:function(e){var t=e.data(),r=e.copy().next().data();return!!(t&&r&&eI(t,r))&&(this.axisDataTree.eraseFloat(e),!0)}},{key:"setItem",value:function(e,t){this.setAxisData(e,t),this.updateCache(e)}},{key:"getInfo",value:function(e){var t=this.axisDataTree.findOuter(e).data();if(this.forceAutoFitSize&&void 0!==(null==t?void 0:t.fixedSize)){var r=(0,te.Z)(t);return delete r.fixedSize,r}return t}},{key:"getSizeFromInfo",value:function(e){return e?!1===e.visible?0:void 0===e.fixedSize||this.forceAutoFitSize?void 0!==e.autoFitSize?Math.floor(e.autoFitSize):this.getDefaultSize():Math.floor(e.fixedSize):this.getDefaultSize()}},{key:"getVisibleFromInfo",value:function(e){var t=null==e?void 0:e.visible,r=!0;return null!=t&&(r=t),r}},{key:"setForceAutoFitSize",value:function(e){this.forceAutoFitSize=e,this.clearCache()}}]),e}(),rI=function(e){function t(e){var r;(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this)))._iter=e,r._curr=null,r._info=null,r._isFirst=!0;var n=r._iter.next();return n&&(r._curr={index:n.index,count:n.count}),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"value",value:function(){return this._isFirst?(this._isFirst=!1,this.next()):this._info?this._info:null}},{key:"next",value:function(){if(!this._curr)return null;this._isFirst&&(this._isFirst=!1);var e,t=this._curr;for(e=this._iter.next();e&&e.index===t.index+t.count;e=this._iter.next())t.count+=e.count;return this._curr=e?{index:e.index,count:e.count}:null,this._info=t,this.value()}}]),t}(_t.FIterator);function nI(e){if(!e)return null;var t={fixedSize:void 0,visible:void 0};return null!=e.customSize&&(t.fixedSize=e.customSize),null!=e.hidden&&(t.visible=!e.hidden),null!=e.formId&&(t.fId=e.formId),t}function aI(e,t,r){if(!e)return!1;var n=!1;return void 0!==e.fixedSize&&(t.customSize=e.fixedSize,n=!0),r&&void 0!==e.autoFitSize&&void 0===e.fixedSize&&(t.customSize=e.autoFitSize,n=!0),!1===e.visible&&(t.hidden=!e.visible,n=!0),void 0!==e.fId&&(t.formId=e.fId,n=!0),n}var oI,iI=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"next",value:function(){return null}}]),t}(_t.FIterator),uI=function(){function e(t){(0,y.Z)(this,e),this.sheet=t,this.rowAxisModel=this.sheet._getRowInfos(),this.colAxisModel=this.sheet._getColInfos(),this.sheetModel=this.sheet._getModel(),this.spanModel=this.sheet._getSpanModel()}return(0,_.Z)(e,[{key:"iterVisibleRange",value:function(e,t,r,n,a){var o,i=this;return a&&a.visibleRange?_t.FIterator.fromArray(a.visibleRange):this.rowAxisModel.iterContinuousActualVisible(e,r).map((function(e){return o?_t.FIterator.fromArray(o).map((function(t){return new ou(e.index,t.index,e.count,t.count,i.sheet)})):(o=[],i.colAxisModel.iterContinuousActualVisible(t,n).map((function(t){return o.push(t),new ou(e.index,t.index,e.count,t.count,i.sheet)})))})).flatten()}},{key:"iterVisibleCell",value:function(e,t,r,n,a){return a&&a.visibleCell?_t.FIterator.fromArray(a.visibleCell):this.iterVisibleRange(e,t,r,n,a).map((function(e){return new sI(e)})).flatten()}},{key:"iterVisibleSpan",value:function(e,t,r,n,a){var o=this;if(a&&a.visibleSpan)return _t.FIterator.fromArray(a.visibleSpan);var i=new Yd;return this.iterVisibleRange(e,t,r,n,a).map((function(e){return o.spanModel.iter(e.rowFrom(),e.colFrom(),e.rowTo(),e.colTo())})).flatten().map((function(e){return{row:e.rowFrom(),col:e.colFrom()}})).filter((function(e){var t=e.row,r=e.col;return!i.has(t,r)&&(i.add(t,r),!0)}))}},{key:"iterVisibleSpanIntersectRange",value:function(e,t,r,n,a){var o=this;return this.spanModel.length?this.iterVisibleRange(e,t,r,n,a).map((function(e){return o.spanModel.iter(e.rowFrom(),e.colFrom(),e.rowTo(),e.colTo()).map((function(t){return[t,t.intersect(e)]})).filter((function(e){return!!e[1]}))})).flatten():new iI}},{key:"iterVisibleCellSpan",value:function(e,t,r,n,a){var o=this;if(a&&a.visibleCellSpan)return _t.FIterator.fromArray(a.visibleCellSpan);var i,u=this.iterVisibleCell(e,t,r,n,a);return a&&a.visibleSpanSet&&0===a.visibleSpanSet.size||0===this.spanModel.length?u:(i=a&&a.visibleSpanSet?function(e){var t=e.row,r=e.col;return!a.visibleSpanSet.has(t,r)}:function(e){var t=e.row,r=e.col;return!o.spanModel.find(t,r)},u.filter(i).chain(this.iterVisibleSpan(e,t,r,n,a)))}},{key:"visibleCellSpanValueFactory",value:function(e,t,r,n,a,o){var i,u,s=this;o&&o.visibleRange&&o.visibleSpan?(i=_t.FIterator.fromArray(o.visibleRange),u=_t.FIterator.fromArray(o.visibleSpan)):(i=this.iterVisibleRange(e,t,r,n,o),u=this.iterVisibleSpan(e,t,r,n,o));var l,c=i.map((function(e){return a(e.rowFrom(),e.colFrom(),e.rowCount(),e.colCount())})).flatten();return o&&o.visibleSpan&&0===o.visibleSpan.length||0===this.spanModel.length?c:(l=o&&o.visibleSpanSet?function(e){var t=(0,g.Z)(e,2)[1],r=t.row,n=t.col;return!o.visibleSpanSet.has(r,n)}:function(e){var t=(0,g.Z)(e,2)[1],r=t.row,n=t.col;return!s.spanModel.find(r,n)},c.filter(l).chain(u.map((function(e){return a(e.row,e.col,1,1).first()||void 0})).filter((function(e){return!!e}))))}},{key:"iterVisibleContent",value:function(e,t,r,n,a){var o=this;return this.visibleCellSpanValueFactory(e,t,r,n,(function(e,t,r,n){return o.sheetModel.iterContentWithPos(e,t,r,n)}),a)}},{key:"visibleSegmentFactory",value:function(e,t,r,n,a,o){return this.iterVisibleContent(e,t,r,n,o).map((function(e){var t=e[0];if(t&&t.segmentArray&&t.segmentArray.length){var r=t.segmentArray.find((function(e){return e.type===a}));return r?[r,e[1]]:void 0}})).filter((function(e){return!!e}))}},{key:"visibleFormulaCustomVar",value:function(e,t,r,n,a,o){var i=this;return this.iterVisibleContent(e,t,r,n,o).map((function(e){var t=e[0].variant;if(t&&!t.isNull()&&function(e,t){var r=e.isFormula()||jp(e)?e.getVar():e;return r.isCustomPrimitive()&&r.customType===t}(t,a)&&!i.sheet.options.showFormulaText)return[t.getValue(),e[1]]})).filter((function(e){return!!e}))}},{key:"iterVisibleImage",value:function(e,t,r,n,a){var o=new Set;return this.visibleSegmentFactory(e,t,r,n,"embed-image",a).chain(this.visibleFormulaCustomVar(e,t,r,n,"SheetImageVar",a)).filter((function(e){var t=e[1].row+"_"+e[1].col;return!o.has(t)&&(o.add(t),!0)}))}},{key:"iterVisibleVar",value:function(e,t,r,n,a){var o=this;return this.iterVisibleContent(e,t,r,n,a).map((function(e){var t=e[0];if(t.multipleValues){var r=t.multipleValues.mergeToString({formatter:null});if(r&&""!==r)return e[1]}else if(t.segmentArray){var n=new Og(o.sheet.parent,t.segmentArray).getText(o.sheet.parent.userLanguage);if(n&&""!==n)return e[1]}else if(t.variant)return e[1]})).filter((function(e){return!!e}))}},{key:"iterVisibleSegmentArray",value:function(e,t,r,n,a){return this.iterVisibleContent(e,t,r,n,a).map((function(e){var t=e[0];return t&&t.segmentArray?[t.segmentArray,e[1]]:void 0})).filter((function(e){return!!e}))}},{key:"iterVisibleStyle",value:function(e,t,r,n,a){var o=this;return this.visibleCellSpanValueFactory(e,t,r,n,(function(e,t,r,n){return o.sheetModel.iterStyleWithPos(e,t,r,n)}),a)}},{key:"iterVisibleDropdown",value:function(e,t,r,n,a){var o=this;return this.visibleCellSpanValueFactory(e,t,r,n,(function(e,t,r,n){return o.sheetModel.iterDropdownWithPos(e,t,r,n)}),a)}},{key:"iterVisibleDataValidation",value:function(e,t,r,n,a){var o=this;return this.visibleCellSpanValueFactory(e,t,r,n,(function(e,t,r,n){return o.sheet.iterDataValidationWithPos(e,t,r,n)}),a)}},{key:"iterVisibleSparkline",value:function(e,t,r,n,a){var o=this;return this.visibleCellSpanValueFactory(e,t,r,n,(function(e,t,r,n){return o.sheet.iterSparklineWithPos(e,t,r,n)}),a)}},{key:"iterVisibleComment",value:function(e,t,r,n,a){var o=this;return this.visibleCellSpanValueFactory(e,t,r,n,(function(e,t,r,n){return o.sheetModel.iterCommentWithPos(e,t,r,n)}),a)}},{key:"iterVisibleNote",value:function(e,t,r,n,a){var o=this;return this.visibleCellSpanValueFactory(e,t,r,n,(function(e,t,r,n){return o.sheetModel.iterNoteWithPos(e,t,r,n)}),a)}},{key:"iterVisibleReminder",value:function(e,t,r,n,a){var o=this;return this.visibleCellSpanValueFactory(e,t,r,n,(function(e,t,r,n){return o.sheetModel.iterReminderWithPos(e,t,r,n)}),a)}},{key:"generatorIterCtx",value:function(e){var t=this,r=[],n=[],a=[],o=[],i=new Yd,u=new Yd;return e.forEach((function(e){var s=[],l=[];t.iterVisibleRange(e.y,e.x,e.maxY-1,e.maxX-1).forEach((function(e){s.push(e),r.push(e)})),t.iterVisibleSpanIntersectRange(e.y,e.x,e.maxY-1,e.maxX-1,{visibleRange:s}).forEach((function(e){var t=(0,g.Z)(e,2),r=t[0],a=t[1],o={row:r.rowFrom(),col:r.colFrom()};u.has(o.row,o.col)||(u.add(o.row,o.col),l.push(o),n.push(o));for(var s=a.rowFrom(),c=a.colFrom(),h=a.rowTo(),f=a.colTo(),d=s;d<=h;d++)for(var v=c;v<=f;v++)i.add(d,v)})),t.iterVisibleCell(e.y,e.x,e.maxY-1,e.maxX-1,{visibleRange:s}).forEach((function(e){a.push(e)})),t.iterVisibleCellSpan(e.y,e.x,e.maxY-1,e.maxX-1,{visibleRange:s,visibleSpan:l,visibleSpanSet:i}).forEach((function(e){o.push(e)}))})),{visibleRange:r,visibleSpan:n,visibleCell:a,visibleCellSpan:o,visibleSpanSet:i}}}]),e}(),sI=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).range=e,r.index=0,r.isDone=!1,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"next",value:function(){return this.index?(this.col++,this.col>this.colTo&&(this.col=this.colFrom,this.row++,this.row>this.rowTo&&(this.isDone=!0))):(this.row=this.range.rowFrom(),this.col=this.range.colFrom(),this.rowTo=this.range.rowTo(),this.colTo=this.range.colTo(),this.colFrom=this.col),this.isDone?null:(this.isDone||this.index++,{row:this.row,col:this.col})}}]),t}(_t.FIterator);!function(e){e[e.Set=0]="Set",e[e.Add=1]="Add",e[e.Del=2]="Del",e[e.Refresh=3]="Refresh"}(oI||(oI={}));var lI=function(){function e(t){var r=this;(0,y.Z)(this,e),this.chartMap=t,this.refreshBlockSet=new Set,this.oldChartBlock=new Map,this.raiseRefresh=hI((function(){var e=r.refreshBlockSet;e.size>0&&(e.forEach((function(e,t){var n=r.chartMap[t];n&&r.raiseChartChange(t,3,n)})),r.clearRefresh())})),this.raiseChange=hI((function(){var e=r.oldChartBlock;return e.size>0&&(e.forEach((function(e,t){var n=r.chartMap[t];n&&r.raiseChartChange(t,0,n)})),r.clearChange()),e}))}return(0,_.Z)(e,[{key:"markChartChange",value:function(e){this.oldChartBlock.has(e)||(this.oldChartBlock.set(e,this.chartMap[e]),this.chartMap[e]=(0,Re.default)(this.chartMap[e]))}},{key:"markChartRefresh",value:function(e){return this.refreshBlockSet.add(e)}},{key:"hasMarkedRefresh",value:function(e){return this.refreshBlockSet.has(e)}},{key:"hasMarkedChange",value:function(e){return this.oldChartBlock.has(e)}},{key:"clearRefresh",value:function(){this.refreshBlockSet=new Set}},{key:"clearChange",value:function(){this.oldChartBlock=new Map}},{key:"registerChartChange",value:function(e){this.chartChangeHandle=e}},{key:"unRegisterChartChange",value:function(){this.chartChangeHandle=void 0}},{key:"raise",value:function(){this.raiseRefresh(),this.raiseChange()}},{key:"raiseChartChange",value:function(e,t,r){this.chartChangeHandle&&this.chartChangeHandle({chartId:e,changeType:t,chart:r})}}]),e}(),cI=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,y.Z)(this,e),this.sheet=t,this._chartMap=r,this.addRowOrColForRange=(0,ee.Z)((function(e,t,r,n,a){return a[r]>=e?Object.assign({},a,(0,l.Z)({},r,a[r]+t)):a[r]+a[n]>e?Object.assign({},a,(0,l.Z)({},n,a[n]+t)):a})),this.delRowOrColForRange=(0,ee.Z)((function(e,t,r,n,a){var o=a[r],i=a[r]+a[n]-1,u=e,s=e+t-1;if(s<o)return Object.assign({},a,(0,l.Z)({},r,o-t));if(u<=o&&o<=s){var c,h=i-s;return h>0?Object.assign({},a,(c={},(0,l.Z)(c,r,u),(0,l.Z)(c,n,h),c)):void 0}if(o<u&&u<=i){var f=i-s;return f<0&&(f=0),Object.assign({},a,(0,l.Z)({},n,u-o+f))}return a})),this.hideRowOrColForRange=function(e,t,r,n,a){var o=a[r],i=a[r]+a[n]-1,u=e+t-1;return u<o||e<=o&&o<=u||o<e&&e<=i},this.changeManager=new lI(r)}return(0,_.Z)(e,[{key:"getChangeManager",value:function(){return this.changeManager}},{key:"fromJSON",value:function(e){this._chartMap=(0,Re.default)(e)||{}}},{key:"toJSON",value:function(e){var t=(0,Re.default)(this._chartMap);if(!e)return t;var r=e.customSheetId;return r?(Object.keys(t).forEach((function(e){var n=t[e];n.sheetId=r,n.graphSetting.dataRanges.forEach((function(e){e.sheetId=r}));var a=(0,Ce.zsn)(10);n.chartId=a,t[a]=n,delete t[e]})),t):t}},{key:"registerChartChange",value:function(e){this.changeManager.registerChartChange(e)}},{key:"addChart",value:function(e,t){if(!e||e!==t.chartId)throw new Error("Please make sure your id correct");return this._chartMap[e]?(console.error("id  ".concat(e,"  chart ")),!1):(this._chartMap[e]=(0,Re.default)(t),this.changeManager.raiseChartChange(e,1,t),!0)}},{key:"setChart",value:function(e,t,r){if(!e||e!==t.chartId)throw new Error("Please make sure your id correct");return r||this._chartMap[e]?(this._chartMap[e]=(0,Re.default)(t),this.changeManager.raiseChartChange(e,0,t),!0):(console.error("id  ".concat(e,"  chart ")),!1)}},{key:"deleteChart",value:function(e){var t=this._chartMap[e];return t?(delete this._chartMap[e],this.changeManager.raiseChartChange(e,2,t),!0):(console.error("id  ".concat(e,"  chart ")),!1)}},{key:"getChartById",value:function(e){return this._chartMap[e]}},{key:"getChartMap",value:function(){return this._chartMap}},{key:"addRowOrColForTarget",value:function(e,t,r){return r>=e?r+t:r}},{key:"delRowOrColForTarget",value:function(e,t,r){var n=e+t-1;return r>=e&&r<=n?e>0?e-1:0:r>n?r-t:r}},{key:"getAxisAdjustFn",value:function(e){if("add"===e)return this.addRowOrColForRange;if("del"===e)return this.delRowOrColForRange;throw new Error("error function type")}},{key:"getTargetAdjustFn",value:function(e){if("add"===e)return this.addRowOrColForTarget;if("del"===e)return this.delRowOrColForTarget;throw new Error("error function type")}},{key:"setChartChange",value:function(e,t,r){(0,Q.Z)(this._chartMap[e],t,r)}},{key:"rangeAdjust",value:function(e){var t=this,r=e.index,n=e.count,a=e.indexKey,o=e.countKey,i=e.type,u=this.getAxisAdjustFn(i),s=this.getTargetAdjustFn(i);this._chartMap=(0,L.Z)(this._chartMap,(function(e,i){var l=u(r,n,a,o);if(s(r,n,e.blockSetting[a])!==e.blockSetting[a]){t.changeManager.markChartChange(i);var c=s(r,n,e.blockSetting[a]);t.setChartChange(i,"blockSetting.".concat(a),c)}var h=e.graphSetting.dataRanges.reduce((function(e,r){var n=l(r);return n!==r&&t.changeManager.markChartChange(i),n&&e.push(n),e}),[]);t.setChartChange(i,"graphSetting.dataRanges",h)}))}},{key:"setValue",value:function(e,t){if(0!==Object.keys(this._chartMap).length){var r=this.changeManager;(0,L.Z)(this._chartMap,(function(n,a){if(!r.hasMarkedRefresh(a)){var o,i=yr(n.graphSetting.dataRanges);try{for(i.s();!(o=i.n()).done;){var u=o.value;if(u.row<=e&&u.row+u.rowCount>=e+1&&u.col<=t&&u.col+u.colCount>=t+1)return r.markChartRefresh(a)}}catch(e){i.e(e)}finally{i.f()}}})),this.changeManager.raise()}}},{key:"tryRefreshChart",value:function(e){var t=this,r=!1,n=this.changeManager;return Object.entries(this._chartMap).forEach((function(a){var o=(0,g.Z)(a,2),i=o[0],u=o[1];n.hasMarkedRefresh(i)||u.graphSetting.dataRanges.some((function(r){var n=new ou(r.row,r.col,r.rowCount,r.colCount,t.sheet);return e.isIntersect(n)}))&&(n.markChartRefresh(i),r=!0)})),r&&this.changeManager.raise(),r}},{key:"setRowColInfoChange",value:function(e,t){var r=this.changeManager;(0,L.Z)(this._chartMap,(function(n,a){if(!r.hasMarkedRefresh(a)){var o=n.blockSetting,i=o.row,u=o.col;("row"===t&&i>e||"col"===t&&u>e)&&r.markChartRefresh(a)}})),this.changeManager.raise()}},{key:"addRows",value:function(e,t){return this.rangeAdjust({index:e,count:t,indexKey:"row",countKey:"rowCount",type:"add"}),this.changeManager.raise()}},{key:"addColumns",value:function(e,t){return this.rangeAdjust({index:e,count:t,indexKey:"col",countKey:"colCount",type:"add"}),this.changeManager.raise()}},{key:"removeRows",value:function(e,t){return this.rangeAdjust({index:e,count:t,indexKey:"row",countKey:"rowCount",type:"del"}),this.changeManager.raise()}},{key:"removeColumns",value:function(e,t){return this.rangeAdjust({index:e,count:t,indexKey:"col",countKey:"colCount",type:"del"}),this.changeManager.raise()}},{key:"setRowColVisible",value:function(e,t,r){var n=this,a="row"===r?"rowCount":"colCount";return(0,L.Z)(this._chartMap,(function(o,i){o.graphSetting.dataRanges.find((function(o){return n.hideRowOrColForRange(e,t,r,a,o)}))&&n.changeManager.markChartRefresh(i)})),this.changeManager.raise()}},{key:"frozen",value:function(e,t){var r=this;return(0,L.Z)(this._chartMap,(function(n,a){var o=n.blockSetting,i=o.row,u=o.col;("col"===e&&t>u||"row"===e&&t>i)&&(r.changeManager.markChartChange(a),r.setChartChange(a,"blockSetting.".concat(e),t))})),this.changeManager.raise()}},{key:"filter",value:function(e,t){var r=this;return(0,L.Z)(this._chartMap,(function(e,t){r.changeManager.markChartRefresh(t)})),this.changeManager.raise()}},{key:"checkDelInfluence",value:function(e,t,r){var n="row"===e?"rowCount":"colCount",a=new Map,o=this.getAxisAdjustFn("del");return(0,L.Z)(this._chartMap,(function(i,u){i.blockSetting[e]>=t+r?a.set(u,i):i.graphSetting.dataRanges.find((function(s){return o(t,r,e,n,s)!==s&&(a.set(u,i),!0)}))})),a}},{key:"checkFreezeInfluence",value:function(e,t){var r=new Map;return(0,L.Z)(this._chartMap,(function(n,a){var o=n.blockSetting,i=o.row,u=o.col;(e>i||t>u)&&r.set(a,n)})),r}}],[{key:"fromJSON",value:function(t,r){return new e(t,(0,Re.default)(r))}},{key:"createDefault",value:function(e,t,r,n){var a=e.id(),o=n.blockSetting,i=n.usingDefaultSetting;e.isSingleCellOrSpan(r)&&(r=[e.extendSelectedRangeForMergeCell(eg(e,r[0].clone()))]);var u={title:"",type:"bar",xAxisPos:"col",dataRanges:r.map((function(e){return{sheetId:a,row:e.rowFrom(),col:e.colFrom(),rowCount:e.rowCount(),colCount:e.colCount()}})),isStack:!1,combineDirection:"horizontal",isDataLabelShown:!1,isTitleHidden:!1,isGridLineHidden:!1,legendPosition:0,isAggregate:!1,hasLabels:!0,hasHeaders:!0,chartColorType:Ce.DqO.ColorA,mainYaxisMaxValue:"",mainYaxisMinValue:""},s={chartId:(0,Ce.zsn)(10),sheetId:a,blockSetting:o,graphSetting:u};return e.parent.graphDataGenerator.detectWhileCreating(s,i),s}}]),e}();function hI(e){var t;return window.cancelAnimationFrame?function(){var r=this,n=arguments;t||window.requestAnimationFrame&&(t=requestAnimationFrame((function(){t=null,e.apply(r,n)})))}:function(){}}cI.defaultBlockRect={x:0,y:0,width:500,height:370};var fI,dI=function(e){var t;return window.cancelAnimationFrame?function(){var r=this,n=arguments;t||window.requestAnimationFrame&&(t=requestAnimationFrame((function(){t=null,e.apply(r,n)})))}:function(){}};!function(e){e[e.Add=0]="Add",e[e.Set=1]="Set",e[e.Del=2]="Del",e[e.Refresh=3]="Refresh"}(fI||(fI={}));var vI=function(){function e(t){var r=this;(0,y.Z)(this,e),this._blocksMap=t,this.refreshBlockSet=new Set,this.oldEmbeddedBlocks=new Map,this.raiseRefresh=dI((function(){var e=r.refreshBlockSet;e.size>0&&(e.forEach((function(e,t){var n=r._blocksMap[t];n&&r.raiseEmbeddedBlockChange(t,3,n)})),r.clearRefresh())})),this.raiseChange=dI((function(){var e=r.oldEmbeddedBlocks;return e.size>0&&(e.forEach((function(e,t){var n=r._blocksMap[t];n&&r.raiseEmbeddedBlockChange(t,1,n)})),r.clearChange()),e}))}return(0,_.Z)(e,[{key:"markBlockChange",value:function(e){this.oldEmbeddedBlocks.has(e)||(this.oldEmbeddedBlocks.set(e,this._blocksMap[e]),this._blocksMap[e]=(0,Re.default)(this._blocksMap[e]))}},{key:"markBlockRefresh",value:function(e){return this.refreshBlockSet.add(e)}},{key:"hasMarkedRefresh",value:function(e){return this.refreshBlockSet.has(e)}},{key:"hasMarkedChange",value:function(e){return this.oldEmbeddedBlocks.has(e)}},{key:"clearRefresh",value:function(){this.refreshBlockSet=new Set}},{key:"clearChange",value:function(){this.oldEmbeddedBlocks=new Map}},{key:"hasChangeHandler",value:function(){return Boolean(this.embeddedBlockChangeHandler)}},{key:"registerEmbeddedBlockChangeHandler",value:function(e){this.embeddedBlockChangeHandler=e}},{key:"unregisterFloatBlockChangeHandler",value:function(){this.embeddedBlockChangeHandler=void 0}},{key:"raise",value:function(){this.raiseRefresh(),this.raiseChange()}},{key:"raiseAllBlocksSet",value:function(){var e=this;Object.keys(this._blocksMap).forEach((function(t){var r=e._blocksMap[t];r&&e.raiseEmbeddedBlockChange(t,1,r)}))}},{key:"raiseEmbeddedBlockChange",value:function(e,t,r){var n;null===(n=this.embeddedBlockChangeHandler)||void 0===n||n.call(this,{blockToken:e,changeType:t,embeddedBlock:r})}}]),e}(),pI=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,y.Z)(this,e),this.sheet=t,this._blocksMap={},this._blocksMap=r,this.changeManager=new vI(r)}return(0,_.Z)(e,null,[{key:"createDefault",value:function(e,t,r,n){return{blockToken:e,blockType:t,position:r,blockSetting:n}}},{key:"fromJSON",value:function(t,r){return new e(t,(0,Re.default)(r))}}]),(0,_.Z)(e,[{key:"getChangeManager",value:function(){return this.changeManager}},{key:"registerEmbeddedBlockChangeHandler",value:function(e){this.changeManager.registerEmbeddedBlockChangeHandler(e)}},{key:"setBlock",value:function(e,t,r){if(!e||e!==t.blockToken)throw new Error("Please make sure your blockToken correct");return r||this._blocksMap[e]?(this._blocksMap[e]=(0,Re.default)(t),this.changeManager.raiseEmbeddedBlockChange(e,1,t),!0):(console.error("blockToken  ".concat(e,"  embeddedBlock ")),!1)}},{key:"delBlock",value:function(e){if(!this._blocksMap[e])return console.error("blockToken  ".concat(e,"  embeddedBlock ")),!1;var t=this._blocksMap[e];return delete this._blocksMap[e],this.changeManager.raiseEmbeddedBlockChange(e,2,t),this.sheet.dispatch("EmbeddedBlockChanged",{sheetId:this.sheet.id(),embeddedBlockChangeParams:{changeType:2,embeddedBlock:t,blockToken:e}}),!0}},{key:"raiseAllBlocksSet",value:function(){var e=this;this.changeManager.raiseAllBlocksSet(),Object.keys(this._blocksMap).forEach((function(t){var r=e._blocksMap[t];r&&e.sheet.dispatch("EmbeddedBlockChanged",{sheetId:e.sheet.id(),embeddedBlockChangeParams:{changeType:1,embeddedBlock:r,blockToken:t}})}))}},{key:"getBlock",value:function(e){return this._blocksMap[e]}},{key:"getBlocksMap",value:function(){return this._blocksMap}},{key:"toJSON",value:function(){return(0,Re.default)(this._blocksMap)}},{key:"serialize",value:function(e){var t=(0,l.Z)({},Zt.kH.PIVOT_TABLE,Ce.B2l.EmbeddedBlockType.EmbeddedBlockType_PIVOT_TABLE),r=e||this._blocksMap;return Object.values(r).filter((function(e){return Boolean(t[e.blockType])})).map((function(e){var r=e.position;return{id:e.blockToken,cell:{startRow:r.row,startCol:r.col},blockType:t[e.blockType]}}))}},{key:"swapPosition",value:function(e,t,r){var n=this;Object.keys(this._blocksMap).filter((function(t){var a=n._blocksMap[t];return e===a.position[r]})).forEach((function(e){var a="position.".concat(r);n.updateEmbeddedBlockMap(e,a,t),n.changeManager.markBlockRefresh(e),n.sheet.dispatch("EmbeddedBlockChanged",{sheetId:n.sheet.id(),embeddedBlockChangeParams:{changeType:3,embeddedBlock:n._blocksMap[e],blockToken:e}})})),this.changeManager.raise()}},{key:"swapRow",value:function(e,t){this.swapPosition(e,t,"row")}},{key:"swapCol",value:function(e,t){this.swapPosition(e,t,"col")}},{key:"addRows",value:function(e,t,r){this.adjustBlockPos4AddRows(e,t),this.changeManager.raise()}},{key:"addColumns",value:function(e,t,r){this.adjustBlockPos4AddCols(e,t),this.changeManager.raise()}},{key:"removeRows",value:function(e,t){this.adjustBlockPos4DelRows(e,t),this.changeManager.raise()}},{key:"removeColumns",value:function(e,t){this.adjustBlockPos4DelCols(e,t),this.changeManager.raise()}},{key:"updateEmbeddedBlockMap",value:function(e,t,r){(0,Q.Z)(this._blocksMap[e],t,r)}},{key:"_isBlockAdjustedByRowColChange",value:function(e,t){return t>=e}},{key:"getBlockTokensToAdjust",value:function(e,t,r){var n=this,a=Object.keys(this._blocksMap).filter((function(r){var a=n._blocksMap[r];return n._isBlockAdjustedByRowColChange(e,a.position[t])})),o="add"===r?function(e,t){return t-e}:function(e,t){return e-t};return a.sort((function(e,r){var a=[e,r].map((function(e){return n._blocksMap[e]})),i=(0,g.Z)(a,2),u=i[0],s=i[1];return o(u.position[t],s.position[t])}))}},{key:"adjustBlockPos4AddRows",value:function(e,t){var r=this;this.getBlockTokensToAdjust(e,"row","add").forEach((function(n){var a=r._blocksMap[n],o=a.position,i=r.getNewTarget4Add(e,t,o.row);i!==o.row&&(r.updateEmbeddedBlockMap(n,"position.row",i),r.changeManager.markBlockRefresh(n),r.sheet.dispatch("EmbeddedBlockChanged",{sheetId:r.sheet.id(),embeddedBlockChangeParams:{changeType:3,embeddedBlock:a,blockToken:n}}))}))}},{key:"adjustBlockPos4AddCols",value:function(e,t){var r=this;this.getBlockTokensToAdjust(e,"col","add").forEach((function(n){var a=r._blocksMap[n],o=a.position,i=r.getNewTarget4Add(e,t,o.col);i!==o.col&&(r.updateEmbeddedBlockMap(n,"position.col",i),r.changeManager.markBlockRefresh(n),r.sheet.dispatch("EmbeddedBlockChanged",{sheetId:r.sheet.id(),embeddedBlockChangeParams:{changeType:3,embeddedBlock:a,blockToken:n}}))}))}},{key:"adjustBlockPos4DelRows",value:function(e,t){var r=this,n=this.getBlockTokensToAdjust(e,"row","del"),a=this.sheet.getRowCount()-1;n.forEach((function(n){var o=r._blocksMap[n],i=o.position,u=r.getNewTarget4Del(e,t,i.row),s=Math.min(u,a);s!==i.row&&(u<0?r.delBlock(n):(r.updateEmbeddedBlockMap(n,"position.row",s),r.changeManager.markBlockRefresh(n),r.sheet.dispatch("EmbeddedBlockChanged",{sheetId:r.sheet.id(),embeddedBlockChangeParams:{changeType:3,embeddedBlock:o,blockToken:n}})))}))}},{key:"adjustBlockPos4DelCols",value:function(e,t){var r=this,n=this.getBlockTokensToAdjust(e,"col","del"),a=this.sheet.getColumnCount()-1;n.forEach((function(n){var o=r._blocksMap[n],i=o.position,u=r.getNewTarget4Del(e,t,i.col),s=Math.min(u,a);s!==i.col&&(s<0?r.delBlock(n):(r.updateEmbeddedBlockMap(n,"position.col",s),r.changeManager.markBlockRefresh(n),r.sheet.dispatch("EmbeddedBlockChanged",{sheetId:r.sheet.id(),embeddedBlockChangeParams:{changeType:3,embeddedBlock:o,blockToken:n}})))}))}},{key:"getNewTarget4Add",value:function(e,t,r){return r<e?r:r+t}},{key:"getNewTarget4Del",value:function(e,t,r){return r<e?r:r<=e+t-1?-1:r-t}}]),e}(),mI=function(){function e(t){(0,y.Z)(this,e),this.sheet=t,this.getColumnCount=t.getColumnCount.bind(t),this.getRowCount=t.getRowCount.bind(t)}return(0,_.Z)(e,[{key:"id",get:function(){return this.sheet.id()}}]),e}();mI=Vu([(0,st.b)(),Nu(0,(0,lt.f)(Lm))],mI);var gI=function(){function e(t,r,n){(0,y.Z)(this,e),this.sheet=t,this.watchHub=r,this.sheetInfo=n,this.selectionsToString=bv}return(0,_.Z)(e,[{key:"createRange",value:function(e,t,r,n){return new ou(e,t,r,n,this.sheet)}},{key:"createRanges",value:function(e){return new Ou(e,this.sheet)}},{key:"createRowOp",value:function(e,t,r){return new vu(!0,"add"===e?"add":"delete",t,r,this.sheet)}},{key:"createColOp",value:function(e,t,r){return new vu(!1,"add"===e?"add":"delete",t,r,this.sheet)}},{key:"createWatchedRange",value:function(e,t,r,n){var a=this,o=this.createRange(e,t,r,n);o.$=new ft.X(o);var i=o.onOp.bind(o);return o.onOp=function(){var e=i.apply(void 0,arguments);return o.$.next(o),e},this.watchHub.watchRef(o,null),o.destroy=function(){a.watchHub.unWatchRef(o,null)},o}},{key:"isOverflowRange",value:function(e){var t=this.sheetInfo.getRowCount(),r=this.sheetInfo.getColumnCount(),n=e.rowFrom(),a=e.colFrom(),o=e.rowFrom()+e.rowCount(!0),i=e.colFrom()+e.colCount(!0);return n>t||a>r||o>t||i>r}},{key:"rangeStringToRange",value:function(e){return tA(this.sheet,e)}}]),e}();gI=Vu([(0,st.b)(),Nu(0,(0,lt.f)(Lm)),Nu(1,(0,lt.f)(Bm)),Nu(2,(0,lt.f)(mI))],gI);var yI=function(e,t){return e.row===t.row&&e.col===t.col&&e.rowCount===t.rowCount&&e.colCount===t.colCount},_I=function e(){var t=this;(0,y.Z)(this,e),this.actionEventBus$=new dt.xQ,this.lifeCycle$=new dt.xQ,this.lifeCycle$.subscribe((function(e){"destroy"===e.type&&(t.actionEventBus$.complete(),t.lifeCycle$.complete())}))};_I=Vu([(0,st.b)()],_I);function RI(e){return e.replace(/\s/g," ").trim()}function CI(e){return[cr("LarkCCM_Sheets_Filter_Jan"),cr("LarkCCM_Sheets_Filter_Feb"),cr("LarkCCM_Sheets_Filter_Mar"),cr("LarkCCM_Sheets_Filter_Apr"),cr("LarkCCM_Sheets_Filter_May"),cr("LarkCCM_Sheets_Filter_Jun"),cr("LarkCCM_Sheets_Filter_Jul"),cr("LarkCCM_Sheets_Filter_Aug"),cr("LarkCCM_Sheets_Filter_Sep"),cr("LarkCCM_Sheets_Filter_Oct"),cr("LarkCCM_Sheets_Filter_Nov"),cr("LarkCCM_Sheets_Filter_Dec")][e-1]}var wI=function(e,t,r){var n=e.filterModel.filterRange;return Ce.Ps3.getSheetPivotAllowFilter()&&!(null!=n&&n.containCell(t,r)&&n.rowFrom()===t)};function EI(e,t,r){var n;return wI(e,t,r)?function(e,t,r){var n=e.getPivotTableManager(),a=n.getPivotTableNameByCell(t,r),o=n.getPivotInfoByName(a),i=n.getViewDataModelByName(a);if(!a||!o||!i)return null;var u=i.page,s=i.col,l=i.row,c=u.range.rowCount<0?0:u.range.rowCount+1,h=s.range.rowCount,f=l.range,d=f.rowCount,v=f.colCount,p=o.row,m=o.col;return new ou(p+c+h-1,m,d+1,v,e)}(e,t,r):null!==(n=e.filterModel.filterRange)&&void 0!==n?n:null}function kI(e,t,r,n){var a=[],o=[],i=t.filterRange&&!(null!=n&&n.equal(t.filterRange));if(!n)return{valueList:a,allValueList:o};var u=t.getFilterInfo(r),s=new Map,l=new Map,c=n.rowFrom(),h=n.rowCount(),f=t.getAllFilteredOutRows();function d(t,r,n,a){if(a&&Ce.Ps3.getSheetFilterDateAggregationEnabled()){var o=e.getValue(r,n),i={shouldShow:!1,count:0,isFilteredOut:!0,isDate:!0,value:o,cellValue:o};if("number"==typeof o){var u=we.SheetDate.fromNumber(o),c=u.year,h=u.month,f=u.date,d=[String(c),String(h),String(f)],v=d[0],p=d[1],m=d[2],g=l.get(v);g||(g=Object.assign({},i,{internationalValue:[v],children:{}}));var y=g.children[p];y||(y=Object.assign({},i,{internationalValue:[String(h)],children:{}}),g.children[p]=y);var _=y.children[m];return _||(_=Object.assign({},i,{internationalValue:[m],children:{},cellLabel:t}),y.children[m]=_),l.set(v,g),g}}var R=s.get(t);if(!R){var C=e.getValue(r,n),w=e.getInternationalText(r,n),E={shouldShow:!1,count:0,isDate:!1,isFilteredOut:!0,children:{},value:C};Array.isArray(w)&&(E.internationalValue=w.map((function(e){return RI(e)}))),R=E,s.set(t,R)}return R}for(var v=function(n){var a=e.getSpan(n,r),o=a?a.rowFrom():n,u=a?a.colFrom():r,s=RI(e.getText(o,u)),l=MI(e,o,u),h=d(s,o,u,l),v=a?a.rowCount(!0):1;o===c&&(v-=1);for(var m=e.getValue(o,u),g=we.SheetDate.fromNumber(m),y=g.month,_=g.date,R=h,C=String(y),w=String(_),E=R.children[C],k=0;k<v;k++)if(t.isRowNotFilteredOutByOtherColumn(n+k,r,i)&&(h.shouldShow=!0,h.count+=1,l&&Ce.Ps3.getSheetFilterDateAggregationEnabled()&&E)){E.shouldShow=!0,E.count+=1;var T=E.children[w];T&&(T.shouldShow=!0,T.count+=1)}if(Array.from({length:v},(function(e,t){return n+t})).some((function(e){return!f.has(e)}))&&(h.isFilteredOut=!1,l&&Ce.Ps3.getSheetFilterDateAggregationEnabled()&&E)){E.isFilteredOut=!1;var S=E.children[w];S&&(S.isFilteredOut=!1)}p=n+=v-1},p=c+1;p<c+h;p++)v(p);return s.forEach((function(e,t){var r=e.value,n=e.shouldShow,i=e.isFilteredOut,s=e.internationalValue,l=e.count,c=function(e){var i={label:t,value:t,cellValue:r,checked:e,count:l,staged:!1,isDate:!1};n&&a.push(i),o.push(i)};if(null==u)return c(!0);if(null!=u.type&&!i)return c(!0);if(Array.isArray(u.contents)&&u.contents.length){var h=u.contents,f=function(e){return h.includes(e)},d=0===(null==u?void 0:u.type)&&1===(null==u?void 0:u.compare)||!1;if(Array.isArray(s)){if(s.some(f))return c(!d)}else if(f(t))return c(!d)}return c(!1)})),l.forEach((function(e,t){var r=e.shouldShow,n=e.isFilteredOut,i=e.count,s=e.children,l=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l={label:cr("LarkCCM_Sheets_Filter_Year",{num:t}),value:"@@DATE@@".concat(t),checked:e,count:i,staged:!1,isDate:!0,cellValue:Number(t)};return r&&a.push(l),o.push(l),l.children=Object.entries(s).map((function(e){var r,a=(0,g.Z)(e,2),o=a[0],i=a[1];return{value:"@@DATE@@".concat(t,"/").concat(o),cellValue:Number(o),label:CI(Number(o)),checked:n||(null==u||null===(r=u.dateGroups)||void 0===r?void 0:r.some((function(e){return String(e.year)===String(t)&&String(e.month)===String(o)})))||!i.isFilteredOut,count:i.count,staged:!1,isDate:!0,children:Object.entries(i.children).map((function(e){var r,a=(0,g.Z)(e,2),i=a[0],s=a[1];return{value:"@@DATE@@".concat(t,"/").concat(o,"/").concat(i),cellLabel:s.cellLabel,cellValue:Number(i),label:cr("LarkCCM_Sheets_Filter_Date",{num:Number(i)}),checked:n||(null==u||null===(r=u.dateGroups)||void 0===r?void 0:r.some((function(e){return String(e.year)===String(t)&&String(e.month)===String(o)&&String(e.day)===String(i)})))||!s.isFilteredOut,count:s.count,isDate:!0,staged:!1}})).filter((function(e){return e.count>0}))}})).filter((function(e){return e.count>0})),l};if(null==u)return l(!0,!0);if(null!=u.type&&!n)return l(!0);if(Array.isArray(u.dateGroups)&&u.dateGroups.length){var c=0===(null==u?void 0:u.type)&&1===(null==u?void 0:u.compare)||!1;if(u.dateGroups.some((function(e){return String(e.year)===String(t)})))return l(!c)}return l(!1)})),{valueList:a,allValueList:o}}function TI(e){var t=e.sheet();if(!t)return!1;var r=t.sheetFilterModel,n=t.filterModel,a=t.sheetFilterModel.filterRange;if(!a)return!1;var o=e.startRow,i=e.endRow,u=a.startRow,s=a.endRow;if(o>=s||u>=i)return!1;var l=r.getFilteredOutRows(),c=n.getFilteredOutRows();return(0,j.Z)(l,c).some((function(e){return o<e+1&&e<i}))}var SI=function(e,t){var r=e.filterModel.filterRange;if(Ce.Ps3.getSheetPivotAllowFilter()&&r&&!r.equal(t)){var n=r.toJSON(),a=n.row,o=n.col,i=n.rowCount,u=n.colCount,s=new ou(a,o,i,u,e).toString({isShowSheetName:!1,ref:r});Ce.Ps3.Toast.show({key:"REMOVE_FILTER_TOAST",type:"info",content:cr("LarkCCM_Sheets_FilterRangeRemoved_Toast",{range:s})})}};function AI(e,t,r,n){var a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],o=(0,Ce.US_)(t);if(n){var i=n.value,u=n.range,s=n.col;a&&SI(e,u),e.setFilterView(t,o,{col:s,range:u.toJSON(),value:i})}else e.delFilterView(t,r)}var II=function(e,t){return Wv(e).map((function(e){return(0,G.Z)(e,["col","type","compare","expected","contents","dateGroups"])})).filter((function(e){return e.col!==t}))};function OI(e,t){var r,n,a,o,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],u=t.value,s=t.range,l=t.col,c=e.filterModel.filterRange,h=[];null!=c&&c.equal(s)&&(0,Ce.hTd)(h,II(e,l)),i&&SI(e,s),h.push(Object.assign({type:null!==(r=null==u?void 0:u.type)&&void 0!==r?r:null,compare:null!==(n=null==u?void 0:u.compare)&&void 0!==n?n:0,expected:null!==(a=null==u?void 0:u.expected)&&void 0!==a?a:"",contents:null!==(o=null==u?void 0:u.contents)&&void 0!==o?o:null,dateGroups:null==u?void 0:u.dateGroups},u,{col:l}));var f=e.viewsModel.assignViewId(!1);e.addFilterView(!0,{range:s.toJSON(),filterItemList:h,viewId:f})}var VI=Gt.Cb,NI=Gt.xA;function bI(e,t,r){for(var n=new Set,a=e.row,o=e.col,i=0;i<e.rowCount;i++){var u=r(a+i,o),s=u?u.rowFrom():a+i,l=t(s,u?u.colFrom():o),c=u?u.rowCount(!0):1;if(s<a&&(c-=1),l&&(n.add(a+i),c>1))for(var h=1;h<c;h++)n.add(a+i+h);i+=c-1}return n}function MI(e,t,r){var n=e.getValue(t,r);if(n<0||!Number.isSafeInteger(we.SheetDate.fromNumber(n).year))return!1;var a=e.getActualFormatter(t,r);return!(!a||!(0,Ee.hasDate)(a)||/^a{3,}$/i.test(a.getFormatCode())||/^d{3,}$/i.test(a.getFormatCode()))}var FI=function(){function e(t){(0,y.Z)(this,e),this.sheetFacade=t,this.tryParseFloat=function(e){var t=e.trim(),r=t.indexOf("%")===t.length-1,n=parseFloat(t);return Number.isNaN(n)?e:r?n/100:n}}return(0,_.Z)(e,[{key:"filterByMultiValueConditionRule",value:function(e,t,r,n){var a=this,o=(null==n?void 0:n.reduce((function(e,t){return t.dateTimeGrouping===Ce.fmI.DateTimeGrouping_YEAR&&t.year?e[t.year]=!0:t.dateTimeGrouping===Ce.fmI.DateTimeGrouping_MONTH&&t.year&&t.month?(e[t.year]=e[t.year]||{},e[t.year][t.month]=!0):t.dateTimeGrouping===Ce.fmI.DateTimeGrouping_DAY&&t.year&&t.month&&t.day&&(e[t.year]=e[t.year]||{},e[t.year][t.month]=e[t.year][t.month]||{},e[t.year][t.month][t.day]=!0),e}),{}))||{},i=function(e){var t=e.year,r=e.month,n=e.date;return!0===o[t]||void 0!==o[t]&&(!0===o[t][r]||void 0!==o[t][r]&&!0===o[t][r][n])};return bI(e,(function(e,n){var o=a.getInternationalText(e,n);if(MI(a.sheetFacade,e,n)){var u=a.sheetFacade.getValue(e,n);if("number"==typeof u){var s=i(we.SheetDate.fromNumber(u)),l=o.some((function(e){return t.has(e)}));return Boolean(r)===(s||l)}}var c=o.some((function(e){return t.has(e)}));return Boolean(r)===c}),(function(e,t){return a.sheetFacade.getSpan(e,t)}))}},{key:"getInternationalText",value:function(e,t){var r=this.sheetFacade.getInternationalText(e,t);return Array.isArray(r)?r.map(RI):[RI(r||"")]}},{key:"filterByNumberConditionRule",value:function(e,t,r){var n=this,a=(0,g.Z)(r,2),o=a[0],i=a[1],u=function(e){return new Map([[0,function(e){var t=e.getNumber1,r=e.getValue,n=t(),a=r();return"string"==typeof n&&(n=n.trim()),"string"==typeof a&&(a=a.trim()),n===a}],[1,function(e){var t=e.getNumber1,r=e.getValue,n=t(),a=r();return"string"==typeof n&&(n=n.trim()),"string"==typeof a&&(a=a.trim()),n!==a}],[2,function(e){var t=e.getNumber1,r=(0,e.getValue)(),n=t();return(0,R.Z)(r)==(0,R.Z)(n)&&r>n}],[3,function(e){var t=e.getNumber1,r=(0,e.getValue)(),n=t();return(0,R.Z)(r)==(0,R.Z)(n)&&r>=n}],[4,function(e){var t=e.getNumber1,r=(0,e.getValue)(),n=t();return(0,R.Z)(r)==(0,R.Z)(n)&&r<n}],[5,function(e){var t=e.getNumber1,r=(0,e.getValue)(),n=t();return(0,R.Z)(r)==(0,R.Z)(n)&&r<=n}],[6,function(e){var t,r=e.getNumber1,n=e.getValue,a=e.getNumber2,o=r(),i=a();o>i&&(o=(t=[i,o])[0],i=t[1]);var u=n();return(0,R.Z)(u)==(0,R.Z)(o)&&(0,R.Z)(u)==(0,R.Z)(i)&&o<=u&&u<=i}],[7,function(e){var t,r=e.getNumber1,n=e.getValue,a=e.getNumber2,o=r(),i=a();o>i&&(o=(t=[i,o])[0],i=t[1]);var u=n();return(0,R.Z)(u)==(0,R.Z)(o)&&(0,R.Z)(u)==(0,R.Z)(i)&&(o>u||u>i)}]]).get(e)}(t);if(!u)return new Set;var s=function(){return n.tryParseFloat(o)},l=function(){return i?n.tryParseFloat(i):0};return bI(e,(function(e,t){return!u({getNumber1:s,getNumber2:l,getValue:function(){return n.sheetFacade.getValueWithStringFormatter(e,t)}})}),(function(e,t){return n.sheetFacade.getSpan(e,t)}))}},{key:"filterByTextConditionRule",value:function(e,t,r){var n=this,a=function(e){return new Map([[2,function(e){var t=e.compareText,r=e.cellText,n=(0,X.Z)(r);return(0,K.Z)(n,t)}],[3,function(e){var t=e.compareText,r=e.cellText,n=(0,X.Z)(r);return!(0,K.Z)(n,t)}],[4,function(e){var t=e.compareText,r=e.cellText,n=(0,J.Z)(r);return(0,q.Z)(n,t)}],[5,function(e){var t=e.compareText,r=e.cellText,n=(0,J.Z)(r);return!(0,q.Z)(n,t)}],[6,function(e){var t=e.compareText,r=e.cellText;return(0,Y.Z)(r,t)}],[7,function(e){var t=e.compareText,r=e.cellText;return!(0,Y.Z)(r,t)}]]).get(e)}(t);return a?bI(e,(function(e,t){var o=n.sheetFacade.getText(e,t);return!a({compareText:(0,W.Z)(r),cellText:(0,W.Z)(o)})}),(function(e,t){return n.sheetFacade.getSpan(e,t)})):new Set}},{key:"filterByColorConditionRule",value:function(e,t,r){var n=this,a=1===t?NI:VI,o=1===t?"foreColor":"backColor";return bI(e,(function(e,i){var u=n.sheetFacade.getStyle(e,i),s=(0,oe.default)(u,o,a);if(1===t){var l=n.sheetFacade.getSegmentArray(e,i);if(l)return!n.foreColorIsEqForSegment(l,r,s)}return(0,Ce.XvZ)(r)!==(0,Ce.XvZ)(s)}),(function(e,t){return n.sheetFacade.getSpan(e,t)}))}},{key:"foreColorIsEqForSegment",value:function(e,t,r){for(var n=function(n){var a=function(){var t=e[n];return t.style&&t.style.foreColor||r}();if((0,Ce.XvZ)(a)===(0,Ce.XvZ)(t))return{v:!0}},a=0;a<e.length;a++){var o=n(a);if("object"===(0,R.Z)(o))return o.v}return!1}},{key:"convertNotEqualToEqualValues",value:function(e,t,r,n){var a=kI(this.sheetFacade,e,t,r).valueList,o=[];return a.forEach((function(e){n.includes(e.value)||o.push(e.value)})),o}}]),e}();FI=Vu([(0,st.b)(),Nu(0,(0,lt.f)(Gm))],FI);var ZI=function(){function e(t,r,n,a){var o=this;(0,y.Z)(this,e),this.filterRuleHelper=t,this.rangeFactory=r,this.filterWatchedRefHub=n,this.eventBus=a,this.active=!0,this.hiddenRows$=new ft.X(new Set),this.getCompareTypeAndConditionTypeForEnum=function(){return o.compareType&&o.translateCompareTypeToEnum(o.compareType)||[]},this.translateCompareTypeToEnum=function(e){return new Map([["BeginsWith",[2,2]],["DoesNotBeginWith",[3,2]],["EndsWith",[4,2]],["DoesNotEndWith",[5,2]],["Contains",[6,2]],["DoesNotContain",[7,2]],["BackgroundColor",[0,3]],["ForegroundColor",[1,3]],["Equal",[0,1]],["NotEqual",[1,1]],["Greater",[2,1]],["GreaterOrEqual",[3,1]],["Less",[4,1]],["LessOrEqual",[5,1]],["Between",[6,1]],["NotBetween",[7,1]],["ValueEqual",[0,0]],["ValueNotEqual",[1,0]]]).get(e)},this.getFilteredRows=function(){return(0,m.Z)(o.hiddenRows$.getValue()).sort((function(e,t){return e-t}))},this.getConditionJSON=function(e){if(void 0!==e){var t=o.translateCompareTypeToEnum(e),r=(0,g.Z)(t,2),n=r[0],a=r[1];switch(o.compareType){case"ValueEqual":var i=(0,m.Z)(o.params).map((function(e){return{compareType:0,conType:2,contents:null,expected:e}}));return Array.isArray(o.dateGroups)&&o.dateGroups.length>0?[{compareType:0,conType:2,dateGroups:o.dateGroups}].concat((0,m.Z)(i)):i;case"ValueNotEqual":return(0,m.Z)(o.params).map((function(e){return{compareType:1,conType:0,contents:null,expected:e}}));default:return[{compareType:n,conType:a,contents:null,expected:o.params}]}}},this.lifeCycleSubscribe=this.eventBus.lifeCycle$.subscribe((function(e){"destroy"===e.type&&o.destroy()}))}return(0,_.Z)(e,[{key:"setActive",value:function(e,t){if(this.active!==e){if(this.active=e,!this.active)return this.reset();t||this.reCalc()}}},{key:"reset",value:function(){this.hiddenRows$.next(new Set)}},{key:"reCalc",value:function(){var e=this.range,t=this.compareType,r=this.dateGroups;this.active&&e&&this.setFilterRuleAndCalculate({row:e.rowFrom(),col:e.colFrom(),rowCount:e.rowCount()},t,this.params,r)}},{key:"getRange",value:function(){return this.range?{col:this.range.colFrom(),row:this.range.rowFrom(),rowCount:this.range.rowCount(),colCount:1}:{col:-1,row:-1,rowCount:0,colCount:1}}}]),(0,_.Z)(e,[{key:"destroy",value:function(){this.lifeCycleSubscribe.unsubscribe(),this.range&&this.filterWatchedRefHub.unWatchRef(this.range,null)}},{key:"onAddRows",value:function(e,t){var r=this.hiddenRows$.getValue();if(r.size>0){var n=Array.from(r).map((function(r){return r>=e?r+t:r}));this.hiddenRows$.next(new Set(n))}}},{key:"onDelRows",value:function(e,t){var r=this.hiddenRows$.getValue();if(r.size>0){var n=Array.from(r).filter((function(r){return!(e<=r&&r<e+t)})).map((function(r){return r>=e+t?r-t:r}));this.hiddenRows$.next(new Set(n))}}},{key:"onMoveRange",value:function(e,t){var r=this.hiddenRows$.getValue(),n=t.rowFrom()-e.rowFrom();if(0!==n&&0!==r.size){var a=Array.from(r).map((function(e){return e+n}));this.hiddenRows$.next(new Set(a))}}},{key:"createWatchRange",value:function(e){var t=this.range;t&&this.filterWatchedRefHub.unWatchRef(t,null);var r=this.rangeFactory.createRange(e.row,e.col,e.rowCount,1);return this.filterWatchedRefHub.watchRef(r,null),r}},{key:"updateRange",value:function(e,t){this.range=this.createWatchRange(e),this.active&&t&&this.reCalc()}},{key:"updateHiddenRowsFromSnapshot",value:function(e){this.hiddenRows$.next(new Set((0,m.Z)(e)))}},{key:"setFilterRuleAndCalculate",value:function(e,t,r,n,a){if(this.range=this.createWatchRange(e),this.params=r,this.dateGroups=n,this.compareType=t,this.isValid&&this.active){if(void 0===this.translateCompareTypeToEnum(t))throw new Error("setFilterRuleAndCalculate params error");var o=a?new Set(a):this.getHiddenRows(e,t,r,n);this.hiddenRows$.next(o)}}},{key:"getHiddenRows",value:function(e,t,r,n){var a,o=this.translateCompareTypeToEnum(t);if(void 0===o)throw new Error("setFilterRuleAndCalculate params error");var i=(0,g.Z)(o,1)[0];switch(t){case"BeginsWith":case"DoesNotBeginWith":case"EndsWith":case"DoesNotEndWith":case"Contains":case"DoesNotContain":a=this.filterRuleHelper.filterByTextConditionRule(e,i,r);break;case"BackgroundColor":case"ForegroundColor":a=this.filterRuleHelper.filterByColorConditionRule(e,i,r);break;case"Equal":case"NotEqual":case"Greater":case"GreaterOrEqual":case"Less":case"LessOrEqual":case"Between":case"NotBetween":a=this.filterRuleHelper.filterByNumberConditionRule(e,i,Array.isArray(r)?r:[r]);break;case"ValueEqual":a=this.filterRuleHelper.filterByMultiValueConditionRule(e,r,!1,n);break;case"ValueNotEqual":a=this.filterRuleHelper.filterByMultiValueConditionRule(e,r,!0,n);break;default:throw new Error("setFilterRuleAndCalculate params error")}return a}},{key:"isRowVisible",value:function(e){var t=this.hiddenRows$.getValue();return!this.isValid||!t.has(e)}},{key:"toJSON",value:function(){var e=this.getFilteredRows();return{conditions:this.getConditionJSON(this.compareType),filteredRows:e,index:this.getRange().col}}},{key:"serialize",value:function(e,t){var r=this.getRange().col,n=this.getFilteredRows(),a={};switch(this.compareType){case"ValueEqual":case"ValueNotEqual":var o,i,u=Array.from(this.params);if(i="ValueNotEqual"===this.compareType?this.filterRuleHelper.convertNotEqualToEqualValues(e,r,null!==(o=e.filterRange)&&void 0!==o?o:null,u):u,t){var s=i.map((function(e){return t.filterStrings.addValue(e)}));a.multiFilters={filterIds:s},this.dateGroups&&(a.multiFilters.dateGroupItemIds=this.dateGroups.map((function(e){return t.dateGroupItems.add(e).id})))}else a.multiFilters={filters:i},this.dateGroups&&(a.multiFilters.dateGroupItems=this.dateGroups);break;case"BackgroundColor":case"ForegroundColor":a.colorFilter={value:this.params,cellColor:"BackgroundColor"===this.compareType};break;case"Between":a.customFilters={customFilter:[{operator:Ce.B2l.CustomFilterOperator.CustomFilterOperator_GreaterThanOrEqual,value:this.params[0]},{operator:Ce.B2l.CustomFilterOperator.CustomFilterOperator_LessThanOrEqual,value:this.params[1]}],and:!0};break;case"NotBetween":a.customFilters={customFilter:[{operator:Ce.B2l.CustomFilterOperator.CustomFilterOperator_LessThanOrEqual,value:this.params[0]},{operator:Ce.B2l.CustomFilterOperator.CustomFilterOperator_GreaterThanOrEqual,value:this.params[1]}],and:!1};break;default:if(this.compareType){var l=function(e){switch(e){case"Equal":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_Equal;case"NotEqual":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_NotEqual;case"Greater":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_GreaterThan;case"GreaterOrEqual":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_GreaterThanOrEqual;case"Less":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_LessThan;case"LessOrEqual":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_LessThanOrEqual;case"BeginsWith":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_BeginsWith;case"DoesNotBeginWith":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_DoesNotBeginWith;case"EndsWith":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_EndsWith;case"DoesNotEndWith":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_DoesNotEndWith;case"Contains":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_Contains;case"DoesNotContain":return Ce.B2l.CustomFilterOperator.CustomFilterOperator_DoesNotContain;default:return}}(this.compareType);a.customFilters={customFilter:[{operator:l,value:this.params}]}}}return{colId:r-e.filterRange.colFrom(),condition:a,filteredRows:n}}},{key:"isValid",get:function(){return!!this.range&&this.range.isValid()}}]),e}();ZI=Vu([(0,st.b)(),Nu(0,(0,lt.f)(FI)),Nu(1,(0,lt.f)(gI)),Nu(2,(0,lt.f)(Bm)),Nu(3,(0,lt.f)(_I))],ZI);var xI=function(e,t){if(2===e)switch(t){case 2:return"BeginsWith";case 3:return"DoesNotBeginWith";case 4:return"EndsWith";case 5:return"DoesNotEndWith";case 6:return"Contains";case 7:return"DoesNotContain"}if(1===e)switch(t){case 0:return"Equal";case 1:return"NotEqual";case 2:return"Greater";case 3:return"GreaterOrEqual";case 4:return"Less";case 5:return"LessOrEqual";case 6:return"Between";case 7:return"NotBetween"}if(3===e)switch(t){case 0:return"BackgroundColor";case 1:return"ForegroundColor"}if(0===e)switch(t){case 0:return"ValueEqual";case 1:return"ValueNotEqual"}return null};var DI=function(){function e(t,r,n){var a=this;(0,y.Z)(this,e),this.rangeFactory=t,this.createInstance=r,this.eventBus=n,this.currentRange$=new ft.X(void 0),this.filterRulesSet$=new ft.X(new Set),this.pauseLock$=new ft.X(!1),this.filteredOutRows$=(0,vt.aj)(this.filterRulesSet$.pipe((0,xt.w)((function(e){return e.size?(0,vt.aj)((0,m.Z)(e).map((function(e){return e.hiddenRows$}))):(0,pt.of)([new Set])}))),this.pauseLock$).pipe((0,Dt.h)((function(e){var t=(0,g.Z)(e,2);t[0];return!t[1]&&a.active})),(0,Pt.map)((function(e){return function(e){return e.reduce((function(e,t){return t.forEach((function(t){return e.add(t)})),e}),new Set)}((0,g.Z)(e,1)[0])})),(0,$t.d)(1)),this.filteredOutRows=new Set,this.active=!0,this.filteredOutRowsSub=this.filteredOutRows$.subscribe((function(e){return a.filteredOutRows=e})),this.getAllRuleSorted=function(){return(0,m.Z)(a.filterRulesSet).sort((function(e,t){return e.getRange().col-t.getRange().col}))},this.dataEventSub=this.eventBus.actionEventBus$.subscribe((function(e){switch(e.type){case"addRows":a.onAddRows(e.row,e.count);break;case"deleteRows":a.onDelRows(e.row,e.count);break;case"deleteCols":a.onDeleteCols(e.col,e.count);break;case"moveRange":var t=e.sourceRange,r=e.targetRange,n=a.filterRange;n&&t&&r&&t.contain(n)&&a.onMoveRange(t,r)}}))}return(0,_.Z)(e,[{key:"filterRange",get:function(){return this.currentRange$.getValue()}},{key:"filterRulesSet",get:function(){return this.filterRulesSet$.getValue()}}]),(0,_.Z)(e,[{key:"destroy",value:function(){var e,t;this.filterRulesSet.forEach((function(e){return e.destroy()})),null!==(e=this.filterRange)&&void 0!==e&&e.destroy(),this.filteredOutRowsSub.unsubscribe(),null===(t=this.dataEventSub)||void 0===t||t.unsubscribe()}},{key:"recalc",value:function(){this.getValidFilterRules().forEach((function(e){return e.reCalc()}))}},{key:"setActive",value:function(e){var t=this;this.active!==e&&(this.active=e,this.getValidFilterRules().forEach((function(e){e.setActive(t.active)})))}},{key:"getFilterRange",value:function(){var e=this.filterRange;return e?e.toJSON():{col:-1,row:-1,colCount:0,rowCount:0}}},{key:"getAllFilteredOutRows",value:function(){return this.filteredOutRows}},{key:"getFilterRules",value:function(e){var t=this.filterRulesSet$.getValue(),r=new Map,n=this.filterRange;if(!n)return r;var a=n.colFrom(),o=n.colTo();return t.forEach((function(t){var n=t.getRange().col;(!e||n>=a&&n<=o)&&r.set(n,t)})),r}},{key:"getValidFilterRules",value:function(){return this.getFilterRules(!0)}},{key:"hasFilter",value:function(){return Boolean(this.filterRange)}},{key:"hasRule",value:function(){return this.getValidFilterRules().size>0}},{key:"getFilteredOutRows",value:function(){var e=this.getAllFilteredOutRows();return e?(0,m.Z)(e).sort((function(e,t){return e-t})):[]}},{key:"toJSON",value:function(){var e=this.filterRange;if(e){var t=e.toJSON();t.row+=1,t.rowCount-=1;var r=this.getAllRuleSorted(),n=this.getFilteredOutRows();return{range:t,filteredColumns:r.map((function(e){return e.getRange().col})),filteredOutRows:n,filterItemMap:r.map((function(e){return e.toJSON()}))}}}},{key:"serialize",value:function(e){var t=this,r=this.filterRange;if(r){var n=this.getAllRuleSorted().map((function(r){return r.serialize(t,e)}));return{range:r.toGridJSON(!1),filterColumns:n}}}},{key:"deserialize",value:function(e,t){var r=this,n=e.range,a=n.startRow,o=n.startCol,i=n.endRow,u=n.endCol;this.setRange({row:a,col:o,rowCount:i-a,colCount:u-o});var s=e.filterColumns;null==s||s.forEach((function(e){var n=e.colId,a=e.condition,i=e.filteredRows,u=void 0===i?[]:i,s=o+n;if(null!=a&&a.multiFilters){var l,c,h,f,d=[],v=[];null!==(l=a.multiFilters.filters)&&void 0!==l&&l.length?d=a.multiFilters.filters:(null===(c=a.multiFilters.filterIds)||void 0===c?void 0:c.length)&&(null==t?void 0:t.filterStrings)&&(d=a.multiFilters.filterIds.map((function(e){return t.filterStrings[e]}))),null!==(h=a.multiFilters.dateGroupItems)&&void 0!==h&&h.length?v=a.multiFilters.dateGroupItems:(null===(f=a.multiFilters.dateGroupItemIds)||void 0===f?void 0:f.length)&&(null==t?void 0:t.dateGroupItems)&&(v=a.multiFilters.dateGroupItemIds.map((function(e){return t.dateGroupItems[e]}))),r.setFilterForHuman(s,"ValueEqual",d,u,v)}else if(null!=a&&a.customFilters){var p=a.customFilters,m=p.customFilter,g=p.and;if(1===(null==m?void 0:m.length)){var y=m[0],_=y.operator,R=y.value,C=function(e){switch(e){case Ce.B2l.CustomFilterOperator.CustomFilterOperator_Equal:return"Equal";case Ce.B2l.CustomFilterOperator.CustomFilterOperator_NotEqual:return"NotEqual";case Ce.B2l.CustomFilterOperator.CustomFilterOperator_GreaterThan:return"Greater";case Ce.B2l.CustomFilterOperator.CustomFilterOperator_GreaterThanOrEqual:return"GreaterOrEqual";case Ce.B2l.CustomFilterOperator.CustomFilterOperator_LessThan:return"Less";case Ce.B2l.CustomFilterOperator.CustomFilterOperator_LessThanOrEqual:return"LessOrEqual";case Ce.B2l.CustomFilterOperator.CustomFilterOperator_BeginsWith:return"BeginsWith";case Ce.B2l.CustomFilterOperator.CustomFilterOperator_DoesNotBeginWith:return"DoesNotBeginWith";case Ce.B2l.CustomFilterOperator.CustomFilterOperator_EndsWith:return"EndsWith";case Ce.B2l.CustomFilterOperator.CustomFilterOperator_DoesNotEndWith:return"DoesNotEndWith";case Ce.B2l.CustomFilterOperator.CustomFilterOperator_Contains:return"Contains";case Ce.B2l.CustomFilterOperator.CustomFilterOperator_DoesNotContain:return"DoesNotContain";default:return"Equal"}}(_);r.setFilterForHuman(s,C,R,u)}else if(2===(null==m?void 0:m.length)){var w=[m[0].value,m[1].value],E=g?"Between":"NotBetween";r.setFilterForHuman(s,E,w,u)}}else if(null!=a&&a.colorFilter){var k=a.colorFilter.value,T=a.colorFilter.cellColor?"BackgroundColor":"ForegroundColor";r.setFilterForHuman(s,T,k,u)}}))}},{key:"setRange",value:function(e,t){var r=e.row,n=e.col,a=e.rowCount,o=e.colCount,i=this.rangeFactory.createWatchedRange(r,n,a,o),u=!!this.filterRange&&i.equal(this.filterRange);u?i.destroy():(this.disposePreviousRange(),this.currentRange$.next(i)),this.pauseLock$.next(!0);var s,l=yr(this.filterRulesSet);try{for(l.s();!(s=l.n()).done;){var c=s.value,h=c.getRange().col;h<=i.colTo()&&h>=i.colFrom()?(this.active&&c.setActive(!0,!0),u?t&&c.reCalc():c.updateRange({row:i.rowFrom()+1,col:h,rowCount:i.rowCount()-1},t)):c.setActive(!1)}}catch(e){l.e(e)}finally{l.f()}var f=this.filterRulesSet$.getValue();this.filterRulesSet$.next(f),this.pauseLock$.next(!1)}},{key:"removeRange",value:function(){this.disposePreviousRange(),this.currentRange$.next(void 0)}},{key:"disposePreviousRange",value:function(){var e;null===(e=this.filterRange)||void 0===e||e.destroy()}},{key:"isVisible",value:function(e){return!this.filteredOutRows.has(e)}},{key:"isCompletelyFilteredOut",value:function(){if(!this.filterRange)return!0;var e=this.filteredOutRows.size;return 0!==e&&e===this.filterRange.rowCount(!0)-1}},{key:"removeFilter",value:function(){this.removeRange(),this.filterRulesSet$.getValue().forEach((function(e){return e.destroy()})),this.filterRulesSet$.next(new Set)}},{key:"setFilterForHuman",value:function(e,t,r,n,a){var o=this.filterRange;if(o){var i=o.colTo(),u=o.colFrom();if(!(e>i||e<u)){var s=this.createInstance(ZI);s.setActive(this.active);var l=this.getRuleByCol(e);l&&this.removeFilterRule(l),this.setFilterDry(s,e,o,t,r,n,a);var c=this.filterRulesSet$.getValue();return c.add(s),this.filterRulesSet$.next(c),s}console.warn("invalida range col")}else console.warn("please call set range before set filter")}},{key:"setFilterDry",value:function(e,t,r,n,a,o,i){var u={row:r.rowFrom()+1,col:t,rowCount:r.rowCount()-1};switch(n){case"BeginsWith":case"DoesNotBeginWith":case"EndsWith":case"DoesNotEndWith":case"Contains":case"DoesNotContain":case"BackgroundColor":case"ForegroundColor":case"Equal":case"NotEqual":case"Greater":case"GreaterOrEqual":case"Less":case"LessOrEqual":case"Between":case"NotBetween":e.setFilterRuleAndCalculate(u,n,a,i,o);break;case"ValueEqual":case"ValueNotEqual":e.setFilterRuleAndCalculate(u,n,Boolean(a)?Array.isArray(a)?new Set(a):a:new Set,i,o);break;default:throw new Error("setFilterRuleAndCalculate params error")}}},{key:"filterWithNewRule",value:function(e,t,r,n,a,o){var i=this.filterRange;if(!i)return[];var u=t-i.colFrom(),s=[];if(null===e)s[u]=[];else{var l=this.createInstance(ZI),c=xI(e,r);this.setFilterDry(l,t,i,c,a||n,void 0,o);var h=l.getFilteredRows();l.destroy(),s[u]=h}return this.recalcRuleExepctForCol(t,s),s}},{key:"recalcRuleExepctForCol",value:function(e,t){for(var r=this.getValidFilterRules(),n=this.getFilterRange(),a=n.col,o=n.colCount,i=0;i<o;i++){var u=a+i;if(u!==e){var s=r.get(u);if(s){if(s.reCalc(),t){var l=s.getFilteredRows();t[i]=l}}else t&&(t[i]=[])}}}},{key:"removeFilterRuleByCol",value:function(e){var t=this.getRuleByCol(e);return!!t&&(this.removeFilterRule(t),!0)}},{key:"setFilter",value:function(e,t,r){var n=xI(t.conType,t.compareType);if(r&&this.updateHiddenRowsFromSync(e,r),null!==t.expected){if(n){var a=e-this.getFilterRange().col;this.setFilterForHuman(e,n,t.expected,r?r[a]:void 0,t.dateGroups)}}else this.removeFilterRuleByCol(e)}},{key:"updateHiddenRowsFromSync",value:function(e,t){for(var r=this.getValidFilterRules(),n=this.getFilterRange(),a=n.col,o=n.colCount,i=0;i<o;i++){var u=a+i;if(u!==e){var s=r.get(u);s&&t[i]&&s.updateHiddenRowsFromSnapshot(t[i])}}}},{key:"getInfo",value:function(){return this.hasFilter()?{range:this.filterRange,filteredOutRows:this.filteredOutRows}:null}},{key:"getAllFilteredOutRowsArray",value:function(){return Array.from(this.getAllFilteredOutRows()).sort((function(e,t){return e-t}))}},{key:"getFilterInfo",value:function(e){if(!this.hasFilter())return null;var t=this.getValidFilterRules().get(e);if(!t)return null;var r=t.getCompareTypeAndConditionTypeForEnum(),n=(0,g.Z)(r,2),a=n[0],o=n[1],i=this.getFilteredRowsMap();return 0===o?Object.assign({col:e,type:0,compare:a,expected:"",contents:(0,m.Z)(t.params),filteredRowsMap:i},t.dateGroups?{dateGroups:t.dateGroups}:{}):Object.assign({col:e,type:o,compare:a,expected:t.params,contents:null,filteredRowsMap:i},t.dateGroups?{dateGroups:t.dateGroups}:{})}},{key:"getFilteredRowsMap",value:function(){for(var e=this.getValidFilterRules(),t=[],r=this.getFilterRange(),n=0;n<r.colCount;n++){var a=r.col+n,o=e.get(a);t[n]=o?o.getFilteredRows():[]}return t}},{key:"removeFilterRule",value:function(e){e.destroy();var t=this.filterRulesSet;t.delete(e),this.filterRulesSet$.next(t)}},{key:"getRuleByCol",value:function(e){var t,r=yr(this.filterRulesSet);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n.getRange().col===e)return n}}catch(e){r.e(e)}finally{r.f()}}},{key:"isRowNotFilteredOutByOtherColumn",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.filterRange;if(!n)return!0;if(!r&&(t<n.colFrom()||t>n.colTo()))return!0;var a,o=yr(this.getValidFilterRules());try{for(o.s();!(a=o.n()).done;){var i=(0,g.Z)(a.value,2),u=i[0],s=i[1];if((r||u!==t)&&!s.isRowVisible(e))return!1}}catch(e){o.e(e)}finally{o.f()}return!0}},{key:"getFilterButton",value:function(e,t){if(!this.filterRange)return null;var r=this.getFilterRange();if(e!==r.row)return null;if(t>=r.col+r.colCount||t<r.col)return null;var n=this.getValidFilterRules();return{row:e,col:t,active:Boolean(n.get(t)),filteredRowCount:0}}},{key:"onAddRows",value:function(e,t){this.filterRulesSet.forEach((function(r){return r.onAddRows(e,t)}))}},{key:"onDelRows",value:function(e,t){this.filterRulesSet.forEach((function(r){return r.onDelRows(e,t)}))}},{key:"onDeleteCols",value:function(e,t){for(var r=0;r<t;r++)this.removeFilterRuleByCol(r+e)}},{key:"onMoveRange",value:function(e,t){this.filterRulesSet.forEach((function(r){return r.onMoveRange(e,t)}))}},{key:"info",get:function(){return this.getInfo()}}]),e}();DI=Vu([(0,st.b)(),Nu(0,(0,lt.f)(gI)),Nu(1,(0,lt.f)(Um)),Nu(2,(0,lt.f)(_I))],DI);var PI=function(e){if(e){var t={conType:null===e.type?0:e.type,col:e.col,compareType:e.compare,expected:null===e.type?e.contents:e.expected};return e.dateGroups&&e.dateGroups.length>0&&(t.dateGroups=e.dateGroups),0===e.type&&(t.expected=e.contents),e.filteredRowsMap&&(t.filteredRowsMap=e.filteredRowsMap),t}},$I=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),t}(DI),LI=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.sheetRowCount,n=null==e.rowCount?1:e.rowCount+1,a=e.row>0?e.row-1:0;return void 0!==r&&a+n-1>=r&&(n=Math.max(1,r-a)),{col:e.col,colCount:e.colCount,row:a,rowCount:n}},BI=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=e.range,a=e.filterItemMap;return t.setRange(LI(n,r)),a&&a.forEach((function(e){var r=e.index,n=e.conditions,a=e.filteredRows?e.filteredRows:[];if(n&&n[0]){var o=n[0],i=o.conType,u=o.compareType,s=o.expected,l=o.dateGroups;if(2===i&&0===u){var c,h=new Set,f=[],d=yr(n);try{for(d.s();!(c=d.n()).done;){var v=c.value;Array.isArray(v.expected)||(0,re.Z)(v.expected)||h.add(v.expected),Array.isArray(v.dateGroups)&&(0,Ce.hTd)(f,v.dateGroups)}}catch(e){d.e(e)}finally{d.f()}return t.setFilterForHuman(r,"ValueEqual",h,a,f)}var p=xI(i,u);return null!==p?t.setFilterForHuman(r,p,s,a,l):void 0}})),t},UI=function(){function e(){(0,y.Z)(this,e),this.gridLineHidden$=new ft.X(!1)}return(0,_.Z)(e,[{key:"getGridLine",value:function(){return this.gridLineHidden$.getValue()}},{key:"setGridLine",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.getGridLine()!==e&&this.gridLineHidden$.next(e)}}]),e}();UI=Vu([(0,st.b)()],UI);var HI=function(){function e(){(0,y.Z)(this,e),this.tabColor$=new ft.X("")}return(0,_.Z)(e,[{key:"getTabColor",value:function(){return this.tabColor$.getValue()}},{key:"setTabColor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.getTabColor()!==e&&this.tabColor$.next(e)}}]),e}();HI=Vu([(0,st.b)()],HI);var zI=function(){function e(t){(0,y.Z)(this,e),this.sheet=t}return(0,_.Z)(e,[{key:"setViewRange",value:function(e,t){var r=(0,Ce.US_)(e);return this.sheet.setFilterView(e,r,{range:t,col:null,value:null})}}]),e}();zI=Vu([(0,st.b)(),Nu(0,(0,lt.f)(Lm))],zI);var WI=function(){function e(){(0,y.Z)(this,e),this._enabled$=new ft.X(!1),this._cellColors$=new ft.X(new qd),this._dirtyRect$=new ft.X(void 0),this.enabled$=this._enabled$.asObservable(),this.cellColors$=this._cellColors$.asObservable(),this.dirtyRect$=this._dirtyRect$.asObservable()}return(0,_.Z)(e,[{key:"setEnable",value:function(e){e!==this.enabled&&this._enabled$.next(e)}},{key:"setDirtyRect",value:function(e){this._dirtyRect$.next(e)}},{key:"setCellColors",value:function(e){this._cellColors$.next(e)}},{key:"enabled",get:function(){return this._enabled$.getValue()}},{key:"cellColors",get:function(){return this._cellColors$.getValue()}}]),e}();WI=Vu([(0,st.b)()],WI);function GI(e,t){return e.row===t.row?e.col-t.col:e.row-t.row}var jI=function(){function e(){(0,y.Z)(this,e),this.searchRstAbove=[],this.searchRstBelow=[]}return(0,_.Z)(e,[{key:"getSearchFormulaCount",value:function(){for(var e=0,t=0;t<this.searchRstAbove.length;t++)this.searchRstAbove[t].hasFormula&&e++;for(var r=0;r<this.searchRstBelow.length;r++)this.searchRstBelow[r].hasFormula&&e++;return e}},{key:"getSearchPivotTableCount",value:function(){for(var e=0,t=0;t<this.searchRstAbove.length;t++)this.searchRstAbove[t].hasPivotTable&&e++;for(var r=0;r<this.searchRstBelow.length;r++)this.searchRstBelow[r].hasPivotTable&&e++;return e}},{key:"addSearchResult",value:function(e,t){if(e.sort(GI),0!==e.length)if(t){var r=this.searchRstAbove[this.searchRstAbove.length-1],n=r?(0,Yt.upperBound)(e,r,(function(e,t){return GI(e,t)<0})):0;this.mergeAndupdate(this.searchRstAbove,e,0,n,!0),this.mergeAndupdate(this.searchRstBelow,e,n,e.length,!1)}else{var a=this.searchRstBelow[0];a&&GI(a,e[0])>0?this.mergeAndupdate(this.searchRstAbove,e,0,e.length,!0):this.mergeAndupdate(this.searchRstBelow,e,0,e.length,!1)}}},{key:"mergeAndupdate",value:function(e,t,r,n,a){var o=e.length,i=n-r;if(!(i<=0)){e.length=o+i;for(var u=o+i-1,s=o-1,l=i-1;s>=0&&l>=0;){var c=GI(e[s],t[r+l]);c>0?(e[u]=e[s],s--):c<0?(e[u]=t[r+l],l--):(e[u]=e[s],s--,l--),u--}for(;s>=0;)e[u]=e[s],s--,u--;for(;l>=0;)e[u]=t[r+l],l--,u--;for(var h=u+1,f=e.length-h,d=0;d<f;d++){var v=e[d+h];v.index=a?-(d+1):d,e[d]=v}e.length=f}}},{key:"getSearchItems",value:function(){return this.searchRstAbove.concat(this.searchRstBelow)}},{key:"getSearchItem",value:function(e){return e<0?this.searchRstAbove[Math.abs(e)-1]:this.searchRstBelow[e]}},{key:"getSearchNext",value:function(e){return e<0?this.searchRstAbove[Math.abs(e-1)-1]||this.searchRstBelow[0]:this.searchRstBelow[e+1]}},{key:"getSearchPrev",value:function(e){return e<0?this.searchRstAbove[Math.abs(e+1)-1]:this.searchRstBelow[e-1]||this.searchRstAbove[this.searchRstAbove.length-1]}},{key:"getSearchFirst",value:function(){return this.searchRstAbove[0]||this.searchRstBelow[0]}},{key:"getSearchLast",value:function(){return 0===this.searchRstBelow.length&&this.searchRstAbove.length>0?this.searchRstAbove[this.searchRstAbove.length-1]:this.searchRstBelow[this.searchRstBelow.length-1]}},{key:"getSearchResultLength",value:function(){return this.searchRstAbove.length+this.searchRstBelow.length}},{key:"getSearchResultCellCore",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=su(this.searchRstAbove,e,GI,t),n=this.searchRstAbove[r];if(n&&0===GI(n,e))return n;var a=su(this.searchRstBelow,e,GI,t),o=this.searchRstBelow[a];return o&&0===GI(o,e)?o:t?o||n||this.searchRstAbove[0]||this.searchRstBelow[0]:void 0}},{key:"getSearchResultCell",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n={row:e,col:t};return this.getSearchResultCellCore(n,r)}},{key:"getSearchRank",value:function(e){return e<0?-e-1:this.searchRstAbove.length+e}},{key:"removeItem",value:function(e){var t;if(e<0){var r=Math.abs(e)-1;t=this.searchRstAbove.splice(r,1);for(var n=r;n<this.searchRstAbove.length;n++)this.searchRstAbove[n].index++}else{var a=e;t=this.searchRstBelow.splice(a,1);for(var o=a;o<this.searchRstBelow.length;o++)this.searchRstBelow[o].index--}if(1===t.length)return t[0]}},{key:"removeSearchResult",value:function(e){e&&(this.removeWithRange(this.searchRstAbove,e,!0),this.removeWithRange(this.searchRstBelow,e))}},{key:"removeAndUpdate",value:function(e,t,r){if(0!==e.length){var n,a=0,o=yr(e);try{for(o.s();!(n=o.n()).done;){var i=n.value;t(i)||(i.index=r?-(a+1):a,e[a++]=i)}}catch(e){o.e(e)}finally{o.f()}e.length=a}}},{key:"removeWithRange",value:function(e,t,r){var n=t.rowStart,a=t.rowEnd,o=t.colStart,i=t.colEnd;this.removeAndUpdate(e,(function(e){var t=e.row,r=e.col;return t>=n&&t<a&&r>=o&&r<i}),r)}},{key:"clear",value:function(){this.searchRstAbove=[],this.searchRstBelow=[]}}]),e}(),YI="var(--B500-FG, 0.2)",qI=function(){function e(t){(0,y.Z)(this,e),this.enabled$=new ft.X(!1),this.highlightColor$=new ft.X(YI),this.activeColor$=new ft.X(YI),this.activeCell$=new ft.X([-1,-1]),this.cellHighlightModel=t,this.searchResults=new jI,this.activeCell$.pipe((0,Lt.G)()).subscribe(this.updateActiveCellColor.bind(this)),this.highlightColor$.pipe((0,Lt.G)()).subscribe(this.updateHighlightColor.bind(this))}return(0,_.Z)(e,[{key:"updateActiveCellColor",value:function(e){var t=(0,g.Z)(e,2),r=t[0],n=t[1],a=!1;return this.cellHighlightModel.cellColors.has(r[0],r[1])&&(a=!0,this.cellHighlightModel.cellColors.set(r[0],r[1],this.searchHighlightColor)),this.cellHighlightModel.cellColors.has(n[0],n[1])&&(a=!0,this.cellHighlightModel.cellColors.set(n[0],n[1],this.searchActiveColor)),a&&this.cellHighlightModel.setCellColors(this.cellHighlightModel.cellColors),a}},{key:"updateHighlightColor",value:function(e){var t=this,r=(0,g.Z)(e,2),n=r[0],a=r[1];if(n!==a){var o=this.activeCell$.getValue(),i=o[0],u=o[1];this.cellHighlightModel.cellColors.forEach((function(e,r,n){i===r&&u===n||t.cellHighlightModel.cellColors.set(r,n,a)})),this.cellHighlightModel.setCellColors(this.cellHighlightModel.cellColors)}}},{key:"setEnable",value:function(e){return e!==this.searchHighlightEnabled&&(this.enabled$.next(e),this.cellHighlightModel.setEnable(e),!1===e&&(this.setActiveCell(-1,-1),this.searchResults.clear(),this.cellHighlightModel.cellColors.clear(),this.setDirtyRect(void 0)),!0)}},{key:"setHighlightColor",value:function(e){e!==this.searchHighlightColor&&this.highlightColor$.next(e)}},{key:"setActiveColor",value:function(e){e!==this.searchActiveColor&&this.activeColor$.next(e)}},{key:"setActiveCell",value:function(e,t){return!(e>0&&t>0&&!this.cellHighlightModel.cellColors.has(e,t)||(this.activeCell$.next([e,t]),0))}},{key:"getSearchFormulaCount",value:function(){return this.searchResults.getSearchFormulaCount()}},{key:"getSearchPivotTableCount",value:function(){return this.searchResults.getSearchPivotTableCount()}},{key:"getSearchItems",value:function(){return this.searchResults.getSearchItems()}},{key:"getSearchItem",value:function(e){return this.searchResults.getSearchItem(e)}},{key:"getSearchNext",value:function(e){return this.searchResults.getSearchNext(e)}},{key:"getSearchPrev",value:function(e){return this.searchResults.getSearchPrev(e)}},{key:"getSearchFirst",value:function(){return this.searchResults.getSearchFirst()}},{key:"getSearchLast",value:function(){return this.searchResults.getSearchLast()}},{key:"getSearchResultLength",value:function(){return this.searchResults.getSearchResultLength()}},{key:"getSearchResultCell",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.searchResults.getSearchResultCell(e,t,r)}},{key:"getSearchRank",value:function(e){return this.searchResults.getSearchRank(e)}},{key:"removeSearchResult",value:function(e,t){if(e){this.searchResults.removeSearchResult(e);for(var r=e.rowStart,n=e.rowEnd,a=e.colStart,o=e.colEnd,i=r;i<n;i++)for(var u=a;u<o;u++)this.cellHighlightModel.cellColors.has(i,u)&&this.cellHighlightModel.cellColors.delete(i,u);this.cellHighlightModel.setCellColors(this.cellHighlightModel.cellColors),this.setDirtyRect(t)}}},{key:"addSearchResult",value:function(e,t,r){var n=this;e.length&&(this.searchResults.addSearchResult(e,r),e.forEach((function(e){n.cellHighlightModel.cellColors.set(e.row,e.col,n.searchHighlightColor)})),this.cellHighlightModel.setCellColors(this.cellHighlightModel.cellColors),this.setDirtyRect(t))}},{key:"setDirtyRect",value:function(e){this.cellHighlightModel.setDirtyRect(e)}},{key:"searchHighlightEnabled",get:function(){return this.enabled$.getValue()}},{key:"searchHighlightColor",get:function(){return this.highlightColor$.getValue()}},{key:"searchActiveColor",get:function(){return this.activeColor$.getValue()}}]),e}();qI=Vu([(0,st.b)(),Nu(0,(0,lt.f)(WI))],qI);var JI=function(){function e(t){var r=this;(0,y.Z)(this,e),this.sheet=t,this._dirtyRect$=new ft.X(void 0),this.dirtyRect$=this._dirtyRect$.asObservable(),this.setDirtyRect=function(e){Ce.Ps3.browser.isMobile?r.sheet.notifyShell(94,e):r._dirtyRect$.next(e)}}return(0,_.Z)(e,[{key:"setDirtyCell",value:function(e,t){var r=new bt.FRect(t,e,1,1);this.setDirtyRect(r)}},{key:"setSourceHighlightRange",value:function(e){this.sourceHighlightRange=e,this.sheet.notifyShell(108,{ranges:e,type:0})}},{key:"setGroupHighlightRange",value:function(e){this.groupHighlightRange=e,this.sheet.notifyShell(108,{ranges:e,type:1})}},{key:"removeSourceHighlightRange",value:function(){this.sourceHighlightRange=[],this.sheet.notifyShell(109,{type:0})}},{key:"removeGroupHighlightRange",value:function(){this.groupHighlightRange=[],this.sheet.notifyShell(109,{type:1})}},{key:"getSourceHighlightRange",value:function(){return this.sourceHighlightRange}},{key:"getGroupHighlightRange",value:function(){return this.groupHighlightRange}}]),e}();JI=Vu([(0,st.b)(),Nu(0,(0,lt.f)(Lm))],JI);var KI=function(){function e(t){(0,y.Z)(this,e),this.filterModel=t,this.name$=new ft.X(""),this.filterModel.setActive(!1),this.filterModel.setRange({row:0,rowCount:1,col:0,colCount:1})}return(0,_.Z)(e,[{key:"setName",value:function(e){this.name$.next(e)}},{key:"getFilterModel",value:function(){return this.filterModel}},{key:"getId",value:function(){return this.id}},{key:"getName",value:function(){return this.name$.getValue()}},{key:"destroy",value:function(){this.filterModel.destroy(),this.name$.complete()}},{key:"toJSON",value:function(){var e=this.filterModel.toJSON(),t={id:this.id,name:this.name$.getValue()};return e&&Object.assign(t,{rowFilter:e}),t}},{key:"serialize",value:function(e){var t=this.filterModel.serialize(e);return{id:this.getId(),name:this.getName(),autoFilter:t}}},{key:"deactiveFilterModel",value:function(){this.filterModel.setActive(!1)}},{key:"activeFilterModel",value:function(){this.filterModel.setActive(!0)}}]),e}();KI=Vu([(0,st.b)(),Nu(0,(0,lt.f)(DI))],KI);var XI=function(e){var t=e.range.col;return{filterRules:(0,z.Z)(e.filterItemMap,(function(e,r){if(!r.conditions||!r.conditions[0])return e;var n=r.conditions[0].compareType;return function(e){var t=(0,g.Z)(e,1)[0];return 2===t.conType&&0===t.compareType||0===t.conType}(r.conditions)?Object.assign(e,(0,l.Z)({},r.index-t,{compareType:n,conType:0,contents:(0,H.default)(r.conditions,(0,U.Z)("expected")).filter((function(e){return!(0,re.Z)(e)})),dateGroups:(0,B.Z)((0,H.default)(r.conditions,(0,U.Z)("dateGroups"))).filter((function(e){return!(0,re.Z)(e)}))})):Object.assign(e,(0,l.Z)({},r.index-t,{compareType:r.conditions[0].compareType,conType:r.conditions[0].conType,contents:r.conditions[0].expected}))}),{}),range:e.range}},QI=function(){function e(t,r,n){var a=this;(0,y.Z)(this,e),this.getService=t,this.t=r,this.sheetFilterModel=n,this.viewMaps=new Map,this.viewIdList$=new ft.X([]),this.activeView$=new ft.X(null),this.viewList$=this.viewIdList$.pipe((0,Pt.map)((function(e){return e.reverse().sort((function(e,t){var r=(0,Ce.US_)(e);return r===(0,Ce.US_)(t)?0:r?-1:1})).map((function(e){return a.viewMaps.get(e)}))})))}return(0,_.Z)(e,[{key:"getActiveViewId",value:function(){if(this.activeView)return this.activeView.id}},{key:"tryEntryViewById",value:function(e){var t=this.activeView$.getValue(),r=this.viewMaps.get(e);if(!r)return!1;if(t){if(t.id===e)return!0;t.deactiveFilterModel()}return r.activeFilterModel(),this.activeView$.next(r),!0}},{key:"tryExistView",value:function(){var e=this.activeView$.getValue();e&&(e.deactiveFilterModel(),this.activeView$.next(null))}},{key:"deleteViewById",value:function(e){var t=this.viewIdList$.getValue();this.viewIdList$.next(t.filter((function(t){return t!==e})));var r=this.viewMaps.get(e);r&&r.destroy(),this.getActiveViewId()===e&&this.activeView$.next(null),this.viewMaps.delete(e),(0,Ce.y_b)(e)&&this.unwatchSheetFilterRange()}},{key:"addView",value:function(e,t,r){var n=this.viewIdList$.getValue(),a=this.getService(KI);return r&&a.filterModel.removeFilter(),a.id=e,a.setName(t),this.viewMaps.set(e,a),this.viewIdList$.next([].concat((0,m.Z)(n),[e])),(0,Ce.y_b)(e)&&this.watchSheetFilterRange(),a}},{key:"destroy",value:function(){var e,t=yr(this.viewMaps.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(e){t.e(e)}finally{t.f()}this.activeView$.complete(),this.viewIdList$.complete(),this.unwatchSheetFilterRange()}},{key:"getViewById",value:function(e){return this.viewMaps.get(e)}},{key:"assignViewName",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=new Set,n=yr(this.viewMaps.values());try{for(n.s();!(e=n.n()).done;){var a=e.value;r.add(a.getName())}}catch(e){n.e(e)}finally{n.f()}for(var o=1,i=t?this.t("CreationDoc_Sheets_Filter_DefaultTemporaryViewName"):this.t("sheets.filter_view.hover_create_new");;){var u=o>1?i+" "+o:i;if(!r.has(u))return u;o++}}},{key:"assignViewId",value:function(){for(var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=10,r=e?"":Ce.dux;;){var n=(0,Ce.zsn)(t);if(!n.startsWith(Ce.dux)&&!n.startsWith(Ce.Bge)){var a=r+n;if(!this.viewMaps.has(a))return a}}}},{key:"assignPersonalViewId",value:function(){return Ce.G2r}},{key:"isNameExit",value:function(e){var t,r=yr(this.viewMaps.values());try{for(r.s();!(t=r.n()).done;){if(t.value.getName()===e)return!0}}catch(e){r.e(e)}finally{r.f()}return!1}},{key:"toJSON",value:function(){var e,t=[],r=yr(this.viewMaps.values());try{for(r.s();!(e=r.n()).done;){var n=e.value;if(!(0,Ce.US_)(n.id)){var a=n.toJSON();a.rowFilter&&(a.rowFilter=XI(a.rowFilter),t.push(a))}}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"serialize",value:function(e){var t,r=[],n=yr(this.viewMaps.values());try{for(n.s();!(t=n.n()).done;){var a=t.value;(0,Ce.US_)(a.id)||r.push(a.serialize(e))}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"getViewList",value:function(){var e=this;return this.viewIdList$.getValue().map((function(t){return e.viewMaps.get(t)}))}},{key:"isTempView",value:function(e){return(0,Ce.US_)(e.id)}},{key:"isInPersonalTempView",value:function(){return!!this.activeView&&(0,Ce.y_b)(this.activeView.id)}},{key:"getCurrentFilterModel",value:function(e){if(e){var t=this.viewMaps.get(e);return t?t.filterModel:void 0}var r=this.activeView;return r?r.filterModel:this.sheetFilterModel}},{key:"getAllColFilterInfo",value:function(e){var t=this.getCurrentFilterModel(e);if(!t)return[];var r=t.getValidFilterRules(),n=[];return(0,m.Z)(r).forEach((function(e){var r=(0,g.Z)(e,1)[0],a=t.getFilterInfo(r);a&&n.push(a)})),n}},{key:"watchSheetFilterRange",value:function(){var e=this;this.unwatchSheetFilterRange(),this.sheetFilterRangeSub=this.sheetFilterModel.currentRange$.pipe((0,xt.w)((function(e){return e?e.$:(0,pt.of)(void 0)})),(0,Bt.T)(1),(0,Ut.QV)(mt.P)).subscribe((function(t){var r=e.personalView;if(r){var n=r.getId(),a=r.getFilterModel(),o=a.filterRange;t&&o?t.equal(o)||a.setRange(t.toJSON()):e.deleteViewById(n)}}))}},{key:"unwatchSheetFilterRange",value:function(){var e;null===(e=this.sheetFilterRangeSub)||void 0===e||e.unsubscribe()}},{key:"activeView",get:function(){return this.activeView$.getValue()}},{key:"personalView",get:function(){return this.viewMaps.get(Ce.G2r)}}]),e}();Vu([(0,ut.P)()],QI.prototype,"destroy",null),QI=Vu([(0,st.b)(),Nu(0,(0,lt.f)(Um)),Nu(1,(0,lt.f)(Hm)),Nu(2,(0,lt.f)($I))],QI);var eO=function(e,t,r){(0,L.Z)(t,(function(t){t.rowFilter&&function(e,t,r){var n=t.range.col,a={filterItemMap:(0,H.default)(t.filterRules,(function(e,t){var r=e.compareType,a=e.contents,o=e.dateGroups;return{conditions:[{compareType:r,conType:e.conType,contents:a,dateGroups:o,expected:a}],filteredRows:[],index:n+Number(t)}})),range:t.range};BI(a,e,r)}(e.addView(t.id,t.name).filterModel,t.rowFilter,r)}))};var tO,rO,nO,aO,oO=/^[-+]/,iO=/(\-?\d+)(\D*)$/,uO=/(\-?\d+)$/,sO=/(^\d+)/,lO=/(\d+)$/,cO=/^(\D)(\D*)/,hO="model/fill/cycle-calendars",fO=function(){function e(){(0,y.Z)(this,e),this.cycleCalendarsConfig=[],this.cycleMap={},this._caseIngore=!0}return(0,_.Z)(e,[{key:"registerCycleCalendars",value:function(e){(0,Ce.hTd)(this.cycleCalendarsConfig,e);for(var t=0,r=this.cycleCalendarsConfig.length;t<r;t++){var n=this.cycleCalendarsConfig[t],a=n.type,o=n.cycle;this.cycleMap[a]=o}}},{key:"closeCaseIgnore",value:function(){this._caseIngore=!1}},{key:"getCycleInfoByText",value:function(e,t){var r=e;this._caseIngore&&(r=e.replace(cO,(function(e,t,r){return t.toUpperCase()+r.toLowerCase()})));var n,a={},o=[];for(var i in this.cycleMap){var u=this.cycleMap[i].findIndex((function(e){return e===r}));if(-1!==u){if(!t)return{type:i,itemIndex:u};a[i]=o.push({type:i,itemIndex:u})-1}}return o.length>1&&t?o[null!==(n=a[t])&&void 0!==n?n:0]:o.length?o[0]:null}},{key:"getCycleByType",value:function(e){return this.cycleMap[e]}}]),e}();fO=Vu([(0,st.b)()],fO),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e[e.Range=4]="Range"}(tO||(tO={})),function(e){e[e.vertical=0]="vertical",e[e.horizontal=1]="horizontal"}(rO||(rO={})),function(e){e[e.Increment=0]="Increment",e[e.Decrease=1]="Decrease"}(nO||(nO={})),function(e){e.Auto="auto",e.CopyCells="copyCells",e.FillSeries="fillSeries"}(aO||(aO={}));var dO="model/fill/fill-linear-regression",vO=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(Array.isArray(e))if(1===e.length){var r=(0,g.Z)(e,1),n=r[0],a=n+t;this._regression=this.getLinearEquation([n,a]),this._data=[n,a]}else this._regression=this.getLinearEquation(e),this._data=e}},{key:"getLinearEquation",value:function(e){if(!Array.isArray(e)||0===e.length)return null;if(1===e.length){this._isLinearData=!0;var t=e[0];return null==t?null:this.getLinearRegression([t,t+1])}var r=this.getLinearRegression(e.slice(0,2));if(!r)return r;for(var n=2;n<e.length;n++)if(e[n]!==r.predict(n))return this._isLinearData=!1,this.getLinearRegression(e);return this._isLinearData=!0,r}},{key:"getLinearRegression",value:function(e){for(var t=[],r=0;r<e.length;r++){if(null==e[r])return null;t.push(r)}return new qt.Z(t,e)}},{key:"getValueByX",value:function(e){return this._regression&&this.isValidRegression()?e>=0&&e<this._data.length?this._data[e]:this._regression.predict(e):this._data[e]}},{key:"getSlope",value:function(){return this._regression&&this.isValidRegression()?this._regression.slope:1}},{key:"getIntercept",value:function(){return this._regression&&this.isValidRegression()?this._regression.intercept:0}},{key:"isLinear",value:function(){return!!this.isValidRegression()&&this._isLinearData}},{key:"isValidRegression",value:function(){return!(!this._regression||isNaN(this._regression.slope))}},{key:"toString",value:function(e){return this._regression&&this.isValidRegression?this._regression.toString(e):""}},{key:"destroy",value:function(){this._regression=null,this._data=[]}}]),e}();vO=Vu([(0,st.b)()],vO);var pO,mO,gO,yO=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"fromJSON",value:function(e){var t=e.type,r=e.attrs,n=e.values;this.type=t,this.attrs=r,this.values=n}},{key:"toJSON",value:function(){return{type:this.type,attrs:this.attrs,values:this.values}}},{key:"calcValueByFillCalcType",value:function(e,t){switch(e){case aO.Auto:return this.getValueByAuto(t);case aO.CopyCells:return this.getValueByCopy(t);case aO.FillSeries:return this.getValueBySeries(t);default:return this.getValueByAuto(t)}}},{key:"getValueByAuto",value:function(e){return this.getDefaultAutoFillCalcType()===aO.FillSeries?this.getValueBySeries(e):this.getValueByCopy(e)}},{key:"getDefaultAutoFillCalcType",value:function(){return this._autoFillCalcType}},{key:"setDefaultAutoFillCalcType",value:function(e){e!==this._autoFillCalcType&&(this._autoFillCalcType=e)}},{key:"destroy",value:function(){this.linearGression.destroy()}}],[{key:"isValidBaseJSON",value:function(e){var t=e.type,r=e.attrs,n=e.values;return Boolean(t)&&Array.isArray(r)&&Array.isArray(n)&&n.length>0}}]),e}();Vu([(0,lt.f)(dO)],yO.prototype,"linearGression",void 0),yO=Vu([(0,st.b)()],yO),function(e){e.SerialCycle="SerialCycle",e.SerialText="SerialText",e.SerialNumber="SerialNumber",e.SerialSegmentArray="SerialSegmentArray",e.CopyOnly="CopyOnly"}(pO||(pO={})),function(e){e.General="General",e.Text="Text",e.Digital="Digital",e.Fraction="Fraction",e.TimeOnly="TimeOnly",e.DateTime="DateTime"}(mO||(mO={})),function(e){e.Head="Head",e.Tail="Tail"}(gO||(gO={}));var _O="model/fill/fill-calc-group/serial-cycle-fill",RO=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"init",value:function(e,r,n,a){if(this.cycleCalendars=n,(0,f.Z)((0,v.Z)(t.prototype),"fromJSON",this).call(this,{type:pO.SerialCycle,attrs:e,values:r}),1===r.length)this.linearGression.init(r,0===a?1:-1);else if(this.isCycleValues()){var o=r[1]-r[0];this.linearGression.init(r.slice(0,1),o)}else this.linearGression.init(r)}},{key:"isCycleValues",value:function(){var e=this.values;if(e.length<=1)return!0;for(var t=e[1]-e[0],r=2;r<e.length;r++){var n=e[r]-e[r-1];if(n!==t&&Math.abs(n-t)!==this.cycleCalendars.length)return!1}return!0}},{key:"setCycleCalendars",value:function(e){this.cycleCalendars=e}},{key:"canSeries",value:function(){return!(!this.values||!Array.isArray(this.values))&&this.linearGression.isLinear()}},{key:"getValueBySeries",value:function(e){if(this.canSeries()){var t=this.linearGression.getValueByX(e)%this.cycleCalendars.length;return t<0&&(t+=this.cycleCalendars.length),this.getTextByValue(t)}return this.getValueByCopy(e)}},{key:"getValueByCopy",value:function(e){var t=this.values[e%this.values.length];return this.getTextByValue(t)}},{key:"getTextByValue",value:function(e){return this.cycleCalendars[e]}}],[{key:"isValidJSON",value:function(e,t){if(yO.isValidBaseJSON(e)){if(1!==e.attrs.length)return!1;var r=(0,g.Z)(e.attrs,1)[0],n=t.getCycleByType(r);return Array.isArray(n)}return console.info("[Sheet Fill] no inject valid cycle calendars"),!1}}]),t}(yO);RO=Vu([(0,st.b)()],RO);var CO,wO="model/fill-calc-group/serial-number-fill",EO=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"init",value:function(e,r,n){(0,f.Z)((0,v.Z)(t.prototype),"fromJSON",this).call(this,{type:pO.SerialNumber,attrs:e,values:r});var a=this._getSlope(n);1===r.length?this.linearGression.init(r,a):this._containTimeType(r)&&function(e){for(var t,r=1;r<e.length;r++){var n=e[r-1],a=e[r];if(Math.floor(n)!==Math.floor(a))return!1;var o=new we.SheetDate(n),i=o.hours,u=o.minutes,s=o.seconds,l=new we.SheetDate(a),c=l.hours,h=l.minutes,f=l.seconds,d=kO(i,u,s),v=kO(c,h,f);if(void 0!==t){if(t!==v-d)return!1}else t=v-d}return!0}(r)?this.linearGression.init(r.slice(0,1),r[1]-r[0]):this.linearGression.init(r)}},{key:"canSeries",value:function(){var e=this._getSerialNumberFillCalcAttr();return e===mO.General||e===mO.Digital||this.linearGression.isLinear()}},{key:"getValueBySeries",value:function(e){if(this.canSeries()){var t=this.linearGression.getValueByX(e);return this._fixValue(t)}return this.getValueByCopy(e)}},{key:"getValueByCopy",value:function(e){var t=e%this.values.length;return this.values[t]}},{key:"_getSlope",value:function(e){var t=0===e?1:-1;return this._getSerialNumberFillCalcAttr()===mO.TimeOnly?1/24*t:1*t}},{key:"_getSerialNumberFillCalcAttr",value:function(){return this.attrs[0]}},{key:"_containTimeType",value:function(e){var t=this;return e.some((function(e){var r=t._getSerialNumberFillCalcAttr(),n=r===mO.TimeOnly||r===mO.DateTime;return!Number.isInteger(e)&&n}))}},{key:"_fixValue",value:function(e){var t=this._getSerialNumberFillCalcAttr();if(t===mO.TimeOnly||t===mO.DateTime){if(e>we.SheetDate.MAX_DATE_VALUE)return we.SheetDate.MAX_DATE_VALUE;if(e<we.SheetDate.MIN_DATE_VALUE)return Math.abs(e)}return rn._parseFloat(e)}}],[{key:"isValidJSON",value:function(e){if(yO.isValidBaseJSON(e)){var t=e.attrs;if(1!==t.length)return!1;var r=t[0];return[mO.General,mO.Text,mO.Digital,mO.DateTime,mO.TimeOnly,mO.Fraction].includes(r)}return!1}}]),t}(yO);function kO(e,t,r){return 60*e*60+60*t+r}EO=Vu([(0,st.b)()],EO),function(e){e.plus="+",e.minus="-",e.None=""}(CO||(CO={}));var TO=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments)))._leadingSign=CO.None,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"initBaseSerialText",value:function(e,r,n,a){(0,f.Z)((0,v.Z)(t.prototype),"fromJSON",this).call(this,{type:e,attrs:r,values:n}),this._leadingSign=this._buildSign(),this._digitsNumber=this._buildLeadingZeros(),this.linearGression.init(n.map((function(e){return Math.abs(Number(e))})),0===a?1:-1)}},{key:"_buildSign",value:function(){var e=this.values[0].match(oO);return null!==e?e[0]:CO.None}},{key:"_buildLeadingZeros",value:function(){for(var e=1,t=0;t<this.values.length;t++){var r=this.values[t],n=oO.test(r)?r.length-1:r.length;e<n&&(e=n)}return e}},{key:"getValueBySeries",value:function(e){if(this.canSeries()){if(e>=0&&e<this.values.length){var t=this.values[e];return this.getCalcResultByValue(t)}var r=this.linearGression.getValueByX(e),n=""+Math.abs(r);if(n.length<this._digitsNumber){var a=this._digitsNumber-n.length;n="0".repeat(a)+n}var o="".concat(this._leadingSign).concat(n);return this.getCalcResultByValue(o)}return this.getValueByCopy(e)}},{key:"getValueByCopy",value:function(e){var t=this.values[e%this.values.length];return this.getCalcResultByValue(t)}},{key:"getTextByValue",value:function(e){return this.headTemplate+e+this.tailTemplate}}]),t}(yO),SO="model/fill-calc-group/serial-segment-array",AO=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"init",value:function(e,r,n){(0,f.Z)((0,v.Z)(t.prototype),"initBaseSerialText",this).call(this,pO.SerialSegmentArray,e,r,n)}},{key:"canSeries",value:function(){return!(!this.values||!Array.isArray(this.values))&&(this.serialSegmentPosition!==gO.Tail||""===this.tailTemplate)&&(this.serialSegmentPosition!==gO.Head||""===this.headTemplate)&&this.linearGression.isLinear()}},{key:"getCalcResultByValue",value:function(e){var t=this.getTextByValue(e),r=[];if(this.serialSegmentPosition===gO.Tail){for(var n=3;n<this.attrs.length;n++){var a=this.attrs[n];r.push(a)}return r.push(t),r}r.push(t);for(var o=3;o<this.attrs.length;o++){var i=this.attrs[o];r.push(i)}return r}},{key:"headTemplate",get:function(){return this.attrs[1]}},{key:"tailTemplate",get:function(){return this.attrs[2]}},{key:"serialSegmentPosition",get:function(){return this.attrs[0]}}],[{key:"isValidJSON",value:function(e){if(yO.isValidBaseJSON(e)){var t=e.attrs;return!(t.length<3)&&[gO.Head,gO.Tail].includes(t[0])}return!1}}]),t}(TO);AO=Vu([(0,st.b)()],AO);var IO="model/fill/fill-calc-group/serial-text-fill",OO=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"init",value:function(e,r,n){(0,f.Z)((0,v.Z)(t.prototype),"initBaseSerialText",this).call(this,pO.SerialText,e,r,n)}},{key:"canSeries",value:function(){return!(!this.values||!Array.isArray(this.values))&&this.linearGression.isLinear()}},{key:"getCalcResultByValue",value:function(e){return this.getTextByValue(e)}},{key:"headTemplate",get:function(){return this.attrs[0]}},{key:"tailTemplate",get:function(){return this.attrs[1]}}],[{key:"isValidJSON",value:function(e){return!!yO.isValidBaseJSON(e)&&2===e.attrs.length}}]),t}(TO);OO=Vu([(0,st.b)()],OO);var VO="model/fill/fill-calc-group/factory",NO=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"createFillCalcGroup",value:function(e,t){if(!this.isFillCalcGroupJSONValid(e))return null;switch(e.type){case pO.SerialCycle:var r,n=e.attrs,a=e.values,o=n[0],i=null===(r=this.cycleCalendarsModel)||void 0===r?void 0:r.getCycleByType(o),u=this.sheet.inject(_O);return u.init(n,a,i,t),u.setDefaultAutoFillCalcType(aO.FillSeries),u;case pO.SerialNumber:var s=e.attrs,l=e.values,c=this.sheet.inject(wO);c.init(s,l,t);var h=s[0];return 1!==l.length||h!==mO.General&&h!==mO.Digital?c.setDefaultAutoFillCalcType(aO.FillSeries):c.setDefaultAutoFillCalcType(aO.CopyCells),c;case pO.SerialText:var f=e.attrs,d=e.values,v=this.sheet.inject(IO);return v.init(f,d,t),v.setDefaultAutoFillCalcType(aO.FillSeries),v;case pO.SerialSegmentArray:var p=e.attrs,m=e.values,g=this.sheet.inject(SO);return g.init(p,m,t),g.setDefaultAutoFillCalcType(aO.FillSeries),g;default:return null}}},{key:"isFillCalcGroupJSONValid",value:function(e){switch(e.type){case pO.SerialCycle:if(!this.sheet)return!1;var t=this.sheet.inject(hO);return RO.isValidJSON(e,t);case pO.SerialNumber:return EO.isValidJSON(e);case pO.SerialText:return OO.isValidJSON(e);case pO.SerialSegmentArray:return AO.isValidJSON(e);default:return!1}}}]),e}();Vu([(0,lt.f)(Lm)],NO.prototype,"sheet",void 0),Vu([(0,lt.f)(hO)],NO.prototype,"cycleCalendarsModel",void 0),NO=Vu([(0,st.b)()],NO),(0,ct.GW)((0,st.b)(),_t.FIterator);var bO="model/fill/fill-data-view/fill-dimension-iter",MO=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).call(this)))._itemIndex=0,e._itemCount=0,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"init",value:function(e){this._targetFillDimItemList=e,this._itemCount=e.length,this._itemIndex=0}},{key:"next",value:function(){if(!this._targetFillDimItemList||!this._targetFillDimItemList.length)return null;var e=this._targetFillDimItemList;return this._itemIndex<this._itemCount?e[this._itemIndex++]:null}},{key:"getDimensionIterInfo",value:function(){return[this._itemIndex,this._itemCount,this._targetFillDimItemList.length]}}]),t}(_t.FIterator);MO=Vu([(0,st.b)()],MO);var FO="model/fill/fill-dimension",ZO=function(){function e(t){var r=this;(0,y.Z)(this,e),this.sheet=t,this.sourceItemGroupIdList=[],this.sourceItemGroupIdIndex=[],this._cellIndex$=new ft.X([-1,-1]),this._sourceRangeSize$=new ft.X([-1,-1]),this._fillRangeSize$=new ft.X([-1,-1]),this._fillCalcType$=new ft.X(aO.Auto),this._fillTrend$=new ft.X(0),this.skipHiddenRow=!1,this.skipFilterRow=!0,this._buildGroupSubscription=(0,vt.aj)(this._cellIndex$,this._sourceRangeSize$,this._fillTrend$).subscribe((function(){r.reset(),r._parseDataSource(),r._buildGroup()})),this._handleCalcTypeChangeSubscription=this._fillCalcType$.subscribe((function(){r.refreshCalcValue()})),this._handleRangeSizeChangeSubscription=this._fillRangeSize$.subscribe((function(){r._calcValue()}))}return(0,_.Z)(e,[{key:"setInvisibleRowConfig",value:function(e){var t=e.skipHiddenRow,r=e.skipFilterRow;this.skipHiddenRow=t,this.skipFilterRow=r}},{key:"reset",value:function(){this.dimGroupList=[],this.sourceItemGroupIdList=[],this.sourceFillDimItemList=[],this.sourceItemCellPosition=[],this.sourceItemGroupIdIndex=[],this.targetFillDimItemList=[]}},{key:"setCellIndex",value:function(e){(0,me.default)(this.cellIndex,e)||this._cellIndex$.next(e)}},{key:"setSourceRangeSize",value:function(e){(0,me.default)(this.sourceRangeSize,e)||this._sourceRangeSize$.next(e)}},{key:"setFillRangeSize",value:function(e){(0,me.default)(this.fillRangeSize,e)||this._fillRangeSize$.next(e)}},{key:"setFillCalcType",value:function(e){this.fillCalcType!==e&&this._fillCalcType$.next(e)}},{key:"setFillTrend",value:function(e){this.fillTrend!==e&&this._fillTrend$.next(e)}},{key:"_createFillCalcGroup",value:function(e){return this.sheet.inject(VO).createFillCalcGroup(e,this.fillTrend)}},{key:"_parseDataSource",value:function(){for(var e=(0,g.Z)(this.cellIndex,2),t=e[0],r=e[1],n=(0,g.Z)(this.sourceRangeSize,2),a=n[0],o=n[1],i=t;i<t+a;i++)if(!(this.skipHiddenRow&&!this.sheet.getRowVisible(i,!0)||this.skipFilterRow&&this.sheet._isRowFilterOut(i)))for(var u=r;u<r+o;u++){var s=this._parseCellData(i,u);0===this.fillTrend?(this.sourceFillDimItemList.push(s),this.sourceItemCellPosition.push([i,u])):(this.sourceFillDimItemList.unshift(s),this.sourceItemCellPosition.unshift([i,u]))}}},{key:"_parseCellData",value:function(e,t){var r,n=this.sheet,a=n.getSegmentArray(e,t),o=null===(r=n.getCellFormatter(e,t))||void 0===r?void 0:r.getFormatters(),i=n.getValue(e,t),u=n.hasFormula(e,t),s=n.getDataValidation(e,t),l=Boolean(s&&A_(s)),c=Boolean(s&&C_(s)),h=null;switch(!0){case u||c||l:case null==i:h=null;break;case Array.isArray(a):h=this._parseSegmentArray(a);break;case"string"==typeof i:null==(h=this._parseCycleText(i))&&(h=this._parseSerialText(i));break;case"boolean"==typeof i:h=null;break;case null!=o||"number"==typeof i:h=this._parseNumber(o,i)}return null==h&&(h={type:pO.CopyOnly,attrs:null,value:null}),h}},{key:"_parseSerialText",value:function(e){if(isNaN(Number(e))){var t=e.match(iO);if(t){var r=t[1],n=t[2],a=e.slice(0,t.index);return{type:pO.SerialText,attrs:[a,n],value:r}}return null}if(e.length>15)return null;var o=e.match(uO);if(o){var i=o[1],u=e.slice(0,o.index);return{type:pO.SerialText,attrs:[u,""],value:i}}return null}},{key:"_parseCycleText",value:function(e){var t,r=this.sheet.inject(hO);if(this.sourceFillDimItemList.length>0){var n=0===this.fillTrend?this.sourceFillDimItemList.length-1:0,a=this.sourceFillDimItemList[n];t=a.type===pO.SerialCycle?a.attrs[0]:void 0}var o=r.getCycleInfoByText(e,t);return o?{type:pO.SerialCycle,attrs:[o.type],value:o.itemIndex}:null}},{key:"_parseNumber",value:function(e,t){if(!e)return{type:pO.SerialNumber,attrs:[mO.General],value:t};var r=(0,g.Z)(e,1)[0],n=r.type,a=r.formatRules;return n!==mO.DateTime||a.hasDate?n===mO.Text&&void 0!==t?this._parseSerialText(t.toString()):{type:pO.SerialNumber,attrs:[n],value:t}:{type:pO.SerialNumber,attrs:[mO.TimeOnly],value:t}}},{key:"_parseSegmentArray",value:function(e){if(!e||!Array.isArray(e))return null;var t=function(e){return e===Ce.K6s.ATTACHMENT||e===Ce.K6s.MENTION},r=e[0],n=r.text,a=r.type,o=e[e.length-1],i=o.text,u=o.type;if(i&&!t(u)){var s=i.match(lO);if(s){for(var l=s[1],c=i.slice(0,s.index),h=[gO.Tail,c,""],f=0;f<e.length-1;f++){var d=e[f];h.push(d.text)}return{type:pO.SerialSegmentArray,attrs:h,value:l}}}if(n&&!t(a)){var v=n.match(sO);if(v){for(var p=v[1],m=n.slice(p.length),g=[gO.Head,"",m],y=1;y<e.length;y++){var _=e[y];g.push(_.text)}return{type:pO.SerialSegmentArray,attrs:g,value:p}}}return null}},{key:"_buildGroup",value:function(){var e=this;if(this.sourceFillDimItemList.length){var t=0,r=this.sourceFillDimItemList.reduce((function(r,n){if(r&&r.type===n.type&&(0,me.default)(r.attrs,n.attrs))return r.values.push(n.value),e.sourceItemGroupIdList.push(t),e.sourceItemGroupIdIndex.push(r.values.length-1),r;if(Array.isArray(r.values)){var a=e._createFillCalcGroup(r);e.dimGroupList[t]=a,t++}var o={type:n.type,attrs:n.attrs,values:[n.value]};return e.sourceItemGroupIdList.push(t),e.sourceItemGroupIdIndex.push(0),o}),{}),n=this._createFillCalcGroup(r);this.dimGroupList[t]=n}}},{key:"_calcValue",value:function(){if(this.sourceFillDimItemList.length)for(var e=Math.max(this.fillRangeSize[0],this.fillRangeSize[1]),t=this.targetFillDimItemList.length;t<e;t++){var r=this.sourceFillDimItemList.length,n=t%r,a=this.sourceItemCellPosition[n],o=this.sourceItemGroupIdList[n],i=this.dimGroupList[o];if(i){var u=Math.floor(t/r)+1,s=this.sourceItemGroupIdIndex[n],l=i.values.length*u+s,c=i.calcValueByFillCalcType(this.fillCalcType,l),h={type:i.type,result:c,sourceCell:a};this.targetFillDimItemList.push(h)}else this.targetFillDimItemList.push({type:pO.CopyOnly,result:null,sourceCell:a})}}},{key:"refreshCalcValue",value:function(){this.targetFillDimItemList=[],this._calcValue()}},{key:"getFillDimensionIter",value:function(){if(!this.targetFillDimItemList.length)return null;var e=this.sheet.inject(bO);return e.init(this.targetFillDimItemList),e}},{key:"destroy",value:function(){this._buildGroupSubscription.unsubscribe(),this._handleRangeSizeChangeSubscription.unsubscribe(),this._handleCalcTypeChangeSubscription.unsubscribe(),this.dimGroupList.forEach((function(e){return null==e?void 0:e.destroy()})),this.dimGroupList=[],this.sourceItemGroupIdList=[],this.sourceItemGroupIdIndex=[],this.sourceFillDimItemList=[],this.sourceItemCellPosition=[],this.targetFillDimItemList=[],this._cellIndex$.complete(),this._fillCalcType$.complete(),this._fillRangeSize$.complete(),this._sourceRangeSize$.complete(),this._fillTrend$.complete()}},{key:"cellIndex",get:function(){return this._cellIndex$.getValue()}},{key:"sourceRangeSize",get:function(){return this._sourceRangeSize$.getValue()}},{key:"fillRangeSize",get:function(){return this._fillRangeSize$.getValue()}},{key:"fillCalcType",get:function(){return this._fillCalcType$.getValue()}},{key:"fillTrend",get:function(){return this._fillTrend$.getValue()}}]),e}();ZO=Vu([(0,st.b)(),Nu(0,(0,lt.f)(Lm))],ZO);var xO="model/fill/fill-data-view/fill-data-view-iter",DO=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this)))._sheet=e,r._row=-1,r._col=-1,r._skipHiddenRow=!1,r._skipFilterRow=!0,r._fillDimensionIndex=-1,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"init",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this._rg=e,this._dimList=t,this._fillDirection=r,this._skipHiddenRow=n,this._skipFilterRow=a}},{key:"_stepToNextDimension",value:function(){this._fillDimensionIndex++,this._row=-1,this._col=-1}},{key:"_stepTo",value:function(){switch(this._fillDirection){case tO.Down:return void(-1===this._row&&-1===this._col?(this._row=this._rg.rowFrom(),this._col=this._rg.colFrom()+this._fillDimensionIndex):this._row++);case tO.Right:return void(-1===this._col&&-1===this._row?(this._row=this._rg.rowFrom()+this._fillDimensionIndex,this._col=this._rg.colFrom()):this._col++);case tO.Up:return void(-1===this._row&&-1===this._col?(this._row=this._rg.rowTo(),this._col=this._rg.colFrom()+this._fillDimensionIndex):this._row--);case tO.Left:return void(-1===this._col&&-1===this._row?(this._row=this._rg.rowFrom()+this._fillDimensionIndex,this._col=this._rg.colTo()):this._col--);default:return}}},{key:"_stepToVisibleRow",value:function(){this._fillDirection!==tO.Up?this._row++:this._row--}},{key:"getCollectInfo",value:function(){var e,t;return{row:this._row,col:this._col,rg:this._rg.toGridJSON(!0),fillDirection:this._fillDirection,skipFilterRow:this._skipFilterRow,skipHiddenRow:this._skipHiddenRow,isRowFilterOut:this._sheet._isRowFilterOut(this._row),isRowVisible:this._sheet.getRowVisible(this._row,!0),dimensionIndex:this._fillDimensionIndex,dimListLen:this._dimList.length,dimItemCount:null===(e=this._dimList[this._fillDimensionIndex])||void 0===e?void 0:e.fillRangeSize,dimIterInfo:null===(t=this._iter)||void 0===t?void 0:t.getDimensionIterInfo()}}},{key:"next",value:function(){var e,t,r,n=this._dimList;if(!this._sheet||this._fillDimensionIndex>=n.length)return null;var a=null===(e=this._iter)||void 0===e?void 0:e.next();if(null==a)return this._stepToNextDimension(),this._iter=null===(t=n[this._fillDimensionIndex])||void 0===t?void 0:t.getFillDimensionIter(),this.next();for(this._stepTo();this._skipHiddenRow&&!this._sheet.getRowVisible(this._row,!0);)this._stepToVisibleRow();for(;this._skipFilterRow&&this._sheet._isRowFilterOut(this._row);)this._stepToVisibleRow();return this._rg.containCell(this._row,this._col)?{targetCell:[this._row,this._col],calcItemResult:a}:(this._stepToNextDimension(),this._iter=null===(r=n[this._fillDimensionIndex])||void 0===r?void 0:r.getFillDimensionIter(),this.next())}}]),t}(_t.FIterator);DO=Vu([(0,st.b)(),Nu(0,(0,lt.f)(Lm))],DO);var PO="model/fill/fill-data-view",$O=function(){function e(t){var r=this;(0,y.Z)(this,e),this.sheet=t,this._fillType$=new ft.X(aO.Auto),this._direction$=new ft.X(null),this._sourceRange$=new ft.X(null),this._fillRange$=new ft.X(null),this._reverseAutoFill$=new ft.X(!1),this.dimList=[],this.skipHiddenRow=!1,this.skipFilterRow=!0,this._isDirty=!1,this._sipltDimInfoSubscription=(0,vt.aj)(this._sourceRange$,this._reverseAutoFill$,this._direction$.pipe((0,Pt.map)((function(e){return r._getFillSeries(e)})))).subscribe((function(e){var t=(0,g.Z)(e,3),n=(t[0],t[1],t[2]);null!=n&&(r.reset(),r._spiltDimInfo(n),r.setDefaultAutoFillCalcType())})),this._handleFillSubscription=(0,vt.aj)(this._fillRange$,this._fillType$).subscribe((function(){r._handleFill()})),this._handleFillTrendChange=this._direction$.pipe((0,Pt.map)((function(e){return r._getFillTrend(e)}))).subscribe((function(e){null!==e&&(r.dimList.forEach((function(t){t.setFillTrend(e)})),r.setDefaultAutoFillCalcType())})),this._handleReverseAutoFillChange=this._reverseAutoFill$.subscribe((function(){r.setDefaultAutoFillCalcType(),r.dimList.forEach((function(e){e.refreshCalcValue()}))}))}return(0,_.Z)(e,[{key:"markDirty",value:function(){this._isDirty||(this._isDirty=!0)}},{key:"refresh",value:function(){this.reset(),this._spiltDimInfo(this._getFillSeries(this.direction)),this.setDefaultAutoFillCalcType(),this._handleFill(),this._isDirty=!1}},{key:"reset",value:function(){this.dimList.forEach((function(e){return e.destroy()})),this.dimList=[]}},{key:"setFillRange",value:function(e){(0,me.default)(this.fillRange,e)||this._fillRange$.next(e)}},{key:"setFillType",value:function(e){this.fillType!==e&&this._fillType$.next(e)}},{key:"setDirection",value:function(e){this.direction!==e&&this._direction$.next(e)}},{key:"setSourceRange",value:function(e){(0,me.default)(this.sourceRange,e)||this._sourceRange$.next(e)}},{key:"setReverseAutoFill",value:function(e){(0,me.default)(this.reverseAutoFill,e)||this._reverseAutoFill$.next(e)}},{key:"setCanSkipHiddenRow",value:function(e){this.skipHiddenRow!==e&&(this.skipHiddenRow=e)}},{key:"setCanSkipFilterRow",value:function(e){this.skipFilterRow!==e&&(this.skipFilterRow=e)}},{key:"createFillDimension",value:function(){return this.sheet.inject(FO)}},{key:"_getFillSeries",value:function(e){if(null==e)return null;var t=[tO.Up,tO.Down],r=[tO.Left,tO.Right];return t.includes(e)?0:r.includes(e)?1:null}},{key:"_getFillTrend",value:function(e){if(null==e)return null;var t=[tO.Right,tO.Down],r=[tO.Up,tO.Left];return t.includes(e)?0:r.includes(e)?1:null}},{key:"_spiltDimInfo",value:function(e){var t=this.sourceRange,r=this.sheet;if(t&&r&&null!=e)for(var n=t.rowFrom(),a=t.colFrom(),o=t.rowCount(),i=t.colCount(),u=0===e,s=u?i:o,l=u?a:n,c=0;c<s;c++,l++){var h=u?n:l,f=u?l:a,d=u?o:1,v=u?1:i,p=this.createFillDimension();p.setCellIndex([h,f]),p.setSourceRangeSize([d,v]),p.setInvisibleRowConfig({skipHiddenRow:this.skipHiddenRow,skipFilterRow:this.skipFilterRow});var m=this._getFillTrend(this.direction);null!=m&&p.setFillTrend(m),this.dimList.push(p)}}},{key:"_handleFill",value:function(){if(this.dimList.length&&this.fillRange)for(var e=this.fillRange.rowCount(),t=this.fillRange.colCount(),r=0;r<this.dimList.length;r++){var n=this.dimList[r],a=0===this._getFillSeries(this.direction)?e:1,o=0===this._getFillSeries(this.direction)?1:t;n.setFillRangeSize([a,o]),n.setFillCalcType(this.fillType)}}},{key:"getFillDataViewIter",value:function(){if(null==this.fillRange||null==this.direction)return null;this._isDirty&&this.refresh();var e=this.sheet.inject(xO);return e.init(this.fillRange,this.dimList,this.direction,this.skipHiddenRow,this.skipFilterRow),e}},{key:"setDefaultAutoFillCalcType",value:function(){if(this.sourceRange){var e=this.sourceRange.size(),t=this.reverseAutoFill;this.dimList.forEach((function(r){r.dimGroupList.forEach((function(r){if(r){var n=r.toJSON(),a=n.type,o=n.attrs[0];1!==e||a!==pO.SerialNumber||o!==mO.General&&o!==mO.Digital?r.setDefaultAutoFillCalcType(t?aO.CopyCells:aO.FillSeries):r.setDefaultAutoFillCalcType(t?aO.FillSeries:aO.CopyCells)}}))}))}}},{key:"getAutoFillCalcTypeList",value:function(){for(var e=[],t=0;t<this.dimList.length;t++)for(var r=this.dimList[t],n=0;n<r.dimGroupList.length;n++){var a=r.dimGroupList[n],o=(null==a?void 0:a.getDefaultAutoFillCalcType())||aO.CopyCells;e.push(o)}return e}},{key:"getAutoFillItemTypeList",value:function(){for(var e=[],t=0;t<this.dimList.length;t++)for(var r=this.dimList[t],n=0;n<r.dimGroupList.length;n++){var a=r.dimGroupList[n],o=(null==a?void 0:a.type)||pO.CopyOnly;e.includes(o)||e.push(o)}return e}},{key:"destroy",value:function(){this._sipltDimInfoSubscription.unsubscribe(),this._handleFillSubscription.unsubscribe(),this._handleFillTrendChange.unsubscribe(),this._handleReverseAutoFillChange.unsubscribe(),this.dimList.forEach((function(e){return e.destroy()})),this.dimList=[],this._fillType$.complete(),this._direction$.complete(),this._fillRange$.complete(),this._sourceRange$.complete()}},{key:"direction",get:function(){return this._direction$.getValue()}},{key:"fillType",get:function(){return this._fillType$.getValue()}},{key:"sourceRange",get:function(){return this._sourceRange$.getValue()}},{key:"fillRange",get:function(){return this._fillRange$.getValue()}},{key:"reverseAutoFill",get:function(){return this._reverseAutoFill$.getValue()}}]),e}();$O=Vu([(0,st.b)(),Nu(0,(0,lt.f)(Lm))],$O);var LO="model/fill/fii-sel-range",BO=function(){function e(){(0,y.Z)(this,e),this._selRange$=new ft.X(null),this._selectionDashBorderStyle$=new ft.X(null),this._toolTipsText$=new ft.X(""),this._toolTipsCellPosition$=new ft.X([-1,-1]),this.selRange$=this._selRange$.asObservable(),this.selectionDashBorderStyle$=this._selectionDashBorderStyle$.asObservable(),this.toolTipsText$=this._toolTipsText$.asObservable(),this.toolTipsCellPosition$=this._toolTipsCellPosition$.asObservable()}return(0,_.Z)(e,[{key:"setSelRange",value:function(e){(0,me.default)(e,this.selRange)||this._selRange$.next(e)}},{key:"setSelectionDashBorderStyle",value:function(e){(0,me.default)(e,this.selectionDashBorderStyle)||this._selectionDashBorderStyle$.next(e)}},{key:"setToolTipsText",value:function(e){(0,me.default)(e,this.toolTipsText)||this._toolTipsText$.next(e)}},{key:"setToolTipsCellPosition",value:function(e){(0,me.default)(e,this.toolTipsCellPosition)||this._toolTipsCellPosition$.next(e)}},{key:"removeToolTips",value:function(){this._toolTipsCellPosition$.next([-1,-1]),this._toolTipsText$.next("")}},{key:"selRange",get:function(){return this._selRange$.getValue()}},{key:"selectionDashBorderStyle",get:function(){return this._selectionDashBorderStyle$.getValue()}},{key:"toolTipsText",get:function(){return this._toolTipsText$.getValue()}},{key:"toolTipsCellPosition",get:function(){return this._toolTipsCellPosition$.getValue()}}]),e}();BO=Vu([(0,st.b)()],BO);var UO="model/fill/fill-corner",HO=function(){function e(){(0,y.Z)(this,e),this._cornerType$=new ft.X(null),this._preCornerType=null,this.cornerType$=this._cornerType$.asObservable()}return(0,_.Z)(e,[{key:"setCornerType",value:function(e){this.cornerType!==e&&(this._preCornerType=this.cornerType,this._cornerType$.next(e))}},{key:"mobileFilling",get:function(){return this.cornerType===Ce.LN0.MOBILE_FILL_CORNER}},{key:"cornerType",get:function(){return this._cornerType$.getValue()}},{key:"preCornerType",get:function(){return this._preCornerType}}]),e}();HO=Vu([(0,st.b)()],HO);var zO=function(){function e(t){(0,y.Z)(this,e),this.sheetDataModelGetter=t}return(0,_.Z)(e,[{key:"getDataValidation",value:function(e,t){var r;return(null===(r=this.sheetDataModelGetter())||void 0===r?void 0:r.getDataValidation(e,t))||null}},{key:"getDataValidationJSON",value:function(e,t,r,n){var a,o=(null===(a=this.sheetDataModelGetter())||void 0===a?void 0:a.getDataValidation(e,t,n))||null;return o?o.toJSON(r):null}},{key:"hasDropdown",value:function(e,t){var r=this.getDataValidation(e,t);return!!r&&(O_(r)||A_(r))}},{key:"hasCheckbox",value:function(e,t){var r=this.getDataValidation(e,t);return!(!r||"checkbox"!==r.type)}},{key:"getDataValidationId",value:function(e,t){var r;return(null===(r=this.sheetDataModelGetter())||void 0===r?void 0:r.getDataValidationId(e,t))||null}}]),e}();zO=Vu([(0,st.b)(),Nu(0,(0,lt.f)($m))],zO);var WO,GO=["filter","find","findAndReplace","hideCol","hideRow","openFilterMenu","addOutline","delOutline","unhideCOl","unhideRow"],jO=function(){function e(){(0,y.Z)(this,e),this.tabType$=new ft.X(void 0)}return(0,_.Z)(e,[{key:"getTabType",value:function(){return this.tabType$.getValue()}},{key:"setTabType",value:function(e){this.getTabType()!==e&&this.tabType$.next(e)}},{key:"isConnectorTab",value:function(){return this.getTabType()===Ce.Ec3.SheetTabType_CONNECTOR}},{key:"isShortcutAllowed",value:function(e){return!this.isConnectorTab()||-1!==GO.findIndex((function(t){return t===e}))}}]),e}();jO=Vu([(0,st.b)()],jO),function(e){e[e.Normal=0]="Normal",e[e.ImportRange=1]="ImportRange",e[e.DataRange=2]="DataRange",e[e.DataRangev2=3]="DataRangev2"}(WO||(WO={}));var YO=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this,e._getModel().contentModel.iter(r,n,a,o)))).sheet=e,i.rowFrom=r,i.colFrom=n,i.rowCount=a,i.colCount=o,i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exportCells",value:function(e){for(var t=this.rowFrom+this.rowCount,r=this.colFrom+this.colCount,n=this.rowFrom;n<t;n++)if(!this.sheet.getRowVisible(n))for(var a=this.colFrom;a<r;a++)e(n,a).isHidden=!0;for(var o=this.colFrom;o<r;o++)if(!this.sheet.getColVisible(o))for(var i=this.rowFrom;i<t;i++)e(i,o).isHidden=!0}},{key:"exportToCell",value:function(e,t){}}]),t}(D_),qO=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).sheet=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getExporter",value:function(e,t,r,n){return new YO(this.sheet,e,t,r,n)}}]),t}(Wg);var JO=function(e){function t(e,r,n,a,o,i){var u;return(0,y.Z)(this,t),(u=(0,d.Z)(this,(0,v.Z)(t).call(this,r.iter(n,a,o,i)))).sheet=e,u.intersectRanges=[],u.styleMgr=new rR,u.intersectRanges=function(e,t,r,n,a){var o=e.getPivotTableManager();if(!o.hasPivotTable())return[];var i,u=[],s=new ou(t,r,n,a,e),l=yr(o.getPivotInfoMap());try{for(l.s();!(i=l.n()).done;){var c=i.value[1],h=c.pageRange,f=c.contentRange,d=null==h?void 0:h.intersect(s);d&&u.push(d);var v=null==f?void 0:f.intersect(s);v&&u.push(v)}}catch(e){l.e(e)}finally{l.f()}return u}(e,n,a,o,i),u.styleMgr.maxId=e._getModel().styleDropdownModel.getStyleRefMgr().maxId,u}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exportCells",value:function(e,t){var r=this;this.intersectRanges.length<=0||this.intersectRanges.forEach((function(n){for(var a=r.sheet.iterContent(n.rowFrom(),n.colFrom(),n.rowCount(),n.colCount()),o=a.next();null!==o;o=a.next()){var i=a.position();if(o&&o.variant){var u=o.variant.getValue(t);if(null!==u){var s=e(i.row,i.col);s.value=u,s.text=r.sheet.getText(i.row,i.col,void 0,void 0,t)}}}for(var l=r.sheet.iterCell(n.rowFrom(),n.colFrom(),n.rowCount(),n.colCount()),c=l.next();null!==c;c=l.next()){var h=l.position();if(c){var f=r.sheet._getModel().getStyle(h.row,h.col);f&&(e(h.row,h.col).styleId=r.styleMgr.add(f).id)}}}))}},{key:"exportExtraInfo",value:function(e){var t=this;this.styleMgr.idToRef.size<=0||(e.entities||(e.entities={}),e.entities.styles||(e.entities.styles={}),this.styleMgr.foreach((function(r,n){e.entities.styles[n]=r.toJSON(!0),t.styleMgr.useRefCounter&&(e.entities.styles[n].refCount=t.styleMgr.refCounter.get(r)||0)})))}},{key:"exportToCell",value:function(e,t){}}]),t}(D_),KO=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).sheet=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getExporter",value:function(e,t,r,n){return new JO(this.sheet,this,e,t,r,n)}}]),t}(Wg),XO=function(e){function t(e,r,n,a,o){var i;return(0,y.Z)(this,t),(i=(0,d.Z)(this,(0,v.Z)(t).call(this,e._getModel().contentModel.iter(r,n,a,o)))).sheet=e,i}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exportCells",value:function(e){for(var t=this.iter.next();null!==t;t=this.iter.next()){var r=this.iter.position();t&&(e(r.row,r.col).text=this.sheet.getText(r.row,r.col))}}},{key:"exportToCell",value:function(e,t){}}]),t}(D_),QO=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).sheet=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getExporter",value:function(e,t,r,n){return new XO(this.sheet,e,t,r,n)}}]),t}(Wg);function eV(e,t,r,n){var a,o,i=null==t?void 0:t.areaType,u="value"===i||"colSummary"===i||"rowSummary"===i||"total"===i,s="page"===i;if(!t||!u&&"colDim"!==i&&"rowDim"!==i&&!s)return r;var l="",c=1,h=!1;if("colDim"===i||"rowDim"===i){h=!0;var f=t.fieldName,d=t.fieldNameList,v=t.types,p=d.indexOf(f||"");p>-1&&(l=f,c=v[p])}else l=s?t.fieldName:t.measureFieldName;var m=e.getPivotTableManager(),g=m.getPivotTableByName(n),y=null==g||null===(a=g._fieldsModel.getFieldByName(l))||void 0===a?void 0:a.getFormat(),_=y||u?y:null===(o=m.getViewDataModelByName(n))||void 0===o?void 0:o.getFieldFormat(l);return h&&_&&2===c||!h&&_?Om.withFormatter(r||e.getDefaultStyle(),(0,Ee.createFormatter)(e.formatterService,_)):r}function tV(e,t,r){if(!r.containCell(e,t))return"";var n=r.rowFrom(),a=r.colFrom();return e===n&&t===a+1?cr("CreationDoc_Sheets_PivotTable_ColumnWorkSpace"):e===n+1&&t===a?cr("CreationDoc_Sheets_PivotTable_RowWorkSpace"):e===n+1&&t===a+1?cr("CreationDoc_Sheets_PivotTable_ValueWorkSpace"):e===n+5&&t===a+1?cr("CreationDoc_Sheets_PivotTable_WorkSpacePlaceHolder"):""}function rV(){return cr("CreationDoc_Sheets_PivotTable_FilterWorkSpace")}function nV(e,t,r,a){var o=e.parent.pivotService;if("number"==typeof t)return t;if(t&&"object"==(0,R.Z)(t)){if(void 0!==t.errorCode)return t.value;var i=t.text,u=void 0===i?"":i,s=t.type,l=t.keyType,c=t.suffix,h=void 0===c?"":c,f=t.date,d=function(e,t){var r=t;switch(e){case 1:r=cr("CreationDoc_Sheets_PivotTable_All");break;case 2:r=cr("CreationDoc_Sheets_PivotTable_Several");break;case 3:r=" ".concat(cr("CreationDoc_Sheets_PivotTable_TotalAfterText"));break;case 0:r=cr("CreationDoc_Sheets_PivotTable_ValueTitle");break;default:t&&(r=" "+t)}return r}(l,h)||"";if(void 0!==f&&r){var v=r.fieldName,p=null==a?void 0:a.groupMap[v];return p?function(e,t,r,n){return(0,Ft.MN)(e,t,new Date(r),n).cellValue}(o.getFormatterService(),o.getText.bind(o),f,p)+d:u+d}if(5===l)return it.ErrorConstant.NUM;if(0===s&&!d)return Number(t.text);if(2===s)return function(e,t,r,n,a){var o,i;if(o=r===String(Number(r))?Number(r):we.SheetDate.fromUTCDate(new Date(r)).toNumber(),t&&a&&("colDim"===t.areaType||"rowDim"===t.areaType||"page"===t.areaType)){var u,s=null==n||null===(u=n.getFieldFormat)||void 0===u?void 0:u.call(n,t.fieldName||"");i=(0,Ee.createFormatter)(e.formatterService,s||"").format(o)+a}else i=o;return i}(e,r,u,a,d);var g=u;if(3===s)g=cr("CreationDoc_Sheets_PivotTable_Blank");else if("string"==typeof g&&g.indexOf(Ft.kc)>-1){var y=g.split(Ft.kc),_=(0,n.Z)(y),C=_[0],w=_.slice(1);g=o.getText.apply(o,[C].concat((0,m.Z)(w)))}else 0===s&&(g="".concat(rn._parseFloat(Number(u))));return g?g+d:d.trimStart()}return t}function aV(e,t){var r=t.getSheetFromId(e.sheetId);return e.type===Ce.xj7.ALL?new au(r):e.type===Ce.xj7.ROW?new iu(e.row,e.rowCount,r):e.type===Ce.xj7.COL?new nu(e.col,e.colCount,r):new ou(e.row,e.col,e.rowCount,e.colCount,r)}var oV,iV="workbook/commandManager",uV="workbook/workbook",sV=Symbol("workbook/watchHub"),lV={source:Zt.lU.SHEET,parent:Zt.lU.SHEET,cross:!1},cV=function(e,t){var r,n=fV(t),a=e.getSheetFromId(n);return null==a||null===(r=a.rangeModel.getRangesFromId([t]))||void 0===r?void 0:r[0]};!function(e){e.ERR_RCE_LIVE_SYNC="1009"}(oV||(oV={}));var hV=function(e,t){var r,n=null===(r=e.sheet())||void 0===r?void 0:r.id();if(n){var a=e.rgType,o=e.toJSON(),i=o.row,u=o.col,s=o.rowCount,l=o.colCount;switch(a){case Ce.xj7.ALL:return{sheetId:n,rangeId:t,type:a};case Ce.xj7.ROW:return{sheetId:n,rangeId:t,type:a,row:i,rowCount:s};case Ce.xj7.COL:return{sheetId:n,rangeId:t,type:a,col:u,colCount:l};case Ce.xj7.NORMAL:return{sheetId:n,rangeId:t,type:a,row:i,col:u,rowCount:s,colCount:l};case Ce.xj7.CELL:return{sheetId:n,rangeId:t,type:Ce.xj7.NORMAL,row:i,col:u,rowCount:1,colCount:1};case Ce.xj7.INVALID:default:return}}},fV=function(e){return e.split("_")[0]};function dV(e){var t=e.sheet_id,r=e.value,n=e.target,a=r.range_id;switch(n.type){case 3:return{sheetId:t,rangeId:a,type:Ce.xj7.ALL};case 1:return{sheetId:t,rangeId:a,type:Ce.xj7.ROW,row:e.target.row,rowCount:e.target.row_count};case 2:return{sheetId:t,rangeId:a,type:Ce.xj7.COL,col:e.target.col,colCount:e.target.col_count};default:return{sheetId:t,rangeId:a,type:Ce.xj7.NORMAL,row:e.target.row,col:e.target.col,rowCount:e.target.row_count,colCount:e.target.col_count}}}var vV,pV=function(e,t){return"".concat(e).concat("_").concat(t||(0,Ce.zsn)(10))},mV=function(e,t){var r=e.split("_")[1];return pV(t,r)},gV=function(e,t){var r;if(!t)return"";var n=cV(e,t);if(!n)return"";var a=pV(n.sheetId),o=Object.assign({},n,{rangeId:a});return(null===(r=e.setDataRange)||void 0===r?void 0:r.call(e,[o]))?a:""};!function(e){e.UNDO="undo",e.REDO="redo",e.LOCAL="local",e.COLLA="colla"}(vV||(vV={}));var yV,_V=function(e,t){return e?"undo"===e?vV.UNDO:vV.REDO:t&&t?vV.LOCAL:vV.COLLA};!function(e){e.DATA_RANGE_SELECTOR="DataRangeSelector",e.FORMULA_REF_ADJUST="FormulaRefAdjust",e.DATA_RANGE_ADJUST="dataRangeAdjust",e.PASSIVE="passive"}(yV||(yV={}));var RV=function(e,t){return!(!e.getSheetFromId(t.sheetId)||!aV(t,e))},CV=function(){function e(t){(0,y.Z)(this,e),this._spread=t,this._sourceRanges=new Map,this._dataRanges=new Map,this.bindEvents()}return(0,_.Z)(e,[{key:"bindEvents",value:function(){this._spread.subscribe(this.getWorkbookEvents())}},{key:"getWorkbookEvents",value:function(){return{SheetDataRangeAdjusted:this.handleDataRangeAdjusted,AfterApply:this.handleAfterApply,MoveRange:this.handleMoveRange}}},{key:"handleAfterApply",value:function(e){var t=this,r=e.actions;if(e.fromUndoRedo){var n,a=yr(this._dataRanges);try{var o=function(){var e=(0,g.Z)(n.value,2),a=e[0],o=e[1],i=o.sheetId,u=r.filter((function(e){var t=e.action,r=e.sheet_id;return!!["setDataRange"].includes(t)&&r===i}));if(!u.length)return"continue";for(var s={},c=0;c<u.length;c++){var h=dV(u[c]);s[h.rangeId]=h}var f=s[o.rangeId];if(!f)return"continue";(function(e,t){var r,n,a,o;if(!t)return!1;var i=e.toJSON(),u=i.row,s=i.col,c=i.rowCount,h=i.colCount;if((null===(r=e.sheet())||void 0===r?void 0:r.id())!==t.sheetId)return!1;var f=e.rgType,d=t.type,v=(n={},(0,l.Z)(n,Ce.xj7.ALL,(function(){return d===Ce.xj7.ALL})),(0,l.Z)(n,Ce.xj7.ROW,(function(){return d===Ce.xj7.ROW&&u===t.row&&c===t.rowCount})),(0,l.Z)(n,Ce.xj7.COL,(function(){return d===Ce.xj7.COL&&s===t.col&&h===t.colCount})),(0,l.Z)(n,Ce.xj7.CELL,(function(){return d===Ce.xj7.NORMAL&&u===t.row&&s===t.col&&c===t.rowCount&&h===t.colCount})),(0,l.Z)(n,Ce.xj7.NORMAL,(function(){return d===Ce.xj7.NORMAL&&u===t.row&&s===t.col&&c===t.rowCount&&h===t.colCount})),n);return null!==(a=null===(o=v[f])||void 0===o?void 0:o.call(v))&&void 0!==a&&a})(t.getSourceRange(a),f)||t.updateSourceDataRange(a,f,yV.PASSIVE)};for(a.s();!(n=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}}}},{key:"handleDataRangeAdjusted",value:function(e){var t=this,r=e.sheetId,n=e.dataRangeMap;this._dataRanges.forEach((function(e,a){var o=e.sheetId,i=e.rangeId;if(r===o){var u=n.get(i);if(void 0===u)return void t.deleteSourceDataRange(a);var s=Object.assign({},u),l=t.getDataSourceJSON(a);if(!(0,me.default)(s,l)){t.setDataSourceJSON(a,s);var c=aV(s,t._spread);t._sourceRanges.set(a,c)}}}))}},{key:"handleMoveRange",value:function(e,t,r){var n=this,a=e.toRange;e.toEdgeAdjust&&r!==vV.UNDO&&r!==vV.REDO&&this._sourceRanges.forEach((function(e,t){if(e.isIntersect(a)){var r,o=a.sheet(),i=null===(r=n._dataRanges.get(t))||void 0===r?void 0:r.rangeId;if(o&&i){var u=o.rangeModel.getRangeFromId(i);n.handleDataRangeAdjusted({sheetId:o.id(),dataRangeMap:new Map([[i,u]])})}}}))}},{key:"getSourceRange",value:function(e){return this._sourceRanges.get(e)}},{key:"getDataSourceJSON",value:function(e){return this._dataRanges.get(e)}},{key:"setDataSourceJSON",value:function(e,t){this._dataRanges.set(e,t)}},{key:"getRangeIdByToken",value:function(e){var t=this._dataRanges.get(e);if(t)return t.rangeId}},{key:"addSourceDataRange",value:function(e,t,r){if(!RV(this._spread,t))return!1;this.setDataSourceJSON(e,t);var n=aV(t,this._spread);return this._sourceRanges.set(e,n),this._spread.dispatch("PivotDataSourceChanged",{blockToken:e,sourceRange:n,source:r}),!0}},{key:"updateSourceDataRange",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:yV.DATA_RANGE_SELECTOR,n=Object.assign({},t);if(!RV(this._spread,n))return!1;if(this._dataRanges.has(e)){var a=this._dataRanges.get(e);if((0,me.default)(a,n))return!1;this.setDataSourceJSON(e,n);var o=aV(n,this._spread);return this._sourceRanges.set(e,o),this._spread.dispatch("PivotDataSourceChanged",{blockToken:e,sourceRange:o,source:r}),!0}return this.addSourceDataRange(e,n,r)}},{key:"deleteSourceDataRange",value:function(e){this._dataRanges.delete(e),this._sourceRanges.delete(e)}},{key:"clearSourceRange",value:function(){this._sourceRanges.clear()}},{key:"clearDataRange",value:function(){this._dataRanges.clear()}},{key:"validateFormHeader",value:function(e,t,r,n,a){return(0,Jt.FW)([],{},{row:t,col:r,rowCount:1,colCount:a,sheetId:e.id()})}},{key:"getData",value:function(e,t,r,n,a,o){var i=function(e,t,r,n,a){var o,i,u=new qg,s=e._getModel();u.addModel(s.contentModel).addModel(s.dataValidationModel).addModel(s.styleDropdownModel).addModel(s.extralModel).addModel(s.reminderModel).addModel(new qO(e)).addModel(new KO(e)),n||u.addModel(new QO(e));var l=u.getExporter(t.row,t.col,t.rowCount,t.colCount);l.setExportType(r);var c=s.genBlockTable(l,a),h={id:e.id(),name:e.name(),index:0,rowCount:t.rowCount,columnCount:t.colCount,hidden:e._hidden};l.exportExtraInfo(h);var f=(null===(o=h.entities)||void 0===o?void 0:o.styles)||{},d=Object.keys(f).map((function(e){return parseInt(e,10)})),v=d.length>0?Math.max.apply(Math,(0,m.Z)(d)):0;if(c){var p,g=yr(c.data.rows);try{for(g.s();!(p=g.n()).done;){var y=p.value;if(y){var _,R=yr(y.columns);try{for(R.s();!(_=R.n()).done;){var C=_.value;if(C&&C.autoFormat){var w=C.autoFormat,E=void 0;if(delete C.autoFormat,C.styleId){var k=f[C.styleId];if(k.formatter&&k.formatter.formatCached)continue;E=JSON.parse(JSON.stringify(k))}else E={};E.formatter={formatCached:w},delete E.autoFormatter,f[++v]=E,C.styleId=v}}}catch(e){R.e(e)}finally{R.f()}}}}catch(e){g.e(e)}finally{g.f()}}if(v>0&&!(null!==(i=h.entities)&&void 0!==i&&i.styles)&&(h.entities=h.entities||{},h.entities.styles=f),c&&c.startRowIndex>t.row&&(c.data.rows=Array(c.startRowIndex-t.row).fill({columns:[]}).concat(c.data.rows),c.rowsCount+=c.startRowIndex-t.row),c){h.blocks=[{startRowIndex:0,rowsCount:c.rowsCount}];var T,S=yr(c.data.rows);try{for(S.s();!(T=S.n()).done;){var A=T.value;A&&A.columns.splice(0,t.col)}}catch(e){S.e(e)}finally{S.f()}}var I,O=[],V=yr(e._spanModel.getSpans(new ou(t.row,t.col,t.rowCount,t.colCount,e)));try{for(V.s();!(I=V.n()).done;){var N=I.value,b=N.rowFrom()-t.row,M=Math.min(N.rowCount()+Math.min(b,0),t.rowCount);b=Math.max(b,0);var F=N.colFrom()-t.col,Z=Math.min(N.colCount()+Math.min(F,0),t.colCount);F=Math.max(F,0),O.push({row:b,col:F,rowCount:M,colCount:Z})}}catch(e){V.e(e)}finally{V.f()}return h.spans=O,{sheetSnapshot:h,data:null==c?void 0:c.data}}(e,{row:t,col:r,rowCount:n,colCount:a},3,!0,o),u=i.sheetSnapshot,s=i.data;return(0,Jt.i7)(s,u,{row:t,col:r,rowCount:n,colCount:a},e.parent.pivotService)}},{key:"getSourceRangeMap",value:function(){return this._sourceRanges}},{key:"dispose",value:function(){delete this._spread,this.clearSourceRange(),this.clearDataRange()}}]),e}();Vu([(0,Mt.Bind)()],CV.prototype,"handleAfterApply",null),Vu([(0,Mt.Bind)()],CV.prototype,"handleDataRangeAdjusted",null),Vu([(0,Mt.Bind)()],CV.prototype,"handleMoveRange",null),CV=Vu([(0,st.b)(),Nu(0,(0,lt.f)(uV))],CV);var wV=function(){function e(){(0,y.Z)(this,e),this._pivotTables=new Map,this._pivotTableInfoMap=new Map,this._pivotTablePreViews=new Map,this._pivotTableViews=new Map}return(0,_.Z)(e,[{key:"getPivotTableByToken",value:function(e){return this._pivotTables.get(e)}},{key:"setPivotTable",value:function(e,t){this._pivotTables.set(e,t)}},{key:"deletePivotTableByToken",value:function(e){this._pivotTables.delete(e)}},{key:"getPivotTableSize",value:function(){return this._pivotTableInfoMap.size}},{key:"getPivotInfoMap",value:function(){return this._pivotTableInfoMap}},{key:"getPivotInfoByToken",value:function(e){return this._pivotTableInfoMap.get(e)}},{key:"setPivotTableInfo",value:function(e,t){this._pivotTableInfoMap.set(e,t)}},{key:"deletePivotTableInfoByToken",value:function(e){this._pivotTableInfoMap.delete(e)}},{key:"updatePivotTableInfo",value:function(e,t){var r=this.getPivotInfoByToken(e);if(r){var n=Object.assign(r,t);this.setPivotTableInfo(e,n)}}},{key:"getPivotTablePreViewByToken",value:function(e){return this._pivotTablePreViews.get(e)}},{key:"setPivotTablePreView",value:function(e,t){this._pivotTablePreViews.set(e,t)}},{key:"deletePivotTablePreView",value:function(e){this._pivotTablePreViews.delete(e)}},{key:"getViewDataModelByToken",value:function(e){return this._pivotTableViews.get(e)}},{key:"setViewDataModel",value:function(e,t){this._pivotTableViews.set(e,t)}},{key:"deleteViewDataModel",value:function(e){this._pivotTableViews.delete(e)}},{key:"dispose",value:function(){this._pivotTableInfoMap.clear(),this._pivotTables.clear(),this._pivotTableViews.clear(),this._pivotTablePreViews.clear()}}]),e}();Vu([(0,lt.f)(Lm)],wV.prototype,"sheet",void 0),wV=Vu([(0,st.b)()],wV);var EV,kV,TV,SV=function e(t){if("object"!=(0,R.Z)(t)||null===t)return t;if(Array.isArray(t))return t.map(e);var r={};for(var n in t)r[n]=e(t[n]);return r},AV=function(e){return"object"!=(0,R.Z)(e)||null===e?e:Array.isArray(e)?(0,m.Z)(e):Object.assign({},e)},IV=function(e){if("object"!=(0,R.Z)(e)||null===e)return e;var t={};for(var r in e){var n=e[r];t[r]="cacheFieldInfo"===r?AV(n):SV(n)}return t},OV=function(e){for(var t=-1,r=e.length,n=0;n<r;n+=1)"FROM_JSON"===e[n].type&&(t=n);return-1===t?{fromJSONMsg:null,validMsgList:e}:{fromJSONMsg:e[t],validMsgList:e.slice(t+1)}},VV=new Set(["UPDATE_CACHE_FIELD","REMOVE_CACHE_FIELD_ITEM","ADD_CACHE_FIELD_ITEM"]),NV=new Set(["ADD_FIELD","REMOVE_FIELD","MOVE_FIELD","RENAME_FIELD","SET_FIELD_LABEL_FILTER","SET_FIELD_SUMMARY_TYPE","UPDATE_VALUE_POSITION","UPDATE_CACHE_FIELD","REMOVE_CACHE_FIELD_ITEM"]),bV=function(e){var t=e.some((function(e){return VV.has(e.type)})),r=t||e.some((function(e){return NV.has(e.type)}));return{rebuildCache:{needRebuild:t},rebuildCube:r,rebuildView:r||!0}};!function(e){e.SNAPSHOT_SET="snapshotSet",e.OPS_RECEIVED="opsReceived"}(kV||(kV={}));var MV=function(e){function t(e,r){var n,a;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,e)))._subscriptions=[],a._prevSnapshot=null,a._destroyHooks=[],a._getOpExtraFromRebuildInfo=function(e){if(Object.keys(e).length<1)return null;var t=e.rebuildCache||{needRebuild:!1},r=t.needRebuild||e.rebuildCube||!1;return{rebuildCache:t,rebuildCube:r,rebuildView:r||e.rebuildView||!0}},a._token=r.token,a.specificVersion=null!==(n=r.specificVersion)&&void 0!==n?n:-1,a._onInit(r.initSnapshot),a}return(0,p.Z)(t,e),(0,_.Z)(t,null,[{key:"getOpsExtras",value:function(e){var t,r=new Set(["cacheFieldInfo","rangeId"]),n=new Set(["collapseInfo","hiddenTotalInfo","showDataAsInfo","repeatLabelInfo","autoFitCol","sortInfo"]),a=!1,o=yr(e);try{for(o.s();!(t=o.n()).done;){if(t.value.p.some((function(e){return r.has(e)}))){a=!0;break}}}catch(e){o.e(e)}finally{o.f()}var i,u=a||!1,s=yr(e);try{for(s.s();!(i=s.n()).done;){var l=i.value,c=l.p,h=l.action;if(c.includes("summaryType")&&((null==h?void 0:h.oi)===Ft.wl.distinct||(null==h?void 0:h.oi)===Ft.wl.mid)){u=!0;break}if(!c.some((function(e){return n.has(e)}))){u=!0;break}}}catch(e){s.e(e)}finally{s.f()}return{rebuildCache:{needRebuild:a},rebuildCube:u,rebuildView:!0}}},{key:"getDefaultSnapshot",value:function(e,t,r){return{fields:{dim:{row:[],col:[],page:[],hide:[]},measure:[],cacheName:r,collapseInfo:{},hiddenTotalInfo:{},valueIndex:0,valuePosition:0,repeatLabelInfo:{}},cacheFieldInfo:t,emptyValueShowAs:"",errorValueShowAs:"",cacheName:r,rangeId:e,config:{},version:1}}}]),(0,_.Z)(t,[{key:"_onInit",value:function(e){e?this.setSnapshot(e):this.fetchSnapshot(),this._createEventListeners()}},{key:"bindDestoryHook",value:function(e){var t=this;return this._destroyHooks.push(e),function(){t._destroyHooks=t._destroyHooks.filter((function(t){return t!==e}))}}},{key:"onDestroy",value:function(){this._subscriptions.forEach((function(e){return e.unsubscribe()})),this._destroyHooks.forEach((function(e){try{e()}catch(e){console.error("[PIVOT] destroy pivot sync model error",e)}})),this._destroyHooks=[],this.model.destroy()}},{key:"manualDestroy",value:function(){this.onDestroy()}},{key:"_getHookFromObservable",value:function(e){var t=this;return function(r){var n=e.subscribe(r);return t._subscriptions.push(n),function(){return n.unsubscribe()}}}},{key:"_getBaseSnapshotChangeFromEvent",value:function(e){return{isCollab:e.isCollab,isPassive:e.isPassive,snapshot:this.getSnapshot(),prevSnapshot:this._prevSnapshot}}},{key:"_createEventListeners",value:function(){var e=this;this.snapshotSet$=this.model.clientVarsReady$.pipe((0,Pt.map)((function(e){var t,r="COLLAB"===e.type,n=r;return{eventType:e.type,isPassive:n,isCollab:r,snapshot:null===(t=e.detail)||void 0===t?void 0:t.initData}}))),this.onSnapshotSet=this._getHookFromObservable(this.snapshotSet$),this.opsReceive$=this.model.didUpdate$.pipe((0,Pt.map)((function(e){var t=[Kt.M1.undo,Kt.M1.redo].includes(e.type),r="COLLAB"===e.type,n=!e.detail.length||t||r||"BATCH"===e.type;return{eventType:e.type,isPassive:n,isUndoRedo:t,isCollab:r,ops:e.detail}}))),this.onOpsReceive=this._getHookFromObservable(this.opsReceive$),this.snapshotChange$=new dt.xQ,this.onSnapshotChange=this._getHookFromObservable(this.snapshotChange$),(0,gt.T)(this.snapshotSet$.pipe((0,Pt.map)((function(t){return Object.assign({},e._getBaseSnapshotChangeFromEvent(t),{type:"snapshotSet"})}))),this.opsReceive$.pipe((0,Pt.map)((function(t){return Object.assign({},e._getBaseSnapshotChangeFromEvent(t),{type:"opsReceived",isUndoRedo:t.isUndoRedo,ops:t.ops})})))).pipe((0,Ht.b)((function(t){var r=t.snapshot;e._prevSnapshot=IV(r)}))).subscribe(this.snapshotChange$),this.undoRedoStatus$=this.model.didUpdate$.pipe((0,Pt.map)((function(){return{canUndo:e.model.canUndo(),canRedo:e.model.canRedo()}})),(0,zt.distinctUntilChanged)((function(e,t){return e.canUndo!==t.canUndo||e.canRedo!==t.canRedo}))),this.onUndoRedoStatusChange=this._getHookFromObservable(this.undoRedoStatus$),this.error$=this.model.error$,this.onError=this._getHookFromObservable(this.error$),this.inited$=new yt.t(1),(0,gt.T)(this.snapshotSet$,this.error$).pipe((0,Wt.P)(),(0,Pt.map)((function(){return!0}))).subscribe(this.inited$),this.onInited=this._getHookFromObservable(this.inited$)}},{key:"toJSON",value:function(){var e=this.getSnapshot();return(0,Re.default)(e)}},{key:"setSnapshot",value:function(e){this.model.setSnapshot(e)}},{key:"getSnapshot",value:function(){return this.model.getSnapshot()}},{key:"getVersion",value:function(){return this.specificVersion}},{key:"setVersion",value:function(e){this.specificVersion=e}},{key:"fetchSnapshot",value:function(){-1===this.specificVersion?this.model.fetchClientVars():this.model.fetchClientVarsByVersion(this.specificVersion)}},{key:"undo",value:function(){this.model.canUndo()&&this.model.undo()}},{key:"redo",value:function(){this.model.canRedo()&&this.model.redo()}},{key:"opsApply",value:function(e,t,r){var n=t&&this._getOpExtraFromRebuildInfo(t),a=Array.isArray(e)?e:[e],o=n?a.map((function(e){return Object.assign({},e,{_pivotExtra:n})})):a,i=Object.assign({undoable:!0},r);return this.model.apply(o,i)}},{key:"token",get:function(){return this._token}},{key:"syncVersion",get:function(){return this.model.getRecord().getSync().version}}]),t}(Xt.yh);EV=MV,MV.handleClipboardData=function(){return Promise.resolve()},MV.type=Zt.kH.PIVOT_TABLE,MV.syncType="PIVOT_TABLE",MV.apiConfig=function(){return{CLIENT_VARS:"/api/v2/sheet/blocks/pivot_table/snapshot/",CLIENT_VARS_BY_VERSION:"/api/v2/sheet/blocks/pivot_table/history/",NEW_CHANGES:"/api/v2/sheet/blocks/pivot_table/changesets/",USER_CHANGES:"/api/v2/sheet/blocks/pivot_table/user_change/"}},MV.createBlock=function(){var e=(0,u.Z)(i().mark((function e(t,r){var n;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r({headers:{"Content-Type":"application/json"},method:"post",url:"/api/v2/sheet/blocks/pivot_table/create/",data:{parentType:t.parentType,parentToken:t.parentToken,snapshot:JSON.stringify(t.snapshot),source:t.source,dataSource:null===(n=t.dataSource)||void 0===n?void 0:n[0]}});case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),MV.modifyUserChangePayloadBeforeSend=function(e){var t,r=null==e||null===(t=e.content)||void 0===t?void 0:t.operations;if(r){var n=r.map((function(e){e._pivotExtra;return(0,s.Z)(e,vr)})),a=EV.getOpsExtras(r);e.extra=JSON.stringify(a),e.content.operations=n}},function(e){e.SnapshotSet="SnapshotSet",e.OpsReceived="OpsReceive",e.SnapshotChanged="SnapshotChanged",e.UndoRedoStatusChanged="UndoRedoStatusChange",e.SyncError="SyncError",e.Initialized="Initialized"}(TV||(TV={}));var FV,ZV,xV=function(){function e(t){var r=this;(0,y.Z)(this,e),this.page=null,this.corner=null,this.cornerBottom=null,this.row=null,this.rowRepeatLabel=null,this.rowWithButton=null,this.rowFields=null,this.rowCollapseFields=null,this.col=null,this.colRepeatLabel=null,this.colFields=null,this.value=null,this.rowSummary=null,this.bottomRowTotal=null,this._newStyleByOld={page:0,corner:1,cornerBottom:2,row:3,rowWithButton:4,rowFields:5,rowCollapseFields:6,col:7,colFields:8,colBottomField:9,value:10,rowSummary:11,bottomRowTotal:12},this.handleUIStateChange=function(){r.initStyles()},this.name=t,this._unsubscribeUIState=(0,Qt.onUIStateChange)(this.handleUIStateChange)}return(0,_.Z)(e,[{key:"initStyles",value:function(){this.initCommonStyle(),this.initPageAreaStyles(),this.initCornerAreaStyles(),this.initColAreaStyles(),this.initRowAreaStyles(),this.initValueStyles()}},{key:"getCellStyle",value:function(e){return{0:this.page,1:this.corner,14:this.colRepeatLabel,2:this.cornerBottom,3:this.row,13:this.rowRepeatLabel,4:this.rowWithButton,5:this.rowFields,6:this.rowCollapseFields,8:this.colFields,7:this.col,10:this.value,11:this.rowSummary,12:this.bottomRowTotal}[this._newStyleByOld[e]||e]||null}},{key:"dispose",value:function(){var e;null===(e=this._unsubscribeUIState)||void 0===e||e.call(this)}}]),e}(),DV=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).initStyles(),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"initCommonStyle",value:function(){this.whiteTextColor="#ffffff",this.blackTextColor="#1f2329";var e="#1c4cba";this.borderLine=new dm(e,1),this.dimStyle1=Om.newStyle({backColor:"#f0f4ff",foreColor:this.blackTextColor,vAlign:Ce.g$I.Center,fontInfo:{fontWeight:700},textDecoration:Ce.aBM.none}),this.dimStyle2=Om.newStyle({backColor:e,foreColor:this.whiteTextColor,vAlign:Ce.g$I.Center,fontInfo:{fontWeight:700},textDecoration:Ce.aBM.none},this.dimStyle1)}},{key:"initPageAreaStyles",value:function(){this.page=Om.newStyle({vAlign:Ce.g$I.Center,backColor:"#f8f9fa",foreColor:this.blackTextColor,textDecoration:Ce.aBM.none})}},{key:"initCornerAreaStyles",value:function(){this.corner=this.dimStyle1.clone(),this.cornerBottom=this.dimStyle1.clone()}},{key:"initColAreaStyles",value:function(){this.col=this.dimStyle2.clone(),this.colRepeatLabel=this.col.clone(),this.colFields=this.dimStyle1.clone()}},{key:"initRowAreaStyles",value:function(){this.page?(this.row=this.page.clone(),this.rowWithButton=this.row.clone(),this.rowWithButton=Om.newStyle({fontInfo:{fontWeight:700}},this.row),this.rowRepeatLabel=this.rowWithButton.clone(),this.rowFields=this.dimStyle1.clone(),this.rowCollapseFields=this.dimStyle1.clone()):console.warn("[Pivot Table]: Theme Row Area Style Init Fail!")}},{key:"initValueStyles",value:function(){this.rowSummary=this.dimStyle1.clone(),this.bottomRowTotal=Om.newStyle({borderTop:this.borderLine},this.dimStyle1)}}]),t}(xV),PV=function(){function e(){var t=this;(0,y.Z)(this,e),this.handleUIStateChange=function(){t.initStyles()},this.initStyles(),this._unsubscribeUIState=(0,Qt.onUIStateChange)(this.handleUIStateChange)}return(0,_.Z)(e,[{key:"initStyles",value:function(){this.bgColor1="#f5f6f7",this.bgColor2="#8f959e",this.bgColor3="#ffffff",this.tipTextColor="#8f959e",this.whiteTextColor="#ffffff",this.blackTextColor="#1f2329";var e=new dm(this.bgColor1,1);this.row=Om.newStyle({backColor:this.bgColor1,foreColor:this.blackTextColor,borderRight:e,borderTop:e,vAlign:Ce.g$I.Center,textDecoration:Ce.aBM.none}),this.page=Om.newStyle({textDecoration:Ce.aBM.none,backColor:this.bgColor1,foreColor:this.blackTextColor,vAlign:Ce.g$I.Center}),this.corner=Om.newStyle({textDecoration:Ce.aBM.none});var t=new dm(this.bgColor2,1);this.col=Om.newStyle({backColor:this.bgColor2,foreColor:this.whiteTextColor,borderLeft:t,borderBottom:t,borderTop:t,vAlign:Ce.g$I.Center,textDecoration:0});var r=new dm(this.bgColor3,1);this.value=Om.newStyle({backColor:this.bgColor3,borderTop:r,borderLeft:r,vAlign:Ce.g$I.Center,textDecoration:0}),this.valueTip=Om.newStyle({foreColor:this.tipTextColor,vAlign:Ce.g$I.Center,hAlign:Ce.KqL.Center,wordWrap:1},this.value)}},{key:"getPageStyle",value:function(){return this.page}},{key:"getCornerStyle",value:function(){return this.corner}},{key:"getColStyle",value:function(){return this.col}},{key:"getRowStyle",value:function(){return this.row}},{key:"getValueStyle",value:function(){return this.value}},{key:"getValueTipStyle",value:function(){return this.valueTip}},{key:"dispose",value:function(){var e;null===(e=this._unsubscribeUIState)||void 0===e||e.call(this)}}]),e}(),$V=function(){function e(){(0,y.Z)(this,e),this.themeMap=new Map}return(0,_.Z)(e,[{key:"initEmptyTheme",value:function(){this.emptyTheme=new PV}},{key:"getCellStyle",value:function(e,t){var r=this.themeMap.get(e);return r||(r=this.createTheme(e),this.themeMap.set(e,r)),r.getCellStyle(t)}},{key:"createTheme",value:function(e){return new DV(e)}},{key:"getEmptyPivotTableStyle",value:function(e,t,r,n){if(this.emptyTheme||this.initEmptyTheme(),e)return this.emptyTheme.getPageStyle();if(void 0===t||void 0===r||!n)return null;if(!n.containCell(t,r))return null;var a=n.rowFrom(),o=n.colFrom(),i=n.rowTo(),u=n.colTo();return t===a&&r===o?this.emptyTheme.getCornerStyle():t===a&&r>o&&r<=u?this.emptyTheme.getColStyle():r===o&&t>a&&t<=i?this.emptyTheme.getRowStyle():t===a+5&&r<=u?this.emptyTheme.getValueTipStyle():t<=i&&r<=u?this.emptyTheme.getValueStyle():null}},{key:"composePivotStyle",value:function(e,t){return t?e?Om.composeStyles(t,e):t:e}},{key:"dispose",value:function(){this.emptyTheme.dispose();var e,t=yr(this.themeMap);try{for(t.s();!(e=t.n()).done;){var r=(0,g.Z)(e.value,2);r[0];r[1].dispose()}}catch(e){t.e(e)}finally{t.f()}this.themeMap.clear(),this.emptyTheme=null}}]),e}(),LV=new $V,BV="sheet-proxy-pivot-model",UV="pivot-table-manager-v2",HV="sheet-pivot-data-source-manager",zV="sync-model-manager",WV="sync-model-manager-in-worker",GV=function(){function e(){(0,y.Z)(this,e),this.cellPivotCache={shareKey:{},id:0}}return(0,_.Z)(e,[{key:"getSheet",value:function(){return this.sheet}},{key:"getPivotTableByToken",value:function(e){return this._sheetProxyPivotModel.getPivotTableByToken(e)}},{key:"getPivotTableByName",value:function(e){return this._sheetProxyPivotModel.getPivotTableByToken(e)}},{key:"getPivotInfoByToken",value:function(e){return this._sheetProxyPivotModel.getPivotInfoByToken(e)}},{key:"getPivotInfoByName",value:function(e){return this._sheetProxyPivotModel.getPivotInfoByToken(e)}},{key:"getPivotInfoMap",value:function(){return this._sheetProxyPivotModel.getPivotInfoMap()}},{key:"getCellPivotCache",value:function(e,t){if(this.cellPivotCache[e]&&void 0!==this.cellPivotCache[e][t])return this.cellPivotCache.shareKey[this.cellPivotCache[e][t]]}},{key:"setCellPivotCache",value:function(e,t,r){this.cellPivotCache[e]||(this.cellPivotCache[e]={}),void 0===this.cellPivotCache.shareKey[r]&&(this.cellPivotCache.shareKey[r]=this.cellPivotCache.id,this.cellPivotCache.shareKey[this.cellPivotCache.id]=r,this.cellPivotCache.id++),this.cellPivotCache[e][t]=this.cellPivotCache.shareKey[r]}},{key:"updateCellPivotCache",value:function(e,t,r){var n=this,a=t.pageRange,o=t.contentRange,i=t.spanRange,u=r.pageRange,s=r.contentRange,l=r.spanRange;[a,o,i].forEach((function(t){if(t)for(var r=t.rowFrom(),a=t.colFrom(),o=t.rowCount(),i=t.colCount(),u=r;u<r+o;u++)for(var s=a;s<a+i;s++)n.deleteCellPivotCache(u,s,e)})),[u,s,l].forEach((function(t){if(t)for(var r=t.rowFrom(),a=t.colFrom(),o=t.rowCount(),i=t.colCount(),u=r;u<r+o;u++)for(var s=a;s<a+i;s++)n.setCellPivotCache(u,s,e)}))}},{key:"deleteCellPivotCache",value:function(e,t,r){var n=this.cellPivotCache.shareKey[r];this.cellPivotCache[e]&&void 0!==n&&this.cellPivotCache[e][t]===n&&(this.cellPivotCache[e][t]=void 0)}},{key:"deleteCellPivotCacheByToken",value:function(e){var t=this.cellPivotCache.shareKey[e];void 0!==t&&(this.cellPivotCache.shareKey[t]=void 0,this.cellPivotCache.shareKey[e]=void 0)}},{key:"clearCellPivotCache",value:function(){this.cellPivotCache={shareKey:{},id:0}}},{key:"getViewDataModelByToken",value:function(e){return this._sheetProxyPivotModel.getViewDataModelByToken(e)}},{key:"getAllPivotTableRanges",value:function(){var e,t=[],r=yr(this.getPivotInfoMap());try{for(r.s();!(e=r.n()).done;){var n=(0,g.Z)(e.value,2)[1],a=n.pageRange,o=n.contentRange;a&&t.push(a),o&&t.push(o)}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"getViewDataModelByName",value:function(e){return this._sheetProxyPivotModel.getViewDataModelByToken(e)}},{key:"getPivotTablePreViewByToken",value:function(e){return this._sheetProxyPivotModel.getPivotTablePreViewByToken(e)}},{key:"getPositionCell",value:function(e){if(this.hasPivotTable()){var t=this._sheetProxyPivotModel.getPivotInfoByToken(e);return t?{row:t.row,col:t.col}:void 0}}},{key:"getPivotTableByCell",value:function(e,t){var r=this.getPivotTableNameByCell(e,t);if(r)return this.getPivotTableByToken(r)}},{key:"getActivePivotTable",value:function(){var e=this.sheet.getActiveCellIndex();return this.getPivotTableByCell(e.row,e.column)}},{key:"getPivotTableNameByCell",value:function(e,t){return this.getCellPivotCache(e,t)||""}},{key:"hasPivotTableAtCell",value:function(e,t){return!!this.hasPivotTable()&&!!this.getPivotTableNameByCell(e,t)}},{key:"getPivotErrorStateByCell",value:function(e,t){if(!this.hasPivotTableAtCell(e,t))return null;var r=this.getPivotTableNameByCell(e,t);if(!r)return null;var n=this.getPivotInfoByToken(r);return n?n.errorState:null}},{key:"getViewDataModelByPosition",value:function(e,t){if(this.hasPivotTableAtCell(e,t)){var r=this.getPivotTableNameByCell(e,t);return this.getViewDataModelByToken(r)}}},{key:"getFilterSort",value:function(e,t){var r=this.getPivotTableNameByCell(e,t),n=this.getPivotInfoByToken(r);if(n&&!n.errorState&&!n.isHidden&&!n.isEmpty){var a,o=this.getViewDataModelByToken(r),i=n.pageRange,u=n.contentRange;return null!=i&&i.containCell(e,t)&&(a=null==o?void 0:o.getPageCellButtonState(e-i.rowFrom(),t-i.colFrom())),null!=u&&u.containCell(e,t)&&(a=null==o?void 0:o.getCellButtonState(e-u.rowFrom(),t-u.colFrom())),void 0!==a&&a<=32?a:void 0}}},{key:"getCollapse",value:function(e,t){var r=this.getPivotTableNameByCell(e,t),n=this.getPivotInfoByToken(r);if(n&&n.errorState===Pp.None&&!n.isHidden&&!n.isEmpty){var a=this.getViewDataModelByToken(r),o=n.contentRange;if(null!=o&&o.containCell(e,t)){var i=null==a?void 0:a.getCellButtonState(e-o.rowFrom(),t-o.colFrom());return 64===i||128===i?i:void 0}}}},{key:"getRepeatLabelInfo",value:function(e,t){var r,n={isRepeatLabel:!1},a=this.getPivotTableNameByCell(e,t),o=null===(r=this.getPivotInfoByToken(a))||void 0===r?void 0:r.contentRange;if(!a||!o)return n;var i=this.getViewDataModelByToken(a);return(null==i?void 0:i.getRepeatLabelInfo(e-o.rowFrom(),t-o.colFrom()))||n}},{key:"getCellInfo",value:function(e,t){if(this.hasPivotTableAtCell(e,t)){var r=this.getPivotTableNameByCell(e,t),n=this.getViewDataModelByToken(r),a=this.getPivotTableByToken(r),o=this.getPivotInfoByToken(r),i=o.pageRange;if(null!=i&&i.containCell(e,t))return null==n?void 0:n.getPageCellInfo(e-i.rowFrom(),t-i.colFrom());var u=o.contentRange;return null!=u&&u.containCell(e,t)?null==n?void 0:n.getCellInfo(e-u.rowFrom(),t-u.colFrom(),(null==a?void 0:a._fieldsModel)||null):void 0}}},{key:"getCellValue",value:function(e,t){if(!this.hasPivotTableAtCell(e,t))return null;var r=this.getPivotTableNameByCell(e,t),n=this.getPivotInfoByToken(r),a=n.contentRange,o=n.pageRange,i=n.isEmpty,u=n.errorState,s=n.isHidden,l=n.loaded,c=n.row,h=n.col;if(s)return null;switch(!0){case c===e&&h===t&&(u===Pp.Loading||!l):return it.ErrorConstant.WAIT_ASYNC;case l&&u===Pp.None:var f,d=this.getViewDataModelByToken(r),v=this.getPivotTableByToken(r);if(null!=o&&o.containCell(e,t)){if(i)return rV();f=null==d?void 0:d.getPageCellValue(e-o.rowFrom(),t-o.colFrom())}if(null!=a&&a.containCell(e,t)){if(i)return tV(e,t,a)||null;f=null==d?void 0:d.getCellValue(e-a.rowFrom(),t-a.colFrom(),null==v?void 0:v.getEmptyValueShowAs())}var p=this.getCellInfo(e,t),m=nV(this.sheet,f,p,d||null);return""===m||void 0===m?null:m;case c===e&&h===t&&l&&u===Pp.Circle:return it.ErrorConstant.CIRCULAR_DEPENDENCY;case c===e&&h===t&&l&&u!==Pp.None:return it.ErrorConstant.REF}return null}},{key:"getCellStyle",value:function(e,t){if(!this.hasPivotTableAtCell(e,t))return null;var r=this.getPivotTableNameByCell(e,t),n=this.getPivotInfoByToken(r),a=n.pageRange,o=n.contentRange,i=n.errorState,u=n.isEmpty,s=n.themeName;if(n.isHidden)return null;if(null!=a&&a.containCell(e,t)){if(i)return null;if(u)return LV.getEmptyPivotTableStyle(!0);var l=LV.getCellStyle(s,0),c=this.getCellInfo(e,t);return eV(this.sheet,c,l,r)}if(o){if(u)return LV.getEmptyPivotTableStyle(!1,e,t,o);if(i)return null;var h=this.getPivotTableByCell(e,t),f=this.getViewDataModelByToken(r);if(!f)return null;var d=f.getCellInfo(e-o.rowFrom(),t-o.colFrom(),(null==h?void 0:h._fieldsModel)||null),v=f.getCellStyleType(e-o.rowFrom(),t-o.colFrom());v||"none"===d.areaType||(v=d.styleType);var p=LV.getCellStyle(s,v);return eV(this.sheet,d,p,r)}return null}},{key:"getCellErrorInfo",value:function(e,t){var r,n=this.getCellInfo(e,t),a=null==n||null===(r=n.value)||void 0===r?void 0:r.errorCode;if(void 0!==a){var o=this.getPivotTableNameByCell(e,t),i=this.getViewDataModelByToken(o),u=n.value.errorInfoArgsId;return{errorCode:a,errorInfoArgs:null==i?void 0:i.getErrorInfoArgsFromId(u)}}}},{key:"getFieldValueInfo",value:function(e,t,r){var n=r.fieldName,a=r.value,o=r.isSubTotal,i=r.isTopSubTotal,u=r.buttonState,s=(o||i)&&!(u&&(128&u||64&u)),l=this.getFilterSort(e,t);return void 0===n||"object"!=(0,R.Z)(a)||void 0===a.text||void 0===a.type||s||l?null:{type:a.type,fieldName:n,value:a.text}}},{key:"isIntersectPivotTable",value:function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];if(!this.hasPivotTable())return!1;for(var o=e;o<e+r;o++)for(var i=t;i<t+n;i++){var u=this.getPivotTableNameByCell(o,i);if(u&&!a.includes(u))return!0}return!1}},{key:"isEmptyPivotTable",value:function(e){var t;return!(null===(t=this.getPivotInfoByToken(e))||void 0===t||!t.isEmpty)}},{key:"getPivotTableSize",value:function(){return this._sheetProxyPivotModel.getPivotTableSize()}},{key:"hasPivotTable",value:function(){return!!this.getPivotTableSize()}},{key:"setPivotTable",value:function(e,t){this._sheetProxyPivotModel.setPivotTable(e,t)}},{key:"setPivotTableInfo",value:function(e,t){this._sheetProxyPivotModel.setPivotTableInfo(e,t),this.setCellPivotCache(t.row,t.col,e)}},{key:"setPivotTablePreView",value:function(e,t){this._sheetProxyPivotModel.setPivotTablePreView(e,t)}},{key:"setViewDataModel",value:function(e,t){this._sheetProxyPivotModel.setViewDataModel(e,t)}},{key:"updatePivotTableInfo",value:function(e,t){var r=this.getPivotInfoByToken(e);if(r){var n=Object.assign(r,t);this.setPivotTableInfo(e,n)}}},{key:"updatePivotTableInfoByPosition",value:function(e,t,r){var n,a,o=this.getPivotInfoByToken(e);if(o&&(t!==o.row||r!==o.col)){var i=Object.assign({},o,{pageRange:null===(n=o.pageRange)||void 0===n?void 0:n.clone(),contentRange:null===(a=o.contentRange)||void 0===a?void 0:a.clone()}),u=i.pageRange,s=i.contentRange,l=i.spanRange,c=i.isEmpty,h=c?RT(this.sheet,t,r):RT(this.sheet,t,r,null==u?void 0:u.toJSON(),null==s?void 0:s.toJSON()),f=h.pageRange,d=h.contentRange,v=h.spanRange,p=Object.assign({},i,{row:t,col:r,pageRange:f,contentRange:d,spanRange:v});this.updatePivotTableInfo(e,p),this.updateCellPivotCache(e,i,p),c&&(l&&this.sheet.removeEmptyPivotTableSpan(l),v&&this.sheet.setEmptyPivotTableSpan(v))}}},{key:"deletePivotTableInfoByToken",value:function(e){this._sheetProxyPivotModel.deletePivotTableInfoByToken(e)}},{key:"deletePivotTablePreView",value:function(e){this._sheetProxyPivotModel.deletePivotTablePreView(e)}},{key:"deleteViewDataModel",value:function(e){this._sheetProxyPivotModel.deleteViewDataModel(e)}},{key:"deletePivotTableByToken",value:function(e){this._sheetProxyPivotModel.deletePivotTableByToken(e)}},{key:"composePivotStyle",value:function(e,t,r){var n=this.getCellStyle(t,r);return LV.composePivotStyle(e,n)}},{key:"dispose",value:function(){this._sheetProxyPivotModel.dispose()}}]),e}();Vu([(0,lt.f)(Lm)],GV.prototype,"sheet",void 0),Vu([(0,lt.f)(BV)],GV.prototype,"_sheetProxyPivotModel",void 0),GV=Vu([(0,st.b)()],GV),function(e){e.REFETCH_META="REFETCH_META",e.TOO_OLD="TOO_OLD",e.NORMAL="NORMAL"}(FV||(FV={})),function(e){e.WAITING_REFETCH="WAITING_REFETCH",e.SNAPSHOT_TOO_OLD="SNAPSHOT_TOO_OLD",e.VERSION_INVALID="VERSION_OUTDATED",e.RETRY_FETCH_META="RETRY_FETCH_META"}(ZV||(ZV={}));var jV=function(){function e(t,r,n,a){(0,y.Z)(this,e),this.spread=a,this._versionData={version:-1,configMd5:"",status:"NORMAL",respCache:null},this._configMd5Calculator=function(){return""},this._token=t,this._request=r,this._configMd5Calculator=n}var t,r,n,a,o,s,l;return(0,_.Z)(e,[{key:"bindSyncModel",value:function(e){this._syncModel=e}},{key:"markNotWaitingRefetchMeta",value:function(){this._versionData.status="NORMAL"}},{key:"setVersion",value:function(e,t){return this._versionData.version===e?(this.log("setVersion","Version unchanged: ".concat(e)),this):(this._versionData={version:e,configMd5:this._configMd5Calculator(t),status:"NORMAL",respCache:null},this)}},{key:"updateVersion",value:function(){var e;return this._syncModel?(this.setVersion(null!==(e=this._syncModel.syncVersion)&&void 0!==e?e:-1,this._syncModel.getSnapshot()||{}),this):(console.error("[PIVOT] no syncModel bind to requester, cannot auto update version"),this)}},{key:"_retryRequest",value:(l=(0,u.Z)(i().mark((function e(t){var r,n,a,o,u,s=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=s.length>1&&void 0!==s[1]?s[1]:3,n=null,a=Date.now(),o=0;case 4:if(!(o<r)){e.next=20;break}return e.prev=5,e.next=8,this._request(t);case 8:if(!(u=e.sent).data||0!==u.code){e.next=11;break}return e.abrupt("return",(this.log("request","Success after ".concat(o+1," attempts, took ").concat(Date.now()-a,"ms")),u.data));case 11:n=new Error("Request failed with code ".concat(u.code)),this.error("request","".concat(t.url," Attempt ").concat(o+1,"/").concat(r," failed:"),n),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(5),n=e.t0,this.error("request","".concat(t.url," Attempt ").concat(o+1,"/").concat(r," network error:"),e.t0);case 17:o+=1,e.next=4;break;case 20:throw this.error("request","All ".concat(r," attempts failed for ").concat(t.url),n),n||new Error("Request failed after ".concat(r," attempts: ").concat(t.url));case 21:case"end":return e.stop()}}),e,this,[[5,14]])}))),function(e){return l.apply(this,arguments)})},{key:"_askRefreshMeta",value:(s=(0,u.Z)(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._retryRequest({url:"api/v2/sheet/blocks/pivot_table/rebuild",method:"POST",data:{token:this._token,buildCache:!0,buildCube:!0,buildView:!0}}));case 1:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"_getVersion",value:function(){return this._versionData.version}},{key:"_assertIsLatestVersion",value:function(e){if(this._getVersion()!==e)throw"VERSION_OUTDATED"}},{key:"_getCache",value:function(){return this._versionData.respCache}},{key:"_setCacheItem",value:function(e,t){var r=this._getCache();r&&(r[e]=t)}},{key:"triggerServiceCalcStatus",value:function(e){this.spread.dispatch("PivotServiceCalcStatusChanged",{pivotTableToken:this._token,status:e})}},{key:"_fetchViewMeta",value:(o=(0,u.Z)(i().mark((function e(){var t,r,n,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("REFETCH_META"!==this._versionData.status){e.next=2;break}throw this.log("fetchViewMeta","Waiting for meta refetch"),"WAITING_REFETCH";case 2:if("TOO_OLD"!==this._versionData.status){e.next=4;break}throw"SNAPSHOT_TOO_OLD";case 4:if(!(t=this._getCache())){e.next=7;break}return e.abrupt("return",t.meta);case 7:return r=this._getVersion(),e.next=10,this._retryRequest({url:"/api/v2/sheet/blocks/pivot_table/view_meta",params:{token:this._token},method:"GET"});case 10:if(n=e.sent,this._assertIsLatestVersion(r),n.isLatest){e.next=13;break}throw this._versionData.status="REFETCH_META",this.triggerServiceCalcStatus("Loading"),"WAITING_REFETCH";case 13:if(a=n.viewMeta,!((o="string"==typeof a?JSON.parse(a):a).blockRev>r)){e.next=16;break}throw this._versionData.status="TOO_OLD",this.error("fetchViewMeta","Snapshot version too old. viewMeta: ".concat(o.blockRev,", snapshot: ").concat(r)),"SNAPSHOT_TOO_OLD";case 16:if(!(o.blockRev<r)){e.next=18;break}throw this._askRefreshMeta(),this._versionData.status="REFETCH_META",this.triggerServiceCalcStatus("Loading"),"WAITING_REFETCH";case 18:return e.abrupt("return",(this._versionData.status="NORMAL",this._versionData.respCache={meta:o},o));case 19:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"_getViewMeta",value:(a=(0,u.Z)(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(t=this._getCache())||!t.meta){e.next=3;break}return e.abrupt("return",t.meta);case 3:return e.next=5,this._fetchViewMeta();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"_extractDataFromSliceParts",value:function(e,t){var r={};e.forEach((function(e){var t=e.key,n=e.value;r[t]=n}));var n=t.map((function(e){return r[e]})).filter((function(e){return"string"==typeof e}));if(n.length!==t.length)throw this._versionData.respCache=null,this._versionData.status="NORMAL","RETRY_FETCH_META";return n.length>0?(0,Ce.xEi)(n):null}},{key:"fetchView",value:(n=(0,u.Z)(i().mark((function e(){var t,r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<3)){e.next=17;break}return e.prev=2,e.next=5,this._getViewMeta();case 5:return r=e.sent,e.abrupt("return",this.fetchViewDataFromViewMeta(r));case 9:if(e.prev=9,e.t0=e.catch(2),"RETRY_FETCH_META"===e.t0){e.next=13;break}throw console.error("[PIVOT] fetchView failed",e.t0),e.t0;case 13:this.triggerServiceCalcStatus("Loading"),console.log("[PIVOT] viewMeta fetch failed.");case 14:t+=1,e.next=1;break;case 17:case"end":return e.stop()}}),e,this,[[2,9]])}))),function(){return n.apply(this,arguments)})},{key:"handleMessageFromServer",value:(r=(0,u.Z)(i().mark((function e(t){var r,n,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=JSON.parse(t),n={blockRev:r.block_rev,dataSourceRev:r.data_source_rev,viewSlices:r.view_slice_keys},e.prev=1,e.next=4,this.fetchViewDataFromViewMeta(n);case 4:return a=e.sent,e.abrupt("return",(this._setCacheItem("view",a),this.triggerServiceCalcStatus("Loaded"),a));case 8:if(e.prev=8,e.t0=e.catch(1),"RETRY_FETCH_META"===e.t0){e.next=12;break}throw this.error("handleMessage","Failed to handle server message",e.t0),e.t0;case 12:return e.abrupt("return",(this.log("handleMessage","Invalid message from server, retrying fetch meta"),void this.triggerServiceCalcStatus("Loading")));case 13:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(e){return r.apply(this,arguments)})},{key:"fetchViewDataFromViewMeta",value:(t=(0,u.Z)(i().mark((function e(t){var r,n,a,o,u,s,l,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(r=this._getCache())||!r.view){e.next=3;break}return e.abrupt("return",(this.triggerServiceCalcStatus("Loaded"),r.view));case 3:if(this.triggerServiceCalcStatus("Loading"),n=this._getVersion(),(a=t.viewSlices||[]).length){e.next=7;break}throw Error("[PIVOT] view slices length is 0");case 7:e.prev=7,o=[],u=0;case 10:if(!(u<a.length)){e.next=19;break}return s=a[u],e.next=14,this._retryRequest({url:"/api/v2/sheet/blocks/pivot_table/view_slices/",params:{token:this._token,sliceKeys:[s]},method:"GET"});case 14:l=e.sent.slices,(0,Ce.hTd)(o,l);case 16:u++,e.next=10;break;case 19:return this._assertIsLatestVersion(n),c=this._extractDataFromSliceParts(o,a),e.abrupt("return",(console.log("[PIVOT] viewData",c),this._setCacheItem("view",c),this.triggerServiceCalcStatus("Loaded"),c));case 24:if(e.prev=24,e.t0=e.catch(7),"RETRY_FETCH_META"===e.t0){e.next=28;break}throw console.error("[PIVOT] fetchViewDataFromViewMeta failed",e.t0),e.t0;case 28:console.error("[PIVOT] viewData is invalid, retry fetch meta.");case 29:case"end":return e.stop()}}),e,this,[[7,24]])}))),function(e){return t.apply(this,arguments)})},{key:"logPrefix",value:function(e){return"[PIVOT][".concat(this._token,"] ").concat(e,":")}},{key:"log",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];(t=console).log.apply(t,[this.logPrefix(e)].concat(n))}},{key:"error",value:function(e){for(var t,r=arguments.length,n=new Array(r>1?r-1:0),a=1;a<r;a++)n[a-1]=arguments[a];(t=console).error.apply(t,[this.logPrefix(e)].concat(n))}}]),e}(),YV={source:Zt.lU.SHEET,parent:Zt.lU.SHEET,cross:!1},qV=function(){function e(){(0,y.Z)(this,e),this.$watcher=new Ce.CPL}return(0,_.Z)(e,[{key:"subscribe",value:function(e,t){return this.$watcher.subscribe(e,t)}},{key:"dispatch",value:function(e,t){this.$watcher.dispatch(e,t)}},{key:"dispose",value:function(){this.$watcher.destroy()}}]),e}(),JV=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).subscribers=new Map,e.syncModels=new Map,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"toJSON",value:function(){var e,t={},r=yr(this.syncModels);try{for(r.s();!(e=r.n()).done;){var n=(0,g.Z)(e.value,2),a=n[0],o=n[1];t[a]=o.toJSON()}}catch(e){r.e(e)}finally{r.f()}return t}},{key:"createSyncModel",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=this._spread,a={token:e,type:Zt.kH.PIVOT_TABLE,specificVersion:r,circulationInfo:YV},o=null===(t=n.sheetBlocksManager)||void 0===t?void 0:t.modelManager.createBlockModel(a);return o&&this.setSyncModel(e,o),o}},{key:"subscribePivotSyncPropagation",value:function(e,t){var r=this,n=[t.onSnapshotSet((function(t){r.dispatch("SnapshotSet",{blockToken:e,data:t})})),t.onOpsReceive((function(t){r.dispatch("OpsReceive",{blockToken:e,data:t})})),t.onSnapshotChange((function(t){r.dispatch("SnapshotChanged",{blockToken:e,data:t})})),t.onUndoRedoStatusChange((function(t){r.dispatch("UndoRedoStatusChange",{blockToken:e,data:t})})),t.onError((function(t){r.dispatch("SyncError",{blockToken:e,data:t})})),t.onInited((function(t){r.dispatch("Initialized",{blockToken:e,data:t})}))];this.subscribers.set(e,n)}},{key:"setSyncModel",value:function(e,t){this.syncModels.set(e,t),this.subscribePivotSyncPropagation(e,t)}},{key:"getSyncModel",value:function(e){return this.syncModels.get(e)}},{key:"deleteSyncModel",value:function(e){var t;this.clearSyncSubscribe(e),null!==(t=this.syncModels.get(e))&&void 0!==t&&t.manualDestroy(),this.syncModels.delete(e)}},{key:"opsApply",value:function(e,t){var r=this.syncModels.get(e);if(!r)return console.log("[PIVOT SYNC] syncModel is not created by token: ",e),[];var n=t.ops,a=t.rebuildInfo,o=t.applyOptions;return r.opsApply(n,a,o)}},{key:"getSnapshot",value:function(e){var t;return null===(t=this.syncModels.get(e))||void 0===t?void 0:t.getSnapshot()}},{key:"getVersion",value:function(e){var t;return null===(t=this.syncModels.get(e))||void 0===t?void 0:t.getVersion()}},{key:"reset",value:function(){var e=this;this.syncModels.forEach((function(t,r){e.deleteSyncModel(r)}))}},{key:"clearSyncSubscribe",value:function(e){var t=this.subscribers.get(e);null!=t&&t.forEach((function(e){e()})),this.subscribers.delete(e)}},{key:"dispose",value:function(){this.reset(),(0,f.Z)((0,v.Z)(t.prototype),"dispose",this).call(this)}}]),t}(qV=Vu([(0,st.b)()],qV));Vu([(0,lt.f)(uV)],JV.prototype,"_spread",void 0),JV=Vu([(0,st.b)()],JV);var KV=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).snapshotMap=new Map,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getSnapshot",value:function(e){return this.snapshotMap.get(e)}},{key:"setSnapshot",value:function(e,t){var r=t.snapshot;this.snapshotMap.set(e,r),this.dispatch("SnapshotChanged",{blockToken:e,data:t})}},{key:"deleteSyncModel",value:function(e){this.snapshotMap.delete(e)}},{key:"fromJSON",value:function(e){for(var t=0,r=Object.entries(e);t<r.length;t++){var n=(0,g.Z)(r[t],2),a=n[0],o=n[1];this.setSnapshot(a,{type:"snapshotSet",isPassive:!0,isCollab:!0,snapshot:o,prevSnapshot:null})}}},{key:"reset",value:function(){this.snapshotMap.clear()}},{key:"dispose",value:function(){this.reset(),(0,f.Z)((0,v.Z)(t.prototype),"dispose",this).call(this)}}]),t}(qV);KV=Vu([(0,st.b)()],KV);function XV(e){var t=new ht.W;return t.bind($m).toDynamicValue(e.getSheetDataModel),t.bind(Hm).toDynamicValue(e.getI18n),t.bind("worksheet/watcher").toDynamicValue(e.getWatch),t.bind(Bm).toDynamicValue(e.getFilterWatchHub),t.bind("workbook/calcEngine").toDynamicValue(e.getCalcEngine).inSingletonScope(),t.bind(Um).toDynamicValue((function(){return t.get.bind(t)})),t.bind(zm).toDynamicValue(e.getStageTracker),t.bind(Lm).toDynamicValue(e.getSheet),t.bind(zO).toSelf().inSingletonScope(),t.bind(UI).toSelf().inSingletonScope(),t.bind(HI).toSelf().inSingletonScope(),t.bind(jO).toSelf().inSingletonScope(),t.bind(gI).toSelf().inSingletonScope(),t.bind(Gm).toSelf().inSingletonScope(),t.bind(_I).toSelf().inSingletonScope(),t.bind(mI).toSelf().inSingletonScope(),t.bind(zI).toSelf().inSingletonScope(),t.bind(Wm).toDynamicValue(e.getMoirae),t.bind(jm).toSelf().inSingletonScope(),function(e){e.bind(WI).toSelf().inSingletonScope()}(t),function(e){e.bind(qI).toSelf().inSingletonScope()}(t),function(e){e.bind(DI).toSelf(),e.bind($I).toSelf().inSingletonScope(),e.bind(ZI).toSelf(),e.bind(FI).toSelf().inSingletonScope()}(t),function(e){e.bind(KI).toSelf(),e.bind(QI).toSelf().inSingletonScope()}(t),function(e){e.bind(Wu).toSelf().inSingletonScope()}(t),function(e){e.bind(JI).toSelf().inSingletonScope()}(t),ZN(t),function(e){e.bind(PO).to($O).inSingletonScope(),e.bind(FO).to(ZO).inTransientScope(),e.bind(dO).to(vO).inTransientScope(),e.bind(hO).to(fO).inSingletonScope(),e.bind(_O).to(RO).inTransientScope(),e.bind(wO).to(EO).inTransientScope(),e.bind(IO).to(OO).inTransientScope(),e.bind(SO).to(AO).inTransientScope(),e.bind(VO).to(NO).inSingletonScope(),e.bind(xO).to(DO).inTransientScope(),e.bind(bO).to(MO).inTransientScope(),e.bind(LO).to(BO).inSingletonScope(),e.bind(UO).to(HO).inSingletonScope()}(t),function(e){e.bind(BV).to(wV).inSingletonScope(),e.bind(UV).to(GV).inSingletonScope()}(t),t}var QV,eN=function(){function e(){(0,y.Z)(this,e),this.ready=!1,this.token="",this.permMap=new Map}return(0,_.Z)(e,[{key:"getPermMap",value:function(){return this.permMap}},{key:"setToken",value:function(e){this.token=e}},{key:"getToken",value:function(){return this.token}},{key:"setReady",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.ready=e}},{key:"hasEditPerm",value:function(e){var t,r=null===(t=this.permMap.get(e))||void 0===t?void 0:t.type;return void 0===r||4===r}},{key:"hasVisiblePerm",value:function(e){var t,r=null===(t=this.permMap.get(e))||void 0===t?void 0:t.type;return void 0===r||0!==r}},{key:"hasPerm",value:function(e){return this.permMap.has(e)}},{key:"getPermType",value:function(e){var t,r;return null!==(t=null===(r=this.permMap.get(e))||void 0===r?void 0:r.type)&&void 0!==t?t:4}},{key:"getHasInivisible",value:function(e){var t,r;return null!==(t=null===(r=this.permMap.get(e))||void 0===r?void 0:r.hasInvisible)&&void 0!==t&&t}},{key:"setPermType",value:function(e,t,r){if(!e||0===e.length)return 2;var n=this.permMap.get(e)||{type:t,hasInvisible:!1};return n.type=t,void 0!==r&&(n.hasInvisible=r),this.permMap.set(e,n),0}},{key:"removePerm",value:function(e){return e&&0!==e.length?!0!==this.permMap.has(e)?3:(this.permMap.delete(e),0):2}},{key:"reset",value:function(){this.permMap.clear(),this.ready=!1,this.token=""}},{key:"isReady",get:function(){return this.ready}}]),e}(),tN=new Map,rN="default",nN=function(e){var t="translate"===e||"history"===e?tN.get(rN):tN.get(e||rN);return t||(t=new eN,tN.set(e||rN,t)),t},aN=function(e){var t=tN.get(e||rN);t&&t.reset(),tN.delete(e||rN)},oN="";function iN(){return oN}var uN=function(e,t,r,n,a){return n&&function(e){oN=e,clearTimeout(QV),QV=setTimeout((function(){oN=""}),1e3)}(e),nN(a).setPermType(e,t,r)};function sN(e,t){return lN.apply(this,arguments)}function lN(){return lN=(0,u.Z)(i().mark((function e(t,r){var n,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=nN().getToken())||console.error("token is ".concat(n," fetch permission error")),!(t.length>0&&n)){e.next=12;break}return e.prev=2,e.next=5,Ce.Ps3.serverApi.protectionRange.bufferBatchPermFilter(n,t);case 5:a=e.sent,t.forEach((function(e){uN(e,a.includes(e)?4:1,!1)})),r&&r(),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),Ce.Ps3.Toast.show({type:"error",content:cr("sheet.protection.sync_permission_fail"),duration:3e3});case 12:case"end":return e.stop()}}),e,null,[[2,9]])}))),lN.apply(this,arguments)}function cN(e,t,r,n){return hN.apply(this,arguments)}function hN(){return hN=(0,u.Z)(i().mark((function e(t,r,n,a){var o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n||console.error("token is ".concat(n," fetch permission error")),!(t.length>0&&n)){e.next=13;break}return e.prev=1,e.next=4,Ce.Ps3.serverApi.protectionRangeV2.bufferBatchPermFilter(n,t);case 4:if(o=e.sent,nN(a).getToken()===n){e.next=7;break}return e.abrupt("return");case 7:t.forEach((function(e){var t,r=o.get(e.permId)||{},n=r.permissionType,i=r.extraInfo;uN(e.permId,null!==(t=n)&&void 0!==t?t:1,null==i?void 0:i.some((function(e){return 1===e})),void 0,a)})),r&&r(),e.next=13;break;case 10:throw e.prev=10,e.t0=e.catch(1),Ce.Ps3.Toast.show({type:"error",content:cr("sheet.protection.sync_permission_fail"),duration:3e3}),e.t0;case 13:case"end":return e.stop()}}),e,null,[[1,10]])}))),hN.apply(this,arguments)}var fN=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return At()("".concat(e,"-").concat(Date.now()))};function dN(e,t){return vN.apply(this,arguments)}function vN(){return vN=(0,u.Z)(i().mark((function e(t,r){var n,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce.Ps3.serverApi.protectionRange.queryPermUser(t,r);case 2:return n=e.sent,a=[],o=[],e.abrupt("return",(n&&n.owners&&(o=n.owners.map((function(e){return 4===e.owner_type||6===e.owner_type?Ce.Oc7:e.owner_id})),a=n.owners.filter((function(e){return e.permissions&Ce.Ps3.permission.FULL_ACCESS})).map((function(e){return e.owner_id}))),{memberIds:o,managerIds:a}));case 5:case"end":return e.stop()}}),e)}))),vN.apply(this,arguments)}function pN(e,t){return mN.apply(this,arguments)}function mN(){return mN=(0,u.Z)(i().mark((function e(t,r){var n,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ce.Ps3.serverApi.protectionRangeV2.queryPermUser(t,r);case 2:return n=e.sent,a=n.has_more,o=n.members,e.abrupt("return",{hasMore:a,members:o});case 6:case"end":return e.stop()}}),e)}))),mN.apply(this,arguments)}function gN(e,t){return yN.apply(this,arguments)}function yN(){return yN=(0,u.Z)(i().mark((function e(t,r){var n,a,o,u=arguments;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.length>2&&void 0!==u[2]?u[2]:[],a=u.length>3&&void 0!==u[3]?u[3]:[],o=u.length>4?u[4]:void 0,e.next=5,Ce.Ps3.serverApi.protectionRangeV2.replacePermUser(t,r,n,a,o);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)}))),yN.apply(this,arguments)}function _N(e,t,r){var n=(0,$.Z)(e,t);setTimeout(r,n)}function RN(e,t,r){var n=e.parent.permissionManager;return!(!n.userPerm.isReady||!n.hasSheetVisiblePermission(e.id()))}function CN(e){var t;return e.ranges.reduce((function(e,t){return e[t.type].push(Object.assign({},t)),e}),(t={},(0,l.Z)(t,Ce.xj7.NORMAL,[]),(0,l.Z)(t,Ce.xj7.ROW,[]),(0,l.Z)(t,Ce.xj7.COL,[]),t))}function wN(e){return e.type===Ce.xj7.ALL||e.type===Ce.xj7.COL?0:e.row}function EN(e,t){return e.type===Ce.xj7.ALL||e.type===Ce.xj7.COL?1/0:t+e.rowCount-1}function kN(e){return e.type===Ce.xj7.ALL||e.type===Ce.xj7.ROW?0:e.col}function TN(e,t){return e.type===Ce.xj7.ALL||e.type===Ce.xj7.ROW?1/0:t+e.colCount-1}function SN(e,t){return e.type===Ce.xj7.ALL||t.type===Ce.xj7.ALL}function AN(e,t){return function(e,t){if(SN(e,t))return!0;var r=wN(e),n=EN(e,r),a=wN(t);return r<=EN(t,a)&&n>=a}(e,t)&&function(e,t){if(SN(e,t))return!0;var r=kN(e),n=TN(e,r),a=kN(t);return r<=TN(t,a)&&n>=a}(e,t)}function IN(e,t){var r=127,n=wN(e),a=EN(e,n),o=wN(t),i=EN(t,o),u=kN(e),s=TN(e,u),l=kN(t),c=TN(t,l),h=n<=i&&a>=o,f=u<=c&&s>=l;return h||f?(h&&(r&=95,n<o&&(r&=111),a>i&&(r&=119)),f&&(r&=123,u<l&&(r&=125),s>c&&(r&=126)),h&&f&&(r&=63),r):r}function ON(e,t){return"add"===t.type?function(e,t){var r=t.dimension,n=t.startIndex,a=t.count,o=t.dimCountKey;return e[r]>=n?e[r]+=a:e[o]+=a,e}(e,t):function(e,t){var r=t.dimension,n=t.startIndex,a=t.count,o=t.dimCountKey;if(e[r]>=n){var i=n+a,u=e[r]+e[o];if(i>=u)return null;i<=e[r]?e[r]-=a:(e[r]=n,e[o]=u-i)}else{var s=e[r]+e[o]-n,l=Math.min(s,a);e[o]-=l}return e}(e,t)}function VN(e,t){var r=t.dimension,n=t.startIndex,a=t.dimCountKey;return!(e.type===Ce.xj7.ROW&&"col"===r||e.type===Ce.xj7.COL&&"row"===r)&&(e[r]>=n||e[r]+e[a]>n)}var NN="worksheet/protection-model",bN={curRangeEditable:!0,curRowEditable:!0,curColEditable:!0},MN=function(){function e(t){var r=this;(0,y.Z)(this,e),this.sheet=t,this.protectionMap=new Map,this.sheetWatcherSubscriber=null,this._curRowColRangeProtectionPermission$=new ft.X(bN),this.curRowColRangeProtectionPermission$=this._curRowColRangeProtectionPermission$.asObservable(),this.sheetWatcherSubscriber=t.subscribe("SelectionChanged",(function(){r.refreshPermission()}))}return(0,_.Z)(e,[{key:"setProtection",value:function(e,t){var r=this.getProtectionById(e),n=t.creatorId;r&&(n=r.creatorId),t.creatorId=n;var a=this.setProtectionImpl(e,t);return a&&this.syncPermissionAndHandleProtectionChange(e),a}},{key:"delProtection",value:function(e){var t=this.delProtectionImpl(e);return t&&this.handleProtectionChange(),t}},{key:"getProtectionById",value:function(e){return this.protectionMap.get(e)}},{key:"getProtectionsByRange",value:function(e,t){var r,n=[],a=t?function(e,t){var r=nN(e.options.situation);return"allowed"===t?function(e){return r.hasEditPerm(e)}:function(e){return!r.hasEditPerm(e)}}(this.sheet.parent,t):void 0,o=!e,i=e?gu(e):null,u=yr(this.protectionMap.values());try{for(u.s();!(r=u.n()).done;){var s=r.value;a&&!a(s.id)||(o||0!==s.ranges.length&&(!i||i&&s.ranges.some((function(e){return AN(i,e)}))))&&n.push(s)}}catch(e){u.e(e)}finally{u.f()}return n}},{key:"getProtectionRangesByRange",value:function(e,t){var r=this.sheet,n=this.getProtectionsByRange(e,t);if(0===n.length)return[];var a=e?gu(e):null;return n.reduce((function(e,t){return t.ranges.forEach((function(t){return(a&&AN(t,a)||!a)&&e.push(ou.fromJSON(t,t.type,r)),e})),e}),[])}},{key:"getAllProtections",value:function(){return this.allProtectionListCache||(this.allProtectionListCache=Array.from(this.protectionMap.values())),this.allProtectionListCache}},{key:"getProtectionsCount",value:function(){return this.protectionMap.size}},{key:"getRangePermissions",value:function(e){if(!this._userPerm.isReady)return{hasPermission:!0,rowPermission:!0,colPermission:!0};var t=this.getRangesPermissionDetail(e);return{hasPermission:t[0],rowPermission:t[1],colPermission:t[4]}}},{key:"refreshPermission",value:function(e){if(this._userPerm.isReady){var t=this.sheet,r=t.getSelections(),n=this.getRangePermissions(r);!e&&(0,me.default)(n,this.prevRangePermissions)||(t.dispatch("PermissionChanged",{permissions:n}),this.prevRangePermissions=n);var a={curRangeEditable:n.hasPermission,curRowEditable:n.rowPermission,curColEditable:n.colPermission};!e&&(0,me.default)(this.curRowColRangeProtectionPermission,a)||this._curRowColRangeProtectionPermission$.next(a)}}},{key:"adjustProtectionRange",value:function(e,t,r,n){if(this.protectionMap.size){var a,o={dimension:e,type:t,startIndex:r,count:n,dimCountKey:"row"===e?"rowCount":"colCount"},i=yr(this.protectionMap.values());try{for(i.s();!(a=i.n()).done;){for(var u=a.value,s=[],l=0,c=u.ranges.length;l<c;l++){var h=u.ranges[l];if(VN(h,o)){var f=ON(h,o);f&&s.push(f)}else s.push(h)}0===s.length?this.delProtectionImpl(u.id):u.ranges=s}}catch(e){i.e(e)}finally{i.f()}this.handleProtectionChange()}}},{key:"getRangesPermissionDetail",value:function(e){return function(e,t){for(var r=[],n=t-1;n>=0;n--)r.push(!!(e>>n&1));return r}(this.getRangesPermissionStatus(e),7)}},{key:"destroy",value:function(){var e;this._curRowColRangeProtectionPermission$.complete(),this.prevRangePermissions=void 0,this.clearAllProtectionsCache(),this.protectionMap.clear(),null!==(e=this.sheetWatcherSubscriber)&&void 0!==e&&e.unsubscribe(),this.sheetWatcherSubscriber=null}},{key:"setProtectionImpl",value:function(e,t){return this.delProtectionImpl(e),this.protectionMap.set(e,Object.assign({},t,{id:e})),!0}},{key:"delProtectionImpl",value:function(e){return!!this.protectionMap.get(e)&&(this.protectionMap.delete(e),!0)}},{key:"clearAllProtectionsCache",value:function(){this.allProtectionListCache=void 0}},{key:"onProtectionMapDirty",value:function(){this.clearAllProtectionsCache()}},{key:"syncPermissionAndHandleProtectionChange",value:function(e){var t=this,r=this._userPerm;r.isReady&&!r.hasPerm(e)?_N(10,500,(function(){sN([e],(function(){return t.handleProtectionChange()}))})):this.handleProtectionChange()}},{key:"handleProtectionChange",value:function(){this.onProtectionMapDirty(),this.prevRangePermissions=void 0,this.refreshPermission(),this.sheet.dispatch("ProtectedRangeChanged")}},{key:"getRangesPermissionStatus",value:function(e){var t=127,r=this._userPerm;if(!e.length)return t;if(!r.isReady)return t;var n,a=[],o=yr(this.protectionMap.values());try{for(o.s();!(n=o.n()).done;){var i=n.value;if(0===t)break;if(!r.hasEditPerm(i.id))for(var u=0,s=i.ranges.length;u<s&&0!==t;u++)for(var l=i.ranges[u],c=0,h=e.length;c<h;c++){var f=e[c],d=void 0;if(a[c]?d=a[c]:(d=gu(f),a[c]=d),0===t)break;t&=IN(l,d)}}}catch(e){o.e(e)}finally{o.f()}return t}},{key:"getTargetRangeTypeProtection",value:function(e,t){var r=this.getProtectionById(e);return r?r.ranges.length>1||!function(e,t){return e.ranges.some((function(e){return e.type===t}))}(r,t)?null:r:null}},{key:"_userPerm",get:function(){return nN(this.sheet.parent.options.situation)}},{key:"curRowColRangeProtectionPermission",get:function(){return this._curRowColRangeProtectionPermission$.getValue()}}]),e}();MN=Vu([(0,st.b)(),Nu(0,(0,lt.f)(Lm))],MN);var FN,ZN=function(e){e.bind(NN).to(MN).inSingletonScope()};!function(e){e[e.Add=0]="Add",e[e.Set=1]="Set",e[e.Del=2]="Del",e[e.Refresh=3]="Refresh"}(FN||(FN={}));var xN,DN,PN,$N=function(){function e(t){var r=this;(0,y.Z)(this,e),this._blocksMap=t,this.refreshBlockSet=new Set,this.oldFloatBlocks=new Map,this.raiseRefresh=BN((function(){var e=r.refreshBlockSet;e.size>0&&(e.forEach((function(e,t){var n=r._blocksMap[t];n&&r.raiseFloatBlockChange(t,3,n)})),r.clearRefresh())})),this.raiseChange=BN((function(){var e=r.oldFloatBlocks;return e.size>0&&(e.forEach((function(e,t){var n=r._blocksMap[t];n&&r.raiseFloatBlockChange(t,1,n)})),r.clearChange()),e}))}return(0,_.Z)(e,[{key:"markBlockChange",value:function(e){this.oldFloatBlocks.has(e)||(this.oldFloatBlocks.set(e,this._blocksMap[e]),this._blocksMap[e]=(0,Re.default)(this._blocksMap[e]))}},{key:"markBlockRefresh",value:function(e){return this.refreshBlockSet.add(e)}},{key:"hasMarkedRefresh",value:function(e){return this.refreshBlockSet.has(e)}},{key:"hasMarkedChange",value:function(e){return this.oldFloatBlocks.has(e)}},{key:"clearRefresh",value:function(){this.refreshBlockSet=new Set}},{key:"clearChange",value:function(){this.oldFloatBlocks=new Map}},{key:"registerFloatBlockChangeHandler",value:function(e){this.floatBlockChangeHandler=e}},{key:"unRegisterFloatBlockChangeHandler",value:function(){this.floatBlockChangeHandler=void 0}},{key:"raise",value:function(){this.raiseRefresh(),this.raiseChange()}},{key:"raiseFloatBlockChange",value:function(e,t,r){this.floatBlockChangeHandler&&this.floatBlockChangeHandler({blockToken:e,changeType:t,floatBlock:r})}}]),e}(),LN=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,y.Z)(this,e),this.sheet=t,this._blocksMap={},this._blocksMap=this._ensureSheetId(r),this.changeManager=new $N(r)}return(0,_.Z)(e,null,[{key:"createDefault",value:function(e,t,r,n){return{sheetId:e.id(),blockToken:t,blockType:r,blockSetting:Object.assign({},(0,G.Z)(n.floatBlockSetting,["row","col","x","y","width","height"]),{zIndex:e.floatBlocksModel&&e.floatBlocksModel.getFloatBlockNextZIndex()||1})}}},{key:"fromJSON",value:function(t,r){return new e(t,(0,Re.default)(r))}}]),(0,_.Z)(e,[{key:"_ensureSheetId",value:function(e){var t=this.sheet.id();return Object.values(e).forEach((function(e){return e.sheetId=t})),e}},{key:"getChangeManager",value:function(){return this.changeManager}},{key:"registerFloatBlockChangeHandler",value:function(e){this.changeManager.registerFloatBlockChangeHandler(e)}},{key:"addBlock",value:function(e,t){if(!e||e!==t.blockToken)throw new Error("Please make sure your blockToken correct");return this._blocksMap[e]?(console.error("blockToken  ".concat(e,"  FloatBlock ")),!1):(this._blocksMap[e]=(0,Re.default)(t),this.changeManager.raiseFloatBlockChange(e,0,t),!0)}},{key:"setBlock",value:function(e,t,r){if(!e||e!==t.blockToken)throw new Error("Please make sure your blockToken correct");return r||this._blocksMap[e]?(this._blocksMap[e]=(0,Re.default)(t),this.changeManager.raiseFloatBlockChange(e,1,t),!0):(console.error("blockToken  ".concat(e,"  floatBlock ")),!1)}},{key:"delBlock",value:function(e){if(!this._blocksMap[e])return console.error("blockToken  ".concat(e,"  floatBlock ")),!1;var t=this._blocksMap[e];return delete this._blocksMap[e],this.changeManager.raiseFloatBlockChange(e,2,t),!0}},{key:"getBlock",value:function(e){return this._blocksMap[e]}},{key:"getFloatBlocksMap",value:function(){return this._blocksMap}},{key:"getFloatBlockNextZIndex",value:function(){var e=1;return Object.values(this._blocksMap).forEach((function(t){var r=t.blockSetting;e=Math.max(e,r.zIndex)})),e+1}},{key:"fromJSON",value:function(e){this._blocksMap=(0,Re.default)(e)||{}}},{key:"toJSON",value:function(){return(0,Re.default)(this._blocksMap)}},{key:"serialize",value:function(e){var t=(0,l.Z)({},Zt.kH.CHART,Ce.B2l.FloatBlockType.FloatBlockType_CHART);return Object.values(e||this._blocksMap).filter((function(e){return Boolean(t[e.blockType])})).map((function(e){var r=e.blockSetting;return{id:e.blockToken,anchor:{cell:{startRow:r.row,startCol:r.col,endRow:r.row+1,endCol:r.col+1},cellOff:{x:r.x,y:r.y},size:{w:r.width,h:r.height},zIndex:r.zIndex},type:t[e.blockType]}}))}},{key:"addRows",value:function(e,t){this.adjustBlockPos4AddRows(e,t),this.changeManager.raise()}},{key:"addColumns",value:function(e,t){this.adjustBlockPos4AddCols(e,t),this.changeManager.raise()}},{key:"removeRows",value:function(e,t){this.adjustBlockPos4DelRows(e,t),this.changeManager.raise()}},{key:"removeColumns",value:function(e,t){this.adjustBlockPos4DelCols(e,t),this.changeManager.raise()}},{key:"adjustBlockPos4AddRows",value:function(e,t){var r=this;(0,L.Z)(this._blocksMap,(function(n,a){var o=n.blockSetting,i=r.getNewTarget4Add(e,t,o.row);i!==o.row&&(r.updateFloatBlockMap(a,"blockSetting.row",i),r.changeManager.markBlockRefresh(a))}))}},{key:"adjustBlockPos4AddCols",value:function(e,t){var r=this;(0,L.Z)(this._blocksMap,(function(n,a){var o=n.blockSetting,i=r.getNewTarget4Add(e,t,o.col);i!==o.col&&(r.updateFloatBlockMap(a,"blockSetting.col",i),r.changeManager.markBlockRefresh(a))}))}},{key:"adjustBlockPos4DelRows",value:function(e,t){var r=this;(0,L.Z)(this._blocksMap,(function(n,a){var o=n.blockSetting,i=r.getNewTarget4Del(e,t,o.row);e===o.row&&i===o.row&&(r.updateFloatBlockMap(a,"blockSetting.y",0),r.changeManager.markBlockRefresh(a)),i!==o.row&&(r.updateFloatBlockMap(a,"blockSetting.row",i),r.changeManager.markBlockRefresh(a));var u=r.sheet.getRowCount()-1;i>u&&r.updateFloatBlockMap(a,"blockSetting.row",u)}))}},{key:"adjustBlockPos4DelCols",value:function(e,t){var r=this;(0,L.Z)(this._blocksMap,(function(n,a){var o=n.blockSetting,i=r.getNewTarget4Del(e,t,o.col);e===o.col&&i===o.col&&(r.updateFloatBlockMap(a,"blockSetting.x",0),r.changeManager.markBlockRefresh(a)),i!==o.col&&(r.updateFloatBlockMap(a,"blockSetting.col",i),r.changeManager.markBlockRefresh(a));var u=r.sheet.getColumnCount()-1;i>u&&r.updateFloatBlockMap(a,"blockSetting.col",u)}))}},{key:"getNewTarget4Add",value:function(e,t,r){return r>=e?r+t:r}},{key:"getNewTarget4Del",value:function(e,t,r){var n=e+t-1;return r>=e&&r<=n?e>0?e:0:r>n?r-t:r}},{key:"updateFloatBlockMap",value:function(e,t,r){(0,Q.Z)(this._blocksMap[e],t,r)}},{key:"checkDelInfluence",value:function(e,t,r){var n=new Map;return(0,L.Z)(this._blocksMap,(function(r,a){r.blockSetting[e]>=t&&n.set(a,r)})),n}}]),e}();function BN(e){var t;return window.cancelAnimationFrame?function(){var r=this,n=arguments;t||window.requestAnimationFrame&&(t=requestAnimationFrame((function(){t=null,e.apply(r,n)})))}:function(){}}LN.defaultBlockRect=(xN=6,DN=18,(PN=window.screen?window.screen.height:1080)>=1080?(xN=6,DN=18):PN>=850?(xN=5,DN=15):(xN=4,DN=12),{width:105*xN,height:27*DN,x:0,y:0});var UN=0,HN=function(){return UN},zN=function(){return++UN};function WN(e){e&&HN()<e&&function(e){UN=e}(e)}function GN(e,t){return e.permissionManager.hasPermission(t)}var jN,YN=513,qN=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,y.Z)(this,e),this.sheet=t,this.floatImageMap=n,this._activeFloatImageIds=[],this._validFloatImageIds=new Set,this.saveValidFloatImage=function(){Object.keys(r.floatImageMap).forEach((function(e){var t=r.floatImageMap[e];t&&r.isValidFloatImage(t.floatImageSetting)&&r._validFloatImageIds.add(e)}))},this.updateFloatIndex=function(){(0,L.Z)(r.floatImageMap,(function(e){(0,ve.default)(e.floatImageSetting.zIndex)||(e.floatImageSetting.zIndex=0),WN(e.floatImageSetting.zIndex)}))},this.saveValidFloatImage(),this.updateFloatIndex()}return(0,_.Z)(e,[{key:"setActiveId",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._activeFloatImageIds;this._activeFloatImageIds=e,this.triggerFloatObjectChangedEvent(r),t&&this.raiseChange()}},{key:"appendActiveId",value:function(e){var t=this._activeFloatImageIds;this._activeFloatImageIds=[].concat((0,m.Z)(t),[e]),this.triggerFloatObjectChangedEvent(t)}},{key:"removeActiveId",value:function(e){if(this.activeFloatImageIds.length&&this.activeFloatImageIds.includes(e)){var t=this._activeFloatImageIds;this._activeFloatImageIds=this.activeFloatImageIds.filter((function(t){return t!==e})),this.triggerFloatObjectChangedEvent(t)}}},{key:"triggerFloatObjectChangedEvent",value:function(e){(0,me.default)(e,this._activeFloatImageIds)||this.sheet.dispatch("ActiveFloatObjectChanged",{prevActiveIds:e,currentActiveIds:this._activeFloatImageIds})}},{key:"activeFloatImageIds",get:function(){return this._activeFloatImageIds}},{key:"validFloatImageIds",get:function(){return this._validFloatImageIds}}]),(0,_.Z)(e,[{key:"fromJSON",value:function(e){this.floatImageMap=(0,Re.default)(e)||{},this.updateFloatIndex()}},{key:"toJSON",value:function(){return(0,Re.default)(this.floatImageMap)}},{key:"serialize",value:function(e){var t=[];return(0,L.Z)(this.floatImageMap,(function(r){var n=r.floatImageSetting,a=null!=e&&e.useNewFloatImage?(0,Ce.zsn)(10):r.floatImageId;t.push({id:a,token:n.imageToken,anchor:{cell:{startRow:n.row,startCol:n.col},cellOff:{x:n.x,y:n.y},size:{w:n.width,h:n.height},zIndex:n.zIndex}})})),t}},{key:"add",value:function(e,t){if(!e||e!==t.floatImageId)throw new Error("Please make sure your id correct");return this.floatImageMap[e]?(console.error("id  ".concat(e,"  float image ")),!1):(this.isValidFloatImage(t.floatImageSetting)&&this._validFloatImageIds.add(e),this.floatImageMap[e]=(0,Re.default)(t),t.floatImageSetting.zIndex||(t.floatImageSetting.zIndex=zN()),WN(t.floatImageSetting.zIndex),this.raiseChange(),!0)}},{key:"set",value:function(e,t,r){if(!e||e!==t.floatImageId)throw new Error("Please make sure your id correct");return r||this.floatImageMap[e]?(this.floatImageMap[e]||WN(t.floatImageSetting.zIndex),this.isValidFloatImage(t.floatImageSetting)&&this._validFloatImageIds.add(e),this.floatImageMap[e]=(0,Re.default)(t),this.raiseChange(),!0):(console.error("id  ".concat(e,"  float image ")),!1)}},{key:"del",value:function(e){return this.floatImageMap[e]?(delete this.floatImageMap[e],this._validFloatImageIds.delete(e),this.setActiveId([]),this.raiseChange(),!0):(console.error("id  ".concat(e,"  float image ")),!1)}},{key:"getFloatImageById",value:function(e){return this.floatImageMap[e]}},{key:"getFloatImageMap",value:function(){return this.floatImageMap}},{key:"setRowColInfoChange",value:function(e,t){this.raiseChange()}},{key:"addRows",value:function(e,t){this.rangeAdjust({index:e,count:t,indexKey:"row",type:"add"}),this.raiseChange()}},{key:"addColumns",value:function(e,t){this.rangeAdjust({index:e,count:t,indexKey:"col",type:"add"}),this.raiseChange()}},{key:"removeRows",value:function(e,t){this.rangeAdjust({index:e,count:t,indexKey:"row",type:"del"}),this.raiseChange()}},{key:"removeColumns",value:function(e,t){this.rangeAdjust({index:e,count:t,indexKey:"col",type:"del"}),this.raiseChange()}},{key:"addRowOrColForTarget",value:function(e,t,r){return r>=e?r+t:r}},{key:"delRowOrColForTarget",value:function(e,t,r){var n=e+t-1;return r>=e&&r<=n?e>0?e:0:r>n?r-t:r}},{key:"getTargetAdjustFn",value:function(e){if("add"===e)return this.addRowOrColForTarget;if("del"===e)return this.delRowOrColForTarget;throw new Error("error function type")}},{key:"rangeAdjust",value:function(e){var t=this,r=e.index,n=e.count,a=e.indexKey,o=e.type,i=this.getTargetAdjustFn(o);this.floatImageMap=(0,L.Z)(this.floatImageMap,(function(e,u){var s=e.floatImageSetting,l=i(r,n,s[a]);if([r,l].every((function(e){return e===s[a]}))&&"del"===o&&t.setChange(u,"floatImageSetting."+("row"===a?"y":"x"),0),l!==s[a]){var c=i(r,n,s[a]);t.setChange(u,"floatImageSetting.".concat(a),c)}t.checkDelete(a,l,u)}))}},{key:"checkDelete",value:function(e,t,r){var n=this.sheet.getRowCount()-1,a=this.sheet.getColumnCount()-1;"row"===e&&t>n?this.setChange(r,"floatImageSetting.".concat(e),n):"col"===e&&t>a&&this.setChange(r,"floatImageSetting.".concat(e),a)}},{key:"setChange",value:function(e,t,r){(0,Q.Z)(this.floatImageMap[e],t,r)}},{key:"checkDelInfluence",value:function(e,t,r){var n=new Map;return(0,L.Z)(this.floatImageMap,(function(r,a){r.floatImageSetting[e]>=t&&n.set(a,r)})),n}},{key:"raiseChange",value:function(){this.sheet.notifyShell(0)}},{key:"isValidFloatImage",value:function(e){var t=this.sheet.inject(It.tb).resolve("floatImageSideLimit",1),r=e.width,n=e.height;return r>0&&n>0&&(r>t||n>t)}}],[{key:"fromJSON",value:function(t,r){return new e(t,(0,Re.default)(r))}},{key:"createDefault",value:function(e){var t=e.sheet.id(),r=Object.assign({x:e.x||0,y:e.y||0},(0,G.Z)(e,["row","col","width","height","imageToken"]),{zIndex:zN()});return this.adjustDefaultRect(r),{floatImageId:(0,Ce.zsn)(10),sheetId:t,floatImageSetting:r}}},{key:"adjustDefaultRect",value:function(e){var t=YN<e.height,r=525<e.width,n=!t&&r||t&&r&&e.height<=e.width,a=t&&!r||t&&r&&e.height>e.width;return n&&(e.height=e.height*(525/e.width),e.height=e.height>YN?YN:e.height,e.width=525),a&&(e.width=e.width*(YN/e.height),e.height=YN),e}}]),e}();!function(e){e[e.Set=0]="Set",e[e.Del=1]="Del",e[e.None=2]="None"}(jN||(jN={}));var JN=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,y.Z)(this,e),this.sheet=t,this.ranges=new Map,this.waitRanges=new Map,this.rangeWatchers=new Map,this.toJSON=function(){return r.rangesToRangeMap()},this.delRangesBySheet=function(e){r.ranges.delete(e)},this.rangesToRangeMap=function(){var e={};return r.ranges.forEach((function(t,n){e[n]=r.dataRange2Data(t)})),e},this.rangeMapToRanges=function(e){var t=new Map;return Object.keys(e).forEach((function(n){var a=r.getSheetIdByRangeId(n);a!==r.sheetId&&console.error("[rangeMapToRanges] sheetId error");var o=Object.assign({sheetId:a,rangeId:n},e[n]);t.set(n,o)})),t},this.getSheetIdByRangeId=function(e){return e.split("_")[0]},this.setRange=function(e){if(r.getRangeSheetId(e)!==r.sheetId)return console.error("[setRange] sheetId error"),!1;var t=e.rangeId,n=!r.ranges.has(t);if(r.ranges.set(t,e),n){var a=r.waitRanges.get(t);a&&(r.waitRanges.delete(t),a[1]());var o=r.rangeWatchers.get(t);o&&(o.forEach((function(t){return t(e)})),r.rangeWatchers.delete(t))}return!0},this.delRange=function(e){return r.getRangeSheetId(e)!==r.sheetId?(console.error("[delRange] sheetId error"),!1):r.ranges.has(e)?(r.ranges.delete(e),!0):(console.error("[delRange] rangeId ".concat(e,"range")),!1)},this.getRangesFromId=function(e){for(var t=[],n=0;n<e.length;n++){var a=e[n],o=r.ranges.get(a);o?t.push(o):console.warn("[getRangesFromId] range with id=".concat(a," not exist"))}return t},this.getRangeFromId=function(e){return r.ranges.get(e)},this.waitRangesById=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4e3,a=[],o=yr(e);try{for(o.s();!(t=o.n()).done;){var i=t.value;if(!r.ranges.has(i)){r.waitRanges.get(i)||r.waitRanges.set(i,Jk());var u=r.waitRanges.get(i),s=(0,g.Z)(u,1),l=s[0];a.push(l)}}}catch(e){o.e(e)}finally{o.f()}if(a.length){var c,h=Jk(),f=(0,g.Z)(h,2),d=f[0],v=f[1];return Promise.all(a).then((function(){v(),clearTimeout(c)})),c=window.setTimeout((function(){var t,n=yr(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;r.waitRanges.has(a)&&r.waitRanges.delete(a)}}catch(e){n.e(e)}finally{n.f()}v("timeout")}),n),d}return Promise.resolve()},this.getRangeSheetId=function(e){return"string"==typeof e?e.split("_")[0]:e.rangeId.split("_")[0]},this.handleRangeAdd=function(e,t,r,n,a){var o=e[t],i=e[t]+e[r]-1,u=n-1;if(u>=o&&u<i)e[r]+=a;else{if(!(u<o))return 2;e[t]+=a}return 0},this.handleRangeDel=function(e,t,r,n,a){var o=e[t],i=e[t]+e[r]-1,u=n+a-1;if(u<o)e[t]-=a;else if(n<=o&&u>=o&&u<i)e[t]=n,e[r]-=u-o+1;else if(n>o&&n<i&&u<i)e[r]-=a;else{if(n<=o&&u>=i)return 1;if(!(n>o&&n<=i&&u>=i))return 2;e[r]=n-o}return 0},this._handleRowColUpdate=function(e,t,n,a,o){r.ranges.forEach((function(i,u){1===("add"===e?r.handleRangeAdd(i,t,n,a,o):r.handleRangeDel(i,t,n,a,o))&&r.ranges.delete(u)})),r.sheet.dispatch("SheetDataRangeAdjusted",{sheetId:r.sheet.id(),dataRangeMap:r.ranges})},this.checkDelInfluence=function(e,t,n){var a=[];return r.ranges.forEach((function(r){var n,o=t;if("row"===e){if(r.type===Ce.xj7.ALL||r.type===Ce.xj7.COL)return;n=r.row+r.rowCount-1}else{if(r.type===Ce.xj7.ALL||r.type===Ce.xj7.ROW)return;n=r.col+r.colCount-1}if(o<=n){var i=(0,Re.default)(r);a.push(i)}})),a},this.addRows=function(e,t){r._handleRowColUpdate("add","row","rowCount",e,t)},this.delRows=function(e,t){r._handleRowColUpdate("del","row","rowCount",e,t)},this.addCols=function(e,t){r._handleRowColUpdate("add","col","colCount",e,t)},this.delCols=function(e,t){r._handleRowColUpdate("del","col","colCount",e,t)},this.sheetId=t.id(),this.ranges=this.rangeMapToRanges(n)}return(0,_.Z)(e,[{key:"dataRange2Data",value:function(e){var t=(0,Re.default)(e);return delete t.rangeId,delete t.sheetId,t}},{key:"forEach",value:function(e){this.ranges.forEach(e)}},{key:"watchRangeExists",value:function(e,t){var r=this;if(this.ranges.has(e))return t(this.ranges.get(e)),function(){};var n=this.rangeWatchers.get(e)||[];return n.push(t),this.rangeWatchers.set(e,n),function(){return r.unwatchRangeExists(e,t)}}},{key:"unwatchRangeExists",value:function(e,t){var r=this.rangeWatchers.get(e);if(r){var n=r.filter((function(e){return e!==t}));n.length>0?this.rangeWatchers.set(e,n):this.rangeWatchers.delete(e)}}},{key:"getDataRangeFromData",value:function(e,t){var r,n=yr(this.ranges.values());try{for(n.s();!(r=n.n()).done;){var a=r.value;if((!t||a.usageType===t)&&a.type===e.type){if(a.type===Ce.xj7.ALL)return a;if(a.type===Ce.xj7.NORMAL&&e.type===Ce.xj7.NORMAL&&a.row===e.row&&a.col===e.col&&a.rowCount===e.rowCount&&a.colCount===e.colCount)return a;if(a.type===Ce.xj7.ROW&&e.type===Ce.xj7.ROW&&a.row===e.row&&a.rowCount===e.rowCount)return a;if(a.type===Ce.xj7.COL&&e.type===Ce.xj7.COL&&a.col===e.col&&a.colCount===e.colCount)return a;if(a.type===Ce.xj7.CELL&&e.type===Ce.xj7.CELL&&a.row===e.row&&a.col===e.col)return a}}}catch(e){n.e(e)}finally{n.f()}}}]),e}();function KN(e){return!!e&&String(e).startsWith('"')&&String(e).endsWith('"')}function XN(e){if(!e)return e;var t=e.length;return e.substring(1,t-1)}JN.fromJSON=function(e,t){return new JN(e,t)};var QN=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="cellIs",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getOp",value:function(){var e=this.getAttr().formula,t=(0,g.Z)(e,2),r=t[0],n=t[1];return[r=KN(r)?"S".concat(XN(r)):"D".concat(r),n=KN(n)?"S".concat(XN(n)):"D".concat(n)]}},{key:"getFormulaDataOrString",value:function(){var e,t=this.getAttr().operator,r=this.getOp(),n=(0,g.Z)(r,2),a=n[0],o=n[1],i={type:0,col:0,row:0,rowCount:1,colCount:1},u={};switch(t){case"equal":e=["R1",a,"OB=","R2","F:ISBLANK:1","F:NOT:1","F:PRIVATE_AND:2"],u.R1=i,u.R2=i;break;case"notEqual":e=["R1",a,"OB=","F:NOT:1","R2","F:ISBLANK:1","F:PRIVATE_OR:2"],u.R1=i,u.R2=i;break;case"greaterThan":case"greaterThanOrEqual":case"lessThan":case"lessThanOrEqual":e=["R1",a,"OB".concat({greaterThan:">",greaterThanOrEqual:">=",lessThanOrEqual:"<=",lessThan:"<"}[t]),"R2","F:ISNUMBER:1","F:NOT:1",a,"F:ISNUMBER:1","F:PRIVATE_AND:2","F:NOT:1","F:PRIVATE_AND:2"],u.R1=i,u.R2=i;break;case"between":e=["R1",a,"OB>=","R2",o,"OB<=","F:PRIVATE_AND:2","R3",o,"OB>=","R4",a,"OB<=","F:PRIVATE_AND:2","F:PRIVATE_OR:2","R5","F:ISBLANK:1","F:NOT:1","F:PRIVATE_AND:2"],u.R1=i,u.R2=i,u.R3=i,u.R4=i,u.R5=i;break;case"notBetween":e=["R1",a,"OB>=","R2",o,"OB<=","F:PRIVATE_AND:2","R3",o,"OB>=","R4",a,"OB<=","F:PRIVATE_AND:2","F:PRIVATE_OR:2","F:NOT:1"],u.R1=i,u.R2=i,u.R3=i,u.R4=i}return e.push("F:ARRAYFORMULA:1"),{v:1,flag:1,tokens:[],tree:e,refs:u}}},{key:"serialize",value:function(){var e=this.getAttr(),t=e.operator,r=e.plaintext,n=e.formula;return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_CELL_IS,cellIs:{operator:tb[t],plainText:null==r?void 0:r.slice(),formula:null==n?void 0:n.slice()}}}}]),t}(gS),eb=(Pe={},(0,l.Z)(Pe,Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_EQUAL,"equal"),(0,l.Z)(Pe,Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_NOT_EQUAL,"notEqual"),(0,l.Z)(Pe,Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_GREATER,"greaterThan"),(0,l.Z)(Pe,Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_GREATER_OR_EQUAL,"greaterThanOrEqual"),(0,l.Z)(Pe,Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_LESS,"lessThan"),(0,l.Z)(Pe,Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_LESS_OR_EQUAL,"lessThanOrEqual"),(0,l.Z)(Pe,Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_BETWEEN,"between"),(0,l.Z)(Pe,Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_NOT_BETWEEN,"notBetween"),Pe),tb={equal:Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_EQUAL,notEqual:Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_NOT_EQUAL,greaterThan:Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_GREATER,greaterThanOrEqual:Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_GREATER_OR_EQUAL,lessThan:Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_LESS,lessThanOrEqual:Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_LESS_OR_EQUAL,between:Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_BETWEEN,notBetween:Ce.B2l.CellIsRuleOperatorType.CellIsRuleOperatorType_NOT_BETWEEN},rb=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="duplicateValues",e.watchFormulaRefMap=!0,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getCalcRange",value:function(e){return this.getRanges()}},{key:"serialize",value:function(){return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_DUPLICATE_VALUES}}},{key:"getFormulaDataOrString",value:function(){for(var e=this.getRanges(),t=e.length,r=["R1"],n={R1:{type:0,col:0,row:0,rowCount:1,colCount:1}},a=0;a<t;a++){var o=e[a],i="R".concat(a+2);n[i]=gu(o),r.push(i)}return r.push("F:PRIVATE_CONDITION_DUPLICATE:".concat(t+1)),{v:1,refs:n,tree:r,tokens:[]}}},{key:"getCellRefIDs",value:function(){return["R1"]}}]),t}(gS),nb=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="containsText",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getFormulaDataOrString",value:function(){var e,t=this.getAttr(),r=t.operator,n=t.text,a="S".concat((0,Ce.dNX)(n));switch(r){case"beginsWith":e=["R1","F:PRIVATE_TO_TEXT_WITH_FMT:1",a,"F:LEN:1","F:LEFT:2",a,"OB="];break;case"endsWith":e=["R1","F:PRIVATE_TO_TEXT_WITH_FMT:1",a,"F:LEN:1","F:RIGHT:2",a,"OB="];break;case"is":e=["R1","F:PRIVATE_TO_TEXT_WITH_FMT:1",a,"F:PRIVATE_CONDITION_TEXT_EQ:2"];break;case"containsText":e=[a,"R1","F:PRIVATE_TO_TEXT_WITH_FMT:1","F:SEARCH:2","F:ISNUMBER:1"];break;case"notContains":e=[a,"R1","F:PRIVATE_TO_TEXT_WITH_FMT:1","F:SEARCH:2","F:ISNUMBER:1","F:NOT:1"]}return e.push("F:ARRAYFORMULA:1"),{v:1,flag:1,tokens:[],tree:e,refs:{R1:{type:0,col:0,row:0,rowCount:1,colCount:1}}}}},{key:"serialize",value:function(){var e=this.getAttr(),t=e.operator,r=e.text;return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_CONTAINS_TEXT,containText:{operator:ob[t],text:r}}}}]),t}(gS),ab=($e={},(0,l.Z)($e,Ce.B2l.ContainTextRuleOperatorType.ContainTextRuleOperatorType_BEGINS_WITH,"beginsWith"),(0,l.Z)($e,Ce.B2l.ContainTextRuleOperatorType.ContainTextRuleOperatorType_ENDS_WITH,"endsWith"),(0,l.Z)($e,Ce.B2l.ContainTextRuleOperatorType.ContainTextRuleOperatorType_CONTAINS,"containsText"),(0,l.Z)($e,Ce.B2l.ContainTextRuleOperatorType.ContainTextRuleOperatorType_DOES_NOT_CONTAIN,"notContains"),(0,l.Z)($e,Ce.B2l.ContainTextRuleOperatorType.ContainTextRuleOperatorType_IS,"is"),$e),ob={beginsWith:Ce.B2l.ContainTextRuleOperatorType.ContainTextRuleOperatorType_BEGINS_WITH,endsWith:Ce.B2l.ContainTextRuleOperatorType.ContainTextRuleOperatorType_ENDS_WITH,containsText:Ce.B2l.ContainTextRuleOperatorType.ContainTextRuleOperatorType_CONTAINS,notContains:Ce.B2l.ContainTextRuleOperatorType.ContainTextRuleOperatorType_DOES_NOT_CONTAIN,is:Ce.B2l.ContainTextRuleOperatorType.ContainTextRuleOperatorType_IS},ib=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="containsBlanks",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getFormulaDataOrString",value:function(){return{v:1,flag:1,tokens:[],tree:["R1","F:TRIM:1","F:LEN:1","D0","OB=","F:ARRAYFORMULA:1"],refs:{R1:{type:0,col:0,row:0,rowCount:1,colCount:1}}}}},{key:"serialize",value:function(){return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_CONTAINS_BLANKS}}}]),t}(gS),ub=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="notContainsBlanks",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getFormulaDataOrString",value:function(){return{v:1,tokens:[],flag:1,tree:["R1","F:TRIM:1","F:LEN:1","D0","OB>","F:ARRAYFORMULA:1"],refs:{R1:{type:0,col:0,row:0,rowCount:1,colCount:1}}}}},{key:"serialize",value:function(){return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_NOT_CONTAINS_BLANKS}}}]),t}(gS),sb=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="timePeriod",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getFormulaDataOrString",value:function(){var e,t={type:0,col:0,row:0,rowCount:1,colCount:1},r={R1:t};switch(this.getAttr().timePeriod){case"today":e=["R1","D1","F:FLOOR:2","F:TODAY:0","OB="];break;case"yesterday":e=["R1","D1","F:FLOOR:2","F:TODAY:0","D1","OB-","OB="];break;case"tomorrow":e=["R1","D1","F:FLOOR:2","F:TODAY:0","D1","OB+","OB="];break;case"last7Days":e=["F:TODAY:0","R1","D1","F:FLOOR:2","OB-","D6","OB<=","R2","D1","F:FLOOR:2","F:TODAY:0","OB<=","F:PRIVATE_AND:2"],r.R2=t;break;default:e=["B0"]}return e.push("F:ARRAYFORMULA:1"),{v:1,tokens:[],tree:e,flag:1,refs:r}}},{key:"serialize",value:function(){var e=this.getAttr(),t=e.operator,r=e.timePeriod;return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_TIME_PERIOD,timePeriod:{operator:cb[t],period:fb[r]}}}}]),t}(gS),lb=(Le={},(0,l.Z)(Le,Ce.B2l.TimePeriodRuleOperatorType.TimePeriodRuleOperatorType_BEFORE,"before"),(0,l.Z)(Le,Ce.B2l.TimePeriodRuleOperatorType.TimePeriodRuleOperatorType_IS,"is"),(0,l.Z)(Le,Ce.B2l.TimePeriodRuleOperatorType.TimePeriodRuleOperatorType_AFTER,"after"),Le),cb={before:Ce.B2l.TimePeriodRuleOperatorType.TimePeriodRuleOperatorType_BEFORE,is:Ce.B2l.TimePeriodRuleOperatorType.TimePeriodRuleOperatorType_IS,after:Ce.B2l.TimePeriodRuleOperatorType.TimePeriodRuleOperatorType_AFTER},hb=(Be={},(0,l.Z)(Be,Ce.B2l.TimePeriodType.TimePeriodType_TODAY,"today"),(0,l.Z)(Be,Ce.B2l.TimePeriodType.TimePeriodType_YESTERDAY,"yesterday"),(0,l.Z)(Be,Ce.B2l.TimePeriodType.TimePeriodType_TOMORROW,"tomorrow"),(0,l.Z)(Be,Ce.B2l.TimePeriodType.TimePeriodType_LAST_7_DAYS,"last7Days"),(0,l.Z)(Be,Ce.B2l.TimePeriodType.TimePeriodType_THIS_MONTH,"thisMonth"),(0,l.Z)(Be,Ce.B2l.TimePeriodType.TimePeriodType_LAST_MONTH,"lastMonth"),(0,l.Z)(Be,Ce.B2l.TimePeriodType.TimePeriodType_NEXT_MONTH,"nextMonth"),(0,l.Z)(Be,Ce.B2l.TimePeriodType.TimePeriodType_THIS_WEEK,"thisWeek"),(0,l.Z)(Be,Ce.B2l.TimePeriodType.TimePeriodType_LAST_WEEK,"lastWeek"),(0,l.Z)(Be,Ce.B2l.TimePeriodType.TimePeriodType_NEXT_WEEK,"nextWeek"),Be),fb={today:Ce.B2l.TimePeriodType.TimePeriodType_TODAY,yesterday:Ce.B2l.TimePeriodType.TimePeriodType_YESTERDAY,tomorrow:Ce.B2l.TimePeriodType.TimePeriodType_TOMORROW,last7Days:Ce.B2l.TimePeriodType.TimePeriodType_LAST_7_DAYS,thisMonth:Ce.B2l.TimePeriodType.TimePeriodType_THIS_MONTH,lastMonth:Ce.B2l.TimePeriodType.TimePeriodType_LAST_MONTH,nextMonth:Ce.B2l.TimePeriodType.TimePeriodType_NEXT_MONTH,thisWeek:Ce.B2l.TimePeriodType.TimePeriodType_THIS_WEEK,lastWeek:Ce.B2l.TimePeriodType.TimePeriodType_LAST_WEEK,nextWeek:Ce.B2l.TimePeriodType.TimePeriodType_NEXT_WEEK},db=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="uniqueValues",e.watchFormulaRefMap=!0,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getCalcRange",value:function(e){return this.getRanges()}},{key:"serialize",value:function(){return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_UNIQUE_VALUES}}},{key:"getFormulaDataOrString",value:function(){for(var e=this.getRanges(),t=e.length,r=["R1"],n={R1:{type:0,col:0,row:0,rowCount:1,colCount:1}},a=0;a<t;a++){var o=e[a],i="R".concat(a+2);n[i]=gu(o),r.push(i)}return r.push("F:PRIVATE_CONDITION_UNIQUE:".concat(t+1)),{v:1,refs:n,tree:r,tokens:[]}}},{key:"getCellRefIDs",value:function(){return["R1"]}}]),t}(gS);var vb=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="dataBar",e.watchFormulaRefMap=!0,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serialize",value:function(){return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_DATA_BAR,dataBar:this.attrs.map((function(e){return{gradient:e.gradient,value:""===e.value||null===e.value||void 0===e.value||isNaN(e.value)?void 0:Number(e.value),color:e.color?{rgb:e.color}:void 0,hideValue:e.hideValue,valueType:_S[e.valueType]}}))}}},{key:"getCalcRange",value:function(e){return this.attrs.every((function(e){return"num"===e.valueType}))?(0,f.Z)((0,v.Z)(t.prototype),"getCalcRange",this).call(this,e):this.getRanges()}},{key:"getFormulaDataOrString",value:function(){if(!this.attrs)return"";var e=this.attrs[0],t=this.attrs[1],r=e.valueType,n=t.valueType,a=e.value,o=t.value,i={},u=["D".concat(a||0),"S".concat(r),"D".concat(o||0),"S".concat(n),"R1"];i.R1={type:0,col:0,row:0,rowCount:1,colCount:1};for(var s=this.getRanges(),l=s.length,c=0;c<l;c++){var h="R".concat(c+2);i[h]=gu(s[c]),u.push(h)}return u.push("F:PRIVATE_CONDITION_DATA_BAR:".concat(5+l)),{v:1,tokens:[],tree:u,refs:i}}},{key:"getCellRefIDs",value:function(){return["R1"]}},{key:"isValueMatch",value:function(e){return function(e){return!!e&&(0,ve.default)(e.percent)&&(0,ve.default)(e.originPoint)}(e)}},{key:"isValid",value:function(e,t){return!!this.sheet.hasCheckbox(e,t)}},{key:"getFormatStyle",value:function(e,t){return this.isValid(e,t)?null:this.isMatch(e,t)?this.getDataBarStyleByAttr(this.getValue(e,t)):null}},{key:"getDataBarStyleByAttr",value:function(e){var t=this.attrs[0],r=this.attrs[1];return{percent:e.percent,originPoint:e.originPoint,color:e.percent<0?t.color:r.color,isGradient:t.gradient}}}]),t}(gS);var pb=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="colorScale",e.watchFormulaRefMap=!0,e.getColorScaleStyle=function(t){return jT(t.percent,t.level,e.colorLevel)},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serialize",value:function(){return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_COLOR_SCALE,colorScale:this.attrs.map((function(e){return{valueType:_S[e.valueType],value:""===e.value||null===e.value||void 0===e.value||isNaN(e.value)?void 0:Number(e.value),color:e.color?{rgb:e.color}:void 0}}))}}},{key:"getCalcRange",value:function(e){return this.getRanges()}},{key:"getCellRefIDs",value:function(){return["R1"]}},{key:"isValueMatch",value:function(e){return function(e){return!!e&&(0,ve.default)(e.percent)&&(0,ve.default)(e.level)}(e)}},{key:"getFormulaDataOrString",value:function(){var e=this.attrs||[],t=(0,g.Z)(e,2),r=t[0],n=t[1];if(!r||!n)return"";var a=this.getRanges(),o=a.length,i=this.attrs.length,u=[];this.attrs.forEach((function(e){u.push("D".concat(e.value||0),"S".concat(e.valueType))}));var s={};s.R1={type:0,col:0,row:0,rowCount:1,colCount:1};for(var l=["D".concat(i),"R1"].concat(u),c=0;c<a.length;c++){var h="R".concat(c+2);l.push(h),s[h]=gu(a[c])}return l.push("F:PRIVATE_CONDITION_COLOR_SCALE:".concat(2+u.length+o)),{v:1,tokens:[],tree:l,refs:s}}},{key:"getFormatStyle",value:function(e,t){if(!this.isMatch(e,t))return null;var r=this.getColorScaleStyle(this.getValue(e,t));return r?{backColor:r}:null}},{key:"colorLevel",get:function(){return this.attrs.map((function(e){return e.color}))}}]),t}(gS),mb=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="rank",e.watchFormulaRefMap=!0,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getCalcRange",value:function(e){return this.getRanges()}},{key:"getCellRefIDs",value:function(){return["R1"]}},{key:"getFormulaDataOrString",value:function(){var e=this.getAttr(),t=e.isBottom,r=void 0!==t&&t,n=e.valueType,a=e.value,o=void 0===a?0:a,i=this.getRanges(),u=["R1","S".concat(n),"D".concat(o),"B".concat(Number(r))],s={};s.R1={type:0,col:0,row:0,rowCount:1,colCount:1};for(var l=0;l<i.length;l++){var c="R".concat(l+2);s[c]=gu(i[l]),u.push(c)}return u.push("F:PRIVATE_CONDITION_RANK:".concat(u.length)),{v:1,tokens:[],tree:u,refs:s}}},{key:"serialize",value:function(){var e=this.getAttr(),t=e.isBottom,r=e.valueType,n=e.value;return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_RANK,rank:{isBottom:t,value:""===n||null==n||isNaN(n)?void 0:Number(n),valueType:yb[r]}}}}]),t}(gS),gb=(Ue={},(0,l.Z)(Ue,Ce.B2l.RankType.RankType_PERCENT,"percent"),(0,l.Z)(Ue,Ce.B2l.RankType.RankType_SORT,"sort"),Ue),yb={percent:Ce.B2l.RankType.RankType_PERCENT,sort:Ce.B2l.RankType.RankType_SORT},_b={greaterThan:Ce.B2l.AverageType.AverageType_GREATER,lessThan:Ce.B2l.AverageType.AverageType_LESS,greaterThanOrEqual:Ce.B2l.AverageType.AverageType_GREATER_OR_EQUAL,lessThanOrEqual:Ce.B2l.AverageType.AverageType_LESS_OR_EQUAL},Rb=(He={},(0,l.Z)(He,Ce.B2l.AverageType.AverageType_GREATER,"greaterThan"),(0,l.Z)(He,Ce.B2l.AverageType.AverageType_LESS,"lessThan"),(0,l.Z)(He,Ce.B2l.AverageType.AverageType_GREATER_OR_EQUAL,"greaterThanOrEqual"),(0,l.Z)(He,Ce.B2l.AverageType.AverageType_LESS_OR_EQUAL,"lessThanOrEqual"),He),Cb=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="aboveAverage",e.watchFormulaRefMap=!0,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serialize",value:function(){return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_AVERAGE,average:{operator:_b[this.getAttr().operator]}}}},{key:"getCalcRange",value:function(e){return this.getRanges()}},{key:"getFormulaDataOrString",value:function(){var e=this.getRanges(),t=e.length,r={},n=this.getAttr().operator,a=["R1","S".concat(n)];r.R1={type:0,col:0,row:0,rowCount:1,colCount:1};for(var o=0;o<t;o++){var i=e[o],u="R".concat(o+2);r[u]=gu(i),a.push(u)}return a.push("F:PRIVATE_CONDITION_AVERAGE:".concat(t+2)),{v:1,refs:r,tree:a,tokens:[]}}},{key:"getCellRefIDs",value:function(){return["R1"]}}]),t}(gS),wb=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).ruleType="expression",e.firstCell=null,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getRef",value:function(){return this.getFirstCell()||(0,f.Z)((0,v.Z)(t.prototype),"getRef",this).call(this)}},{key:"getNewFirstCell",value:function(){var e=this.getRanges()[0];return e?new ou(e.rowFrom(),e.colFrom()||0,1,1,this.sheet):null}},{key:"updateFirstCell",value:function(){this.firstCell=this.getNewFirstCell()}},{key:"serialize",value:function(){var e,t;return{ruleType:Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_EXPRESSION,customFormula:{formula:null===(e=this.getAttr())||void 0===e||null===(t=e.formula)||void 0===t?void 0:t.slice()}}}},{key:"getFirstCell",value:function(){return this.firstCell||this.updateFirstCell(),this.firstCell}},{key:"getCalcRange",value:function(e){return this.getRanges()}},{key:"getAdjustedFormulaStr",value:function(e){var t=(0,oe.default)(this.attrs,["0","formula","0"],""),r=this.getFirstCell(),n=this.getFormulaVar(),a=null==n?void 0:n.getRefMap();if(!r||!n||!a)return"";for(var o in e)e[o]=Tu(e[o],r);n.setRefMap(e);var i="="+this.sheet.getCalcEngine().decompile(n,{ref:r});return n.setRefMap(a),i===t?"":i}},{key:"adjustFormulaVarRefMap",value:function(){var e,t=this.getFirstCell();this.updateFirstCell();var r=this.getFirstCell();if(r&&t){var n=this.getFormulaVar();if(n){var a=n.getRefMap(),o={};for(var i in a){var u=ku(a[i],t);o[i]=u}var s=null===(e=this.getFormulaVar())||void 0===e?void 0:e.getRef();s&&(s.setRowFrom(r.rowFrom()),s.setColFrom(r.colFrom()));var l={};for(var c in o){var h=o[c];l[c]=Tu(h,r)}n.setRefMap(l)}}}},{key:"watch",value:function(e){var r=this;(0,f.Z)((0,v.Z)(t.prototype),"watchRanges",this).call(this,(function(t){e(t)}),(function(e,t){var n=r.getFirstCell();n&&(e.rowFrom()===n.rowFrom()&&e.colFrom()===n.colFrom()||r.adjustFormulaVarRefMap())}));var n=this.sheet.getCalcEngine(),a=this.getRefRanges();this.disposeFns.push(n.conditionDependencyRefManager.watchRefs(a,(function(t,n,a){if(a){var o=a.map((function(e){return Eu(e,e.hostId?r.sheet.parent.getSheetFromId(e.hostId):r.sheet)}));e(r.getOriginRangesFromRefRanges(o))}else e([])})))}},{key:"setCalcRange",value:function(e){var t=this.getFormulaVar();t&&t.setRef(e)}},{key:"getOriginRangesFromRefRanges",value:function(e){var t=this.getFirstCell();if(!e||!t)return this.getRanges();var r=new ou(-1,-1,1,1,this.sheet);return e.map((function(e){return r.setRowFrom(e.startRow),r.setRowCount(e.endRow-e.startRow),r.setColFrom(e.startCol),r.setColCount(e.endCol-e.startCol),ku(r,t)}))}},{key:"getRefRanges",value:function(){var e=this,t=this.getFormulaVar();if(!t)return[];var r=t.getRefMap();if(!r)return[];var n=this.getFirstCell();if(!n)return[];var a,o=this.getRanges(),i=[],u=yr(o);try{var s=function(){var t=a.value;Object.values(r).forEach((function(r){var a=ku(r,n),o=ku(r,new ou(t.rowTo(),t.colTo(),1,1,e.sheet));i.push(a.union(o))}))};for(u.s();!(a=u.n()).done;)s()}catch(e){u.e(e)}finally{u.f()}return i}},{key:"isValueMatch",value:function(e){return(0,ve.default)(e)?!!e:!!(0,se.Z)(e)&&e}},{key:"getFormulaDataOrString",value:function(){var e=this.getAttr();return(0,X.Z)((0,oe.default)(e,["formula","0"],"")||"","=")}},{key:"getFirstAbsoluteRefMap",value:function(){var e,t=this.getFirstCell(),r=null===(e=this.getFormulaVar())||void 0===e?void 0:e.getRefMap();if(r&&t){var n={};for(var a in r)n[a]=ku(r[a],t);return n}}},{key:"calc",value:function(e,r){var n;(0,f.Z)((0,v.Z)(t.prototype),"calc",this).call(this,e,r);var a=this.getFirstCell();a&&(null===(n=this.getFormulaVar())||void 0===n||n.setRef(a))}}]),t}(gS),Eb=function(){function e(t,r){(0,y.Z)(this,e),this.model=t,this.sheet=r,this.collectCFByCopy=[]}return(0,_.Z)(e,[{key:"saveActionForCopy",value:function(e){this.collectCFByCopy=e}},{key:"getActionForCopy",value:function(){return this.collectCFByCopy}},{key:"rules",get:function(){return this.model.getAllRules()}},{key:"customRules",get:function(){return this.rules.filter((function(e){return e instanceof wb}))}}]),(0,_.Z)(e,[{key:"getAdjustedRulesByMoveRowCol",value:function(e,t,r,n){var a,o,i,u=this,s=new Map;"row"===t?(a=r.rowFrom(),o=n.rowFrom(),i=r.rowCount()):"col"===t?(a=r.colFrom(),o=n.colFrom(),i=r.colCount()):(a=0,o=0,i=0);var l={type:t,source:o,target:o,count:i},c={type:t,index:a,count:i},h={fromRange:r.clone(),toRange:n.clone(),targetSheet:e},f=function(){l={type:t,source:o,target:o,count:i},c={type:t,index:a,count:i},h={fromRange:r.clone(),toRange:n.clone(),targetSheet:e}};return this.customRules.forEach((function(e){var t={attrs:null,newBaseRanges:null,setAttrs:function(e){this.attrs=[{formula:[e]}]},setNewBaseRanges:function(e){this.newBaseRanges=e}};f();var r=u.getAdjustedFormulaStrIfMoveRowCol(e,l,c,h);if(r.isAdjust&&""!==r.value){t.setAttrs(r.value),f();var n=u.getAdjustedBaseRangesIfMoveRowCol(e,l,c,h);n.isAdjust&&n.value.length&&t.setNewBaseRanges(n.value),s.set(e.cfId,t)}})),s}},{key:"getAdjustedRulesByMoveRange",value:function(e,t,r){var n=this,a=new Map,o={toRange:e,fromRange:t,targetSheet:r};return this.customRules.forEach((function(e){var t={attrs:null,newBaseRanges:null,setAttrs:function(e){this.attrs=[{formula:[e]}]},setNewBaseRanges:function(e){this.newBaseRanges=e}},r=n.getAdjustedFormulaStrIfMoveRange(e,o);if(r.isAdjust&&""!==r.value){t.setAttrs(r.value);var i=n.getAdjustedBaseRangesIfMoveRange(e,o);i.isAdjust&&0!==i.value.length&&t.setNewBaseRanges(i.value),a.set(e.cfId,t)}})),a}},{key:"getAdjustedRulesByDelSheet",value:function(e,t){var r=this,n=new Map,a=t.getSheetIds(),o=[];return a.forEach((function(r){if(r!==e){var n=t.getSheetFromId(r);n&&o.push(n)}})),o.forEach((function(t){t.conditionalFormatModel.getAllRules().filter((function(e){return e instanceof wb})).forEach((function(a){if("expression"===a.ruleType){var o={attrs:null,cfId:null,setAttrs:function(e){this.attrs=[{formula:[e]}]}},i=r.getAdjustedFormulaStrIfDelSheet(a,e);if(i.isAdjust&&""!==i.value){o.setAttrs(i.value),o.cfId=a.cfId;var u=n.get(t.id());u||(u=[],n.set(t.id(),u)),u.push(o)}}}))})),n}},{key:"getRulesByAddRowCol",value:function(e,t,r,n){var a=this,o=new Map,i={source:t,type:e,target:r,count:n};return"row"!==e&&"col"!==e||this.rules.forEach((function(e){var t=a.getAdjustedFormulaStrIfAddRowCol(e,i),r=e.cfId,n=void 0===r?"":r,u={attrs:null,ranges:null};if(t.isAdjust&&""!==t.value){var s=[];s.push({formula:[t.value]}),u.attrs=s}var l=a.getAdjustedBaseRangesIfAddRowCol(e,i);l.isAdjust&&l.value.length&&(u.ranges=new Ou(l.value,a.sheet,!0)),(t.isAdjust&&""!==t.value||l.isExpand&&l.value.length)&&o.set(n,u)})),o}},{key:"getRulesByDelRowCol",value:function(e,t,r){var n=this,a=new Map,o={index:t,count:r,type:e};return"row"!==e&&"col"!==e||this.rules.forEach((function(i){var u="row"===e?new iu(t,r,n.sheet):new nu(t,r,n.sheet),s={subRange:null,attrs:null,newBaseRanges:null,setAttrs:function(e){this.attrs=[{formula:[e]}]},setNewBaseRanges:function(e){this.newBaseRanges=e},setSubRange:function(e){this.subRange=e}};if(i.isIntersect(u)){var l=function(e,t){var r=[];return e.forEach((function(e){var n=e.sub(t);(0,Ce.hTd)(r,n)})),r}(i.getRanges(),u);if(s.setSubRange&&s.setSubRange(l),s.subRange&&0===s.subRange.length)a.set(i.cfId,s);else{var c=n.getAdjustedFormulaStrIfDelRowCol(i,o);if(c.isAdjust&&""!==c.value){s.setAttrs(c.value);var h=n.getAdjustedBaseRangesIfDel(i,o);return h.isAdjust&&s.setNewBaseRanges(h.value),void a.set(i.cfId,s)}a.set(i.cfId,s)}}else{var f=n.getAdjustedFormulaStrIfDelRowCol(i,o);if(f.isAdjust&&""!==f.value){s.setAttrs(f.value);var d=n.getAdjustedBaseRangesIfDel(i,o);d.isAdjust&&s.setNewBaseRanges(d.value),a.set(i.cfId,s)}}})),a}},{key:"expandBaseRangeIfAddRowCol",value:function(e,t,r,n,a){var o,i=t.type,u=t.count;e instanceof au||(e instanceof uu&&(e=new ou(e.rowFrom(),e.colFrom(),e.rowCount(),e.colCount(),e.sheet()),null!=n&&n.splice(a||0,1,e)),"row"!==i||e instanceof nu?"col"!==i||e instanceof iu||(o=e.colCount(),e.setColCount(o+u),r&&(r.isExpand=!0)):(o=e.rowCount(),e.setRowCount(o+u),r&&(r.isExpand=!0)))}},{key:"getAdjustedBaseRangesIfAddRowCol",value:function(e,t){var r={isAdjust:!1,isExpand:!1,value:[]},n=e.getRanges().map((function(e){return e.clone()}));return this.isAdjustBaseRangesIfAddRowCol(n,t,this.expandBaseRangeIfAddRowCol,r)&&(r.isAdjust=!0,r.value=n),r}},{key:"getAdjustedFormulaStrIfAddRowCol",value:function(e,t){var r={isAdjust:!1,value:""};if(!(e instanceof wb))return r;var n=t.target,a=t.source,o=Number(a)-Number(n)>=0,i=Number(a)-Number(n)>=0,u=e.getFirstCell();if("row"===t.type?t.source===(null==u?void 0:u.rowFrom())&&o:t.source===(null==u?void 0:u.colFrom())&&i)return r;var s=e.getFirstAbsoluteRefMap();return s?(r.isAdjust=this.isAdjustFirstCellRefMapIfAddRowCol(s,t),r.isAdjust&&(r.value=e.getAdjustedFormulaStr(s)),r):r}},{key:"getAdjustedBaseRangesIfDel",value:function(e,t){var r={isAdjust:!1,value:[]},n=e.getRanges().map((function(e){return e.clone()}));return r.isAdjust=this.isAdjustBaseRangesIfDelRowCol(n,t),r.value=n,r}},{key:"getAdjustedFormulaStrIfDelRowCol",value:function(e,t){var r={isAdjust:!1,value:""};if(!(e instanceof wb))return r;var n=e.getFirstAbsoluteRefMap();return n?(r.isAdjust=this.isAdjustFirstCellRefMapIfDelRowCol(n,t),r.isAdjust&&(r.value=e.getAdjustedFormulaStr(n)),r):r}},{key:"getAdjustedFormulaStrIfDelSheet",value:function(e,t){var r={isAdjust:!1,value:""};if("expression"!==e.ruleType)return r;var n=e.getFirstAbsoluteRefMap();return n?(Object.values(n).forEach((function(e){var n;(null===(n=e.sheet())||void 0===n?void 0:n.id())===t&&(function(e){e.setRowCount(0),e.setColCount(0)}(e),r.isAdjust=!0)})),r.isAdjust&&(r.value=e.getAdjustedFormulaStr(n)),r):r}},{key:"getAdjustedFormulaStrIfMoveRowCol",value:function(e,t,r,n){var a={isAdjust:!1,value:""},o=e.getFirstAbsoluteRefMap();if(!o)return a;var i=this.isAdjustFirstCellRefMapIfAddRowCol(o,t);i&&function(e,t,r){if("row"===r){var n=e.rowFrom()+t;e.setRowFrom(n)}else if("col"===r){var a=e.colFrom()+t;e.setColFrom(a)}}(n.fromRange,t.count,t.type);var u=this.isAdjustFirstCellRefMapIfMoveRange(o,n);return i&&function(e){r.index+=e}(t.count),i===this.isAdjustFirstCellRefMapIfDelRowCol(o,r)&&!u||(a.isAdjust=!0),a.isAdjust&&(a.value=e.getAdjustedFormulaStr(o)),a}},{key:"getAdjustedBaseRangesIfMoveRange",value:function(e,t){var r={isAdjust:!1,value:[]},n=e.getRanges().map((function(e){return e.clone()}));return r.isAdjust=this.isAdjustBaseRangesIfMoveRange(n,t),r.isAdjust&&(r.value=n),r}},{key:"isAdjustBaseRangesIfMoveRange",value:function(e,t){var r=!1,n=t.fromRange,a=t.toRange,o=t.targetSheet;return e.forEach((function(e){if(n.contain(e)){var t,i=function(e,t){var r={col:0,row:0},n=e.rowFrom(),a=e.colFrom(),o=t.rowFrom(),i=t.colFrom();return r.row=o-n,r.col=i-a,r}(n,e),u=a.rowFrom(),s=a.colFrom();(function(e,t,r){e.setRowFrom(t+r)})(e,u,i.row),function(e,t,r){e.setColFrom(t+r)}(e,s,i.col),o.id()!==(null===(t=e.sheet())||void 0===t?void 0:t.id())&&function(e){e.setColCount(0),e.setRowCount(0)}(e),r=!0}})),r}},{key:"getAdjustedBaseRangesIfMoveRowCol",value:function(e,t,r,n){var a={isAdjust:!1,value:[]},o=e.getRanges().map((function(e){return e.clone()})),i=this.isAdjustBaseRangesIfAddRowCol(o,t,(function(e,t){var r=t.count,n=t.type;if("row"===n){var a=e.rowFrom();e.setRowFrom(a+r)}else if("col"===n){var o=e.colFrom();e.setColFrom(o+r)}}));i&&function(e,t,r){if("row"===r){var n=e.rowFrom()+t;e.setRowFrom(n)}else if("col"===r){var a=e.colFrom()+t;e.setColFrom(a)}}(n.fromRange,t.count,t.type);var u=this.isAdjustBaseRangesIfMoveRange(o,n);return i&&function(e){r.index+=e}(t.count),i===this.isAdjustBaseRangesIfDelRowCol(o,r)&&!u||(a.isAdjust=!0),a.isAdjust&&(a.value=o),a}},{key:"baseRangeTool",value:function(e){return"row"===e?{adjustRowColFrom:function(e,t){e.setRowFrom(t)},adjustRowColCount:function(e,t){e.setRowCount(t)},rowColFrom:function(e){return e.rowFrom&&e.rowFrom()},rowColTo:function(e){return e.rowTo&&e.rowTo()},setRowColOfBaseRangeMissing:function(e){e.setRowCount(0)}}:{adjustRowColFrom:function(e,t){e.setColFrom(t)},adjustRowColCount:function(e,t){e.setColCount(t)},rowColFrom:function(e){return e.colFrom&&e.colFrom()},rowColTo:function(e){return e.colTo&&e.colTo()},setRowColOfBaseRangeMissing:function(e){e.setColCount(0)}}}},{key:"isAdjustBaseRangesIfDelRowCol",value:function(e,t){var r=this,n=!1,a=t.index,o=t.count,i=t.type,u=a+o-1;return e.forEach((function(e){var t=r.baseRangeTool(i).rowColFrom(e),s=r.baseRangeTool(i).rowColTo(e);if(u<t){var l=t-o;r.baseRangeTool(i).adjustRowColFrom(e,l),n=!0}else if(a<t&&u>=t&&u<=s){r.baseRangeTool(i).adjustRowColFrom(e,a);var c=s-u;r.baseRangeTool(i).adjustRowColCount(e,c),n=!0}else if(a<=t&&u>=s)r.baseRangeTool(i).setRowColOfBaseRangeMissing(e),n=!0;else if(a>=t&&a<=s&&u<=s){var h=a-t+s-u;r.baseRangeTool(i).adjustRowColCount(e,h),n=!0}else if(a>=t&&a<=s&&u>s){var f=a-t;r.baseRangeTool(i).adjustRowColCount(e,f),n=!0}})),n}},{key:"isAdjustBaseRangesIfAddRowCol",value:function(e,t,r,n){var a=!1,o=t.type,i=t.target,u=t.count,s=t.source;return e.forEach((function(l,c){var h,f,d;if("row"===o?(h=l.rowFrom(),f=l.rowTo(),d=l.rowCount()):"col"===o?(h=l.colFrom(),f=l.colTo(),d=l.colCount()):(h=0,f=0,d=0),!(l instanceof au)){var v=i===s+1&&f===s||i===s&&h===s,p=i<=h,m=h<i&&i<=f;"row"===o?v?(r(l,t,n,e,c),a=!0):p?(l.setRowFrom(h+u),a=!0):m&&(l.setRowCount(d+u),a=!0):"col"===o&&(v?(r(l,t,n,e,c),a=!0):p?(l.setColFrom(h+u),a=!0):m&&(l.setColCount(d+u),a=!0))}})),a}},{key:"getAdjustedFormulaStrIfMoveRange",value:function(e,t){var r={isAdjust:!1,value:""},n=e.getFirstAbsoluteRefMap();return n?(r.isAdjust=this.isAdjustFirstCellRefMapIfMoveRange(n,t),r.isAdjust&&(r.value=e.getAdjustedFormulaStr(n)),r):r}},{key:"isAdjustFirstCellRefMapIfMoveRange",value:function(e,t){var r=!1,n=function(e,t){var r={col:0,row:0},n=e.rowFrom(),a=e.colFrom(),o=t.rowFrom(),i=t.colFrom();return r.row=o-n,r.col=i-a,r},a=function(e,t,r){e.setRowFrom(t+r)},o=function(e,t,r){e.setColFrom(t+r)},i=t.toRange,u=t.fromRange,s=t.targetSheet;for(var l in e){var c=e[l];if(u.contain(c)){var h,f=n(u,c),d=i.rowFrom(),v=i.colFrom();a(c,d,f.row),o(c,v,f.col),s.id()!==(null===(h=c.sheet())||void 0===h?void 0:h.id())&&c.setSheet(s),r=!0}}return r}},{key:"isAdjustFirstCellRefMapIfAddRowCol",value:function(e,t){var r=!1,n=t.target,a=t.source,o=t.type,i=t.count,u=Number(a)-Number(n)>=0,s=Number(a)-Number(n)>=0,l=function(e,t,r){e.setRowFrom(t+r)},c=function(e,t,r){e.setColFrom(t+r)};for(var h in e){var f,d=e[h];if((null===(f=d.sheet())||void 0===f?void 0:f.id())===this.sheet.id())if("row"===o){var v=d.rowFrom();(a<v||a===v&&u)&&(l(d,v,i),r=!0)}else if("col"===o){var p=d.colFrom();(a<p||a===p&&s)&&(c(d,p,i),r=!0)}}return r}},{key:"isAdjustFirstCellRefMapIfDelRowCol",value:function(e,t){var r=!1,n=function(e){e.setRowCount(0),e.setColCount(0)},a=t.type,o=t.index,i=t.count,u=o+i-1;for(var s in e){var l,c=e[s];if((null===(l=c.sheet())||void 0===l?void 0:l.id())===this.sheet.id()){var h=this.baseRangeTool(a).rowColFrom(c),f=this.baseRangeTool(a).rowColTo(c),d=o>=h&&o<=f&&u<=f;if(u<h){var v=h-i;this.baseRangeTool(a).adjustRowColFrom(c,v),r=!0}else if(o<h&&u>=h&&u<=f){this.baseRangeTool(a).adjustRowColFrom(c,o);var p=f-u;this.baseRangeTool(a).adjustRowColCount(c,p),r=!0}else if(o<=h&&u>=f)n(c),r=!0;else if(d){var m=o-h+f-u;this.baseRangeTool(a).adjustRowColCount(c,m),r=!0}else if(o>=h&&o<=f&&u>f){var g=o-h;this.baseRangeTool(a).adjustRowColCount(c,g),r=!0}}}return r}}]),e}();function kb(e){var t=function(e){return{aboveAverage:Cb,cellIs:QN,colorScale:pb,containsBlanks:ib,containsText:nb,dataBar:vb,iconSet:kS,notContainsBlanks:ub,rank:mb,timePeriod:sb,uniqueValues:db,expression:wb,duplicateValues:rb}[e]}(e.ruleType);if(t)return new t(e)}var Tb=(ze={},(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_DUPLICATE_VALUES,"duplicateValues"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_UNIQUE_VALUES,"uniqueValues"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_CELL_IS,"cellIs"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_CONTAINS_TEXT,"containsText"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_TIME_PERIOD,"timePeriod"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_CONTAINS_BLANKS,"containsBlanks"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_NOT_CONTAINS_BLANKS,"notContainsBlanks"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_DATA_BAR,"dataBar"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_COLOR_SCALE,"colorScale"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_RANK,"rank"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_AVERAGE,"aboveAverage"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_EXPRESSION,"expression"),(0,l.Z)(ze,Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_ICON_SET,"iconSet"),ze);function Sb(e){if(e)switch(e.ruleType){case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_DUPLICATE_VALUES:case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_UNIQUE_VALUES:case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_CONTAINS_BLANKS:case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_NOT_CONTAINS_BLANKS:return;case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_CELL_IS:return[{operator:eb[e.cellIs.operator],plaintext:e.cellIs.plainText,formula:e.cellIs.formula}];case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_CONTAINS_TEXT:return[{operator:ab[e.containText.operator],text:e.containText.text}];case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_TIME_PERIOD:return[{operator:lb[e.timePeriod.operator],timePeriod:hb[e.timePeriod.period]}];case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_DATA_BAR:return e.dataBar.map((function(e){return{gradient:e.gradient,value:e.value,color:e.color.rgb,hideValue:e.hideValue,valueType:yS[e.valueType]}}));case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_COLOR_SCALE:return e.colorScale.map((function(e){return{valueType:yS[e.valueType],value:e.value,color:e.color.rgb}}));case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_RANK:return[{isBottom:e.rank.isBottom,valueType:gb[e.rank.valueType],value:e.rank.value}];case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_AVERAGE:return[{operator:Rb[e.average.operator]}];case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_EXPRESSION:return[{formula:e.customFormula.formula}];case Ce.B2l.ConditionalFormatRuleTypes.ConditionalFormatRuleTypes_ICON_SET:return e.iconSet.map((function(e){return{iconType:CS[e.iconType],hideValue:e.hideValue,valueType:yS[e.valueType],operator:ES[e.operator],value:e.value,reverseIcons:e.reverseIcons}}));default:return}}var Ab=function(){function e(t){(0,y.Z)(this,e),this.sheet=t,this.rules=[],this.ruleIdxMap=new Map,this.dirtyRangeRTree=new VT,this.dirtyRangeHashSet=new Set,this.cellToRuleCellMap=new qd,this.helper=new Eb(this,this.sheet)}return(0,_.Z)(e,[{key:"getRangeByFormula",value:function(e){throw new Error("Method not implemented.")}},{key:"getRuleIdByFormula",value:function(e){throw new Error("Method not implemented.")}}]),(0,_.Z)(e,[{key:"dispatchChange",value:function(e){this.sheet.dispatch("ConditionalFormatChanged",e)}},{key:"initRule",value:function(e){if(!e.isInit())try{this.watchRule(e),this.markRangeDirty(e.getRanges()),e.init()}catch(t){Ce.Ps3.collectSuiteEvent("client_sheet_conditional_format_exception",{stage:"init_rule",type:"p0",rule_type:e.ruleType,error_name:t&&t.name,error_msg:t&&t.message,error_stack:t&&t.stack})}}},{key:"reInitRules",value:function(){this.rules.forEach((function(e){e.isInit()||e.init()}))}},{key:"notifyCalcRuleFormula",value:function(){this.sheet.parent.dispatch("ConditionalFormatDirty",this.sheet.id())}},{key:"watchRule",value:function(e){var t=this;e.watch((function(e){t.markRangeDirty(e)}))}},{key:"addRangesToDirtyRanges",value:function(e){var t=this;e.forEach((function(e){if(e.hostId===t.sheet.id()){var r=e.hash(!1,!0);t.dirtyRangeHashSet.has(r)||t.dirtyRangeRTree.search(e).some((function(t){return t.ref.contain(e)}))||(t.dirtyRangeHashSet.add(r),t.dirtyRangeRTree.insert({ref:e}))}}))}},{key:"markDirty",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.addRangesToDirtyRanges(t),this.notifyCalcRuleFormula()}},{key:"markRangeDirty",value:function(e){this.addRangesToDirtyRanges(Array.isArray(e)?e:[e]),this.notifyCalcRuleFormula()}},{key:"calcStyle",value:function(){var e=this,t=new Set;this.dirtyRangeRTree.all().forEach((function(r){var n=r.ref,a=e.getRulesByRange(n);OT(n,(function(r,n){var o=Wd(r,n);t.has(o)||(t.add(o),a.forEach((function(t){if(t.isMatch(r,n)){var a=e.cellToRuleCellMap.get(r,n);a||(a=new Map,e.cellToRuleCellMap.set(r,n,a));var o=t.getValue(r,n);a.set(t.cfId,o)}})))}))}))}},{key:"getKey",value:function(e,t){return["colorScale","dataBar","iconSet"].includes(e)?e:"expression"===e?t:"cellIs"}},{key:"getStyle",value:function(e,t){var r=null,n=this.cellToRuleCellMap.get(e,t),a={};if(n)for(var o=this.getAllRules(),i=o.length-1;i>=0;i--){var u=o[i];if(n.has(u.cfId)){var s=this.getKey(u.ruleType,u.cfId);if(!a[s]){var l=u.getFormatStyle(e,t);l&&(a[s]=1,r=Object.assign({},l,{},r))}}}return r&&"transparent"===r.foreColor&&delete r.foreColor,r}},{key:"initAllRules",value:function(){var e=this;this.rules.forEach((function(t){return e.initRule(t)}))}},{key:"moveRule",value:function(e){var t=this,r=e.source,n=e.target,a=this.rules[r];if(a){var o=this.rules.splice(r,1).shift();this.rules.splice(n,0,o),this.ruleIdxMap.clear(),this.rules.forEach((function(e,r){return t.ruleIdxMap.set(e.cfId,r)})),this.dispatchChange({type:"moveConditionalFormat",cfId:o.cfId,affectedRanges:o.getRanges()}),this.markRangeDirty([].concat((0,m.Z)(a.getRanges()),(0,m.Z)(o.getRanges())))}}},{key:"addRule",value:function(e,t){var r=t.ranges,n=t.ruleType,a=t.style,o=t.attrs,i=t.index,u=t.hasRef,s=this.getRuleIndex(e);if(rS[n]&&!(s>=0)){var l=kb({sheet:this.sheet,cfId:e,ranges:r,ruleType:n,style:a,attrs:o,hasRef:u});this.afterAddRule(i,e,l)}}},{key:"afterAddRule",value:function(e,t,r){if(r){if(void 0!==e&&e>=0){this.rules.splice(e,0,r);for(var n=e;n<this.rules.length;n++)this.ruleIdxMap.set(this.rules[n].cfId,n);e>=this.rules.length&&this.ruleIdxMap.set(t,this.rules.length-1)}else this.rules.push(r),this.ruleIdxMap.set(t,this.rules.length-1);this.initRule(r)}this.dispatchChange({type:"setConditionalFormat",cfId:t})}},{key:"addRuleV2",value:function(e){if(e.value){var t=e.value,r=e.index,n=t.id;if(t.rule&&null!=t.rule.ruleType&&n&&!(this.getRuleIndex(n)>=0)){var a=function(e,t){var r,n,a=Tb[e.rule.ruleType];if(a){var o=e.id,i=e.ranges,u=e.style,s=e.rule;return kb({ruleType:a,cfId:null!==(r=o)&&void 0!==r?r:"",sheet:t,ranges:i?i.map((function(e){return hs(e,t)})).map((function(e){return gu(e,!0)})):[],style:null!==(n=AS(u))&&void 0!==n?n:{},attrs:Sb(s)})}}(t,this.sheet);this.afterAddRule(r,n,a)}}}},{key:"setRule",value:function(e,t){var r=t.ranges,n=t.ruleType,a=t.style,o=t.attrs,i=this.getRuleIndex(e);if(rS[n]&&-1!==i){var u=this.rules[i];u.destroy();var s=kb({sheet:this.sheet,cfId:e,ranges:r,ruleType:n,style:a,attrs:o});this.rules[i]=s,this.initRule(s),this.dispatchChange({type:"setConditionalFormat",cfId:e,affectedRanges:u.getRanges()})}}},{key:"deleteRule",value:function(e){var t=this.getRuleIndex(e);if(-1!==t){var r=this.rules.splice(t,1),n=(0,g.Z)(r,1)[0];this.ruleIdxMap.delete(e);for(var a=t;a<this.rules.length;a++)this.ruleIdxMap.set(this.rules[a].cfId,a);this.dispatchChange({type:"delConditionalFormat",cfId:e,affectedRanges:n.getRanges()}),this.markRangeDirty(n.getRanges()),n.destroy()}}},{key:"getRuleById",value:function(e){var t=this.ruleIdxMap.get(e);if(void 0!==t)return this.rules[t]}},{key:"getRuleIndex",value:function(e){var t=this.ruleIdxMap.get(e);return void 0!==t?t:-1}},{key:"getAllRules",value:function(){return this.rules}},{key:"hasRules",value:function(){return this.rules.length>0}},{key:"hasRuleInRange",value:function(e){return this.rules.some((function(t){return t.isIntersect(e)}))}},{key:"getRulesByRange",value:function(e){return this.rules.filter((function(t){return t.isIntersect(e)}))}},{key:"getLastIndex",value:function(){return this.rules.length}},{key:"toJSON",value:function(){if(this.rules&&0!==this.rules.length)return this.rules.map((function(e){return e.toJSON()}))}},{key:"destroy",value:function(){this.rules.forEach((function(e){e.destroy()})),this.rules.length=0,this.cellToRuleCellMap.clear(),this.dirtyRangeRTree.clear(),this.dirtyRangeHashSet.clear()}},{key:"getDirtyFormulaCount",value:function(){return this.dirtyRangeRTree.getSize()}},{key:"calcDirtyRule",value:function(e){var t=this,r={},n=this.sheet,a=av(n.parent,n.parent.calcEngine.formulaService),o=[];return this.dirtyRangeRTree.all().forEach((function(e){var r=e.ref;t.getRulesByRange(r).forEach((function(e){o.push.apply(o,(0,m.Z)(e.getCalcRange(r)))}))})),this.addRangesToDirtyRanges(o),this.dirtyRangeRTree.all().forEach((function(n){var o=n.ref;t.getRulesByRange(o).forEach((function(e){var t=e.cfId,n=(0,Ce.D5c)();e.calc(a,o);var i=(0,Ce.egz)(n);r[t]?r[t]+=i:r[t]=i})),null==e||e()})),this.calcStyle(),r}},{key:"getCellStyle",value:function(e,t){return this.sheet._getModel().getConditionalFormatStyle(e,t)}},{key:"setCellStyle",value:function(e,t,r){this.sheet._getModel().setConditionalFormatStyle(e,t,r)}},{key:"clearStylesByRange",value:function(e,t,r,n){this.sheet._getModel().clearConditionalFormatStyle(e,t,r,n)}},{key:"getDirtyResult",value:function(){var e=this,t=new pA,r=[],n=new Set;return this.dirtyRangeRTree.all().forEach((function(a){OT(a.ref,(function(a,o){var i=Wd(a,o);if(!n.has(i)){n.add(i);var u=e.getStyle(a,o);if(u){var s=t.add(u).id;r.push([a,o,s])}else r.push([a,o,null])}}))})),{idToRef:t.toJSON(),data:r}}},{key:"clear",value:function(){this.rules.forEach((function(e){return e.clear()})),this.cellToRuleCellMap.clear(),this.dirtyRangeRTree.clear(),this.dirtyRangeHashSet.clear()}}],[{key:"fromJSON",value:function(t,r){var n=new e(t);return Array.isArray(r)&&r.forEach((function(e){var t=(0,Re.default)(e);delete t.cfId,n.addRule(e.cfId,t)})),n}}]),e}(),Ib=function(e){return 0===Object.keys(e).length};function Ob(e){var t=JSON.parse(JSON.stringify(e));if(delete t.schemaVersion,t.sheets){var r=function(e){var r=t.sheets[e];r.entities&&!Ib(r.entities)&&Fb(r.entities);var n=r.data&&r.data.dataTable;if(n)for(var a in n)if(n[a])for(var o in n[a])n[a][o]&&(n[a][o].styleId&&(n[a][o].style=r.entities.styles[n[a][o].styleId],delete n[a][o].styleId),n[a][o].value&&Array.isArray(n[a][o].value)&&(n[a][o].value=n[a][o].value.map((function(e){if(e.type)switch(e.type){case"mention":return r.mention[e.id];case"embed-image":return r.image[e.id]}return e}))));if(r.comment&&!Ib(r.comment))for(var i in n||(n={}),r.comment)for(var u in n[i]||(n[i]={}),r.comment[i])n[i][u]||(n[i][u]={}),n[i][u].comments=r.comment[i][u];n&&(r.data?r.data.dataTable=n:r.data={dataTable:n}),delete r.comment,delete r.image,delete r.mention,delete r.entities,t.sheets[e]=r};for(var n in t.sheets)r(n)}return t}function Vb(e){var t=JSON.parse(JSON.stringify(e));t.entities&&!Ib(t.entities)&&Fb(t.entities);var r=t.data&&t.data.dataTable;if(r)for(var n in r)if(r[n])for(var a in r[n])r[n][a]&&(r[n][a].styleId&&(r[n][a].style=t.entities.styles[r[n][a].styleId],delete r[n][a].styleId),r[n][a].value&&Array.isArray(r[n][a].value)&&(r[n][a].value=r[n][a].value.map((function(e){if(e.type)switch(e.type){case"mention":return t.mention[e.id];case"embed-image":return t.image[e.id]}return e}))));if(t.comment&&!Ib(t.comment))for(var o in r||(r={}),t.comment)for(var i in r[o]||(r[o]={}),t.comment[o])r[o][i]||(r[o][i]={}),r[o][i].comments=t.comment[o][i];return r&&(t.data?t.data.dataTable=r:t.data={dataTable:r}),delete t.comment,delete t.image,delete t.mention,delete t.entities,t}function Nb(e){var t=new Map;return{sheetSnapshot:Mb(e.sheetSnapshot,e.blocks,t),blocks:t}}function bb(e){var t=JSON.parse(JSON.stringify(e.snapshot)),r=new Map;if(t.sheets)for(var n in t.sheets)t.sheets[n]=Mb(t.sheets[n],e.blocks,r),delete t.sheets[n].comment,delete t.sheets[n].mention,delete t.sheets[n].image,delete t.sheets[n].entities;return delete t.schemaVersion,{snapshot:t,blocks:r}}function Mb(e,t,r){var n=JSON.parse(JSON.stringify(e));if(n.blocks){var a=n.blocks.length,o=JSON.parse(JSON.stringify(n.blocks));o.sort((function(e,t){return e.startRowIndex-t.startRowIndex})),o.forEach((function(e,i){var u=t.get(e.token),s=JSON.parse(JSON.stringify(u)),l=!1,c=!1;0===i&&(l=!0),i===a-1&&(c=!0),function(e,t,r,n,a,o){if((void 0===e.entities||Ib(e.entities))&&(void 0===e.comment||Ib(e.comment))&&(void 0===e.image||Ib(e.image))&&(void 0===e.mention||Ib(e.mention)))return;var i=e;i.entities&&!Ib(i.entities)&&Fb(i.entities);var u=function(e,t,r){var n=!1,a=!1;if(e&&!Ib(e)&&(n=!0),t&&!Ib(t)&&(a=!0),r&&!Ib(r)&&(a=!0),a&&n)return function(n){n&&n.hasOwnProperty("styleId")&&Zb(n,e),n&&n.hasOwnProperty("value")&&xb(n,t,r)};if(a)return function(e){e&&e.hasOwnProperty("value")&&xb(e,t,r)};if(n)return function(t){t&&t.hasOwnProperty("styleId")&&Zb(t,e)}}(i.entities&&!Ib(i.entities)?i.entities.styles:void 0,i.image,i.mention);if(u&&function(e,t){if(t.rows&&t.rows.length)for(var r=0,n=t.rows.length;r<n;r++){var a=t.rows[r];if(a&&a.columns&&a.columns.length)for(var o=0,i=a.columns.length;o<i;o++)e(a.columns[o])}}(u,t),i.comment&&!Ib(i.comment)){var s,l,c=yr(i.blocks);try{for(c.s();!(l=c.n()).done;){var h=l.value;if(h.startRowIndex===r){s=h;break}}}catch(e){c.e(e)}finally{c.f()}if(a&&0!==r){var f=r;for(var d in i.comment)f=Math.min(f,Number(d));f<r&&(t.rows=new Array(r-f).fill(null).concat(t.rows),s.startRowIndex=f,s.rowsCount+=r-f,r=f)}if(o){var v=200;n=i.rowCount?i.rowCount:v}(function(e,t,r,n){var a=t.rows.length+r;for(var o in e)Number(o)>=a&&Number(o)<n&&(a=Number(o)+1);for(var i=r;i<a;i++){var u=Number(i)-r;if(void 0===t.rows[u]&&(t.rows[u]=null),e[i]){var s=0;for(var l in e[i])s=Math.max(s,Number(l));for(var c in t.rows[u]||(t.rows[u]={columns:new Array(s).fill(null)}),e[i])t.rows[u].columns[c]||(t.rows[u].columns[c]={}),t.rows[u].columns[c].comments=e[i][c];delete e[i]}}})(i.comment,t,r,n),s.rowsCount=t.rows.length}}(n,s,e.startRowIndex,c?n.rowCount||200:o[i+1].startRowIndex,l,c),r.set(e.token,s)}))}return n}function Fb(e){if(e.styles&&e.dropdowns){for(var t in e.styles)e.styles[t].hasOwnProperty("dropdown")&&(e.styles[t].dropdown=e.dropdowns[e.styles[t].dropdown]);delete e.dropdowns}return e}function Zb(e,t){return e.styleId&&(e.style=t[e.styleId],delete e.styleId),e}function xb(e,t,r){if(Array.isArray(e.value))for(var n in e.value)if(e.value[n].hasOwnProperty("type")){var a=e.value[n].id;switch(e.value[n].type){case"embed-image":e.value[n]=t[a];break;case"mention":e.value[n]=r[a]}}}function Db(e){if(null==e)return e;if("object"!=(0,R.Z)(e))return e;for(var t in e)void 0===e[t]&&delete e[t];return Object.keys(e).sort().reduce((function(t,r){return Array.isArray(e[r])?t[r]=e[r].map(Db):"object"==(0,R.Z)(e[r])?t[r]=Db(e[r]):t[r]=e[r],t}),{})}function Pb(e){var t=Db(e),r=JSON.stringify(t);return At()(r)}function $b(e){if(!e)return!0;var t=e.columns;return!t||0===t.length||t.filter((function(e){return null===e||0===Object.keys(e).length})).length===t.length}var Lb=function(){function e(t){for(var r in(0,y.Z)(this,e),this._sheetSnapshot=t,this._comment={},this._mention={},this._mentionHashs={},this._image={},this._imageHashs={},this._styles={},this._stylesHashs={},this._dropdowns={},this._dropdownsHashs={},this._comment=t.comment||{},this._mention=t.mention||{},this._mention)this._mentionHashs[Pb(this._mention[r])]=r;for(var n in this._image=t.image||{},this._image)this._imageHashs[Pb(this._image[n])]=n;for(var a in this._styles=t.entities&&t.entities.styles||{},this._styles)this._stylesHashs[Pb(this._styles[a])]=a;for(var o in this._dropdowns=t.entities&&t.entities.dropdowns||{},this._dropdowns)this._dropdownsHashs[Pb(this._dropdowns[o])]=o;this._mentionsIndex=1+this._getMaxIndex(this._mention),this._imagesIndex=1+this._getMaxIndex(this._image),this._stylesIndex=1+this._getMaxIndex(this._styles),this._dropdownsIndex=1+this._getMaxIndex(this._dropdowns)}return(0,_.Z)(e,[{key:"_getMaxIndex",value:function(e){var t=0;for(var r in e)Number(r)>t&&(t=Number(r));return t}},{key:"_AddComment",value:function(e,t,r){this._comment[e]||(this._comment[e]={}),this._comment[e][t]=r}},{key:"_ExtractComments",value:function(e,t,r){r.hasOwnProperty("comments")&&(this._AddComment(e,t,r.comments),delete r.comments)}},{key:"_ExtractMentionsAndImages",value:function(e){var t=this;e.hasOwnProperty("value")&&Array.isArray(e.value)&&(e.value=e.value.map((function(e){if(e.hasOwnProperty("type"))switch(e.type){case"mention":var r=Pb(e),n=Number(t._mentionHashs[r])||-1;return-1===n&&(t._mention[t._mentionsIndex]=e,t._mentionHashs[r]=t._mentionsIndex,n=t._mentionsIndex++),{type:e.type,id:n};case"embed-image":var a=Pb(e),o=Number(t._imageHashs[a])||-1;return-1===o&&(t._image[t._imagesIndex]=e,t._imageHashs[a]=t._imagesIndex,o=t._imagesIndex++),{type:e.type,id:o}}return e})))}},{key:"_ExtractStyles",value:function(e){if(e.hasOwnProperty("style")){var t=e.style;if(t.hasOwnProperty("dropdown")){var r=Pb(t.dropdown),n=Number(this._dropdownsHashs[r])||-1;-1===n&&(this._dropdowns[this._dropdownsIndex]=t.dropdown,this._dropdownsHashs[r]=this._dropdownsIndex,n=this._dropdownsIndex++),t.dropdown=n}var a=Pb(t),o=Number(this._stylesHashs[a])||-1;-1===o&&(this._styles[this._stylesIndex]=t,this._stylesHashs[a]=this._stylesIndex,o=this._stylesIndex++),e.styleId=o,delete e.style}}},{key:"_VisitCell",value:function(e,t,r){return this._ExtractComments(e,t,r),this._ExtractMentionsAndImages(r),this._ExtractStyles(r),r}},{key:"_IsObjectEmpty",value:function(e){return 0===Object.getOwnPropertyNames(e).length}},{key:"_OldToNew_DataTable",value:function(e){for(var t in e)if(e[t])for(var r in e[t])e[t][r]&&(e[t][r]=this._VisitCell(Number(t),Number(r),e[t][r]));return e}},{key:"_UpdateItems",value:function(){if(this._IsObjectEmpty(this._comment)||(this._sheetSnapshot.comment=this._comment),this._IsObjectEmpty(this._mention)||(this._sheetSnapshot.mention=this._mention),this._IsObjectEmpty(this._image)||(this._sheetSnapshot.image=this._image),!this._IsObjectEmpty(this._styles)){var e={styles:this._styles};this._IsObjectEmpty(this._dropdowns)||(e.dropdowns=this._dropdowns),this._sheetSnapshot.entities=e}}},{key:"OldToNew",value:function(){var e=this._sheetSnapshot.data&&this._sheetSnapshot.data.dataTable;e&&(this._sheetSnapshot.data.dataTable=this._OldToNew_DataTable(e),this._UpdateItems())}},{key:"getSheetSnapshot",value:function(){return this._sheetSnapshot}},{key:"OldBlockToNewBlock",value:function(e,t){var r=t.rows.length;if(r<=0)return t;for(var n=0;n<r;n++)if(null!==t.rows[n]&&null!==t.rows[n].columns){var a=t.rows[n].columns.length;if(!(a<=0))for(var o=0;o<a;o++)null!==t.rows[n].columns[o]&&(t.rows[n].columns[o]=this._VisitCell(n+e.startRowIndex,o,t.rows[n].columns[o]))}this._UpdateItems(),function(e,t){for(var r=0,n=t.rows.length-1;$b(t.rows[r])&&r<n;)r++;for(;$b(t.rows[n])&&n>r;)n--;t.rows=t.rows.slice(r,n+1),e.startRowIndex=e.startRowIndex+r,e.rowsCount=t.rows.length,t.rows=t.rows.map((function(e){return $b(e)?null:function(e){for(var t=e.columns.length-1;t>=0&&null===e.columns[t];)t--;return e.columns=e.columns.slice(0,t+1),e}(e)}))}(e,t)}}]),e}();function Bb(e){var t=JSON.parse(JSON.stringify(e));if(t.schemaVersion=1,t.sheets)for(var r in t.sheets){var n=t.sheets[r],a=new Lb(n);a.OldToNew(),t.sheets[r]=a.getSheetSnapshot()}return t}function Ub(e){var t=new Lb(JSON.parse(JSON.stringify(e)));return t.OldToNew(),t.getSheetSnapshot()}function Hb(e){var t=JSON.parse(JSON.stringify(e.snapshot)),r=new Map;if(t.sheets)for(var n in t.sheets)t.sheets[n]=Wb(t.sheets[n],e.blocks,r);return t.schemaVersion=1,{snapshot:t,blocks:r}}function zb(e){var t=new Map;return{sheetSnapshot:Wb(e.sheetSnapshot,e.blocks,t),blocks:t}}function Wb(e,t,r){var n=JSON.parse(JSON.stringify(e)),a=new Lb(n);return a.OldToNew(),n.blocks&&n.blocks.forEach((function(e){var n=t.get(e.token);if(n){var o=JSON.parse(JSON.stringify(n));a.OldBlockToNewBlock(e,o),r.set(e.token,o)}})),a.getSheetSnapshot()}function Gb(e){return e.schemaVersion=2,e}function jb(e){var t=e.snapshot,r=e.blocks;return t.schemaVersion=2,{snapshot:t,blocks:r}}function Yb(e){return e}function qb(e){return e}function Jb(e){return e.schemaVersion=1,delete e.extra,e}function Kb(e){var t=e.snapshot,r=e.blocks;return t.schemaVersion=1,delete t.extra,{snapshot:t,blocks:r}}function Xb(e){return e}function Qb(e){return e}var eM=function(){function e(){(0,y.Z)(this,e),this.managers={},this.managers[0]={},this.managers[1]={},this.managers[0][1]={convertWithDataTable:Bb,convertWithBlocks:Hb,convertSheetWithDataTable:Ub,convertSheetWithBlocks:zb},this.managers[1][0]={convertWithDataTable:Ob,convertWithBlocks:bb,convertSheetWithDataTable:Vb,convertSheetWithBlocks:Nb},this.managers[2]={},this.managers[1][2]={convertWithDataTable:Gb,convertWithBlocks:jb,convertSheetWithDataTable:Yb,convertSheetWithBlocks:qb},this.managers[2][1]={convertWithDataTable:Jb,convertWithBlocks:Kb,convertSheetWithDataTable:Xb,convertSheetWithBlocks:Qb}}return(0,_.Z)(e,[{key:"getInvokers",value:function(e,t){var r=[];if(e<t)for(;e+1<=t;)r.push(this.managers[e][e+1]),e++;else for(;e-1>=t;)r.push(this.managers[e][e-1]),e--;return r}},{key:"convert",value:function(e,t,r,n){if(e===t)return{snapshot:r,blocks:n};var a=this.getInvokers(e,t);if(void 0===n)return a.forEach((function(e){r=e.convertWithDataTable(r)})),{snapshot:r,blocks:null};var o={snapshot:r,blocks:n};return a.forEach((function(e){o=e.convertWithBlocks(o)})),o}},{key:"convertSheet",value:function(e,t,r,n){if(e===t)return{sheetSnapshot:r,blocks:n};var a=this.getInvokers(e,t);if(void 0===n)return a.forEach((function(e){r=e.convertSheetWithDataTable(r)})),{sheetSnapshot:r,blocks:null};var o={sheetSnapshot:r,blocks:n};return a.forEach((function(e){o=e.convertSheetWithBlocks(o)})),o}}]),e}(),tM=function(e){var t,r;return null!==(t=null==e||null===(r=e.customData)||void 0===r?void 0:r.autoFormat)&&void 0!==t?t:void 0};function rM(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(e)return nM(t,n);if(t&&t.formatter)return t.formatter;if(null!=r&&r.variant&&(r.variant.isFormula()||jp(r.variant))){var o;if(r.variant.isFormula()&&(o=tM(r.variant.getInfo())))return(0,Ee.createFormatter)(n.formatterService,o);if(o=tM(r.variant.getVar().getSpecialInfo()))return(0,Ee.createFormatter)(n.formatterService,o)}if((0,er.isShortCut)()&&null!=r&&r.variant&&r.variant.isNumber()){var i=tM(r.variant.getVar().getSpecialInfo());if(i)return(0,Ee.createFormatter)(n.formatterService,i)}return!a&&t&&t.autoFormatter?t.autoFormatter:null}function nM(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0,r=aM(e);return r&&(0,Ee.isDateTimeFormatter)(r)?r:t.getDefaultReminderFormatter()}function aM(e){return(null==e?void 0:e.formatter)||(null==e?void 0:e.autoFormatter)}var oM=function(e){var t={divider:!0},r=(0,P.Z)(e,Uy);return[r("general"),r("plain_text"),t,r("digital_without_separator"),r("digital"),r("digital_round"),t,r("percentage_rounded"),r("percentage"),r("scientific"),t].concat((0,m.Z)((0,er.isLark)()?[]:[r("cyn_rounded"),r("cyn")]),[r("dollar_rounded"),r("dollar"),t,r("date_with_slash"),r("date_with_hyphen"),r("time"),r("date_time"),{key:"Sheets_Formats_MoreFormats",name:cr("LarkCCM_Sheets_Toolbar_MoreFormats_Menu")}])},iM=function(e){function t(e,r,n,a){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r,n,a))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"fromJSON",value:function(e){e&&this.setDefaultNodeData(e)}}]),t}(TA),uM=sa,sM=".gcSheet",lM=".gcSheetInternal";function cM(e,t){for(var r=0,n=e.length;r<n;r++){var a=e[r];if(!t.contain(a)&&t.isIntersect(a))return e.splice(r--,1),cM(e,t.union(a))}return t}function hM(e){return e?e.getColumnCount():(console.error(""),0)}function fM(e){return e?e.getRowCount():(console.error(""),0)}function dM(e){return e.frozenColumnCount()}function vM(e){return e.frozenRowCount()}var pM={isProtected:!0,protectionOptions:{},showFormulaText:!1},mM=function(){function e(t,r){var n=this,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=arguments.length>3?arguments[3]:void 0;if((0,y.Z)(this,e),this._delTime="",this._disposed=!1,this.needNotify=!0,this.lastRowHeaderWidth=0,this.lastCalcRowCount=0,this._isFirstSetFocus=!0,this._filterWatchHub=new jt.WatchedRefHub,this.$watcher=new Ce.CPL,this.frozenColumnCount=xm("frozenColumnCount",0,(function(e){var t=this._scrollLeftCol,r={sheet:this,sheetName:this._name,propertyName:"frozenColumnCount",newValue:e,oldValue:t};this._scrollLeftCol=e,this.chartModel.frozen("col",e),this.dispatch("FrozenChanged",r)}),(function(e){return e>=0})),this.frozenRowCount=xm("frozenRowCount",0,(function(e){var t=this._scrollTopRow,r={sheet:this,sheetName:this._name,propertyName:"frozenRowCount",newValue:e,oldValue:t};this._scrollTopRow=e,this.chartModel.frozen("row",e),this.dispatch("FrozenChanged",r)}),(function(e){return e>=0})),this._cellRangeInflate=cM,arguments.length<2||!r||!t)throw new Error("Worksheet not assign an _id_");this.initContainerAndServices(o),this.initSheetWatchHub(),this.parent=o,this._id_=t,this._id=e._ID++,this._version=e.latestVersion,this.options=Dm(pM,(function(e,t,r){n._onOptionChanged(e,t,r)})),this._init(r,a),this.chartModel=new cI(this),this.rangeModel=new JN(this),this.floatImageModel=new qN(this),this.floatBlocksModel=new LN(this),this.embeddedBlocksModel=new pI(this),this._delTime="",this.conditionalFormatModel=new Ab(this),this.selectionType=1,Object.assign(this.defaults,this.parent?this.parent.defaults:{}),this._initStyle()}return(0,_.Z)(e,[{key:"sheetType",get:function(){return"sheet"}},{key:"watchHubs",get:function(){return[this._filterWatchHub]}},{key:"filterWatchHub",get:function(){return this._filterWatchHub}},{key:"formatterService",get:function(){return this.parent.formatterService}},{key:"_pivotTableManager",get:function(){return this.getPivotTableManagerV2()}}]),(0,_.Z)(e,[{key:"initContainerAndServices",value:function(e){var t=this;return this.sheetIOC=XV({getSheetDataModel:function(){return function(){return t._getModel()}},getWatch:function(){return t.$watcher},getFilterWatchHub:function(){return t.filterWatchHub},getSheet:function(){return t},getI18n:function(){return cr.bind(Ce.Ps3)},getCalcEngine:this.getCalcEngine.bind(this),getStageTracker:function(){return Ce.vRF},getMoirae:function(){return Ce.Ps3.moirae}}),e.bindWorksheetIOCService(this.sheetIOC),this.inject=this.sheetIOC.get.bind(this.sheetIOC),this.dataValidationService=this.sheetIOC.get(zO),this.sheetFilterModel=this.sheetIOC.get($I),this.viewsModel=this.sheetIOC.get(QI),this.outlineGroupModel=this.sheetIOC.get(Wu),this.protectionModel=this.sheetIOC.get(NN),this.sheetIOC}},{key:"isHiddenByOutlineGroup",value:function(e,t){return this.outlineGroupModel.isRowColHidden("row"===e?Ce.xj7.ROW:Ce.xj7.COL,t)}},{key:"subscribe",value:function(e,t){return this.$watcher.subscribe(e,t)}},{key:"subscribePropagation",value:function(e){return this.$watcher.subscribe(Ce.MSA,e)}},{key:"dispatch",value:function(e,t,r){this.$watcher.dispatch(e,t,r),this.$watcher.dispatch(Ce.MSA,{type:e,props:t,$sheet:this,source:r})}},{key:"iterCell",value:function(e,t,r,n){return this._dataModel.iterCell(e,t,r,n)}},{key:"iterDataValidationWithPos",value:function(e,t,r,n){return this._getModel().iterDataValidationWithPos(e,t,r,n)}},{key:"iterSparklineWithPos",value:function(e,t,r,n){return this._getModel().iterSparklineWithPos(e,t,r,n)}},{key:"iterDropdownWithPos",value:function(e,t,r,n){return this._getModel().iterDropdownWithPos(e,t,r,n)}},{key:"getSparklineGroupByGroupId",value:function(e){return this._getModel().getSparklineGroupByGroupId(e)}},{key:"getSparklineGroupBySparklineId",value:function(e){return this._getModel().getSparklineGroupBySparklineId(e)}},{key:"getSparklineConfigByGroupId",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return this._getModel().getSparklineConfigByGroupId(e,t)}},{key:"getSparklineById",value:function(e){return this._getModel().getSparklineById(e)}},{key:"getSparklinesByGroupId",value:function(e){return this._getModel().getSparklinesByGroupId(e)}},{key:"getSparklineByCell",value:function(e,t){return this._getModel().getSparklineByCell(e,t)}},{key:"getSparklineModel",value:function(){return this._getModel().sparklineModel}},{key:"iterVisibleRow",value:function(e,t,r){return this._getRowInfos().iterEachActualVisible(e,t,r)}},{key:"iterVisibleCol",value:function(e,t,r){return this._getColInfos().iterEachActualVisible(e,t,r)}},{key:"getIsCellVisible",value:function(e,t){return this.filterModel.isVisible(e)&&this.getRowVisible(e)&&this.getColumnVisible(t)}},{key:"setSelectionType",value:function(e){if(e!==this.selectionType){var t=this.getSelections();this.selectionType=e,this._raiseSelectionChanged(t)}}},{key:"getIsSpanVisible",value:function(e){return null!=e&&!!this.cellModel.iterVisibleSpan(e.rowFrom(),e.colFrom(),e.rowTo(),e.colTo()).first_if((function(e){return!!e}))}},{key:"_onOptionChanged",value:function(e,t,r){}},{key:"id",value:function(e){return 0===arguments.length?(this._id_||(console.warn("Worksheet  _id_ "),this._id_="1"),this._id_):(this._id_=e,this)}},{key:"name",value:function(e){var t=this;if(0===arguments.length)return t._name;if(!t._isValidSheetName(e))return t;t._setNameCore(e);var r=this.parent;return t.dispatch("Renamed",{sheet:t}),r&&r.calcEngine.recoverInvalidRefs(this),t}},{key:"getHiddenStatus",value:function(){return this._hidden}},{key:"setHidden",value:function(e){var t=this;return 0===arguments.length?this.getHiddenStatus():(t._setHiddenCore(e),e?this.dispatch("SheetHidden",{sheetId:t.id()}):this.dispatch("SheetVisible",{sheetId:t.id()}),t)}},{key:"_setNameCore",value:function(e){this._name=e}},{key:"_isRowFilterOut",value:function(e){return!this.filterModel.isVisible(e)}},{key:"_setHiddenCore",value:function(e){this._hidden=e}},{key:"isSoftDeleted",value:function(){return Boolean(this._delTime)}},{key:"setDelTime",value:function(e){this._delTime=e}},{key:"clearDelTime",value:function(){this._delTime=""}},{key:"version",value:function(e){return null!=e&&(this._version=e),this._version}},{key:"isRefCountValid",value:function(){return this.version()>=e.refCountValidVersion}},{key:"setToRefCountValidVersion",value:function(){this._version=e.refCountValidVersion}},{key:"visible",value:function(){return!this.getHiddenStatus()}},{key:"addRows",value:function(e,t,r){if(!(t<=0)){var n=this,a=fM(n);(e<0||e>a)&&(e=a);var o=this.inject(_I);this._getRowInfos().addItems(e,t),this._localRowInfos.addItems(e,t),this._getModel().addRows(e,t),n._rowHeaderModel.addRows(e,t);var i=n._getSpanModel(2);i.addRows(e,t),(i=n._getSpanModel()).addRows(e,t),o.actionEventBus$.next({type:"addRows",row:e,count:t}),n.chartModel.addRows(e,t),n.rangeModel.addRows(e,t),n.floatImageModel.addRows(e,t),n.protectionModel.adjustProtectionRange("row","add",e,t),n.floatBlocksModel.addRows(e,t),n.embeddedBlocksModel.addRows(e,t,r);var u=new vu(!0,"add",e,t,this);this.getParent().watchHubsOnRefOp(u);this.updateFreezeWhenLayoutChanged({changeType:0,row:e,oldValue:a,rowCount:t})}}},{key:"initSheetWatchHub",value:function(){this._filterWatchHub.setRefOpHandler("MoveRangeOp",(function(e,t){var r=t.srcRange(),n=t.targetRange();r.sheet()===n.sheet()&&(e.onOp(t),e.$&&e.$.next(e))}))}},{key:"deleteRows",value:function(e,t,r){var n=fM(this);if(!(0>e||e>=n||t<=0)){var a=this.inject(_I),o=this.getColumnCount();this.unRegisterFmlByRange(e,0,t,o);var i=new vu(!0,"delete",e,t,this);this.getParent().watchHubsOnRefOp(i),this._localRowInfos.deleteItems(e,t),this._getRowInfos().deleteItems(e,t),this._getModel().deleteRows(e,t),this._rowHeaderModel.deleteRows(e,t);var u=this._getSpanModel(2);u.removeRows(e,t),(u=this._getSpanModel()).removeRows(e,t),a.actionEventBus$.next({type:"deleteRows",row:e,count:t}),this.chartModel.removeRows(e,t),this.rangeModel.delRows(e,t),this.floatImageModel.removeRows(e,t),this.protectionModel.adjustProtectionRange("row","del",e,t),this.floatBlocksModel.removeRows(e,t),this.embeddedBlocksModel.removeRows(e,t);var s=n;this.getActiveRowIndex()>=s&&this.setActiveCell(s-1,this.getActiveColumnIndex());this.updateFreezeWhenLayoutChanged({changeType:1,row:e,oldValue:n,rowCount:t})}}},{key:"addColumns",value:function(e,t,r){if(!(t<=0)){var n=this,a=hM(n);(e<0||e>a)&&(e=a),n._getColInfos().addItems(e,t),this._localColInfos.addItems(e,t),n._getModel().addColumns(e,t),n._colHeaderModel.addColumns(e,t);var o=n._getSpanModel(1);o.addColumns(e,t),(o=n._getSpanModel()).addColumns(e,t),n.chartModel.addColumns(e,t),n.rangeModel.addCols(e,t),n.floatImageModel.addColumns(e,t),n.protectionModel.adjustProtectionRange("col","add",e,t),n.floatBlocksModel.addColumns(e,t),n.embeddedBlocksModel.addColumns(e,t,r);var i=new vu(!1,"add",e,t,this);this.getParent().watchHubsOnRefOp(i);this.updateFreezeWhenLayoutChanged({changeType:0,col:e,oldValue:a,colCount:t})}}},{key:"getCalcEngine",value:function(){return this.getParent().getCalcEngine()}},{key:"deleteColumns",value:function(e,t,r){var n=this,a=hM(n);if(!(0>e||e>=a||t<=0)){this.inject(_I).actionEventBus$.next({type:"deleteCols",col:e,count:t});var o=this.getRowCount();this.unRegisterFmlByRange(0,e,o,t);var i=new vu(!1,"delete",e,t,this);this.getParent().watchHubsOnRefOp(i),this._localColInfos.deleteItems(e,t),n._getColInfos().deleteItems(e,t),n._getModel().deleteColumns(e,t),n._colHeaderModel.deleteColumns(e,t);var u=n._getSpanModel(1);u.removeColumns(e,t),(u=n._getSpanModel()).removeColumns(e,t),n.chartModel.removeColumns(e,t),n.rangeModel.delCols(e,t),n.floatImageModel.removeColumns(e,t),n.protectionModel.adjustProtectionRange("col","del",e,t),n.floatBlocksModel.removeColumns(e,t),n.embeddedBlocksModel.removeColumns(e,t);var s=a;n.getActiveColumnIndex()>=s&&n.setActiveCell(n.getActiveRowIndex(),s-1);this.updateFreezeWhenLayoutChanged({changeType:1,col:e,oldValue:a,colCount:t})}}},{key:"_setFloatBlock",value:function(e,t,r){return this.floatBlocksModel.setBlock(e,t,r)}},{key:"_delFloatBlock",value:function(e){return this.floatBlocksModel.delBlock(e)}},{key:"getFloatBlockByToken",value:function(e){return this.floatBlocksModel.getBlock(e)}},{key:"getFloatBlocksMap",value:function(){return this.floatBlocksModel.getFloatBlocksMap()}},{key:"_setEmbeddedBlock",value:function(e,t,r){return this.embeddedBlocksModel.setBlock(e,t,r)}},{key:"_delEmbeddedBlock",value:function(e){return this.embeddedBlocksModel.delBlock(e)}},{key:"getEmbeddedBlockByToken",value:function(e){return this.embeddedBlocksModel.getBlock(e)}},{key:"getEmbeddedBlocksMap",value:function(){return this.embeddedBlocksModel.getBlocksMap()}},{key:"_setDataRange",value:function(e){return this.rangeModel.setRange(e)}},{key:"_delDataRange",value:function(e){return this.rangeModel.delRange(e)}},{key:"_addChart",value:function(e,t){return this.chartModel.addChart(e,t)}},{key:"_setChart",value:function(e,t,r){return this.chartModel.setChart(e,t,r)}},{key:"_deleteChart",value:function(e){return this.chartModel.deleteChart(e)}},{key:"getChartById",value:function(e){return this.chartModel.getChartById(e)}},{key:"getChartMap",value:function(){return this.chartModel.getChartMap()}},{key:"getCellNoteJSON",value:function(e,t){return this._dataModel.getCellNoteJSON(e,t)}},{key:"_getCellNote",value:function(e,t){return this._dataModel.getCellNote(e,t)}},{key:"_setCellNote",value:function(e,t,r){return this._dataModel.setCellNote(e,t,r||null)}},{key:"getFloatImageMap",value:function(){return this.floatImageModel.getFloatImageMap()}},{key:"_addFloatImage",value:function(e,t){return this.floatImageModel.add(e,t)}},{key:"_setFloatImage",value:function(e,t,r){return this.floatImageModel.set(e,t,r)}},{key:"_deleteFloatImage",value:function(e){return this.floatImageModel.del(e)}},{key:"getFloatImageById",value:function(e){return this.floatImageModel.getFloatImageById(e)}},{key:"getAtiveFloatImageIds",value:function(){return this.floatImageModel.activeFloatImageIds}},{key:"protectionRangesToRanges",value:function(e){var t=this.getRowCount(),r=this.getColumnCount();return e.map((function(e){return function(e,t,r){return _u(e)?new ou(e.rowFrom(),0,e.rowCount(),r,e.sheet()):Ru(e)?new ou(0,e.colFrom(),t,e.colCount(),e.sheet()):e}(e,t,r)}))}},{key:"getPermissionDeniedRangeList",value:function(e){var t,r=(null===(t=this.protectionModel)||void 0===t?void 0:t.getProtectionRangesByRange(e,"denied"))||[];return this.protectionRangesToRanges(r)}},{key:"getPermissionAllowedRangeList",value:function(e){var t,r=this.parent.permissionManager.hasPermission(this.id())&&(null===(t=this.protectionModel)||void 0===t?void 0:t.getProtectionRangesByRange(e,"allowed"))||[];return this.protectionRangesToRanges(r)}},{key:"_addConditionalFormat",value:function(e,t){this.conditionalFormatModel.addRule(e,t)}},{key:"_addConditionalFormatV2",value:function(e){this.conditionalFormatModel.addRuleV2(e)}},{key:"_setConditionalFormat",value:function(e,t){this.conditionalFormatModel.setRule(e,t)}},{key:"_deleteConditionalFormat",value:function(e){this.conditionalFormatModel.deleteRule(e)}},{key:"_moveConditionalFormat",value:function(e){this.conditionalFormatModel.moveRule(e)}},{key:"getFrozenColumnCount",value:function(){return this.frozenColumnCount()}},{key:"getFrozenRowCount",value:function(){return this.frozenRowCount()}},{key:"getRowCount",value:function(){var e;return null===(e=this._dataModel)||void 0===e?void 0:e.getRowCount()}},{key:"getColumnCount",value:function(){var e;return null===(e=this._dataModel)||void 0===e?void 0:e.getColumnCount()}},{key:"setRowCount",value:function(e){if(!isNaN(e)&&!(e<0||e===this.getRowCount())){var t=this._getModel(),r=this._getRowInfos();t.setRowCount(e),r.length=e,this._getLocalRowInfos().length=e,this._activeRowIndex>=e&&this.setActiveCell(e-1,this.getActiveColumnIndex())}}},{key:"setColumnCount",value:function(e){if(!isNaN(e)&&!(e<0||e===this.getColumnCount())){var t=this._getModel(),r=this._getColInfos();t.setColumnCount(e),r.length=e,this._getLocalColInfos().length=e,this._activeColIndex>=e&&this.setActiveCell(this.getActiveRowIndex(),e-1)}}},{key:"getInternationalText",value:function(e,t){var r=this.getSegmentArray(e,t);return bg(r)?function(e){return["name","en_name"].map((function(t){return e.reduce((function(e,r){return e+(Ng(r)?"@"+r[t]:r.text)}),"")}))}(r):this.getText(e,t)}},{key:"getTextByTextWithValues",value:function(e){return e.map((function(e){return e.text})).join(s_)}},{key:"getText",value:function(e,t,r,n,a,o){if(this.options.showFormulaText&&this.hasFormula(e,t))return"=".concat(this.getFormula(e,t));var i=this.getDataValidation(e,t),u=Boolean(i&&A_(i)),s=this.getTextWithValues(e,t,u,a,o);return this.getTextByTextWithValues(s)}},{key:"getTextWithValues",value:function(e,t,r,n,a){var o=this.getImmutableContent(e,t,a);if(null==o)return[];var i=o.multipleValues,u=o.segmentArray;if(i){if(r)return function(e,t,r,n){for(var a=[],o=e.getUserFormatter(t,r),i=0;i<n.length;++i){var u=n.get(i),s=u.segmentArray,l=u.variant,c=u.autoFormatter,h=My(e.parent,{segmentArray:s,variant:l},{formatter:o||c||null});a.push({text:h,variant:l||null,segmentArray:s||null})}return a}(this,e,t,i);var s=this.getUserFormatter(e,t)||null;return[Fy(this,e,t,i.mergeToSingleValue({formatter:s}))]}if(u)return[{text:new Og(this.parent,u).getText(this.parent.userLanguage),variant:null,segmentArray:u}];var l=this.getValue(e,t,void 0,n,a);if(null==l)return[];var c="",h=this.getActualFormatter(e,t,n);return c=h instanceof Ee.Formatter?h.format(l):(0,Ee.createFormatter)(this.formatterService).format(l),(0,Ee.isString)(c)?c=c.replace(/\r\n?/g,"\n"):console.error("should be text",c),[{text:c,variant:o.variant||null,segmentArray:null}]}},{key:"formatSheetValue",value:function(e,t,r,n){var a;return a=n instanceof Ee.Formatter?n.format(r):(0,Ee.createFormatter)(this.formatterService).format(r),(0,Ee.isString)(a)||console.error("should be text",a),a}},{key:"getDefaultReminderFormatter",value:function(){if(!this._defaultReminderFormatter){var e=UC(),t=(0,Ee.createFormatter)(this.formatterService,e);this._defaultReminderFormatter=t}return this._defaultReminderFormatter}},{key:"getUserFormatter",value:function(e,t){return this.getStyle(e,t).formatter}},{key:"getCellFormatter",value:function(e,t){return aM(this.getStyle(e,t))}},{key:"setText",value:function(e,t,r){var n=this,a=r,o={value:r,sheet:this};if(la(o.value)){var i=(0,Ee.getPreferredFormatter)(o.sheet.formatterService,o.value),u=i.value;u instanceof we.SheetDate&&(u=u.toNumber()),"number"==typeof u&&(o.value=u)}var s=r=o.value,l=n.getActualFormatter&&n.getActualFormatter(e,t);if(l instanceof Ee.Formatter){var c=l.getFormatCode();c&&(s=Or(s=n.parseText(a,c))?r:s)}n.setValue(e,t,s)}},{key:"parseText",value:function(e,t){var r=Or(t),n=Or(e);if(!r&&!n){var a=(0,Ee.getPreferredFormatter)(this.formatterService,e,(0,Ee.createFormatter)(this.formatterService,t)).value;return a instanceof we.SheetDate&&(a=a.toNumber()),a}return n?"":e.toString()}},{key:"getSegmentArray",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;return 3===r?this._getModel().getSegmentArray(e,t):null}},{key:"getImmutableSegmentArray",value:function(e,t){return this._getModel().getImmutableSegmentArray(e,t)}},{key:"getMultipleValues",value:function(e,t){return this._getModel().getMultipleValues(e,t)}},{key:"getMultipleValuesJSON",value:function(e,t){var r=this._getModel().getMultipleValues(e,t);return r?r.toJSON():null}},{key:"getFormulaHyperLink",value:function(e,t){return yR(this._getModel().getImmutableContent(e,t))}},{key:"hasInternationalUserMention",value:function(e,t){return bg(this.getSegmentArray(e,t))}},{key:"getValue",value:function(e,t,r,n,a,o){if(0===r)return null;var i=this._getModel().getValue(e,t,n,o);return"number"==typeof i&&(i=rn._parseFloat(i)),i}},{key:"getRowValue",value:function(e){return e+1}},{key:"getColValue",value:function(e){return this._indexToLetters(e+1)}},{key:"getSafeValue",value:function(e,t,r){var n=this._getModel(),a=n.getImmutableContent(e,t,r);if(!a)return null;if(a.multipleValues){var o=a.multipleValues.mergeToSingleValue({formatter:this.getUserFormatter(e,t)||null}),i=o.segmentArray,u=o.variant;return i?Og.getSegmentArray4Changeset(i):u?u.getValue():null}return a.segmentArray?Og.getSegmentArray4Changeset(a.segmentArray):a.variant?n.getValue(e,t,void 0,r):null}},{key:"getChangesetValue",value:function(e,t,r){return this.isProxyArrayFormula(e,t,r)?null:this.getSafeValue(e,t,!0)}},{key:"getRangeDatas",value:function(e){for(var t=e.row,r=e.col,n=e.rowCount,a=e.colCount,o=[],i=t;i<t+n;i++){for(var u=[],s=r;s<r+a;s++)u.push(this.getPointValue(i,s));o.push(u)}return o}},{key:"getVisibleRangeDatas",value:function(e){for(var t=this.getHiddenRows(),r=this.getHiddenCols(),n=e.row,a=e.col,o=e.rowCount,i=e.colCount,u=[],s=n;s<n+o;s++)if(!t[s]){for(var l=[],c=a;c<a+i;c++)r[c]||l.push(this.getPointValue(s,c));l.length&&u.push(l)}return u.length?u:null}},{key:"isHiddenRange",value:function(e){if(e.type===Ce.xj7.ALL||e.type===Ce.xj7.INVALID)return!1;for(var t=e.row,r=void 0===t?0:t,n=e.col,a=void 0===n?0:n,o=e.rowCount,i=void 0===o?this.getRowCount():o,u=e.colCount,s=void 0===u?this.getColumnCount():u,l=this.getHiddenRows(),c=this.getHiddenCols(),h=r;h<r+i;h++)for(var f=a;f<a+s;f++)if(!l[h]&&!c[f])return!1;return!0}},{key:"getPointValue",value:function(e,t){var r=this.getActualFormatter(e,t)||(0,Ee.createFormatter)(this.formatterService),n=0,a=By(Wy(this.parent,r.getFormatCode()));return a?n=a.type:(0,Ee.isDateTimeFormatter)(r)&&(n=5),{value:this.getValue(e,t),text:this.getText(e,t),type:n,row:e,col:t,sheetId:this.id()}}},{key:"getAllReminders",value:function(){return this._dataModel.getAllReminders()}},{key:"getReminder",value:function(e,t){return this._dataModel.getReminder(e,t)}},{key:"getReminderJSON",value:function(e,t){var r=this._getModel().getReminder(e,t);return r?r.toJSON():null}},{key:"getReminderChangeset",value:function(e,t){var r=this.getReminder(e,t);return r&&r.toChangeset()||null}},{key:"_setReminder",value:function(e,t,r){this._dataModel.setReminder(e,t,r)}},{key:"getReminderCount",value:function(){return this._dataModel.getReminderCount()}},{key:"iterReminder",value:function(e,t,r,n){return this._dataModel.iterReminder(e,t,r,n)}},{key:"getColHeaderWidth",value:function(){return this.lastRowHeaderWidth||this._getSheetRowHeaderWidth()}},{key:"getRowHeaderHeight",value:function(){return this._getSheetColHeaderHeight()}},{key:"getActualFormatter",value:function(e,t,r,n){return rM(this.getReminder(e,t),this.getCellStyle(e,t),this.getImmutableContent(e,t),this,n)}},{key:"getReminderFormatter",value:function(e,t){return nM(this.getStyle(e,t),this)}},{key:"getCellHAlign",value:function(e,t,r){if(r||(r=this.getImmutableStyle(e,t)),this.options.showFormulaText&&this.hasFormula(e,t))return Ce.KqL.Left;var n=r.hAlign;if(!(0,re.Z)(n)&&n!==Ce.KqL.General)return n;var a=this.getDataValidation(e,t);if(a){var o=this.getDataValidationHorizontalAlign(a,e,t);if(o)return o}return this.getReminder(e,t)?Ce.KqL.Left:r.toFasterHAlign(this._dataModel.getVar(e,t))}},{key:"hitViewPortOrHeader",value:function(e){return 2===e||1===e||3===e}},{key:"getActualStyle",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3?arguments[3]:void 0;if(!this.hitViewPortOrHeader(r))return new Om;if(-1===e&&-1===t)return this.getDefaultStyle(r);var a=this._getModel().getStyle(e,t,n);return this._getCompositeStyle(e,t,r,a)}},{key:"getActualStylePure",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3?arguments[3]:void 0;return 0===r||-1===e&&-1===t?null:this._getModel().getStyle(e,t,n)}},{key:"getStyleWithConditionalFormat",value:function(e,t){var r=this.getActualStyle(e,t);return this.updateConditionFormatStyle(e,t,r)}},{key:"updateConditionFormatStyle",value:function(e,t,r){if(this.conditionalFormatModel&&this.conditionalFormatModel.hasRules()){var n=this.conditionalFormatModel.getCellStyle(e,t);if(n&&YT(n)){var a,o,i={};if(n.font){var u={};n.font.includes("italic")&&(u.fontStyle="italic"),n.font.includes("bold")&&(u.fontWeight=700),i.fontInfo=u}n.foreColor&&(i.foreColor=n.foreColor),n.backColor&&(i.backColor=n.backColor),n.textDecoration&&(i.textDecoration=(null!==(a=n.textDecoration)&&void 0!==a?a:Ce.aBM.none)|(null!==(o=null==r?void 0:r.textDecoration)&&void 0!==o?o:Ce.aBM.none));var s=r||this.getDefaultStyle();return Om.withUpdateStyle(s,i)}}return r}},{key:"getStyleWithDropdownAndConditionalFormat",value:function(e,t){var r=this.getDropdown(e,t),n=this.getStyleWithConditionalFormat(e,t);return r||n?(n=n||this.getDefaultStyle(),n=r&&r.list?Om.withDropdown(n,r):Om.withDropdown(n,void 0,!0)):null}},{key:"_getStyleProperty",value:function(e,t,r,n){var a=this.getActualStyle(e,t,n)[r];return"locked"===r&&!!Or(a)||a}},{key:"getStyle",value:function(e,t,r,n){return this._getStyleImp(e,t,r,n)||this.getDefaultStyle().clone()}},{key:"getPureStyle",value:function(e,t,r,n){return this._getStyleImp(e,t,r,n)}},{key:"getCellStyle",value:function(e,t,r,n){if(0!==r){var a=this._getModel().getCellStyle(e,t,n);if(!Or(a))return a}return null}},{key:"getActiveCellStyle",value:function(){var e=this.getActiveCellIndex(),t=e.row,r=e.column;return this.getStyle(t,r)}},{key:"getStyleWithoutPartialStyle",value:function(e,t){return this._getModel().getStyleWithoutPartialStyle(e,t)||this.getDefaultStyle().clone()}},{key:"getImmutableStyle",value:function(e,t,r){return this._getStyleImp(e,t,3,r)||this.getDefaultStyle(3)}},{key:"_getStyleImp",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3?arguments[3]:void 0;if(0!==r){var a=this._getModel().getStyle(e,t,n);if(!Or(a))return a}return null}},{key:"setStyle",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this._dataModel.setStyle(e,t,r)}},{key:"getDataValidationId",value:function(e,t){return this.dataValidationService.getDataValidationId(e,t)}},{key:"getDataValidation",value:function(e,t){return this.dataValidationService.getDataValidation(e,t)}},{key:"getDataValidationJSON",value:function(e,t,r,n){return this.dataValidationService.getDataValidationJSON(e,t,r,n)}},{key:"getValidationRefCount",value:function(){return this._getModel().getValidationRefCount()}},{key:"setDataValidation",value:function(e,t,r){var n=this._getModel();null!=r&&this.setDropdown(e,t,null),n.setDataValidation(e,t,r)}},{key:"hasCheckbox",value:function(e,t){return this.dataValidationService.hasCheckbox(e,t)}},{key:"iterDataValidation",value:function(e,t,r,n){return this._getModel().iterDataValidation(e,t,r,n)}},{key:"getDropdown",value:function(e,t){return this._getModel().getDropdown(e,t)}},{key:"iterDropdown",value:function(e,t,r,n){return this._getModel().iterDropdown(e,t,r,n)}},{key:"iterStyle",value:function(e,t,r,n){return this._getModel().iterStyle(e,t,r,n)}},{key:"iterStyleWithPos",value:function(e,t,r,n){return this._getModel().iterStyleWithPos(e,t,r,n)}},{key:"hasContent",value:function(e,t){return this._getModel().hasContent(e,t)}},{key:"hasMultipleValues",value:function(e,t){return this._getModel().hasMultipleValues(e,t)}},{key:"getStyleWithDropdown",value:function(e,t,r){var n=this.getDropdown(e,t),a=this.getStyle(e,t,void 0,r);return n||a?(a=a||this.getDefaultStyle(),a=n&&n.list?Om.withDropdown(a,n,!0):Om.withDropdown(a,void 0,!0)):null}},{key:"setDropdown",value:function(e,t,r){if(!(e<0||t<0)){var n=this._getModel();null!=r&&this.setDataValidation(e,t,null),n.setDropdown(e,t,r),this.chartModel.setValue(e,t),this._raiseCellChanged()}}},{key:"_setStyleWithoutLocked",value:function(e,t,r,n){this.setStyle(e,t,r)}},{key:"_getStyleObject",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=null;return 0!==r&&(n=this._getModel().getStyle(e,t)),n}},{key:"setStyleById",value:function(e,t,r){var n=this._getModel(),a=fM(n),o=hM(n);e<-1||e>=a||t<-1||t>=o||n.setStyleById(e,t,r)}},{key:"setDataValidationById",value:function(e,t,r){var n=this._getModel(),a=fM(n),o=hM(n);e<-1||e>=a||t<-1||t>=o||n.setDataValidationById(e,t,r)}},{key:"getRangeByRowCol",value:function(e,t){return-1===e&&-1===t?new au(this):-1===e?new nu(t,1,this):-1===t?new iu(e,1,this):new ou(e,t,1,1,this)}},{key:"getDefaultStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=this,r=t._composedDefaultStyle,n=r[e];if(n)return n;var a=t._getModel(),o=a.getDefaultStyle();return o||(o=Mm(),a.setDefaultStyle(o)),r[e]=o,o}},{key:"setDefaultStyle",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=this;0!==t&&r._getModel().setDefaultStyle(Object.freeze(e)),r._composedDefaultStyle[t]=null}},{key:"getCellPadding",value:function(){return this.defaults.cellPadding||e._defaultCellPadding}},{key:"getLineHeightFactor",value:function(){return this.defaults.lineHeightFactor||1.5}},{key:"getInlineAlign",value:function(){return"boolean"!=typeof this.defaults.inlineAlign||this.defaults.inlineAlign}},{key:"getDataValidationHorizontalAlign",value:function(e,t,r){return"checkbox"===e.type&&e.checkCellValid(t,r).getValue()?Ce.KqL.Center:null}},{key:"_getCompositeStyle",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=this;if(!this.hitViewPortOrHeader(r))return Om.EMPTY;var i=o._getModel(),u=fM(i),s=hM(i),l=o.getDefaultStyle(r);if(0<=e&&e<u&&0<=t&&t<s){var c=void 0!==n?n:i.getStyle(e,t,a);if(c)return Om.composeStyles(l,c)}return l}},{key:"_addSpanImp",value:function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,o=this,i=o._getSpanModel(a),u=new ou(e,t,r,n,o);if(u.rowCount()*u.colCount()<=1)return!1;var s=u;if(i.addSpan(s),3===a){var l=o._selectionModel;if(l){for(var c=this.getSelections(),h=0;h<c.length;h++)c[h].isIntersect(new ou(e,t,r,n,o))&&(c[h]=c[h].union(u));l.fromArray(c)}}return!0}},{key:"addSpan",value:function(e,t,r,n,a){if(!(1===r&&1===n||void 0!==a&&!this.hitViewPortOrHeader(a))){var o=this._getSpanModel(a),i=o.getIntersectSpansInfo(e,t,r,n);if(i.hasPartSpans.size>0)return console.error("Invalid Span ".concat(e," ").concat(t," ").concat(r," ").concat(n)),void console.error("SpanModel ".concat(JSON.stringify(o)));i.containedSpans.forEach((function(e){o.remove(e)})),this._addSpanImp(e,t,r,n,a)}}},{key:"spansFromJSON",value:function(e){this._getSpanModel().fromJSON(e)}},{key:"clearSpans",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return this._getSpanModel(t).clearAll(e)}},{key:"removeSpan",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=this._getSpanModel(r),a=n.find(e,t);a&&n.remove(a)}},{key:"hasSpans",value:function(e,t,r,n){return this._getSpanModel().hasSpans(e,t,r,n)}},{key:"getSpans",value:function(e,t,r){return void 0===t||this.hitViewPortOrHeader(t)?this._getSpanModel(t).getSpans(e,r):[]}},{key:"getSpan",value:function(e,t,r){return void 0===r||this.hitViewPortOrHeader(r)?this._getSpanModel(r).find(e,t):null}},{key:"setEmptyPivotTableSpan",value:function(e){this.removeSpan(e.rowFrom(),e.colFrom()),this._getSpanModel().addSpan(e,!0)}},{key:"removeEmptyPivotTableSpan",value:function(e){this._getSpanModel().removePivotRange(e)}},{key:"_setActiveCellCore",value:function(e,t,r){var n,a,o=this._activeRowIndex,i=this._activeColIndex,u=!1;Or(e)||(this._activeRowIndex=e,u=!0),Or(t)||(this._activeColIndex=t,u=!0),r||(this._firstTabCol=void 0);var s=o!==e||i!==t,l=this._isFirstSetFocus;u&&(s||l)&&(l&&(this._isFirstSetFocus=!1),this.dispatch("ActiveCellChanged",{sheetId:this.id(),row:null!==(n=e)&&void 0!==n?n:0,col:null!==(a=t)&&void 0!==a?a:0}))}},{key:"_setActiveCellImp",value:function(e,t,r,n){var a=this,o=fM(a),i=hM(a);if(e<0){e=0;for(var u=a._getSpanModel().get(e,t);u.rowCount()>1||u.colCount()>1;)e+=1,u=a._getSpanModel().get(e,t)}else e>=o&&(e=o-1);if(t<0){t=0;for(var s=a._getSpanModel().get(e,t);s.rowCount()>1||s.colCount()>1;)t+=1,s=a._getSpanModel().get(e,t)}else t>=i&&(t=i-1);var l=a._getSpanModel().get(e,t);a._activeRowCount=l.rowCount(),a._activeColCount=l.colCount(),a._activeRowViewportIndex=r,a._activeColViewportIndex=n,a._setActiveCellCore(l.rowFrom(),l.colFrom()),a._leadingCellRow=e,a._leadingCellCol=t}},{key:"setActiveCell",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.rowViewportIndex,a=r.colViewportIndex,o=r.source,i=r.clearSelection,u=void 0===i||i,s=r.setSelection,l=void 0===s||s,c=r.triggerEvent,h=void 0===c||c;if(this.parent.apiHookManager.getHooks(2).every((function(r){return r(e,t)}))){var f=this.getSelections();this._selectionModel&&this._setActiveCellAndSelection(e,t,{rowViewportIndex:n,colViewportIndex:a,source:o,clearSelection:u,setSelection:l});var d=this.getSelections();h&&this._raiseSelectionChanging(f,d)&&this._raiseSelectionChanged(f,o)}}},{key:"_setActiveCellAndSelection",value:function(e,t,r){var n=r.rowViewportIndex,a=r.colViewportIndex,o=r.source,i=r.clearSelection,u=void 0===i||i,s=r.setSelection,l=void 0===s||s,c=this,h=c.getSelections()[0],f=fM(c),d=hM(c);if(e<0?e=0:e>=f&&(e=f-1),t<0?t=0:t>=d&&(t=d-1),u&&c._clearSelectionImp(),c._setActiveCellImp(e,t,n,a),l){var v=c._getSpanModel().get(e,t).clone();!h||"ADD_ROW"!==o&&"ADD_COL"!==o&&"DEL_ROW"!==o&&"DEL_COL"!==o||(v.setRowCount(h.rowCount()),v.setColCount(h.colCount())),c._setSelectedRange(v)}}},{key:"getActiveRowIndex",value:function(){return this._activeRowIndex}},{key:"getActiveColumnIndex",value:function(){return this._activeColIndex}},{key:"getActiveCellIndex",value:function(){return{row:this.getActiveRowIndex(),column:this.getActiveColumnIndex()}}},{key:"_setRowColInfo",value:function(e,t,r,n){var a,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:3,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,u=n?this._getRowInfos(o):this._getColInfos(o);switch(r){case"visible":a=u.getVisible(e),u.setVisible(e,t,i);break;case"height":case"width":a=u.getSize(e),u.setSize(e,t,i);break;case"fId":a=u.getFId(e),u.setFId(e,t)}return this.chartModel.setRowColInfoChange(e,n?"row":"col"),{value:t,oldValue:a}}},{key:"_getRowColInfo",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3,a=r?this._getRowInfos(n):this._getColInfos(n);if("fId"===t)return a.getFId(e)}},{key:"getRowHeight",value:function(e){return!this.filterModel.isVisible(e)||this.isHiddenByOutlineGroup("row",e)?0:this._getRowInfos().getSize(e)}},{key:"getColWidth",value:function(e){return this.isHiddenByOutlineGroup("col",e)?0:this._getColInfos().getSize(e)}},{key:"getForceRowHeight",value:function(e){return!this.filterModel.isVisible(e)||this.isHiddenByOutlineGroup("row",e)?0:null}},{key:"getForceColWidth",value:function(e){return this.isHiddenByOutlineGroup("col",e)?0:null}},{key:"_getActualRowHeight",value:function(e,t){return this._rowInfos.getActualSize(e)}},{key:"needAutoRowHeight",value:function(e){return 0===this._rowInfos.getActualSize(e)}},{key:"setAutoRowHeight",value:function(e,t){var r=Math.max(t,this.defaults.rowHeight);return this._rowInfos.setAutoFitSize(e,r)}},{key:"setRowHeight",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=this._setRowColInfo(e,t,"height",!0,r,a);return n&&this._localRowInfos.setSize(e,t,a),o}},{key:"setRowColProperty",value:function(e,t,r,n){var a=this;Object.keys(t).forEach((function(o){var i=t[o];a._setRowColInfo(e,i,o,r,n)}))}},{key:"getRowColProperty",value:function(e,t,r,n){return this._getRowColInfo(e,t,r,n)}},{key:"getRowVisible",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3;return!(!t&&!this.filterModel.isVisible(e))&&!this.isHiddenByOutlineGroup("row",e)&&this._getRowInfos(r).getVisible(e)}},{key:"setRowVisible",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=this,o=a._setRowColInfo(e,t,"visible",!0,r,n);return a.chartModel.setRowColVisible(e,t,"row"),o}},{key:"getColVisible",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;return!this.isHiddenByOutlineGroup("col",e)&&this._getColInfos(t).getVisible(e)}},{key:"isRowOrColHidden",value:function(e,t){return!(t?this._getRowInfos():this._getColInfos()).getVisible(e)}},{key:"getCellWidth",value:function(e,t,r){if(!r)return this.getColumnWidth(t);var n=this.getSpan(e,t,3);if(!n||n.colCount()<=1)return this.getColumnWidth(t);for(var a=0,o=0;o<n.colCount();o++)a+=this.getColumnWidth(t+o);return a}},{key:"getCellHeight",value:function(e,t,r){if(!r)return this.getRowHeight(e);var n=this.getSpan(e,t,3);if(!n||n.rowCount()<=1)return this.getRowHeight(e);for(var a=0,o=0;o<n.rowCount();o++)a+=this.getRowHeight(e+o);return a}},{key:"getColumnWidth",value:function(e){return this._getColInfos().getSize(e)}},{key:"localRowHeightChanged",value:function(e,t){for(var r=e;r<e+t;r++)if(this._localRowInfos.getRawSize(r))return!0;return!1}},{key:"localColumnWidthChanged",value:function(e,t){for(var r=e;r<e+t;r++)if(this._localColInfos.getRawSize(r))return!0;return!1}},{key:"getRowByFId",value:function(e){return this._getRowInfos().getRowColIndexByFId(e)}},{key:"getColByFId",value:function(e){return this._getColInfos().getRowColIndexByFId(e)}},{key:"_getSheetRowHeaderWidth",value:function(){return this.defaults.rowHeaderColWidth}},{key:"_getSheetColHeaderHeight",value:function(){return this.defaults.colHeaderRowHeight}},{key:"_getActualColumnWidth",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=this.defaults,n=r.colWidth;2===t&&(n=r.rowHeaderColWidth);var a=this._getColInfos(t).getActualSize(e);return a||0===a?a:n}},{key:"setColumnWidth",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,o=this._setRowColInfo(e,t,"width",!1,r,a);return n&&this._localColInfos.setSize(e,t,a),o}},{key:"getColumnVisible",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=this;return!r.isHiddenByOutlineGroup("col",e)&&r._getColInfos(t).getVisible(e)}},{key:"setColumnVisible",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=this,o=a._setRowColInfo(e,t,"visible",!1,r,n);return a.chartModel.setRowColVisible(e,t,"col"),o}},{key:"getViewportTopRow",value:function(e){var t=vM(this);return 0===e?0:1===e?Math.max(t,0):2===e?Math.max(t,fM(this)):-1}},{key:"getViewportLeftColumn",value:function(e){var t=dM(this);return 0===e?0:1===e?Math.max(t,0):2===e?Math.max(t,hM(this)):-1}},{key:"_getRowViewportIndex",value:function(e){var t=1;return e<vM(this)?t=0:e>=fM(this)&&(t=2),t}},{key:"_getColumnViewportIndex",value:function(e){var t=1;return e<dM(this)?t=0:e>=hM(this)&&(t=2),t}},{key:"suspendEvent",value:function(){this._eventSuspended++}},{key:"resumeEvent",value:function(){this._eventSuspended--,this._eventSuspended<0&&(this._eventSuspended=0)}},{key:"isEventSuspended",value:function(){return this._eventSuspended>0}},{key:"reset",value:function(){this._resetImp()}},{key:"getLogger",value:function(){return this.parent?this.parent.logger:console}},{key:"_resetImp",value:function(){var t,r=this;r._initializeActiveCell(),r._activeRowViewportIndex=0,r._activeColViewportIndex=0,r.defaults={rowHeight:e._defaultRowHeight,colWidth:e._defaultColWidth,rowHeaderColWidth:e._defaultRowHeaderColWidth,colHeaderRowHeight:e._defaultColHeaderRowHeight},r._initOptions(),r._scrollTopRow=0,r._scrollLeftCol=0,r.frozenRowCount(0),r.frozenColumnCount(0),r._composedDefaultStyle={},r._dataModel=t=new TA(e._defaultRowCount,e._defaultColCount,r),r._rowHeaderModel=new iM(t.getRowCount(),e._defaultRowHeaderColumnCount,r),r._colHeaderModel=new iM(e._defaultColHeaderRowCount,t.getColumnCount(),r),r._rowInfos=new tI((function(){return r.defaults.rowHeight}),e._defaultRowCount,(function(e){return r.getForceRowHeight(e)}),50),r._localRowInfos=new tI((function(){return r.defaults.rowHeight}),e._defaultRowCount,(function(e){return r.getForceRowHeight(e)}),50),r._colInfos=new tI((function(){return r.defaults.colWidth}),e._defaultColCount,(function(e){return r.getForceColWidth(e)}),120),r._localColInfos=new tI((function(){return r.defaults.colWidth}),e._defaultColCount,(function(e){return r.getForceColWidth(e)}),120),r._colHeaderRowInfos=new tI((function(){return r.defaults.colHeaderRowWidth}),r.defaults._defaultColHeaderRowCount,void 0,50),r._rowHeaderColInfos=new tI((function(){return r.defaults.rowHeaderColWidth}),r.defaults._defaultRowHeaderColumnCount,void 0,120),r._spanModel=new DA(r),r._colHeaderSpanModel=new DA(r),r._rowHeaderSpanModel=new DA(r),r.cellModel=new uI(r),r._eventSuspended=0,r._dirtySuspended=0,r._disposed=!1}},{key:"_initOptions",value:function(){var e=this;uM.each(pM,(function(t,r){if(!Or(r)){var n=r;"object"==(0,R.Z)(n)&&(n=uM.extend({},r)),e.options[t]=n}}))}},{key:"_initStyle",value:function(){var e=this.getDefaultStyle(),t=e,r=!0;this.parent&&this.parent.defaultStyle?(r=!1,t=Om.fromJSON(this.parent.formatterService,this.parent.defaultStyle,t)):this.defaults.style&&(r=!1,t=Om.fromJSON(this.parent.formatterService,this.defaults.style)),r||(e.equals(t)||(t=Om.composeStyles(e,t)),t.setDefault(t),this.setDefaultStyle(t))}},{key:"_onAttached",value:function(e){var t=this;t.parent=e,t._eventSuspended=e._eventSuspended||0,Object.assign(this.defaults,this.parent?this.parent.defaults:{}),t._initStyle()}},{key:"_canChange",value:function(e,t,r,n,a){var o=this;return!o.options.isProtected||!o._isAnyCellInRangeLocked(new ou(e,t,r,n,o))||(a&&o._raiseInvalidOperation(1,a),!1)}},{key:"checkRangesProtected",value:function(e){var t=Array.isArray(e)?e:[e];return!this.protectionModel.getRangePermissions(t).hasPermission}},{key:"checkCellProtected",value:function(e,t){var r=this.getParent();return!(!r||!r.permissionManager||r.permissionManager.hasPermission(this.id()))||!this.protectionModel.getRangePermissions([new ou(e,t,1,1,this)]).hasPermission}},{key:"isCellEditable",value:function(e,t){return!this.options.isProtected&&!this.checkCellProtected(e,t)}},{key:"checkRowProtected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return!this.protectionModel.getRangePermissions([new iu(e,t,this)]).hasPermission}},{key:"checkColProtected",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return!this.protectionModel.getRangePermissions([new nu(e,t,this)]).hasPermission}},{key:"setValue",value:function(e,t,r,n){var a=this._getModel(),o=this.getImmutableContent(e,t);return r instanceof l_?(a.setMultipleValues(e,t,r,null),void this.notifyValueChange(e,t,o)):Array.isArray(r)?(a.setSegmentArray(e,t,r,null),void this.notifyValueChange(e,t,o)):(a.setVar(e,t,r,n,null),void this.notifyValueChange(e,t,o))}},{key:"notifyValueChange",value:function(e,t,r){var n;this.chartModel.setValue(e,t);var a=(null==r?void 0:r.segmentArray)||null,o=(null===(n=this.getImmutableContent(e,t))||void 0===n?void 0:n.segmentArray)||null;(a||o)&&this._raiseSegmentChangedIgnoreSuspended(e,t,3,a,o),this.isEventSuspended()||this._raiseCellChanged()}},{key:"getFormula",value:function(e,t,r,n){return this._getModel().getFormula(e,t,r,n)}},{key:"getFormulaData",value:function(e,t,r,n,a){return this._getModel().getFormulaData(e,t,r,n,a)}},{key:"getImportRangeData",value:function(e,t,r){var n=this.getVar(e,t);if(!n.isFormula())return null;var a=this.getParent().importRangeManager;if(!dv(n))return null;var o=a.getMetaFromFormula(n);return o?{importRangeId:o.importRangeId,spreadToken:o.spreadToken,ref:o.ref,isSyncStyle:!1,spreadSource:o.spreadSource}:null}},{key:"getHasFormulaByRange",value:function(e){var t=e.rowFrom(),r=e.rowCount(),n=e.colFrom(),a=e.colCount();return null!==this._getModel().iterContent(t,n,r,a).first_if((function(e){return!(!e.variant||!e.variant.isFormula())}))}},{key:"getHasFormulaOrArrayFormulaByRange",value:function(e){var t=e.rowFrom(),r=e.rowCount(),n=e.colFrom(),a=e.colCount();return null!==this._getModel().iterContent(t,n,r,a).first_if((function(e){return!(!e.variant||!e.variant.isFormula()&&!jp(e.variant))}))}},{key:"hasImportRangeByRange",value:function(e){for(var t=this.parent.importRangeManager.getImportRangeFormulas(),r=0;r<t.length;r++){var n=t[r];if(Wp(n)&&1===n.canArrayExpand().arrayFormulaCanExpand){var a=n.getArrayRef();if(a&&a.isIntersect(e))return!0}}return!1}},{key:"getHasAllKindFormulaByRange",value:function(e){return this.hasImportRangeByRange(e)||this.getHasFormulaOrArrayFormulaByRange(e)}},{key:"getFormulaCountByRange",value:function(e){var t=e.rowFrom(),r=e.rowCount(),n=e.colFrom(),a=e.colCount();return this._getModel().iterContent(t,n,r,a).reduce((function(e,t){return e.variant&&e.variant.isFormula()?t+1:t}),0)}},{key:"unRegisterFmlByRange",value:function(e,t,r,n){for(var a=this.getCalcEngine().formulaSpace,o=this._getModel().iterContent(e,t,r,n),i=o.next();null!==i;i=o.next())if(i){var u=i.variant;u&&u.isFormula()&&a.unRegisterFml(u)}}},{key:"hasFormula",value:function(e,t){if(void 0!==e&&void 0!==t){var r=this.getVar(e,t);return!!r&&r.isFormula()}for(var n=this.getRowCount(),a=this.getColumnCount(),o=0;o<n;o++)for(var i=0;i<a;i++){var u=this.getVar(o,i);if(u&&u.isFormula())return!0}return!1}},{key:"isArrayFormula",value:function(e,t){return this._getModel().isArrayFormula(e,t)}},{key:"isProxyArrayFormula",value:function(e,t,r){return this._getModel().isProxyArrayFormula(e,t,r)}},{key:"getImmutableContent",value:function(e,t,r){return this._dataModel.getImmutableContent(e,t)}},{key:"getVar",value:function(e,t,r){return this._dataModel.getVar(e,t,r)}},{key:"iterContent",value:function(e,t,r,n,a){return this._getModel().iterContent(e,t,r,n,a)}},{key:"iterContentWithPos",value:function(e,t,r,n,a){return this._getModel().iterContentWithPos(e,t,r,n,a)}},{key:"removeComposedStyleCache",value:function(e,t,r,n){this._dataModel.removeComposedStyleCache(e,t,r,n)}},{key:"getParent",value:function(){return this.parent}},{key:"suspendDirty",value:function(){this._dirtySuspended++,this._getModel()._dirtySuspended++}},{key:"resumeDirty",value:function(){var e=this,t=e._getModel();e._dirtySuspended--,t._dirtySuspended--,e._dirtySuspended<0&&(e._dirtySuspended=0,t._dirtySuspended=0)}},{key:"isDirtySuspended",value:function(){return this._dirtySuspended>0}},{key:"markSheetDirty",value:function(){var e=this,t=this.parent.getCalcEngine(),r=new au(this);t.markDirty([r],{isDirtyAlwaysCalc:!0,validator:{validateFn:function(t){var r;return t instanceof lv&&!t.isDirty()&&!(null!==(r=e.parent.formulaCacheManager)&&void 0!==r&&r.isFormulaCached(t))},isValidateAll:!0}})}},{key:"_isValidSheetName",value:function(e){if(!e||""===e)return!1;var t,r;for(r=0;r<e.length;r++)if("*"===(t=e.charAt(r))||":"===t||"["===t||"]"===t||"?"===t||"\\"===t||"/"===t)return!1;var n=this.parent;if(!n)return!0;var a=n.sheets,o=a.length;for(r=0;r<o;r++){var i=a[r];if(i!==this&&e===i._name)return!1}return!0}},{key:"_init",value:function(e,t){this._name=e,this._hidden=t||!1,this._resetImp(),this._selectionModel=new $A(this)}},{key:"_dispose",value:function(e){var t,r=this.inject(_I),n=this,a=n.parent.options;n._firstTabCol=void 0,!1!==e?r.lifeCycle$.next({type:"destroy"}):r.lifeCycle$.next({type:"deactive"}),!1!==e&&(n._disposed=!0,n.$watcher.destroy(),n._disposeUserEvents(),n.sheetIOC.get($I).destroy(),n.viewsModel.destroy(),n.conditionalFormatModel&&(n.conditionalFormatModel.destroy(),delete n.conditionalFormatModel),delete n.parent,this.getSparklineModel().getDataManager().dispose(),this._colHeaderModel.sparklineModel.getDataManager().dispose(),this._rowHeaderModel.sparklineModel.getDataManager().dispose(),delete n._dataModel,delete n._rowHeaderModel,delete n._colHeaderModel,delete n._rowInfos,delete n._colInfos,delete n._colHeaderRowInfos,delete n._rowHeaderColInfos,delete n._spanModel,delete n._colHeaderSpanModel,delete n._rowHeaderSpanModel,delete n.chartModel,delete n.rangeModel,delete n.floatImageModel,delete n.sheetFilterModel,delete n._dataModel,delete n.cellModel,n.protectionModel&&!a.remainUserPerms&&(n.protectionModel.destroy(),delete n.protectionModel),null!==(t=this._pivotTableManagerV2)&&void 0!==t&&t.dispose(),this._pivotTableManagerV2=void 0,this.sheetIOC.unbindAll())}},{key:"_getModel",value:function(){return this._dataModel}},{key:"_getRowInfos",value:function(e){return 1===e||0===e?this._colHeaderRowInfos:this._rowInfos}},{key:"_getColInfos",value:function(e){return 2===e||0===e?this._rowHeaderColInfos:this._colInfos}},{key:"_getLocalColInfos",value:function(){return this._localColInfos}},{key:"_getLocalRowInfos",value:function(){return this._localRowInfos}},{key:"resetPivotTableManager",value:function(){this._pivotTableManagerV2||(this._pivotTableManagerV2=this.inject(UV))}},{key:"getPivotTableManager",value:function(){return this.getPivotTableManagerV2()}},{key:"getPivotTableManagerV2",value:function(){return this._pivotTableManagerV2||(this._pivotTableManagerV2=this.inject(UV)),this._pivotTableManagerV2}},{key:"getHiddenCols",value:function(){var e=this.getHiddenSeries(this._colInfos),t=this.outlineGroupModel.colHiddenSet;return t&&t.forEach((function(t){return e[t]=!0})),e}},{key:"getHiddenRows",value:function(){var e=this.filterModel.hasFilter()&&this.filterModel.getAllFilteredOutRows(),t=this.getHiddenSeries(this._rowInfos);e&&e.forEach((function(e){return t[e]=!0}));var r=this.outlineGroupModel.rowHiddenSet;return r&&r.forEach((function(e){return t[e]=!0})),t}},{key:"getHiddenSeries",value:function(e){var t={};return e.iterHidden().forEach((function(e){for(var r=e.index,n=e.count,a=r;a<r+n;a++)t[a]=!0})),t}},{key:"updateExcludedRows",value:function(){this._getRowInfos().updateExcluded(this.getExcludedRows())}},{key:"updateExcludedCols",value:function(){this._getColInfos().updateExcluded(this.getExcludedCols())}},{key:"getVisibleRowCount",value:function(e,t){return this._getVisibleAxisCount(e,t,!0)}},{key:"getVisibleColCount",value:function(e,t){return this._getVisibleAxisCount(e,t,!1)}},{key:"getHiddenRowCount",value:function(){return this._getRowInfos().iterHidden().reduce((function(e,t){return t+e.count}),0)}},{key:"getHiddenColCount",value:function(){return this._getColInfos().iterHidden().reduce((function(e,t){return t+e.count}),0)}},{key:"getFirstVisibleCellIndex",value:function(){var e=this._getFirstVisualRow(),t=this._getFirstVisualColumn();return{row:null===e?0:e,col:null===t?0:t}}},{key:"getExcludedRows",value:function(){var e=this.filterModel.getAllFilteredOutRows(),t=this.outlineGroupModel.rowHiddenSet;return new Set([].concat((0,m.Z)(e),(0,m.Z)(t)))}},{key:"getExcludedCols",value:function(){return this.outlineGroupModel.colHiddenSet}},{key:"_getVisibleAxisCount",value:function(e,t,r){return(r?this._getRowInfos():this._getColInfos()).iter(e,t).reduce((function(e,t){return e.value>0?t+e.count:t}),0)}},{key:"_isActiveCell",value:function(e,t){var r=this;return r._activeRowIndex<=e&&e<r._activeRowIndex+r._activeRowCount&&r._activeColIndex<=t&&t<r._activeColIndex+r._activeColCount}},{key:"_isColumnSelected",value:function(e){var t=this._selectionModel;return!!t&&t._isColumnSelected(e)}},{key:"_isRowSelected",value:function(e){var t=this._selectionModel;return!!t&&t._isRowSelected(e)}},{key:"_isSelected",value:function(e,t,r,n){var a=this,o=a._selectionModel;if(!o)return!1;var i=fM(a),u=hM(a);try{return o._isSelected(e,t,r,i,u,n)}catch(e){Ce.Ps3.moirae.ravenCatch(e),Ce.Ps3.collectSuiteEvent("deprecated_func_invoked",{func_name:"selectionModel._isSelected",message:e.message})}}},{key:"_isAllSelected",value:function(e,t,r){var n=this,a=n._selectionModel;if(!a)return!1;var o=fM(n),i=hM(n);try{return a._isAllSelected(e,t,r,o,i)}catch(e){Ce.Ps3.moirae.ravenCatch(e),Ce.Ps3.collectSuiteEvent("deprecated_func_invoked",{func_name:"selectionModel._isAllSelected",message:e.message})}}},{key:"_indexToLetters",value:function(e){for(var t="A".charCodeAt(0),r="";e>0;e=parseInt(((e-1)/26).toString(),10),10){var n=(e-1)%26;r=String.fromCharCode(t+n)+r}return r}},{key:"_getElem",value:function(){return this._$elem||(this._$elem=uM(Zm("input"))),this._$elem}},{key:"_initializeActiveCell",value:function(){var e=this;e._activeRowIndex=0,e._activeColIndex=0,e._activeRowCount=1,e._activeColCount=1,e._leadingCellRow=0,e._leadingCellCol=0}},{key:"_getFirstVisibleAxisIndex",value:function(e,t,r){return(r?this._getRowInfos():this._getColInfos()).iterEachActualVisible(e,t).first()}},{key:"_getLastVisibleAxisIndex",value:function(e,t,r){return(r?this._getRowInfos():this._getColInfos()).iterEachActualVisible(e,t,!0).first()}},{key:"_getFirstVisualColumn",value:function(){var e=fM(this)-1;return this._getFirstVisibleAxisIndex(0,e,!1)}},{key:"_getNextVisualColumn",value:function(e){var t=hM(this)-1;return this._getFirstVisibleAxisIndex(e+1,t,!1)}},{key:"_getPrevVisualColumn",value:function(e,t){var r=dM(this);return e>r?this._getLastVisibleAxisIndex(r,e-1,!1):null}},{key:"_getFirstVisualRow",value:function(){var e=fM(this)-1;return this._getFirstVisibleAxisIndex(0,e,!0)}},{key:"_getNextVisualRow",value:function(e){var t=fM(this)-1;return this._getFirstVisibleAxisIndex(e+1,t,!0)}},{key:"_getPrevVisualRow",value:function(e,t,r){var n=r?0:vM(this);return e>n?this._getLastVisibleAxisIndex(n,e-1,!0):null}},{key:"_getSpanModel",value:function(e){return Or(e)||3===e?this._spanModel:1===e?this._colHeaderSpanModel:2===e?this._rowHeaderSpanModel:void 0}},{key:"_disposeUserEvents",value:function(){this.unbindAll(),this._unbindAll()}},{key:"_isAnyCellInRangeLocked",value:function(e){for(var t=e.rowFrom(),r=e.colFrom(),n=t+e.rowCount(),a=r+e.colCount(),o=t;o<n;o++)for(var i=r;i<a;i++){var u=this.getSpan(o,i,3),s=u?u.rowFrom():o,l=u?u.colFrom():i;if(!0===this.getActualStyle(s,l).locked)return!0}return!1}},{key:"_isValidRange",value:function(e,t,r,n,a,o){if(-1<=e&&e<a&&-1<=t&&t<o){if(-1===e&&-1===t)return!0;if(-1===e){if(0!==n&&t+n<=o)return!0}else if(-1===t){if(0!==r&&e+r<=a)return!0}else if(0!==n&&t+n<=o&&0!==r&&e+r<=a)return!0}return!1}},{key:"_hasPartSpans",value:function(e,t,r,n,a){var o=this;if(e<0&&t<0)return!1;if(e<0){var i=o._getSpanModel(1);if(i&&i.length>0)return i.hasPartSpans(-1,t,-1,n,a)}if(t<0){var u=o._getSpanModel(2);if(u&&u.length>0)return u.hasPartSpans(e,-1,r,-1,a)}var s=o._getSpanModel();return!!(s&&s.length>0)&&s.hasPartSpans(e,t,r,n,a)}},{key:"_raiseInvalidOperation",value:function(e,t){this.dispatch("InvalidOperation",{invalidType:e,message:t})}},{key:"_raiseSegmentChangedIgnoreSuspended",value:function(e,t,r,n,a){this.dispatch("SegmentArrayChanged",{sheet:this,sheetName:this._name,row:e,col:t,sheetArea:r,oldValue:n,newValue:a})}},{key:"_raiseCellChanged",value:function(){this.notifyShell(3)}},{key:"_raiseValueChanged",value:function(e,t,r,n,a,o){var i={sheetName:this._name,row:e,col:t,oldValue:r,newValue:n,from:a,executeType:o};this.dispatch("ValueChanged",i),this.notifyShell(4,i)}},{key:"_raiseSelectionChanging",value:function(e,t){return!!function(e,t){var r=!0;if(e.length===t.length)for(var n=0;n<e.length;n++){var a=e[n],o=t[n];if(!a.equal(o)){r=!0;break}r=!1}return r}(e,t)}},{key:"_raiseSelectionChanged",value:function(e,t,r){var n={sheet:this,sheetName:this._name,oldSelections:e,newSelections:this.getSelections(),source:t,eventTargetSource:r};this.dispatch("SelectionChanged",n)}},{key:"bind",value:function(e,t,r){this._getElem().bind(e+sM,t,r)}},{key:"unbind",value:function(e,t){this._getElem().unbind(e+sM,t)}},{key:"trigger",value:function(e,t){this._trigger(e,t)}},{key:"_triggerIgnoreEventSuspended",value:function(e,t){this._getElem().trigger(e,t)}},{key:"_trigger",value:function(e,t){this.updateEventsData&&this.updateEventsData(e,t),0===this._eventSuspended&&this.needNotify&&this._getElem().trigger(e,t)}},{key:"unbindAll",value:function(){this.unbind(sM)}},{key:"_bind",value:function(e,t,r){e.indexOf(".")>=0?this.bind(e,t,r):this.bind(e+lM,t,r)}},{key:"_unbind",value:function(e,t){e.indexOf(".")>=0?this.unbind(e,t):this.unbind(e+lM,t)}},{key:"_unbindAll",value:function(){this.unbind(lM)}},{key:"notifyShell",value:function(e,t){if(this.needNotify)return this._shell&&this._shell(e,t)}},{key:"setRowHeaderColWidth",value:function(e){this.lastRowHeaderWidth=0,this.lastCalcRowCount=0,this.defaults.rowHeaderColWidth=e}},{key:"getRowHeaderColWidth",value:function(){return this.defaults.rowHeaderColWidth}},{key:"onRowColChanged",value:function(e,t,r,n,a){this.chartModel.setRowColInfoChange(e,a)}},{key:"resetDataModel",value:function(e,t){var r=this._getModel(),n=r.getRowCount(),a=r.getColumnCount(),o=r.getName(),i=r.getDefaultStyle();this._dataModel=new TA(n,a,this,o),null!=e&&this._dataModel.fromJSON(e,t),this._dataModel.setDefaultStyle(i)}},{key:"updateFreezeWhenLayoutChanged",value:function(e){var t=this,r=t.frozenRowCount(),n=t.frozenColumnCount();if(r||n){0===e.changeType?function(e){void 0!==e.row&&r>e.row&&t.frozenRowCount(r+e.rowCount),void 0!==e.col&&n>e.col&&t.frozenColumnCount(n+e.colCount)}(e):1===e.changeType&&function(e){if(void 0!==e.row&&r>e.row){var a=e.row+e.rowCount>r?r-e.row:e.rowCount;t.frozenRowCount(r-a)}if(void 0!==e.col&&n>e.col){var o=e.col+e.colCount>n?n-e.col:e.colCount;t.frozenColumnCount(n-o)}}(e)}}},{key:"filterModel",get:function(){var e=this.sheetFilterModel;if(!this.viewsModel)return e;var t=this.viewsModel.activeView;return t&&t.getFilterModel()||e}}]),e}();mM._ID=1,mM._defaultVersion=0,mM._defaultOptions=pM,mM._defaultRowCount=200,mM._defaultColCount=20,mM._defaultChartMap={},mM._defaultRowHeaderColumnCount=1,mM._defaultColHeaderRowCount=1,mM._defaultRowHeight=28,mM._defaultColWidth=120,mM._defaultRowHeaderColWidth=46,mM._defaultColHeaderRowHeight=24,mM._defaultCellPadding=[2,2,3,1],mM.refCountValidVersion=4,mM.latestVersion=4;var gM=(We={},(0,l.Z)(We,Ce.kHU.BITABLE_BLOCK,Ce.B2l.ExternalBlockType.ExternalBlockType_BITABLE_BLOCK),(0,l.Z)(We,Ce.kHU.DOCX_BLOCK,Ce.B2l.ExternalBlockType.ExternalBlockType_DOCX_BLOCK),We),yM=(Ge={},(0,l.Z)(Ge,Ce.B2l.ExternalBlockType.ExternalBlockType_BITABLE_BLOCK,Ce.kHU.BITABLE_BLOCK),(0,l.Z)(Ge,Ce.B2l.ExternalBlockType.ExternalBlockType_DOCX_BLOCK,Ce.kHU.DOCX_BLOCK),Ge),_M=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).gridLineHidden=e.inject(UI),e.tabColor=e.inject(HI),e.tabType=e.inject(jO),e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serializeTopSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=[];return this.serializeInsertSheetMutation(r,e,t),this.serializeSheetProtectionMutation(r,t),r}},{key:"serializeResourceSnapshot",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.isForShortcut,n=[];return this.serializeDimensionMutation(n,r),this.serializeMergeCellsMutations(n),this.serializeExtraInfoMutations(n,t),this.serializeWorkbookRangeMutations(n,t),this.serializeFilterMutation(n,e,r),this.serializeCustomViewsMutation(n,e),this.serializeFloatImagesMutation(n,t),this.serializeFloatBlocksMutation(n,t),this.serializeEmbeddedBlocksMutation(n,t),this.serializeRangeProtectionMutation(n,t),this.serializeSparklineGroupMutation(n),TS(n,this.conditionalFormatModel,{useNewConditionFormat:!!t.customSheetId}),this.serializeChartMapMutation(n,t),n}},{key:"serializeTableSnapshot",value:function(e){return this.serializeSetRangeValuesMutation(e)}},{key:"serializePTViewDataModel",value:function(e){var t=this,r=[];e.forEach((function(e){var n=e.startRow,a=e.startCol,o=e.endRow,i=e.endCol,u=n||0,s=a||0;(0,Ce.hTd)(r,kT(t,u,s,o||0-u,i||0-s))}));var n=new Set(r),a=this.getPivotTableManager(),o=[];return n.forEach((function(e){var t=a.getPivotInfoByName(e),r=t&&t.errorState!==Pp.None?void 0:a.getViewDataModelByName(e),n=null!=t&&t.errorState?t.errorState:void 0;o.push({id:e,viewModel:r?JSON.stringify(r.toJSON()):void 0,errorState:n})})),[{type:Ce.B2l.MutationType.MutationType_AddCalcResult,addCalcResult:{pivotTableViewModels:o}}]}},{key:"serializeInsertSheetMutation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=r.customSheetId,a=r.customSheetName,o=r.customSheetVisible,i={worksheetProperties:{id:n||this.id(),index:t,name:a||this.name(),rowCount:this.getRowCount(),colCount:this.getColumnCount(),sheetState:o||this.visible()?Ce.B2l.SheetState.SheetState_VISIBlE:Ce.B2l.SheetState.SheetState_HIDDEN,sheetView:{frozenRowCount:this.frozenRowCount(),frozenColCount:this.frozenColumnCount(),hideGridLines:this.gridLineHidden.getGridLine()},sheetPr:{tabColor:{rgb:this.tabColor.getTabColor()},tabType:n?void 0:this.tabType.getTabType()},softDelTime:this._delTime,importRanges:this.getImportRanges()}},u=this,s=u.blockId,l=u.blockToken,c=u.blockType;s&&l&&c&&(i.worksheetProperties.externalBlock={blockId:s,blockToken:l,blockType:gM[c]}),e.push({type:Ce.B2l.MutationType.MutationType_InsertSheet,insertSheet:i})}},{key:"serializeDimensionMutation",value:function(e,t){var r=this.serializeRowDimensions(t),n=this.serializeColDimensions(),a=this.serializeRowOutlineGroups(),o=this.serializeColOutlineGroups();(r.length>0||n.length>0||a.length>0||o.length>0)&&e.push({type:Ce.B2l.MutationType.MutationType_SetDimensionProperties,setDimensionProperties:{rowDimensions:r,colDimensions:n,rowOutlineGroups:a,colOutlineGroups:o}})}},{key:"serializeRowDimensions",value:function(e){var t=[];return this._getRowInfos().serialize(t,e),t}},{key:"serializeColDimensions",value:function(){var e=[];return this._getColInfos().serialize(e),e}},{key:"serializeRowOutlineGroups",value:function(){var e=[];return this.outlineGroupModel.serialize(e,!0),e}},{key:"serializeColOutlineGroups",value:function(){var e=[];return this.outlineGroupModel.serialize(e,!1),e}},{key:"serializeMergeCellsMutations",value:function(e){var t,r=[],n=yr(this._getSpanModel().toArray(!0));try{for(n.s();!(t=n.n()).done;){var a=t.value.toSimpleGridJSON();r.push(a)}}catch(e){n.e(e)}finally{n.f()}r.length>0&&e.push({type:Ce.B2l.MutationType.MutationType_MergeCells,mergeCells:{ranges:r}})}},{key:"serializeSetRangeValuesMutation",value:function(e){return this._getModel().serialize(e)}},{key:"serializeExtraInfoMutations",value:function(e,t){this._getModel().serializeExtraInfo(e,t)}},{key:"serializeWorkbookRangeMutations",value:function(e,t){var r=this,n=t.customSheetId;this.rangeModel.forEach((function(t,a){var o=ou.fromJSON(t,t.type,r).toGridJSON(!1),i=a;if(n){o.sheetId=n;var u=a.split("_"),s=(0,g.Z)(u,2)[1];i="".concat(n,"_").concat(s)}e.push({type:Ce.B2l.MutationType.MutationType_AddWorkbookRange,addWorkbookRange:{value:{id:i,range:o,type:t.usageType||Ce.B2l.WorkbookRangeType.WorkbookRangeType_ChartOrPivotTable}}})}))}},{key:"serializeFilterMutation",value:function(e,t,r){var n=(r?this.filterModel:this.sheetFilterModel).serialize(t);n&&e.push({type:Ce.B2l.MutationType.MutationType_SetAutoFilter,setAutoFilter:{value:n}})}},{key:"serializeCustomViewsMutation",value:function(e,t){var r,n=yr(this.viewsModel.serialize(t));try{for(n.s();!(r=n.n()).done;){var a=r.value;e.push({type:Ce.B2l.MutationType.MutationType_AddCustomView,addCustomView:{value:a}})}}catch(e){n.e(e)}finally{n.f()}}},{key:"serializeFloatImagesMutation",value:function(e,t){var r,n={useNewFloatImage:!!t.customSheetId},a=yr(this.floatImageModel.serialize(n));try{for(a.s();!(r=a.n()).done;){var o=r.value;e.push({type:Ce.B2l.MutationType.MutationType_AddFloatImage,addFloatImage:{value:o}})}}catch(e){a.e(e)}finally{a.f()}}},{key:"serializeFloatBlocksMutation",value:function(e,t){var r,n=yr(this.floatBlocksModel.serialize(t.customFloatBlocks));try{for(n.s();!(r=n.n()).done;){var a=r.value;e.push({type:Ce.B2l.MutationType.MutationType_AddFloatBlock,addFloatBlock:{value:a}})}}catch(e){n.e(e)}finally{n.f()}}},{key:"serializeEmbeddedBlocksMutation",value:function(e,t){var r,n=yr(this.embeddedBlocksModel.serialize(t.customEmbedBlocks));try{for(n.s();!(r=n.n()).done;){var a=r.value;e.push({type:Ce.B2l.MutationType.MutationType_AddEmbeddedBlock,addEmbeddedBlock:{value:a}})}}catch(e){n.e(e)}finally{n.f()}}},{key:"serializeSheetProtectionMutation",value:function(e,t){if(!t.ignoreProtection){var r,n=this.id(),a=yr(this.parent.permissionManager.findPermDetail(n));try{for(a.s();!(r=a.n()).done;){var o=r.value;e.push({type:Ce.B2l.MutationType.MutationType_SetSheetProtection,setSheetProtection:{sheetId:n,value:{id:o.permId,creatorId:o.creatorId,description:o.lockInfo}}})}}catch(e){a.e(e)}finally{a.f()}}}},{key:"serializeRangeProtectionMutation",value:function(e,t){var r=this;if(!t.ignoreProtection){var n,a=yr(this.protectionModel.getAllProtections());try{var o=function(){var t=n.value,a=[];t.ranges.forEach((function(e){var t=ou.fromJSON(e,e.type,r);a.push(t.toGridJSON(!1))})),e.push({type:Ce.B2l.MutationType.MutationType_AddRangeProtection,addRangeProtection:{value:{id:t.id,creatorId:t.creatorId,description:t.description,ranges:a}}})};for(a.s();!(n=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}}}},{key:"serializeSparklineGroupMutation",value:function(e){var t,r=this.getSparklineModel(),n=yr(r.getSparklinesGroupMap());try{for(n.s();!(t=n.n()).done;){var a,o=(0,g.Z)(t.value,2),i=o[0],u=o[1],s=WR(r.getSparklineRawConfig(i)),l={},c=yr(u);try{for(c.s();!(a=c.n()).done;){var h=a.value,f=r.getSparklineById(h),d=f.getPosition(),v=d.row,p=d.col;l[h]={source:f.getSource(),position:{startRow:v,startCol:p,endRow:v+1,endCol:p+1}}}}catch(e){c.e(e)}finally{c.f()}e.push({type:Ce.B2l.MutationType.MutationType_AddSparklineGroup,addSparklineGroup:{value:{id:i,config:s,sparklines:l}}})}}catch(e){n.e(e)}finally{n.f()}}},{key:"getImportRanges",value:function(){for(var e=this.parent.importRangeManager.getImportRangeIDs(this.id()),t=[],r=0,n=Object.keys(e);r<n.length;r++){var a,o=n[r],i=e[o].ref,u=ou.fromJSON(i,null!==(a=i.type)&&void 0!==a?a:Ce.xj7.NORMAL,this).toGridJSON(!1);u.sheetName=i.sheetName,t.push(Object.assign({},e[o],{ref:u}))}return t}},{key:"serializeChartMapMutation",value:function(e,t){0!==Object.keys(this.chartModel.getChartMap()).length&&e.push({type:Ce.B2l.MutationType.MutationType_SetChartMap,setChartMap:{chartMap:JSON.stringify(this.chartModel.toJSON(t))}})}}]),t}(mM),RM=function(e){return[e.row,e.rowCount]},CM=function(e){var t=(0,g.Z)(e,2);return{row:t[0],rowCount:t[1],type:Ce.xj7.ROW}},wM=function(e){return[e.col,e.colCount]},EM=function(e){var t=(0,g.Z)(e,2);return{col:t[0],colCount:t[1],type:Ce.xj7.COL}},kM=function(e){return[e.row,e.rowCount,e.col,e.colCount]},TM=function(e){var t=(0,g.Z)(e,4);return{row:t[0],rowCount:t[1],col:t[2],colCount:t[3],type:Ce.xj7.NORMAL}},SM=sa,AM=Fm,IM=SM.each,OM=SM.isEmptyObject,VM=dn._hasOwnProperty,NM="columns",bM="rows",MM="rowHeaderColInfos",FM="colHeaderRowInfos",ZM="data",xM="rowHeaderData",DM="colHeaderData",PM="selections",$M="spans";var LM=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).gridLineHidden=e.inject(UI),e.tabColor=e.inject(HI),e.tabType=e.inject(jO),e.handleViewsModel=function(t){var r=e.viewsModel.toJSON();(0,ue.default)(r)||(t.views=r)},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"_setValueToDataTable",value:function(e,t,r,n){var a=e[t]||(e[t]={});(a[r]||(a[r]={})).value=n}},{key:"toJSON",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=function(e,t){switch(e){case NM:case bM:case MM:case FM:return!t||0===t.length;case"frozenRowCount":case"frozenColCount":case"activeRow":case"activeCol":return 0===t;case"zoomFactor":case"rowHeaderColCount":case"colHeaderRowCount":return 1===t;case"visible":return!0===t;case ZM:case xM:case DM:return OM(t);case"tag":return null===t;case"version":return!t||0===t}return!1};function o(e,t,r,n,a){e[t]=r.toJSON(n,a)}function i(e,t,r){e[t]=r.toJSON()}var u=this,s=u.getRowCount(),l=u.getColumnCount(),c=u.getRowCount(),h=u.getColumnCount(),f=u.parent.importRangeManager.getImportRangeIDs(u._id_),d={id:u._id_,version:u.version(),name:u._name,frozenRowCount:u.frozenRowCount(),frozenColCount:u.frozenColumnCount(),rowCount:s,columnCount:l,activeRow:u._activeRowIndex,activeCol:u._activeColIndex,rowHeaderColCount:h,colHeaderRowCount:c,visible:u.visible(),delTime:void 0,hidden:u._hidden,chartMap:this.chartModel.toJSON(null==e?void 0:e.chart),dataRanges:this.rangeModel.toJSON(),floatImageMap:this.floatImageModel.toJSON(),floatBlocks:this.floatBlocksModel.toJSON(),embeddedBlocks:this.embeddedBlocksModel.toJSON(),conditionalFormats:this.conditionalFormatModel.toJSON(),importRangeIDs:f,gridLineHidden:this.gridLineHidden.getGridLine(),tabColor:this.tabColor.getTabColor(),tabType:this.tabType.getTabType(),group:this.outlineGroupModel.toJSON()},v=e&&e.isServerExport;o(d,$M,u._getSpanModel(),v),r||u._getModel().toJSON(3,d,v),v||o(d,PM,u._selectionModel,v),i(d,bM,u._getRowInfos()),i(d,NM,u._getColInfos()),v&&""!=u._delTime&&(d.delTime=u._delTime);var p={};for(var m in d)if(VM(d,m)){var g=d[m];a(m,g)||(p[m]=g)}if(IM(u.options,(function(e,r){var n=r,a=t.constructor;"_ps"!==e&&a._defaultOptions[e]!==n&&("object"==(0,R.Z)(n)&&OM(n)||(p[e]=n))})),u.sheetFilterModel.hasFilter()&&(p.rowFilter=u.sheetFilterModel.toJSON()),this.handleViewsModel(p),u.parent){var y=u.parent.permissionManager,_=u.protectionModel,C=y&&_,w={columns:{},rows:{},sheet:{}};C&&y.iter((function(e,t){e.sheetId===u.id()&&(w.sheet[t]={creatorId:e.creatorId,info:e.lockInfo})})),p.perms=w;var E=C&&_.getAllProtections()||[];if(E.length>0){p.protections={};var k=RM,T=wM,S=kM;E.forEach((function(e){var t=e.id,r=e.creatorId,n=e.description,a={};n&&(a.desc=n),r&&(a.creatorId=r);var o=CN(e),i=o[Ce.xj7.NORMAL],u=o[Ce.xj7.ROW],s=o[Ce.xj7.COL];if(u.length>0&&(a.rows=u.map(k)),s.length>0&&(a.cols=s.map(T)),i.length>0&&(a.cells=i.map(S)),p.protections[t]=a,!(i.length>0))if(1===u.length&&s.length<1){p.perms||(p.perms={rows:{}}),p.perms.rows||(p.perms.rows={});var l=u[0];p.perms.rows[t]={info:n,creatorId:r,range:{row:l.row,rowCount:l.rowCount,col:0,colCount:0}}}else if(1===s.length&&u.length<1){p.perms||(p.perms={columns:{}}),p.perms.columns||(p.perms.columns={});var c=s[0];p.perms.columns[t]={info:n,creatorId:r,range:{row:0,rowCount:0,col:c.col,colCount:c.colCount}}}}))}}if(r||1===n)return p;var A=(new eM).convertSheet(1,n,p),I=A.sheetSnapshot;return I}},{key:"fromJSON",value:function(e,t,r,n){if(e){var a=this;a._initOptions();var o=this.constructor,i=P(e.rowCount,o._defaultRowCount),u=P(e.columnCount,o._defaultColCount);try{if(a._id_=e.id,a._hidden=e.hidden||!1,a._name=e.name,a.version(e.version||mM._defaultVersion),a.conditionalFormatModel&&a.conditionalFormatModel.destroy(),a.defaults=P(e.defaults,a.defaults),a.setRowCount(i),a.setColumnCount(u),this.gridLineHidden.setGridLine(e.gridLineHidden),this.tabColor.setTabColor(e.tabColor),this.tabType.setTabType(e.tabType),e.rowFilter){var s=a.inject($I);BI(e.rowFilter,s,{sheetRowCount:i})}var l=a.inject(QI);e.views&&eO(l,e.views,{sheetRowCount:i}),a.conditionalFormatModel=Ab.fromJSON(this,e.conditionalFormats),a.chartModel=cI.fromJSON(this,e.chartMap),a.floatImageModel=qN.fromJSON(this,e.floatImageMap),a.floatBlocksModel=LN.fromJSON(this,e.floatBlocks),a.embeddedBlocksModel=pI.fromJSON(this,e.embeddedBlocks),a.rangeModel=JN.fromJSON(this,e.dataRanges),e.group&&a.outlineGroupModel.fromJSON(e.group);var c=a.options;for(var h in c)if(VM(c,h)){var f=e[h];if("protectionOptions"===h&&(f=f||e.protectionOption),AM(f))if("object"==(0,R.Z)(f))for(var d in f)VM(f,d)&&(a.options[h][d]=f[d]);else a.options[h]=f}var v=P(e.activeRow,a._activeRowIndex),p=P(e.activeCol,a._activeColIndex);if(a._setActiveCellImp(v,p),$(a,a.frozenRowCount,e.frozenRowCount),$(a,a.frozenColumnCount,e.frozenColCount),e.importRangeIDs){var m=a.parent.importRangeManager;for(var g in e.importRangeIDs)e.importRangeIDs[g].sheetId=e.id,m.setFromJsonImportRangeMeta(e.importRangeIDs[g]);var y=Object.keys(e.importRangeIDs),_=y.length;if(_>0){var C=0,w=0;y.forEach((function(e){var t=m.getFormulaCountById(e);w=Math.max(w,t),C+=t})),m.collectImportRangeCount(C,_,w)}}var E=P(e.rowHeaderColCount,o._defaultRowHeaderColumnCount),k=P(e.colHeaderRowCount,o._defaultColHeaderRowCount);if($(a,a.visible,e.visible),x(a._getSpanModel(),e[$M],r),x(a._getSpanModel(2),e.rowHeaderSpan,r),x(a._getSpanModel(1),e.colHeaderSpan,r),a._getModel().fromJSON(e,n),x(a._rowHeaderModel,e[xM],r),x(a._colHeaderModel,e[DM],r),e[PM]&&a._selectionModel.fromJSON(e[PM],a),D(a._getRowInfos(),e.rows,i),D(a._getColInfos(),e.columns,u),D(a._getColInfos(2),e.rowHeaderColInfos,E),D(a._getRowInfos(1),e.colHeaderRowInfos,k),D(a._getLocalRowInfos(),[],i),D(a._getLocalColInfos(),[],u),e.delTime&&a.setDelTime(e.delTime),this._initStyle(),a.parent){var T=a.parent.permissionManager,S=a.protectionModel;if(T&&S){var A;(null===(A=e.perms)||void 0===A?void 0:A.sheet)&&Object.getOwnPropertyNames(e.perms.sheet).forEach((function(t){var r=e.perms.sheet[t];T.setPerm(t,{permId:t,lockInfo:r.info,sheetId:a.id(),creatorId:r.creatorId,sheetName:a.name()})}));var I=e.protections,O=e.perms;if(I)!function(){var e=CM,t=EM,r=TM,n=function(n){var a=I[n],o=[];(a.rows||[]).map((function(t){o.push(e(t))})),(a.cols||[]).map((function(e){o.push(t(e))})),(a.cells||[]).map((function(e){o.push(r(e))})),S.setProtection(n,{description:a.desc,creatorId:a.creatorId,ranges:o})};for(var a in I)n(a)}();else if(O){var V=O.columns||{};for(var N in V){var b=V[N];S.setProtection(N,{description:b.info,creatorId:b.creatorId,ranges:[{col:b.range.col,colCount:b.range.colCount,type:Ce.xj7.COL}]})}var M=O.rows||{};for(var F in M){var Z=M[F];S.setProtection(F,{description:Z.info,creatorId:Z.creatorId,ranges:[{row:Z.range.row,rowCount:Z.range.rowCount,type:Ce.xj7.ROW}]})}}}}}finally{}}function x(e,t,r,n){t&&e.fromJSON(t,r,n)}function D(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0;e.setItems(t.map((function(e){return Object.assign({},e)})),r)}function P(e,t){return AM(e)?e:t}function $(e,t,r){AM(r)&&t.call(e,r,!1)}}}]),t}(_M),BM=_g._createElement,UM=sa,HM=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).lockClickEmbedImage=!1,e._highlightCells=null,e._dropdownApply2AllHighlightCell=null,e._dropdownApply2AllHighlightRange=null,e.getLastBlankRowPos=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=e.getRowCount(),n=r-1;n>=t;){var a=new iu(n,1,(0,c.Z)(e));if(!e._dataModel.isRowContentEmpty(n)||!e.protectionModel.getRangePermissions([a]).hasPermission)break;--n}return n+1>=r?-1:n+1},e.getLastBlankColPos=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=e.getColumnCount(),n=r-1;n>=t;){var a=new nu(n,1,(0,c.Z)(e));if(!e._dataModel.isColContentEmpty(n)||!e.protectionModel.getRangePermissions([a]).hasPermission)break;--n}return n+1>=r?-1:n+1},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setLockClickEmbedImage",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.lockClickEmbedImage=e}},{key:"getLockClickEmbedImage",value:function(){return this.lockClickEmbedImage}},{key:"_onOptionChanged",value:function(e,t,r){this.dispatch("OptionChanged",{value:t,old:r,pn:e,sheet:this})}},{key:"notifyShell",value:function(e,t){if(this.needNotify)return this._shell&&this._shell(e,t)}},{key:"closeNotify",value:function(){this.needNotify=!1}},{key:"resumeNotify",value:function(){this.needNotify=!0}},{key:"registerShell",value:function(e){this._shell=e}},{key:"unRegisterShell",value:function(){this._shell=null}},{key:"cellWidthHint",value:function(e,t){return this.notifyShell(106,{row:e,col:t})}},{key:"_scrollByMoveCell",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;1&n&&this._scrollToCol(t,r),2&n&&this._scrollToRow(e,r)}},{key:"getCellRect",value:function(e,t){return this.notifyShell(30,{row:e,col:t})}},{key:"getNotExpendCellRect",value:function(e,t){return this.notifyShell(98,{row:e,col:t})}},{key:"getCanvasBoundingClientRect",value:function(){return this.notifyShell(97)}},{key:"scrollTo",value:function(e,t){return this.notifyShell(45,{offsetX:e,offsetY:t})}},{key:"setScrollPos",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this.notifyShell(46,{posX:e,posY:t})}},{key:"scroll",value:function(e){var t=e.posX,r=e.posY;return this.setScrollPos(t,r)}},{key:"nextPage",value:function(){var e=this.notifyShell(35);return e?(this._scrollTopRow=e.row,e):null}},{key:"prePage",value:function(){var e=this.notifyShell(36);return e?(this._scrollTopRow=e.row,e):null}},{key:"showCell",value:function(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;this._showCellCore(e,t,a,o)}},{key:"_showCellCore",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:3;e<0||e>=this.getRowCount()||t<0||t>=this.getColumnCount()||this._scrollByMoveCell(e,t,r,n)}},{key:"showColumn",value:function(e,t){this.showCell(this._scrollTopRow,e,0,t)}},{key:"showRow",value:function(e,t){this.showCell(e,this._scrollLeftCol,t,0)}},{key:"getCanvasOffset",value:function(){return{left:0,top:0}}},{key:"sheetContentRect",value:function(){return this.notifyShell(32)}},{key:"tableViewRect",value:function(e,t){return this.notifyShell(31,{row:e,col:t})}},{key:"_scrollToRow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this._scrollTopRow,n=this.notifyShell(33,{row:e,needMoveToCenter:t});return null==n?0:(this.dispatch("TopRowChanged",{sheet:this,sheetName:this._name,oldTopRow:r,newTopRow:n.row}),this._scrollTopRow=n.row,n)}},{key:"_scrollToCol",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.notifyShell(34,{col:e,needMoveToCenter:t});return null==r?0:(this._scrollLeftCol=r.col,r)}},{key:"_scrollToRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.notifyShell(110,{typedRange:e,needMoveToCenter:t})}},{key:"_commandManager",value:function(){var e=this.parent;if(e)return e.commandManager()}},{key:"_getElem",value:function(){return this._$elem||(this._$elem=UM(BM("input"))),this._$elem}},{key:"invalidateRowHeight",value:function(){this.notifyShell(1),this.dispatch("InvalidateRowHeight")}},{key:"_resetImp",value:function(){(0,f.Z)((0,v.Z)(t.prototype),"_resetImp",this).call(this)}},{key:"_init",value:function(e,r){(0,f.Z)((0,v.Z)(t.prototype),"_init",this).call(this,e,r)}},{key:"_dispose",value:function(e){!1!==e&&(this.unRegisterShell(),this._$elem=null),(0,f.Z)((0,v.Z)(t.prototype),"_dispose",this).call(this,e)}},{key:"_isPartofMergeCell",value:function(e,t){return!!this._getSpanModel().find(e,t)}}]),t}(LM),zM=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),t}(HM),WM={userId:"",token:"",getScene:function(){return"backup"},isEmbed:D.default,setEmbed:D.default,trigger:D.default,getToken:function(){return WM.token},getHistoryType:D.default,setHistoryType:D.default,bind:D.default,unbind:D.default,once:D.default,addListeners:D.default,removeListeners:D.default,addEventHandler:D.default,removeEventHandler:D.default,isFullScreenMode:D.default,setFullScreenMode:D.default,setToken:function(e){return WM.token=e},setMemberId:D.default,getMemberId:D.default,getAllMembers:D.default},GM=["pie"],jM={text:"",value:null,type:0,row:-1,col:-1,sheetId:""};function YM(e,t){return function(e){return GM.includes(e)}(e.type)?new KM(e,t):new XM(e,t)}var qM=[0,2,3,4],JM=function(){function e(t,r){var n=this;(0,y.Z)(this,e),this.setting=t,this.table=r,this.isEmptyTable=function(){return 0===n.table.length||0===n.table[0].length},this.filterInvalidCell=function(e){return e.filter((function(e){return-1!==e.row&&-1!==e.col&&e.sheetId}))},this.getCanHaveRowAxis=function(){return n.table.length>1},this.getCanHaveColAxis=function(){return n.table.length>0&&n.table[0].length>1},this.getHasRowAxis=function(){var e=n.setting,t=e.xAxisPos,r=e.hasLabels,a=e.hasHeaders;return"row"===t&&r||"col"===t&&a},this.getHasColAxis=function(){var e=n.setting,t=e.xAxisPos,r=e.hasLabels,a=e.hasHeaders;return"row"===t&&a||"col"===t&&r},this.transformV0ToV1GraphSetting=function(e,t){if(n.setting.hasHeaders=!1,n.setting.hasLabels=!1,!n.isEmptyTable()){var r=n.isRowAxis(),a=n.getAxisValues(e,t),o=a.xAxisValues,i=a.yAxisValues,u=n.getOneDimensionCombinedSeries(o,r,!0),s=n.getOneDimensionCombinedSeries(i,!r,!0);n.setting.hasLabels=!!u,n.setting.hasHeaders=!!s}},this.filterEmptyRows(),this.filterEmptyCols()}return(0,_.Z)(e,[{key:"NaNToZero",value:function(e){return Number.isNaN(e)?0:e}},{key:"filterEmptyRows",value:function(){for(var e=this.table,t=0,r=0;r<e.length&&!e[r].some((function(e){return null!=e.value}));r++)t++;t&&(e.splice(0,t),t=0);for(var n=e.length-1;n>=0&&!e[n].some((function(e){return null!=e.value}));n--)t+=1;t&&e.splice(e.length-t)}},{key:"filterEmptyCols",value:function(){for(var e=Z.Z.apply(void 0,(0,m.Z)(this.table)),t=0,r=0;r<e.length&&!e[r].some((function(e){return!!e&&null!=e.value}));r++)t++;t&&(this.table.forEach((function(e){return e.splice(0,t)})),t=0);for(var n=e.length-1;n>=0&&!e[n].some((function(e){return!!e&&null!=e.value}));n--)t++;t&&this.table.forEach((function(e){return e.splice(e.length-t)}))}},{key:"isRowAxis",value:function(){return"row"===this.setting.xAxisPos}},{key:"isNumeric",value:function(e){return!Number.isNaN(Number(e))}},{key:"isAxisDataNumber",value:function(e){return qM.includes(e.type)&&this.isNumeric("".concat(e.value))}},{key:"getValidArrayValue",value:function(e,t){var r=this;return t.map((function(t){return r.getValidCellValue(e,t)}))}},{key:"getValidCellValue",value:function(e,t){var r=t.text,n=t.value,a=t.type;if(e)return Object.assign({},t,{text:(null==r?"":r).toString()});try{return Object.assign({},t,{value:5===a?NaN:this.isNumeric("".concat(n))?parseFloat("".concat(n)):NaN})}catch(e){return Object.assign({},t,{value:NaN})}}},{key:"isSequentialNum",value:function(e){for(var t=1;t<e.length;t++)if(e[t]!==e[t-1]+1)return!1;return!0}},{key:"isValidSeries",value:function(e,t){if(e=this.filterInvalidCell(e),t){var r=e.map((function(e){return e.col}));return this.isSequentialNum(r)&&e.every((function(t){return t.row===e[0].row}))}var n=e.map((function(e){return e.row}));return this.isSequentialNum(n)&&e.every((function(t){return t.col===e[0].col}))}},{key:"getOneDimensionCombinedSeries",value:function(e,t,r){e=this.filterInvalidCell(e);var n=!!r||this.isValidSeries(e,t);return 0!==e.length&&n?{row:e[0].row,col:e[0].col,rowCount:t?1:e.length,colCount:t?e.length:1,sheetId:e[0].sheetId}:null}},{key:"getTwoDimensionCombinedSeries",value:function(e,t){var r=this,n=(e=e.map(this.filterInvalidCell)).every((function(e){return r.isValidSeries(e,t)}));if(0===e.length||0===e[0].length||!n)return null;var a=[];return e.forEach((function(e){e.length>0&&a.push({row:e[0].row,col:e[0].col,rowCount:t?1:e.length,colCount:t?e.length:1,sheetId:e[0].sheetId})})),a}},{key:"canBeAggregate",value:function(e){return!!(e&&e.length>1&&e.some((function(e){return!!e.text})))}},{key:"aggregate",value:function(e,t){var r=this,n=new Map;e.forEach((function(e,t){var r=e.text;r&&n.has(r)?n.get(r).push(t):n.set(r,[t])}));var a=[];n.forEach((function(e,n){e.length>1&&(r.aggregateValues(t,e),(0,Ce.hTd)(a,e.slice(1)))})),(0,x.Z)(e,a),this.multiSpliceTableValues(t,a)}},{key:"sumIdenticalCategoryToBase",value:function(e,t,r){var n=this,a=r.reduce((function(t,r){return(0,it.convertTo15Digits)(parseFloat(t+n.NaNToZero((0,he.Z)(e[r].value))))}),this.NaNToZero((0,he.Z)(e[t].value)));e[t].value=a,e[t].text="".concat(a)}},{key:"getHeadersQuote",value:function(e,t){return e?"row"===t?{enabled:this.getCanHaveColAxis(),dimension:"col",position:(0,Ce.hdC)(e.col)}:{enabled:this.getCanHaveRowAxis(),dimension:"row",position:e.row+1}:{enabled:!1}}},{key:"getLabeslQuote",value:function(e,t){return e?"row"===t?{enabled:this.getCanHaveRowAxis(),dimension:"row",position:e.row+1}:{enabled:this.getCanHaveColAxis(),dimension:"col",position:(0,Ce.hdC)(e.col)}:{enabled:!1}}},{key:"getAxisValues",value:function(e,t){var r,n,a=this.table;return e=e&&this.table.length>1,t=t&&this.table.length>0&&this.table[0].length>1,e||t?e&&!t?(r=this.getValidArrayValue(!0,a[0]),n=a.map((function(e){return jM})).slice(1)):!e&&t?(r=a[0].map((function(e){return jM})).slice(1),n=this.getValidArrayValue(!0,a.map((function(e){return e[0]})))):(r=this.getValidArrayValue(!0,a[0].slice(1)),n=this.getValidArrayValue(!0,a.map((function(e){return e[0]})).slice(1))):(r=a[0].map((function(e){return jM})),n=a.map((function(e){return jM}))),"row"===this.setting.xAxisPos?{xAxisValues:r,yAxisValues:n}:{xAxisValues:n,yAxisValues:r}}},{key:"getDataTable",value:function(e,t){var r=this.table,n=this.setting,a=r.map((function(e){return t&&e.length>1?e.slice(1):e}));return a=e&&r.length>1?a.slice(1):a,"row"===n.xAxisPos?a:Z.Z.apply(void 0,(0,m.Z)(a))}},{key:"getLabelsAndHeaderOptions",value:function(){var e=this.setting.xAxisPos,t=this.isRowAxis(),r=this.getAxisValues(!0,!0),n=r.xAxisValues,a=r.yAxisValues;return{labelsOptions:this.getLabeslQuote(this.getOneDimensionCombinedSeries(n,t,!0),e),headersOptions:this.getHeadersQuote(this.getOneDimensionCombinedSeries(a,!t,!0),e)}}},{key:"isVersion0Setting",value:function(){var e=this.setting;return void 0===e.hasLabels||void 0===e.hasHeaders}},{key:"parseInfoNewChart",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=[this.filterInvalidCell(e)],a=t.map(this.filterInvalidCell),o=this.filterInvalidCell(r),i=0;i<o.length;i++){var u,s=o[i];null===(u=a[i])||void 0===u||u.unshift(s)}return{firstCells:n,secondCells:a}}}]),e}(),KM=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))).defaultGraphData={values:[],xAxisValues:[]},n.defaultSettingsData={allowedAggregate:!1,isStack:!1,headersOptions:{enabled:!1},title:"",type:"pie",valueRanges:null,labelsOptions:{enabled:!1},xAxisRange:null},n.hasLeftTopContent=function(){return n.table.length>0&&n.table[0].length>0&&null!==n.table[0][0].value},n.hasHeaderBaseValues=function(){var e=!1,t=!1,r=n.isRowAxis();return(r&&n.table.length>1||!r&&n.table.length>0&&n.table[0].length>1)&&(t=!n.hasLeftTopContent(),e=!0),{hasRowAxis:r?e:t,hasColAxis:r?t:e}},n.isVersion0Setting()&&n.transformSettingV0ToV1(),n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"transformSettingV0ToV1",value:function(){var e=this.hasHeaderBaseValues(),t=e.hasRowAxis,r=e.hasColAxis;this.transformV0ToV1GraphSetting(t,r)}},{key:"genBaseData",value:function(){var e=this.getHasRowAxis(),t=this.getHasColAxis();if(this.isEmptyTable())return this.defaultGraphData;var r=this.getDataTable(e,t),n=this.getAxisValues(e,t);return{xAxisValues:n.xAxisValues,yAxisValuesForNewChart:n.yAxisValues,values:this.getValidArrayValue(!1,r[0])}}},{key:"gen",value:function(){var e=this.setting,t=e.title,r=e.type,n=this.genBaseData(),a=(0,Re.default)(n.values),o=(0,Re.default)(n.xAxisValues),i=[];a.forEach((function(e,t){e.value&&e.value<0&&i.push(t)})),(0,x.Z)(o,i),(0,x.Z)(a,i);var u=this.canBeAggregate(o);return e.isAggregate&&u&&this.aggregate(o,a),delete n.yAxisValuesForNewChart,Object.assign({title:t,type:r,isStack:e.isStack},n,{values:a,xAxisValues:o})}},{key:"genChartSettingData",value:function(){var e=this.setting,t=e.title,r=e.type,n=this.isRowAxis();if(this.isEmptyTable())return this.defaultSettingsData;var a=this.genBaseData(),o=a.xAxisValues,i=a.values,u=a.yAxisValuesForNewChart,s=this.getLabelsAndHeaderOptions(),l=s.labelsOptions,c=s.headersOptions,h=e.hasLabels&&this.canBeAggregate(o),f=this.getOneDimensionCombinedSeries(o,n),d=this.getOneDimensionCombinedSeries(i,n),v=this.parseInfoNewChart(o,[i],u),p=v.firstCells,m=v.secondCells;return{title:t,type:r,isStack:e.isStack,valueRanges:d?[d]:null,xAxisRange:f,allowedAggregate:h,labelsOptions:l,headersOptions:c,newChart:{firstCells:p,secondCells:m}}}},{key:"aggregateValues",value:function(e,t){var r=t[0],n=t.slice(1);this.sumIdenticalCategoryToBase(e,r,n)}},{key:"multiSpliceTableValues",value:function(e,t){(0,x.Z)(e,t)}}]),t}(JM),XM=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))).defaultGraphData={values:[[]],xAxisValues:[],yAxisValues:[]},n.defaultSettingsData={allowedAggregate:!1,isStack:!1,headersOptions:{enabled:!1},title:"",type:"bar",valueRanges:null,labelsOptions:{enabled:!1},xAxisRange:null},n.isRowAxisIncludeNumber=function(){return n.table.length>0&&n.table[0].some((function(e){return n.isAxisDataNumber(e)}))},n.isColAxisIncludeNumber=function(){return n.table.length>0&&n.table[0].length>0&&n.table.map((function(e){return e[0]})).some((function(e){return n.isAxisDataNumber(e)}))},n.isVersion0Setting()&&n.transformSettingV0ToV1(),n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"transformSettingV0ToV1",value:function(){var e=!this.isRowAxisIncludeNumber(),t=!this.isColAxisIncludeNumber();this.transformV0ToV1GraphSetting(e,t)}},{key:"gen",value:function(){var e=this.setting,t=e.title,r=e.type,n=this.genBaseData(),a=(0,Re.default)(n.values),o=(0,Re.default)(n.xAxisValues),i=this.canBeAggregate(o);return e.isAggregate&&i&&this.aggregate(o,a),Object.assign({title:t,type:r,isStack:e.isStack},n,{values:a,xAxisValues:o})}},{key:"genBaseData",value:function(){if(this.isEmptyTable())return this.defaultGraphData;var e=this.getHasRowAxis(),t=this.getHasColAxis(),r=this.getValidTwoDimensionValue(!1,this.getDataTable(e,t)),n=this.getAxisValues(e,t);return{xAxisValues:n.xAxisValues,yAxisValues:n.yAxisValues,values:r}}},{key:"genChartSettingData",value:function(){if(this.isEmptyTable())return this.defaultSettingsData;var e=this.getLabelsAndHeaderOptions(),t=e.labelsOptions,r=e.headersOptions,n=this.genBaseData(),a=n.xAxisValues,o=void 0===a?[]:a,i=n.values,u=void 0===i?[]:i,s=n.yAxisValues,l=void 0===s?[]:s,c=this.setting,h=c.title,f=c.type,d=this.isRowAxis(),v=c.hasLabels&&this.canBeAggregate(o),p=this.getOneDimensionCombinedSeries(o,d),m=this.getTwoDimensionCombinedSeries(u,d),g=this.parseInfoNewChart(o,u,l),y=g.firstCells,_=g.secondCells;return{title:h,type:f,isStack:c.isStack,allowedAggregate:v,xAxisRange:p,valueRanges:m,labelsOptions:t,headersOptions:r,newChart:{firstCells:y,secondCells:_}}}},{key:"aggregateValues",value:function(e,t){var r=this,n=t[0],a=t.slice(1);e.forEach((function(e){r.sumIdenticalCategoryToBase(e,n,a)}))}},{key:"multiSpliceTableValues",value:function(e,t){e.forEach((function(e){(0,x.Z)(e,t)}))}},{key:"getValidTwoDimensionValue",value:function(e,t){var r=this;return t.map((function(t){return r.getValidArrayValue(e,t)}))}}]),t}(JM),QM=function(){function e(t){(0,y.Z)(this,e),this.dataSource=t}return(0,_.Z)(e,[{key:"detectWhileCreating",value:function(e,t){var r=e.graphSetting;this.avoidInvalidRange(r),!t&&this.detectV1GraphSetting(r)}},{key:"gen",value:function(e){return this.avoidInvalidRange(e),YM(e,this.genVirtualTable(e)).gen()}},{key:"genChartSettingData",value:function(e){return this.avoidInvalidRange(e),YM(e,this.genVirtualTable(e)).genChartSettingData()}},{key:"genChartSettingDataForNewChart",value:function(e){return this.avoidInvalidRange(e),YM(e,this.genVirtualTable(e,!0)).genChartSettingData()}},{key:"detectV1GraphSetting",value:function(e){return YM(e,this.genVirtualTable(e)).transformSettingV0ToV1()}},{key:"genVirtualTable",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.dataRanges,a=e.combineDirection,o=e.xAxisPos;if(0===n.length)return[[]];var i=this.getMaxRowCountInRange(a,n,r),u=this.getMaxColCountInRange(a,n,r);if(0===i||0===u)return[[]];var s=this.getInitialVirtualTable(o,u,i),l=0;return n.forEach((function(e){var n=t.getRangeValues(e,r);n.length&&("horizontal"===a?(n.forEach((function(e,t){return e.forEach((function(e,r){return s[t][l+r]=e}))})),l+=n[0].length):(n.forEach((function(e,t){return e.forEach((function(e,r){return s[l+t][r]=e}))})),l+=n.length))})),s}},{key:"avoidInvalidRange",value:function(e){e.dataRanges.forEach((function(e){e.row=Math.max(0,e.row),e.col=Math.max(0,e.col)}))}},{key:"getRangeValues",value:function(e,t){var r=this.dataSource,n=e.sheetId,a=r.getRangeDatas(n,e);if(!t){var o=this.getHiddenRowColInRange(e),i=o.hiddenRowIndexes,u=o.hiddenColIndexes;i.forEach((function(e){return a.splice(e,1)})),u.forEach((function(e){return a.forEach((function(t){return t.splice(e,1)}))}))}return a}},{key:"getHiddenRowColInRange",value:function(e){var t=e.row,r=e.col,n=e.rowCount,a=e.colCount,o=e.sheetId,i=this.dataSource.getHiddenCols(o),u=this.dataSource.getHiddenRows(o),s=[],l=[];if(u)for(var c=n-1;c>=0;c--)u[t+c]&&s.push(c);if(i)for(var h=a-1;h>=0;h--)i[r+h]&&l.push(h);return{hiddenRowIndexes:s,hiddenColIndexes:l}}},{key:"getInitialVirtualTable",value:function(e,t,r){var n={text:"",value:NaN,type:0,row:-1,col:-1,sheetId:""};return(0,m.Z)(Array(r)).map((function(){return Array(t).fill(Object.assign({},n))}))}},{key:"getMaxRowCountInRange",value:function(e,t,r){var n=this;return"horizontal"===e?this.getRangeRowCount((0,F.Z)(t,(function(e){return n.getRangeRowCount(e,r)})),r):t.reduce((function(e,t){return e+n.getRangeRowCount(t,r)}),0)}},{key:"getMaxColCountInRange",value:function(e,t,r){var n=this;return"horizontal"===e?t.reduce((function(e,t){return e+n.getRangeColCount(t,r)}),0):this.getRangeColCount((0,F.Z)(t,(function(e){return n.getRangeColCount(e,r)})),r)}},{key:"getRangeRowCount",value:function(e,t){if(!e)return 0;if(t)return e.rowCount;var r=e.row,n=e.rowCount,a=this.dataSource.getHiddenRows(e.sheetId),o=e.rowCount;if(!a)return o;for(var i=0;i<n;i++)a[r+i]&&o--;return o}},{key:"getRangeColCount",value:function(e,t){if(!e)return 0;if(t)return e.colCount;var r=this.dataSource.getHiddenCols(e.sheetId),n=e.col,a=e.colCount,o=e.colCount;if(!r)return o;for(var i=0;i<a;i++)r[n+i]&&o--;return o}}]),e}(),eF=function(){function e(){(0,y.Z)(this,e),this.map=new Map,this.permIdList=[],this.bindEvents()}return(0,_.Z)(e,[{key:"bindEvents",value:function(){}},{key:"destroy",value:function(){}},{key:"remove",value:function(e){return e&&0!==e.length?!0!==this.map.has(e)?3:(this.map.delete(e),this.permIdList=this.permIdList.filter((function(t){return t!==e})),0):2}},{key:"set",value:function(e,t){if(!e||0===e.length)return 2;if(this.map.has(e)){var r=this.map.get(e),n=(t.creatorId,(0,s.Z)(t,pr));this.map.set(e,Object.assign({},r,{},n))}else this.map.set(e,t),this.permIdList.push(e);return 0}},{key:"all",value:function(){return new Map(this.map)}},{key:"iter",value:function(e){this.map.forEach(e)}},{key:"has",value:function(e){return this.map.has(e)}},{key:"get",value:function(e){return this.map.get(e)}},{key:"size",value:function(){return this.map.size}}]),e}(),tF=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"bindSheetEvents",value:function(e){console.log("bindSheetEvents")}},{key:"unbindSheetEvents",value:function(e){console.log("unbindSheetEvents")}},{key:"findPerm",value:function(e){var t=this;return this.permIdList.filter((function(r){var n=t.map.get(r);return!(!n||n.sheetId!==e)}))}},{key:"existPerm",value:function(e){var t=this;return this.permIdList.some((function(r){var n=t.map.get(r);return!(!n||n.sheetId!==e)}))}}]),t}(eF),rF=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,y.Z)(this,e),this.lastActiveSheetId="",this.subscriber=null,this._curSheetEditable$=new ft.X(!1),this._editableSheets$=new ft.X({}),this._curSheetVisiblePerm$=new ft.X(!1),this._invisibleSheets$=new ft.X({}),this.curSheetEditable$=this._curSheetEditable$.asObservable(),this.editableSheets$=this._editableSheets$.asObservable(),this.curSheetVisiblePerm$=this._curSheetVisiblePerm$.asObservable(),this.invisibleSheets$=this._invisibleSheets$.asObservable(),this.syncSheetPermission=function(){var e=(0,u.Z)(i().mark((function e(t,n,a,o){var u,s,l,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=(0,Ce.pPK)(),s=r.getPermIdList(),l=r.spread,r.userPerm.getToken()!==n&&(r.userPerm.reset(),r.userPerm.setToken(n)),u||!s||!s.length){e.next=15;break}if(e.prev=2,!Ce.Ps3.getSheetInvisibleProtectionPortEnabled()){e.next=8;break}return e.next=6,cN(s.map((function(e){return{permId:e,userId:t,userType:Ce.$AG.user,actionType:[Ce.KXM.view,Ce.KXM.edit]}})),void 0,n||l._context.token,l.options.situation);case 6:e.next=10;break;case 8:return e.next=10,sN(s);case 10:e.next=15;break;case 12:return e.prev=12,e.t0=e.catch(2),e.abrupt("return",void(o&&o(e.t0)));case 15:return c=r.userPerm.isReady,r.userPerm.setReady(!0),a&&a(),e.next=20,r.refresh();case 20:c||l.dispatch("PermissionReady");case 21:case"end":return e.stop()}}),e,null,[[2,12]])})));return function(t,r,n,a){return e.apply(this,arguments)}}(),this.getAllPermissionList=function(){var e=r.spread,t=new Map,n=r.userPerm;return e.sheets.forEach((function(e){var a=[],o=e.id(),i=r.findPermDetail(o);if(i&&i.length>0&&i.forEach((function(e){a.push(Object.assign({},e,{type:3,permissionType:n.getPermType(e.permId),sheetId:o}))})),e.protectionModel){var u=e.protectionModel.getAllProtections();u.forEach((function(e){a.push(Object.assign({},e,{type:0,permissionType:n.getPermType(e.id),sheetId:o}))})),a&&a.length&&t.set(o,a)}})),t},this.onActiveSheetChanged=function(){if(r.userPerm.isReady){var e=r.spread;if(e){var t=e.getActiveSheet();r.lastActiveSheetId!==t.id()&&(r.refreshPermission(),r.lastActiveSheetId=t.id())}}},this.sheetPerm=new tF,this.spread=t,this._curSheetEditable$.next(n),this._curSheetVisiblePerm$.next(n),this.bindEvents()}return(0,_.Z)(e,[{key:"curSheetEditable",get:function(){return this._curSheetEditable$.getValue()}},{key:"editableSheets",get:function(){return this._editableSheets$.getValue()}},{key:"curSheetVisiblePerm",get:function(){return this._curSheetVisiblePerm$.getValue()}},{key:"invisibleSheets",get:function(){return this._invisibleSheets$.getValue()}}]),(0,_.Z)(e,[{key:"getDepends",value:function(){return{ActiveSheetChanged:this.onActiveSheetChanged}}},{key:"bindEvents",value:function(){this.subscriber=this.spread.subscribe(this.getDepends())}},{key:"reset",value:function(){this.sheetPerm=new tF}},{key:"destroy",value:function(){this.subscriber&&this.subscriber.unsubscribe(),this.subscriber=null,this._curSheetEditable$.complete(),this._editableSheets$.complete(),this._curSheetVisiblePerm$.complete(),this._invisibleSheets$.complete(),aN(this.spread.options.situation)}},{key:"setPerm",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:fN(),r=arguments.length>1?arguments[1]:void 0,n=this.sheetPerm.set(t,r);return this.userPerm.isReady?_N(10,300,(function(){var r;Ce.Ps3.getSheetInvisibleProtectionPortEnabled()?cN([{permId:t,userId:(null===(r=window.User)||void 0===r?void 0:r.id)||"",userType:Ce.$AG.user,actionType:[Ce.KXM.view,Ce.KXM.edit]}],(function(){return e.refresh()}),e.spread._context.token,e.spread.options.situation):sN([t],(function(){return e.refresh()}))})):this.refresh(),n}},{key:"refresh",value:function(){var e=this;if("history"!==this.spread.options.situation)return new Promise((function(t){setTimeout((function(){e.refreshPermission(),t(!0)}))}))}},{key:"removePerm",value:function(e){var t=this.sheetPerm.remove(e);return this.refresh(),t}},{key:"refreshPermission",value:function(){var e=this,t=this.spread;if(t){var r={},n={};t.sheets.forEach((function(t){var a=t.id(),o=e.hasPermission(a),i=!e.hasSheetVisiblePermission(a);o&&(r[a]=!0),i&&(n[a]=!0)})),(0,me.default)(this._editableSheets$.getValue(),r)||this._editableSheets$.next(r),(0,me.default)(this._invisibleSheets$.getValue(),n)||(this._invisibleSheets$.next(n),this.spread.dispatch("InvisiblePermissionChanged"));var a=t.getActiveSheet();if(a){var o=a.id(),i=r[o]||!1,u=!n[o]||!1;(function(e,t){e.dispatch("PermissionChanged",{permissions:t})})(a,{sheetPermission:i,sheetVisibilityPermission:u}),i!==this.curSheetEditable&&this._curSheetEditable$.next(i),u!==this.curSheetVisiblePerm&&this._curSheetVisiblePerm$.next(u);var s=a.protectionModel;s&&s.refreshPermission(!0)}}}},{key:"findPerm",value:function(e){return this.sheetPerm.findPerm(e)}},{key:"existPerm",value:function(e){return this.sheetPerm.existPerm(e)}},{key:"hasInvisible",value:function(e){var t=this;return this.findPerm(e).some((function(e){return t.userPerm.getHasInivisible(e)}))}},{key:"findPermDetail",value:function(e){var t=this,r=[];return this.findPerm(e).forEach((function(e){var n=t.findPermById(e);n&&r.push(n)})),r}},{key:"findPermById",value:function(e){return this.sheetPerm.get(e)}},{key:"iter",value:function(e){return this.sheetPerm.iter(e)}},{key:"hasPermission",value:function(e){var t=this;if(!this.userPerm.isReady)return!1;var r=this.findPerm(e);return 0===r.length||r.every((function(e){return t.userPerm.hasEditPerm(e)}))}},{key:"hasInvisiblePermissionAllSheet",value:function(){for(var e in this.invisibleSheets)if(this.invisibleSheets[e])return!0;return!1}},{key:"hasSheetVisiblePermission",value:function(e){var t=this;if(!this.userPerm.isReady)return!1;var r=this.findPerm(e);return 0===r.length||r.every((function(e){return t.userPerm.hasVisiblePerm(e)}))}},{key:"getPermIdList",value:function(){var e=this.spread,t=[];return(0,L.Z)(e.sheets,(function(e){var r;((null===(r=e.protectionModel)||void 0===r?void 0:r.getAllProtections())||[]).forEach((function(e){var r=e.id;t.push(r)}))})),e.permissionManager&&e.permissionManager.iter((function(e){t.push(e.permId)})),t}},{key:"userPerm",get:function(){return nN(this.spread.options.situation)}}]),e}(),nF=function(e){return new Promise((function(t){var r;if(null!==(r=e.permissionManager)&&void 0!==r&&r.userPerm.isReady)t(!0);else var n=e.subscribe("PermissionReady",(function(){t(!0),n.unsubscribe()}))}))};function aF(e,t,r,n){for(var a=t.startRow,o=t.endRow,i=t.startCol,u=t.endCol,s=Ho(o,e.getRowCount()),l=Ho(u,e.getColumnCount()),c=a;c<s;c++)for(var h=i;h<l;h++){var f=e.getVar(c,h,!0);if(mv(f)){if(r(c,h,f))return!0}else n&&n(c,h,f)}return!1}var oF,iF,uF,sF,lF,cF=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).service=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"sr",get:function(){return Ce.Ps3.SheetCalcI18nMap}}]),(0,_.Z)(t,[{key:"getFuncMeta",value:function(e){return this.sr[e]}}]),t}(it.I18nService),hF=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"registerSyncFml",value:function(e){this.registerFml(e)}},{key:"markDirtyCompleted",value:function(e){}},{key:"addAlwaysCalcFmls",value:function(e){var t=e.formula.getAlwaysCalcOp();t&&t.size&&this.alwaysCalcFormulas.set(e,t)}},{key:"registerFml",value:function(e,t){var r=e.getRef();this.formulas.add(e),e.isDirty(r)&&this.addDirtyFormula(e),this.addAlwaysCalcFmls(e),this.emit(it.FormulaSpaceEvents.onFormulaRegistered,e)}},{key:"unRegisterFml",value:function(e){this.formulas.delete(e),this.deleteDirtyFormula(e),this.alwaysCalcFormulas.delete(e),this.formulaService.removeValueChangedFormula(e),this.emit(it.FormulaSpaceEvents.onFormulaUnregistered,e)}},{key:"addDirtyFormula",value:function(e){this.dirtyFormulas.has(e)||this.dirtyFormulas.add(e)}},{key:"deleteDirtyFormula",value:function(e){this.dirtyFormulas.has(e)&&this.dirtyFormulas.delete(e)}},{key:"initial",value:function(){}},{key:"dispose",value:function(){}}]),t}(it.FormulaSpace),fF=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"registerFml",value:function(e){(0,f.Z)((0,v.Z)(t.prototype),"registerFml",this).call(this,e,{dependRefAdjust:!0,mountedRefAdjust:!0,dirtinessTransfer:!1})}},{key:"iterFormulasDependOn",value:function(e,t,r){var n,a=yr(this.reactivitySpace.dependenciesWatch.refIter());try{for(a.s();!(n=a.n()).done;){var o=(0,g.Z)(n.value,2),i=o[0],u=o[1];if(e.isIntersect(i)){var s,l=yr(u);try{for(l.s();!(s=l.n()).done;){var c=s.value;if(mv(c)&&r(c,i))return}}catch(e){l.e(e)}finally{l.f()}}}}catch(e){a.e(e)}finally{a.f()}}}]),t}(hF),dF=function(e){function t(e,r,n){var a,o;return(0,y.Z)(this,t),(o=(0,d.Z)(this,(0,v.Z)(t).call(this,{I18nService:cF}))).calcEngine=e,o.spread=r,o.globalFormulaIds=0,o.sheetFormulaIds=new Map,o.sheetFormulas=new Map,o.dirtyFormula=[],o.asyncFormulaState={calculatingFormulas:new Set},o.handleFormulaRegistered=function(e){var t=e.getRef().sheet().id(),r=o.sheetFormulas.get(t);r||(r=new Set,o.sheetFormulas.set(t,r)),r.add(e)},o.handleFormulaUnregistered=function(e){var t,r=e.getRef().sheet().id();null===(t=o.sheetFormulas.get(r))||void 0===t||t.delete(e)},o.handleAfterWaitAsyncCalc=function(e,t){o.removeCalculatingAsyncFormula(e),o.dirtyFormula.push(e),o.markDirtyDebounce()},o.markDirtyDebounce=(0,ie.default)((function(){o.markDirtyImmediately()}),500),o.formulaSpace=new(null!==(a=n)&&void 0!==a?a:hF)((0,c.Z)(o)),o.formulaSpace.addListener(it.FormulaSpaceEvents.onFormulaRegistered,o.handleFormulaRegistered).addListener(it.FormulaSpaceEvents.onFormulaUnregistered,o.handleFormulaUnregistered),o.addListener("afterWaitAsyncCalc",o.handleAfterWaitAsyncCalc),o}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getFormulasInSheet",value:function(e){return this.sheetFormulas.get(e)}},{key:"markDirtyImmediately",value:function(){0!==this.dirtyFormula.length&&(this.calcEngine.markDirty(this.dirtyFormula.map((function(e){return e.getRef()})),Bs),this.dirtyFormula.forEach((function(e){e.resolve&&(e.resolve(e.getVar()),e.resolve=void 0)})),this.dirtyFormula.length=0)}},{key:"addCalculatingAsyncFormula",value:function(e){this.asyncFormulaState.calculatingFormulas.add(e)}},{key:"removeCalculatingAsyncFormula",value:function(e){this.asyncFormulaState.calculatingFormulas.delete(e)}},{key:"getCalculatingAsyncFormulas",value:function(){return this.asyncFormulaState.calculatingFormulas}},{key:"addValueChangedFormula",value:function(e){var t=this;this.valueChangedFormulas.add(e),this.emit(it.FormulaEvents.onFormulaValueChanged,e),this.valueChangedFormulas.size>=1e4?this.handleFormulasValueChanged():null===this.valueChangedTrigger&&(this.valueChangedTrigger=Promise.resolve().then((function(){t.handleFormulasValueChanged()})))}},{key:"dispose",value:function(){this.formulaSpace.removeListener(it.FormulaSpaceEvents.onFormulaRegistered,this.handleFormulaRegistered).removeListener(it.FormulaSpaceEvents.onFormulaUnregistered,this.handleFormulaUnregistered),this.sheetFormulas.clear(),this.sheetFormulaIds.clear()}}]),t}(it.FormulaService);function vF(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}!function(e){e.SnapshotChanged="SnapshotChanged",e.EmbeddedBlockChanged="EmbeddedBlockChanged",e.PivotDataSourceRanged="PivotDataSourceRanged",e.MarkDirty="MarkDirty"}(oF||(oF={}));var pF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[1].getValue();if(!r.length)return it.VALUE_ERR_VAR;var n=Ps(e.workbook,e.ref);if(!n)return it.REF_ERR_VAR;if(!ro(t[0]))return it.REF_ERR_VAR;var a=t[0].getRef();if(!Ps(e.workbook,a))return it.REF_ERR_VAR;var o,i=n.getCalcEngine(),u=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){vF(e,t,r[t])}))}return e}({markDirtyCache:!0,markDirtyCube:!0,isPassive:null===(o=i.pivotCalculateEngine.getPassiveEffect(r))||void 0===o||o,source:oF.MarkDirty},e.customCtx);e.customCtx=u;var s=u.markDirtyCache,l=u.isPassive;try{var c=i.pivotCalculateEngine.pivotCalcService.calculateView(e,r,a),h=c.dataView,f=new _s(h,{isDirtyCache:s,isPassive:l,isError:c.isError,errorType:c.errorType});return ws(f)}catch(e){var d;return d=e instanceof Error?it.tractorErrorVarCreators[it.ErrorCode.DEFAULT_RUNTIME_ERROR]("Message: ".concat(e.message,"\nstack: ").concat(e.stack,".")):it.tractorErrorVarCreators[it.ErrorCode.DEFAULT_RUNTIME_ERROR]("Unknown error occurred during calculation."),d}}}]),t}(pw("PRIVATE_PIVOT_TABLE",2,0,0,$d,[{type:Zd},{type:Nd}]));!function(e){e.ReceiveCompleteServerSideCacheTime="ReceiveCompleteServerSideCacheTime",e.CalculationStartTime="CalculationStartTime",e.FormulaCount="FormulaCount",e.ServerSideCacheHitFormulaCount="ServerSideCacheHitFormulaCount",e.ModuleInitStartTime="ModuleInitStartTime",e.ServerSideCacheFormulaCount="ServerSideCacheFormulaCount"}(lF||(lF={}));var mF=function(){function e(){(0,y.Z)(this,e),this.lock=!0,this.map=new Map,this.reportIdsQueue=[],this.bizType="formula",this.shouldReport=!0,this.isModuleInit=!1,this.isFirstCalcEnd=!1,this.isFirstCalcFinish=!1,this.isFirstApplyResult=!1,this.disableApplyResultReport=!0,this.calcCount=0,this[iF]=0,this[uF]=0,this[sF]=0}return(0,_.Z)(e,[{key:"getSheetStatistics",value:function(e){return this.map.has(e)||this.map.set(e,new Map),this.map.get(e)}},{key:"initModule",value:function(){this.isModuleInit||(this[lF.ModuleInitStartTime]=Date.now(),this.isModuleInit=!0)}},{key:"stopReport",value:function(){this.shouldReport=!1}},{key:"unlock",value:function(){var e=this;this.lock=!1,this.reportIdsQueue.forEach((function(t){return e.reportCacheHitRate(t)}))}},{key:"getAll",value:function(){var e,t,r=0,n=0,a=0,o=yr(this.map);try{for(o.s();!(t=o.n()).done;){var i=(0,g.Z)(t.value,1)[0],u=this.get(i,lF.FormulaCount);u<=0||(r+=u,n+=this.get(i,lF.ServerSideCacheFormulaCount),a+=this.get(i,lF.ServerSideCacheHitFormulaCount))}}catch(e){o.e(e)}finally{o.f()}return e={},(0,l.Z)(e,lF.FormulaCount,r),(0,l.Z)(e,lF.ServerSideCacheFormulaCount,n),(0,l.Z)(e,lF.ServerSideCacheHitFormulaCount,a),e}},{key:"get",value:function(e,t){return e in lF?this[e]||0:void 0!==t&&this.getSheetStatistics(e).get(t)||0}},{key:"add",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.getSheetStatistics(e),a=n.get(t)||0;n.set(t,a+r)}},{key:"sub",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.getSheetStatistics(e),a=n.get(t)||0;n.set(t,a-r)}},{key:"remove",value:function(e){this.map.delete(e)}},{key:"set",value:function(e,t){this[e]=t}},{key:"onFirstCalcStart",value:function(){if(this.isModuleInit)try{this.unlock(),this.set(lF.CalculationStartTime,Date.now()),this.tryReportCalculationCacheTimeDifference(),this.reportFirstCalcCacheHitRate()}catch(e){console.error("onFirstCalc Error",e)}}},{key:"onFirstCalcEnd",value:function(e,t){this.isFirstCalcFinish||this.calcCount++,!this.isFirstCalcEnd&&this.isModuleInit?(this.reportFirstCalcDurationWithCacheHitRate(e,t,"firstCalcEnd"),this.isFirstCalcEnd=!0):this.isFirstCalcEnd=!0}},{key:"onFirstApplyResult",value:function(e){this.disableApplyResultReport||this.isFirstApplyResult||!this.isModuleInit||e<=0||this.reportFirstCalcDurationWithCacheHitRate(Date.now()-this[lF.ModuleInitStartTime],e,"firstApply"),this.isFirstApplyResult=!0}},{key:"onFirstCalcFinished",value:function(e){if(this.isFirstCalcFinish||e<=0||!this.isModuleInit||this[lF.CalculationStartTime]<=0)this.isFirstCalcFinish=!0;else{this.isFirstCalcFinish=!0;try{this.reportFirstCalcDurationWithCacheHitRate(Date.now()-this[lF.CalculationStartTime],e,"firstCalcFinish")}catch(e){console.error("onFirstCalcFinished Error type: ".concat(this.bizType),e)}this.stopReport()}}},{key:"tryReportCalculationCacheTimeDifference",value:function(){var e=this[lF.CalculationStartTime],t=this[lF.ReceiveCompleteServerSideCacheTime];e&&t&&Ce.PxA.collectSheetEvent("sheet_calculation_cache_time_diff_dev",{diff_time:e-t})}},{key:"getCacheHitRateData",value:function(e){var t=0,r=0,n=0,a=0,o=0,i=0;if("string"!=typeof e){var u=this.getAll();t=u[lF.FormulaCount],r=u[lF.ServerSideCacheFormulaCount],a=(n=u[lF.ServerSideCacheHitFormulaCount])/r,o=r/t,i=n/t}else t=this.get(e,lF.FormulaCount),r=this.get(e,lF.ServerSideCacheFormulaCount),a=(n=this.get(e,lF.ServerSideCacheHitFormulaCount))/r,o=r/t,i=n/t;return{formula_count:t,cache_formula_count:r,cached_formula_count:n,cache_hit_rate:Number.isFinite(a)?a:0,formula_cache_hit_rate:Number.isFinite(i)?i:0,server_cache_hit_rate:Number.isFinite(o)?o:0,is_shortcut:(0,Ce.pPK)().toString(),biz_type:this.bizType}}},{key:"reportFirstCalcDurationWithCacheHitRate",value:function(e,t,r){this.shouldReport&&Ce.PxA.collectSheetEvent("sheet_first_calculation_duration_with_cache_hit_rate_dev",Object.assign({duration:e,type:r,calc_formula_count:t,calc_count:this.calcCount},this.getCacheHitRateData()))}},{key:"reportFirstCalcCacheHitRate",value:function(){if(!this.lock&&this.shouldReport){var e=this.getCacheHitRateData();e.formula_count<=0||Ce.PxA.collectSheetEvent("sheet_calculation_cache_hit_rate_dev",Object.assign({},e,{is_sheet:!1,is_first:!0}))}}},{key:"reportCacheHitRate",value:function(e){if(this.lock)this.reportIdsQueue.push(e);else if(this.shouldReport){var t=this.getCacheHitRateData(e);t.formula_count<=0||Ce.PxA.collectSheetEvent("sheet_calculation_cache_hit_rate_dev",Object.assign({},t,{is_sheet:!0,is_first:!1}))}}}]),e}();iF=lF.ModuleInitStartTime,uF=lF.CalculationStartTime,sF=lF.ReceiveCompleteServerSideCacheTime;var gF,yF,_F=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).bizType="conditionalFormat",e}return(0,p.Z)(t,e),t}(mF),RF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).bizType="pivot",e.allPivotCalcTime=0,e.pivotCalcCount=0,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"onCalcEnd",value:function(e,t){this.allPivotCalcTime+=e,this.pivotCalcCount+=t}},{key:"onCalcFinished",value:function(){this.allPivotCalcTime<=0||(Ce.QYs.reportAllPivotPerformance({sub_event_name:"pivot_formula_all_calculated",duration_time:this.allPivotCalcTime,calc_pivot_count:this.pivotCalcCount}),Ce.QYs.reportAllPendingTrackData(),this.allPivotCalcTime=0,this.pivotCalcCount=0)}},{key:"collectCalcData",value:function(e){Ce.QYs.fromPendingTrackerInfo([e])}}]),t}(mF);function CF(e){return{isError:!0,errorType:e}}function wF(e){return{isError:!1,dataView:e}}!function(e){e.Cache="Cache",e.Cube="Cube",e.View="View"}(gF||(gF={})),function(e){e.onCacheCalculateStart="onCacheCalculateStart",e.onCacheCalculated="onCacheCalculated",e.onCubeCalculateStart="onCubeCalculateStart",e.onCubeCalculated="onCubeCalculated",e.onViewCalculateStart="onViewCalculateStart",e.onViewCalculated="onViewCalculated"}(yF||(yF={}));var EF=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).spread=e,r.cacheMap=new Map,r.cubeMap=new Map,r.dataViewMap=new Map,r.cacheDirtyMap=new Map,r.cubeDirtyMap=new Map,r.pivotStatistics=new RF,r.pivotService=e.pivotService,r.pivotService.setI18n(cr),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getCacheJSON",value:function(e){var t;return null===(t=this.cacheMap.get(e))||void 0===t?void 0:t.toJSON()}},{key:"getSnapshot",value:function(e){return this.spread.getPivotSyncModelManager().getSnapshot(e)}},{key:"getData",value:function(e,t){if(t){var r=Ps(e.workbook,t);if(r){var n=t.startRow,a=t.startCol,o=ni(t),i=ai(t);return this.spread.getPivotDataSourceManagerV2().getData(r,n,a,o,i,e)}}}},{key:"getHeaderData",value:function(e,t,r){if(r){var n=Ps(e.workbook,r);if(n){var a=r.startRow,o=r.startCol,i=ai(r);return this.spread.getPivotDataSourceManagerV2().getData(n,a,o,1,i,e)}}}},{key:"checkHeaderValid",value:function(e,t,r){if(!r)return!1;var n=this.getHeaderData(e,t,r);if(!n)return!1;var a=this.getSnapshot(t);if(!a||(0,ue.default)(a))return!1;var o=a.cacheFieldInfo,i=r.startCol;return function(e,t){e&&0!==e.length||(e=new Array(i||0));for(var r=0;r<t.length;r++){var n=e[r];if(void 0!==n&&""!==n&&null!==n||(n=(0,Ft.V8)(cr,(0,Ft.Og)(i+r+1))),!t[r].fieldName.includes(n.toString()))return!1}return!0}(n.data[0],(0,Rt.L9)(n.formatMap,o))}},{key:"markDirtyCache",value:function(e){this.cacheDirtyMap.set(e,!0)}},{key:"clearDirtyCache",value:function(e){this.cacheDirtyMap.set(e,!1)}},{key:"markDirtyCube",value:function(e){this.cubeDirtyMap.set(e,!0)}},{key:"clearDirtyCube",value:function(e){this.cubeDirtyMap.set(e,!1)}},{key:"isCacheDirty",value:function(e){return!!this.cacheDirtyMap.get(e)}},{key:"isCubeDirty",value:function(e){return!!this.cubeDirtyMap.get(e)}},{key:"calculateCache",value:function(e,t,r){var n,a=this,o=(e.customCtx||{}).source,i=this.cacheDirtyMap.get(t),u=this.cacheMap.get(t),s=function(e){return a.pivotStatistics.collectCalcData({pivotName:t,stage:Ce.W9G.CALCULATE_CACHE,collectData:{has_refresh_cache:e}})};if(!i&&u)return this.getData(e,r),s(!1),u;if(o!==oF.SnapshotChanged||this.checkHeaderValid(e,t,r)){var l=this.getData(e,r);if(l){var c=this.getSnapshot(t),h={row:r.startRow,col:r.startCol,rowCount:ni(r),colCount:ai(r)};if(c&&!(0,ue.default)(c)){var f=(0,Rt.K9)(null!==(n=u)&&void 0!==n?n:c.cacheName,h,l,c,this.pivotService);if(f)return s(!0),this.cacheMap.set(t,f),this.clearDirtyCache(t),f;s(!1)}else s(!1)}else s(!1)}else s(!1)}},{key:"calculateCube",value:function(e){var t=this,r=this.cubeDirtyMap.get(e),n=this.cubeMap.get(e),a=function(r){return t.pivotStatistics.collectCalcData({pivotName:e,stage:Ce.W9G.CALCULATE_CUBE,collectData:{has_refresh_cube:r}})};if(!r&&n)return a(!1),n;var o=this.cacheMap.get(e),i=this.getSnapshot(e);if(o&&i&&!(0,ue.default)(i)&&!(0,ue.default)(i.fields)){var u=(0,Rt.ak)(o,i,this.pivotService);return this.cubeMap.set(e,u),this.clearDirtyCube(e),a(!0),u}a(!1)}},{key:"calculateView",value:function(e,t,r){var n=e.customCtx||{},a=n.markDirtyCache,o=void 0===a||a,i=n.markDirtyCube,u=void 0===i||i,s=this.dataViewMap.get(t),l=this.isCacheDirty(t),c=this.isCubeDirty(t);if(!o&&!u&&s&&!l&&!c)return this.getData(e,r),wF(s);o&&this.markDirtyCache(t),u&&this.markDirtyCube(t),this.emit(yF.onCacheCalculateStart,t);var h=this.calculateCache(e,t,r);if(this.emit(yF.onCacheCalculated,t,Boolean(h)),!h)return console.log("[PIVOT] calculate cache error @blockToken: ",t),CF(gF.Cache);this.emit(yF.onCubeCalculateStart,t);var f=this.calculateCube(t);if(this.emit(yF.onCubeCalculated,t,Boolean(f)),!f)return console.log("[PIVOT] calculate cube error @blockToken: ",t),CF(gF.Cube);this.emit(yF.onViewCalculateStart,t);var d=this.getSnapshot(t);if(!d||(0,ue.default)(d)||(0,ue.default)(d.fields))return console.log("[PIVOT] calculate view error @blockToken: ",t),this.emit(yF.onViewCalculated,t,!1),CF(gF.View);var v=(0,Rt.MP)(h,f,d,this.pivotService);return this.dataViewMap.set(t,v),this.emit(yF.onViewCalculated,t,!0),wF(v)}},{key:"getDataView",value:function(e){return this.dataViewMap.get(e)}},{key:"getDataSourceInfo",value:function(e,t){var r;return null===(r=this.cacheMap.get(e))||void 0===r?void 0:r.getDataSourceInfo(t)}},{key:"reset",value:function(){this.cacheMap.forEach((function(e){return e.reset()})),this.cacheMap.clear(),this.cubeMap.forEach((function(e){return e.dispose()})),this.cubeMap.clear(),this.dataViewMap.forEach((function(e){return e.destroy()})),this.dataViewMap.clear(),this.cacheDirtyMap.clear(),this.cubeDirtyMap.clear(),this.pivotService.dispose()}},{key:"dispose",value:function(){this.reset()}}]),t}(Ce.vpe),kF=new Set(["AI_WRITE","AI_DEEPSEEK_WRITE","AI_ASK","AI_CLASSIFY","AI_EXTRACT","AI_IMPORTDATA","AI_INFER","AI_POLISH","AI_SENTIMENT","AI_SUMMARY","AI_TRANSLATE"].concat(["IMPORTRANGE","LOOKUP","RAND","TODAY","NOW","COLUMN","COLUMNS","VLOOKUP","XLOOKUP","XMATCH","ROW","ROWS","QUERY","OFFSET","MATCH","INDEX","HLOOKUP","HYPERLINK"])),TF=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).pivotIllegalFuncs=kF,r.spread=e,r.calcEngine=new Q1,r.compiler=new SF(r.calcEngine),r.builders=new Map,r.formulaVarsMap=new Map,r.dependencyMap=new Map,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"translateFieldName",value:function(e){return"'"+e+"'"}},{key:"compileFormula",value:function(e,t,r){for(var n=nw.getTractorParserA1().getBaseCstVisitorConstructor(),a=r.concat(),o=0;o<a.length;o++){var i=a[o],u=this.translateFieldName(i);a[o]=u}var s=new(function(e,t){var r=new Set(t);return function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"referenceFunction",value:function(e){if(void 0!==e.LocalReferenceA1){var t=e.LocalReferenceA1[0].image;this.visitLocalRef(t)}else if(void 0!==e.ExternalReferenceA1){var n=e.ExternalReferenceA1[0].image;this.visitExternalRef(n)}else if(void 0!==e.RefConstant)this.visitError(it.REF_ERR_VAR.getValue());else if(void 0!==e.Name)this.visitNameRef(e);else if(void 0!==e.FieldNameLocalReferenceA1)this.visitFieldNameRef(e,r);else if(void 0!==e.parenExp)this.visit(e.parenExp);else{if(void 0===e.funcExp)throw new Error("Invalid token in the referenceFunction expression!");this.visit(e.funcExp)}}}]),t}(Vk(Nk(e)))}(n,a));this.builders.set(e,s),this.compiler.setVisitBuilder(s);var l={spread:this.spread,ref:new uu(-1,-1,this.spread.getActiveSheet()),enableCalculation:!0},c=this.compiler.compile(t,l),h=c.errors,f=c.formulaVar;if(h||!f)return{errors:h,dependency:{},formulaVar:null,functionNames:null};var m=this.getFunctionInVar(f),g=m.functionNameSet,R=m.hasIllegalFunc,C=this.builders.get(e).getRefs(),w={};for(var E in C)w[E]=C[E].namespace();return{errors:h,dependency:w,formulaVar:f,builder:s,functionNames:g,hasIllegalFunc:R}}},{key:"decompileFormula",value:function(e,t){var r=e.formula.tokens;if(null===r)throw new Error("failed to decompile formula without tokens");return yp({tokens:r,refStringGen:function(e){return t[e]},params:e.formula.params})}},{key:"decompile",value:function(e,t,r){var n=this.compileFormula(e,t,r),a=n.formulaVar,o=n.errors,i=n.dependency;try{if(!o&&a)return this.decompileFormula(a,i)}catch(e){console.error("Error decompiling formula:",e)}return t}},{key:"initFormula",value:function(e,t,r,n){var a=this.compileFormula(e,r,n),o=a.formulaVar,i=a.errors,u=a.dependency;return i||!o?(this.updateFormulaMap(e,t,null,{}),{errors:i,dependency:{},formulaVar:null}):(this.updateFormulaMap(e,t,o,u),{errors:i,dependency:u,formulaVar:o})}},{key:"updateFormulaMap",value:function(e,t,r,n){void 0===this.formulaVarsMap.get(e)&&this.formulaVarsMap.set(e,{}),this.formulaVarsMap.get(e)[t]=r,void 0===this.dependencyMap.get(e)&&this.dependencyMap.set(e,{}),this.dependencyMap.get(e)[t]=n}},{key:"getFunctionInVar",value:function(e){for(var t=new Set,r=e.formula.expression,n=!1,a=r.length-1;a>=0;a--){var o=r[a];if(o.isOp()){var i=o.op();if(i instanceof it.FuncOpBase){var u=i.name;this.pivotIllegalFuncs.has(u)&&(n=!0),t.add(u)}}}return{functionNameSet:t,hasIllegalFunc:n}}},{key:"getValue",value:function(e,t,r){var n,a,o,i=this.builders.get(e),u=null===(n=this.formulaVarsMap.get(e))||void 0===n?void 0:n[t],s=null===(a=this.dependencyMap.get(e))||void 0===a?void 0:a[t];if(!i||!u||!s)throw new Error("\n        failed to get value without builder or formulaVar or dependency,\n        has builder: ".concat(Boolean(i),",\n        has formulaVar: ").concat(Boolean(u),",\n        has dependency: ").concat(Boolean(s),"\n      "));var l=u.getRefMap();for(var c in u.markDirty(),l){var h=s[c],f=h.length;"'"===h[0]&&"'"===h[f-1]&&(h=h.substr(1,f-2)),l[c].setData(r[h],h)}ov(u,av(this.spread,this.calcEngine.formulaService));var d=u.getVar(),v=d.getValue();return ja(d)&&void 0!==d.errorCode?{isError:!0,value:v,errorCode:d.errorCode,errorInfoArgs:null===(o=d.info)||void 0===o?void 0:o.args}:{isError:!1,value:v}}},{key:"getRefList",value:function(e,t){var r,n,a=null===(r=this.formulaVarsMap.get(e))||void 0===r?void 0:r[t],o=null===(n=this.dependencyMap.get(e))||void 0===n?void 0:n[t],i=[];if(a&&o){var u=a.getRefMap();for(var s in u){var l=o[s],c=l.length;"'"===l[0]&&"'"===l[c-1]&&(l=l.substr(1,c-2)),i.push(l)}}return i}},{key:"renameField",value:function(e,t,r,n){var a=this.builders.get(e),o=null==a?void 0:a.getTokens();return a&&o?o.map((function(e){var a=t[e];return a?a===r?n:a:e})).join():""}}]),t}(Rt.G7),SF=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"compile",value:function(e,t){var r;void 0===t.refStyle&&(t.refStyle="A1");var n,a=[],o=this.compileTokens(e,"A1"),i=o.lexer,u=yr(null!==(r=o.errors)&&void 0!==r?r:[]);try{for(u.s();!(n=u.n()).done;){var s=n.value;a.push(s)}}catch(e){u.e(e)}finally{u.f()}var l=nw.getTractorParserA1(uf);l.input=o.tokens;var c,h=l.entry(),f=yr(l.errors);try{for(f.s();!(c=f.n()).done;){var d=c.value;a.push(d)}}catch(e){f.e(e)}finally{f.f()}if(a.length>0)return{formulaVar:null,lexer:i,parser:l,errors:a};var v=null;try{v=this.builder.visitTree(h,t)}catch(e){a.push(e)}if(null==v)return{formulaVar:null,lexer:i,parser:l,errors:a};var p=this.calcEngine.formulaRefService.fromBuilder(this.builder,t.ref,null,v,null,!0),m=(0,g.Z)(p,2),y=m[0],_=m[1],R=this.calcEngine.createFormula(t.ref,{refMap:_,formula:y,isArrayFormula:this.builder.isArrayFormula}),C={};for(var w in _)C[w]=new Is(_[w]);return R.setRefMap(C),{formulaVar:R,lexer:i,parser:l,errors:0===a.length?null:a}}},{key:"compileTokens",value:function(e,t){var r=lf(e,t),n=r.lexingResult,a=n.tokens,o=n.errors;return{tokens:a,lexer:r.lexer,errors:0===o.length?null:o}}}]),t}(Gk),AF=Symbol(),IF=Symbol(),OF=Symbol(),VF=function(){function e(t,r){(0,y.Z)(this,e),this.calcEngine=t,this.spread=r,this.blockRefMap=new Map,this.formulaMap=new Map,this.formulaKeyMap=new Map,this.suspended=0,this._subscribers=[],this._firstLoadFormula=!0,this._collectEffect=new Map,this._loadPinyinModuleCompleted=(0,Ce.n5s)(),this.pivotCalcService=new EF(r),this.syncModelManager=r.getPivotSyncModelManager(),this.bindEvents()}return(0,_.Z)(e,[{key:"suspend",value:function(){this.suspended++}},{key:"resume",value:function(){this.suspended<=0||this.suspended--}},{key:"isSuspended",value:function(){return this.suspended>0}},{key:"bindEvents",value:function(){this._subscribers.push(this.spread.subscribe(this.getWorkbookEvents()),this.syncModelManager.subscribe(this.getPivotSyncModelEvents())),this.calcEngine.formulaService.addListener(it.FormulaEvents.onFormulaValueChanged,this.handleFormulaValueChanged)}},{key:"unbindEvents",value:function(){this._subscribers.forEach((function(e){return e.unsubscribe()})),this.calcEngine.formulaService.removeListener(it.FormulaEvents.onFormulaValueChanged,this.handleFormulaValueChanged)}},{key:"getWorkbookEvents",value:function(){return{EmbeddedBlockChanged:this.handleEmbeddedBlockChanged,PivotDataSourceChanged:this.handleDataSourceChanged}}},{key:"collectEffect",value:function(e){var t,r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];this._collectEffect.get(e)||this._collectEffect.set(e,[]),null===(t=this._collectEffect.get(e))||void 0===t||t.push(r)}},{key:"getPassiveEffect",value:function(e){if(this._collectEffect.get(e))return this._collectEffect.get(e).every(Boolean)}},{key:"resumeEffect",value:function(e){this._collectEffect.delete(e)}},{key:"loadPinyinModule",value:function(){var e=this;(0,Ce.QFC)().finally((function(){e.onLoadPinyinCompleted()}))}},{key:"onLoadPinyinCompleted",value:function(){this._loadPinyinModuleCompleted=!0;var e,t=[],r=yr(this.formulaMap.values());try{for(r.s();!(e=r.n()).done;){var n=e.value;n.markDirty(),t.push(n.getRef())}}catch(e){r.e(e)}finally{r.f()}this.calcEngine.markDirty(t)}},{key:"getPivotSyncModelEvents",value:function(){return{SnapshotChanged:this.handlePivotSnapshotChanged}}},{key:"addPivotCalcEventListener",value:function(e){for(var t in e){var r=e[t];this.pivotCalcService.addListener(t,r)}}},{key:"removePivotCalcEventListener",value:function(e){for(var t in e){var r=e[t];this.pivotCalcService.removeListener(t,r)}}},{key:"getTokenByFormula",value:function(e){if(pv(e)){var t=this.getFormulaKeyByFml(e);if(t)return this.formulaKeyMap.get(t)}}},{key:"getPivotSheetByBlockToken",value:function(e){var t,r=this.formulaMap.get(e);if(r)return null===(t=r.getRef())||void 0===t?void 0:t.sheet()}},{key:"markDirtyByBlockToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.handleFormulaCalc(e,Object.assign({markDirtyCache:!0,markDirtyCube:!0,isPassive:!0,source:oF.SnapshotChanged},t))}},{key:"markDirtyBySheetId",value:function(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=yr(this.formulaKeyMap);try{for(n.s();!(t=n.n()).done;){var a=(0,g.Z)(t.value,2),o=a[0],i=a[1],u=o.split("_"),s=(0,g.Z)(u,1),l=s[0];e===l&&this.handleFormulaCalc(i,Object.assign({markDirtyCache:!0,markDirtyCube:!0,isPassive:!0,source:oF.SnapshotChanged},r))}}catch(e){n.e(e)}finally{n.f()}}},{key:"getFormulaKeyByFml",value:function(t){if(!pv(t))return"";var r=t.getRef(),n=t.getId(),a=null==r?void 0:r.sheet();if(!r||!n||!a)return"";var o=a.id();return e.getFormulaKey(o,n)}},{key:"getFormulaKeys",value:function(){return Array.from(this.formulaKeyMap.keys())}},{key:"handleFormulaValueChanged",value:function(e){var t=this.getFormulaKeyByFml(e);if(t){var r=this.formulaKeyMap.get(t);if(void 0!==r){this.resumeEffect(r);var n=e.getState().cache;if(null!=n){var a=e.getRef().sheet();if(a){var o=n.getRawVar();a.dispatch("PivotFormulaCalculated",{blockToken:r,sheetId:a.id()});var i=o.getValue();this._watchExpandArea(e,o.type===it.VAR_TYPE.CUSTOM_PRIMITIVE&&(null==i?void 0:i.dataView)instanceof Rt.b$?this.getArrayRefByFml(e):null),this.calcEngine.pivotStatistics.isFirstApplyResult||this.calcEngine.pivotStatistics.onFirstApplyResult(1)}}}}}},{key:"getPivotFormulaCount",value:function(){return this.formulaMap.size}},{key:"getArrayRefByFml",value:function(e){if(!pv(e))return[];var t=e.getRef(),r=t.sheet();if(!r)return[];var n=e.getState().cache;if(!n)return[];var a=n.getRawVar().getValue(),o=null==a?void 0:a.dataView;if(o instanceof Rt.b$){var i=o.getRangeSize(),u=RT(r,t.startRow,t.startCol,i.page,i.content);return[u.pageRange,u.contentRange].filter(Boolean)}return[new ou(t.startRow,t.startCol,1,1,r)]}},{key:"handlePivotSnapshotChanged",value:function(e){var t=e.blockToken,r=e.data;if("snapshotSet"===r.type)this.handleFormulaCalc(t,{markDirtyCache:!0,markDirtyCube:!0,isPassive:r.isPassive,source:oF.SnapshotChanged});else{var n=r.prevSnapshot,a=r.snapshot,o=r.isPassive,i=r.ops,u=(null==n?void 0:n.rangeId)!==(null==a?void 0:a.rangeId)||i.some((function(e){var t,r;return null===(t=e._pivotExtra)||void 0===t||null===(r=t.rebuildCache)||void 0===r?void 0:r.needRebuild}))||o&&i.some((function(e){return e.p.includes("cacheFieldInfo")}));this.handleFormulaCalc(t,{markDirtyCache:u,markDirtyCube:!0,isPassive:o,source:oF.SnapshotChanged})}}},{key:"handleDataSourceChanged",value:function(e){var t=e.blockToken,r=e.source,n=this.blockRefMap.get(t);n&&r!==yV.FORMULA_REF_ADJUST&&this.setPivotTableFormula(t,n)&&this.handleFormulaCalc(t,{markDirtyCache:!0,markDirtyCube:!0,isPassive:r===yV.PASSIVE,source:oF.PivotDataSourceRanged})}},{key:"handleEmbeddedBlockChanged",value:function(e,t,r){var n=e.embeddedBlockChangeParams,a=e.sheetId,o=function(e){return!e||e===vV.UNDO||e===vV.REDO||e===vV.COLLA}(r),i=n.changeType,u=n.blockToken,s=n.embeddedBlock;switch(i){case 2:return void this.deletePivotTableFormula(u);case 1:var l=s.position,c=this.spread.getSheetFromId(a),h=new uu(l.row,l.col,c);return this.blockRefMap.set(u,h),void(this.formulaMap.get(u)?this.handleFormulaCalc(u,{markDirtyCache:!1,markDirtyCube:!1,isPassive:!0,source:oF.EmbeddedBlockChanged}):this.setPivotTableFormula(u,h)&&this.handleFormulaCalc(u,{markDirtyCache:!0,markDirtyCube:!0,isPassive:o,source:oF.EmbeddedBlockChanged}));case 3:return void this.handleFormulaCalc(u,{markDirtyCache:!1,markDirtyCube:!1,isPassive:!0,source:oF.EmbeddedBlockChanged})}}},{key:"getFormula",value:function(e){return this.formulaMap.get(e)}},{key:"getFormulaByPos",value:function(e,t,r){var n,a=yr(this.formulaMap.values());try{for(a.s();!(n=a.n()).done;){var o,i=n.value,u=i.getRef();if(u.rowFrom()===e&&u.colFrom()===t&&(null===(o=u.sheet())||void 0===o?void 0:o.id())===r)return i}}catch(e){a.e(e)}finally{a.f()}}},{key:"createFormulaStr",value:function(e){var t=this.spread.getPivotDataSourceManagerV2().getSourceRange(e);return t?"PRIVATE_PIVOT_TABLE(".concat(t.toString({isShowSheetName:!0,ref:t}),', "').concat(e,'")'):""}},{key:"setPivotTableFormula",value:function(e,t){if(this.isSuspended())return!1;var r=this.createFormulaStr(e);if(!r||!t)return!1;var n=this.calcEngine.compile(r,{spread:this.spread,ref:t}),a=n.formulaVar;if(n.errors||!a)return!1;this.formulaMap.get(e)&&this.deletePivotTableFormula(e),a.setId(e),this.calcEngine.formulaSpace.registerFml(a);var o=this.getFormulaKeyByFml(a);if(!o)return!1;this._initializeFormulaRefWatcher(a),this.formulaKeyMap.set(o,e),this.formulaMap.set(e,a),this.blockRefMap.set(e,t),this.calcEngine.pivotStatistics.add(t.hostId,lF.FormulaCount);var i=!(this.calcEngine instanceof e2);return this._firstLoadFormula&&i&&!this._loadPinyinModuleCompleted&&(this._firstLoadFormula=!1,(0,Ce.n5s)()?this.onLoadPinyinCompleted():this.loadPinyinModule()),this.calcEngine.pivotStatistics.isModuleInit||this.calcEngine.pivotStatistics.initModule(),!0}},{key:"deletePivotTableFormula",value:function(e){var t=this.formulaMap.get(e);if(t){for(var r=[IF,AF,OF],n=0;n<r.length;++n){var a=r[n];t[a]&&(t[a](),t[a]=null)}this.calcEngine.formulaSpace.unRegisterFml(t);var o=this.getFormulaKeyByFml(t);this.formulaKeyMap.delete(o),this.formulaMap.delete(e),this.calcEngine.pivotStatistics.sub(t.getRef().hostId,lF.FormulaCount),this.blockRefMap.delete(e)}}},{key:"_initializeFormulaRefWatcher",value:function(e){var t=this,r=this.calcEngine.depRefManager,n=e.getRef();this._watchSourceArea(e);var a=n.clone();e[AF]&&e[AF](),e[AF]=r.watchRef(n,null,null,(function(r,o){var i=a.startRow-r.startRow,u=a.startCol-r.startCol;a=n.clone();for(var s={},l=Object.keys(e.refMap),c=0;c<l.length;++c)s[l[c]]=Di(e.refMap[l[c]],i,u);e.refMap=s;var h=n.sheet(),f=t.getTokenByFormula(e);if(h&&f){var d=h.getPivotTableManager(),v=d.getPivotInfoByToken(f);if(v){var p,m,g=Object.assign({},v,{pageRange:null===(p=v.pageRange)||void 0===p?void 0:p.clone(),contentRange:null===(m=v.contentRange)||void 0===m?void 0:m.clone()});d.updatePivotTableInfoByPosition(f,n.startRow,n.startCol);var y=d.getPivotInfoByToken(f),_=[g.pageRange,g.contentRange,g.spanRange,null==y?void 0:y.pageRange,null==y?void 0:y.contentRange,null==y?void 0:y.spanRange].filter(Boolean);e.markDirty(),t.calcEngine.markDirty(_,{pivotToken:f}),_.forEach((function(e){h.dispatch("PivotTableRangeChanged",{range:e})}))}}})),e[OF]&&e[OF](),e[OF]=null}},{key:"updateFormulaRefs",value:function(e,t){var r=t.getRef();t.refMap={R1:Tu(e,r)},this._watchSourceArea(t);var n=r.sheet();if(n){var a=n.getPivotTableManager().getPivotInfoByToken(t.getId());a&&[a.pageRange,a.contentRange,a.spanRange].filter(Boolean).forEach((function(e){n.dispatch("PivotTableRangeChanged",{range:e})}))}}},{key:"_watchSourceArea",value:function(e){var t=this;e[IF]&&e[IF](),e[IF]=this.calcEngine.depRefManager.watchRef(ku(e.refMap.R1,e.getRef()),(function(r,n){e.isDirty()||t.markDirtyFormula(e)}),null,(function(r,n){t.updateFormulaRefs(r,e),t.markDirtyFormula(e,{markDirtyCache:!0,markDirtyCube:!0})}),(function(r,n){t.updateFormulaRefs(r,e),t.markDirtyFormula(e,{markDirtyCache:!0,markDirtyCube:!0})}))}},{key:"_watchExpandArea",value:function(e,t){var r=this;e[OF]&&(e[OF](),e[OF]=null),t&&t.length&&(e[OF]=this.calcEngine.depRefManager.watchRefs(t,(function(n,a,o){var i,u=e.getRef(),s=u.sheet();if(s){var l=r.getFormulaKeyByFml(e);if(l){var c=r.formulaKeyMap.get(l);if(c&&(null==a?void 0:a.pivotToken)!==c){var h=null===(i=e.getState().cache)||void 0===i?void 0:i.getRawVar();if(h){n&&(r.markDirtyFormula(e),t.forEach((function(e){s.dispatch("PivotTableRangeChanged",{range:e})})));var f=h.getValue();if((null==f?void 0:f.dataView)instanceof Rt.b$){if(o&&o.some((function(e){return function(e,t){return e.startRow===t.startRow&&e.endRow===t.endRow&&e.startCol===t.startCol&&e.endCol===t.endCol&&e.hostId===t.hostId&&e.hostName===t.hostName&&e.status===t.status}(u,e)})))return;var d=s.getPivotTableManager().getPivotErrorStateByCell(u.startRow,u.startCol)!==Pp.None;if(h.type===it.VAR_TYPE.CUSTOM_PRIMITIVE){var v=f.dataView.getRangeSize(),p=RT(s,u.startRow,u.startCol,v.page,v.content),m=[p.pageRange,p.contentRange].filter(Boolean);if((!o||o.some((function(e){return function(e){return m.some((function(t){return t.isIntersect(e)}))}(e)})))&&m.some((function(e){return!function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=e.getPivotTableManager(),a=t.rowFrom(),o=t.colFrom();if(a<0||o<0)return!1;var i=t.rowCount(!0),u=t.colCount(!0),s=e.getRowCount(),l=e.getColumnCount(),c=o+u>l?o+u-l:0,h=a+i>s?a+i-s:0,f=(0,Ce.$$w)();if((c||h)&&(s+h)*(l+c)>f)return!1;if(i!==t.rowCount(!0)||u!==t.colCount(!0))return!1;if(e.checkRangesProtected(t))return!1;if(n.isIntersectPivotTable(a,o,i,u,r))return!1;var d=function(){return e._spanModel.iter(t.rowFrom(),t.colFrom(),t.rowTo(),t.colTo(),!0).next()},v=function(){return e._getModel().iterDataValidation(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()).next()};return!(e._getModel().iterContent(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount(),!0).next()||d()||v())}(s,e,[c])}))===d)return void r._watchExpandArea(e,m)}s.dispatch("PivotFormulaCalculated",{blockToken:c,sheetId:s.id()})}}}}}})))}},{key:"handleFormulaCalc",value:function(e,t){var r;this.collectEffect(e,null!==(r=t.isPassive)&&void 0!==r&&r);var n=this.formulaMap.get(e);if(!n)return!1;if(!this._loadPinyinModuleCompleted)return!1;t.isPassive=this.getPassiveEffect(e),this.resumeEffect(e),this.markDirtyFormula(n);var a=av(this.spread,this.spread.calcEngine.formulaService),o=t||{markDirtyCache:!0,markDirtyCube:!0,isPassive:!0};return a.customCtx=o,ov(n,a),!0}},{key:"markDirtyFormula",value:function(e,t){var r=this.getFormulaKeyByFml(e),n=this.formulaKeyMap.get(r);t&&n&&(t.markDirtyCache&&this.pivotCalcService.markDirtyCache(n),t.markDirtyCube&&this.pivotCalcService.markDirtyCube(n)),e.markDirty(),this.calcEngine.markDirty([e.getRef()],{isDirtyAlwaysCalc:!1,pivotToken:e.getId()})}},{key:"resetFormula",value:function(){this.formulaMap.clear(),this.formulaKeyMap.clear()}},{key:"destoryBySheetId",value:function(e){var t,r=yr(this.formulaKeyMap);try{for(r.s();!(t=r.n()).done;){var n=(0,g.Z)(t.value,2),a=n[0],o=n[1],i=a.split("_");e===(0,g.Z)(i,1)[0]&&(this.blockRefMap.delete(o),this.formulaMap.delete(o),this.formulaKeyMap.delete(a),this.syncModelManager.deleteSyncModel(o))}}catch(e){r.e(e)}finally{r.f()}this.calcEngine.pivotStatistics.remove(e)}},{key:"dispose",value:function(){this.unbindEvents(),this.syncModelManager.dispose(),this.pivotCalcService.reset(),this.blockRefMap.clear(),this.resetFormula()}}],[{key:"getFormulaKey",value:function(e,t){return"".concat(e,"_").concat(t)}}]),e}();Vu([(0,Mt.Bind)()],VF.prototype,"handleFormulaValueChanged",null),Vu([(0,Mt.Bind)()],VF.prototype,"handlePivotSnapshotChanged",null),Vu([(0,Mt.Bind)()],VF.prototype,"handleDataSourceChanged",null),Vu([(0,Mt.Bind)()],VF.prototype,"handleEmbeddedBlockChanged",null);var NF,bF,MF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.COLLECTION,e.paramsDesc=[YE.SHEET_REF,YE.SHEET_REF],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$cacheType=0,e.$$paramsDesc=[64],e}return(0,p.Z)(t,e),t}(it.BinaryOpBase),FF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name=":",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=function(e,t){if(0===t.length)return it.NULL_ERR_VAR;for(var r=t[0].getRef(),n=0;n<t.length;n++)for(var a=t[n],o=Qa(a)?a.getRefs():[a.getRef()],i=0;i<o.length;++i){var u,s,l=o[i];if(r.hostId!==l.hostId)return Ce.d$b[Ce.O6N.RANGE_CAN_ONLY_REFERENCE_ONE_SHEET]({firstSheetName:r.hostName||(null===(u=Ps(e,r))||void 0===u?void 0:u.name())||"",secondSheetName:l.hostName||(null===(s=Ps(e,l))||void 0===s?void 0:s.name())||""});r=Qi.fromGridRange(Jo(r,l))}return new Fs(r)}(e.workbook,t);if(ja(r)||r instanceof ks)return r;var n=r.getRef();return e.info&&(Array.isArray(e.info.customDepends)?e.info.customDepends.push(n):e.info.customDepends=[n]),r}}]),t}(MF),ZF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name=" ",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return function(e,t){for(var r=Qa(e)?e.getRefs():[e.getRef()],n=Qa(t)?t.getRefs():[t.getRef()],a=[],o=0;o<n.length;++o)for(var i=n[o],u=0;u<r.length;++u){var s=r[u];if(s.hostId===i.hostId){var l=Qi.fromGridRange(Ko(s,i));Ci(l)&&a.push(l)}}if(0===a.length)return it.NULL_ERR_VAR;if(a.length>1){for(var c=[],h=0;h<a.length;++h)c.push(new Fs(a[h]));return Zs(c,(function(e){for(var t=[],r=[],n=0;n<e.length;++n){var a=e[n];t.push(a.getRef()),r.push(a.cache)}return new As(t,r)}))}return to(e)||to(t)?new Fs(a[0]):new Ss(a[0],e.cache)}(t[0],t[1])}}]),t}(MF),xF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name=",",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=(0,g.Z)(t,2),n=r[0],a=r[1],o=[],i=[],u=[],s=[];return Qa(n)?(Array.prototype.push.apply(o,n.getRefs()),Array.prototype.push.apply(i,n.caches)):(o.push(n.getRef()),to(n)?(u.push(n),s.push(i.length),i.push(null)):i.push(n.cache)),Qa(a)?(Array.prototype.push.apply(o,a.getRefs()),Array.prototype.push.apply(i,a.caches)):(o.push(a.getRef()),to(a)?(u.push(a),s.push(i.length),i.push(null)):i.push(a.cache)),u.length>0?Zs(u,(function(e){for(var t=0;t<e.length;++t){var r=s[t],n=e[t];o[r]=n.getRef(),i[r]=n.cache}return new As(o,i)})):new As(o,i)}}]),t}(MF),DF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ABS",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(ja(r))return r;var n=r.getValue();return new it.NumberVar(Math.abs(n))}}]),t}(it.FuncOpBase),PF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ACOS",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return r<-1||r>1?it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:1,value:r,lowerBound:-1,upperBound:1}):new it.NumberVar(Math.acos(r))}}]),t}(it.FuncOpBase),$F=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ACOSH",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return r<1?it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:1,value:r,lowerBound:1}):new it.NumberVar(Math.acosh(r))}}]),t}(it.FuncOpBase),LF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="AND",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.BOOL|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.BOOL|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=!0,n=!0,a=0;a<t.length;++a){var o=t[a];Ba(o)&&(o=Dc(o)||Rl(this.name,a+1,El(o),wl(o),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN));var i=o.forEach((function(e){if(ja(e))return e;n&&10&e.$$type&&(r=!1,e.getValue()||(n=!1))}));if(i)return i}return r?Gl(this.name):new it.BooleanVar(n)}}]),t}(it.FuncOpBase),BF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ASC",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.StringVar(function(e){for(var t="",r=0;r<e.length;r++){var n=e[r],a=e.charCodeAt(r);if(a>=65281&&a<=65374)t+=String.fromCharCode(65535&(a-65248|0));else{var o=UF();if(Object.prototype.hasOwnProperty.call(o,n))t+=o[n];else{var i=HF();Object.prototype.hasOwnProperty.call(i,n)?t+=i[n]:t+=n}}}return t}(t[0].getValue()))}}]),t}(it.FuncOpBase);function UF(){return NF||(NF={"":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}),NF}function HF(){return bF||(bF={"":"","":"`","":"'","":'"',"":"","":"","":"","":"","":" "}),bF}var zF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ASIN",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return r<-1||r>1?it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:1,value:r,lowerBound:-1,upperBound:1}):new it.NumberVar(Math.asin(r))}}]),t}(it.FuncOpBase),WF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ASINH",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(Math.asinh(r))}}]),t}(it.FuncOpBase),GF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ATAN2",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();return 0===r&&0===n?it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_FUNCTION_EVAL]({funcName:this.name}):new it.NumberVar(Math.atan2(n,r))}}]),t}(it.FuncOpBase),jF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ATAN",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(Math.atan(r))}}]),t}(it.FuncOpBase),YF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ATANH",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return r<=-1||r>=1?it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:1,value:r,lowerBound:-1,upperBound:1}):new it.NumberVar(Math.atanh(r))}}]),t}(it.FuncOpBase),qF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="AVEDEV",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0,a=0;a<t.length;++a){var o=t[a];if(Ba(o)){if(ja(o))return o;if(!za(o)){var i=o.toNumberVar(e.service);if(qa(i))return Rl(this.name,a+1,El(o),wl(o),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);o=i}var u=o.getValue();n+=u,r.push(u)}else for(var s=o.rowCount(),l=o.colCount(),c=0;c<s;++c)for(var h=0;h<l;++h){var f=o.at(c,h);if(ja(f))return f;if(za(f)){var d=f.getValue();n+=d,r.push(d)}}}var v=r.length;if(0===v)return it.tractorErrorVarCreators[it.ErrorCode.NUM_DIVIDE_BY_ZERO_FROM_FUNCTION_EVAL]({funcName:this.name});for(var p=n/v,m=0,g=0;g<v;++g)m+=Math.abs(r[g]-p)/v;return new it.NumberVar(m)}}]),t}(it.FuncOpBase);function JF(e,t){var r;return Ba(t)?null===(r=t.getSpecialInfo())||void 0===r?void 0:r.customData:Xa(t)?function(e,t){var r=Ps(t.workbook,e);if(r){var n=e.startRow,a=e.startCol,o=r.getActualFormatter(n,a)||null,i=o?o.getFormatCode():"";return i&&"General"!==i?{autoFormat:i}:void 0}}(t.getRef(),e):void 0}var KF=function(e,t){return JF(e,t[0])},XF=function(e,t){for(var r=0;r<t.length;r++){var n=JF(e,t[r]);if(n)return n}};it.PrefixUnaryOpBase.prototype.$$calcCustomData=KF;var QF=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="AVERAGE",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e.$$calcCustomData=XF,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n];if(Ba(a)){var o=Zc(e.service,a);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);a=o}r.push(a)}return QE(e,r,null,this.name)}}]),t}(it.FuncOpBase);function eZ(e,t,r){var n=0;return 0<e&&.02425>e?n=(((((-.007784894002430293*(e=Math.sqrt(-2*Math.log(e)))-.3223964580411365)*e-2.400758277161838)*e-2.549732539343734)*e+4.374664141464968)*e+2.938163982698783)/((((.007784695709041462*e+.3224671290700398)*e+2.445134137142996)*e+3.754408661907416)*e+1):.02425<=e&&.97575>=e?n=(((((-39.69683028665376*(n=(e-=.5)*e)+220.9460984245205)*n-275.9285104469687)*n+138.357751867269)*n-30.66479806614716)*n+2.506628277459239)*e/(((((-54.47609879822406*n+161.5858368580409)*n-155.6989798598866)*n+66.80131188771972)*n-13.28068155288572)*n+1):.97575<e&&1>e&&(n=-(((((-.007784894002430293*(e=Math.sqrt(-2*Math.log(1-e)))-.3223964580411365)*e-2.400758277161838)*e-2.549732539343734)*e+4.374664141464968)*e+2.938163982698783)/((((.007784695709041462*e+.3224671290700398)*e+2.445134137142996)*e+3.754408661907416)*e+1)),n*r+t}function tZ(e){var t,r,n;return 0===e?r=0:(n=.5*Math.abs(e))>=3?r=1:n<1?r=((((((((.000124818987*(t=n*n)-.001075204047)*t+.005198775019)*t-.019198292004)*t+.059054035642)*t-.151968751364)*t+.319152932694)*t-.5319230073)*t+.797884560593)*n*2:r=(((((((((((((-45255659e-12*(n-=2)+.00015252929)*n-19538132e-12)*n-.000676904986)*n+.001390604284)*n-.00079462082)*n-.002034254874)*n+.006549791214)*n-.010557625006)*n+.011630447319)*n-.009279453341)*n+.005353579108)*n-.002141268741)*n+.000535310849)*n+.999936657524,e>0?.5*(r+1):.5*(1-r)}function rZ(e,t,r){var n=-Math.pow(e-t,2)/2/Math.pow(r,2);return 1/r/Math.sqrt(2*Math.PI)*Math.exp(n)}function nZ(e){var t,r,n,a,o,i,u=1,s=[1,.5772156649015329,-.6558780715202538,-.0420026350340952,.1665386113822915,-.0421977345555443,-.009621971527877,.007218943246663,-.0011651675918591,-.0002152416741149,.0001280502823882,-201348547807e-16,-12504934821e-16,1133027232e-15,-2.056338417e-7,6.116095e-9,5.0020075e-9,-1.1812746e-9,1.043427e-10,77823e-16,-36968e-16,51e-14,-206e-16,-54e-16,14e-16];if(e>171)return 1e308;if(e===Math.trunc(e))if(e>0)for(a=1,t=2;t<e;t++)a*=t;else a=1e308;else{if(Math.abs(e)>1){for(i=Math.abs(e),n=Math.trunc(i),u=1,r=1;r<=n;r++)u*=i-r;i-=n}else i=e;for(o=s[24],r=23;r>=0;r--)o=o*i+s[r];a=1/(o*i),Math.abs(e)>1&&(a*=u,e<0&&(a=-Math.PI/(e*a*Math.sin(Math.PI*e))))}return a}function aZ(e){var t=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],r=1.000000000190015,n=e,a=e+5.5;a-=(e+.5)*Math.log(a);for(var o=0;o<=5;o++)r+=t[o]/++n;return-a+Math.log(2.5066282746310007*r/e)}function oZ(e){var t,r,n,a=[23531376880.41076,42919803642.6491,35711959237.35567,17921034426.03721,6039542586.352028,1439720407.3117216,248874557.86205417,31426415.585400194,2876370.6289353725,186056.26539522348,8071.672002365816,210.82427775157936,2.5066282746310002],o=[0,39916800,120543840,150917976,105258076,45995730,13339535,2637558,357423,32670,1925,66,1];if(e<=1)for(t=a[12],r=o[12],n=11;n>=0;--n)t*=e,t+=a[n],r*=e,r+=o[n];else{var i=1/e;for(t=a[0],r=o[0],n=1;n<=12;++n)t*=i,t+=a[n],r*=i,r+=o[n]}return t/r}function iZ(e,t,r){var n,a,o,i,u,s,l,c,h,f,d,v,p,m,g=1e37;if((e/=r)>1e8)return 1;if(t>1e3)return m=tZ(((n=3*Math.sqrt(t)*(Math.pow(e/t,1/3)+1/(9*t)-1))-0)/1);if(e<=1||e<t){m=aZ(t+1),l=t*Math.log(e)-e-m,c=1,p=1,f=t;do{p+=c=c*e/(f+=1)}while(c>2220446049250313e-31);l+=Math.log(p),p=0,l>=-88&&(p=Math.exp(l))}else{for(m=aZ(t),l=t*Math.log(e)-e-m,c=0,n=1,a=e,p=(o=e+1)/(i=e*(d=(f=1-t)+e+1));;){if(u=(d+=2)*o-(v=(f+=1)*(c+=1))*n,s=d*i-v*a,Math.abs(s)>0){if(h=u/s,Math.abs(p-h)<=Math.min(2220446049250313e-31,2220446049250313e-31*h))break;p=h}n=o,a=i,o=u,i=s,Math.abs(u)>=g&&(n/=g,a/=g,o/=g,i/=g)}l+=Math.log(p),p=1,l>=-88&&(p=1-Math.exp(l))}return p}function uZ(e,t,r){var n,a,o,i,u,s,l,c,h,f,d=2520;if(e<2e-6)return 0;if(e>.999998)return 1/0;var v=2*t,p=t-1,m=aZ(t);if(v<-1.24*Math.log(e)){if((o=Math.pow(e*t*Math.exp(m+.6931471805599453*t),1/t))<5e-7)return NaN}else if(v>.32)h=eZ(e,0,1),i=.222222/v,(o=v*Math.pow(h*Math.sqrt(i)+1-i,3))>2.2*v+6&&(o=-2*(Math.log(1-e)-p*Math.log(.5*o)+m));else{o=.4,n=Math.log(1-e)+m+.6931471805599453*p;do{s=o,c=(4.67+2*o)/(i=1+o*(4.67+o))-.5-(6.73+o*(13.32+3*o))/(u=o*(6.73+o*(6.66+o))),o-=(1-Math.exp(n+.5*o)*u/i)/c}while(Math.abs(s/o-1)>.01)}for(f=1;f<=20;f++)if(s=o,o+=(c=(u=e-iZ(i=.5*o,t,1))*Math.exp(.6931471805599453*t+m+i-p*Math.log(o)))*(1+.5*c*(l=(210+(n=.5*c-(a=c/o)*p)*(140+n*(105+n*(84+n*(70+60*n)))))/420)-a*p*(l-a*((420+n*(735+n*(966+n*(1141+1278*n))))/d-a*((210+n*(462+n*(707+932*n)))/d-a*((252+n*(672+1182*n)+p*(294+n*(889+1740*n)))/5040-a*((84+2264*n+p*(1175+606*n))/d-a*((120+p*(346+127*p))/5040))))))),Math.abs(s/o-1)>5e-7)return.5*r*o;return.5*r*o}function sZ(e,t,r){if(e<=0)return 0;if(e>=1)return 1;if(1===r)return Math.pow(e,t);if(1===t)return-Math.expm1(r*Math.log1p(-e));var n,a=.5-e+.5,o=Math.log1p(-e),i=e,u=Math.log(e),s=t,l=r,c=e>t/(t+r);return c&&(s=r,l=t,i=a,a=e,u=o,o=Math.log(e)),n=function(e,t,r){var n,a,o,i,u,s,l,c,h,f,d=222045e-21;n=1,a=1,0==(i=1-(t+r)/(t+1)*e)?(o=0,u=1,f=1):f=(o=1)*(u=1/i),h=1;var v=1,p=5e4,m=!1;do{o=(n=(o+(l=v*(r-v)*e/(((s=t+2*v)-1)*s))*n)*u)+(c=-(t+v)*(t+r+v)*e/(s*(s+1)))*o*u,0!==(i=(a=(i+l*a)*u)+c*i*u)&&(h=o*(u=1/i),m=Math.abs(f-h)<Math.abs(f)*d),f=h,v+=1}while(v<p&&!m);return f}(i,s,l),n/=s,n*=s>1&&l>1&&s/(s+l)<.97&&l/(s+l)<.97?lZ(i,s,l)*i*a:Math.exp(s*u+l*o-dZ(!1,s,l)),c&&(n=.5-n+.5),n>1&&(n=1),n<0&&(n=0),n}function lZ(e,t,r){if(1===t)return 1===r?1:2===r?-2*e+2:e<=.01?r+r*Math.exp((r-1)*Math.log(1-e))-1:r*Math.pow(.5-e+.5,r-1);if(1===r)return 2===t?t*e:t*Math.pow(e,t-1);if(e<=0&&!(t<1&&0===e)||e>=1&&!(r<1&&1===e))return 0;var n=Math.log(cZ(2)),a=Math.log(cZ(1)),o=Math.log(1-e),i=(t-1)*Math.log(e),u=(r-1)*o,s=dZ(!1,t,r);return i<n&&i>a&&u<n&&u>a&&s<n&&s>a&&i+u<n&&i+u>a?Math.pow(e,t-1)*Math.pow(.5-e+.5,r-1)/dZ(!0,t,r):Math.exp(i+u-s)}function cZ(e){return[22250738585072014e-324,17976931348623157e292,Math.pow(2,-53),Math.pow(2,-52),hZ(2,10)][e-1]||0}function hZ(e,t){return isNaN(e)?e:isNaN(t)?t:1!==t&&1===e||0!==t&&t!==Number.POSITIVE_INFINITY?Math.log(e)/Math.log(t):NaN}function fZ(e,t,r,n,a){var o,i,u,s,l,c,h,f,d,v,p,m,g,y,_,R,C,w=3e-308,E=w,k=1-222e-18,T=e,S=dZ(!1,t,r);e<=.5?(s=e,f=t,v=r,o=0):(s=1-e,f=r,v=t,o=1),R=(p=Math.sqrt(-Math.log(s*s)))-(2.30753+.27061*p)/(1+(.99229+.04481*p)*p),f>1&&v>1?(p=(R*R-3)/6,h=2/((m=1/(f+f-1))+(g=1/(v+v-1))),_=R*Math.sqrt(h+p)/h-(g-m)*(p+5/6-2/(3*h)),T=f/(f+v*Math.exp(_+_))):(g=1/(9*v),(g=(p=v+v)*Math.pow(1-g+R*Math.sqrt(g),3))<=0?T=1-Math.exp((Math.log((1-s)*v)+S)/v):T=(g=(4*f+p-2)/g)<=1?Math.exp((Math.log(s*f)+S)/f):1-2/(g+1)),p=1-f,g=1-v,C=0,l=1,T<E?T=E:T>k&&(T=k);var A=Math.max(1e-300,Math.pow(10,-13-2.5/(f*f)-.5/(s*s)));for(y=0,d=0,i=0;i<1e3;i++){for((R=((R=sZ(T,f,v))-s)*Math.exp(S+p*Math.log(T)+g*Math.log(1-T)))*C<=0&&(d=Math.max(Math.abs(l),w)),c=1,u=0;u<1e3;u++){if(l=c*R,Math.abs(l)<d&&((y=T-l)>=0&&y<=1)){if(d<=A)return 0!==o&&(T=1-T),(a-n)*T+n;if(Math.abs(R)<=A)return 0!==o&&(T=1-T),(a-n)*T+n;if(0!==y&&1!==y)break}c/=3}if(y===T)return 0!==o&&(T=1-T),(a-n)*T+n;T=y,C=R}return 0!==o&&(T=1-T),(a-n)*T+n}function dZ(e,t,r){var n=r,a=t;if(t>r&&(n=[a,a=n][0]),e&&n+a<171.624376956302)return nZ(n)/nZ(n+a)*nZ(a);var o=5.52468004077673,i=oZ(n);i/=oZ(n+a),i*=oZ(a);var u=n+a+o,s=e?i*Math.sqrt(u/(n+o)/(a+o)):Math.log(i)+.5*(Math.log(u)-Math.log(n+o)-Math.log(a+o)),l=a/(n+o),c=n/(a+o),h=-n*Math.log(1+l)-a*Math.log(1+c)-o;return e?Math.exp(h)*s:h+s}var vZ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BETADIST",e.operands=3,e.optionOperands=2,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(1)}],e.$$minOperands=3,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3]?t[3].getValue():0,i=t[4]&&za(t[4])?t[4].getValue():1;if(n<=0||a<=0){var u=n<=0?2:3,s=2===u?n:a;return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:u,value:s,lowerBound:0})}if(r<o||r>i){var l=r<o?5:1,c=5===l?1:6,h=5===l?o:r,f=5===l?r:i;return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO_OTHER_PARAM]({funcName:this.name,index:l,value:h,secondArgIndex:c,upperBound:f})}if(o===i)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN_OTHER_PARAM]({funcName:this.name,index:5,value:o,secondArgIndex:6,upperBound:i});var d=function(e,t,r,n,a){return sZ((e-n)/(a-n),t,r)}(r,n,a,o,i);return new it.NumberVar(d)}}]),t}(it.FuncOpBase);var pZ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BETA.DIST",e.operands=4,e.optionOperands=2,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.BOOL,default:new it.BooleanVar(!1)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(1)}],e.$$minOperands=3,e.$$maxOperands=6,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,264,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=!!t[3]&&t[3].getValue(),i=t[4]?t[4].getValue():0,u=t[5]&&za(t[5])?t[5].getValue():1;if(n<=0||a<=0){var s=n<=0?2:3,l=2===s?n:a;return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:s,value:l,lowerBound:0})}if(r<i||r>u){var c=r<i?5:1,h=5===c?1:6,f=5===c?i:r,d=5===c?r:u;return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO_OTHER_PARAM]({funcName:this.name,index:c,value:f,secondArgIndex:h,upperBound:d})}if(i===u)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN_OTHER_PARAM]({funcName:this.name,index:5,value:i,secondArgIndex:6,upperBound:u});var v;return v=o?function(e,t,r,n,a){return sZ((e-n)/(a-n),t,r)}(r,n,a,i,u):function(e,t,r,n,a){return lZ((e-n)/(a-n),t,r)/(a-n)}(r,n,a,i,u),new it.NumberVar(v)}}]),t}(it.FuncOpBase);var mZ=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"BETA.INV";return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).name=r,e.operands=3,e.optionOperands=2,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(1)}],e.$$minOperands=3,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3]?t[3].getValue():0,i=t[4]&&za(t[4])?t[4].getValue():1;if(r<=0||n<=0||a<=0){var u=3,s=a;return r<=0?(u=1,s=r):n<=0&&(u=2,s=n),it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:u,value:s,lowerBound:0})}if(r>1)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO]({funcName:this.name,index:1,value:r,upperBound:1});var l=fZ(r,n,a,o,i);return new it.NumberVar(l)}}]),t}(it.FuncOpBase),gZ="0b",yZ="0",_Z="0x";function RZ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return TZ(e)?(e.length===t&&"1"===e[0]&&(e=e.padStart(3*t,"1")),yZ+parseInt(e,2).toString(8)):""}function CZ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;return TZ(e)?(e.length===t&&"1"===e[0]&&(e=e.padStart(4*r,"1")),_Z+parseInt(e,2).toString(16).toUpperCase()):""}function wZ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!AZ(e.toString(10)))return"";if(e<0){var r=OZ(Math.abs(e),t-1);return Number.isFinite(r)?"".concat(gZ,"1").concat(IZ((r+1).toString(2),t-1)):""}return gZ+e.toString(2)}function EZ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!TZ(e))return"";var r=(e=IZ(e,t)).slice(0,1);if("0"===r)return gZ+e;e=e.slice(1);var n=OZ(Number("".concat(gZ+e)),t-1);if(!Number.isFinite(n))return"";var a=n.toString(2);return gZ+r+IZ(a,t-1)}function kZ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!TZ(e))return"";if("0"===(e=IZ(e,t)).slice(0,1))return gZ+e;var r=Number(EZ(e,t))+1;return Number.isFinite(r)?gZ+IZ(r.toString(2),t):""}function TZ(e){return/^(0|1)+$/.test(e)}function SZ(e){return/^([0-9A-F])+$/i.test(e)}function AZ(e){return/^(-|\+)?([0-9])+$/.test(e)}function IZ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return e.length>=t?e:e.padStart(t,"0")}function OZ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(t<=0)return Number.NaN;if(t>31){for(var r=e.toString(2).padStart(t,"0"),n="",a=0;a<t;a++)n+="1"===r[a]?"0":"1";return Number(gZ+n)}return e^Number(gZ+"1".repeat(t))}var VZ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BIN2DEC",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0];if(Wa(n))r=n.getValue();else{if(!za(n))return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_WRONG_DATA_TYPE]({funcName:this.name,index:1,value:El(n),argType:wl(n),requiredArgType:it.FormulaErrorPhrases.DATA_TYPE_STRING});r=n.getValue().toString()}if(!TZ(r))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_NON_DECIMAL_REPRESENTATION]({funcName:this.name,value:r,validValue:it.FormulaErrorPhrases.BINARY});if(parseInt(r,10)>=1e10)return it.tractorErrorVarCreators[it.ErrorCode.STRING_TOO_LONG]({funcName:this.name,index:1,textLength:r.length,maxTextLength:10});var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;if(!TZ(e))return Number.NaN;if(e.length===t&&"1"===e[0]){if(e==="1".padEnd(t,"0"))return-(Number(gZ+"1".repeat(t-1))+1);var r=kZ(e,t).slice(gZ.length+1);return""===r?Number.NaN:-Number(gZ+r)}return parseInt(e,2)}(r,10);return Number.isFinite(a)?new it.NumberVar(a):it.NUM_ERR_VAR}}]),t}(it.FuncOpBase),NZ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BIN2HEX",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL|it.VAR_TYPE.NULL,default:it.NULL_VAR}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0],a=t[1];if(Wa(n))r=n.getValue();else{if(!za(n))return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_WRONG_DATA_TYPE]({funcName:this.name,index:1,value:El(n),argType:wl(n),requiredArgType:it.FormulaErrorPhrases.DATA_TYPE_STRING});r=n.getValue().toString()}var o=null;if(a&&!qa(a))if(za(a))o=a.getValue();else{if(!Wa(a))return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_WRONG_DATA_TYPE]({funcName:this.name,index:2,value:El(a),argType:wl(a),requiredArgType:it.FormulaErrorPhrases.DATA_TYPE_DOUBLE});if(null===(o=a.toNumberVar(e.service).getValue()))return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_WRONG_DATA_TYPE]({funcName:this.name,index:2,value:a.getValue(),argType:it.FormulaErrorPhrases.DATA_TYPE_STRING,requiredArgType:it.FormulaErrorPhrases.DATA_TYPE_DOUBLE})}if(!TZ(r))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_NON_DECIMAL_REPRESENTATION]({funcName:this.name,value:r,validValue:it.FormulaErrorPhrases.BINARY});if(parseInt(r,10)>=1e10)return it.tractorErrorVarCreators[it.ErrorCode.STRING_TOO_LONG]({funcName:this.name,index:1,textLength:r.length,maxTextLength:10});var i=CZ(r,10,10).slice(_Z.length);if(""===i)return it.NUM_ERR_VAR;if(null!==o){if(o>10||o<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:2,value:o,lowerBound:1,upperBound:10});var u=Math.trunc(o),s=i.length;if(10===s&&"F"!==i[0]||s<10){if(!(s<=u))return it.tractorErrorVarCreators[it.ErrorCode.INSUFFICIENT_PLACES]({funcName:this.name,curPlaces:u,requiredPlaces:s});i=i.padStart(u,"0")}}return new it.StringVar(i)}}]),t}(it.FuncOpBase),bZ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BIN2OCT",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL|it.VAR_TYPE.NULL,default:it.NULL_VAR}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399,399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0],a=t[1];if(Wa(n))r=n.getValue();else{if(!za(n))return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_WRONG_DATA_TYPE]({funcName:this.name,index:1,value:El(n),argType:wl(n),requiredArgType:it.FormulaErrorPhrases.DATA_TYPE_STRING});r=n.getValue().toString()}var o=null;if(a&&!qa(a))if(za(a))o=a.getValue();else{if(!Wa(a))return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_WRONG_DATA_TYPE]({funcName:this.name,index:2,value:El(a),argType:wl(a),requiredArgType:it.FormulaErrorPhrases.DATA_TYPE_DOUBLE});if(null===(o=a.toNumberVar(e.service).getValue()))return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_WRONG_DATA_TYPE]({funcName:this.name,index:2,value:a.getValue(),argType:it.FormulaErrorPhrases.DATA_TYPE_STRING,requiredArgType:it.FormulaErrorPhrases.DATA_TYPE_DOUBLE})}if(parseInt(r,10)>=1e10)return it.tractorErrorVarCreators[it.ErrorCode.STRING_TOO_LONG]({funcName:this.name,index:1,textLength:r.length,maxTextLength:10});if(!TZ(r))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_NON_DECIMAL_REPRESENTATION]({funcName:this.name,value:r,validValue:it.FormulaErrorPhrases.BINARY});var i=RZ(r,10).slice(yZ.length);if(""===i)return it.NUM_ERR_VAR;if(null!==o){if(o>10||o<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:2,value:o,lowerBound:1,upperBound:10});var u=Math.trunc(o),s=i.length;if(10===s&&"7"!==i[0]||s<10){if(!(s<=u))return it.tractorErrorVarCreators[it.ErrorCode.INSUFFICIENT_PLACES]({funcName:this.name,curPlaces:s,requiredPlaces:2});i=i.padStart(u,"0")}}return new it.StringVar(i)}}]),t}(it.FuncOpBase);function MZ(e,t){return PZ(e*(t=Math.pow(10,t)))/t}function FZ(e,t){return 0===t?0:(e>0&&(t=Math.abs(t)),DZ(e/t)*t)}function ZZ(e,t){return 0===t?0:(e>0&&(t=Math.abs(t)),xZ(e/t)*t)}function xZ(e){return-DZ(-e)}function DZ(e){return Math.floor((0,it.convertTo15Digits)(e))}function PZ(e){return Math.sign(e)*DZ(Math.abs(e)+.5)}var $Z=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CEILING",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1]&&za(t[1])?t[1].getValue():1;return n<0&&r>0?it.tractorErrorVarCreators[it.ErrorCode.DIFFERENT_SIGNS]({funcName:this.name}):new it.NumberVar(ZZ(r,n))}}]),t}(it.FuncOpBase),LZ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CEILING.MATH",e.operands=1,e.optionOperands=2,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(1)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=1,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1]&&za(t[1])?t[1].getValue():1;return r<0&&(n=0===(t[2]&&za(t[2])?t[2].getValue():0)?Math.abs(n):-Math.abs(n)),new it.NumberVar(ZZ(r,n))}}]),t}(it.FuncOpBase),BZ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CEILING.PRECISE",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(1)}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[1]&&za(t[1])?t[1].getValue():1;return new it.NumberVar(ZZ(t[0].getValue(),Math.abs(r)))}}]),t}(it.FuncOpBase),UZ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CHAR",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return r<=0?it.tractorErrorVarCreators[it.ErrorCode.OUT_OF_RANGE_PARAMETER]({funcName:this.name,index:1,value:r.toString()}):new it.StringVar(String.fromCharCode(r))}}]),t}(it.FuncOpBase),HZ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CLEAN",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.StringVar(function(e){for(var t=[],r=0;r<e.length;r++){var n=e.charCodeAt(r);0<=n&&n<=31||127===n||t.push(e[r])}return t.join("")}(t[0].getValue()))}}]),t}(it.FuncOpBase);function zZ(e,t){var r=1;t=Math.min(e-t,t);for(var n=1;n<=t;n++)r*=e-n+1,r/=n;return r}var WZ,GZ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="COMBIN",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue());return r<0||n<0?it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:r<0?1:2}):r<n?it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO_OTHER_PARAM]({funcName:this.name,index:2,value:n,secondArgIndex:1,upperBound:r}):new it.NumberVar(zZ(r,n))}}]),t}(it.FuncOpBase);!function(e){e.i="i",e.j="j"}(WZ||(WZ={}));var jZ=1e15;function YZ(e){return 0!==(e=e.replace(/\s/g,"")).length&&/^([+-]?\d+(\.\d+)?)?([+-]?\d*(\.\d+)?(i|j))?$/.test(e)}function qZ(e){return e in WZ}function JZ(){for(var e=null,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(var a=0,o=r;a<o.length;a++){var i=o[a],u=i[i.length-1];if(qZ(u))if(null===e)e=u;else if(e!==u)return{isSame:!1,suffix:null}}return{isSame:!0,suffix:e}}function KZ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:WZ.i,r=(e=new(rr())(Math.trunc(e.re*jZ)/jZ,Math.trunc(e.im*jZ)/jZ)).toString().replace(/\s/g,"");return t===WZ.j&&(r=r.replace(WZ.i,t)),r}function XZ(e){return new(rr())(e.replace(WZ.j,WZ.i))}var QZ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="COMPLEX",e.operands=2,e.optionOperands=1,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.STRING,default:new it.StringVar("i")}],e.$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[399,399,261],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[0,0],n=0;n<2;++n){var a=t[n];if(qa(a))return it.NA_ERR_VAR;var o=Zc(e.service,a,!0);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r[n]=o.getValue()}var i,u=r[0],s=r[1],l=t[2]&&Wa(t[2])?t[2].getValue():"i";if("i"!==l&&"j"!==l){return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_VALUE_NOT_IN_LIST]({funcName:this.name,index:3,value:l,validValues:"i, j"})}try{i=new(rr())(u,s)}catch(e){return it.NUM_ERR_VAR}var c=i.toString().replace(/\s/g,"");return"j"===l&&0!==i.im&&(c=c.replace("i",l)),new it.StringVar(c)}}]),t}(it.FuncOpBase),ex=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CONCAT",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.STRING|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0,a=0;a<t.length;++a){var o=t[a];if(Ba(o)){var i=(Wa(o)?o:o.toStringVar()).getValue();if(null===i)return tx(this.name,a,o);var u=n+i.length;if(u>32767)return it.VALUE_ERR_VAR;n=u,r.push(i)}else{if(!Ja(o))return tx(this.name,a,o);var s=o.forEach((function(e){if(ja(e))return e;if(Ba(e)){var t=(Wa(e)?e:e.toStringVar()).getValue(),a=n+t.length;if(a>32767)return it.VALUE_ERR_VAR;n=a,r.push(t)}}));if(s)return s}}return new it.StringVar(r.join(""))}}]),t}(it.FuncOpBase);function tx(e,t,r){return Rl(e,t+1,El(r),wl(r),it.FormulaErrorPhrases.DATA_TYPE_STRING)}var rx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CONCATENATE",e}return(0,p.Z)(t,e),t}(ex),nx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CONVERT",e.operands=3,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.STRING,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.STRING,default:it.NA_ERR_VAR}],e.$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[259,261],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;++r)if(qa(t[r]))return it.NA_ERR_VAR;for(var n=t[0].getValue(),a=t[1].getValue(),o=t[2].getValue(),i=null,u=null,s=1,l=1,c=0;c<ax.length;c++){var h=ax[c][2];(ax[c][1]===a||h.indexOf(a)>=0)&&(i=ax[c]),(ax[c][1]===o||h.indexOf(o)>=0)&&(u=ax[c])}if(null===i){var f=ox[a.substring(0,2)],d=ix[a.substring(0,1)];"da"===a.substring(0,2)&&(d=["dekao",10,"da"]),f?(s=f[2],a=a.substring(2)):d&&(s=d[1],a=a.substring(d[2].length)),i=ax.find((function(e){var t=e[2];return e[1]===a||t.indexOf(a)>=0}))}if(null===u){var v=ox[o.substring(0,2)],p=ix[o.substring(0,1)];"da"===o.substring(0,2)&&(p=["dekao",10,"da"]),v?(l=v[2],o=o.substring(2)):p&&(l=p[1],o=o.substring(p[2].length)),u=ax.find((function(e){var t=e[2];return e[1]===o||t.indexOf(o)>=0}))}if(!i||!u)return it.tractorErrorVarCreators[it.ErrorCode.INVALID_UNIT_CONVERSION]();if(i[3]!==u[3])return it.tractorErrorVarCreators[it.ErrorCode.INVALID_UNIT_CONVERSION]();var m,g=(n*s+i[4])*i[5];return m="temperature"===i[3]?(g*u[6]-u[4])/l:(g/u[5]-u[4])/l,new it.NumberVar(m)}}]),t}(it.FuncOpBase),ax=[["gram","g",[],"mass",0,.001],["slug","sg",[],"mass",0,14.5939029372064],["pound mass","lbm",[],"mass",0,.45359237],["dalton","Da",["u"],"mass",0,166053886282828e-41],["ounce mass","ozm",[],"mass",0,.028349523125],["grain","grain",[],"mass",0,6479891e-11],["short hundredweight","cwt",["shweight"],"mass",0,45.359237],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",0,50.80234544],["stone","stone",[],"mass",0,6.35029318],["ton","ton",[],"mass",0,907.18474],["imperial ton","brton",["uk_ton","LTON"],"mass",0,1016.0469088],["meter","m",[],"length",0,1],["statute mile","mi",[],"length",0,1609.344],["nautical mile","M",["Nmi"],"length",0,1852],["inch","in",[],"length",0,.0254],["foot","ft",[],"length",0,.3048],["yard","yd",[],"length",0,.9144],["angstrom","ang",[],"length",0,1e-10],["ell","ell",[],"length",0,1.143],["light-year","ly",[],"length",0,946073047258e4],["parsec","pc",["parsec"],"length",0,308567758128e5],["pica (1/72 inch)","Pica",["Picapt"],"length",0,.0254/72],["pica (1/6 inch)","pica",[],"length",0,.0254/6],["U.S. survey mile","survey_mi",[],"length",0,1609.3472187],["year","yr",[],"time",0,31557600],["day","d",["day"],"time",0,86400],["hour","h",["hr"],"time",0,3600],["minute","min",["mn"],"time",0,60],["second","s",["sec"],"time",0,1],["pascal","p",["Pa"],"pressure",0,1],["atmosphere","at",["atm"],"pressure",0,101325],["millimetre of mercury","mmHg",[],"pressure",0,133.322],["PSI","psi",[],"pressure",0,6894.7572931783],["torr","Torr",[],"pressure",0,133.3223684211],["newton","N",[],"force",0,1],["dyne","dyn",["dy"],"force",0,1e-5],["pound force","lbf",[],"force",0,4.4482216152605],["pond","pond",[],"force",0,.00980665],["joule","J",[],"energy",0,1],["erg","e",[],"energy",0,1e-7],["thermodynamic calorie","c",[],"energy",0,4.184],["IT calorie","cal",[],"energy",0,4.1868],["electron volt","eV",["ev"],"energy",0,160217662e-27],["horsepower-hour","HPh",["hh"],"energy",0,2684519.5377],["watt-hour","Wh",["wh"],"energy",0,3600],["foot-pound","flb",[],"energy",0,1.3558179483314],["btu","BTU",["btu"],"energy",0,1055.05585262],["horsepower","HP",["h"],"power",0,745.69987158227],["pferdestrke","PS",[],"power",0,735.49875],["watt","W",["w"],"power",0,1],["tesla","T",[],"magnetism",0,1e4],["gauss","G",["ga"],"magnetism",0,1],["degree celsius","C",["cel"],"temperature",0,1,1],["kelvin","K",["kel"],"temperature",-273.15,1,1],["degree fahrenheit","F",["fah"],"temperature",-32,5/9,1.8],["degrees Rankine","Rank",[],"temperature",-491.67,5/9,1.8],["degrees reaumur","Reau",[],"temperature",0,5/4,.8],["teaspoon","tsp",[],"volume",0,492892159375e-17],["modern teaspoon","tspm",[],"volume",0,5e-6],["tablespoon","tbs",[],"volume",0,1478676478125e-17],["fluid ounce","oz",[],"volume",0,295735295625e-16],["cup","cup",[],"volume",0,.0002365882365],["U.S. pint","pt",["us_pt"],"volume",0,.000473176473],["U.K. pint","uk_pt",[],"volume",0,.00056826125],["quart","qt",[],"volume",0,.000946352946],["imperial quart (U.K)","uk_qt",[],"volume",0,.0011365225],["gallon","gal",[],"volume",0,.003785411784],["imperial gallon (U.K.)","uk_gal",[],"volume",0,.00454609],["litre","L",["l","lt"],"volume",0,.001],["cubic ngstrm","ang3",["ang^3"],"volume",0,1e-30],["U.S. oil barrel","barrel",[],"volume",0,.158987294928],["U.S. bushel","bushel",[],"volume",0,.03523907016688],["cubic foot","ft3",["ft^3"],"volume",0,.028316846592],["cubic inch","in3",["in^3"],"volume",0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",0,846786664623715e33],["cubic meter","m3",["m^3"],"volume",0,1],["cubic mile","mi3",["mi^3"],"volume",0,4168181825.44058],["cubic yard","yd3",["yd^3"],"volume",0,.764554857984],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",0,6352182208],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",0,43903957e-18],["gross registered ton","GRT",["regton"],"volume",0,2.8316846592],["measurement ton","MTON",[],"volume",0,1.13267386368],["international acre","uk_acre",[],"area",0,4046.8564224],["U.S. survey/statute acre","us_acre",[],"area",0,4046.87261],["square angstrom","ang2",["ang^2"],"area",0,1e-20],["are","ar",[],"area",0,100],["square foot","ft2",["ft^2"],"area",0,.09290304],["hectare","ha",[],"area",0,1e4],["square inch","in2",["in^2"],"area",0,64516e-8],["square light-year","ly2",["ly^2"],"area",0,895054210748189e17],["square meter","m2",["m^2"],"area",0,1],["morgen","Morgen",[],"area",0,2500],["square mile","mi2",["mi^2"],"area",0,2589988.110336],["square nautical mile","Nmi2",["Nmi^2"],"area",0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",0,1.24452160493827e-7],["square yard","yd2",["yd^2"],"area",0,.83612736],["bit","bit",["b"],"information",0,1],["byte","byte",[],"information",0,8],["admiralty knot","admkn",[],"speed",0,.514773333],["knot","kn",[],"speed",0,.514444444444444],["meter per hour","m/h",["m/hr"],"speed",0,.0002777777777777778],["meter per second","m/s",["m/sec"],"speed",0,1],["miles per hour","mph",[],"speed",0,.44704]],ox={Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,0x1000000000000000,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,1099511627776,"Ti","tera"],Gi:["gibi",30,1073741824,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]},ix={Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]},ux=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="COS",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(Math.cos(r))}}]),t}(it.FuncOpBase),sx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="COSH",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(Math.cosh(r))}}]),t}(it.FuncOpBase),lx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="COUNT",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.BASIC|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.BASIC|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[49],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0,n=0;n<t.length;++n){var a=t[n];Ba(a)?Zc(e.service,a)&&r++:Ja(a)&&a.forEach((function(e){za(e)&&r++}))}return new it.NumberVar(r)}}]),t}(it.FuncOpBase),cx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="COUNTA",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.BASIC|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.BASIC|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[49],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0,n=0;n<t.length;++n)t[n].forEach((function(e){qa(e)||++r}));return new it.NumberVar(r)}}]),t}(it.FuncOpBase);function hx(e,t,r,n){for(var a=[],o=[],i=0,u=0,s=0,l=e.size(),c=e.colCount(),h=t.colCount(),f=0;f<l;++f){var d=e.at(f/c|0,f%c);if(ja(d))return d;var v=t.at(f/h|0,f%h);if(ja(v))return v;if(za(d)&&za(v)){var p=d.getValue(),m=v.getValue();a.push(p),o.push(m),i++,u+=p,s+=m}}if(i<=0)return it.tractorErrorVarCreators[it.ErrorCode.DIV0_NO_VALID_DATA]({funcName:r});if(n&&1===i)return it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_FUNCTION_EVAL]({funcName:r});for(var g=u/i,y=s/i,_=0,R=0;R<a.length;R++)_+=(a[R]-g)*(o[R]-y);return new it.NumberVar(n?_/(i-1):_/i)}var fx,dx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="COVAR",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.COLLECTION}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1];return 1===r.size()&&qa(r.at(0,0))||1===n.size()&&qa(n.at(0,0))?it.tractorErrorVarCreators[it.ErrorCode.NO_VALID_DATA]({funcName:this.name}):r.size()!==n.size()?it.tractorErrorVarCreators[it.ErrorCode.ARGUMENT_SIZES_NOT_EQUAL]({funcName:this.name,argCount:r.size(),requiredOperandCount:n.size()}):hx(r,n,this.name)}}]),t}(it.FuncOpBase);!function(e){e[e.End=0]="End",e[e.Begin=1]="Begin"}(fx||(fx={}));function vx(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:fx.End;if(0===e)return 0;var i=e+1,u=((n+a)*(Math.pow(i,r)-Math.pow(i,t-1))/(Math.pow(i,r)-1)-a)*-e;return o?t<2?0:u/i:u}function px(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:fx.End;if(0==e)return-(n+a)/r;var i=e*Math.pow(1+e,t-1),u=Math.pow(1+e,r)-1;return 0!==o&&(u*=1+e),t<2&&o?-e*Math.pow(1+e,r)*(n+a/Math.pow(1+e,r))/u:-(n+a)*i/u}function mx(e,t){return t.reduce((function(t,r,n){return t+r/Math.pow(1+e,n+1)}),0)}function gx(e,t,r){return t.reduce((function(t,n,a){return t+n/Math.pow(1+e,(r[a]-r[0])/365)}),0)}function yx(e,t,r){return(e(t+r)-e(t-r))/(2*r)}function _x(e,t,r,n,a){if(t===r)return null;var o=e(t);if(Math.abs(o)<a)return t;var i=e(r);if(Math.abs(i)<a)return r;var u=n+1;if(u>200)return null;if(Cx(o,i))return null;var s=t+.5*(r-t),l=e(s);return Math.abs(l)<a?s:Cx(o,l)?Cx(o,l)?_x(e,s,r,u,a):null:_x(e,t,s,u,a)}function Rx(e,t){var r=1e-7,n=function(e,t,r,n){for(var a=0,o=e(t),i=1/0,u=t<0;a<r;){var s=yx(e,t,n);if(0===s)return null;var l=t-o/s;if(!u&&l<0&&(l=-.1,u=!0),o=e(l),Math.abs(o)<n)return l;i=t,t=l,a++}return Math.abs(i-t)<n&&Math.abs(o)<1?i:null}(e,t,100,r);if(null!==n)return n;var a=function(e,t,r,n,a){function o(e){return e<=r?r+a:e}if(t<=r||t>=n)return null;var i=1.6;return function t(r,n,a){if(0==--a)return null;var u=o(r),s=o(n);return e(u)*e(s)<=0?[u,s]:t(u+i*(u-s),s+i*(s-u),a)}(o(t-.01),function(e){return e>=n?n-a:e}(t+.01),60)}(e,t,-1,Number.MAX_VALUE,r);return null!==a?_x(e,a[0],a[1],0,r):n}function Cx(e,t){return e>0&&t>0||e<0&&t<0}var wx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CUMPRINC",e.operands=6,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.VALUE_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.VALUE_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.VALUE_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.VALUE_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.VALUE_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.VALUE_ERR_VAR}],e.$$minOperands=6,e.$$maxOperands=6,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;n++){var a=t[n],o=Zc(e.service,a,!0);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r.push(o.getValue())}var i=r[0],u=r[1],s=r[2],l=r[3],c=r[4],h=r[5];if(i<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:1,value:i,lowerBound:0});if(u<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:2,value:u,lowerBound:0});if(s<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:3,value:s,lowerBound:0});if(l<1)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:4,value:l,lowerBound:1});if(c<1)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:5,value:c,lowerBound:1});if(l>c)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:5,value:c,lowerBound:l});if(!Object.prototype.hasOwnProperty.call(fx,h))return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_VALUE_NOT_IN_LIST]({funcName:this.name,index:6,value:h.toString(),validValues:"0, 1"});for(var f=0,d=l;d<=c;d++)f+=px(i,d,u,s,0,h);return new it.NumberVar(f)}}]),t}(it.FuncOpBase),Ex=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DEC2BIN",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL|it.VAR_TYPE.NULL,default:it.NULL_VAR}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Zc(e.service,t[0],!0);if(!r)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var n=null;if(t[1]&&!qa(t[1])&&!(n=Zc(e.service,t[1],!0)))return Rl(this.name,2,El(t[1]),wl(t[1]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var a=Math.trunc(r.getValue());if(a<-512||a>511)return it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:1,value:a,lowerBound:-512,upperBound:511});var o=wZ(a,10).slice(gZ.length);if(""===o)return it.NUM_ERR_VAR;if(n){var i=n.getValue();if(i>10||i<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:2,value:i,lowerBound:1,upperBound:10});var u=Math.trunc(i),s=o.length;if(10===s&&"1"!==o[0]||s<10){if(!(s<=u))return it.tractorErrorVarCreators[it.ErrorCode.INSUFFICIENT_PLACES]({funcName:this.name,curPlaces:u,requiredPlaces:s});o=o.padStart(u,"0")}}return new it.StringVar(o)}}]),t}(it.FuncOpBase),kx=parseInt("01".padEnd(40,"1"),2),Tx=-(parseInt("01".padEnd(40,"1"),2)+1),Sx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DEC2HEX",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL|it.VAR_TYPE.NULL,default:it.NULL_VAR}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Zc(e.service,t[0],!0);if(!r)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var n=null;if(t[1]&&!qa(t[1])&&!(n=Zc(e.service,t[1],!0)))return Rl(this.name,2,El(t[1]),wl(t[1]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var a=Math.trunc(r.getValue());if(a<Tx||a>kx)return it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:1,value:a,lowerBound:Tx,upperBound:kx});var o=CZ(wZ(a,40).slice(gZ.length),40,10).slice(_Z.length);if(""===o)return it.NUM_ERR_VAR;if(n){var i=n.getValue();if(i>10||i<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:2,value:i,lowerBound:1,upperBound:10});var u=Math.trunc(i),s=o.length;if(10===s&&"F"!==o[0]||s<10){if(!(s<=u))return it.tractorErrorVarCreators[it.ErrorCode.INSUFFICIENT_PLACES]({funcName:this.name,curPlaces:u,requiredPlaces:s});o=o.padStart(u,"0")}}return new it.StringVar(o)}}]),t}(it.FuncOpBase),Ax=parseInt("01".padEnd(30,"1"),2),Ix=-(parseInt("01".padEnd(30,"1"),2)+1),Ox=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DEC2OCT",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL|it.VAR_TYPE.NULL,default:it.NULL_VAR}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Zc(e.service,t[0],!0);if(!r)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var n=null;if(t[1]&&!qa(t[1])&&!(n=Zc(e.service,t[1],!0)))return Rl(this.name,2,El(t[1]),wl(t[1]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var a=Math.trunc(r.getValue());if(a<Ix||a>Ax)return it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:1,value:a,lowerBound:Ix,upperBound:Ax});var o=RZ(wZ(a,30).slice(gZ.length),10).slice(yZ.length);if(""===o)return it.NUM_ERR_VAR;if(n){var i=n.getValue();if(i>10||i<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:2,value:i,lowerBound:1,upperBound:10});var u=Math.trunc(i),s=o.length;if(10===s&&"7"!==o[0]||s<10){if(!(s<=u))return it.tractorErrorVarCreators[it.ErrorCode.INSUFFICIENT_PLACES]({funcName:this.name,curPlaces:u,requiredPlaces:s});o=o.padStart(u,"0")}}return new it.StringVar(o)}}]),t}(it.FuncOpBase),Vx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DEGREES",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.NumberVar(180*t[0].getValue()/Math.PI)}}]),t}(it.FuncOpBase),Nx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DELTA",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.BOOL|it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.BOOL|it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[0,0],n=0;n<t.length;++n){var a=Zc(e.service,t[n],!0);if(!a)return Rl(this.name,n+1,El(t[n]),wl(t[n]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r[n]=a.getValue()}return new it.NumberVar(r[0]===r[1]?1:0)}}]),t}(it.FuncOpBase),bx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="EFFECT",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[0,0],n=0;n<2;++n){var a=Zc(e.service,t[n],!0);if(!a)return Rl(this.name,n+1,El(t[n]),wl(t[n]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r[n]=a.getValue()}var o=r[0],i=Math.floor(r[1]);if(o<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:1,value:o,lowerBound:0});if(i<1)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:2,value:i,lowerBound:1});var u=Math.pow(1+o/i,i)-1;return new it.NumberVar(u)}}]),t}(it.FuncOpBase),Mx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ENCODEURL",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){try{var r=encodeURIComponent(t[0].getValue()).replace(/[!~'()*]/g,(function(e){return"%".concat(e.codePointAt(0).toString(16).toUpperCase())}));return new it.StringVar(r)}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.UNABLE_TO_ENCODE_INPUT_TEXT]()}}}]),t}(it.FuncOpBase);function Fx(e,t){var r=tZ(e*Math.sqrt(2)),n=2*parseFloat(r.toString())-1;return r=tZ(t*Math.sqrt(2)),n=2*parseFloat(r.toString())-1-n}var Zx=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"ERFC";return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).name=r,e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NULL_VAR}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Zc(e.service,t[0],!0);if(!r)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var n=1-Fx(0,r.getValue());return new it.NumberVar(n)}}]),t}(it.FuncOpBase),xx=function(e){function t(){var e,r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ERF",r.operands=1,r.optionOperands=1,r.resultType=it.VAR_TYPE.NUMBER,r.repeatedLastParam=0,r.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL|it.VAR_TYPE.NULL,default:(e={},(0,l.Z)(e,it.DefaultParam.IfInputNull,it.NA_ERR_VAR),(0,l.Z)(e,it.DefaultParam.IfNotInput,it.NULL_VAR),e)}],r.$$minOperands=1,r.$$maxOperands=2,r.$$lazy=!1,r.$$paramsDesc=[399],r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[0,0],n=0;n<t.length;++n){var a=Zc(e.service,t[n],!0);if(!a)return Rl(this.name,n+1,El(t[n]),wl(t[n]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r[n]=a.getValue()}var o=r[0],i=r[1];t[1]||(i=o,o=0);var u=Fx(o,i);return new it.NumberVar(u)}}]),t}(it.FuncOpBase),Dx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ERF.PRECISE",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.VALUE_ERR_VAR}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Zc(e.service,t[0],!0);if(!r)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var n=Fx(0,r.getValue());return new it.NumberVar(n)}}]),t}(it.FuncOpBase),Px=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ERROR.TYPE",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.BASIC}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return ja(t[0])?new it.NumberVar(t[0].errorType):it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_IS_NOT_AN_ERROR]({funcName:this.name,index:1})}}]),t}(it.FuncOpBase),$x=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="EVEN",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=r<0,a=Math.ceil(Math.abs(r)),o=a%2==0?a:a+1;return new it.NumberVar(n?-o:o)}}]),t}(it.FuncOpBase),Lx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="EXACT",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING},{type:it.VAR_TYPE.STRING}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(t[0].getValue()===t[1].getValue())}}]),t}(it.FuncOpBase),Bx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="EXP",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.exp(t[0].getValue());return Number.isFinite(r)?new it.NumberVar(r):Ys}}]),t}(it.FuncOpBase);function Ux(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=1;for(e=Math.floor(e);e>1;e-=t)r*=e;return r}var Hx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FACTDOUBLE",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:1});if(r>300)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO]({funcName:this.name,index:1,value:r,upperBound:300});var n=Ux(r,2);return new it.NumberVar(n)}}]),t}(it.FuncOpBase),zx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FACT",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:1});if(r>170)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO]({funcName:this.name,index:1,value:r,upperBound:170});var n=Ux(r);return new it.NumberVar(n)}}]),t}(it.FuncOpBase),Wx=function(e){function t(){var e,r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FIND",r.operands=2,r.optionOperands=1,r.resultType=it.VAR_TYPE.NUMBER,r.repeatedLastParam=0,r.paramsDesc=[{type:it.VAR_TYPE.STRING},{type:it.VAR_TYPE.STRING},{type:it.VAR_TYPE.NUMBER,default:(e={},(0,l.Z)(e,it.DefaultParam.IfInputNull,new it.NumberVar(0)),(0,l.Z)(e,it.DefaultParam.IfNotInput,new it.NumberVar(1)),e)}],r.$$minOperands=2,r.$$maxOperands=3,r.$$lazy=!1,r.$$paramsDesc=[260,260,259],r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[1].getValue();if(0===r.length)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_NON_BLANK]({funcName:this.name,index:2});var n=t[2]?Math.floor(za(t[2])?t[2].getValue():0):1;if(n<1)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:3,value:n,lowerBound:1});if(n>r.length)return it.tractorErrorVarCreators[it.ErrorCode.SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:3,value:n,lowerBound:1,upperBound:r.length});var a=t[0].getValue(),o=r.substr(n-1).indexOf(a);return-1===o?it.tractorErrorVarCreators[it.ErrorCode.STRING_SEARCH_FAILED]({funcName:this.name,searchFor:a,textToSeatch:r}):new it.NumberVar(o+n)}}]),t}(it.FuncOpBase),Gx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FLOOR",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(1)}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1]&&za(t[1])?t[1].getValue():1;return 0===n&&0!==r?it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_PARAMETER_BEING_ZERO]({funcName:this.name,argIndex:2}):n<0&&r>0?it.tractorErrorVarCreators[it.ErrorCode.DIFFERENT_SIGNS]({funcName:this.name}):new it.NumberVar(FZ(r,n))}}]),t}(it.FuncOpBase),jx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FLOOR.MATH",e.operands=1,e.optionOperands=2,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(1)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=1,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1]&&t[1].isNumber()?t[1].getValue():1;return r<0&&(n=0===(t[2]&&t[2].isNumber()?t[2].getValue():0)?Math.abs(n):-Math.abs(n)),new it.NumberVar(FZ(r,n))}}]),t}(it.FuncOpBase),Yx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FLOOR.PRECISE",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(1)}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[1]&&t[1].isNumber()?t[1].getValue():1;return new it.NumberVar(FZ(t[0].getValue(),Math.abs(r)))}}]),t}(it.FuncOpBase),qx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FV",e.operands=3,e.optionOperands=2,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=3,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3]?t[3].getValue():0,i=t[4]?t[4].getValue():0;0!==i&&(i=1);var u=function(e,t,r,n,a){var o;if(0===e)o=n+r*t;else{var i=Math.pow(1+e,t);0!==a&&(a=1),o=n*i+r*(1+e*a)*(i-1)/e}return-o}(r,n,a,o,i);return new it.NumberVar(u)}}]),t}(it.FuncOpBase),Jx=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FVSCHEDULE",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION,default:it.NA_ERR_VAR}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=this,n=Zc(e.service,t[0],!0);if(!n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var a=n.getValue(),o=t[1].forEach((function(e){if(ja(e))return e;if(za(e))a*=1+e.getValue();else if(!qa(e))return Rl(r.name,2,El(e),wl(e),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE)}));return o||new it.NumberVar(a)}}]),t}(it.FuncOpBase),Kx=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GAMMA.DIST";return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).name=r,e.operands=4,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.BOOL,default:new it.BooleanVar(!1)}],e.$$minOperands=4,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0].getValue(),a=t[1].getValue(),o=t[2].getValue(),i=t[3].getValue();if(n<0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:1});if(a<=0||o<=0){var u=a<=0?2:3,s=2===u?a:o;return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:u,value:s,lowerBound:0})}return r=i?function(e,t,r){return iZ(e,t,r)}(n,a,o):function(e,t,r){return 0===e?0:1/(Math.pow(r,t)*nZ(t))*(Math.pow(e,t-1)*Math.exp(-e/r))}(n,a,o),new it.NumberVar(r)}}]),t}(it.FuncOpBase);var Xx=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GAMMA.INV";return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).name=r,e.operands=3,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue();if(r<0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:1});if(r>1)return Ys;if(n<=0||a<=0){var o=n<=a?2:3,i=2===o?n:a;return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:o,value:i,lowerBound:0})}var u=uZ(r,n,a);return new it.NumberVar(u)}}]),t}(it.FuncOpBase),Qx=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GAMMALN";return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).name=r,e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return r<=0?Js(this.name,r,1,0):new it.NumberVar(aZ(r))}}]),t}(it.FuncOpBase);function eD(e,t){return 0!==t?eD(t,e%t):e}function tD(e,t){return 0===e||0===t?0:e/eD(e,t)*t}function rD(e,t,r,n){for(var a=n,o=0,i=0;i<t.length;++i){var u=t[i].forEach((function(t){if(ja(t))return t;if(!qa(t)){var n=Zc(e.service,t,!0);if(!n)return Rl("",-1,El(t),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN,it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var i=n.getValue();if(i<0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:"",index:-1});a=r(Math.floor(i),a),++o}}));if(u)return u}return new it.NumberVar(o>0?a:0)}var nD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="GCD",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL|it.VAR_TYPE.ERROR|it.VAR_TYPE.COLLECTION,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL|it.VAR_TYPE.ERROR|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return rD(e,t,eD,0)}}]),t}(it.FuncOpBase),aD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="GESTEP",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:new it.NumberVar(0)}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[0,0],n=0;n<t.length;++n){var a=t[n],o=Zc(e.service,a,!0);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r[n]=o.getValue()}var i=r[0],u=r[1];return new it.NumberVar(i>=u?1:0)}}]),t}(it.FuncOpBase),oD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="HEX2DEC",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=null;if(Wa(t[0]))n=t[0].getValue();else if(Ba(t[0])&&!Ga(t[0])&&(n=t[0].toStringVar().getValue()),null===n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(n.slice(0,2).toLowerCase()===_Z&&(n=n.slice(2)),!SZ(n))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_NON_DECIMAL_REPRESENTATION]({funcName:this.name,value:n,validValue:it.FormulaErrorPhrases.HEXADECIMAL});var a=n.length;return a>10?it.tractorErrorVarCreators[it.ErrorCode.STRING_TOO_LONG]({funcName:this.name,index:1,textLength:a,maxTextLength:10}):(r=n.length<10||10===n.length&&Number(n[0])<=7?parseInt(n,16):-1*parseInt(kZ(parseInt(n,16).toString(2),40).slice(3),2),new it.NumberVar(r))}}]),t}(it.FuncOpBase),iD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IFERROR",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.PRIMITIVE|it.VAR_TYPE.COLLECTION,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.STRING|it.VAR_TYPE.NULL|it.VAR_TYPE.ERROR|it.VAR_TYPE.BOOL},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.STRING|it.VAR_TYPE.NULL|it.VAR_TYPE.ERROR|it.VAR_TYPE.BOOL|it.VAR_TYPE.OPERATOR}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!0,e.$$expanded=!0,e.$$paramsDesc=[415,3487],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];return qa(r)?new it.NumberVar(0):ja(r)?t[1]:r}}]),t}(it.FuncOpBase),uD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMABS",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=null;if(Wa(t[0]))n=t[0].getValue();else if(Ba(t[0])&&!Ga(t[0])&&(n=t[0].toStringVar().getValue()),null===n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(!YZ(n=n.replace(/\s/g,"")))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();try{r=XZ(n)}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}var a=r,o=a.re,i=a.im,u=Math.sqrt(Math.pow(o,2)+Math.pow(i,2));return new it.NumberVar(u)}}]),t}(it.FuncOpBase),sD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMAGINARY",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=null;if(Wa(t[0]))n=t[0].getValue();else if(Ba(t[0])&&!Ga(t[0])&&(n=t[0].toStringVar().getValue()),null===n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(!YZ(n=n.replace(/\s/g,"")))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();try{r=XZ(n)}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}var a=r.im;return new it.NumberVar(a)}}]),t}(it.FuncOpBase),lD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMARGUMENT",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=null;if(Wa(t[0]))n=t[0].getValue();else if(Ba(t[0])&&!Ga(t[0])&&(n=t[0].toStringVar().getValue()),null===n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(!YZ(n=n.replace(/\s/g,"")))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();try{r=XZ(n)}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}var a=r,o=a.re,i=a.im,u=Math.atan2(i,o);return new it.NumberVar(u)}}]),t}(it.FuncOpBase),cD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMCONJUGATE",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=null;if(Wa(t[0]))n=t[0].getValue();else if(Ba(t[0])&&!Ga(t[0])&&(n=t[0].toStringVar().getValue()),null===n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(!YZ(n=n.replace(/\s/g,"")))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();var a=n.endsWith(WZ.j)?WZ.j:WZ.i;try{r=(r=XZ(n)).conjugate()}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}var o=KZ(r,a);return new it.StringVar(o)}}]),t}(it.FuncOpBase),hD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMCOS",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=null;if(Wa(t[0]))n=t[0].getValue();else if(Ba(t[0])&&!Ga(t[0])&&(n=t[0].toStringVar().getValue()),null===n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(!YZ(n=n.replace(/\s/g,"")))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();try{r=XZ(n)}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}var a=r,o=a.re,i=a.im,u=Math.cos(o)*Math.cosh(i),s=-Math.sin(o)*Math.sinh(i),l=KZ(new(rr())(u,s),n.endsWith(WZ.j)?WZ.j:WZ.i);return new it.StringVar(l)}}]),t}(it.FuncOpBase),fD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMDIV",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n],o=null;if(Wa(a))o=a.getValue();else if(qa(a))o="0";else if(Ba(a)&&!Ga(a)&&(o=a.toStringVar().getValue()),null===o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_STRING);r.push(o.replace(/\s/g,""))}var i=r[0],u=r[1];if(!YZ(i)||!YZ(u))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();var s,l,c,h=JZ(i,u),f=h.isSame,d=h.suffix;if(!f)return it.tractorErrorVarCreators[it.ErrorCode.COMPLEX_NUMBERS_WITH_DIFFERENT_SUFFIXES]();try{if(s=XZ(i),0===(l=XZ(u)).re&&0===l.im)return it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_PARAMETER_BEING_ZERO]({funcName:this.name,argIndex:2});c=s.div(l)}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}if(!Number.isFinite(c.im)||!Number.isFinite(c.re))return it.NA_ERR_VAR;var v=KZ(c,d);return new it.StringVar(v)}}]),t}(it.FuncOpBase),dD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMEXP",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=null;if(Wa(t[0]))n=t[0].getValue();else if(Ba(t[0])&&!Ga(t[0])&&(n=t[0].toStringVar().getValue()),null===n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(!YZ(n=n.replace(/\s/g,"")))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();try{r=XZ(n).exp()}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}var a=WZ.i;0!==r.im&&n[n.length-1]===WZ.j&&(a=WZ.j);var o=KZ(r,a);return new it.StringVar(o)}}]),t}(it.FuncOpBase),vD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMLN",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=null;if(Wa(t[0]))n=t[0].getValue();else if(Ba(t[0])&&!Ga(t[0])&&(n=t[0].toStringVar().getValue()),null===n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(!YZ(n=n.replace(/\s/g,"")))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();try{r=XZ(n).log()}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}var a=WZ.i;0!==r.im&&n[n.length-1]===WZ.j&&(a=WZ.j);var o=KZ(r,a);return new it.StringVar(o)}}]),t}(it.FuncOpBase),pD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMLOG10",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=null;if(Wa(t[0]))n=t[0].getValue();else if(Ba(t[0])&&!Ga(t[0])&&(n=t[0].toStringVar().getValue()),null===n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(!YZ(n=n.replace(/\s/g,"")))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();try{r=function(e){return new(rr())(e).log().div(Math.LN10)}(XZ(n))}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}var a=r.toString().replace(/\s/g,"");return 0!==r.im&&n[n.length-1]===WZ.j&&(a=a.replace(WZ.i,WZ.j)),new it.StringVar(a)}}]),t}(it.FuncOpBase),mD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMLOG2",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=null;if(Wa(t[0]))n=t[0].getValue();else if(Ba(t[0])&&!Ga(t[0])&&(n=t[0].toStringVar().getValue()),null===n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(!YZ(n=n.replace(/\s/g,"")))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();try{r=function(e){var t=Math.sqrt(e.re*e.re+e.im*e.im);return new(rr())(Math.log2?Math.log2(t):Math.log(t)/Math.LN2,Math.atan2(e.im,e.re)/Math.LN2)}(XZ(n))}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}var a=r.toString().replace(/\s/g,"");return 0!==r.im&&n[n.length-1]===WZ.j&&(a=a.replace(WZ.i,WZ.j)),new it.StringVar(a)}}]),t}(it.FuncOpBase),gD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMPOWER",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=null;if(Wa(t[0]))r=t[0].getValue();else if(qa(t[0]))r="0";else if(Ba(t[0])&&!Ga(t[0])&&(r=t[0].toStringVar().getValue()),null===r)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_STRING);var n=Zc(e.service,t[1],!0);if(!n)return Rl(this.name,2,El(t[1]),wl(t[1]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var a,o=n.getValue();if(!YZ(r))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();try{a=XZ(r).pow(new(rr())(o,0))}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}var i=WZ.i;0!==a.im&&r[r.length-1]===WZ.j&&(i=WZ.j);var u=KZ(a,i);return new it.StringVar(u)}}]),t}(it.FuncOpBase),yD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMPRODUCT",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.COLLECTION|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.STRING|it.VAR_TYPE.COLLECTION|it.VAR_TYPE.BOOL,default:new it.StringVar("1")}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=this,n=new(rr())(1,0),a=null,o=function(o){var i=t[o].forEach((function(t){if(ja(t))return t;if(Ga(t))return Rl(r.name,o+1,El(t),wl(t),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(qa(t))0===o&&(n=n.mul(0));else{var i=Fc(e.service,t,4);if(!i)return Rl(r.name,o+1,El(t),wl(t),it.FormulaErrorPhrases.DATA_TYPE_STRING);var u=i.getValue();if(!YZ(u))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();var s=XZ(u);if(0===s.im)n=n.mul(s);else{var l=JZ(u,KZ(n,a)),c=l.isSame,h=l.suffix;if(!c)return it.tractorErrorVarCreators[it.ErrorCode.COMPLEX_NUMBERS_WITH_DIFFERENT_SUFFIXES]();n=n.mul(s),a=h}}}));if(i)return{v:i}},i=0;i<t.length;++i){var u=o(i);if("object"===(0,R.Z)(u))return u.v}var s=KZ(n,a);return new it.StringVar(s)}}]),t}(it.FuncOpBase),_D=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMSUB",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.STRING|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n],o=null;if(Wa(a))o=a.getValue();else if(qa(a))o="0";else if(Ba(a)&&!Ga(a)&&(o=a.toStringVar().getValue()),null===o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_STRING);r.push(o.replace(/\s/g,""))}var i=r[0],u=r[1];if(!YZ(i)||!YZ(u))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();var s,l,c,h=JZ(i,u),f=h.isSame,d=h.suffix;if(!f)return it.tractorErrorVarCreators[it.ErrorCode.COMPLEX_NUMBERS_WITH_DIFFERENT_SUFFIXES]();try{s=XZ(i),l=XZ(u),c=s.sub(l)}catch(e){return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]()}var v=KZ(c,d);return new it.StringVar(v)}}]),t}(it.FuncOpBase),RD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMSUM",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.STRING|it.VAR_TYPE.COLLECTION|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.STRING|it.VAR_TYPE.COLLECTION|it.VAR_TYPE.BOOL,default:new it.StringVar("0")}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=this,n=null,a=new(rr())(0,0),o=function(o){var i=t[o].forEach((function(t){if(ja(t))return t;if(Ga(t))return Rl(r.name,o+1,El(t),wl(t),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(!qa(t)){var i=Fc(e.service,t,4);if(!i)return Rl(r.name,o+1,El(t),wl(t),it.FormulaErrorPhrases.DATA_TYPE_STRING);var u=i.getValue();if(!YZ(u))return it.tractorErrorVarCreators[it.ErrorCode.INVALID_COMPLEX_NUMBER]();var s=XZ(u);if(0===s.im)a=a.add(s);else{var l=JZ(u,KZ(a,n)),c=l.isSame,h=l.suffix;if(!c)return it.tractorErrorVarCreators[it.ErrorCode.COMPLEX_NUMBERS_WITH_DIFFERENT_SUFFIXES]();a=a.add(s),n=h}}}));if(i)return{v:i}},i=0;i<t.length;++i){var u=o(i);if("object"===(0,R.Z)(u))return u.v}var s=KZ(a,n);return new it.StringVar(s)}}]),t}(it.FuncOpBase),CD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="INTERCEPT",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.COLLECTION|it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.COLLECTION|it.VAR_TYPE.NUMBER}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<2;++r)if(Ba(t[r])){var n=Zc(e.service,t[r]);if(!n)return Rl(this.name,r+1,El(t[r]),wl(t[r]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);t[r]=n}var a=t[0],o=t[1],i=a.size();if(o.size()!==i)return Fl(this.name,o.size(),i);for(var u=o.colCount(),s=a.colCount(),l=[],c=[],h=0,f=0,d=0;d<i;++d){var v=o.at(d/u|0,d%u),p=a.at(d/s|0,d%s);if(ja(v))return v;if(ja(p))return p;za(v)&&za(p)&&(h+=v.getValue(),f+=p.getValue(),l.push(v.getValue()),c.push(p.getValue()))}var m=l.length;if(m<=1)return ql(this.name);for(var g=h/m,y=f/m,_=0,R=0,C=0;C<m;C++)_+=(l[C]-g)*(c[C]-y),R+=Math.pow(l[C]-g,2);return new it.NumberVar(y-_/R*g)}}]),t}(it.FuncOpBase),wD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="INT",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.NumberVar(DZ(t[0].getValue()))}}]),t}(it.FuncOpBase),ED=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IPMT",e.operands=4,e.optionOperands=2,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:it.NUM_ERR_VAR},{type:it.VAR_TYPE.NUMBER,default:it.NUM_ERR_VAR},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=4,e.$$maxOperands=6,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3].getValue(),i=t[4]?t[4].getValue():0,u=t[5]?t[5].getValue():0;if(0!==u&&(u=1),n<1)return it.tractorErrorVarCreators[it.ErrorCode.NUM_OUT_OF_RANGE_PARAMETER]({funcName:this.name,index:2,value:n.toString()});if(n>a)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:3,value:a,lowerBound:n});var s=vx(r,n,a,o,i,u);return new it.NumberVar(s)}}]),t}(it.FuncOpBase),kD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IRR",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION|it.VAR_TYPE.BOOL,default:it.VALUE_ERR_VAR},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(.1)}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,259],e.$$calcCustomData=function(){return{autoFormat:"0%"}},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1]&&za(t[1])?t[1].getValue():.1;if(n<=-1)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:2,value:n,lowerBound:-1});var a=[],o=!1,i=!1;if(r.forEach((function(e){if(za(e)){var t=e.getValue();a.push(t),t>0&&(o=!0),t<0&&(i=!0)}else if(ja(e))return e})))return it.VALUE_ERR_VAR;if(!o||!i)return it.tractorErrorVarCreators[it.ErrorCode.VALUE_REQUIRES_POSITIVE_AND_NEGATIVE_VALUES]({funcName:this.name});var u=Rx((function(e){return a.reduce((function(t,r,n){return t+r*Math.pow(1+e,-n)}),0)}),n);return null===u?it.NUM_ERR_VAR:new it.NumberVar(u)}}]),t}(it.FuncOpBase),TD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ISERR",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.BASIC}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(ja(t[0])&&t[0].getVar().getValue()!==it.ErrorConstant.NA)}}]),t}(it.FuncOpBase),SD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ISEVEN",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Zc(e.service,t[0],!0);return r?new it.BooleanVar(Math.floor(Math.abs(r.getValue()))%2==0):Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE)}}]),t}(it.FuncOpBase),AD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ISLOGICAL",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.BASIC}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(Ga(t[0]))}}]),t}(it.FuncOpBase),ID=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ISNA",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.BASIC}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(ja(t[0])&&t[0].getValue()===it.ErrorConstant.NA)}}]),t}(it.FuncOpBase),OD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ISNONTEXT",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.BASIC}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(!Wa(t[0]))}}]),t}(it.FuncOpBase),VD=function(e){function t(e,r,n,a){var o;return(0,y.Z)(this,t),(o=(0,d.Z)(this,(0,v.Z)(t).call(this,n,a))).bit=e,o.errors=r,o._hash=null,o}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"customType",get:function(){return"PrimitiveMatrixVar"}}]),(0,_.Z)(t,[{key:"getVarByPos",value:function(e,t){var r=e*this.colCount()+t,n=this.errors.get(r);if(void 0!==n)return n;var a=r/31|0;return void 0===this.idx&&(this.idx=new Set(this.bit.getIdx())),this.idx.has(a)&&this.bit.getArr()[a]&1<<r%31?this.truly():this.falsy()}},{key:"truly",value:function(){return it.BOOLEAN_VAR_MAP[it.BooleanConstant.TRUE]}},{key:"falsy",value:function(){return it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE]}},{key:"setHash",value:function(e){this._hash=e}},{key:"hash",value:function(){return this._hash}},{key:"getBit",value:function(){return this.bit}},{key:"getErrors",value:function(){return this.errors}},{key:"getTrulyIndex",value:function(){return this.bit.toArray()}}]),t}(ms),ND=new it.NumberVar(1),bD=new it.NumberVar(0),MD=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"truly",value:function(){return ND}},{key:"falsy",value:function(){return bD}}]),t}(VD);function FD(e,t,r){for(var n=0,a=e.length;n<a;){var o=(n+a)/2|0,i=r(t,e[o]);if(0===i)return o;i>0?n=o+1:a=o}return-1-n|0}function ZD(e,t){return FD(e,t,(function(e,t){return PD(e,t.val)}))}function xD(e,t){for(var r=0,n=e.length;n-r>3;){var a=(r+n)/2|0;t.type-e[a].val.type<=0?n=a+1:r=a+1}for(;r<n;r++){var o=t.type-e[r].val.type;if(0===o)return r;if(o<0)return-1-r}return-1-n}function DD(e,t){for(var r=0,n=e.length;(n-r|0)>3;){var a=(r+n)/2|0,o=t.type-e[a].val.type;0===o?r=a:o>0?r=a+1:n=a}for(n--;n>=r;n--){var i=t.type-e[n].val.type;if(0===i)return n;if(i>0)return-2-n|0}return-1-r|0}function PD(e,t){var r=e.type-t.type;return 0!==r?r:e.equals(t)?0:e.greaterThan(t)?1:-1}function $D(e,t){var r=e.isNull()?it.VAR_TYPE.ALL:e.type,n=t.isNull()?it.VAR_TYPE.ALL:t.type;return r!==n?r-n:e.isError()&&t.isError()?e.errorType-t.errorType:e.equals(t)?0:e.greaterThan(t)?1:-1}var LD=function(){function e(t,r){(0,y.Z)(this,e),t&&r?(this.arr=t,this.idx=r):(this.arr=[],this.idx=[])}return(0,_.Z)(e,[{key:"intersect",value:function(e){for(var t=0,r=0,n=0,a=this.idx.length,o=e.idx.length;t<a&&r<o;){var i=this.idx[t],u=e.idx[r];if(i===u){var s=this.arr[i]&e.arr[u];0!==s&&(this.idx[n]=i,this.arr[i]=s,n++),t++,r++}else i<u?t++:r++}this.idx.length=n,this.arr.length=0===n?0:this.idx[n-1]+1}},{key:"add",value:function(e){var t=e/31|0,r=1<<e%31;if(void 0===this.arr[t]&&(this.arr[t]=0),this.arr[t]|=r,0===this.idx.length||this.idx[this.idx.length-1]<t)this.idx.push(t);else if(this.idx[this.idx.length-1]!==t){var n=FD(this.idx,t,(function(e,t){return e-t}));n<0&&this.idx.splice(-n-1,0,t)}}},{key:"toArray",value:function(){for(var e=[],t=0,r=this.idx.length;t<r;t++)for(var n=this.idx[t],a=this.arr[n],o=0;0!==a;++o)1&~a||e.push(31*n+o),a>>>=1;return e}},{key:"clone",value:function(){return new e(this.arr.slice(),this.idx.slice())}},{key:"length",value:function(){return this.idx.length}},{key:"getArr",value:function(){return this.arr}},{key:"getIdx",value:function(){return this.idx}}]),e}(),BD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ISNUMBER",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.BASIC}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(za(t[0]))}},{key:"arrayFunc",value:function(e,t){for(var r=t[0].rowCount(),n=t[0].colCount(),a=new LD,o=0;o<r;o++)for(var i=0;i<n;i++)za(t[0].at(o,i))&&a.add(o*n+i);return new VD(a,new Map,r,n)}}]),t}(it.FuncOpBase),UD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ISODD",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Zc(e.service,t[0],!0);return r?new it.BooleanVar(Math.floor(Math.abs(r.getValue()))%2!=0):Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE)}}]),t}(it.FuncOpBase),HD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ISTEXT",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.BASIC}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(Wa(t[0]))}}]),t}(it.FuncOpBase),zD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LARGE",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return mk(e,t[0],t[1],this.name)}}]),t}(it.FuncOpBase),WD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LCM",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL|it.VAR_TYPE.ERROR|it.VAR_TYPE.COLLECTION,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL|it.VAR_TYPE.ERROR|it.VAR_TYPE.COLLECTION,default:new it.NumberVar(1)}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return rD(e,t,tD,1)}}]),t}(it.FuncOpBase),GD=function(e){function t(){var e,r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LEFT",r.operands=1,r.optionOperands=1,r.resultType=it.VAR_TYPE.STRING,r.repeatedLastParam=0,r.paramsDesc=[{type:it.VAR_TYPE.STRING},{type:it.VAR_TYPE.NUMBER,default:(e={},(0,l.Z)(e,it.DefaultParam.IfInputNull,new it.NumberVar(0)),(0,l.Z)(e,it.DefaultParam.IfNotInput,new it.NumberVar(1)),e)}],r.$$minOperands=1,r.$$maxOperands=2,r.$$lazy=!1,r.$$paramsDesc=[260,259],r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[1]?za(t[1])?t[1].getValue():0:1;if(r<0)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:2});var n=t[0].getValue();return new it.StringVar(n.substr(0,r))}}]),t}(it.FuncOpBase),jD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LEN",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.NumberVar(t[0].getValue().length)}}]),t}(it.FuncOpBase),YD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LENB",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=0,a=yr(t[0].getValue());try{for(a.s();!(r=a.n()).done;){var o=r.value.codePointAt(0);o&&(n+=o<255?1:o<65535?2:4)}}catch(e){a.e(e)}finally{a.f()}return new it.NumberVar(n)}}]),t}(it.FuncOpBase),qD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LN",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return r<=0?it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:1,value:r,lowerBound:0}):new it.NumberVar(Math.log(r))}}]),t}(it.FuncOpBase),JD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LOG",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(10)}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1]&&za(t[1])?t[1].getValue():10;if(n<=0||r<=0){var a=r<=0?1:2,o=1===a?r:n;return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:a,value:o,lowerBound:0})}if(1===n)return it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_FUNCTION_EVAL]({funcName:this.name});if(10===n)return new it.NumberVar(Math.log(r)*Math.LOG10E);var i=Math.log(r)/Math.log(n);return new it.NumberVar(i)}}]),t}(it.FuncOpBase),KD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LOG10",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return r<=0?it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:1,value:r,lowerBound:0}):new it.NumberVar(Math.log10(r))}}]),t}(it.FuncOpBase),XD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LOWER",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.StringVar(t[0].getValue().toLowerCase())}}]),t}(it.FuncOpBase),QD=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MAX",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e.$$calcCustomData=XF,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r,n=0;n<t.length;++n){var a=t[n];if(ja(a))return a;if(Ba(a)){var o=Zc(e.service,a);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);a=o}var i=a.forEach((function(e){if(za(e)){var t=e.getValue();(null==r||t>r)&&(r=t)}else if(ja(e))return e}));if(i)return i}return new it.NumberVar(r||0)}}]),t}(it.FuncOpBase),eP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MEDIAN",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e.$$calcCustomData=XF,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n];Ba(a)&&(a=Zc(e.service,a)||Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE)),r.push(a)}return pk(2,e,r,null,this.name)}}]),t}(it.FuncOpBase),tP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MID",e.operands=3,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[260,258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue();return n<1?it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:2,value:n,lowerBound:1}):a<0?it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:3}):n>r.length?new it.StringVar(""):new it.StringVar(r.substr(n-1,a))}}]),t}(it.FuncOpBase),rP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MIN",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e.$$calcCustomData=XF,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r,n=0;n<t.length;++n){var a=t[n];if(ja(a))return a;Ba(a)&&(a=Zc(e.service,a)||Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));var o=a.forEach((function(e){if(za(e)){var t=e.getValue();(null==r||t<r)&&(r=t)}else if(ja(e))return e}));if(o)return o}return new it.NumberVar(r||0)}}]),t}(it.FuncOpBase),nP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MIRR",e.operands=3,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.COLLECTION,default:it.VALUE_ERR_VAR},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[32,258,258],e.$$calcCustomData=function(){return{autoFormat:"0%"}},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[1].getValue(),n=t[2].getValue(),a=[],o=[],i=t[0].forEach((function(e){if(ja(e))return e;if(za(e)){var t=e.getValue();t>0?o.push(t):t<0&&a.push(t)}}));if(i)return i;if(0===a.length||0===o.length)return it.tractorErrorVarCreators[it.ErrorCode.DIV0_REQUIRES_POSITIVE_AND_NEGATIVE_VALUES]({funcName:this.name});var u=a.length+o.length,s=-mx(n,o)*Math.pow(1+n,u-1),l=mx(r,a)*(1+r),c=Math.pow(s/l,1/(u-1))-1;return new it.NumberVar(c)}}]),t}(it.FuncOpBase),aP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MOD",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();if(0===n)return it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_PARAMETER_BEING_ZERO]({funcName:this.name,argIndex:2});if(11259e8*Math.abs(n)<Math.abs(r))return yl(this.name,r,1,2,"".concat(n," * 1125900000000"));var a=r-n*Math.floor(r/n);return new it.NumberVar(a)}}]),t}(it.FuncOpBase),oP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MROUND",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n],o=Zc(e.service,a,!0);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r.push(o.getValue())}var i=r[0],u=r[1];return i>0&&u<0||i<0&&u>0?it.tractorErrorVarCreators[it.ErrorCode.DIFFERENT_SIGNS]({funcName:this.name}):new it.NumberVar(0===u?0:PZ(i/u)*u)}}]),t}(it.FuncOpBase),iP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="N",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL|it.VAR_TYPE.STRING|it.VAR_TYPE.NULL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];return za(r)?r:Ga(r)?r.toNumberVar():new it.NumberVar(0)}}]),t}(it.FuncOpBase),uP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="NA",e.operands=0,e.optionOperands=0,e.resultType=it.VAR_TYPE.ERROR,e.repeatedLastParam=0,e.paramsDesc=[],e.$$minOperands=0,e.$$maxOperands=0,e.$$lazy=!1,e.$$paramsDesc=[],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(){return it.NA_ERR_VAR}}]),t}(it.FuncOpBase),sP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="NOMINAL",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399,399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n],o=Zc(e.service,a,!0);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r.push(o.getValue())}var i=r[0],u=Math.floor(r[1]);if(i<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:1,value:i,lowerBound:0});if(u<1)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:2,value:r[1],lowerBound:1});var s=(Math.pow(i+1,1/u)-1)*u;return new it.NumberVar(s)}}]),t}(it.FuncOpBase),lP=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"NORM.DIST";return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).name=r,e.operands=4,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.BOOL,default:new it.BooleanVar(!1)}],e.$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0].getValue(),a=t[1].getValue(),o=t[2].getValue(),i=!!t[3]&&t[3].getValue();return o<=0?it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:1,value:o,lowerBound:0}):(r=i?tZ((n-a)/o):rZ(n,a,o),new it.NumberVar(r))}}]),t}(it.FuncOpBase),cP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="NORMSDIST",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=tZ(t[0].getValue());return new it.NumberVar(r)}}]),t}(it.FuncOpBase),hP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="NORM.S.DIST",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.BOOL,default:new it.BooleanVar(!1)}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0].getValue();return r=t[1]&&t[1].getValue()?tZ(n):rZ(n,0,1),new it.NumberVar(r)}}]),t}(it.FuncOpBase),fP=function(e){function t(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"NORM.S.INV";return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).name=r,e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<=0||r>=1)return it.tractorErrorVarCreators[it.ErrorCode.SHOULD_BE_BETWEEN_EXCLUSIVE]({funcName:this.name,index:1,value:r,lowerBound:0,upperBound:1});var n=eZ(r,0,1);return new it.NumberVar(n)}}]),t}(it.FuncOpBase),dP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="NOT",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(!t[0].getValue())}}]),t}(it.FuncOpBase),vP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="NPER",e.operands=3,e.optionOperands=2,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=3,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3]?t[3].getValue():0,i=t[4]?t[4].getValue():0;if(0!==i&&(i=1),r<=-1)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:1,value:r,lowerBound:0});if(0===r&&0!==n)return new it.NumberVar(-(o+a)/n);var u=n*(1+r*i)-o*r,s=n*(1+r*i)+a*r;if(0===s)return it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_FUNCTION_EVAL]({funcName:this.name});var l=u/s;if(l<=0)return it.tractorErrorVarCreators[it.ErrorCode.SCENARIO_NOT_POSSIBLE]({funcName:this.name});if(r<=-1)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:1,value:r,lowerBound:-1});var c=Math.log(l)/Math.log(1+r);return new it.NumberVar(c)}}]),t}(it.FuncOpBase),pP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="NPV",e.operands=2,e.optionOperands=253,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION,default:new it.NumberVar(0)}],e.$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[258,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=t[0].getValue(),n=[],a=1;a<t.length;++a){var o=t[a];Ja(o)||(o=Zc(e.service,o)||Rl(this.name,a+1,El(o),wl(o),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));var i=o.forEach((function(e){if(za(e))n.push(e.getValue());else if(ja(e))return e}));if(i)return i}var u=mx(r,n);return new it.NumberVar(u)}}]),t}(it.FuncOpBase),mP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ODD",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=r<0,a=Math.ceil(Math.abs(r)),o=a%2==1?a:a+1;return new it.NumberVar(n?-o:o)}}]),t}(it.FuncOpBase),gP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="OR",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.BOOL|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.BOOL|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=!0,n=!1,a=0;a<t.length;++a){var o=t[a];if(Ba(o))o=Dc(o)||Rl(this.name,a+1,El(o),wl(o),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN);else if(!Ja(o))return Rl(this.name,a+1,El(o),wl(o),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN);var i=o.forEach((function(e){if(ja(e))return e;!n&&10&e.$$type&&(r=!1,e.getValue()&&(n=!0))}));if(i)return i}return r?Gl(this.name):new it.BooleanVar(n)}}]),t}(it.FuncOpBase),yP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="PERCENTILE",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return gk(e,t[0],t[1],this.name)}}]),t}(it.FuncOpBase),_P=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="PERCENTRANK",e.operands=2,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION|it.VAR_TYPE.NULL},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.NULL},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(3)}],e.$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[33,259,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(qa(t[0])&&qa(t[1]))return new it.NumberVar(1);if(qa(t[0])||qa(t[1]))return Yl(this.name);var r=t[0];if(Ba(r)){var n=Zc(e.service,r);if(!n)return Rl(this.name,1,El(r),wl(r),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r=n}var a=[],o=r.forEach((function(e){if(za(e))a.push(e.getValue());else if(ja(e))return e}));if(o)return o;var i=t[1].getValue(),u=a.length;if(1===u&&i===a[0])return new it.NumberVar(1);a=a.sort((function(e,t){return e-t}));var s=t[2]&&za(t[2])?t[2].getValue():3;if(s<1)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:3,value:s,lowerBound:1});if(i<a[0]||i>a[u-1])return it.tractorErrorVarCreators[it.ErrorCode.NA_NO_VALID_DATA]({funcName:this.name});if(a.indexOf(i)>=0)return new it.NumberVar(it.NumberVar.toFixed(RP(a,i),s));var l=CP(a,i),c=l.min,h=l.max;if(null==c||null==h)return it.NA_ERR_VAR;var f=RP(a,a[c]),d=RP(a,a[h]);return new it.NumberVar(it.NumberVar.toFixed(f+(i-a[c])/(a[h]-a[c])*(d-f),s))}}]),t}(it.FuncOpBase);function RP(e,t){var r=CP(e,t),n=r.min,a=r.max;return null==n?0:null==a?1:(n+1)/(n+1+e.length-a)}function CP(e,t){for(var r=null,n=null,a=0;a<e.length;a++){if(e[a]<t&&(r=a),e[a]===t)return{min:r,max:n=a+1>e.length-1?null:a+1};if(e[a]>t)return{min:r,max:n=a}}return{min:r,max:n}}var wP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="PI",e.operands=0,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[],e.$$minOperands=0,e.$$maxOperands=0,e.$$lazy=!1,e.$$paramsDesc=[],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(){return new it.NumberVar(Math.PI)}}]),t}(it.FuncOpBase),EP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="PMT",e.operands=3,e.optionOperands=2,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=3,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3]?t[3].getValue():0,i=t[4]?t[4].getValue():0;0!==i&&(i=1);var u=function(e,t,r){var n,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4?arguments[4]:void 0;if(0===e)n=(r+a)/t;else{var i=Math.pow(1+e,t);n=1===o?(a*e/(i-1)+r*e/(1-1/i))/(1+e):a*e/(i-1)+r*e/(1-1/i)}return-n}(r,n,a,o,i);return new it.NumberVar(u)}}]),t}(it.FuncOpBase),kP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="PPMT",e.operands=4,e.optionOperands=2,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:it.NUM_ERR_VAR},{type:it.VAR_TYPE.NUMBER,default:it.NUM_ERR_VAR},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=4,e.$$maxOperands=6,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3].getValue(),i=t[4]?t[4].getValue():0,u=t[5]?t[5].getValue():0;if(0!==u&&(u=1),n<1)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:2,value:n,lowerBound:1});if(a<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:3,value:a,lowerBound:0});if(n>a)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO]({funcName:this.name,index:2,value:n,upperBound:a});var s=px(r,n,a,o,i,u);return new it.NumberVar(s)}}]),t}(it.FuncOpBase),TP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="PRODUCT",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION|it.VAR_TYPE.NULL|it.VAR_TYPE.STRING},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION|it.VAR_TYPE.NULL|it.VAR_TYPE.STRING}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return ak(e,t)}}]),t}(it.FuncOpBase);var SP,AP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="POWER",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return function(e,t){var r=e.getValue(),n=t.getValue();if(0===r&&n<=0)return 0===n?it.NUM_ERR_VAR:it.tractorErrorVarCreators[it.ErrorCode.DIV0_POSITIVE_OVERFLOW]({upperBound:Us});var a=Math.pow(r,n);return Number.isFinite(a)?new it.NumberVar(a):it.NUM_ERR_VAR}(t[0],t[1])}}]),t}(it.FuncOpBase),IP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="PV",e.operands=3,e.optionOperands=2,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=3,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3]?t[3].getValue():0,i=t[4]?t[4].getValue():0;if(0!==i&&(i=1),0===n)return new it.NumberVar(-o);var u=Math.pow(1+r,n);return new it.NumberVar(-(a*(1+r*i)*(u-1)/r+o)/u)}}]),t}(it.FuncOpBase),OP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="QUARTILE",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return _k(e,t[0],t[1],this.name)}}]),t}(it.FuncOpBase),VP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="QUOTIENT",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();if(0===n)return it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_PARAMETER_BEING_ZERO]({funcName:this.name,argIndex:2});var a=r/n;if(Number.isFinite(a)){var o=a>0?Math.floor(r/n):Math.ceil(r/n);return new it.NumberVar(0===o?0:o)}return Ys}}]),t}(it.FuncOpBase),NP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="RADIANS",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.NumberVar(t[0].getValue()*Math.PI/180)}}]),t}(it.FuncOpBase),bP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="RANDBETWEEN",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER,default:it.NA_ERR_VAR}],e.alwaysCalc=!0,e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();if(r>n)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:2,value:n,lowerBound:r});if((r=Math.ceil(r))>n)return new it.NumberVar(r);n=Math.floor(n);var a=Math.floor(r+(n-r+1)*Math.random());return new it.NumberVar(a)}}]),t}(it.FuncOpBase),MP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="RAND",e.operands=0,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[],e.alwaysCalc=!0,e.$$minOperands=0,e.$$maxOperands=0,e.$$lazy=!1,e.$$paramsDesc=[],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(){return new it.NumberVar(Math.random())}}]),t}(it.FuncOpBase),FP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="RATE",e.operands=3,e.optionOperands=3,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.$$calcCustomData=function(){return{autoFormat:"0%"}},e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:it.NUM_ERR_VAR},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(.1)}],e.$$minOperands=3,e.$$maxOperands=6,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,258,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3]?t[3].getValue():0,i=t[4]?t[4].getValue():0,u=t[5]&&za(t[5])?t[5].getValue():.1;if(0!==i&&(i=1),0===n&&0===a)return it.tractorErrorVarCreators[it.ErrorCode.REQUIRES_POSITIVE_AND_NEGATIVE_VALUES]({funcName:this.name});if(r<=0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_GREATER_THAN]({funcName:this.name,index:1,value:r,lowerBound:0});var s=Rx((function(e){if(0===e)return a+n*r+o;var t=Math.pow(1+e,-r);return a+n*Math.pow(1+e,i)*(1-t)/e+o*t}),u);return null===s?it.tractorErrorVarCreators[it.ErrorCode.REQUIRES_POSITIVE_AND_NEGATIVE_VALUES]({funcName:this.name}):new it.NumberVar(s)}}]),t}(it.FuncOpBase),ZP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="REPLACE",e.operands=4,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING,default:new it.StringVar("")},{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.STRING,default:new it.StringVar("")}],e.$$minOperands=4,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[260,258,258,260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=Math.floor(t[1].getValue()),a=Math.floor(t[2].getValue());if(n<=0)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:2,value:n,lowerBound:1});if(a<0)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:3});var o=r.slice(0,n-1),i=r.slice(n+a-1,r.length),u=o+t[3].getValue()+i;return new it.StringVar(u)}}]),t}(it.FuncOpBase),xP=function(e){function t(){var e,r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="RIGHT",r.operands=1,r.optionOperands=1,r.resultType=it.VAR_TYPE.STRING,r.repeatedLastParam=0,r.paramsDesc=[{type:it.VAR_TYPE.STRING},{type:it.VAR_TYPE.NUMBER,default:(e={},(0,l.Z)(e,it.DefaultParam.IfInputNull,new it.NumberVar(0)),(0,l.Z)(e,it.DefaultParam.IfNotInput,new it.NumberVar(1)),e)}],r.$$minOperands=1,r.$$maxOperands=2,r.$$lazy=!1,r.$$paramsDesc=[260,259],r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[1]?za(t[1])?t[1].getValue():0:1;if(r<0)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:2});var n=t[0].getValue(),a=n.length-r<0?0:n.length-r;return new it.StringVar(n.substr(a,r))}}]),t}(it.FuncOpBase),DP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ROUNDDOWN",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1]?0|t[1].getValue():0,a=r*(n=Math.pow(10,n));return new it.NumberVar(r>=0?DZ(a)/n:xZ(a)/n)}}]),t}(it.FuncOpBase),PP=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ROUND",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e.$$calcCustomData=KF,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.NumberVar(MZ(t[0].getValue(),t[1]?0|t[1].getValue():0))}}]),t}(it.FuncOpBase),$P=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ROUNDUP",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1]?0|t[1].getValue():0,a=r*(n=Math.pow(10,n));return new it.NumberVar(r>=0?xZ(a)/n:DZ(a)/n)}}]),t}(it.FuncOpBase);function LP(e){return!!(14&e.$$type)}function BP(e,t,r){return LP(r)?r.greaterThan(t)?0:1:ja(t)&&ja(r)?t.errorType<r.errorType?0:1:t.getValue()<r.getValue()?0:1}function UP(e,t,r){return LP(r)?r.lessThan(t)?0:-1:ja(t)&&ja(r)?t.errorType>r.errorType?0:-1:t.getValue()>r.getValue()?0:-1}function HP(e,t,r,n){if(t.equals(r))return 0;if(Wa(t)&&Wa(r)){if(n&&n.test(r.getValue()))return 0;if(t.greaterThan(r))return 1}else if(t.getValue()>r.getValue())return 1;return-1}function zP(e,t){var r=function(e){if(!Wa(e))return SP.Single;var t=e.getValue(),r=t.toUpperCase();return it.ERROR_VAR_MAP[r]||it.BOOLEAN_VAR_MAP[r]?SP.Single:t.match(/^(<>|=|[><]=?)/)?SP.Compare:t.match(/[~?*]+/)?SP.WildCard:SP.Single}(t),n=t.getValue();if(r===SP.Single){var a=Wa(t=jP(e.service,t))?KP(t.getValue()):null;if(za(t))return WP(e,t,{type:"=",regex:a});var o=GP(e,{type:"=",regex:a},t);return function(e){return e=qa(e)?e.toStringVar():e,o(e)}}if(r===SP.WildCard){var i=XP(n);return function(e){return!!Wa(e)&&i.test(e.getValue())}}if(r===SP.Compare){var u=/^(<>|=|[><]=?)/.exec(n)[0],s=n.substr(u.length),l=!Wa(t=""===s?it.NULL_VAR:jP(e.service,new it.StringVar(s)))||"="!==u&&"<>"!==u?null:KP(t.getValue());return WP(e,t,{type:u,regex:l})}return null}function WP(e,t,r){var n=GP(e,r,t);return!za(t)||"="!==r.type&&"<>"!==r.type?n:function(t){var r=Wa(t)?t.toNumberVar(e.service):t;return n(r)}}function GP(e,t,r){var n,a=t.type;if("="!==a&&"<>"!==a&&qa(r))return function(){return!1};switch(t.type){case"=":n=function(e){return 0===HP(0,r,e,t.regex)};break;case"<>":n=function(e){return 0!==HP(0,r,e,t.regex)};break;case">=":n=function(e){return UP(0,r,e)<0};break;case"<=":n=function(e){return BP(0,r,e)>0};break;case">":n=function(e){return BP(0,r,e)<=0};break;case"<":n=function(e){return UP(0,r,e)>=0};break;default:throw new Error("Unexpected info type")}var o="<>"===a;return function(e){return r.type!==e.type?o:n(e)}}function jP(e,t){return Wa(t)?gd(e,t.getValue()):t}!function(e){e[e.Single=0]="Single",e[e.Compare=1]="Compare",e[e.WildCard=2]="WildCard"}(SP||(SP={}));var YP=/~~|~\?|~\*|\?|\*/;function qP(e){return e.replace(/[|\\{}()[\]^$+.]/g,"\\$&")}function JP(e){return qP(e).replace(/~~|~\?|~\*|\?|\*/g,(function(e){switch(e){case"~~":return"~";case"~?":return"\\?";case"~*":return"\\*";case"?":return".";case"*":return"[\\s\\S]*";default:return e}}))}function KP(e,t){var r=JP(e);return t?new RegExp(r,"i"):new RegExp("^".concat(r,"$"),"i")}function XP(e,t){var r=function(e){for(var t,r=[],n=0,a=/\*/g;t=a.exec(e);){for(var o=0,i=t.index-1;"~"===e[i];)o++,i--;if(o%2==0){var u=e.substring(n,t.index);""===u&&0!==r.length||r.push(u),n=t.index+1}}var s=e.substring(n);return""===s&&""===r[r.length-1]||r.push(s),r}(e);if(r.length<=1)return KP(e,t);var n=r.map((function(e,n){var a=JP(e);return 0!==n||t?n!==r.length-1||t?new RegExp(a,"ig"):new RegExp("".concat(a,"$"),"ig"):new RegExp("^".concat(a),"ig")}));return{test:function(e){for(var t=0,r=0,a=n.length;r<a;r++){var o=n[r];if(o.lastIndex=t,!o.test(e))return!1;t=o.lastIndex}return!0},exec:function(e){var t=0;n[0].lastIndex=t;var r=n[0].exec(e);if(!r)return null;for(var a=r.index,o=1,i=n.length;o<i;o++){var u=n[o];if(u.lastIndex=t,!u.test(e))return null;t=u.lastIndex}return{index:a}}}}var QP=function(e){function t(){var e,r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SEARCH",r.operands=2,r.optionOperands=1,r.resultType=it.VAR_TYPE.NUMBER,r.repeatedLastParam=0,r.paramsDesc=[{type:it.VAR_TYPE.STRING},{type:it.VAR_TYPE.STRING},{type:it.VAR_TYPE.NUMBER,default:(e={},(0,l.Z)(e,it.DefaultParam.IfInputNull,new it.NumberVar(0)),(0,l.Z)(e,it.DefaultParam.IfNotInput,new it.NumberVar(1)),e)}],r.$$minOperands=2,r.$$maxOperands=3,r.$$lazy=!1,r.$$paramsDesc=[260,260,258],r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[1].getValue();if(0===r.length)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_NON_BLANK]({funcName:this.name,index:2});var n=t[2]?Math.floor(t[2].getValue()):1;if(n<1)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:3,value:n,lowerBound:1});if(n>r.length)return it.tractorErrorVarCreators[it.ErrorCode.SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:this.name,index:3,value:n,lowerBound:1,upperBound:r.length});var a=t[0].getValue();if(0===a.length)return new it.NumberVar(n);r=r.substr(n-1);var o=-1;if(a.length>Tc||-1===a.indexOf("?")&&-1===a.indexOf("*")&&-1===a.indexOf("~"))o=r.toLocaleLowerCase().indexOf(a.toLocaleLowerCase());else{var i=qP(a).replace(/~([^\?\*]|$)/g,(function(e,t){return void 0===t?e:t})),u=XP(i,!0).exec(r);u&&(o=u.index)}return o<0?it.tractorErrorVarCreators[it.ErrorCode.STRING_SEARCH_FAILED]({funcName:this.name,searchFor:a,textToSeatch:t[1].getValue()}):new it.NumberVar(o+n)}}]),t}(it.FuncOpBase),e$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SIGN",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.sign(t[0].getValue());return 0===r&&(r=0),new it.NumberVar(r)}}]),t}(it.FuncOpBase),t$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SIN",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(Math.sin(r))}}]),t}(it.FuncOpBase),r$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SINH",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(Math.sinh(r))}}]),t}(it.FuncOpBase),n$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SLN",e.operands=3,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue();if(0===a)return it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_PARAMETER_BEING_ZERO]({funcName:this.name,argIndex:3});var o=function(e,t,r){return(e-t)/r}(r,n,a);return new it.NumberVar(o)}}]),t}(it.FuncOpBase),a$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SMALL",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return yk(e,t[0],t[1],this.name)}}]),t}(it.FuncOpBase),o$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SQRT",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return r<0?it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:1}):new it.NumberVar(Math.sqrt(r))}}]),t}(it.FuncOpBase),i$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SQRTPI",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Zc(e.service,t[0],!0);if(!r)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var n=r.getValue();return n<0?it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:1}):new it.NumberVar(Math.sqrt(Math.PI*n))}}]),t}(it.FuncOpBase),u$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="STDEV",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n];if(Ba(a)){var o=Zc(e.service,a);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);a=o}r.push(a)}var i=ik(!1,e,r,null,this.name);if(za(i)){var u=Math.sqrt(i.getValue());return new it.NumberVar(u)}return i}}]),t}(it.FuncOpBase),s$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="STDEVP",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n];if(Ba(a)){var o=Zc(e.service,a);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);a=o}r.push(a)}var i=ik(!0,e,r,null,this.name);if(za(i)){var u=Math.sqrt(i.getValue());return new it.NumberVar(u)}return i}}]),t}(it.FuncOpBase),l$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SUBSTITUTE",e.operands=3,e.optionOperands=1,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING},{type:it.VAR_TYPE.STRING},{type:it.VAR_TYPE.STRING},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[260,260,260,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3]&&t[3].getValue();if(null!=o&&o<=0)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:4});var i=0;if(!n)return new it.StringVar(r);var u=r.replace(new RegExp(function(e){return e.replace(/([.*+?^=!:${}()|[\]/\\])/g,"\\$1")}(n),"g"),(function(e){return i++,null==o||o===i?a:e}));return new it.StringVar(u)}}]),t}(it.FuncOpBase);var c$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SUM",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e.$$calcCustomData=XF,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0,n=0;n<t.length;++n){var a=t[n];if(Ba(a)){var o=Zc(e.service,a);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r+=o.getValue()}else{var i=a.forEach((function(e){if(za(e))r+=e.getValue();else if(ja(e))return e}));if(i)return i}}return new it.NumberVar(r)}}]),t}(it.FuncOpBase),h$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TAN",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(Math.tan(r))}}]),t}(it.FuncOpBase),f$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TANH",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(Math.tanh(r))}}]),t}(it.FuncOpBase),d$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TRIM",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.StringVar(function(e){return e.replace(/^[\s\uFEFF\u00a0]+|[\s\uFEFF\u00a0]+$/g,"").replace(/[\uFEFF\u00a0\t ]{2,}/g," ").replace(/\n/g," ")}(r))}}]),t}(it.FuncOpBase);var v$,p$,m$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TRIMMEAN",e.operands=2,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];Ba(r)&&(r=Zc(e.service,r)||Rl(this.name,1,El(r),wl(r),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));var n=t[1].getValue(),a=[],o=r.forEach((function(e){if(za(e))a.push(e.getValue());else if(ja(e))return e}));if(o)return o;if(n<0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:this.name,index:2});if(n>=1)return it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_SHOULD_BE_LESS_THAN]({funcName:this.name,index:2,value:n,upperBound:1});var i=Math.floor(a.length*n/2);a.sort((function(e,t){return e-t})),a=a.slice(i,a.length-i);for(var u=0,s=0;s<a.length;s++)u+=a[s];return 0===a.length?it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_FUNCTION_EVAL]({funcName:this.name}):new it.NumberVar(u/a.length)}}]),t}(it.FuncOpBase),g$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TRUNC",e.operands=1,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER},{type:it.VAR_TYPE.NUMBER,default:new it.NumberVar(0)}],e.$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,r){return(0,f.Z)((0,v.Z)(t.prototype),"func",this).call(this,e,[r[0],r[1]||new it.NumberVar(0)])}}]),t}(DP),y$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="UPPER",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.STRING,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.STRING}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.StringVar(t[0].getValue().toUpperCase())}}]),t}(it.FuncOpBase),_$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="VALUE",e.operands=1,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL}],e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(Ga(t[0]))return it.tractorErrorVarCreators[it.ErrorCode.CANNOT_PARSE_TEXT_TO_NUMBER]({funcName:this.name,arg:El(t[0])});var r=Zc(e.service,t[0]);return r?new it.NumberVar(r.getValue()):Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE)}}]),t}(it.FuncOpBase),R$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="VAR",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;++r){var n=t[r];Ba(n)&&(t[r]=Zc(e.service,n)||Rl(this.name,r+1,El(n),wl(n),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE))}return ik(!1,e,t,null,this.name)}}]),t}(it.FuncOpBase),C$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="VARP",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;++r){var n=t[r];Ba(n)&&(t[r]=Zc(e.service,n)||Rl(this.name,r+1,El(n),wl(n),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE))}return ik(!0,e,t,null,this.name)}}]),t}(it.FuncOpBase);function w$(e){var t=Math.floor(e-25569),r=new Date(86400*t*1e3);return"".concat(r.getMonth()+1,"/").concat(r.getDate(),"/").concat(r.getFullYear())}function E$(e,t){if(e<0||t<0){var r=e<0?1:2;return{isValid:!1,err:it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:"",index:r})}}return e>=t?{isValid:!1,err:Ce.d$b[Ce.O6N.NUM_SETTLEMENT_DATE_NOT_BEFORE_MATURITY_DATE]({funcName:"",settlementDate:w$(e),maturityDate:w$(t)})}:{isValid:!0}}!function(e){e[e.ANNUAL=1]="ANNUAL",e[e.SEMIANNUAL=2]="SEMIANNUAL",e[e.MONTHLY=4]="MONTHLY"}(v$||(v$={})),function(e){e[e.UsPsa30_360=0]="UsPsa30_360",e[e.ActualActual=1]="ActualActual",e[e.Actual360=2]="Actual360",e[e.Actual365=3]="Actual365",e[e.Europe30_360=4]="Europe30_360"}(p$||(p$={}));var k$=function(e,t){return 12*(t.year-e.year)+(t.month-e.month)},T$=function(e,t){var r=e.getUTCDate(),n=new Date(r);return n.setUTCDate(1),n.setUTCMonth(r.getMonth()+t+1),n.setUTCDate(0),n.setUTCDate(Math.min(n.getUTCDate(),r.getUTCDate())),we.SheetDate.fromUTCDate(n)},S$=function(e,t,r){for(var n=12/r,a=k$(e,t),o=Math.floor(a/n),i=T$(t,-o*n);0<o&&i.toNumber()<=e.toNumber();)i=T$(t,-(o-=1)*n);return i};function A$(e,t,r){for(var n=12/r|0,a=k$(e,t),o=Math.floor(a/n),i=T$(t,-o*n);i.toNumber()>e.toNumber();)i=T$(t,-(o+=1)*n);return i}var I$=function(e,t,r){return b$(e.toNumber(),t.toNumber(),r).duration};function O$(e,t,r,n){if(n===p$.ActualActual){var a=A$(e,t,r),o=S$(e,t,r);return I$(a,o,n)}return(n===p$.Actual365?365:360)/r}var V$=function(e,t,r){var n=A$(e,t,r),a=k$(n,t),o=12/r;return Math.floor(a/o)},N$=function e(t,r){(0,y.Z)(this,e),this.duration=t,this.total=r,this.value=t/r};function b$(e,t,r){var n=we.SheetDate.fromNumber(e),a=we.SheetDate.fromNumber(t),o=(0,we.daysBetween)(n,a),i=n.date,u=a.date,s=n.month,l=a.month,c=n.year,h=a.year;switch(r){case p$.UsPsa30_360:return F$(n)&&F$(a)?(u=30,i=30):(31===i||F$(n))&&(i=30,31===u&&(u=30)),new N$(360*(h-c)+30*(l-s)+(u-i),360);case p$.ActualActual:var f=365;if((c===h||c+1===h)&&(s>l||s===l&&i>=u))return(c===h&&(0,we.isLeapYear)(c)||function(e,t){var r=we.SheetDate.fromNumber(e),n=we.SheetDate.fromNumber(t),a=r.year,o=we.SheetDate.from({year:a,month:3,date:1});if((0,we.isLeapYear)(a)&&e<o.toNumber()&&t>=o.toNumber())return!0;var i=n.year,u=we.SheetDate.from({year:i,month:3,date:1});return(0,we.isLeapYear)(i)&&t>=u.toNumber()&&e<u.toNumber()}(e,t)||1===l&&29===u)&&(f=366),new N$(o,f);var d=h-c+1,v=(new Date(h+1,0,1).getTime()-new Date(c,0,1).getTime())/1e3/60/60/24;return new N$(o,v/d);case p$.Actual360:return new N$(o,360);case p$.Actual365:return new N$(o,365);case p$.Europe30_360:return 31===u&&(u=30),31===i&&(i=30),new N$(u+30*l+360*h-(i+30*s+360*c),360);default:return null}}function M$(e){return(e+6)%7}function F$(e){if(2===e.month)if((0,we.isLeapYear)(e.year)){if(29===e.date)return!0}else if(28===e.date)return!0;return!1}var Z$=[];Z$[0]=!0,Z$[6]=!0;var x$,D$,P$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="XIRR",e.operands=2,e.optionOperands=1,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.COLLECTION,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.COLLECTION,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:new it.NumberVar(.1)}],e.$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[33,33,399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=this,n=.1;if(t[2]&&!qa(t[2])){var a=Zc(e.service,t[2],!0);if(!a)return Rl(this.name,3,El(t[2]),wl(t[2]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);n=a.getValue()}var o=[],i=[],u=!1,s=!1,l=t[0].forEach((function(t){if(ja(t))return t;if(qa(t))o.push(0);else{var n=Zc(e.service,t,!0);if(!n)return Rl(r.name,1,El(t),wl(t),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var a=n.getValue();a>0&&(u=!0),a<0&&(s=!0),o.push(a)}}));if(l)return l;if(l=t[1].forEach((function(t){if(ja(t))return t;if(!qa(t)){var n=Zc(e.service,t,!0);if(!n)return Rl(r.name,1,El(t),wl(t),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var a=n.getValue();return a<we.SheetDate.MIN_DATE_VALUE||a>we.SheetDate.MAX_DATE_VALUE?it.tractorErrorVarCreators[it.ErrorCode.CONDITIONAL_OPTION_DATE_IS_BETWEEN_INSTRUCTION]({minDate:w$(we.SheetDate.MIN_DATE_VALUE),maxDate:w$(we.SheetDate.MAX_DATE_VALUE)}):i.length>0&&i[0]>a?it.tractorErrorVarCreators[it.ErrorCode.CONDITIONAL_OPTION_DATE_IS_ON_OR_AFTER_INSTRUCTION]({date:w$(a)}):void i.push(Math.floor(a))}i.push(0)})),l)return l;if(!u||!s)return it.tractorErrorVarCreators[it.ErrorCode.REQUIRES_POSITIVE_AND_NEGATIVE_VALUES]({funcName:this.name});if(o.length!==i.length)return it.tractorErrorVarCreators[it.ErrorCode.ARRAY_SIZES_NOT_EQUAL]({funcName:this.name});var c=Rx((function(e){return gx(e,o,i)}),n);return null===c?it.tractorErrorVarCreators[it.ErrorCode.INTERNAL_RATE_OF_RETURN_BAD_GUESS]({funcName:this.name}):new it.NumberVar(c)}}]),t}(it.FuncOpBase),$$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="XNPV",e.operands=3,e.optionOperands=0,e.resultType=it.VAR_TYPE.NUMBER,e.repeatedLastParam=0,e.paramsDesc=[{type:it.VAR_TYPE.NUMBER|it.VAR_TYPE.BOOL,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.COLLECTION,default:it.NA_ERR_VAR},{type:it.VAR_TYPE.COLLECTION,default:it.NA_ERR_VAR}],e.$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[399,32,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=this,n=Zc(e.service,t[0],!0);if(!n)return Rl(this.name,1,El(t[0]),wl(t[0]),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var a=[],o=t[1].forEach((function(e){if(!za(e))return ja(e)?e:it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_WRONG_DATA_TYPE]({funcName:r.name,index:2,value:El(e),argType:wl(e),requiredArgType:it.FormulaErrorPhrases.DATA_TYPE_DOUBLE});a.push(e.getValue())}));if(o)return o;var i=[];if(o=t[2].forEach((function(e){if(!za(e))return ja(e)?e:it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_WRONG_DATA_TYPE]({funcName:r.name,index:3,value:El(e),argType:wl(e),requiredArgType:it.FormulaErrorPhrases.DATA_TYPE_DOUBLE});var t=e.getValue();if(i.length>0&&i[0]>t)return it.tractorErrorVarCreators[it.ErrorCode.DATES_CANNOT_PRECEDE_FIRST_DATE]({funcName:r.name,firstDate:w$(i[0]),curDate:w$(t)});i.push(Math.floor(t))})),o)return o;if(a.length!==i.length)return it.tractorErrorVarCreators[it.ErrorCode.ARRAY_SIZES_NOT_EQUAL]({funcName:this.name});var u=n.getValue();if(-1===u)return Ys;var s=gx(u,a,i);return new it.NumberVar(s)}}]),t}(it.FuncOpBase),L$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="XOR",e.operands=1,e.optionOperands=255,e.resultType=it.VAR_TYPE.BOOL,e.repeatedLastParam=1,e.paramsDesc=[{type:it.VAR_TYPE.BOOL|it.VAR_TYPE.NULL|it.VAR_TYPE.COLLECTION},{type:it.VAR_TYPE.BOOL|it.VAR_TYPE.NULL|it.VAR_TYPE.COLLECTION}],e.$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=this,n=!1,a=!1,o=function(e){var o=t[e];Ba(o)&&(o=Dc(o)||Rl(r.name,e+1,El(o),wl(o),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN));var i=o.forEach((function(t){if(ja(t))return t;if(10&t.$$type){var o=Ga(t)?t.getValue():t.toBooleanVar().getValue();if(null===o)return Rl(r.name,e+1,El(t),wl(t),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN);a=!0,n=n?!o:o}}));if(i)return{v:i}},i=0;i<t.length;++i){var u=o(i);if("object"===(0,R.Z)(u))return u.v}return a?new it.BooleanVar(n):Gl(this.name)}}]),t}(it.FuncOpBase),B$=(pw("PRIVATE_CELLIS",3,1,0,Zd,[YE.SHEET_REF,{type:Vd},{type:Nd},{type:Nd|Od,default:it.NULL_VAR}]),pw("PRIVATE_CONTAINTEXT",3,0,1,Zd,[YE.SHEET_REF,{type:Vd},{type:Nd},{type:Nd}]),function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=0,e.$$maxOperands=0,e.$$lazy=!1,e.$$cacheType=0,e.$$paramsDesc=[],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e){var t=Ps(e.workbook,e.ref);return t?new Ss(e.ref,new U$(Oc(t.getVar(e.ref.startRow,e.ref.startCol))||it.NULL_VAR)):Vl("",-1,"")}}]),t}(pw("PRIVATE_GET_REF",0,0,0,Zd,[]))),U$=function(){function e(t){(0,y.Z)(this,e),this.value=t}return(0,_.Z)(e,[{key:"get",value:function(e,t){return this.value}},{key:"set",value:function(e,t,r){}}]),e}(),H$=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"numberAsStringEq",value:function(e,t){return"number"==typeof e||"number"==typeof t?String(e)===String(t):e===t}},{key:"func",value:function(e,t){if(qa(t[0]))return fy(!0,{visible:!0,checked:!1});var r=t[0].getValue();return this.numberAsStringEq(r,t[1]&&!qa(t[1])?t[1].getValue():0)?fy(!0,{visible:!0,checked:!0}):this.numberAsStringEq(r,t[2]&&!qa(t[2])?t[2].getValue():0)?fy(!0,{visible:!0,checked:!1}):fy(!1,{visible:!1})}}]),t}(pw("PRIVATE_CHECKBOX",3,0,0,bd,[{type:Nd|bd|Od|Vd},{type:Nd|bd|Vd},{type:Nd|bd|Vd}]));function z$(e){if(e.isNull())return"null";var t=e.getValue();return e.isNumber()?t=(0,Ee.toPrecision)(e.getValue()):e.isString()&&(t=e.getValue().toUpperCase()),t}!function(e){e[e.Exact=0]="Exact",e[e.Smaller=-1]="Smaller",e[e.Larger=1]="Larger",e[e.Wildcard=2]="Wildcard"}(x$||(x$={})),function(e){e[e.Sequence=1]="Sequence",e[e.Reverse=-1]="Reverse",e[e.BinaryAscending=2]="BinaryAscending",e[e.BinaryDescending=-2]="BinaryDescending"}(D$||(D$={}));var W$=function(){function e(t,r,n,a,o,i,u){if((0,y.Z)(this,e),this.value=a,this.ref=o,this._hash=null,this.isHorizontal=t,this.sequence=r>0,this.name=n,this.matchMode=i,this.isUp=!this.sequence,u&&(this.isUp=!this.isUp),r!==D$.BinaryAscending&&r!==D$.BinaryDescending)if(i===x$.Wildcard&&a.isString()&&a.getValue().length<=Tc&&YP.test(a.getValue())){var s=XP(a.getValue());this.eq=function(e){return!!e.isString()&&s.test(e.getValue())},this._hash=null}else{this.eq=function(e){return a.equals(e)};var l=ro(this.ref)?this.ref.getRef():null;if(l&&i!==x$.Smaller&&i!==x$.Larger){var c=l.startRow,h=l.endRow,f=l.startCol,d=l.endCol;this.isHorizontal?(h=c+1,this.sequence?d=-1:f=-1):(d=f+1,this.sequence?h=-1:c=-1),this._hash=ei(c,h,f,d,l.hostId,l.hostName)}else i!==x$.Smaller&&i!==x$.Larger&&Ja(this.ref)&&(this._hash=this.ref.hash())}}return(0,_.Z)(e,[{key:"getSearchValue",value:function(){return this.value}},{key:"getResult",value:function(e,t){return new it.NumberVar(t+1)}},{key:"hash",value:function(){return this._hash}},{key:"compare",value:function(e,t){void 0===t&&(t=this.sequence);var r=$D(e,this.value);return t?r:-1*r}},{key:"isSameType",value:function(e){return e.type===this.value.type}},{key:"end",value:function(){return this.isHorizontal?this.ref.colCount():this.ref.rowCount()}},{key:"na",value:function(){return $l(this.name,El(this.value))}}]),e}(),G$=function(e){function t(e,r,n,a,o,i,u){var s;return(0,y.Z)(this,t),(s=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r,n,a,o,u))).offset=i,s}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getResult",value:function(e,t){var r=this.isHorizontal?this.offset:t,n=this.isHorizontal?t:this.offset;if(ro(this.ref)){var a=this.ref.getRef();return new Fs(new Qi(r+a.startRow,r+a.startRow+1,n+a.startCol,n+a.startCol+1,a.hostId,a.hostName))}return this.ref.at(r,n)}}]),t}(W$);function j$(e,t,r){var n,a=r.sequence?0:r.end()-1,o=r.hash();if(o){var i=e.funcCache.search.get(o);i?a=i.get(r.getSearchValue()):(i=new Y$(r.sequence,a),e.funcCache.search.set(o,i)),n=i}else n=new q$;if(a>=r.end())return r.na();var u=K$(e,t,r.isHorizontal?0:a,r.isHorizontal?a:0);return to(u)?new ks([u.getRef()],[],{next:function(o){var i=o[0].at(0,0);return J$(e,t,r,a,n,i)}}):!e.skipRuntimeError&&ja(u)&&u.isRuntimeError()?u:J$(e,t,r,a,n,u)}var Y$=function(){function e(t,r){(0,y.Z)(this,e),this.rangeCache={},this.sign=t?1:-1,this.curr=r}return(0,_.Z)(e,[{key:"set",value:function(e,t){var r,n=e.type,a=this.rangeCache;n in a?r=a[n]:(r=new Map,a[n]=r);var o=z$(e);r.has(o)||r.set(o,t),this.curr=1===this.sign?Math.max(t+1,this.curr):Math.min(t-1,this.curr)}},{key:"get",value:function(e){var t,r=e.type,n=this.rangeCache[r];if(n){var a=z$(e);t=n.get(a)}return void 0!==t?t:this.curr}}]),e}(),q$=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"set",value:function(e,t){}},{key:"get",value:function(e){return 0}}]),e}();function J$(e,t,r,n,a,o){for(var i=r.end(),u=r.sequence?1:-1,s=null,l=null,c=r.matchMode,h=c===x$.Larger||c===x$.Smaller;n<i&&n>=0;){if(a.set(o,n),r.eq(o))return r.getResult(e,n);if(h&&r.isSameType(o)&&oL(o,s,r)&&(s=o,l=n),(n+=u)<i){var f=K$(e,t,r.isHorizontal?0:n,r.isHorizontal?n:0);if(to(f))return new ks([f.getRef()],[],{next:function(o){var i=o[0].at(0,0);return J$(e,t,r,n,a,i)}});if(!e.skipRuntimeError&&ja(o)&&o.isRuntimeError())return o;o=f}}return h&&null!==l?r.getResult(e,l):r.na()}function K$(e,t,r,n){if(to(t)){var a=t.getRef(),o=Oc(Ps(e.workbook,a).getVar(r+a.startRow,n+a.startCol));return void 0===o?new Fs(new Qi(r+a.startRow,r+a.startRow+1,n+a.startCol,n+a.startCol+1,a.hostId,a.hostName)):o}return t.at(r,n)}var X$=function e(t,r,n){(0,y.Z)(this,e),this.start=t,this.end=r,this.mid=n};function Q$(e,t,r){var n=function(e,t,r,n){var a=n;if(Ba(t))return a;if(r.getSearchValue().isNull())return a;var o,i=null==t?void 0:t.hash();if(i){(o=e.funcCache.index[r.isHorizontal?"h":"v"])||(o=new Ce.z6B(5),e.funcCache.index[r.isHorizontal?"h":"v"]=o);var u=o.get(i);if(void 0!==u)return u}if(to(t)){var s=t.getRef(),l=Ps(e.workbook,s);for(a=Math.min(n,r.isHorizontal?n:l._dataModel.getRowLength(s.startCol));a>0;a--){var c=r.isHorizontal?0:a-1,h=r.isHorizontal?a-1:0;if(!l.getVar(c+s.startRow,h+s.startCol).isNull())break}}else for(;a>0;a--){var f=r.isHorizontal?0:a-1,d=r.isHorizontal?a-1:0;if(!t.at(f,d).isNull())break}return i&&o.set(i,a),a}(e,t,r,r.end()),a=new X$(0,n,(n-1)/2|0),o=K$(e,t,r.isHorizontal?0:a.mid,r.isHorizontal?a.mid:0);return to(o)?new ks([o.getRef()],[],{next:function(n){var o=n[0].at(0,0);return eL(e,t,o,a,r)}}):!e.skipRuntimeError&&ja(o)&&o.isRuntimeError()?o:eL(e,t,o,a,r)}function eL(e,t,r,n,a,o){var i=n.start,u=n.end,s=n.mid,l=s;for(void 0===o&&(o=-1);i<u-1;){if(l>=0&&!a.isSameType(r))l=rL(e,t,l+1,u,a);else{if(l>=0){var c=a.compare(r);if(0===c){if(o=l,a.isUp)break;i=s}else c<0?i=s:u=s}else u=s;l=s=(i+u)/2|0}if(!(l<0)){var h=K$(e,t,a.isHorizontal?0:l,a.isHorizontal?l:0);if(to(h))return new ks([h.getRef()],[],{next:function(r){var n=r[0].at(0,0);return eL(e,t,n,new X$(i,u,s),a,o)}});if(!e.skipRuntimeError&&ja(h)&&h.isRuntimeError())return h;r=h}}if(!a.isSameType(r))return a.na();var f=a.compare(r);if(o>=0||0===f)return a.isUp?tL(e,t,r,new X$(0,l+1,l),a):o===l?a.getResult(e,l):aL(e,t,o>=0?o:l,u,a);var d=a.sequence&&a.matchMode===x$.Larger,v=!a.sequence&&a.matchMode===x$.Smaller;if(f<0&&(d||v)){if(u>=a.end())return a.na();if(r=K$(e,t,a.isHorizontal?0:u,a.isHorizontal?u:0),!a.isSameType(r)){if((u=rL(e,t,u,a.end(),a))<0)return a.na();r=K$(e,t,a.isHorizontal?0:u,a.isHorizontal?u:0)}return a.compare(r)>0?a.getResult(e,u):a.na()}return f<0&&(a.matchMode===x$.Smaller||a.matchMode===x$.Larger)||f>0&&(d||v)?a.getResult(e,i):a.na()}function tL(e,t,r,n,a){for(var o=n.start,i=n.end,u=n.mid,s=u;o<i-1;){0===a.compare(r)?(s=Math.min(u,s),i=u+1):o=u+1,u=o+(i-o-1)/2|0;var l=K$(e,t,a.isHorizontal?0:u,a.isHorizontal?u:0);if(to(l))return new ks([l.getRef()],[],{next:function(r){var n=r[0].at(0,0);return tL(e,t,n,new X$(o,i,u),a)}});r=l}return nL(e,t,s,a)}function rL(e,t,r,n,a){for(;r<n;r++){var o=K$(e,t,a.isHorizontal?0:r,a.isHorizontal?r:0);if(to(o)||a.isSameType(o))return r}return-1}function nL(e,t,r,n){for(r--;r>=0;r--){var a=K$(e,t,n.isHorizontal?0:r,n.isHorizontal?r:0);if(to(a))return new ks([a.getRef()],[],{next:function(){return nL(e,t,r+1,n)}});if(0!==n.compare(a))return n.getResult(e,r+1)}return n.getResult(e,r+1)}function aL(e,t,r,n,a){for(r++;r<n;r++){var o=K$(e,t,a.isHorizontal?0:r,a.isHorizontal?r:0);if(to(o))return new ks([o.getRef()],[],{next:function(){return aL(e,t,r-1,n,a)}});if(0!==a.compare(o))return a.getResult(e,r-1)}return a.getResult(e,r-1)}function oL(e,t,r){var n=r.compare(e,!0),a=n<0&&r.matchMode===x$.Smaller,o=n>0&&r.matchMode===x$.Larger;return t?(n=$D(e,t),a&&n>0||o&&n<0):a||o}var iL=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[399,111,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(!Ba(t[0]))return Rl(this.name,1,El(t[0]),wl(t[0]),"".concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_STRING,",").concat(it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN));var r=qa(t[0])?new it.NumberVar(0):t[0],n=t[1];if(to(n))n=$s(e.workbook,n);else if(Qa(n))return Nl(this.name,2,"");if(n.rowCount()>1&&n.colCount()>1)return Kl(this.name);var a=t[2]?za(t[2])?t[2].getValue():0:1,o=new W$(n.colCount()>1,0===a?D$.Sequence:a>0?D$.BinaryAscending:D$.BinaryDescending,this.name,r,n,0===a?x$.Wildcard:a>0?x$.Smaller:x$.Larger);return 0===a?j$(e,n,o):Q$(e,n,o)}}]),t}(pw("MATCH",2,1,0,Ud,[{type:Vd|Nd|bd},{type:Zd},{type:Vd,default:(je={},(0,l.Z)(je,it.DefaultParam.IfInputNull,new it.NumberVar(0)),(0,l.Z)(je,it.DefaultParam.IfNotInput,new it.NumberVar(1)),je)}]));function uL(e,t,r){var n,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=r.getValue();if(Wa(r)&&a){var i=XP(o.toLowerCase());n=function(e){return i.test(e.toLowerCase())}}else n=function(e){return e===o};var u=-1;return t.forEach((function(e){if(u++,e.$$type===r.$$type&&n(e.getValue()))return!0}))?u:-1}function sL(e,t){var r=new it.BooleanVar(e);return r.setSpecialInfo({listValidationFuncInfo:t}),r}var lL=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[32,32,264,265],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0],a=t[1],o=t[2],i=!t[3]||!Ga(t[3])||t[3].getValue(),u=[];if(Xa(n)){if(Qa(n)||1!==n.size())return it.VALUE_ERR_VAR;var s=n.getRef(),l=e.workbook.getSheetFromId(s.hostId);if(!l)return it.REF_ERR_VAR;var c=s.startRow,h=s.startCol,f=o.getValue();u=l.getTextWithValues(c,h,f)}else{if(1!==n.rowCount())return it.VALUE_ERR_VAR;if(!o.getValue()&&1!==n.size())return it.VALUE_ERR_VAR;for(var d=0,v=n.colCount();d<v;++d){var p=n.at(0,d);if(!p.isString())return it.VALUE_ERR_VAR;u.push({segmentArray:null,variant:p,text:p.getValue()})}}if(0===u.length)return sL(!0);if(Xa(a)){if(Qa(a))return it.VALUE_ERR_VAR;var m=a.getRef(),g=e.workbook.getSheetFromId(m.hostId);if(!g)return it.REF_ERR_VAR;for(var y=m.startRow,_=m.startCol,R=m.endRow,C=m.endCol,w=[],E=y;E<R;++E)for(var k=_;k<C;++k)w.push(g.getText(E,k,void 0,!1));r=new gs([w.map((function(e){return new it.StringVar(e)}))])}else{if(1!==a.rowCount())return it.VALUE_ERR_VAR;r=a}var T,S=[],A=!0,I=yr(u);try{for(I.s();!(T=I.n()).done;){var O=T.value,V=O.text,N=O.variant,b=O.segmentArray,M=uL(e,r,new it.StringVar(V),!(!N||!Ga(N))||i);M<0&&(A=!1),S.push({segmentArray:b,variant:N,text:V,index:M})}}catch(e){I.e(e)}finally{I.f()}return sL(A,S)}}]),t}(pw("PRIVATE_LIST_VALIDATION",4,0,0,bd|Md,[{type:Zd},{type:Zd},{type:bd},{type:bd,default:new it.BooleanVar(!0)}])),cL={null:function(e){return null==e},general:function(e){return!!e&&(0,Ee.isGeneralFormatter)(e)},text:function(e){return!!e&&(0,Ee.isTextFormatter)(e)},digital:function(e){return!!e&&(0,Ee.isDigitalFormatter)(e)},dateTime:function(e){return!!e&&(0,Ee.isDateTimeFormatter)(e)}},hL=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$cacheType=0,e.$$paramsDesc=[260,260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();return n?this.checkFormatterByCode(e,e.ref,r,n):this.checkFormatterByRef(e,e.ref,r)}},{key:"checkFormatterByCode",value:function(e,t,r,n){var a=Ps(e.workbook,t),o=a&&(0,Ee.createFormatter)(a.formatterService,n),i=cL[r],u=i&&i(o);return new it.BooleanVar(!!u)}},{key:"checkFormatterByRef",value:function(e,t,r){var n=this.getCellFormatterByRange(e,t),a=cL[r],o=a&&a(n);return new it.BooleanVar(!!o)}},{key:"getCellFormatterByRange",value:function(e,t){var r=Ps(e.workbook,t);return r?r.getActualFormatter(t.startRow,t.startCol):null}}]),t}(pw("PRIVATE_FORMATTER_VALIDATION",2,0,0,bd,[{type:Nd},{type:Nd}])),fL=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(za(t[0])&&Number.isInteger(t[0].getValue()))}}]),t}(pw("PRIVATE_IS_INT",1,0,0,bd,[{type:Bd}])),dL=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[49],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=t[0].rowCount(),a=0;a<n;a++)r.push([]);for(var o=1,i=0;i<t.length;++i){var u=t[i],s=u.rowCount(),l=s!==n,c=Qa(u);if(l||c){l?r[0]=[Ce.d$b[Ce.O6N.REF_ARRAY_ROW_ROW_NO_MATCH]({count:o,correctRowCount:n,actualRowCount:s})]:c&&(r[0]=[Vl("PRIVATE_ARRAY_ROW",o,"")]);for(var h=1;h<n;h++)r.pop();break}for(var f=u.colCount(),d=0;d<s;d++)for(var v=0;v<f;v++)r[d].push(u.at(d,v));o++}return new gs(r)}}]),t}(pw("PRIVATE_ARRAY_ROW",1,1/0,1,Zd,[{type:Bd|Zd}]));dL=Vu([Cp("PRIVATE_ARRAY_ROW")],dL);var vL=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[48],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=t[0].colCount(),a=0;a<t.length;++a){var o=t[a];if(n!==o.colCount())return Ce.d$b[Ce.O6N.REF_ARRAY_LITERAL_COL_NO_MATCH]({funcName:this.name});if(kd(o))(0,Ce.hTd)(r,o.getCollectionValue());else for(var i=0,u=o.rowCount();i<u;++i){for(var s=[],l=0;l<n;++l)s.push(o.at(i,l));r.push(s)}}return new gs(r)}}]),t}(pw("PRIVATE_ARRAY_LITERAL",1,1/0,1,Zd,[{type:Zd}]));function pL(e){return e.date===(0,we.getDaysOfMonth)(e.year,e.month)}function mL(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e,a=r*t,o=n.month,i=n.year,u=n.date;o-=a,i+=Math.floor((o-1)/12),o=((o-1)%12+12)%12+1;var s=(0,we.getDaysOfMonth)(i,o);return u=pL(e)?s:Math.min(s,u),we.SheetDate.from({year:i,month:o,date:u})}function gL(e,t,r){var n=function(e){return 12/e}(r),a=t.month-e.month+12*(t.year-e.year),o=0===a?1:Math.floor((a-1)/n)+1,i=mL(t,n,o-1),u=mL(t,n,1,i);return u.toNumber()>e.toNumber()&&(o++,u=mL(t,n,1,i=u)),{start:u,end:i,count:o}}vL=Vu([Cp("PRIVATE_ARRAY_LITERAL")],vL);var yL=[v$.ANNUAL,v$.SEMIANNUAL,v$.MONTHLY],_L=yL.join(", ");function RL(e){return yL.includes(e)}function CL(e){return e in p$}var wL=function(e,t,r){return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_VALUE_NOT_IN_LIST]({funcName:e,index:r,value:String(t),validValues:_L})},EL=function(e,t,r){return it.tractorErrorVarCreators[it.ErrorCode.NUM_SHOULD_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:e,index:r,value:t,lowerBound:p$.UsPsa30_360,upperBound:p$.Europe30_360})};function kL(e,t,r,n,a){var o=E$(e,t);if(!o.isValid)return{err:o.err};if(null===r)return{err:it.NA_ERR_VAR};if(!RL(r))return{err:wL("",r,a||3)};if(null==n)n=0;else if(!CL(n))return{err:EL("",n,a?a+1:4)};return{basis:n,frequency:r,maturity:we.SheetDate.fromNumber(t),settlement:we.SheetDate.fromNumber(e)}}function TL(e,t,r,n){var a=kL(e.getValue(),t.getValue(),r.getValue(),n?n.getValue():0);return a.err?a:gL(a.settlement,a.maturity,a.frequency)}function SL(e,t,r,n,a){var o,i,u,s;if(null!==(o=e.info)&&void 0!==o&&null!==(i=o.args)&&void 0!==i&&i.hasOwnProperty("funcName")&&(e.info.args.funcName=t),null!==(u=e.info)&&void 0!==u&&null!==(s=u.args)&&void 0!==s&&s.hasOwnProperty("settlementDate")&&e.info.args.hasOwnProperty("maturityDate")){var l=Ps(a.workbook,a.ref);if(!l)return it.VALUE_ERR_VAR;var c=(0,Ce.L0c)(l.formatterService,r.getValue()),h=(0,Ce.L0c)(l.formatterService,n.getValue());e.info.args.settlementDate=c,e.info.args.maturityDate=h}return e}function AL(e,t,r,n,a,o){for(var i=gL(we.SheetDate.fromNumber(e),we.SheetDate.fromNumber(t),a),u=b$(e,i.end.toNumber(),o),s=u.duration/(u.total/a),l=i.count,c=r/a*100,h=(l-1|0)+s,f=1+n/a,d=100/Math.pow(f,h),v=0,p=0,m=0;m<l;m++){var g=m+s,y=c/Math.pow(f,g);v+=y,p+=y*g}return(p+d*h)/(d+v)/a}function IL(e){var t=e.basis,r=e.frequency;if(0===t||2===t||4===t)return 12/r*30;if(3===t)return 12/r*(365/12);var n=gL(e.settlement,e.maturity,r),a=n.start,o=n.end;return o.date>a.date&&a.toNumber()>0&&o.setDateTime({date:a.date}),b$(a.toNumber(),o.toNumber(),t).duration}var OL=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=6,e.$$maxOperands=8,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,258,259,258,259,265],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue()),a=Math.floor(t[2].getValue()),o=t[3].getValue(),i=za(t[4])?t[4].getValue():1e3,u=Math.floor(t[5].getValue()),s=t[6]&&za(t[6])?Math.floor(t[6].getValue()):p$.UsPsa30_360;if(null===(!t[7]||!Ga(t[7])||t[7].getValue()))return al(this.name,"",8,"TRUE, FALSE");var l=[{val:r,index:1},{val:n,index:2},{val:a,index:3}].find((function(e){return e.val<0}));if(l)return Qs(this.name,l.val,l.index,0);if(r>=a){var c=Ps(e.workbook,e.ref);return c?rl(this.name,c,r,1,a,3):it.VALUE_ERR_VAR}var h,f=[{val:o,index:5},{val:i,index:6}].find((function(e){return e.val<=0}));if(f)return Js(this.name,f.val,f.index,0);if(!RL(u))return wL(this.name,u,6);if(!CL(s))return EL(this.name,s,7);var d=we.SheetDate.fromNumber(r),v=we.SheetDate.fromNumber(n),p=we.SheetDate.fromNumber(a);if(a<n){var m=S$(d,v,u),g=A$(p,v,u);if(g<m)h=I$(d,p,s)/O$(d,v,u,s);else{var y=I$(d,m,s)/O$(d,v,u,s),_=I$(g,p,s)/O$(p,v,u,s);h=y+(V$(d,v,u)-V$(p,v,u)-1)+_}}else h=function(e,t,r,n){var a=S$(e,t,r);return-I$(a,e,n)}(d,p,u,s)/O$(d,p,u,s)+Math.floor(V$(d,p,u))-1;return new it.NumberVar(i*(o/u)*h)}}]),t}(pw("ACCRINT",6,2,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(1e3)},{type:Vd},{type:Vd,default:new it.NumberVar(p$.UsPsa30_360)},{type:bd|Vd|Nd,default:new it.BooleanVar(!0)}])),VL=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue()),a=t[2].getValue(),o=t[3]&&za(t[3])?t[3].getValue():1e3,i=t[4]&&za(t[4])?Math.floor(t[4].getValue()):0;if(r<=0||n<=0){var u=n,s=2;return r<=0&&(u=r,s=1),Js(this.name,u,s,0)}if(r>=n){var l=Ps(e.workbook,e.ref);return l?rl(this.name,l,r,1,n,2):it.VALUE_ERR_VAR}if(a<=0||o<=0)return it.NUM_ERR_VAR;var c=b$(r,n,i);return null===c?Gs(this.name,5,i,0,4):new it.NumberVar(o*a*c.value)}}]),t}(pw("ACCRINTM",4,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(1e3)},{type:Vd,default:new it.NumberVar(0)}])),NL=new Map([["I",1],["V",5],["X",10],["L",50],["C",100],["D",500],["M",1e3]]),bL=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue().toUpperCase(),n=0,a="-"===r[0];a&&(r=r.substr(1));for(var o=0;o<r.length;o++){var i=NL.get(r[o])||0,u=NL.get(r[o+1])||0,s=NL.get(r[o+2])||0,l=NL.get(r[o+3])||0;if(!i||s>=u&&s>i||i===u&&i===s&&i===l||i===u/2)return Ce.d$b[Ce.O6N.INVALID_ROMAN_NUMERAL]({funcName:this.name});i<u?n-=i:n+=i}return a&&(n=-n),new it.NumberVar(n)}}]),t}(pw("ARABIC",1,0,0,Vd,[{type:Nd}])),ML=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[127],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];return Ba(r)||ro(r)?r:wp(e,r)}}]),t}(pw("ARRAYFORMULA",1,0,0,Ud,[{type:Ud}]));ML=Vu([Cp("ARRAYFORMULA")],ML);var FL=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[49,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1].getValue(),a=t[2].getValue();return a<1||n<1?Bl:Ba(r)?r:wp(e,r,n,a)}}]),t}(pw("ARRAY_CONSTRAIN",3,0,0,Ud,[{type:Ud},{type:Vd},{type:Vd}]));FL=Vu([Cp("ARRAY_CONSTRAIN")],FL);var ZL,xL=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=this,n=0,a=0,o=function(o){var i=t[o];if(Ba(i)){var u=Zc(e.service,i);if(!u)return{v:Rl(r.name,o+1,El(i),wl(i),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE)};i=u}var s=Xa(i),l=i.forEach((function(e){switch(e.$$type){case 2:n+=e.getValue();case 4:a++;break;case 8:s&&(n+=e.getValue()?1:0,a++);break;case 16:return e}}));if(l)return{v:l}},i=0;i<t.length;++i){var u=o(i);if("object"===(0,R.Z)(u))return u.v}return 0===a?Hl(this.name):new it.NumberVar(n/a)}}]),t}(pw("AVERAGEA",1,256,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}]));function DL(e,t,r){return Array.from({length:e},(function(){return void 0!==r?Array(t).fill(r):Array(t)}))}function PL(e){for(var t=DL(e.length,e[0].length),r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)t[r][n]=e[r][n];return t}function $L(e){for(var t=DL(e[0].length,e.length),r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)t[n][r]=e[r][n];return t}function LL(e,t){for(var r=e.length,n=t.length,a=t[0].length,o=new Array(r),i=r-1;i>=0;i--){o[i]=new Array(a);for(var u=a-1;u>=0;u--){var s=void 0,l=e[i][n-1]*t[n-1][u];for(s=n-2;s>=1;s-=2)l+=e[i][s]*t[s][u]+e[i][s-1]*t[s-1][u];0===s&&(l+=e[i][0]*t[0][u]),o[i][u]=l}}return o}function BL(e,t){var r=0;return Math.abs(e)>Math.abs(t)?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0!==t?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0}function UL(e){for(var t=function(e){var t,r=Number.EPSILON,n=1e-64/r,a=0,o=0,i=0,u=0,s=0,l=PL(e),c=l.length,h=l[0].length;if(c<h)throw new Error("Need more rows than columns");for(var f=new Array(h),d=new Array(h),v=0;v<h;v++)f[v]=d[v]=0;var p=DL(h,h,0),m=0,g=0,y=0,_=0,R=0,C=0,w=0;for(o=0;o<h;o++){f[o]=g;for(var E=0,k=o+1,T=o;T<c;T++)E+=l[T][o]*l[T][o];if(E<=n)g=0;else for(m=l[o][o],g=Math.sqrt(E),m>=0&&(g=-g),y=m*g-E,l[o][o]=m-g,i=k;i<h;i++){for(E=0,u=o;u<c;u++)E+=l[u][o]*l[u][i];for(m=E/y,u=o;u<c;u++)l[u][i]+=m*l[u][o]}for(d[o]=g,E=0,i=k;i<h;i++)E+=l[o][i]*l[o][i];if(E<=n)g=0;else{for(m=l[o][o+1],g=Math.sqrt(E),m>=0&&(g=-g),y=m*g-E,l[o][o+1]=m-g,i=k;i<h;i++)f[i]=l[o][i]/y;for(i=k;i<c;i++){for(E=0,u=k;u<h;u++)E+=l[i][u]*l[o][u];for(u=k;u<h;u++)l[i][u]+=E*f[u]}}(R=Math.abs(d[o])+Math.abs(f[o]))>_&&(_=R)}for(o=h-1;-1!==o;o--){if(0!==g){for(y=g*l[o][o+1],i=s;i<h;i++)p[i][o]=l[o][i]/y;for(i=s;i<h;i++){for(w=0,u=s;u<h;u++)w+=l[o][u]*p[u][i];for(u=s;u<h;u++)p[u][i]+=w*p[u][o]}}for(i=s;i<h;i++)p[o][i]=0,p[i][o]=0;p[o][o]=1,g=f[o],s=o}for(o=h-1;-1!==o;o--){for(s=o+1,g=d[o],i=s;i<h;i++)l[o][i]=0;if(0!==g){for(y=l[o][o]*g,i=s;i<h;i++){for(w=0,u=s;u<c;u++)w+=l[u][o]*l[u][i];for(m=w/y,u=o;u<c;u++)l[u][i]+=m*l[u][o]}for(i=o;i<c;i++)l[i][o]=l[i][o]/g}else for(i=o;i<c;i++)l[i][o]=0;l[o][o]+=1}for(r*=_,u=h-1;-1!==u;u--)for(var S=0;S<50;S++){var A=!1;for(s=u;-1!==s;s--){if(Math.abs(f[s])<=r){A=!0;break}if(Math.abs(d[s-1])<=r)break}if(!A){a=0,w=1;var I=s-1;for(o=s;o<u+1&&(m=w*f[o],f[o]=a*f[o],!(Math.abs(m)<=r));o++)for(y=BL(m,g=d[o]),d[o]=y,a=g/y,w=-m/y,i=0;i<c;i++)R=l[i][I],C=l[i][o],l[i][I]=R*a+C*w,l[i][o]=-R*w+C*a}if(C=d[u],s===u){if(C<0)for(d[u]=-C,i=0;i<h;i++)p[i][u]=-p[i][u];break}if(S>=49)throw new Error("Error: no convergence.");for(_=d[s],g=BL(m=(((R=d[u-1])-C)*(R+C)+((g=f[u-1])-(y=f[u]))*(g+y))/(2*y*R),1),m=m<0?((_-C)*(_+C)+y*(R/(m-g)-y))/_:((_-C)*(_+C)+y*(R/(m+g)-y))/_,a=1,w=1,o=s+1;o<u+1;o++){for(g=f[o],R=d[o],y=w*g,g*=a,C=BL(m,y),f[o-1]=C,m=_*(a=m/C)+g*(w=y/C),g=-_*w+g*a,y=R*w,R*=a,i=0;i<h;i++)_=p[i][o-1],C=p[i][o],p[i][o-1]=_*a+C*w,p[i][o]=-_*w+C*a;for(C=BL(m,y),d[o-1]=C,m=(a=m/C)*g+(w=y/C)*R,_=-w*g+a*R,i=0;i<c;i++)R=l[i][o-1],C=l[i][o],l[i][o-1]=R*a+C*w,l[i][o]=-R*w+C*a}f[s]=0,f[u]=m,d[u]=_}for(o=0;o<d.length;o++)d[o]<r&&(d[o]=0);for(o=0;o<h;o++)for(i=o-1;i>=0;i--)if(d[i]<d[o]){for(a=d[i],d[i]=d[o],d[o]=a,u=0;u<l.length;u++)t=l[u][o],l[u][o]=l[u][i],l[u][i]=t;for(u=0;u<p.length;u++)t=p[u][o],p[u][o]=p[u][i],p[u][i]=t;o=i}return{U:l,S:d,V:p}}(e),r=t.S,n=$L(t.U),a=DL(r.length,e[0].length,0),o=Math.max(e.length,e[0].length)*Number.EPSILON*r[0],i=0;i<r.length;i++)Math.abs(r[i])>o&&(a[i][i]=1/r[i]);return LL(t.V,LL(a,n))}function HL(e){var t=zL(e),r=t.luMatrix,n=t.permutation;return!t.smallPivotDetected&&function(e,t){for(var r=t.length,n=DL(r,r,0),a=0;a<r;a++)n[a][a]=1;for(var o=DL(r,r,0),i=0;i<r;i++)for(var u=t[i],s=0;s<r;s++)o[i][s]=n[u][s];for(var l=0;l<r;l=l+1|0)for(var c=o[l],h=l+1;h<r;h++)for(var f=e[h][l],d=0;d<r;d+=1)o[h][d]-=c[d]*f;for(var v=r-1;0<=v;v--){for(var p=o[v],m=e[v][v],g=0;g<r;g++)p[g]/=m;for(var y=0;y<v;y++)for(var _=e[y][v],R=0;R<r;R++)o[y][R]-=p[R]*_}return o}(r,n)}function zL(e){for(var t=PL(e),r=t.length,n=t[0].length,a=!0,o=!1,i=DL(r,n,0),u=new Array(n).fill(0).map((function(e,t){return t})),s=0;s<n;s++){for(var l,c,h,f=0;f<s;f++){for(var d=t[f][s],v=0;v<f;v++)d-=i[f][v]*i[v][s];i[f][s]=d}for(var p=-1/0,m=s,g=s;g<r;g++){for(var y=t[g][s],_=0;_<s;_++)y-=i[g][_]*i[_][s];i[g][s]=y;var R=Math.abs(y);R>p&&(p=R,m=g)}if(Math.abs(i[m][s])<1e-11){o=!0;break}m!==s&&(l=[i[s],i[m]],i[m]=l[0],i[s]=l[1],c=[t[s],t[m]],t[m]=c[0],t[s]=c[1],h=[u[s],u[m]],u[m]=h[0],u[s]=h[1],a=!a);for(var C=i[s][s],w=s+1;w<r;w++)i[w][s]/=C}return{rowSwap:a,smallPivotDetected:o,luMatrix:i,permutation:u}}function WL(e,t,r,n,a){var o,i=e.rowCount(),u=e.colCount(),s=e.size(),l=1===s,c=ZL.SIMPLE;if(t.isNull())return l&&n&&(o=Ce.d$b[Ce.O6N.TREND_POINT_NUM_UNENOUGHT]({funcName:r,expectedNum:2,receivedNum:s})),{error:o,type:c};var h=t.rowCount(),f=t.colCount(),d=t.size(),v=1===d,p=i===h,m=u===f;return 1===u&&1!==f||1===i&&1!==h?(o=function(e,t,r,n,a){var o,i,u=e.rowCount(),s=e.colCount(),l=t.rowCount(),c=t.colCount(),h=1===s,f=1===u;if(h?(o=c,i=u):(o=l,i=s),h&&u!==l)return Ce.d$b[Ce.O6N.TREND_ROW_NO_MATCH]({funcName:r,yRowCount:u,xRowCount:l});if(f&&s!==c)return Ce.d$b[Ce.O6N.TREND_COL_NO_MATCH]({funcName:r,yColCount:s,xColCount:c});if(a&&!a.isNull()){if(h&&a.colCount()!==o)return Ce.d$b[Ce.O6N.TREND_COL_NO_MATCH]({funcName:r,yColCount:o,xColCount:a.colCount()});if(f&&a.rowCount()!==o)return Ce.d$b[Ce.O6N.TREND_ROW_NO_MATCH]({funcName:r,yRowCount:o,xRowCount:a.rowCount()})}return n&&o+1>i||o>i?Ce.d$b[Ce.O6N.TREND_POINT_NUM_UNENOUGHT]({funcName:r,expectedNum:n?o+1:o,receivedNum:i}):void 0}(e,t,r,n,a),{error:o,type:c=ZL.MULTIPLE}):p||m?p?m?l&&v&&n?{error:o=Ce.d$b[Ce.O6N.TREND_POINT_NUM_UNENOUGHT]({funcName:r,expectedNum:d+1,receivedNum:s}),type:c}:{error:o,type:c}:{error:o=Ce.d$b[Ce.O6N.TREND_COL_NO_MATCH]({funcName:r,yColCount:u,xColCount:f}),type:c}:{error:o=Ce.d$b[Ce.O6N.TREND_ROW_NO_MATCH]({funcName:r,yRowCount:i,xRowCount:h}),type:c}:{error:o=Ce.d$b[Ce.O6N.TREND_ROW_COL_NO_MATCH]({funcName:r,yRowCount:i,yColCount:u,xRowCount:h,xColCount:f}),type:c}}function GL(e,t,r,n,a,o,i){var u,s=t.rowCount(),l=t.colCount(),c=jL(e,t,n,1,a,i);c.error&&(u=c.error);var h=qa(r)?function(e,t,r){if(r===ZL.SIMPLE){for(var n=[],a=1;a<=e*t;a++)n.push(a);return{error:void 0,numberArray:n}}for(var o=[],i=1,u=0;u<e;u++)for(var s=0;s<t;s++)o[u]||(o[u]=[]),o[u].push(i++);return{error:void 0,numberArray:o}}(s,l,ZL.SIMPLE):jL(e,r,n,2,a);!u&&h.error&&(u=h.error);var f=o&&!qa(o)?jL(e,o,n,3,a):h;return!u&&f.error&&(u=f.error),{error:u,knownYTransformResult:c,knownXTransformResult:h,newXTransformResult:f}}function jL(e,t,r,n,a,o){var i,u,s=[],l=a===ZL.SIMPLE,c=o&&1===n;c&&(u=[]);var h=t.rowCount(),f=t.colCount();e:for(var d=0;d<h;++d)for(var v=0;v<f;++v){var p=t.at(d,v);if(!za(p)){ja(p)?i=p:Wa(p)?i=hl(r,n,p.getValue()):Ga(p)?i=fl(r,n,p.getValue()?"TRUE":"FALSE"):qa(p)&&(i=dl(r,n,""));break e}var m=p.getValue();if(c&&m<=0){i=Js(r,1,m,0);break e}l?(s.push(m),u&&u.push(Math.log(m))):(0===v&&(s[d]=[],u&&(u[d]=[])),s[d].push(m),u&&u[d].push(Math.log(m)))}return{error:i,numberArray:s,lnKnowYArray:u}}function YL(e,t,r,n){var a,o;if(r){var i=new qt.Z(t,e);a=i.slope,o=i.intercept,i=null}else a=function(e,t){for(var r=[JSON.parse(JSON.stringify(e))],n=JSON.parse(JSON.stringify(t)),a=r[0].length,o=r.length,i=Math.min(a,o),u=new Array(i).fill(0),s=0;s<i;s++){for(var l=r[s],c=0,h=s;h<a;h++)c+=l[h]*l[h];if(c=0<l[s]?-Math.sqrt(c):Math.sqrt(c),u[s]=c,0!==c){l[s]-=c;for(var f=s+1;f<o;f++){for(var d=r[f],v=0,p=s;p<a;p++)v-=d[p]*u[p];v/=c*u[s];for(var m=s;m<a;m++)d[m]-=v*u[m]}}}for(var g=r.length,y=r[0].length,_=new Array(g).fill(0),R=Math.min(g,y),C=0;C<R;C++){for(var w=r[C],E=0,k=C;k<y;k++)E+=n[k]*w[k];E/=u[C]*w[C];for(var T=C;T<y;T++)n[T]+=E*w[T]}for(var S=u.length-1;0<=S;S--){n[S]/=u[S];var A=n[S],I=r[S];_[S]=A;for(var O=0;O<S;O++)n[O]-=A*I[O]}return _[0]}(t,e),o=0;return n?[[Math.exp(a),Math.exp(o)]]:[[a,o]]}function qL(e){return e.reduce((function(e,t){return e+t}),0)/e.length}function JL(e,t,r){for(var n=0,a=e.length,o=0;o<a;o++){var i=e[o];n+=r?Math.pow(i-t,2):Math.pow(i,2)}return n}function KL(e,t){for(var r=0,n=e.length,a=0;a<n;a++){var o=e[a],i=t[a];r+=(o-i)*(o-i)}return r}function XL(e,t,r){return r?Math.sqrt(e/r/t):0}function QL(e,t,r,n,a){return n?Math.sqrt(e/n*(1/a+Math.pow(t,2)/r)):0}function eB(e,t){return e/(e+t)}function tB(e,t){return t?Math.sqrt(e/t):0}function rB(e,t,r){return e/(t/r)}function nB(e,t,r,n){return e/t/(r/n)}function aB(e,t){return e-t}function oB(e){for(var t=[],r=0;r<e.length;r++){t[r]||(t[r]=[]);for(var n=0;n<e[0].length;n++)t[r][n]=new it.NumberVar(e[r][n])}return t}function iB(e,t,r){var n=t[0][0],a=t[0][1],o=e.length;if(r){for(var i=[],u=o/r,s=0;s<r;s++){i[s]||(i[s]=[]);for(var l=0;l<u;l++)i[s][l]=n*e[s*u+l]+a}return i}for(var c=[],h=0;h<o;h++)c.push(e[h]*n+a);return c}function uB(e,t,r){var n=t[0][0],a=t[0][1],o=e.length;if(r){for(var i=[],u=o/r,s=[],l=0;l<r;l++){i[l]||(i[l]=[],s[l]=[]);for(var c=0;c<u;c++){var h=a*Math.pow(n,e[l*u+c]);i[l][c]=h,s[l][c]=h}}return{predictResult:i,lnPredictResult:s}}for(var f=[],d=[],v=0;v<o;v++){var p=a*Math.pow(n,e[v]);f.push(p),d.push(Math.log(p))}return{predictResult:f,lnPredictResult:d}}function sB(e,t,r){for(var n=e.length,a=t[0].pop(),o=t[0].length,i=[],u=0;u<n;u++){for(var s=a,l=o-1;l>=0;l--)s+=t[0][o-1-l]*e[u][l];r?(i[u]||(i[u]=[]),i[u].push(s)):i.push(s)}return i}function lB(e,t,r){for(var n=e.length,a=t[0].pop(),o=t[0].length,i=[],u=[],s=0;s<n;s++){for(var l=a,c=o-1;c>=0;c--){var h=t[0][o-1-c];l*=Math.pow(h,e[s][c])}r?(i[s]||(i[s]=[],u[s]=[]),i[s].push(l),u[s].push(Math.log(l))):(i.push(l),u.push(Math.log(l)))}return{predictResult:i,lnPredictResult:u}}function cB(e,t,r,n,a,o,i){var u=GL(e,t,r,n,ZL.SIMPLE,i,o),s=u.error,l=u.knownYTransformResult,c=u.knownXTransformResult,h=u.newXTransformResult;if(s)return{error:s};var f,d=l.numberArray,v=c.numberArray,p=h&&h.numberArray,m=l.lnKnowYArray,g=t.rowCount();return i&&!i.isNull()?g=i.rowCount():r.isNull()||(g=r.rowCount()),f=YL(o?m:d,v,a,o),isNaN(f[0][0])&&!a&&(f[0][0]=0),{newXArray:p,weights:f,newXRowCount:g,error:s,knownXArray:v,knownYArray:d,lnKnowYArray:m}}function hB(e,t,r,n,a,o,i){var u=1===t.colCount(),s=GL(e,t,r,n,ZL.MULTIPLE,i,o),l=s.error,c=s.knownYTransformResult,h=s.knownXTransformResult,f=s.newXTransformResult;if(l)return{error:l};var d,v=c.numberArray,p=h.numberArray,m=c.lnKnowYArray,g=f&&f.numberArray;return u||(p=$L(p),v=$L(v),g=$L(g),m&&(m=$L(m))),d=function(e,t,r,n){if(r)for(var a=0;a<t.length;a++)t[a].push(1);var o=$L(t),i=LL(o,t),u=LL(o,e),s=HL(i)||UL(i),l=LL(s,u);r||l.push([0]);var c=(l=$L(l))[0].pop();if(l[0].reverse(),l[0].push(c),n)for(var h=0;h<l[0].length;h++)l[0][h]=Math.exp(l[0][h]);return{weights:l,inverseMatrix:s}}(o?m:v,p,a,o),{newXMatrix:g,isYColCountEqualOne:u,weights:d.weights,error:l,inverseMatrix:d.inverseMatrix,knownXMatrix:p,knownYMatrix:v,lnKnowYMatrix:m}}!function(e){e.SIMPLE="SIMPLE",e.MULTIPLE="MULTIPLE"}(ZL||(ZL={}));var fB=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t.length;if(r%2!=0)return Zl(this.name,2);for(var n=[],a=[],o=0;o<r;o+=2){var i=t[o].rowCount(),u=t[o].colCount(),s=t[o+1].rowCount(),l=t[o+1].colCount();if(i!==s||u!==l)return kl(this.name,i,s,u,l)}for(var c=0;c<r;c++){var h=jL(0,t[c],this.name,c+1,ZL.SIMPLE),f=h.error,d=h.numberArray;if(f)return f;(0,Ce.hTd)(c%2==0?n:a,d)}for(var v=n.length,p=0,m=0;m<v;m++){if(a[m]<0)return Ul;p+=a[m]}for(var g=0,y=0;y<v;y+=1)g+=n[y]*a[y];if(0===p)return Hl(this.name);g/=p;for(var _=0,R=0;R<v;R+=1)_+=a[R]*(n[R]-g);return new it.NumberVar(g+_/p)}}]),t}(pw("AVERAGE.WEIGHTED",2,256,2,Vd,[{type:Zd},{type:Zd},{type:Zd},{type:Zd}])),dB=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue()),a=t[2]?t[2].getValue():0;if(r<0||r>Number.MAX_SAFE_INTEGER)return Gs(this.name,1,r,0,Number.MAX_SAFE_INTEGER);if(n<2||n>36)return Gs(this.name,2,n,2,36);if(a<0||a>255)return Gs(this.name,3,a,0,255);var o=r.toString(n).toUpperCase(),i=Math.floor(Math.max(a-o.length,0));return new it.StringVar("0".repeat(i)+o)}}]),t}(pw("BASE",2,1,0,Nd,[{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(0)}])),vB=4294967296,pB=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=281474976710656,n=t[0].getValue(),a=t[1].getValue();if(n<0)return zs(this.name,1);if(n%1!=0)return nl(this.name,1,n);if(n>=r)return tl(this.name,n,1,r);if(this.name.includes("SHIFT")){if(0===n)return new it.NumberVar(0);a=Math.trunc(a)}else{if(a<0)return zs(this.name,2);if(a%1!=0)return nl(this.name,2,a);if(a>r)return tl(this.name,a,2,r)}return this.bitClac(n,a)}},{key:"generate64BitInteger",value:function(e){return e>0?{high32bits:0|e,low32bits:e/vB|0}:{high32bits:0|-e,low32bits:-e/vB|0}}}]),t}(pw("",2,0,0,Vd,[{type:Vd},{type:Vd}])),mB=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BITAND",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"bitClac",value:function(e,t){return new it.NumberVar(e&t)}}]),t}(pB),gB=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BITLSHIFT",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"bitClac",value:function(e,t){if(t>53||t<-53)return Gs(this.name,2,t,-53,53);if(t<0&&e<1<<-t)return new it.NumberVar(0);var r=0xffffffffffff,n=Math.floor(e*Math.pow(2,t));return n>r?function(e,t,r){return Ce.d$b[Ce.O6N.FUNCTION_RESULT_SHOULD_BE_LESS_THAN_OR_EQUAL_TO]({funcName:e,value:t,upperBound:r})}(this.name,n,r):new it.NumberVar(n)}}]),t}(pB),yB=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BITOR",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"bitClac",value:function(e,t){var r=this.generate64BitInteger(e),n=this.generate64BitInteger(t),a=r.high32bits|n.high32bits,o=r.low32bits|n.low32bits;return new it.NumberVar(vB*o+(a>>>0))}}]),t}(pB),_B=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BITRSHIFT",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"bitClac",value:function(e,t){if(t>53||t<-53)return Gs(this.name,2,t,-53,53);var r=Math.floor(e/Math.pow(2,t));return new it.NumberVar(r)}}]),t}(pB),RB=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BITXOR",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"bitClac",value:function(e,t){var r=this.generate64BitInteger(e),n=this.generate64BitInteger(t),a=r.high32bits^n.high32bits,o=r.low32bits^n.low32bits;return new it.NumberVar(vB*o+(a>>>0))}}]),t}(pB),CB=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(""===r)return bl(this.name,1);var n=r.codePointAt(0);return new it.NumberVar(n)}}]),t}(pw("CODE",1,0,0,Vd,[{type:Nd}])),wB=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[399,111,258,265],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(!Ba(t[0]))return Rl(this.name,1,El(t[0]),wl(t[0]),"".concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_STRING,",").concat(it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN));var r=qa(t[0])?new it.NumberVar(0):t[0],n=!t[3]||!qa(t[3])&&t[3].getValue(),a=Math.floor(t[2].getValue()),o=t[1];if(to(o)&&(o=$s(e.workbook,o)),a<=0)return Xs(this.name,a,3,1);if(a>o.colCount())return Ce.d$b[Ce.O6N.REFERENCE_OUT_OF_BOUNDS]({funcName:this.name});var i=new G$(!1,n?D$.BinaryAscending:D$.Sequence,this.name,r,o,a-1,n?x$.Smaller:x$.Wildcard);return n?Q$(e,o,i):j$(e,o,i)}}]),t}(pw("VLOOKUP",3,1,0,Nd,[{type:Nd|Vd|bd,default:new it.NumberVar(0)},{type:Zd},{type:Vd},{type:bd,default:(Ye={},(0,l.Z)(Ye,it.DefaultParam.IfNotInput,new it.BooleanVar(!0)),(0,l.Z)(Ye,it.DefaultParam.IfInputNull,new it.BooleanVar(!1)),Ye)}])),EB=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=this,n=t[0].rowCount(),a=t[0].colCount(),o=new Array(n*a),i=function(e){var i=t[e];if(e>0&&(n!==i.rowCount()||a!==i.colCount()))return{v:kl(r.name,n,a,i.rowCount(),i.colCount())};var u,s=0;return u=0===e?i.forEach((function(e){if(ja(e))return e;za(e)?o[s]=e.getValue():Ga(e)?o[s]=e.getValue()?1:0:o[s]=0,s++})):i.forEach((function(e){if(ja(e))return e;za(e)?o[s]=(o[s]||0)*e.getValue():Ga(e)?o[s]=(o[s]||0)*(e.getValue()?1:0):o[s]=0,s++})),u?{v:u}:void 0},u=0;u<t.length;u++){var s=i(u);if("object"===(0,R.Z)(s))return s.v}for(var l=0,c=0;c<o.length;++c)l+=o[c];return new it.NumberVar(l)}}]),t}(pw("SUMPRODUCT",1,256,1,Vd,[{type:Zd},{type:Zd}]));function kB(e,t,r){var n=t.rowCount(),a=t.colCount();if(a>ai(r)||n>ni(r)){r.endRow=r.startRow+n,r.endCol=r.startCol+a;var o=new Qi(r.startRow,r.endRow,r.startCol,r.endCol,r.hostId,r.hostName);Array.isArray(e.info.customDepends)||(e.info.customDepends=[]),e.info.customDepends.push(o)}}EB=Vu([Cp("SUMPRODUCT")],EB);var TB=function(){function e(){(0,y.Z)(this,e),this.leftTop2Range=new Map,this.rightBottom2Range=new Map}return(0,_.Z)(e,[{key:"batchAdd",value:function(e){for(var t=0;t<e.length;t++)this.add(e[t]);return Array.from(this.leftTop2Range.values())}},{key:"add",value:function(e){AB(e,this.leftTop2Range,this.rightBottom2Range,!1)}},{key:"has",value:function(e){return this.leftTop2Range.get(Wd(e.startRow,e.startCol))===e}},{key:"delete",value:function(e){VB(e,this.leftTop2Range,this.rightBottom2Range)}},{key:"forEach",value:function(e){this.leftTop2Range.forEach(e)}}]),e}(),SB=function(){function e(){(0,y.Z)(this,e),this.gridRanges=[]}return(0,_.Z)(e,[{key:"add",value:function(e,t,r,n,a){if(this.gridRanges.length>0){var o=this.gridRanges[this.gridRanges.length-1];if(o.hostId===r&&o.hostName===n){if(o.endRow===e&&o.startCol===t&&o.endCol===t+1){if(o.endRow++,a&&this.gridRanges.length>1){var i=this.gridRanges[this.gridRanges.length-2];i.endCol===o.startCol&&i.startRow===o.startRow&&i.endRow===o.endRow&&i.hostId===o.hostId&&i.hostName===o.hostName&&(i.endCol=o.endCol,this.gridRanges.pop())}return}if(o.endCol===t&&o.startRow===e&&o.endRow===e+1){if(o.endCol++,!a&&this.gridRanges.length>1){var u=this.gridRanges[this.gridRanges.length-2];u.endRow===o.startRow&&u.startCol===o.startCol&&u.endCol===o.endCol&&u.hostId===o.hostId&&u.hostName===o.hostName&&(u.endRow=o.endRow,this.gridRanges.pop())}return}}}this.gridRanges.push(new Qi(e,e+1,t,t+1,r,n))}},{key:"getRanges",value:function(){return this.gridRanges}}]),e}();function AB(e,t,r){var n,a,o,i,u=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],s=Wd(e.startRow,e.endCol),l=r.get(s);(null==l?void 0:l.startCol)===e.startCol&&(VB(l,t,r),ti(i=null!==(n=i)&&void 0!==n?n:e.clone(),l));var c=Wd(e.endRow,e.startCol),h=t.get(c);(null==h?void 0:h.endCol)===e.endCol&&(VB(h,t,r),ti(i=null!==(a=i)&&void 0!==a?a:e.clone(),h));var f=!i&&u;i=null!==(o=i)&&void 0!==o?o:e,f?OB(i,t,r):IB(i,t,r)}function IB(e,t,r){var n,a,o,i,u=Wd(e.endRow,e.startCol),s=r.get(u);(null==s?void 0:s.startRow)===e.startRow&&(VB(s,t,r),ti(i=null!==(n=i)&&void 0!==n?n:e.clone(),s));var l=Wd(e.startRow,e.endCol),c=t.get(l);(null==c?void 0:c.endRow)===e.endRow&&(VB(c,t,r),ti(i=null!==(a=i)&&void 0!==a?a:e.clone(),c));var h=!i;i=null!==(o=i)&&void 0!==o?o:e,h?OB(i,t,r):AB(i,t,r)}function OB(e,t,r){var n=Wd(e.startRow,e.startCol);t.set(n,e);var a=Wd(e.endRow,e.endCol);r.set(a,e)}function VB(e,t,r){var n=Wd(e.startRow,e.startCol);t.delete(n);var a=Wd(e.endRow,e.endCol);r.delete(a)}var NB=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"sortable",value:function(){return!1}},{key:"handleNormal",value:function(){return!1}},{key:"handleError",value:function(){return!1}},{key:"handleNull",value:function(){return!1}}]),e}(),bB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return!1}}]),t}(NB),MB=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e,r}return(0,p.Z)(t,e),t}(NB),FB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.type===this.value.type&&e.greaterThan(this.value)}}]),t}(MB),ZB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.type===this.value.type&&e.greaterThanEquals(this.value)}}]),t}(MB),xB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.type===this.value.type&&e.lessThan(this.value)}}]),t}(MB),DB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.type===this.value.type&&e.lessThanEquals(this.value)}}]),t}(MB),PB=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e.getValue(),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.isBool()&&e.getValue()===this.value}},{key:"sortable",value:function(){return!0}}]),t}(NB),$B=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return!(0,f.Z)((0,v.Z)(t.prototype),"eq",this).call(this,e)}},{key:"handleNormal",value:function(){return!0}},{key:"handleError",value:function(){return!0}},{key:"handleNull",value:function(){return!0}}]),t}(PB),LB=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).type=e.errorType,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.isError()&&this.type===e.errorType}},{key:"handleError",value:function(){return!0}}]),t}(NB),BB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return!(0,f.Z)((0,v.Z)(t.prototype),"eq",this).call(this,e)}},{key:"handleNormal",value:function(){return!0}},{key:"handleNull",value:function(){return!0}}]),t}(LB),UB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.isError()&&e.errorType>this.type}}]),t}(LB),HB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.isError()&&e.errorType>=this.type}}]),t}(LB),zB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.isError()&&e.errorType<this.type}}]),t}(LB),WB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.isError()&&e.errorType<=this.type}}]),t}(LB),GB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.isNull()}},{key:"handleNull",value:function(){return!0}}]),t}(NB),jB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return!e.isNull()}},{key:"handleNormal",value:function(){return!0}},{key:"handleError",value:function(){return!0}}]),t}(NB),YB=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e,n.service=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.isString()?this.value.getCompareValue()===e.getCompareValue(this.service):this.value.equals(e)}},{key:"sortable",value:function(){return!0}}]),t}(NB),qB=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return!e.isNumber()||this.value.notEquals(e)}},{key:"sortable",value:function(){return!0}},{key:"handleNormal",value:function(){return!0}},{key:"handleError",value:function(){return!0}},{key:"handleNull",value:function(){return!0}}]),t}(NB),JB=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).regex=XP(e),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return e.isString()&&this.regex.test(e.getValue())}}]),t}(NB),KB=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return!e.isString()||!this.regex.test(e.getValue())}},{key:"handleNormal",value:function(){return!0}},{key:"handleError",value:function(){return!0}},{key:"handleNull",value:function(){return!0}}]),t}(JB),XB=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return this.value.equals(e)}},{key:"sortable",value:function(){return""!==this.value.getValue()}},{key:"handleNull",value:function(){return""===this.value.getValue()}}]),t}(NB),QB=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"eq",value:function(e){return this.value.notEquals(e)}},{key:"sortable",value:function(){return!0}},{key:"handleNormal",value:function(){return!0}},{key:"handleError",value:function(){return!0}},{key:"handleNull",value:function(){return!0}}]),t}(NB),eU=[{type:7,str:"<>"},{type:3,str:">="},{type:5,str:"<="},{type:6,str:"="},{type:2,str:">"},{type:4,str:"<"}],tU=function(){function e(t,r,n){(0,y.Z)(this,e),this.match=t,this.value=r,this.type=n}return(0,_.Z)(e,null,[{key:"init",value:function(){e.num=0}}]),(0,_.Z)(e,[{key:"cacheKey",value:function(){return this.key||(this.key=":"+e.num++),this.key}}]),e}();function rU(e,t){var r=yd(t),n=e.funcCache.criterion;0===n.size()&&0===e.funcCache.result.size()&&tU.init();var a=n.get(r);return a||(a=nU(e,t),n.set(r,a)),a}function nU(e,t,r){if(t.isError())return new tU(new LB(t),t);if(void 0!==r)return new tU(aU(e,t,r),t,r);if(t.isString()){var n=t.getValue(),a=0;if(void 0===r)for(var o=eU.length;a<o;a++){var i=eU[a];if(n.startsWith(i.str)){r=i.type;break}}if(void 0!==r&&(n=n.substring(eU[a].str.length)),t=""===n&&void 0!==r?it.NULL_VAR:gd(e.service,n),void 0===r&&(r=6),(6===r||7===r)&&t.isString()&&YP.test(n)&&n.length<=Tc){var u=6===r?new JB(n):new KB(n);return new tU(u,t,r)}return new tU(aU(e,t,r),t,r)}return t.isNull()?new tU(new GB,t,6):new tU(aU(e,t,6),t,6)}function aU(e,t,r){switch(r){case 0:case 6:if(t.isNumber())return new YB(t,e.service);if(t.isString())return new XB(t);if(t.isBool())return new PB(t);if(t.isNull())return new GB;if(t.isError())return new LB(t);break;case 1:case 7:if(t.isNumber())return new qB(t);if(t.isString())return new QB(t);if(t.isBool())return new $B(t);if(t.isNull())return new jB;if(t.isError())return new BB(t);break;case 2:return t.isError()?new UB(t):t.isNull()?new bB:new FB(t);case 3:return t.isError()?new HB(t):t.isNull()?new bB:new ZB(t);case 4:return t.isError()?new zB(t):t.isNull()?new bB:new xB(t);case 5:return t.isError()?new WB(t):t.isNull()?new bB:new DB(t)}return new bB}tU.num=0;var oU,iU=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"noDiff",value:function(){return!0}},{key:"update",value:function(e){return e}}]),e}(),uU=function(){function e(t,r){(0,y.Z)(this,e),this.old=t,this.curr=r}return(0,_.Z)(e,[{key:"noDiff",value:function(){return!1}},{key:"update",value:function(e){var t=(e/ai(this.old)|0)+this.old.startRow,r=(e%ai(this.old)|0)+this.old.startCol;return Wo(this.curr,t,r)?(t-this.curr.startRow)*ai(this.curr)+(r-this.curr.startCol):-1}}]),e}();function sU(){return oU||(oU=new iU),oU}function lU(e,t){return t.startRow===e.startRow&&t.startCol===e.startCol&&t.endCol===e.endCol&&t.endRow>=e.endRow?sU():new uU(e,t)}var cU=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50;(0,y.Z)(this,e),this.maxSize=t,this.tree=new VT,this.cache=new Ce.z6B(t)}return(0,_.Z)(e,[{key:"search",value:function(e){return this.tree.search(e)}},{key:"get",value:function(e){return this.cache.get(e)}},{key:"set",value:function(e,t){for(var r=this.cache,n=this.tree;r.size()>=this.maxSize;){var a=r.getOldest();a[0]&&r.remove(a[0]),a[1]&&n.remove(a[1])}this.cache.set(e,t),this.tree.insert(t)}},{key:"remove",value:function(e){var t=this.cache.get(e);t&&this.tree.remove(t),this.cache.remove(e)}}]),e}();function hU(e,t,r,n,a,o,i,u,s){var l=t.rowCount(),c=t.colCount();void 0===s&&(s=0);for(var h=0;h<l;h++)for(var f=0;f<c;f++,s++){var d=t.at(h,f);if(d.isNull())r.push(s);else if(d.isError())n.push(s),a[s]=d;else{var v=d.type,p=u[v];p||(p=new Map,u[v]=p);var m=d.isNumber()?"".concat(d.getCompareValue()):"".concat(d.getValue()).toLowerCase(),g=p.get(m);if(g||(g=[],p.set(m,g),o.push({val:d,idx:g})),g.push(s),d.isString()){var y=d.toNumberVar(e.service);if(y.isNumber()){var _=-1*v,R=u[_];R||(R=new Map,u[_]=R);var C=y.getCompareValue(),w=R.get(C);w||(w=[],R.set(C,w),i.push({val:y,idx:w})),w.push(s)}}}}}function fU(e,t){var r=t.rowCount(),n=t.colCount(),a=[],o=[],i=[],u=[],s=[];return hU(e,t,a,o,i,u,s,{}),u.sort((function(e,t){return PD(e.val,t.val)})),s.sort((function(e,t){return PD(e.val,t.val)})),{info:{nullIdx:a,errIdx:o,errors:i,values:u,str2num:s,ref:t.getRef()},diff:sU(),rowCount:r,colCount:n}}function dU(e,t,r,n,a){if(t.length<n.length&&a.noDiff())return dU(r,n,e,t,a);for(var o=0,i=n.length;o<i;o++){var u=a.update(n[o]),s=r[n[o]];t.push(u),e[u]=s}return[e,t]}function vU(e,t,r){if(e.length<t.length&&r.noDiff())return vU(t,e,r);for(var n=0,a=t.length;n<a;n++)e.push(r.update(t[n]));return e}function pU(e,t,r){if(e.length<t.length&&r.noDiff())return pU(t,e,r);for(var n=0,a=t.length;n<a;n++){var o=t[n],i=o.val,u=o.idx,s=ZD(e,i);s<0&&(s=-s-1,e.splice(s,0,{val:i,idx:[]}));for(var l=0,c=u.length;l<c;l++)e[s].idx.push(r.update(u[l]))}return e}function mU(e,t){var r=t.hash(),n=e.funcCache.range,a=e.funcCache.speedup,o=n.get(r);return o||(o=function(e,t,r,n){if(!Ka(t))return fU(e,t);var a=t.getRef(),o=ni(a),i=ai(a),u=o*i;if(u<kc)return fU(e,t);var s=a.hostId,l=r.get(s);l||(l=new cU,r.set(s,l));var c=t.hash(),h=l.get(c);if(h)return h.sortCache;for(var f=l.search(a),d=0,v=f.length;d<v;d++){var p=f[d],m=p.ref,y=p.sortCache,_=p.key,R=y.info,C=y.rowCount*y.colCount;if(Go(a,m)&&zo(m,a)&&u>=.2*C)return{info:R,diff:lU(m,a),rowCount:o,colCount:i};if(Go(a,m)&&zo(a,m)&&C>=.2*u){for(var w,E,k=Mi(a,m),T=[],S=[],A=[],I=[],O=[],V={},N=0,b=k.length;N<b;N++){var M=k[N];hU(e,new Ss(Qi.fromGridRange(M),t.cache),T,S,A,I,O,V,(M.startRow-a.startRow)*ai(a))}I.sort((function(e,t){return PD(e.val,t.val)})),O.sort((function(e,t){return PD(e.val,t.val)}));var F=lU(m,a);w=dU(A,S,R.errors,R.errIdx,F),A=(E=(0,g.Z)(w,2))[0],S=E[1],T=vU(T,R.nullIdx,F),I=pU(I,R.values,F),O=pU(O,R.str2num,F),l.remove(_),n.remove(_);var Z={info:{nullIdx:T,errIdx:S,errors:A,values:I,str2num:O,ref:a},diff:sU(),rowCount:o,colCount:i};return l.set(c,{ref:a,sortCache:Z,key:c}),Z}}var x=fU(e,t);return l.set(c,{ref:a,sortCache:x,key:c}),x}(e,t,a,n),n.set(r,o)),o}function gU(e,t){var r=new LD,n=t.match;if(void 0===t.type)return _U(e,n,r),r;switch(t.type){case 0:case 6:if(n.sortable())return function(e,t,r){var n=t.value,a=t.match,o=e.info,i=e.diff;if(n.isNull())return void yU(r,o.nullIdx,i);if(n.isError())return void _U(e,a,r);var u=ZD(o.values,n);if(u>=0&&yU(r,o.values[u].idx,i),n.isNumber()){var s=ZD(o.str2num,n);s>=0&&yU(r,o.str2num[s].idx,i)}}(e,t,r),r;break;case 1:case 7:if(n.sortable())return function(e,t,r){var n=t.value,a=e.info,o=e.diff,i=DD(a.values,n);if(i>=0)for(var u=xD(a.values,n),s=ZD(a.values,n),l=u;l<=i;l++)l!==s&&yU(r,a.values[l].idx,o);CU(e,t,r)}(e,t,r),r;break;case 2:case 3:return function(e,t,r){var n=t.value,a=e.info,o=e.diff,i=DD(a.values,n);if(i>=0){var u=ZD(a.values,n);for(u<0?u=-1-u:2===t.type&&(u+=1);u<=i;u++)yU(r,a.values[u].idx,o)}CU(e,t,r)}(e,t,r),r;case 4:case 5:return function(e,t,r){var n=t.value,a=e.info,o=e.diff,i=xD(a.values,n);if(i>=0){var u=ZD(a.values,n);for(u<0?u=-2-u:4===t.type&&(u-=1);i<=u;i++)yU(r,a.values[i].idx,o)}CU(e,t,r)}(e,t,r),r}return function(e,t,r){for(var n=t.match,a=e.info,o=e.diff,i=0,u=a.values.length;i<u;i++)n.eq(a.values[i].val)&&yU(r,a.values[i].idx,o);_U(e,n,r),n.eq(it.NULL_VAR)&&yU(r,a.nullIdx,o)}(e,t,r),r}function yU(e,t,r){if(r.noDiff())for(var n=0,a=t.length;n<a;n++)e.add(t[n]);else for(var o=0,i=t.length;o<i;o++){var u=r.update(t[o]);u>=0&&e.add(u)}}function _U(e,t,r){for(var n=e.info,a=e.diff,o=0,i=n.errIdx.length;o<i;o++){var u=n.errIdx[o];if(t.eq(n.errors[u])){var s=a.update(u);s>=0&&r.add(s)}}}function RU(e){for(var t=e.info,r=e.diff,n=new Map,a=0,o=t.errIdx.length;a<o;a++){var i=t.errIdx[a],u=r.update(i);u>=0&&n.set(u,t.errors[i])}return n}function CU(e,t,r){var n=t.match,a=e.info,o=e.diff;if(n.handleNormal()){var i=xD(a.values,t.value);if(i<0)for(var u=0,s=a.values.length;u<s;u++)t.match.eq(a.values[u].val)&&yU(r,a.values[u].idx,o);else{for(var l=0;l<i;l++)t.match.eq(a.values[l].val)&&yU(r,a.values[l].idx,o);for(var c=DD(a.values,t.value)+1,h=a.values.length;c<h;c++)t.match.eq(a.values[c].val)&&yU(r,a.values[c].idx,o)}}n.handleError()&&_U(e,n,r),n.handleNull()&&n.eq(it.NULL_VAR)&&yU(r,a.nullIdx,o)}function wU(e,t,r){var n;if(Ba(t))return null;var a=t.hash();if(!a)return null;var o=t.size(),i=null,u=null,s=e.funcCache.result;return o<kc?i=null:i=(null===(n=u=s.get(r.cacheKey())||null)||void 0===n?void 0:n.get(a))||null,null===i&&(i=gU(mU(e,t),r)),o<kc||(null===u&&(u=new Ce.z6B(500),s.set(r.cacheKey(),u)),u.set(a,i)),i}function EU(e,t,r,n){if(!ja(t)&&r.hash()){var a=mU(e,r),o=nU(e,t,n),i=new LD;if(t.isNull())return function(e,t,r){for(var n=t.type,a=3===n||5===n,o=2===n||3===n,i=4===n||5===n,u=e.info,s=e.diff,l=0;l<u.values.length;l++){var c=u.values[l],h=c.val,f=c.idx;if(h.isNumber()){var d=h.getCompareValue();if(0===d&&a||d>0&&o||d<0&&i){yU(r,f,s);continue}}h.isString()?""===h.getValue()?a&&yU(r,f,s):o&&yU(r,f,s):h.isBool()&&(!1===h.getValue()?a&&yU(r,f,s):o&&yU(r,f,s))}a&&yU(r,u.nullIdx,s)}(a,o,i),new VD(i,RU(a),r.rowCount(),r.colCount());switch(n){case 2:case 3:!function(e,t,r){var n=3==t.type,a=t.value,o=e.info,i=e.diff,u=o.values.length-1;if(u>=0){var s=ZD(o.values,a);for(s<0?s=-1-s:2===t.type&&(s+=1);s<=u;s++)yU(r,o.values[s].idx,i)}var l=a.isNumber()&&(0===a.getValue()&&n||a.getValue()<0),c=a.isString()&&""===a.getValue()&&n,h=a.isBool()&&!1===a.getValue()&&n;(l||c||h)&&yU(r,o.nullIdx,i)}(a,o,i);break;case 4:case 5:!function(e,t,r){var n=5===t.type,a=t.value,o=e.info,i=e.diff,u=0,s=ZD(o.values,a);for(s<0?s=-2-s:4===t.type&&(s-=1);u<=s;u++)yU(r,o.values[u].idx,i);var l=a.isNumber()&&(0===a.getValue()&&n||a.getValue()>0),c=a.isString()&&(""===a.getValue()&&n||""!==a.getValue()),h=a.isBool()&&(!1===a.getValue()&&n||!0===a.getValue());(l||c||h)&&yU(r,o.nullIdx,i)}(a,o,i);break;default:console.error("[SHEET LOG] unexpect matchType",n)}return new VD(i,RU(a),r.rowCount(),r.colCount())}}function kU(e,t,r,n,a,o,i){for(var u=null,s=[],l=[],c=0;c<t.length;c+=2){var h=t[c],f=$c(t[c+1],o,i);qa(f)&&(f=new it.NumberVar(0));var d=rU(e,f),v=wU(e,h,d);null===v?(s.push(d.match),l.push(h)):null===u?u=v.clone():u.intersect(v)}if(null===u){for(var p=0;p<r;p++)for(var m=0;m<n;m++)if(NU(s,l,p,m)){var g=a(p,m);if(g)return g}}else for(var y=0,_=u.toArray(),R=_.length;y<R;y++){var C=_[y],w=C/n|0,E=C%n|0;if(NU(s,l,w,E)){var k=a(w,E);if(k)return k}}}function TU(e,t,r){var n=IU(e,t),a=(0,g.Z)(n,2),o=a[0],i=a[1];if(1===o&&1===i)return r(0,0);for(var u=[],s=0;s<o;s++){u[s]=[];for(var l=0;l<i;l++)u[s][l]=r(s,l)}return new gs(u)}function SU(e,t,r,n,a){if(t.length%2!=0)return it.VALUE_ERR_VAR;for(var o=0;o<t.length;o+=2){var i=t[o];if(ja(i))return i;if(Qa(i))return Ol(e,o+a,"");if(r!==i.rowCount()||n!==i.colCount())return Al(e)}return null}function AU(e,t,r){for(var n=r.getRefCount(),a=0;a<t.length;a+=2){var o=t[a];if(!Qa(o))return Al(e);if(o.getRefCount()!==n)return Al(e);for(var i=0;i<n;i++){var u=r.getRefs()[i],s=o.getRefs()[i];if(!s||!u||ni(s)!==ni(u)||ai(s)!==ai(u))return Al(e)}}return null}function IU(e,t){for(var r=1,n=1,a=0;a<t.length;a+=2){var o=t[a+1];if(Ja(o))if(Ka(o)&&!e.isArray)o=Ds(o,e.ref);else{var i=o.rowCount(),u=o.colCount();r=Math.max(r,i),n=Math.max(n,u),1===i&&1===u&&(o=o.at(0,0))}qa(o)&&(o=new it.NumberVar(0)),t[a+1]=o}return[r,n]}function OU(e,t,r,n,a,o){var i=IU(e,r),u=(0,g.Z)(i,2),s=u[0],l=u[1];return 1!==s||1!==l?new bU(e,t,r,n,a,o,0,0,[],s,l).next():VU(e,t,r,n,a,o,0,0)}function VU(e,t,r,n,a,o,i,u){var s=new SB,l=t.getRef(),c=e.workbook.getSheetFromId(l.hostId),h=!1,f=[],d=kU(e,r,n,a,(function(t,r){var n=l.startRow+t,a=l.startCol+r;if(s.add(n,a,l.hostId,l.hostName),!h){var o=Oc(c.getVar(n,a));if(void 0!==o)return!e.skipRuntimeError&&ja(o)&&o.isRuntimeError()?o:void f.push(o);h=!0}}),i,u);if(d)return d;if(!h)return o(f);var v=s.getRanges();return new ks(v,[],{next:function(e){for(var t=[],r=0;r<e.length;r++)for(var n=e[r],a=n.rowCount(),i=n.colCount(),u=0;u<a;u++)for(var s=0;s<i;s++)t.push(n.at(u,s));return o(t)}})}function NU(e,t,r,n){for(var a=0;a<e.length;a++)if(!e[a].eq(t[a].at(r,n)))return!1;return!0}var bU=function(){function e(t,r,n,a,o,i,u,s,l,c,h){(0,y.Z)(this,e),this.ctx=t,this.unCalcGridVar=r,this.args=n,this.rowCount=a,this.colCount=o,this.callback=i,this.row=u,this.col=s,this.result=l,this.maxRow=c,this.maxCol=h}return(0,_.Z)(e,[{key:"next",value:function(){var e=this,t=function(t){return e.result[e.row]=e.result[e.row]||[],e.result[e.row][e.col]=t,e.col++,e.col===e.maxCol&&(e.col=0,e.row++),e.row===e.maxRow?new gs(e.result):new ks([],[],e)},r=VU(this.ctx,this.unCalcGridVar,this.args,this.rowCount,this.colCount,(function(r){return t(e.callback(r))}),this.row,this.col);return r instanceof ks||r instanceof gs?r:t(r)}}]),e}();function MU(e,t,r){var n=AU(r,t.slice(1),t[0]);if(n)return n;for(var a=0,o=function(r){for(var n=t[0].getGridRangeVar(r),o=n.rowCount(),i=n.colCount(),u=[],s=1;s<t.length;s++)s%2==1?u.push(t[s].getGridRangeVar(r)):u.push(t[s]);var l=TU(e,u,(function(t,r){var a=0;return kU(e,u,o,i,(function(e,t){var r=n.at(e,t);za(r)&&(a+=r.getValue())}),t,r)||new it.NumberVar(a)}));if(!za(l))return{v:l};a+=l.getValue()},i=0;i<t[0].getRefCount();i++){var u=o(i);if("object"===(0,R.Z)(u))return u.v}return new it.NumberVar(a)}function FU(e,t,r){var n=AU(r,t,t[0]);if(n)return n;for(var a=0,o=function(r){for(var n=t[0].getGridRangeVar(r),o=n.rowCount(),i=n.colCount(),u=[n],s=1;s<t.length;s++)s%2==0?u.push(t[s].getGridRangeVar(r)):u.push(t[s]);var l=TU(e,u,(function(t,r){var n=0;return kU(e,u,o,i,(function(){n++}),t,r),new it.NumberVar(n)}));if(!za(l))return{v:l};a+=l.getValue()},i=0;i<t[0].getRefCount();i++){var u=o(i);if("object"===(0,R.Z)(u))return u.v}return new it.NumberVar(a)}var ZU=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$cacheType=1,e.$$paramsDesc=[33,49,65],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(t[2]&&Qa(t[2])&&Qa(t[0]))return MU(e,[t[2],t[0],t[1]],this.name);if(Qa(t[0])){for(var r=t[0].getRefCount(),n=0,a=0;a<r;++a){var o=t[0].getGridRangeVar(a);if(o){if(t[2]&&(t[2].rowCount()!==o.rowCount()||t[2].colCount()!==o.colCount()))return Al(this.name);var i=xU(e,[o,t[1],t[2]]);if(!za(i))return i;n+=i.getValue()}}return new it.NumberVar(n)}if(t[2]&&Qa(t[2])){for(var u=t[2].getRefCount(),s=0,l=t[0].rowCount(),c=t[0].colCount(),h=0;h<u;++h){var f=t[2].getGridRangeVar(h);if(f){if(f.rowCount()!==l||f.colCount()!==c)return Al(this.name);var d=xU(e,[t[0],t[1],f]);if(!za(d))return d;s+=d.getValue()}}return new it.NumberVar(s)}return xU(e,t)}}]),t}(pw("SUMIF",2,1,0,Vd,[{type:Zd},{type:Nd|Vd|bd|Md},{type:Zd|Od,default:{ifInputNull:it.VALUE_ERR_VAR,ifNotInput:it.NULL_VAR}}]));function xU(e,t){var r=t[0],n=r.rowCount(),a=r.colCount(),o=t.slice(0,2),i=t[2]&&eo(t[2]);if(t[2]&&!i){if(qa(t[2]))return it.VALUE_ERR_VAR;var u=$s(e.workbook,t[2]);return u.rowCount()===n&&u.colCount()===a||kB(e,r,u.getRef()),OU(e,u,o,n,a,(function(e){for(var t=0,r=0;r<e.length;r++){var n=e[r];za(n)&&(t+=n.getValue())}return new it.NumberVar(t)}))}var s=i?t[2]:r;return TU(e,o,(function(t,r){var i=0;return kU(e,o,n,a,(function(e,t){var r=s.at(e,t);za(r)&&(i+=r.getValue())}),t,r)||new it.NumberVar(i)}))}var DU=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=Co,e.$$lazy=!1,e.$$cacheType=1,e.$$paramsDesc=[64,49],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(Qa(t[0]))return MU(e,t,this.name);var r=$s(e.workbook,t[0]),n=t.slice(1),a=r.rowCount(),o=r.colCount();return SU(this.name,n,a,o,2)||(eo(r)?TU(e,n,(function(t,i){var u=0;return kU(e,n,a,o,(function(e,t){var n=r.at(e,t);za(n)&&(u+=n.getValue())}),t,i)||new it.NumberVar(u)})):OU(e,r,n,a,o,(function(e){for(var t=0,r=0;r<e.length;r++){var n=e[r];za(n)&&(t+=n.getValue())}return new it.NumberVar(t)})))}}]),t}(pw("SUMIFS",3,256,2,Vd,[YE.MATRIX_AND_SHEET_REF,YE.MATRIX_AND_SHEET_REF,{type:Nd|Vd|bd|Md},YE.MATRIX_AND_SHEET_REF,{type:Nd|Vd|bd|Md}])),PU=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=4,e.$$lazy=!1,e.$$cacheType=0,e.$$paramsDesc=[239,32,32,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[0,0,1],n=1;n<t.length;++n){var a=Ds(t[n],e.ref);if(ja(a))return a;if(!qa(a)){var o=Zc(e.service,a.at(0,0));if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r[n-1]=Math.floor(o.getValue())}}var i=r[0],u=r[1],s=r[2];if(i<0||u<0){var l=i<0?2:3;return Ws(this.name,l)}if(s<=0)return Ks(this.name,s,4,1);var c=function(e,t){if(ro(e)){var r,n=1;return Qa(e)&&(n=(r=e.getRefs()).length),t>n?Ce.d$b[Ce.O6N.REF_PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO]({funcName:"INDEX",index:4,value:t,upperBound:n}):r?new Ss(r[t-1],e.caches[t-1]):e}return Ja(e)?t>1?Ce.d$b[Ce.O6N.REF_PARAMETER_SHOULD_BE_LESS_THAN_OR_EQUAL_TO]({funcName:"INDEX",index:4,value:t,upperBound:1}):e:qa(e)||function(e){return!!(128&e.$$type)}(e)?it.VALUE_ERR_VAR:e}(t[0],s);if(ja(c))return c.info&&(c.info.args.funcName=this.name,c.info.args.index=4),c;var h=c.rowCount(),f=c.colCount();if(t[2]||(1===h&&(u=i,i=1),1===f&&(u=1)),i>h||u>f){var d=3,v=u;return i>h&&(d=2,v=i),Ce.d$b[Ce.O6N.REF_OUT_OF_RANGE_PARAMETER]({funcName:this.name,index:d,value:v.toString()})}return ro(c)?0!==u||t[2]?function(e,t,r){var n=e.getRef();return new Fs(0===t&&0===r?n:0===t?new Qi(n.startRow,n.endRow,n.startCol+r-1,n.startCol+r,n.hostId,n.hostName):0===r?new Qi(n.startRow+t-1,n.startRow+t,n.startCol,n.endCol,n.hostId,n.hostName):new Qi(n.startRow+t-1,n.startRow+t,n.startCol+r-1,n.startCol+r,n.hostId,n.hostName))}(c,i,u):Ce.d$b[Ce.O6N.REF_RANGE_MUST_BE_SINGLE_ROW_OR_COLUMN]({funcName:this.name}):function(e,t,r,n){if(0===r&&0===n)return t;if(0===r){for(var a=[],o=0,i=t.rowCount();o<i;o++)a.push([t.at(o,n-1)]);return new gs(a)}if(0===n){for(var u=[],s=0,l=t.colCount();s<l;s++)u.push(t.at(r-1,s));return new gs([u])}return t.at(r-1,n-1)}(0,c,i,u)}}]),t}(pw("INDEX",2,2,0,Ud,[{type:Zd},{type:Vd,isMappable:!1},{type:Vd|Od,default:(qe={},(0,l.Z)(qe,it.DefaultParam.IfNotInput,it.NULL_VAR),(0,l.Z)(qe,it.DefaultParam.IfInputNull,new it.NumberVar(0)),qe),isMappable:!1},{type:Vd,default:new it.NumberVar(1),isMappable:!1}]));var $U,LU=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399,399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=xc(t[1],!0);if(!r)return Ce.d$b[Ce.O6N.INVALID_FORMAT_PATTERN]({funcName:this.name,code:El(t[1])});if(!Ba(t[0]))return Rl(this.name,1,El(t[0]),wl(t[0]),"".concat(Nd,",").concat(Vd));var n=t[0];Ga(n)&&(n=n.toStringVar());var a=n.getValue();if(Wa(n)){var o=n.toNumberVar(e.service);qa(o)||(a=o.getValue())}else qa(n)&&(a=0);var i=Ps(e.workbook,e.ref);if(!i)return it.VALUE_ERR_VAR;var u=r.getValue(),s=(0,Ee.createFormatter)(i.formatterService,u);return s.hasSyntaxError()?Ce.d$b[Ce.O6N.INVALID_FORMAT_PATTERN]({funcName:this.name,code:u}):new it.StringVar(s.format(a))}}]),t}(pw("TEXT",2,0,0,Vd,[{type:Vd|Nd|bd},{type:Nd|bd}])),BU=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$calcCustomData=function(){return{autoFormat:"hh:mm"}},e.$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue()),a=Math.floor(t[2].getValue());if(r<0||n<0||a<0){var o=r<0?1:n<0?2:3;return zs(this.name,o)}return new it.NumberVar(we.SheetDate.from({year:1899,month:12,date:30,hours:r,minutes:n,seconds:a}).toNumber()%1)}}]),t}(pw("TIME",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}]));function UU(e,t){var r=Ps(e.workbook,e.ref);if(!r)return null;var n=(0,Ee.getPreferredFormatter)(r.formatterService,t),a=n.formatter,o=n.value;if((0,Ee.isDateTimeFormatter)(a)&&o instanceof we.SheetDate){var i=o.toNumber();if(i>=we.SheetDate.MIN_DATE_VALUE&&i<=we.SheetDate.MAX_DATE_VALUE)return o}return null}function HU(e){var t=[];if("number"==typeof e)switch(e){case 1:t[6]=!0,t[0]=!0;break;case 2:t[0]=!0,t[1]=!0;break;case 3:t[1]=!0,t[2]=!0;break;case 4:t[2]=!0,t[3]=!0;break;case 5:t[3]=!0,t[4]=!0;break;case 6:t[4]=!0,t[5]=!0;break;case 7:t[5]=!0,t[6]=!0;break;case 11:t[0]=!0;break;case 12:t[1]=!0;break;case 13:t[2]=!0;break;case 14:t[3]=!0;break;case 15:t[4]=!0;break;case 16:t[5]=!0;break;case 17:t[6]=!0;break;default:return null}else{if(7!==e.length)return null;for(var r=0;r<7;r++){var n=6===r?0:r+1;switch(e[r]){case"0":t[n]=!1;break;case"1":t[n]=!0;break;default:return null}}}return t}function zU(e,t,r,n){if(n){if(Qa(n))return it.VALUE_ERR_VAR;if(Ja(n)&&1!==n.size()){var a=n.forEach((function(n){if(ja(n))return n;var a;if(za(n))a=n.getValue();else{if(!Wa(n))return qa(n)?void 0:Rl(t,3,El(n),wl(n),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var o=n.toNumberVar(e.service);if(qa(o))return Rl(t,3,n.getValue(),it.FormulaErrorPhrases.DATA_TYPE_STRING,it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);a=o.getValue()}if(a<0)return zs(t,3);r.add(Math.floor(a))}));if(a)return a}else{var o=Zc(e.service,n.at(0,0),!0);if(!o)return Rl(t,3,El(n.at(0,0)),wl(n.at(0,0)),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var i=Math.floor(o.getValue());if(i<0)return zs(t,3);r.add(i)}}}function WU(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return ug(sg(e.isNumber()?e.getCompareValue():e.getValue()),sg(t.isNumber()?t.getCompareValue():t.getValue()),r)}!function(e){e[e.Equal=0]="Equal",e[e.NotEqual=2]="NotEqual",e[e.LessThan=-1]="LessThan",e[e.GreaterThan=1]="GreaterThan"}($U||($U={}));var GU=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=UU(e,r);return n?new it.NumberVar(n.toNumber()%1):Ce.d$b[Ce.O6N.CANNOT_PARSE_TEXT_TO_DATE]({funcName:this.name,arg:r})}}]),t}(pw("TIMEVALUE",1,0,0,Vd,[{type:Nd}])),jU=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=0,e.$$maxOperands=0,e.$$lazy=!1,e.$$paramsDesc=[],e.$$calcCustomData=function(){return{autoFormat:"yyyy/mm/dd"}},e.alwaysCalc=!0,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"shouldMarkDirty",value:function(){return YU()!==t.todayCache}},{key:"func",value:function(){var e=YU();return t.todayCache=e,new it.NumberVar(e)}}]),t}(pw("TODAY",0,0,0,Vd,[]));function YU(){var e=we.SheetDate.fromLocalDate(new Date).toNumber();return Math.floor(e)}jU.todayCache=null;var qU=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=0,e.$$maxOperands=0,e.$$lazy=!1,e.$$paramsDesc=[],e.alwaysCalc=!0,e.$$calcCustomData=function(){return{autoFormat:"yyyy/mm/dd HH:mm"}},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(){var e=we.SheetDate.fromLocalDate(new Date);return new it.NumberVar(e.toNumber())}}]),t}(pw("NOW",0,0,0,Vd,[])),JU=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=5,e.$$lazy=!1,e.$$cacheType=0,e.$$paramsDesc=[64,32,32,33,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=function(e,t){if(to(t)){var r=t.getRef();if(r.endRow>=Fo||r.endCol>=Fo){var n=Ps(e,r);if(n)return new Fs(Ls(n,r))}}return t}(e.workbook,t[0]);if(Qa(r))return Ol(this.name,1,"");var n=r.getRef(),a=Ps(e.workbook,n);if(!a)return it.REF_ERR_VAR;for(var o=1;o<t.length;o++){var i=Ds(t[o],e.ref);if(!(o>2&&qa(i))){if(ja(i))return i;var u=Zc(e.service,i);if(!u)return Rl(this.name,o+1,El(i),wl(i),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);t[o]=u}}var s=n.startRow+t[1].getValue(),l=n.startCol+t[2].getValue(),c=t[3]&&za(t[3])?t[3].getValue():ni(n),h=t[4]&&za(t[4])?t[4].getValue():ai(n);if(0===c||0===h){var f=0===c?4:5;return Ce.d$b[Ce.O6N.REF_PARAMETER_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:this.name,index:f,value:0,lowerBound:1})}var d=a.getRowCount(),v=a.getColumnCount(),p=c<0?s+c+1:s,m=h<0?l+h+1:l,g=c<0?s+1:s+c,y=h<0?l+1:l+h;if(p<0||m<0||p>=g||m>=y||p>=d||m>=v)return Bl;var _=new Qi(p,Math.min(g,d),m,Math.min(y,v),n.hostId,n.hostName,n.status);return e.info&&(Array.isArray(e.info.customDepends)?e.info.customDepends.push(_):e.info.customDepends=[_]),new Fs(_)}}]),t}(pw("OFFSET",3,2,0,Zd,[{type:Zd},{type:Vd,isMappable:!1},{type:Vd,isMappable:!1},{type:Vd|Od,isMappable:!1,default:it.NULL_VAR},{type:Vd|Od,isMappable:!1,default:it.NULL_VAR}]));function KU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return zs(e,t)}var XU=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return KU(this.name);var n=we.SheetDate.fromNumber(r).date;return new it.NumberVar(n)}}]),t}(pw("DAY",1,0,0,Vd,[{type:Vd}])),QU=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return KU(this.name);var n=we.SheetDate.fromNumber(r).month;return new it.NumberVar(n)}}]),t}(pw("MONTH",1,0,0,Vd,[{type:Vd}])),eH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return KU(this.name);var n=we.SheetDate.fromNumber(r).year;return new it.NumberVar(n)}}]),t}(pw("YEAR",1,0,0,Vd,[{type:Vd}])),tH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return KU(this.name);var n=we.SheetDate.fromNumber(r).seconds;return new it.NumberVar(n)}}]),t}(pw("SECOND",1,0,0,Vd,[{type:Vd}])),rH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return KU(this.name);var n=we.SheetDate.fromNumber(r).minutes;return new it.NumberVar(n)}}]),t}(pw("MINUTE",1,0,0,Vd,[{type:Vd}])),nH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return KU(this.name);var n=we.SheetDate.fromNumber(r).hours;return new it.NumberVar(n)}}]),t}(pw("HOUR",1,0,0,Vd,[{type:Vd}])),aH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[2].getValue().toLocaleUpperCase(),n=Math.floor(t[0].getValue()),a=Math.floor(t[1].getValue());if(n<0||a<0){var o=n<0?1:2;return zs(this.name,o)}if(n>a){var i=Ps(e.workbook,e.ref);return i?rl(this.name,i,n,1,a,2):it.VALUE_ERR_VAR}var u=we.SheetDate.fromNumber(n).time,s=we.SheetDate.fromNumber(a).time;switch(r){case"Y":return new it.NumberVar(s.year-u.year+(s.month<u.month||s.month===u.month&&s.date<u.date?-1:0));case"M":return new it.NumberVar(12*(s.year-u.year)+(s.month-u.month)+(s.date<u.date?-1:0));case"D":return new it.NumberVar(a-n);case"MD":var l=s.date-u.date;return l+=l<0?(0,we.getDaysOfMonth)(s.year,s.month-1):0,new it.NumberVar(l);case"YM":var c=s.month-u.month;return c+=(c<0||0===c&&s.date<u.date?12:0)+(s.date<u.date?-1:0),new it.NumberVar(c);case"YD":if(3===s.month&&s.month>u.month&&s.date<u.date){var h=s.year;return h-=s.month<u.month||s.month===u.month&&s.date<u.date?1:0,new it.NumberVar((Date.UTC(s.year,s.month-1,s.date)-Date.UTC(h,u.month-1,u.date))/we.SheetDate.DAY_MILLISECONDS)}var f=u.year;return f+=s.month<u.month||s.month===u.month&&s.date<u.date?1:0,new it.NumberVar((Date.UTC(f,s.month-1,s.date)-Date.UTC(u.year,u.month-1,u.date))/we.SheetDate.DAY_MILLISECONDS);default:return function(e,t,r,n){return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_VALUE_NOT_IN_LIST]({funcName:e,index:t,value:r,validValues:Array.isArray(n)?n.join(", "):n})}(this.name,3,r,"'Y', 'M', 'D', 'MD', 'YM', 'YD',")}}}]),t}(pw("DATEDIF",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Nd}])),oH=qE(jE,Zd|Vd),iH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue());if(r<0||n<0){var a=n<0?1:2;return zs(this.name,a)}return new it.NumberVar(r-n)}}]),t}(pw("DAYS",2,0,0,Vd,[oH,oH])),uH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue()),a=!!t[2]&&t[2].getValue();if(r<0||n<0){var o=r<0?1:2;return zs(this.name,o)}return new it.NumberVar(function(e,t,r){var n=1,a=we.SheetDate.fromNumber(e).time,o=we.SheetDate.fromNumber(t).time;if(r&&t<e){var i=a;a=o,o=i,n=-1}var u=a.year,s=a.month,l=a.date,c=o.year,h=o.month,f=o.date,d=31,v=30;if(l===d)l-=1;else if(!r&&2===s)switch(l){case 28:(0,we.isLeapYear)(a.year)||(l=v);break;case 29:l=v}return f===d&&(r?f=v:l===v&&f--),n*(f-l+(h-s)*v+360*(c-u))}(r,n,a))}}]),t}(pw("DAYS360",2,1,0,Vd,[{type:Vd},{type:Vd},{type:bd,default:new it.BooleanVar(!1)}]));var sH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[239],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(!ro(r))return Rl(this.name,1,El(r),wl(r),it.FormulaErrorPhrases.DATA_TYPE_REFERENCE);if(0===r.size())return it.NA_ERR_VAR;var n=r.getRef(),a=Ps(e.workbook,n);if(!a)return it.REF_ERR_VAR;var o=Object.create(e);e.ref instanceof eu||(o.ref=Eu(e.ref,a));var i=a.getCalcEngine();if(e.isArray){for(var u=ni(n),s=ai(n),l=[],c=0;c<u;++c){var h=[];l.push(h);for(var f=0;f<s;++f){var d=a.getVar(n.startRow+c,n.startCol+f);h.push(d.isFormula()?new it.StringVar("=".concat(i.decompile(d,o))):Ce.d$b[Ce.O6N.INVALID_FORMULA_PARSED_RESULT]())}}return new gs(l)}var v=a.getVar(n.startRow,n.startCol);return v.isFormula()?new it.StringVar("=".concat(i.decompile(v,o))):Ce.d$b[Ce.O6N.INVALID_FORMULA_PARSED_RESULT]()}}]),t}(pw("FORMULATEXT",1,0,0,Nd,[YE.SHEET_REF]));var lH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=[],n=t[0].forEach((function(e){if(za(e))r.push(e.getValue());else if(ja(e))return e}));if(n)return n;if(!r.length)return new gs([[new it.NumberVar(0)],[new it.NumberVar(0)]]);var a=[];if(t[1].forEach((function(e){za(e)&&a.push(e.getValue())})),!a.length)return new gs([[new it.NumberVar(0)],[new it.NumberVar(r.length)]]);var o=function(e){var t=[],r=e.map((function(e,t){return{num:e,idx:t}})).sort((function(e,t){return e.num-t.num}));return r.forEach((function(e,n){var a=e.num,o=e.idx;t[o]=0===n?{end:a}:{end:a,start:r[n-1].num}})),t.push({start:r[r.length-1].num}),t}(a),i=new Array(o.length).fill(0);return r.forEach((function(e){var t=o.findIndex((function(t){var r=!0,n=!0;return"number"==typeof t.start&&(r=t.start<e),"number"==typeof t.end&&(n=t.end>=e),r&&n}));-1!==t&&i[t]++})),new gs(i.map((function(e){return[new it.NumberVar(e)]})))}}]),t}(pw("FREQUENCY",2,0,0,Zd|Vd,[{type:Zd},{type:Zd}]));lH=Vu([Cp("FREQUENCY")],lH);var cH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=0,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[64],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(!r){var n=e.ref;if(e.info){var a=n.clone();Array.isArray(e.info.customDepends)?e.info.customDepends.push(a):e.info.customDepends=[a]}var o=n.startRow;return new it.NumberVar(o+1)}if(Qa(r))return Vl(this.name,1,"");var i=r.getRef(),u=Ps(e.workbook,i);if(!u)return Vl(this.name,1,"");var s=Ls(u,i);if(!Ci(s))return Vl(this.name,1,"");var l=s.startRow;if(e.isArray){for(var c=[],h=0,f=ni(s);h<f;h++)c[h]=[new it.NumberVar(l+h+1)];return new gs(c)}return new it.NumberVar(l+1)}}]),t}(pw("ROW",0,1,0,Vd|Zd,[YE.SHEET_REF])),hH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[239],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(za(r)||qa(r))return new it.NumberVar(1);if(Qa(r))return Vl(this.name,1,"");if(!Ha(r))return Rl(this.name,1,El(r),wl(r),"".concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_REFERENCE));var n=r.getRef();if(n){var a=Ps(e.workbook,n);if(!a)return Vl(this.name,1,"");var o=$i(n,a);return new it.NumberVar(ni(o))}return new it.NumberVar(r.rowCount())}}]),t}(pw("ROWS",1,0,0,Vd,[{type:Zd|Nd|bd|Vd}])),fH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=0,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[64],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(!r){var n=e.ref;if(e.info){var a=n.clone();Array.isArray(e.info.customDepends)?e.info.customDepends.push(a):e.info.customDepends=[a]}var o=n.startCol;return new it.NumberVar(o+1)}if(Qa(r))return Vl(this.name,1,"");var i=r.getRef(),u=Ps(e.workbook,i);if(!u)return Vl(this.name,1,"");var s=Ls(u,i);if(!Ci(s))return Vl(this.name,1,"");var l=s.startCol;if(e.isArray){for(var c=[],h=0,f=ai(s);h<f;h++)c[h]=new it.NumberVar(l+h+1);return new gs([c])}return new it.NumberVar(l+1)}}]),t}(pw("COLUMN",0,1,0,Vd|Zd,[YE.SHEET_REF])),dH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[239],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=0;if(Qa(r))return Vl(this.name,1,"");if(ro(r)){var a=r.getRef(),o=Ps(e.workbook,a);if(!o)return Vl(this.name,1,"");n=ai($i(a,o))}else if(Ja(r))n=r.colCount();else{if(!za(r))return Rl(this.name,1,El(r),wl(r),"".concat(it.FormulaErrorPhrases.DATA_TYPE_REFERENCE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));n=1}return new it.NumberVar(n)}}]),t}(pw("COLUMNS",1,0,0,Vd,[{type:Zd|Nd|bd|Vd}])),vH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$cacheType=1,e.$$paramsDesc=[49],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(Qa(t[0]))return FU(e,t,this.name);var r=t[0].rowCount(),n=t[0].colCount();return SU(this.name,t,r,n,1)||TU(e,t,(function(a,o){var i=0;return kU(e,t,r,n,(function(){i++}),a,o),new it.NumberVar(i)}))}}]),t}(pw("COUNTIFS",2,256,2,Vd,[YE.MATRIX_AND_SHEET_REF,{type:Vd|Nd|bd|Md},{type:Zd},{type:Vd|Nd|bd|Md}])),pH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$cacheType=1,e.$$paramsDesc=[33,49,64],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=this;if(Qa(t[0]))return Ol(this.name,1,"");if(t[2]&&Qa(t[2]))return Ol(this.name,3,"");var n=t[0].rowCount(),a=t[0].colCount(),o=t.slice(0,2),i=t[2]&&eo(t[2]);if(t[2]&&!i){var u=$s(e.workbook,t[2]);return u.rowCount()===n&&u.colCount()===a||kB(e,t[0],u.getRef()),OU(e,u,o,n,a,(function(e){for(var t=0,n=0,a=0;a<e.length;a++){var o=e[a];za(o)&&(t+=o.getValue(),n++)}return 0===n?Hl(r.name):new it.NumberVar(t/n)}))}var s=i?t[2]:t[0];return TU(e,o,(function(t,i){var u=0,l=0,c=kU(e,o,n,a,(function(e,t){var r=s.at(e,t);za(r)&&(u+=r.getValue(),l++)}),t,i);return c||(0===l?Hl(r.name):new it.NumberVar(u/l))}))}}]),t}(pw("AVERAGEIF",2,1,0,Vd,[{type:Zd},{type:Nd|Vd|bd|Md},{type:Zd|Od,default:{ifInputNull:it.VALUE_ERR_VAR,ifNotInput:it.NULL_VAR}}])),mH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=Co,e.$$lazy=!1,e.$$cacheType=1,e.$$paramsDesc=[64,49],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=this;if(!ro(t[0]))return Sl(this.name,1);if(Qa(t[0]))return Ol(this.name,1,"");var n=$s(e.workbook,t[0]),a=t.slice(1),o=n.rowCount(),i=n.colCount();return SU(this.name,a,o,i,2)||(eo(n)?TU(e,a,(function(t,u){var s=0,l=0,c=kU(e,a,o,i,(function(e,t){var r=n.at(e,t);za(r)&&(s+=r.getValue(),l++)}),t,u);return c||(0===l?Hl(r.name):new it.NumberVar(s/l))})):OU(e,n,a,o,i,(function(e){for(var t=0,n=0,a=0;a<e.length;a++){var o=e[a];za(o)&&(t+=o.getValue(),n++)}return 0===n?Hl(r.name):new it.NumberVar(t/n)})))}}]),t}(pw("AVERAGEIFS",3,256,2,Vd,[YE.MATRIX_AND_SHEET_REF,YE.MATRIX_AND_SHEET_REF,{type:Nd|Vd|bd|Md},YE.MATRIX_AND_SHEET_REF,{type:Nd|Vd|bd|Md}])),gH=[1,2,3,4],yH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258,258,259,265,261],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue()),a=t[2]&&t[2].isNumber()?t[2].getValue():1;if(r!=r||n!=n)return it.VALUE_ERR_VAR;if(r<1||r>No)return gl(this.name,1,r,1,No);if(n<1||n>bo)return gl(this.name,2,r,1,bo);if(!gH.includes(a))return gl(this.name,3,r,gH[0],gH[gH.length-1]);var o=!t[3]||!Ga(t[3])||t[3].getValue(),i="";return t[4]&&!qa(t[4])&&(i=Bo(t[4].getValue())+"!"),i+=o?(1&a?"$":"")+(0,Ce.hdC)(n-1)+(a<3?"$":"")+r:"R"+(a<3?r:"["+r+"]")+"C"+(1&a?n:"["+n+"]"),new it.StringVar(i)}}]),t}(pw("ADDRESS",2,3,0,Ud,[{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(1)},{type:bd,default:new it.BooleanVar(!0)},{type:Nd|Od}])),_H=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;++r)if(qa(t[r]))return it.NA_ERR_VAR;var n=Math.floor(t[0].getValue()),a=t[1].getValue();if(a=a<0?Math.ceil(a):Math.floor(a),n<0)return zs(this.name,1);var o=function(e,t){var r=we.SheetDate.fromNumber(e),n=r.year,a=r.month,o=r.date,i=(0,we.getDaysOfMonth)(n,a+t);return we.SheetDate.from({year:n,month:a+t,date:Math.min(o,i)}).toNumber()}(n,a);return o<0?Dl(this.name,o,0):new it.NumberVar(o)}}]),t}(pw("EDATE",2,0,0,Vd,[{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:it.NA_ERR_VAR}]));var RH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=t[1].getValue();if(n=n<0?Math.ceil(n):Math.floor(n),r<0)return it.NUM_ERR_VAR;var a=function(e,t){var r=we.SheetDate.fromNumber(e),n=r.year,a=r.month,o=(0,we.getDaysOfMonth)(n,a+t);return we.SheetDate.from({year:n,month:a+t,date:o}).toNumber()}(r,n);return a<0?it.NUM_ERR_VAR:new it.NumberVar(a)}}]),t}(pw("EOMONTH",2,0,0,Vd,[{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:it.NA_ERR_VAR}]));var CH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ds(t[0],e.ref);if(ja(r))return r;var n=xc(r);if(!n)return Rl(this.name,1,El(r),wl(r),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN);var a=n.getValue(),o=!0;if(t[1]){var i=Ds(t[1],e.ref);if(ja(i))return i;var u=Dc(i);if(!u)return Rl(this.name,2,El(i),wl(i),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN);o=u.getValue()}var s=e.workbook,l=e.ref,c=Ps(s,l);if(!c)return Vl(this.name,-1,"");var h=ad(a,{ref:l instanceof eu?l:Eu(l,c),refStyle:o?"A1":"R1C1",spread:s});return h&&h.isRef()?(Array.isArray(e.info.customDepends)?e.info.customDepends.push(h):e.info.customDepends=[h],new Fs(h)):it.REF_ERR_VAR}}]),t}(pw("INDIRECT",1,1,0,Ud,[{type:Nd,isMappable:!1},{type:bd,isMappable:!1,default:new it.BooleanVar(!0)}])),wH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,259,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=TL.apply(void 0,(0,m.Z)(t));if(r.err)return SL(r.err,this.name,t[0],t[1],e);var n=t[3]?t[3].getValue():0,a=t[0].getValue(),o=r.start.toNumber(),i=b$(o<0?0:o,a,n);return null===i?it.NUM_ERR_VAR:new it.NumberVar(i.duration)}}]),t}(pw("COUPDAYBS",3,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:new it.NumberVar(0)}])),EH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,259,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=kL(t[0].getValue(),t[1].getValue(),t[2].getValue(),null===(r=t[3])||void 0===r?void 0:r.getValue());if(n.err)return SL(n.err,this.name,t[0],t[1],e);var a=n.basis,o=n.frequency;if(0===a||2===a||4===a)return new it.NumberVar(12/o*30);if(3===a)return new it.NumberVar(12/o*(365/12));var i=gL(n.settlement,n.maturity,o),u=i.start,s=i.end;s.date>u.date&&u.toNumber()>0&&s.setDateTime({date:u.date});var l=b$(u.toNumber(),s.toNumber(),a);return null===l?it.NUM_ERR_VAR:new it.NumberVar(l.duration)}}]),t}(pw("COUPDAYS",3,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:new it.NumberVar(0)}])),kH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,259,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=TL.apply(void 0,(0,m.Z)(t));if(r.err)return SL(r.err,this.name,t[0],t[1],e);var n=t[3]?t[3].getValue():0,a=b$(t[0].getValue(),r.end.toNumber(),n);return null===a?it.NUM_ERR_VAR:new it.NumberVar(a.duration)}}]),t}(pw("COUPDAYSNC",3,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:new it.NumberVar(0)}])),TH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,259,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=TL.apply(void 0,(0,m.Z)(t));return r.err?SL(r.err,this.name,t[0],t[1],e):new it.NumberVar(r.end.toNumber())}}]),t}(pw("COUPNCD",3,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:new it.NumberVar(0)}])),SH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,259,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=TL.apply(void 0,(0,m.Z)(t));return r.err?SL(r.err,this.name,t[0],t[1],e):r.start.toNumber()<0?Dl(this.name,r.start.toNumber(),0):new it.NumberVar(r.count)}}]),t}(pw("COUPNUM",3,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:new it.NumberVar(0)}])),AH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=[];if(qa(t[2]))return it.NA_ERR_VAR;for(var n=0;n<t.length;n++){var a=t[n],o=Zc(e.service,a,!0);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r.push(o)}r.length<4&&r.push(new it.NumberVar(0));var i=TL.apply(void 0,r);if(i.err)return SL(i.err,this.name,r[0],r[1],e);var u=i.start.toNumber();return new it.NumberVar(u<0?0:u)}}]),t}(pw("COUPPCD",3,1,0,Vd,[{type:Vd|bd},{type:Vd|bd},{type:Vd|bd,default:it.NA_ERR_VAR},{type:Vd|bd,default:new it.NumberVar(0)}])),IH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=6,e.$$maxOperands=6,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0].getValue(),a=t[1].getValue(),o=t[2].getValue(),i=t[3].getValue(),u=t[4].getValue(),s=t[5].getValue();if(n<=0)return Js(this.name,n,1,0);if(a<=0)return Js(this.name,a,2,0);if(a>999)return el(this.name,a,2,999);if(o<=0)return Js(this.name,o,2,0);if(i<1)return Qs(this.name,i,4,1);if(i>a)return el(this.name,i,4,a);if(u<1)return Qs(this.name,u,5,1);if(u>a)return el(this.name,u,5,a);if(i>u)return Qs(this.name,u,5,i);var l=s?fx.Begin:fx.End;for(r=0;i<u+1;i++)r+=vx(n,i,a,o,0,l);return new it.NumberVar(r)}}]),t}(pw("CUMIPMT",6,0,0,Vd,[{type:Vd,default:new it.NumberVar(0)},{type:Vd,default:new it.NumberVar(0)},{type:Vd,default:new it.NumberVar(0)},{type:Vd,default:new it.NumberVar(0)},{type:Vd,default:new it.NumberVar(0)},{type:bd,default:new it.BooleanVar(!1)}])),OH=function(e,t,r){if(0>e)return zs(r,1);if(1>t)return Qs(r,t,2,1);if(1e10<t)return el(r,t,2,1e10);var n=1-iZ(e,Math.floor(t)/2,2);return new it.NumberVar(n)};function VH(e,t,r){var n;return n=0===e?Ys:new it.NumberVar(function(e,t,r){var n,a,o,i=-1022,u=1023,s=Math.pow(2,i),l=Math.pow(2,u);if(t>=OH(s,e,r).getValue())n=0,a=s;else if(t<OH(l,e,r).getValue())n=0,a=Number.MAX_VALUE;else{for(;i+1<u;){var c=i+Math.floor((u-i)/2),h=Math.pow(2,c);OH(h,e,r).getValue()<=t?u=c:i=c}n=Math.pow(2,i),a=Math.pow(2,u)}for(var f=0;n<a&&f<100;f++){var d=n+(a-n)/2,v=OH(d,e,r).getValue();if(v<=t){if(a===d){var p=OH(n,e,r).getValue();o=Math.abs(p-t)<Math.abs(v-t)?n:d;break}a=d}else{if(n===d){var m=OH(a,e,r).getValue();o=Math.abs(m-t)<Math.abs(v-t)?a:d;break}n=d}o=d}return o}(t,e,r)),n}var NH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();return OH(r,n,this.name)}}]),t}(pw("CHIDIST",2,0,0,Vd,[{type:Vd},{type:Vd}])),bH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CHISQ.DIST.RT",e}return(0,p.Z)(t,e),t}(NH),MH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();if(0>r)return zs(this.name,1);if(1<r)return el(this.name,r,1,1);if(1>n)return Qs(this.name,n,2,1);if(1===r)return new it.NumberVar(0);var a=uZ(1-r,.5*Math.floor(n),2);return a===1/0?Ys:new it.NumberVar(a)}}]),t}(pw("CHIINV",2,0,0,Vd,[{type:Vd},{type:Vd}])),FH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CHISQ.INV.RT",e}return(0,p.Z)(t,e),t}(MH);var ZH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,265],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=!(!t[2]||!Ga(t[2]))&&t[2].getValue();if(0>r)return zs(this.name,1);if(1>n)return Qs(this.name,n,2,1);if(1e10<n)return el(this.name,n,2,1e10);var o=a?iZ(r,Math.floor(n)/2,2):function(e,t){return e<0?0:0===e&&2===t?.5:Math.exp((t/2-1)*Math.log(e)-e/2-t/2*Math.log(2)-aZ(t/2))}(r,Math.floor(n));return new it.NumberVar(o)}}]),t}(pw("CHISQ.DIST",3,0,0,Vd,[{type:Vd},{type:Vd},{type:bd,default:new it.BooleanVar(!1)}])),xH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1],a=[r.rowCount(),r.colCount()],o=a[0],i=a[1],u=[n.rowCount(),n.colCount()];if(o!==u[0]||i!==u[1])return Il(this.name);for(var s=0,l=0;l<o;l++)for(var c=0;c<i;c++){var h=r.at(l,c);if(ja(h))return h;var f=n.at(l,c);if(ja(f))return f;if(za(h)&&za(f)){var d=h.getValue(),v=f.getValue();if(0===v)return Hl(this.name);s+=(d-v)*(d-v)/v}}return OH(s,Math.imul(Math.max(1,o-1|0),Math.max(1,i-1|0)),this.name)}}]),t}(pw("CHITEST",2,0,0,Vd,[{type:Zd},{type:Zd}])),DH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();return 0>r?zs(this.name,1):1<r?el(this.name,r,1,1):1>n?Qs(this.name,n,2,1):VH(1-r,Math.floor(n),this.name)}}]),t}(pw("CHISQ.INV",2,0,0,Vd,[{type:Vd},{type:Vd}])),PH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CHISQ.TEST",e}return(0,p.Z)(t,e),t}(xH),$H=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n].getValue();if(a<=0)return Js(this.name,a,n+1,0);r.push(a)}var o=(Math.log(r[2])-Math.log(r[1]))/Math.log(1+r[0]);return new it.NumberVar(o)}}]),t}(pw("PDURATION",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),LH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<4;++r)if(qa(t[r]))return it.NA_ERR_VAR;var n,a,o=function(e,t){var r=e.getValue(),n=t.getValue(),a=E$(r,n);return a.isValid?{settlement:we.SheetDate.fromNumber(r),maturity:we.SheetDate.fromNumber(n)}:{err:a.err}}(t[0],t[1]);if(o.err)return(null===(a=o.err.info)||void 0===a||null===(n=a.args)||void 0===n?void 0:n.hasOwnProperty("funcName"))&&(o.err.info.args.funcName=this.name),o.err;var i=Math.floor(o.settlement.toNumber()),u=Math.floor(o.maturity.toNumber()),s=t[2].getValue(),l=t[3].getValue(),c=t[4]&&za(t[4])?Math.floor(t[4].getValue()):0;if(s<=0||l<=0){var h=l,f=2;return s<=0&&(h=s,f=1),Js(this.name,h,f,0)}if(!CL(c))return Gs(this.name,5,c,0,4);var d=b$(i,u,c);if(null==d)return Gs(this.name,5,c,0,4);var v=d.duration,p=d.total;return new it.NumberVar((l-s)/l*(p/v))}}]),t}(pw("DISC",4,1,0,Vd,[{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:new it.NumberVar(0)}])),BH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[399,111,111],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(!Ba(t[0]))return Rl(this.name,1,El(t[0]),wl(t[0]),"".concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_STRING,",").concat(it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN));var r=qa(t[0])?new it.NumberVar(0):t[0],n=t[1];if(Qa(n))return Nl(this.name,2,"");to(n)&&(n=$s(e.workbook,n));var a=t[2];if(a){if(Qa(n))return Nl(this.name,3,"");if(to(a)&&(a=$s(e.workbook,a)),a.rowCount()>1&&a.colCount()>1)return Kl(this.name)}var o=n.colCount()>n.rowCount();return Q$(e,n,new UH(o,D$.BinaryAscending,this.name,r,n,a||n,x$.Smaller))}}]),t}(pw("LOOKUP",2,1,0,Nd,[{type:Nd|Vd|bd},{type:Zd},{type:Zd|Od,default:it.NULL_VAR}]));BH=Vu([Cp("LOOKUP")],BH);var UH=function(e){function t(e,r,n,a,o,i,u){var s;return(0,y.Z)(this,t),(s=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r,n,a,o,u))).searchRef=i,s}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getResult",value:function(e,t){var r=this.searchRef.rowCount(),n=this.searchRef.colCount();return Math.floor(t/Math.min(r,n))>=r*n?Ce.d$b[Ce.O6N.OUT_OF_RANGE_FUNCTION]({funcName:this.name,rowOrCol:this.isHorizontal?it.FormulaErrorPhrases.DIMENSION_COLUMN:it.FormulaErrorPhrases.DIMENSION_ROW,value:t+1}):r>=n?K$(e,this.searchRef,t,n-1):K$(e,this.searchRef,r-1,t)}}]),t}(W$),HH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r,n=0;n<t.length;++n){var a=t[n];Ba(a)&&(a=Zc(e.service,a)||Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));var o=a.forEach((function(e){if(Ua(e)){var t=za(e)?e.getValue():Wa(e)?0:e.getValue()?1:0;(null==r||t>r)&&(r=t)}else if(ja(e))return e}));if(o)return o}return new it.NumberVar(r||0)}}]),t}(pw("MAXA",1,256,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),zH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=5,e.$$maxOperands=6,e.$$lazy=!1,e.$$paramsDesc=[259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0,n=Math.min(t.length,5);r<n;r++)if(qa(t[r]))return Ml(this.name,r+1);var a=Math.trunc(t[0].getValue()),o=Math.trunc(t[1].getValue()),i=t[2].getValue(),u=t[3].getValue(),s=Math.trunc(t[4].getValue()),l=t[5]&&za(t[5])?Math.trunc(t[5].getValue()):0,c=function(e,t,r,n,a,o,i){return r<0||n<0?{err:zs(i,r<0?3:4)}:kL(e,t,a,o,5)}(a,o,i,u,s,l,this.name);return c.err?SL(c.err,this.name,t[0],t[1],e):this.getCouponDurationResult(a,o,i,u,s,l)}}]),t}(pw("",5,1,0,Vd,[{type:Vd|Od},{type:Vd|Od},{type:Vd|Od},{type:Vd|Od},{type:Vd|Od},{type:Vd,default:new it.NumberVar(0)}]));var WH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MDURATION",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getCouponDurationResult",value:function(e,t,r,n,a,o){var i=AL(e,t,r,n,a,o);return new it.NumberVar(i/(1+n/a))}}]),t}(zH),GH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DURATION",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getCouponDurationResult",value:function(e,t,r,n,a,o){var i=AL(e,t,r,n,a,o);return new it.NumberVar(i)}}]),t}(zH),jH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r,n=0;n<t.length;++n){var a=t[n];if(ja(a))return a;Ba(a)&&(a=Zc(e.service,a)||Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));var o=a.forEach((function(e){if(Ua(e)){var t=za(e)?e.getValue():Wa(e)?0:e.getValue()?1:0;(null==r||t<r)&&(r=t)}else if(ja(e))return e}));if(o)return o}return new it.NumberVar(r||0)}}]),t}(pw("MINA",1,256,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),YH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=6,e.$$maxOperands=7,e.$$lazy=!1,e.$$paramsDesc=[259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<6;++r)if(qa(t[r]))return Ml(this.name,r+1);var n=Math.trunc(t[0].getValue()),a=Math.trunc(t[1].getValue()),o=t[2].getValue(),i=t[3].getValue(),u=t[4].getValue(),s=Math.trunc(t[5].getValue()),l=t[6]&&za(t[6])?Math.trunc(t[6].getValue()):0,c=function(e,t,r,n,a,o,i,u){return n<0||a<0?{err:zs(e,n<0?3:4)}:o<=0?{err:Js(e,o,5,0)}:kL(t,r,i,u,6)}(this.name,n,a,o,i,u,s,l);return c.err?SL(c.err,this.name,t[0],t[1],e):new it.NumberVar(qH(n,a,o,i,u,s,l,c))}}]),t}(pw("PRICE",6,1,0,Vd,[{type:Vd|Od},{type:Vd|Od},{type:Vd|Od},{type:Vd|Od},{type:Vd|Od},{type:Vd|Od},{type:Vd,default:new it.NumberVar(0)}]));function qH(e,t,r,n,a,o,i,u){var s=gL(we.SheetDate.fromNumber(e),we.SheetDate.fromNumber(t),o),l=b$(e,s.end.toNumber(),i).duration,c=IL(u),h=s.start.toNumber(),f=b$(h<0?0:h,e,i).duration,d=s.count;if(1===d)return(100*r/o+a)/(n/o*(c-f)/c+1)-100*r/o*f/c;for(var v=a/Math.pow(1+n/o,d-1+l/c),p=0,m=1;m<=d;m++)p+=100*r/o/Math.pow(1+n/o,m-1+l/c);return v+p-r/o*100*(f/c)}var JH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<4;++r)if(qa(t[r]))return Ml(this.name,r+1);var n=Math.trunc(t[0].getValue()),a=Math.trunc(t[1].getValue()),o=t[2].getValue(),i=t[3].getValue(),u=t[4]&&za(t[4])?Math.trunc(t[4].getValue()):0,s=function(e,t,r,n,a,o){return n<=0||a<=0?{err:Js(e,n<=0?n:a,n<=0?3:4,0)}:kL(t,r,1,o,4)}(this.name,n,a,o,i,u);if(s.err)return SL(s.err,this.name,t[0],t[1],e);var l=b$(n,a,u).value;return new it.NumberVar(i-o*i*l)}}]),t}(pw("PRICEDISC",4,1,0,Vd,[{type:Vd|Od},{type:Vd|Od},{type:Vd|Od},{type:Vd|Od},{type:Vd,default:new it.NumberVar(0)}]));var KH=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=1,n=new Map,a=0;a<t.length;++a){var o=t[a];if(ja(o))return o;if(Ba(o))o=Zc(e.service,o)||Rl(this.name,a+1,El(o),wl(o),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);else if(1===o.size()&&qa(o.at(0,0)))return Ql(this.name);var i=o.forEach((function(e){if(za(e)){var t=e.getValue();if(n.has(t)){var a=n.get(t)+1;r<a&&(r=a),n.set(t,a)}else n.set(t,1)}else if(ja(e))return e}));if(i)return i}if(1===r)return ec(this.name);var u,s=[],l=yr(n.keys());try{for(l.s();!(u=l.n()).done;){var c=u.value;n.get(c)===r&&s.push([new it.NumberVar(c)])}}catch(e){l.e(e)}finally{l.f()}return new gs(s)}}]),t}(pw("MODE.MULT",1,256,1,Zd,[{type:Vd|Zd},{type:Vd|Zd}]));function XH(e,t,r,n,a){var o=!1,i=0,u=0;return{err:t.forEach((function(e){if(za(e)){var t=e.getCompareValue();if(t===r)u+=Number(o),o=!0;else{var a=t>r;i+=Number(n?a:!a)}}else if(ja(e))return e})),exist:o,rankNum:a?i+1+u/2:i+1}}var QH,ez=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,32,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getCompareValue(),n=!t[2]||!1===t[2].getValue(),a=XH(0,t[1],r,n,!1);return a.err||(a.exist?new it.NumberVar(a.rankNum):Yl(this.name))}}]),t}(pw("RANK",2,1,0,Vd,[{type:Vd},{type:Zd},{type:bd,default:new it.BooleanVar(!1)}])),tz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[260,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();return n<0?Ws(this.name,2):!Number.isFinite(n)||r.length*n>it.MAX_CALC_RESULT_STRING_LENGTH?it.tractorErrorVarCreators[it.ErrorCode.TEXT_TOO_LONG]({funcName:this.name,maxCalcResultTextLength:it.MAX_CALC_RESULT_STRING_LENGTH}):new it.StringVar(r.repeat(n))}}]),t}(pw("REPT",2,0,0,Nd,[{type:Nd},{type:Vd}]));function rz(e,t,r,n){for(;r-t>1;){var a=Math.floor((r+t)/2),o=n[a];if(o>e)r=a;else{if(!(o<e))return a;t=a}}return t!==r&&n[r]<=e?r:t}!function(e){e[e.I=1]="I",e[e.IV=4]="IV",e[e.V=5]="V",e[e.IX=9]="IX",e[e.X=10]="X",e[e.XL=40]="XL",e[e.VL=45]="VL",e[e.IL=49]="IL",e[e.L=50]="L",e[e.XC=90]="XC",e[e.VC=95]="VC",e[e.IC=99]="IC",e[e.C=100]="C",e[e.CD=400]="CD",e[e.LD=450]="LD",e[e.XD=490]="XD",e[e.VD=495]="VD",e[e.ID=499]="ID",e[e.D=500]="D",e[e.CM=900]="CM",e[e.LM=950]="LM",e[e.XM=990]="XM",e[e.VM=995]="VM",e[e.IM=999]="IM",e[e.M=1e3]="M"}(QH||(QH={}));var nz=[[1,4,5,9,10,40,50,90,100,400,500,900,1e3,4e3],[1,4,5,9,10,40,45,50,90,95,100,400,450,500,900,950,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,500,900,950,990,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,500,900,950,990,995,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,499,500,900,950,990,995,999,1e3,4e3]],az=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=0;if(t[1])if(Ga(t[1]))r=t[1].getValue()?0:4;else{var n=Zc(e.service,t[1]);if(!n)return Rl(this.name,2,El(t[1]),wl(t[1]),"".concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN));r=Math.floor(n.getValue())}var a=Math.floor(t[0].getValue());if(a<0||a>=4e3)return gl(this.name,1,a,0,3999);if(r<0||r>4)return gl(this.name,2,r,0,4);for(var o=nz[r],i=o.length-1,u=[];a>0;){var s=o[i=rz(a,0,i,o)];a-=s,u.push(QH[s])}return new it.StringVar(u.join(""))}}]),t}(pw("ROMAN",1,1,0,Nd,[{type:Vd},{type:Vd|bd,default:new it.NumberVar(0)}])),oz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[255],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=this,n=t[0];if(ro(n)){if(Qa(n))n=it.VALUE_ERR_VAR;else if(to(n))return Zs(t,(function(t){return r.func(e,t)}));if(e.isArray){for(var a=n.rowCount(),o=n.colCount(),i=[],u=0;u<a;++u){var s=[];i.push(s);for(var l=0;l<o;++l)s.push(iz(n.at(u,l)))}return new gs(i)}var c=n.size();1===c?n=n.at(0,0):c<1&&(n=it.REF_ERR_VAR)}return iz(n)}}]),t}(pw("TYPE",1,0,0,Vd,[qE(GE,Bd&~Od|Ld)]));function iz(e){switch(e.$$type){case 2:case 1:return new it.NumberVar(1);case 4:return new it.NumberVar(2);case 8:return new it.NumberVar(4);case 16:return new it.NumberVar(16);case 2176:case 1152:return new it.NumberVar(128);default:return Ja(e)?new it.NumberVar(64):it.VALUE_ERR_VAR}}var uz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[399,111,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(!Ba(t[0]))return Rl(this.name,1,El(t[0]),wl(t[0]),"".concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_STRING,",").concat(it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN));var r=qa(t[0])?new it.NumberVar(0):t[0],n=t[1];to(n)&&(n=$s(e.workbook,n));var a=Math.floor(t[2].getValue()),o=!t[3]||!qa(t[3])&&t[3].getValue();if(a<0)return Qs(this.name,a,3,0);if(a>n.rowCount())return function(e){return Ce.d$b[Ce.O6N.REFERENCE_OUT_OF_BOUNDS]({funcName:e})}(this.name);var i=new G$(!0,o?D$.BinaryAscending:D$.Sequence,this.name,r,n,a-1,o?x$.Smaller:x$.Wildcard);return o?Q$(e,n,i):j$(e,n,i)}}]),t}(pw("HLOOKUP",3,1,0,Nd,[{type:Nd|Vd|bd,default:new it.NumberVar(0)},{type:Zd},{type:Vd},{type:bd,default:(Je={},(0,l.Z)(Je,it.DefaultParam.IfInputNull,new it.BooleanVar(!1)),(0,l.Z)(Je,it.DefaultParam.IfNotInput,new it.BooleanVar(!0)),Je)}])),sz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=0;return t[0].forEach((function(e){(qa(e)||Wa(e)&&!e.getValue())&&++r})),new it.NumberVar(r)}}]),t}(pw("COUNTBLANK",1,0,0,Vd,[{type:Zd},{type:Zd}])),lz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!0,e.$$expanded=!0,e.$$paramsDesc=[415,3327],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];return qa(r)?new it.NumberVar(0):ja(r)&&r.errorType===it.NA_ERR_VAR.errorType?t[1]:r}}]),t}(pw("IFNA",2,0,0,Fd,[{type:Fd},{type:Fd}])),cz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(ja(t[0]))}}]),t}(pw("ISERROR",1,0,0,bd,[{type:Bd}])),hz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(qa(t[0]))}}]),t}(pw("ISBLANK",1,0,0,bd,[{type:Bd}])),fz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[64],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getRef(),n=Ps(e.workbook,r);if(n){if(e.isArray){for(var a=[],o=r.endRow,i=r.endCol,u=r.startRow;u<o;++u){for(var s=[],l=r.startCol;l<i;++l)s.push(new it.BooleanVar(n.getVar(u,l).isFormula()));a.push(s)}return new gs(a)}return new it.BooleanVar(n.getVar(r.startRow,r.startCol).isFormula())}return new it.BooleanVar(!1)}}]),t}(pw("ISFORMULA",1,0,0,bd,[{type:Ud|Bd}])),dz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[255],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(to(t[0])||Qa(t[0]))}}]),t}(pw("ISREF",1,0,0,bd,[{type:Bd|Zd|xd}])),vz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();if(r<0||n<0)return zs(this.name,r<0?1:2);if(r>=n)return Ce.d$b[Ce.O6N.NUM_SETTLEMENT_DATE_NOT_BEFORE_MATURITY_DATE]({funcName:this.name,settlementDate:w$(r),maturityDate:w$(n)});var a=t[2].getValue(),o=t[3].getValue();if(a<=0||o<=0)return Js(this.name,a<=0?a:o,a<=0?3:4,0);var i=t[4]?Math.trunc(t[4].getValue()):0;if(i<0||i>4)return Gs(this.name,5,i,0,4);var u=(o-a)/a,s=b$(r,n,i),l=u*(s.total/s.duration);return new it.NumberVar(l)}}]),t}(pw("INTRATE",4,1,0,Vd,[{type:Vd|bd},{type:Vd|bd},{type:Vd|bd},{type:Vd|bd},{type:Vd|bd,default:new it.NumberVar(0)}])),pz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return mz(e,this.name,t[0],t[1],t[2],Z$)}}]),t}(pw("NETWORKDAYS",2,1,0,Vd,[{type:Vd},{type:Vd},{type:Zd|Vd|bd}]));function mz(e,t,r,n,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Z$,i=Math.floor(r.getValue()),u=Math.floor(n.getValue()),s=new Set;if(i<0||u<0)return zs(t,i<0?1:2);var l=zU(e,t,s,a);if(l)return l;var c=i>u;if(c){var h=i;i=u,u=h}var f=gz(i,u,o);return s.forEach((function(e){var t=M$(e);e>=i&&e<=u&&!o[t]&&f--})),new it.NumberVar((c?-1:1)*f)}function gz(e,t,r){for(var n=t-e+1,a=Math.floor(n/7),o=n%7,i=7,u=0;u<7;u++)!0===r[u]&&i--;var s=M$(e),l=M$(t);if(o>0)for(l<s&&(l+=7);s<=l;)!0===r[s%7]&&o--,s++;return a*i+o}var yz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue());if(r<0)return zs(this.name,1);var n,a=0,o=t[1]&&za(t[1])?t[1].getValue():1;switch(o){case 1:case 17:n=[0,1,2,3,4,5,6];break;case 2:case 11:n=[6,0,1,2,3,4,5];break;case 12:n=[5,6,0,1,2,3,4];break;case 13:n=[4,5,6,0,1,2,3];break;case 14:n=[3,4,5,6,0,1,2];break;case 15:n=[2,3,4,5,6,0,1];break;case 16:n=[1,2,3,4,5,6,0];break;case 21:n=[6,7,8,9,10,4,5],a=1;break;default:return pl(this.name,2,o.toString())}return new it.NumberVar(_z(r,n,a))}}]),t}(pw("WEEKNUM",1,1,0,Vd,[{type:Vd},{type:Vd,default:new it.NumberVar(1)}]));function _z(e,t,r){var n=we.SheetDate.fromNumber(e).year,a=we.SheetDate.from({year:n,month:1,date:1});if(!r)return Math.floor((e-a.toNumber()+t[a.day]+7)/7);var o=we.SheetDate.from({year:n,month:12,date:31}),i=Math.floor((e-a.toNumber()+t[a.day])/7);switch(i){case 0:return _z(a.toNumber()-1,t,r);case 53:return o.day<4?1:53;default:return i}}var Rz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue());if(r<0)return zs(this.name,1);var n=M$(r),a=t[1]&&za(t[1])?t[1].getValue():1;switch(a){case 1:case 17:return new it.NumberVar(n+1);case 2:return new it.NumberVar((n+6)%7+1);case 3:return new it.NumberVar((n+6)%7);case 11:case 12:case 13:case 14:case 15:case 16:return new it.NumberVar((n+(17-a))%7+1)}return pl(this.name,2,a.toString())}}]),t}(pw("WEEKDAY",1,1,0,Vd,[{type:Vd},{type:Vd,default:new it.NumberVar(1)}])),Cz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e.$$calcCustomData=function(){return{autoFormat:"yyyy/mm/dd"}},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue()),a=Math.floor(t[2].getValue()),o=1900;if(r>=0&&r<o)r+=o;else if(!(r>=o&&r<=9999))return Gs(this.name,1,r,0,9999);var i=we.SheetDate.from({year:r,month:n,date:a}).toNumber();return i<0?Dl(this.name,i,0):new it.NumberVar(i)}}]),t}(pw("DATE",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),wz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!0,e.$$expanded=!0,e.$$paramsDesc=[258,3327],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue());return r<1||r>t.length-1?gl(this.name,1,r,1,t.length-1):t[r]}}]),t}(pw("CHOOSE",2,256,1,Bd|Zd,[{type:Vd},{type:Bd|Zd},{type:Bd|Zd}])),Ez=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[260,415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0].getValue();if(t[1]){if(!Ba(t[1]))return Rl(this.name,2,El(t[1]),wl(t[1]),"".concat(it.FormulaErrorPhrases.DATA_TYPE_STRING,",").concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN));r=qa(t[1])?new it.NumberVar(0):t[1].clone()}else r=t[0].clone();return(n=n.trim())&&(/^https?:|mailto:|ftp:/.test(n)||(n="http://"+n),r.setSpecialInfo({linkInfo:{link:n}})),r}}]),t}(pw("HYPERLINK",1,1,0,Nd|Vd|Md|bd,[{type:Nd},{type:Vd|Nd|bd|Md}])),kz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=UU(e,t[0].getValue());return r?new it.NumberVar(Math.floor(r.toNumber())):function(e,t){return Ce.d$b[Ce.O6N.CANNOT_PARSE_TEXT_TO_DATE]({funcName:e,arg:t})}(this.name,t[0].getValue())}}]),t}(pw("DATEVALUE",1,0,0,Vd,[{type:Nd}])),Tz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=0,e.$$maxOperands=0,e.$$lazy=!1,e.$$paramsDesc=[],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(){return new it.BooleanVar(!0)}}]),t}(pw("TRUE",0,0,0,bd,[])),Sz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=0,e.$$maxOperands=0,e.$$lazy=!1,e.$$paramsDesc=[],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(){return new it.BooleanVar(!1)}}]),t}(pw("FALSE",0,0,0,bd,[])),Az=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,399,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[2];if(!r||qa(r))r=new it.NumberVar(1);else if(!za(r)&&!Wa(r)){var n=Zc(e.service,r);if(!n)return Rl(this.name,3,El(r),wl(r),"".concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_STRING));r=n}var a=HU(r.getValue());return null===a?vl(this.name,3,""):mz(e,this.name,t[0],t[1],t[3],a)}}]),t}(pw("NETWORKDAYS.INTL",2,2,0,Vd,[{type:Vd},{type:Vd},{type:Nd|Vd,default:new it.NumberVar(1)},{type:Zd|Vd|bd}])),Iz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=6,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[415,111,111,127,259,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=$s(e.workbook,t[1]);if(n.rowCount()>1&&n.colCount()>1)return Kl(this.name);var a=n.colCount()>1,o=$s(e.workbook,t[2]),i=t[3]&&t[3]!==ho?t[3]:null,u=t[4]&&!qa(t[4])?t[4].getValue():x$.Exact,s=t[5]&&!qa(t[5])?t[5].getValue():D$.Sequence;if(a?n.colCount()!==o.colCount():n.rowCount()!==o.rowCount())return kl(this.name,n.rowCount(),n.colCount(),o.rowCount(),o.colCount());if(!(u in x$))return al(this.name,u.toString(),5,"0, -1, 1, 2");if(!(s in D$))return al(this.name,s.toString(),6,"-2, -1, 1, 2");if(u===x$.Wildcard&&(s===D$.BinaryAscending||s===D$.BinaryDescending))return al(this.name,s.toString(),4,"1, -1");if(qa(r))return i||$l(this.name,El(r));var l=new Oz(a,s,this.name,r,n,u,o,i);return s===D$.Sequence||s===D$.Reverse?j$(e,n,l):Q$(e,n,l)}}]),t}(pw("XLOOKUP",3,3,0,Zd|Vd|Pd,[{type:Bd},{type:Zd},{type:Zd},{type:Bd|Md|Zd,default:it.NA_ERR_VAR},{type:Vd,default:new it.NumberVar(x$.Exact)},{type:Vd,default:new it.NumberVar(D$.Sequence)}]));Iz=Vu([Cp("XLOOKUP")],Iz);var Oz=function(e){function t(e,r,n,a,o,i,u,s){var l;return(0,y.Z)(this,t),(l=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r,n,a,o,i,!0))).offsetRef=u,l.naValue=s,l}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getResult",value:function(e,t){var r=this.isHorizontal?0:t,n=this.isHorizontal?t:0,a=this.isHorizontal?this.offsetRef.rowCount():r+1,o=this.isHorizontal?n+1:this.offsetRef.colCount();if(to(this.offsetRef)){var i=this.offsetRef.getRef();return new Fs(new Qi(r+i.startRow,a+i.startRow,n+i.startCol,o+i.startCol,i.hostId,i.hostName))}for(var u=[],s=r;s<a;s++){u[s-r]=[];for(var l=n;l<o;l++)u[s-r][l-n]=this.offsetRef.at(s,l)}return new gs(u)}},{key:"na",value:function(){return this.naValue?this.naValue:(0,f.Z)((0,v.Z)(t.prototype),"na",this).call(this)}}]),t}(W$),Vz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[399,111,259,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=$s(e.workbook,t[1]);if(r.rowCount()>1&&r.colCount()>1)return Kl(this.name);var n=t[2]&&!qa(t[2])?t[2].getValue():x$.Exact,a=t[3]&&!qa(t[3])?t[3].getValue():D$.Sequence;if(!(n in x$))return al(this.name,n.toString(),3,"0, -1, 1, 2");if(!(a in D$))return al(this.name,a.toString(),4,"-2, -1, 1, 2");if(n===x$.Wildcard&&(a===D$.BinaryAscending||a===D$.BinaryDescending))return al(this.name,a.toString(),4,"1, -1");var o=t[0];if(qa(o))return $l(this.name,El(o));var i=new W$(r.colCount()>1,a,this.name,o,r,n,!0);return a===D$.Sequence||a===D$.Reverse?j$(e,r,i):Q$(e,r,i)}}]),t}(pw("XMATCH",2,2,0,Vd|Pd,[{type:Bd},{type:Zd},{type:Vd,default:new it.NumberVar(x$.Exact)},{type:Vd,default:new it.NumberVar(D$.Sequence)}])),Nz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue());if(r<0||n<0){var a=r<0?1:2;return zs(this.name,a)}var o=t[2]?t[2].getValue():0,i=b$(r,n,o);return null===i?Gs(this.name,3,o,0,4):new it.NumberVar(Math.abs(i.value))}}]),t}(pw("YEARFRAC",2,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(0)}])),bz=2958465,Mz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[2]||new it.NumberVar(0);if(Ba(r)&&!za(r)&&!Ga(r)){var n=Zc(e.service,r);if(!n)return Rl(this.name,3,El(r),wl(r),"".concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN));r=n}return Fz(e,this.name,t[0],t[1],r)}}]),t}(pw("WORKDAY",2,1,0,Vd,[{type:Vd},{type:Vd},{type:Zd|Vd|bd}]));function Fz(e,t,r,n,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:Z$,i=Math.floor(r.getValue()),u=Math.floor(n.getValue()),s=new Set;if(i<0)return it.tractorErrorVarCreators[it.ErrorCode.NUM_PARAMETER_SHOULD_BE_POSITIVE_OR_ZERO]({funcName:t,index:1});if(i>bz)return Gs(t,1,i,0,bz);if(u>bz)return Gs(t,2,u,0,bz);if(i+u>bz)return uc(bz);var l=zU(e,t,s,a);if(l)return l;try{var c=Zz(i,u,o,s);return c<0?Ce.d$b[Ce.O6N.FUNCTION_RESULT_SHOULD_BE_GREATER_THAN_OR_EQUAL_TO]({funcName:t,value:c,lowerBound:0}):new it.NumberVar(c)}catch(e){return uc(bz)}}function Zz(e,t,r,n){if(0===t)return e;var a=t>0?1:-1,o=function(e,t,r){for(var n=t>0?1:-1,a=7,o=0;o<7;o++)!0===r[o]&&a--;var i=t/a;i=i>0?Math.floor(i):Math.ceil(i);var u=t%a,s=e+7*i;if(s>bz)throw Error("out of max date");if(0!==i)for(;r[M$(s)];)s-=n;for(;0!==u;)r[M$(s+=n)]||(u-=n);return s}(e,t,r),i=0;for(n.forEach((function(t){var n=M$(t);(t-e)*a>0&&(o-t)*a>=0&&!r[n]&&i++}));i>0;){var u=M$(o+=a);n.has(o)||r[u]||i--}return o}var xz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,399,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=1;if(t[2])if(za(t[2])||Wa(t[2])){if("1111111"===(r=t[2].getValue()))return vl(this.name,3,r)}else if(!qa(t[2])){var n=Zc(e.service,t[2]);if(!n)return Rl(this.name,3,El(t[2]),wl(t[2]),"".concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_STRING));r=n.getValue()}var a=t[3]||new it.NumberVar(0);if(Ba(a)&&!za(a)&&!Ga(a)){var o=Zc(e.service,a);if(!o)return Rl(this.name,4,El(a),wl(a),"".concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN));a=o}var i=HU(r);return null===i?vl(this.name,3,r):Fz(e,this.name,t[0],t[1],a,i)}}]),t}(pw("WORKDAY.INTL",2,2,0,Vd,[{type:Vd},{type:Vd},{type:Nd|Vd,default:new it.NumberVar(1)},{type:Zd|Vd|bd}])),Dz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[239],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];return ro(r)?new it.NumberVar(Qa(r)?r.getRefs().length:1):it.tractorErrorVarCreators[it.ErrorCode.PARAMETER_WRONG_DATA_TYPE]({funcName:this.name,index:1,argType:it.FormulaErrorPhrases.DATA_TYPE_REFERENCE,requiredArgType:it.FormulaErrorPhrases.DATA_TYPE_REFERENCE,value:El(r)})}}]),t}(pw("AREAS",1,0,0,Vd,[YE.SHEET_REF])),Pz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$cacheType=1,e.$$paramsDesc=[33,49],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return Qa(t[0])?FU(e,t,this.name):TU(e,t,(function(r,n){var a=0;return kU(e,t,t[0].rowCount(),t[0].colCount(),(function(){a++}),r,n),new it.NumberVar(a)}))}}]),t}(pw("COUNTIF",2,0,0,Vd,[YE.MATRIX_AND_SHEET_REF,{type:Fd,default:new it.NumberVar(0)}])),$z=function(e){function t(){var e,r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IF",r.operands=2,r.optionOperands=1,r.resultType=it.VAR_TYPE.BASIC,r.repeatedLastParam=0,r.paramsDesc=[{type:it.VAR_TYPE.BOOL},{type:it.VAR_TYPE.ATOM|it.VAR_TYPE.OPERATOR},{type:it.VAR_TYPE.ATOM|it.VAR_TYPE.OPERATOR,default:(e={},(0,l.Z)(e,it.DefaultParam.IfNotInput,new it.BooleanVar(!1)),(0,l.Z)(e,it.DefaultParam.IfInputNull,it.NULL_VAR),e)}],r.$$minOperands=2,r.$$maxOperands=3,r.$$lazy=!0,r.$$expanded=!0,r.$$paramsDesc=[264,1279],r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return t[0].getValue()?t[1]:t[2]||it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE]}},{key:"arrayFunc",value:function(e,t){var r=t[0],n=r.rowCount(),a=r.colCount();if(1===n&&1===a){var o=r.at(0,0);if(ja(o))return o;var i=Dc(o);return i?this.func(e,[i,t[1],t[2]]):Rl(this.name,1,El(o),wl(o),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN)}for(var u=!1,s=!1,l=[],c=Il(this.name),h=new Rd(l,n,a,c,null,!0),f=0;f<n;f++){for(var d=[],v=0;v<a;v++){var p=r.at(f,v);if(ja(p))d[v]=p;else{var m=Dc(p);m?(m.getValue()?u=!0:s=!0,d[v]=m):d[v]=Rl(this.name,1,El(p),wl(p),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN)}}l[f]=d}function g(e){for(var t=0;t<n;t++)for(var r=l[t],o=0;o<a;o++)r[o].isBool()&&h.addToResult(t,o,1===e.length||r[o].getValue()?e[0]:e[1]);return h.getResult()}return u&&s?Lz([t[1],t[2]||it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE]],g):u?Lz([t[1]],g):s?Lz([t[2]||it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE]],g):new gs(l)}}]),t}(it.FuncOpBase);function Lz(e,t){for(var r=[],n=0;n<e.length;++n){var a=e[n];r.push(a)}return 0===r.length?t(e):new ks([],r,{next:function(e,r){return t(r)}})}var Bz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!0,e.$$paramsDesc=[264,1279],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return t.length%2!=0?it.tractorErrorVarCreators[it.ErrorCode.NON_PAIR_ARGUMENTS]({funcName:this.name,argIndex:2}):new Uz(t,0,e.isArray).next([],[t[0]])}},{key:"arrayFunc",value:function(e,t){return t.length%2!=0?it.tractorErrorVarCreators[it.ErrorCode.NON_PAIR_ARGUMENTS]({funcName:this.name,argIndex:2}):new Uz(t,0,!0).next([],[t[0]])}}]),t}(pw("IFS",2,256,2,Fd|Zd,[{type:bd|Dd},{type:Ud|Dd},{type:bd|Dd},{type:Ud|Dd}])),Uz=function(){function e(t,r,n){(0,y.Z)(this,e),this.args=t,this.index=r,this.isArray=n}return(0,_.Z)(e,[{key:"next",value:function(e,t){var r=t[0];if(this.index%2==0){if(to(r))return new ks([],[this.args[this.index]],this,!0);if(this.isArray&&r.size()>1)return new ks([],this.args,new Hz);var n=r.at(0,0);if(ja(n))return n;var a=Dc(n);return null===a?Rl("IFS",this.index+1,El(n),wl(n),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN):a.getValue()?this.args[this.index+1]:(this.index+=2,this.index>=this.args.length?Xl:new ks(e,[this.args[this.index]],this,!0))}return this.args[this.index]}}]),e}(),Hz=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"next",value:function(e,t){for(var r=1,n=1,a=t.length,o=0;o<a;o+=1){var i=t[o];r=Math.max(r,i.rowCount()),n=Math.max(n,i.colCount())}for(var u=[],s=0;s<r;s++)u.push(new Array(n).fill(null));for(var l=0;l<r;l++)for(var c=0;c<n;c++){for(var h=0;h<a;h+=2){var f=$c(t[h],l,c);if(ja(f)){u[l][c]=f;break}var d=Dc(f);if(null===d){u[l][c]=Rl("IFS",h+1,El(f),wl(f),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN);break}if(d.getValue()){u[l][c]=$c(t[h+1],l,c);break}}h===a&&(u[l][c]=Xl)}return new gs(u)}}]),e}(),zz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3].getValue();return 0===a?it.tractorErrorVarCreators[it.ErrorCode.DIVIDE_BY_ZERO_FROM_PARAMETER_BEING_ZERO]({funcName:this.name,argIndex:3}):new it.NumberVar(o*r*(n/a-1))}}]),t}(pw("ISPMT",4,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd}])),Wz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return r===Math.round(r)&&r<=0?Ce.d$b[Ce.O6N.NUM_NOT_BE_NEGATIVE_INTEGER_OR_ZERO]({funcName:this.name,index:1,value:r}):r>171?Ys:new it.NumberVar(nZ(r))}}]),t}(pw("GAMMA",1,0,0,Vd,[{type:Vd}])),Gz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=this,n=1,a=0,o=0;o<t.length;++o){var i=t[o];if(ja(i))return i;if(Ba(i)){var u=Zc(e.service,i);if(!u)return Rl(this.name,o+1,El(i),wl(i),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);i=u}var s=i.forEach((function(e){if(za(e)){var t=e.getValue();if(t<=0)return Pl(r.name,t);a++,n*=t}else if(ja(e))return e}));if(s)return s}return new it.NumberVar(Math.pow(n,1/a))}}]),t}(pw("GEOMEAN",1,255,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),jz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=this,n=0,a=0,o=0;o<t.length;++o){var i=t[o].forEach((function(e){if(za(e)){var t=e.getValue();if(t<=0)return Pl(r.name,t);a++,n+=1/t}else if(ja(e))return e}));if(i)return i}return new it.NumberVar(a/n)}}]),t}(pw("HARMEAN",1,255,1,bd,[{type:Vd|Zd},{type:Vd|Zd}])),Yz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n];if(!Ja(a)){if(ja(a))return a;var o=Zc(e.service,a);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);a=o}var i=a.forEach((function(e){if(za(e))r.push(e.getValue());else if(ja(e))return e}));if(i)return i}var u=r.length;if(u<4)return Ll(this.name,4,u);var s=r.reduce((function(e,t){return e+t}),0)/u,l=r.reduce((function(e,t){return e+Math.pow(t-s,2)}),0)/(u-1),c=Math.sqrt(l),h=u*(u+1)/((u-1)*(u-2)*(u-3))*r.reduce((function(e,t){return e+Math.pow((t-s)/c,4)}),0)-3*Math.pow(u-1,2)/((u-2)*(u-3));return new it.NumberVar(h)}}]),t}(pw("KURT",1,255,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),qz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n];Ja(a)||(a=Zc(e.service,a)||Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));var o=a.forEach((function(e){if(za(e))r.push(e.getValue());else if(ja(e))return e}));if(o)return o}var i=r.length;if(i<3)return Ll(this.name,3,i);var u=Jz(r,!0);return u.isError?Hl(this.name):new it.NumberVar(u.num)}}]),t}(pw("SKEW.P",1,254,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}]));function Jz(e,t){var r={isError:!1,num:0},n=e.length,a=e.reduce((function(e,t){return{sum:e.sum+t,sumSquares:e.sumSquares+Math.pow(t,2)}}),{sum:0,sumSquares:0}),o=a.sum,i=a.sumSquares,u=o/n,s=t?Math.sqrt(i-Math.pow(o,2)/n):Math.sqrt((n*i-Math.pow(o,2))/(n*(n-1)));if(0===s)return r.isError=!0,r;var l=e.reduce((function(e,t){return e+Math.pow((t-u)/s,3)}),0);return r.num=l*(t?Math.sqrt(n):n/((n-1)*(n-2))),r}var Kz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n];Ja(a)||(a=Zc(e.service,a)||Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));var o=a.forEach((function(e){if(za(e))r.push(e.getValue());else if(ja(e))return e}));if(o)return o}var i=r.length;if(i<3)return Ll(this.name,3,i);var u=Jz(r,!1);return u.isError?Hl(this.name):new it.NumberVar(u.num)}}]),t}(pw("SKEW",1,255,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),Xz=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return zs(this.name,1);if(r>2958465)return pl(this.name,1,r.toString());var n=we.SheetDate.fromNumber(r),a=we.SheetDate.from({year:n.year,date:1,month:1}),o=r-a.toNumber()+1,i=(n.day+7-1)%7,u=Qz(o,n.day),s=we.SheetDate.from({year:n.year-1,date:1,month:1}),l=we.SheetDate.from({year:a.year+1,date:1,month:1});0===u&&(u=Qz(o+a.toNumber()-s.toNumber(),n.day));var c=l.toNumber()-a.toNumber();return new it.NumberVar(7-(i+c-o+7)%7>4&&o+7-i>c?1:u)}}]),t}(pw("ISOWEEKNUM",1,0,0,bd,[{type:Vd}]));function Qz(e,t){var r=(t-1-e+1)%7;r<0&&(r+=7);var n=Math.floor((e+r-1)/7);return 7-r>=4&&(n+=1),n}var eW,tW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];return Qa(r)?Ol(this.name,1,""):new gs(function(e,t){for(var r=t.rowCount(),n=t.colCount(),a=[],o=0;o<n;o++){a[o]||(a[o]=[]);for(var i=0;i<r;i++)a[o][i]=t.at(i,o)}return a}(0,r))}}]),t}(pw("TRANSPOSE",1,0,0,Zd,[{type:Zd}]));function rW(e,t,r,n,a){var o,i=a?function(e,t,r,n){for(var a=t.rowCount(),o=t.colCount(),i=ro(t)?t.getRef():null,u=[],s=n-1,l=0;l<o;l++)u[l]={index:l,variant:t.at(s,l)};u.sort((function(e,t){return WU(e.variant,t.variant,1===r)}));for(var c=[[]],h=0;h<a;h++){c[h]||(c[h]=[]);for(var f=0;f<o;f++){var d=u[f].index,v=t.at(h,d);null!==i&&(v=Rp(e.workbook,v,i,h,f)),c[h][f]=v}}return new gs(c)}(e,t,n,r):function(e,t,r,n){for(var a=t.rowCount(),o=t.colCount(),i=ro(t)?t.getRef():null,u=[[]],s=0;s<a;s++){u[s]||(u[s]=[]);for(var l=0;l<o;l++){var c=t.at(s,l);null!==i&&(c=Rp(e.workbook,c,i,s,l)),u[s][l]=c}}return new gs(u.sort((function(e,t){return WU(e[n-1],t[n-1],1===r)})))}(e,t,n,r);return e.info&&(e.info.customData=null===(o=i.at(0,0).getSpecialInfo())||void 0===o?void 0:o.customData),i}tW=Vu([Cp("TRANSPOSE")],tW),function(e){e[e.ascending=1]="ascending",e[e.descending=-1]="descending"}(eW||(eW={}));var nW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[32,259,259,265],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1]&&za(t[1])?t[1].getValue():1,a=t[2]&&za(t[2])?t[2].getValue():1,o=!(!t[3]||!Ga(t[3]))&&t[3].getValue();if((o?r.rowCount():r.colCount())<n||n<1)return it.tractorErrorVarCreators[it.ErrorCode.OUT_OF_RANGE_PARAMETER]({funcName:this.name,index:2,value:n.toString()});if(1!==a&&-1!==a)return al(this.name,a.toString(),3,"1, -1");if(!(0,Ce.n5s)()){var i=e.formula;return(0,Ce.QFC)().finally((function(){e.service.emit("afterWaitAsyncCalc",i,4)})),e.service.addCalculatingAsyncFormula(i),it.WAIT_ASYNC_ERR_VAR}return rW(e,r,n,a,o)}}]),t}(pw("SORT",1,3,0,Zd|Pd,[{type:Zd},{type:Vd,default:new it.NumberVar(1)},{type:Vd,default:new it.NumberVar(1)},{type:bd,default:new it.BooleanVar(!1)}]));nW=Vu([Cp("SORT")],nW);var aW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=4,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[260,260,265,265],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(!t[0].getValue())return bl(this.name,1);var r=t[1].getValue();if(r.length<=0)return bl(this.name,2);var n=!t[2]||!Ga(t[2])||t[2].getValue(),a=!t[3]||!Ga(t[3])||t[3].getValue(),o=r.replace(/[-[\]{}()*+!<=:?.\\^$|]/g,"\\$&");n&&(o="["+o+"]");var i=t[0].getValue().split(new RegExp(o));if(a&&(i=i.filter((function(e){return e.length>0}))),i.length<=0)return Ce.d$b[Ce.O6N.CALC_PARAMETER_SHOULD_BE_NON_BLANK]({funcName:this.name,index:1});for(var u=[],s=0;s<i.length;++s){var l=i[s];l.length<=0?u.push(it.NULL_VAR):u.push(new it.StringVar(l))}return new gs([u])}}]),t}(pw("SPLIT",2,2,0,Zd,[{type:Nd},{type:Nd},{type:bd,default:new it.BooleanVar(!0)},{type:bd,default:new it.BooleanVar(!0)}]));aW=Vu([Cp("SPLIT")],aW);var oW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=Co,e.$$lazy=!0,e.$$paramsDesc=[33,1279],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=new iW(e,t);return no(t[1])||to(t[1])||r.updateCase(0,t[1]),r.next([],[])}}]),t}(pw("SWITCH",3,256,1,Bd|Zd,[{type:Zd,default:(Ke={},(0,l.Z)(Ke,it.DefaultParam.IfInputNull,new gs([[it.NULL_VAR]])),(0,l.Z)(Ke,it.DefaultParam.IfNotInput,new gs([[it.NULL_VAR]])),Ke)},{type:Bd},{type:Bd}]));oW=Vu([Cp("SWITCH")],oW);var iW=function(){function e(t,r){(0,y.Z)(this,e);var n=r[0],a=n.rowCount(),o=n.colCount();this.ctx=t,this.matrix=a*o==1?n.at(0,0):n,this.cases=r.slice(1),this.loc=[0,0,a,o,-1],this.results=new Array(a),this.array=new Rd(this.results,a,o,Xl,null,!0)}return(0,_.Z)(e,[{key:"updateCase",value:function(e,t){var r=this.cases;Ba(t)?r[e]=t:Ja(t)?Qa(t)?r[e]=Ol("SWITCH",e+2,""):r[e]=t:e%2==1||e===r.length-r.length%2?r[e]=t:r[e]=Rl("SWITCH",e+2,El(t),wl(t),"".concat((it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,it.FormulaErrorPhrases.DATA_TYPE_STRING,it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN)))}},{key:"next",value:function(e,t){var r=this.array,n=this.ctx,a=this.cases,o=this.loc,i=this.matrix,u=this.results,s=ro(i)?i.getRef():null,l=a.length-a.length%2;if(o[4]>=0){var c=t[0]||e[0];this.updateCase(o[4],c),o[4]=-1}for(var h=a[l]||Xl,f=o[2],d=o[3],v=o[0];v<f;++v){var p=u[v];p||(u[v]=p=new Array(d));for(var m=o[1];m<d;++m){for(var g=i.at(v,m),y=l,_=h,R=0;R<l;R+=2){var C=a[R],w=a[R+1];if(no(C)||to(C))return this.resolve(R,v,m);if(Ja(C)){var E=C.rowCount(),k=C.colCount();if(f<E||d<k)return o[0]=o[1]=0,o[2]=E,o[3]=k,new ks([],[],this);if(!(v<E&&m<k))continue;C=C.at(v,m)}if((!ja(g)&&!ja(C)||ja(g)&&ja(C))&&(!io(g)&&!io(C)||io(g)&&io(C))&&(0,it.equals)(n,g,C)){_=w,y=R+1;break}}if(no(_)||to(_))return this.resolve(y,v,m);Ja(_)?r.addToResult(v,m,_):(s&&(_=Rp(n.workbook,_,s,v,m)),p[m]=_)}o[1]=0}return new gs(u)}},{key:"resolve",value:function(e,t,r){var n=this.loc;return n[0]=t,n[1]=r,n[4]=e,no(this.cases[e])?new ks([],[this.cases[e]],this):new ks([this.cases[e].getRef()],[],this)}}]),e}(),uW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=wo([{type:Ro.Number}]),e}return(0,p.Z)(t,e),t}(pw("",2,0,0,Vd,[{type:Vd},{type:Vd}])),sW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=wo([{type:Ro.Any,singleValue:!0,nullable:!0}]),e}return(0,p.Z)(t,e),t}(pw("",2,0,0,bd,[{type:Vd|bd|Nd|Od},{type:Vd|bd|Nd|Od}])),lW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="EQ",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;r++)2176===t[r].$$type&&(t[r]=it.NULL_VAR);return new it.BooleanVar((0,it.equals)(e,t[0],t[1]))}},{key:"arrayFunc",value:function(e,t){return 1===t[0].size()&&t[1].size()>1?cW(e,t[0].at(0,0),t[1]):t[0].size()>1&&1===t[1].size()?cW(e,t[1].at(0,0),t[0]):hW(t[0],t[1])}}]),t}(sW);function cW(e,t,r){if(!ja(t)&&r.hash()){var n=mU(e,r),a=new LD,o=n.info,i=n.diff;if(t.isNull())yU(a,o.nullIdx,i),[new it.NumberVar(0),new it.StringVar(""),new it.BooleanVar(!1)].forEach((function(e){var t=ZD(o.values,e);t>=0&&yU(a,o.values[t].idx,i)}));else{var u=ZD(o.values,t);u>=0&&yU(a,o.values[u].idx,i),(t.isNumber()&&0===t.getCompareValue()||t.isString()&&""===t.getValue()||t.isBool()&&!t.getValue())&&yU(a,o.nullIdx,i)}return new VD(a,RU(n),r.rowCount(),r.colCount())}}function hW(e,t,r){if(e instanceof VD&&t instanceof VD&&e.size()===t.size()){var n=e.getBit().clone(),a=new Map(e.getErrors());return n.intersect(t.getBit()),t.getErrors().forEach((function(e,t){e&&void 0===a.get(t)&&a.set(t,e)})),void 0===r&&(r=VD),new r(n,a,e.rowCount(),e.colCount())}}it.EqualsOp.prototype.arrayFunc=lW.prototype.arrayFunc;var fW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[111,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=Xa(r)?r.getRef():null;to(r)&&(r=$s(e.workbook,r),n=r.getRef());var a,o=r.rowCount()||1,i=r.colCount()||1,u=[],s=t[1],l=s.colCount(),c=s.rowCount();if(l>1&&c>1)return Jl(this.name);if(i!==l&&1===c||o!==c&&1===l)return kl(this.name,o,i,c,l);u.push(s);for(var h=s instanceof VD,f=2,d=t.length;f<d;++f){var v=t[f],p=v.rowCount(),m=v.colCount();if(p!==c||m!==l){if(3===d&&f===d-1&&1===p&&1===m){a=v;break}return kl(this.name,c,l,p,m)}h=h&&v instanceof VD,u.push(v)}var g,y=[],_=[];if(1===l)if(h){for(var R=s,C=1,w=u.length;C<w;++C)R=hW(R,u[C]);for(var E=R.getTrulyIndex(),k=0,T=E.length;k<T;++k){for(var S=[],A=0,I=i;A<I;++A){var O=K$(e,r,E[k],A);to(O)?_.push({variant:O,row:y.length,col:A,offsetRow:E[k],offsetCol:A}):n&&(O=Rp(e.workbook,O,n,E[k],A)),S.push(O)}y.push(S)}}else for(var V=0;V<c;V++){var N=dW(e,u,V);if(N instanceof it.ErrorVar)return N;if(N){for(var b=[],M=0,F=i;M<F;++M){var Z=K$(e,r,V,M);to(Z)?_.push({variant:Z,row:y.length,col:M,offsetRow:V,offsetCol:M}):n&&(Z=Rp(e.workbook,Z,n,V,M)),b.push(Z)}y.push(b)}}else if(h){for(var x=s,D=1,P=u.length;D<P;++D)x=hW(x,u[D]);for(var $=x.getTrulyIndex(),L=0,B=$.length;L<B;++L)for(var U=$[L],H=0,z=o;H<z;++H){var W=y[H]||(y[H]=[]),G=K$(e,r,H,U);to(G)?_.push({variant:G,row:H,col:W.length,offsetRow:H,offsetCol:U}):n&&(G=Rp(e.workbook,G,n,H,U)),W.push(G)}}else for(var j=0;j<l;j++){var Y=dW(e,u,j);if("boolean"!=typeof Y)return Y;if(Y)for(var q=0,J=o;q<J;++q){var K=y[q]||(y[q]=[]),X=K$(e,r,q,j);to(X)?_.push({variant:X,row:q,col:K.length,offsetRow:q,offsetCol:j}):n&&(X=Rp(e.workbook,X,n,q,j)),K.push(X)}}return y.length<=0||y[0].length<=0?a||Ce.d$b[Ce.O6N.NA_MATCH_NOT_AVAILABLE]({funcName:this.name}):_.length>0?Zs(_.map((function(e){return e.variant})),(function(t){var r;return t.forEach((function(t,r){var a=_[r],o=t.at(0,0);n&&(o=Rp(e.workbook,o,n,a.offsetRow,a.offsetCol)),y[a.row][a.col]=o})),e.info&&(e.info.customData=null===(r=y[0][0].getSpecialInfo())||void 0===r?void 0:r.customData),new gs(y)})):(e.info&&(e.info.customData=null===(g=y[0][0].getSpecialInfo())||void 0===g?void 0:g.customData),new gs(y))}}]),t}(pw("FILTER",2,256,1,Zd,[{type:Zd},{type:Zd},{type:Zd}]));function dW(e,t,r){for(var n=!0,a=0;a<t.length;++a){var o=t[a],i=o.colCount(),u=o.at(r/i|0,r%i);if(ja(u)&&u.isRuntimeError())return u;var s=u.toBooleanVar();if(!io(u)&&(qa(s)||!s.getValue())){n=!1;break}}return n}fW=Vu([Cp("FILTER")],fW);var vW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[32,32,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r,n=t[0],a=[!1,!1],o=1;o<t.length;o++){var i=t[o];if(i){var u=Dc(i.at(0,0));if(!u)return Rl(this.name,o+1,El(i),wl(i),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN);a[o-1]=u.getValue()}}var s=a[0],l=a[1],c=n.rowCount(),h=n.colCount();if(c<1||h<1)return it.REF_ERR_VAR;var f=c,d=h;s&&(f=(r=[d,f])[0],d=r[1]);for(var v=new Map,p=new Map,m=0;m<f;m++){for(var y="",_=0;_<d;_++){var R,C=m,w=_;s&&(w=(R=[C,w])[0],C=R[1]),y+=yd(n.at(C,w))+"#"}var E=p.has(y),k=v.get(y);l?(k||v.set(y,!0),k&&E?p.delete(y):k||E||p.set(y,m)):E||p.set(y,m)}if(0===p.size)return Ce.d$b[Ce.O6N.NA_DELETED_REFERENCE]();var T,S,A=[],I=ro(n)?n.getRef():null,O=-1,V=yr(p);try{for(V.s();!(T=V.n()).done;){var N=(0,g.Z)(T.value,2),b=(N[0],N[1]);O++;for(var M=0;M<d;M++)if(s){A[M]||(A[M]=[]);var F=n.at(M,b);null!==I&&(F=Rp(e.workbook,F,I,b,M)),A[M][O]=F}else{A[O]||(A[O]=[]);var Z=n.at(b,M);null!==I&&(Z=Rp(e.workbook,Z,I,b,M)),A[O][M]=Z}}}catch(e){V.e(e)}finally{V.f()}return e.info&&A[0]&&A[0][0]&&(e.info.customData=null===(S=A[0][0].getSpecialInfo())||void 0===S?void 0:S.customData),new gs(A)}}]),t}(pw("UNIQUE",1,2,0,Zd,[{type:Zd},{type:bd,default:new it.BooleanVar(!1)},{type:bd,default:new it.BooleanVar(!1)}]));vW=Vu([Cp("UNIQUE")],vW);var pW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[260,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=this,n=t[0].getValue(),a=[],o=function(n){var o=t[n];if(o.rowCount()>1&&o.colCount()>1)return{v:Jl(r.name)};var i=!Ja(o),u=o.forEach((function(t){if(ja(t))return t;var o=Fc(e.service,t,4);if(o)a.push(o.getValue());else if(i)return Rl(r.name,n+1,El(t),wl(t),it.FormulaErrorPhrases.DATA_TYPE_STRING)}));return u?{v:u}:void 0},i=1;i<t.length;i++){var u=o(i);if("object"===(0,R.Z)(u))return u.v}return new it.StringVar(a.join(n))}}]),t}(pw("JOIN",2,255,1,Nd,[{type:Nd},{type:Nd|Zd},{type:Nd|Zd}])),mW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return Wa(t[0])?t[0]:new it.StringVar("")}}]),t}(pw("T",1,0,0,Nd,[{type:Vd|bd|Nd|Od}])),gW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=Co,e.$$lazy=!1,e.$$cacheType=1,e.$$paramsDesc=wo([{type:Ro.Ref},{type:Ro.Matrix,nullable:!0,errorable:!0}]),e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=this,n=$s(e.workbook,t[0]),a=t.slice(1),o=n.rowCount(),i=n.colCount();return SU(this.name,a,o,i,2)||(eo(n)?TU(e,a,(function(t,u){var s=null,l=kU(e,a,o,i,(function(e,t){var a=n.at(e,t);if(za(a))s=null===s?a.getValue():r.comparator(s,a.getValue());else if(ja(a))return a}),t,u);return l||(null!==s&&Number.isFinite(s)?new it.NumberVar(s):new it.NumberVar(0))})):OU(e,n,a,o,i,(function(e){for(var t=null,n=0;n<e.length;n++){var a=e[n];if(a.isNumber()&&(t=null===t?a.getValue():r.comparator(t,a.getValue())),a.isError())return a}return null!==t&&Number.isFinite(t)?new it.NumberVar(t):new it.NumberVar(0)})))}}]),t}(pw("",3,252,2,Vd,[YE.MATRIX_AND_SHEET_REF,YE.MATRIX_AND_SHEET_REF,{type:Vd|Nd|bd|Od|Md},YE.MATRIX_AND_SHEET_REF,{type:Vd|Nd|bd|Od|Md}])),yW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MAXIFS",e.comparator=Math.max,e}return(0,p.Z)(t,e),t}(gW),_W=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MINIFS",e.comparator=Math.min,e}return(0,p.Z)(t,e),t}(gW),RW=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1],a=r.colCount(),o=r.rowCount(),i=n.rowCount(),u=n.colCount();if(a!==i)return Ce.d$b[Ce.O6N.INCOMPATIBLE_MATRIX_SIZES]({funcName:this.name,cols:a,rows:i});for(var s=[],l=0;l<o;l++)for(var c=0;c<u;c++){s[l]||(s[l]=[]);for(var h=0,f=!1,d=0;d<i;d++){var v=r.at(l,d),p=n.at(d,c);if(!za(v))return ja(v)?v:Rl(this.name,1,El(v),wl(v),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);if(!za(p))return ja(p)?p:Rl(this.name,2,El(p),wl(p),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);if(h+=v.getValue()*p.getValue(),!Number.isFinite(h)){f=!0;break}}s[l][c]=f?Ys:new it.NumberVar(h)}return new gs(s)}}]),t}(pw("MMULT",2,0,0,Zd,[{type:Zd,default:it.NA_ERR_VAR},{type:Zd,default:it.NA_ERR_VAR}]));function CW(e,t,r){return e===Ce.O6N.NO_QUERY_OUTPUT?new it.ErrorVar(it.ErrorType.NA,it.ErrorConstant.NA,e):new it.ErrorVar(it.ErrorType.VALUE,it.ErrorConstant.VALUE,e,{message:t,args:r})}RW=Vu([Cp("MMULT")],RW);var wW=function(e){function t(e,r,n){var a;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,r))).code=e,a.message=r,a.args=n,a}return(0,p.Z)(t,e),t}((0,a.Z)(Error)),EW={1:6,3:5,4:4,0:3,2:2,5:1,6:0};function kW(e,t){var r=t.rowFrom,n=t.columnDataTypeAssert,a=t.referencedColumns,o=t.headerCount,i=t.ctx,u=e.rowCount(),s=Object.keys(a),l=[],c={},h={},f=new NW;if(null===o||o<0){var d=function(e,t){for(var r=t.rowFrom,n=t.rowCount,a=t.dataTypeInfoCache,o=t.ctx,i=0,u=r+n-1,s=e.colCount(),l=r;l<=u;l++){for(var c=0;c<s;c++){var h=AW(e,l,c,o);if(h instanceof it.ErrorVar)return h;if(a.setCache(l,c,h),2!==h.dataType&&6!==h.dataType)return i}i++}return i===n?0:i}(e,{rowFrom:r,rowCount:u,dataTypeInfoCache:f,ctx:i});if(d instanceof it.ErrorVar)return d;o=d}for(var v=o>0?function(e){var t=e.rowFrom,r=e.rowCount,n=e.referencedColumns,a=e.dataTypeInfoCache,o=e.dataSource,i=e.ctx,u={},s=t+r-1;for(var l in n){for(var c=n[l],h=[],f=t;f<=s;f++){var d,v,p=null!==(d=a.getCache(f,c))&&void 0!==d?d:AW(o,f,c,i);a.setCache(f,c,p);var m=IW(p.dataType,p.value,null!==(v=p.formatter)&&void 0!==v?v:null,2);null===m||h.push(m)}u[l]=h.join(" ")}return u}({rowFrom:r,rowCount:o,referencedColumns:a,dataTypeInfoCache:f,dataSource:e,ctx:i}):{},p={colIndex:0,rowCount:u-=o,rowFrom:r+=o,dataTypeInfoCache:f,ctx:i},m=0,g=s;m<g.length;m++){var y=g[m],_=a[y];p.colIndex=_;var R=TW(e,p);if(R instanceof it.ErrorVar)return R;var C=R.maxDataType,w=R.maxFormatter;if(void 0!==n){var E=n[_];if(void 0!==E)for(var k=0;k<E.length;k++){var T=(0,E[k])(C);if(!1!==T)return CW(T.code,T.message,T.args)}}w&&(c[y]=w),h[_]=C}for(var S=0,A=s;S<A.length;S++){var I=a[A[S]],O=SW(e,{rowFrom:r,rowCount:u,colIndex:I,columnType:h[I],dataTypeInfoCache:f,ctx:i});if(O instanceof it.ErrorVar)return O;l[I]=O}return{dataMatrix:l,rowCount:u,refNameTitleMap:v,formatterMap:c}}function TW(e,t){var r,n,a,o=t.rowFrom,i=t.rowCount,u=t.colIndex,s=t.dataTypeInfoCache,l=t.ctx;if(ro(e)&&(a=e.getRef(),!(n=Ps(l.workbook,a))))return Ol("QUERY",1,"");for(var c={},h={},f=6,d=0,v=o+i-1,p=o;p<=v;p++){var m,g,y=null!==(m=s.getCache(p,u))&&void 0!==m?m:AW(e,p,u,l);if(y instanceof it.ErrorVar)return y;var _=y.dataType,R=y.value;if(6!==_){var C=y.formatter;s.setCache(p,u,{dataType:_,value:R,formatter:C});var w=(null!==(g=h[_])&&void 0!==g?g:0)+1;if(h[_]=w,void 0===c[_]&&(void 0===C&&(C=n?n.getActualFormatter(a.startRow+p,a.startCol+u,l):null),C&&(c[_]=C)),(w>d||w===d&&EW[_]>EW[f])&&(f=_,(d=w)>i/2))break}}return{maxDataType:f,maxFormatter:null!==(r=c[f])&&void 0!==r?r:null}}function SW(e,t){for(var r=t.rowFrom,n=t.rowCount,a=t.colIndex,o=t.columnType,i=t.dataTypeInfoCache,u=t.ctx,s=[],l=0,c=r+n,h=r;h<c;h++){var f,d,v=null!==(f=i.getCache(h,a))&&void 0!==f?f:AW(e,h,a,u);if(v instanceof it.ErrorVar)return v;s[l]=IW(v.dataType,v.value,null!==(d=v.formatter)&&void 0!==d?d:null,o),l++}return s}function AW(e,t,r,n){var a,o,i=e.at(t,r);if(i===it.REF_ERR_VAR)return it.REF_ERR_VAR;var u,s=i.getValue();if(null===s)return{dataType:6,value:s};if("boolean"==typeof s)return{dataType:1,value:s};if("string"==typeof s)return{dataType:2,value:s};if(ro(e)){var l=e.getRef(),c=Ps(n.workbook,l);if(!c)return Ol("QUERY",1,"");u=c.getActualFormatter(l.startRow+t,l.startCol+r,n)}var h=null===(a=i.getSpecialInfo())||void 0===a||null===(o=a.customData)||void 0===o?void 0:o.autoFormat;if(h&&(u=n.workbook.formatterService.getFormatter(h)),!u)return{dataType:0,formatter:null,value:s};var f=(0,Ee.hasDate)(u),d=(0,Ee.hasTime)(u),v=0;return f&&d?v=4:f?v=3:d&&(v=5),{dataType:v,formatter:u,value:s}}function IW(e,t,r,n){if(6===e||6===n)return null;if(0===n&&(0===e||OW(e)))return t;if(2===n){if(2===e)return t;if(0===e||OW(e))return null!==r?r.format(t):String(t);if(1===e)return!0===t?"TRUE":"FALSE"}if(1===n&&1===e)return t;if(OW(n)&&(OW(e)||0===e)){var a=new we.SheetDate(t).getUTCDate();return isNaN(a.getTime())?null:a}return null}function OW(e){return 3===e||4===e||5===e}var VW,NW=function(){function e(){(0,y.Z)(this,e),this.cache=[]}return(0,_.Z)(e,[{key:"getCache",value:function(e,t){var r,n=this.cache[e];return void 0===n?null:null!==(r=n[t])&&void 0!==r?r:null}},{key:"setCache",value:function(e,t,r){var n=this.cache[e]||[];n[t]=r,this.cache[e]=n}}]),e}();!function(e){e.Identifier="Identifier",e.SelectKeyword="SelectKeyword",e.WhereKeyword="WhereKeyword",e.PivotKeyword="PivotKeyword",e.GroupByKeyword="GroupByKeyword",e.OrderByKeyword="OrderByKeyword",e.LimitKeyword="LimitKeyword",e.OffsetKeyword="OffsetKeyword",e.LabelKeyword="LabelKeyword",e.NumberLiteral="NumberLiteral",e.StringLiteral="StringLiteral",e.BooleanLiteral="BooleanLiteral",e.DateLiteral="DateLiteral",e.DateTimeLiteral="DateTimeLiteral",e.TimeOfDayLiteral="TimeOfDayLiteral",e.NullLiteral="NullLiteral",e.Not="Not",e.ComparisonOperator="ComparisonOperator",e.GreaterThan="GreaterThan",e.LessThan="LessThan",e.GreaterThanEqual="GreaterThanEqual",e.LessThanEqual="LessThanEqual",e.NotEqual="NotEqual",e.Equal="Equal",e.Is="Is",e.And="And",e.Or="Or",e.Like="Like",e.AdditionAndSubtraction="AdditionAndSubtraction",e.Plus="Plus",e.Minus="Minus",e.MultiplicationAndDivisionAndModulo="MultiplicationAndDivisionAndModulo",e.Asterisk="Asterisk",e.Divide="Divide",e.Modulo="Modulo",e.Comma="Comma",e.OpenParen="OpenParen",e.CloseParen="CloseParen",e.WhiteSpace="WhiteSpace",e.Desc="Desc",e.Asc="Asc"}(VW||(VW={}));var bW=(0,Ct.createToken)({name:VW.Identifier,pattern:/[A-Za-z]\w*/}),MW=(0,Ct.createToken)({name:VW.SelectKeyword,pattern:/SELECT/i}),FW=(0,Ct.createToken)({name:VW.WhereKeyword,pattern:/WHERE/i}),ZW=(0,Ct.createToken)({name:VW.PivotKeyword,pattern:/PIVOT/i}),xW=(0,Ct.createToken)({name:VW.GroupByKeyword,pattern:/GROUP\s+BY/i}),DW=(0,Ct.createToken)({name:VW.OrderByKeyword,pattern:/ORDER\s+BY/i}),PW=(0,Ct.createToken)({name:VW.LimitKeyword,pattern:/LIMIT/i}),$W=(0,Ct.createToken)({name:VW.OffsetKeyword,pattern:/OFFSET/i}),LW=(0,Ct.createToken)({name:VW.LabelKeyword,pattern:/LABEL/i}),BW=(0,Ct.createToken)({name:VW.NumberLiteral,pattern:/(?:[0-9]+(\.[0-9]*)?|\.[0-9]+)/,longer_alt:bW}),UW=(0,Ct.createToken)({name:VW.StringLiteral,pattern:/(?:'[^']*')|(?:"[^"]*")|(?:`[^`]*`)/}),HW=(0,Ct.createToken)({name:VW.BooleanLiteral,pattern:/TRUE|FALSE/i,longer_alt:bW}),zW=(0,Ct.createToken)({name:VW.DateLiteral,pattern:/date\s+(?:('[^']*')|(?:"[^"]*"))/i}),WW=(0,Ct.createToken)({name:VW.DateTimeLiteral,pattern:/datetime\s+(?:('[^']*')|(?:"[^"]*"))/i}),GW=(0,Ct.createToken)({name:VW.TimeOfDayLiteral,pattern:/timeofday\s+(?:('[^']*')|(?:"[^"]*"))/i}),jW=(0,Ct.createToken)({name:VW.NullLiteral,pattern:/NULL/i,longer_alt:bW}),YW=(0,Ct.createToken)({name:VW.Not,pattern:/NOT/i,longer_alt:bW}),qW=(0,Ct.createToken)({name:VW.ComparisonOperator,pattern:Ct.Lexer.NA}),JW=(0,Ct.createToken)({name:VW.GreaterThan,pattern:/>/,categories:qW}),KW=(0,Ct.createToken)({name:VW.LessThan,pattern:/</,categories:qW}),XW=(0,Ct.createToken)({name:VW.GreaterThanEqual,pattern:/>=/,categories:qW}),QW=(0,Ct.createToken)({name:VW.LessThanEqual,pattern:/<=/,categories:qW}),eG=(0,Ct.createToken)({name:VW.NotEqual,pattern:/<>|!=/,categories:qW}),tG=(0,Ct.createToken)({name:VW.Equal,pattern:/=/,categories:qW}),rG=(0,Ct.createToken)({name:VW.Like,pattern:/LIKE/i,categories:qW}),nG=(0,Ct.createToken)({name:VW.Is,pattern:/IS/i,longer_alt:bW}),aG=(0,Ct.createToken)({name:VW.And,pattern:/AND/i,longer_alt:bW}),oG=(0,Ct.createToken)({name:VW.Or,pattern:/OR/i,longer_alt:bW}),iG=(0,Ct.createToken)({name:VW.AdditionAndSubtraction,pattern:Ct.Lexer.NA}),uG=(0,Ct.createToken)({name:VW.Plus,pattern:/\+/,categories:iG}),sG=(0,Ct.createToken)({name:VW.Minus,pattern:/-/,categories:iG}),lG=(0,Ct.createToken)({name:VW.MultiplicationAndDivisionAndModulo,pattern:Ct.Lexer.NA}),cG=(0,Ct.createToken)({name:VW.Asterisk,pattern:/\*/,categories:lG}),hG=(0,Ct.createToken)({name:VW.Divide,pattern:/\//,categories:lG}),fG=(0,Ct.createToken)({name:VW.Modulo,pattern:/%/,categories:lG}),dG=(0,Ct.createToken)({name:VW.Comma,pattern:/,/}),vG=(0,Ct.createToken)({name:VW.OpenParen,pattern:/\(/}),pG=(0,Ct.createToken)({name:VW.CloseParen,pattern:/\)/}),mG=[MW,FW,ZW,xW,DW,PW,$W,LW,(0,Ct.createToken)({name:VW.Desc,pattern:/DESC/i,longer_alt:bW}),(0,Ct.createToken)({name:VW.Asc,pattern:/ASC/i,longer_alt:bW}),zW,WW,GW,BW,UW,HW,jW,vG,pG,dG,YW,uG,sG,cG,hG,fG,nG,aG,oG,rG,XW,QW,eG,JW,KW,tG,bW,qW,iG,lG,(0,Ct.createToken)({name:VW.WhiteSpace,pattern:/\s+/,group:Ct.Lexer.SKIPPED})],gG=function(){var e={};return mG.forEach((function(t){e[t.name]=t})),e}(),yG=null;function _G(e){return(null===yG&&(yG=new Ct.Lexer(mG)),yG).tokenize(e)}var RG=null;var CG,wG,EG,kG,TG,SG,AG,IG={LABEL:"lhs"},OG={LABEL:"rhs"},VG=function(e){function t(){var e;(0,y.Z)(this,t),e=(0,d.Z)(this,(0,v.Z)(t).call(this,mG,{skipValidations:!0}));var r=(0,c.Z)(e);return r.RULE("QueryStatement",(function(){r.OPTION((function(){r.SUBRULE(r.SelectClause)})),r.OPTION1((function(){r.SUBRULE(r.WhereClause)})),r.OPTION2((function(){r.SUBRULE(r.GroupByClause)})),r.OPTION3((function(){r.SUBRULE(r.PivotClause)})),r.OPTION4((function(){r.SUBRULE(r.OrderByClause)})),r.OPTION5((function(){r.SUBRULE(r.LimitClause)})),r.OPTION6((function(){r.SUBRULE(r.OffsetClause)})),r.OPTION7((function(){r.SUBRULE(r.LabelClause)}))})),r.RULE("SelectClause",(function(){r.CONSUME(gG[VW.SelectKeyword]),r.OR([{ALT:function(){return r.CONSUME(gG[VW.Asterisk])}},{ALT:function(){r.SUBRULE(r.Expression),r.MANY((function(){r.CONSUME(gG[VW.Comma]),r.SUBRULE1(r.Expression)}))}}])})),r.RULE("WhereClause",(function(){r.CONSUME(gG[VW.WhereKeyword]),r.SUBRULE(r.Expression)})),r.RULE("GroupByClause",(function(){r.CONSUME(gG[VW.GroupByKeyword]),r.SUBRULE(r.Expression),r.MANY((function(){r.CONSUME(gG[VW.Comma]),r.SUBRULE1(r.Expression)}))})),r.RULE("PivotClause",(function(){r.CONSUME(gG[VW.PivotKeyword]),r.SUBRULE(r.Expression),r.MANY((function(){r.CONSUME(gG[VW.Comma]),r.SUBRULE1(r.Expression)}))})),r.RULE("OrderByClause",(function(){r.CONSUME(gG[VW.OrderByKeyword]),r.SUBRULE(r.OrderByExpression),r.MANY((function(){r.CONSUME(gG[VW.Comma]),r.SUBRULE1(r.OrderByExpression)}))})),r.RULE("OrderByExpression",(function(){r.SUBRULE(r.Expression),r.OPTION((function(){r.OR([{ALT:function(){return r.CONSUME(gG[VW.Desc])}},{ALT:function(){return r.CONSUME(gG[VW.Asc])}}])}))})),r.RULE("LimitClause",(function(){r.CONSUME(gG[VW.LimitKeyword]),r.OPTION((function(){return r.CONSUME(gG[VW.Minus])})),r.CONSUME(gG[VW.NumberLiteral])})),r.RULE("OffsetClause",(function(){r.CONSUME(gG[VW.OffsetKeyword]),r.OPTION((function(){return r.CONSUME(gG[VW.Minus])})),r.CONSUME(gG[VW.NumberLiteral])})),r.RULE("LabelClause",(function(){r.CONSUME(gG[VW.LabelKeyword]),r.SUBRULE(r.LabelExpression),r.MANY((function(){r.CONSUME(gG[VW.Comma]),r.SUBRULE1(r.LabelExpression)}))})),r.RULE("LabelExpression",(function(){r.SUBRULE(r.Expression),r.CONSUME(gG[VW.StringLiteral])})),r.RULE("Expression",(function(){r.SUBRULE(r.AndExpression,IG),r.MANY((function(){r.CONSUME(gG[VW.Or]),r.SUBRULE1(r.AndExpression,OG)}))})),r.RULE("AndExpression",(function(){r.SUBRULE(r.IsExpression,IG),r.MANY((function(){r.CONSUME(gG[VW.And]),r.SUBRULE1(r.IsExpression,OG)}))})),r.RULE("IsExpression",(function(){r.SUBRULE(r.ComparisonExpression),r.OPTION((function(){r.CONSUME(gG[VW.Is]),r.OPTION1((function(){return r.CONSUME(gG[VW.Not])})),r.CONSUME(gG[VW.NullLiteral])}))})),r.RULE("ComparisonExpression",(function(){r.SUBRULE(r.AdditionAndSubtractionExpression,IG),r.MANY((function(){r.CONSUME(gG[VW.ComparisonOperator]),r.SUBRULE1(r.AdditionAndSubtractionExpression,OG)}))})),r.RULE("AdditionAndSubtractionExpression",(function(){r.SUBRULE(r.MultiplicationAndDivisionAndModuloExpression,IG),r.MANY((function(){r.CONSUME(gG[VW.AdditionAndSubtraction]),r.SUBRULE1(r.MultiplicationAndDivisionAndModuloExpression,OG)}))})),r.RULE("MultiplicationAndDivisionAndModuloExpression",(function(){r.SUBRULE(r.NotExpression,IG),r.MANY((function(){r.CONSUME(gG[VW.MultiplicationAndDivisionAndModulo]),r.SUBRULE1(r.NotExpression,OG)}))})),r.RULE("NotExpression",(function(){r.OR([{ALT:function(){return r.SUBRULE(r.Literal)}},{ALT:function(){return r.SUBRULE(r.GroupExpression)}},{ALT:function(){return r.SUBRULE(r.Function)}},{ALT:function(){return r.CONSUME(gG[VW.Identifier])}}])})),r.RULE("GroupExpression",(function(){r.CONSUME(gG[VW.OpenParen]),r.SUBRULE(r.Expression),r.CONSUME(gG[VW.CloseParen])})),r.RULE("Function",(function(){r.CONSUME(gG[VW.Identifier]),r.CONSUME(gG[VW.OpenParen]),r.OPTION((function(){r.SUBRULE(r.Expression,{LABEL:"argument1"})})),r.MANY((function(){r.CONSUME(gG[VW.Comma]),r.SUBRULE1(r.Expression,{LABEL:"restArguments"})})),r.CONSUME(gG[VW.CloseParen])})),r.RULE("Literal",(function(){r.OR([{ALT:function(){return r.CONSUME(gG[VW.DateLiteral])}},{ALT:function(){return r.CONSUME(gG[VW.DateTimeLiteral])}},{ALT:function(){return r.CONSUME(gG[VW.TimeOfDayLiteral])}},{ALT:function(){return r.CONSUME(gG[VW.BooleanLiteral])}},{ALT:function(){r.OPTION((function(){return r.CONSUME(gG[VW.Minus])})),r.CONSUME(gG[VW.NumberLiteral])}},{ALT:function(){return r.CONSUME(gG[VW.StringLiteral])}}])})),e.performSelfAnalysis(),e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"parse",value:function(e){return this.input=e,this.QueryStatement()}}]),t}(Ct.CstParser);!function(e){e[e.Ref=0]="Ref",e[e.Function=1]="Function",e[e.Constant=2]="Constant"}(CG||(CG={})),function(e){e[e.Number=0]="Number",e[e.Boolean=1]="Boolean",e[e.String=2]="String",e[e.Date=3]="Date",e[e.DateTime=4]="DateTime",e[e.TimeOfDay=5]="TimeOfDay",e[e.Null=6]="Null"}(wG||(wG={})),function(e){e.Desc="DESC",e.Asc="ASC"}(EG||(EG={})),function(e){e.Year="YEAR",e.Month="MONTH",e.Day="DAY"}(kG||(kG={})),function(e){e.Avg="AVG",e.Count="COUNT",e.Max="MAX",e.Min="MIN",e.Sum="SUM"}(TG||(TG={})),function(e){e.Group="GROUP",e.SelectAllColumn="SELECT_ALL_COLUMN",e.Label="LABLE"}(SG||(SG={})),function(e){e.Group="GROUP",e.Not="Not",e.Or="Or",e.And="And",e.Is="Is",e.Like="Like",e.GreaterThan="GreaterThan",e.LessThan="LessThan",e.GreaterThanEqual="GreaterThanEqual",e.LessThanEqual="LessThanEqual",e.Equal="Equal",e.NotEqual="NotEqual",e.Plus="Plus",e.Minus="Minus",e.Multiply="Asterisk",e.Divide="Divide",e.Modulo="Modulo",e.Desc="DESC",e.Asc="ASC",e.Year="YEAR",e.Month="MONTH",e.Day="DAY",e.Avg="AVG",e.Count="COUNT",e.Max="MAX",e.Min="MIN",e.Sum="SUM",e.SelectAllColumn="SELECT_ALL_COLUMN",e.Label="LABLE"}(AG||(AG={}));var NG,bG=[AG.Avg,AG.Count,AG.Max,AG.Min,AG.Sum],MG=[AG.Year,AG.Month,AG.Day],FG=[AG.Plus,AG.Minus,AG.Multiply,AG.Divide,AG.Modulo],ZG=[AG.Year,AG.Month,AG.Day,AG.Avg,AG.Count,AG.Max,AG.Min,AG.Sum],xG=[AG.Or,AG.And,AG.Is,AG.Like,AG.GreaterThan,AG.LessThan,AG.GreaterThanEqual,AG.LessThanEqual,AG.Equal,AG.NotEqual];function DG(e,t,r){var n=e.valueMatrix,a=e.referencedColumns,o=e.rowCount,i=[],u={},s=Object.keys(a);s.forEach((function(e,t){u[e]=t}));for(var l=0,c=function(e){(null==r?void 0:r.has(e))||(i[l]=new Array(s.length),s.forEach((function(t,r){var o=a[t];i[l][r]=n[o][e]})),l++)},h=0;h<o;h++)c(h);return Object.entries(t).forEach((function(e,t){var n,a=(0,g.Z)(e,2),o=a[0],l=a[1].toArray(r);l.length?(l.forEach((function(e,t){i[t].push(e)})),u[o]=(null==i||null===(n=i[0])||void 0===n?void 0:n.length)-1):u[o]=s.length+t})),e.referencedColumns=u,i}function PG(e,t,r){var n=DG(e,t,r),a=Object.keys(e.referencedColumns).map((function(e){return UG(e)}));return n.unshift(a),n}function $G(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[AG.Group];return 1===e.type&&t.includes(e.operator)&&Array.isArray(e.parameters)&&1===e.parameters.length?$G(e.parameters[0]):e}function LG(e){return $G(e,[AG.Group,AG.Asc,AG.Desc])}function BG(e,t){return e=e.toUpperCase(),t=t.toUpperCase(),e.includes(t)?1:0}function UG(e){return e.replace(/[A-Z]+(?!(\(|\d|[A-Z]|[a-z]))/,(function(e){return"$$_".concat(e,"_$$")})).replace(/Col[0-9]+/,(function(e){return"$$_".concat(e,"_$$")}))}function HG(e,t){return null==e?e:e.replace(/(\$\$_((Col[0-9]+|[A-Z]+)|(?!\())_\$\$)/g,(function(){for(var e,r=arguments.length,n=new Array(r),a=0;a<r;a++)n[a]=arguments[a];return t&&n&&void 0!==t[n[2]]?t[n[2]]:null!==(e=n[2])&&void 0!==e?e:""}))}!function(e){e.QueryStatement="QueryStatement",e.SelectClause="SelectClause",e.WhereClause="WhereClause",e.GroupByClause="GroupByClause",e.PivotClause="PivotClause",e.OrderByClause="OrderByClause",e.LimitClause="LimitClause",e.OffsetClause="OffsetClause",e.LabelClause="LabelClause",e.Expression="Expression",e.OrderByExpression="OrderByExpression",e.Literal="Literal",e.Function="Function",e.GroupExpression="GroupExpression",e.IsExpression="IsExpression",e.AndExpression="AndExpression",e.AdditionAndSubtractionExpression="AdditionAndSubtractionExpression",e.MultiplicationAndDivisionAndModuloExpression="MultiplicationAndDivisionAndModuloExpression",e.ModuloExpression="ModuloExpression",e.ComparisonExpression="ComparisonExpression",e.NotExpression="NotExpression",e.IsNullExpression="IsNullExpression",e.LabelExpression="LabelExpression"}(NG||(NG={}));var zG,WG=null,GG=new Date(we.SheetDate.BASE_MILLISECONDS),jG="".concat(GG.getFullYear(),"-").concat(GG.getMonth()+1,"-").concat(GG.getDate()),YG=/date\s+('(\d{4}-\d{1,2}-\d{1,2})'|"(\d{4}-\d{1,2}-\d{1,2})")/i,qG=/datetime\s+('(\d{4}-\d{1,2}-\d{1,2} \d{1,2}:\d{1,2}:\d{1,2}(?:\.\d+)?)'|"(\d{4}-\d{1,2}-\d{1,2} \d{1,2}:\d{1,2}:\d{1,2}(?:\.\d+)?)")/i,JG=/timeofday\s+('(\d{1,2}:\d{1,2}:\d{1,2}(?:\.\d+)?)'|"(\d{1,2}:\d{1,2}:\d{1,2}(?:\.\d+)?)")/i,KG=/[^A-Z]/,XG=/^Col([1-9]\d*)$/;!function(e){e.Select="SELECT",e.Where="WHERE",e.GroupBy="GROUP BY",e.Pivot="PIVOT",e.OrderBy="ORDER BY",e.Limit="LIMIT",e.Offset="OFFSET",e.Label="LABEL"}(zG||(zG={}));var QG={WHERE:Ce.O6N.CANNOT_BE_IN_WHERE,"GROUP BY":Ce.O6N.CANNOT_BE_IN_GROUP_BY,PIVOT:Ce.O6N.CANNOT_BE_IN_PIVOT},ej=(Xe={},(0,l.Z)(Xe,AG.Plus,Ce.O6N.CAN_NOT_PERFORM_THE_FUNCTION_SUM_ON_VALUES_THAT_ARE_NOT_NUMBERS),(0,l.Z)(Xe,AG.Minus,Ce.O6N.CAN_NOT_PERFORM_THE_FUNCTION_DIFFERENCE_ON_VALUES_THAT_ARE_NOT_NUMBERS),(0,l.Z)(Xe,AG.Multiply,Ce.O6N.CAN_NOT_PERFORM_THE_FUNCTION_PRODUCT_ON_VALUES_THAT_ARE_NOT_NUMBERS),(0,l.Z)(Xe,AG.Divide,Ce.O6N.CAN_NOT_PERFORM_THE_FUNCTION_QUOTIENT_ON_VALUES_THAT_ARE_NOT_NUMBERS),(0,l.Z)(Xe,AG.Modulo,Ce.O6N.CAN_NOT_PERFORM_THE_FUNCTION_MODULO_ON_VALUES_THAT_ARE_NOT_NUMBERS),Xe),tj=(Qe={},(0,l.Z)(Qe,AG.And,Ce.O6N.THE_LOGICAL_OPERATOR_AND_USING_TO_JOIN_MULTIPLE_CONDITION),(0,l.Z)(Qe,AG.Or,Ce.O6N.THE_LOGICAL_OPERATOR_OR_USING_TO_JOIN_MULTIPLE_CONDITION),Qe);function rj(e){return 0===e.type||2===e.type&&(3===e.constantType||4===e.constantType)}var nj=(et={},(0,l.Z)(et,AG.Year,{count:1,countError:Ce.O6N.NUMBER_OF_PARAMETERS_FOR_YEAR_IS_WRONG,check:rj,typeError:Ce.O6N.CAN_NOT_PERFORM_THE_FUNCTION_YEAR_ON_A_COLUMN_THAT_ARE_NOT_DATE_OR_DATETIME_COLUMN}),(0,l.Z)(et,AG.Month,{count:1,countError:Ce.O6N.NUMBER_OF_PARAMETERS_FOR_MONTH_IS_WRONG,check:rj,typeError:Ce.O6N.CAN_NOT_PERFORM_THE_FUNCTION_MONTH_ON_A_COLUMN_THAT_ARE_NOT_DATE_OR_DATETIME_COLUMN}),(0,l.Z)(et,AG.Day,{count:1,countError:Ce.O6N.NUMBER_OF_PARAMETERS_FOR_DAY_IS_WRONG,check:rj,typeError:Ce.O6N.CAN_NOT_PERFORM_THE_FUNCTION_DAY_ON_A_COLUMN_THAT_ARE_NOT_DATE_OR_DATETIME_COLUMN}),et);function aj(e){if(null===WG){var t=function(e){return function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).avgAndSumParamAssert=function(t){return function(r){return 0!==r&&new wW(Ce.O6N.AVG_SUM_ONLY_NUMERIC,e.errorMessage(Ce.O6N.AVG_SUM_ONLY_NUMERIC),{avgOrSum:t})}},e.scalarParamAssert=function(t,r){return function(n){return![3,4].includes(n)&&new wW(r,e.errorMessage(r),{scalarFunctionName:t})}},e.binaryOpParamAssert=function(t,r){return function(n){return 0!==n&&new wW(t,e.errorMessage(t),{binaryOperator:r})}},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"resetState",value:function(){this.phase="SELECT",this.output={},this.aggregationFunctionMap={},this.innerRefColumns={},this.outerRefColumns={},this.firstInnerRef=void 0,this.columnDataTypeAssert={},this.hasGroupByExpression=!1,this.hasPivotExpression=!1}},{key:"visitTree",value:function(e,t){return this.resetState(),this.options=t,this.visit(e)}},{key:"getColumnDataTypeAssert",value:function(){return this.columnDataTypeAssert}},{key:"getReferencedColumns",value:function(){return 0===this.options.refType?this.innerRefColumns:this.outerRefColumns}},{key:"QueryStatement",value:function(e){var t;if(void 0!==e.GroupByClause&&(this.hasGroupByExpression=!0),void 0!==e.PivotClause&&(this.hasPivotExpression=!0),void 0!==e.SelectClause?this.output.select=this.visit(e.SelectClause):this.output.select=this.selectAllColumn(),void 0!==e.WhereClause&&(this.output.where=this.visit(e.WhereClause)),this.hasGroupByExpression&&(this.output.groupBy=this.visit(e.GroupByClause)),this.hasPivotExpression&&(this.output.pivot=this.visit(e.PivotClause)),void 0!==e.OrderByClause&&(this.output.orderBy=this.visit(e.OrderByClause)),void 0!==e.LimitClause&&(this.output.limit=this.visit(e.LimitClause)),void 0!==e.OffsetClause&&(this.output.offset=this.visit(e.OffsetClause)),void 0!==e.LabelClause&&(this.output.label=this.visit(e.LabelClause)),!this.hasGroupByExpression&&null!==(t=this.aggregationFunctionMap.SELECT)&&void 0!==t&&t.size)for(var r=0;r<this.output.select.length;r++){var n=this.output.select[r];this.paramUseAggregationFunction(n,"SELECT")||this.throwError(Ce.O6N.ADD_COL_TO_GROUP_BY_OR_AGG,{columnName:n.name})}return this.output}},{key:"SelectClause",value:function(e){return this.phase="SELECT",void 0!==e[VW.Asterisk]?this.selectAllColumn():this.visitClauseParameter(e.Expression,{getParameterName:function(e){return e.name},getValidParameter:$G})}},{key:"WhereClause",value:function(e){return this.phase="WHERE",[this.visit(e.Expression[0])]}},{key:"GroupByClause",value:function(e){this.phase="GROUP BY",this.isSelectUseAggregationFunction||this.throwError(Ce.O6N.CANNOT_GROUP_WITHOUT_AGG,{keyword:this.phase});for(var t=this.visitClauseParameter(e.Expression,{getParameterName:function(e){return e.name},getValidParameter:$G}),r=0;r<this.output.select.length;r++){var n=this.output.select[r];this.paramUseAggregationFunction(n,"SELECT")||this.haveSameParameter(n,t)||this.throwError(Ce.O6N.ADD_COL_TO_GROUP_BY_OR_AGG,{columnName:n.name})}return t}},{key:"PivotClause",value:function(e){return this.phase="PIVOT",this.isSelectUseAggregationFunction||this.throwError(Ce.O6N.CANNOT_PIVOT_WITHOUT_AGG,{keyword:this.phase}),this.visitClauseParameter(e.Expression,{getParameterName:function(e){return e.name},getValidParameter:$G})}},{key:"OrderByClause",value:function(e){this.phase="ORDER BY";var t=e.OrderByExpression;return this.visitClauseParameter(t,{getParameterName:function(e){return e.parameters[0].name},getValidParameter:LG})}},{key:"LimitClause",value:function(e){return this.phase="LIMIT",[this.visitNumberLiteral(e[VW.NumberLiteral][0],void 0!==e[VW.Minus])]}},{key:"OffsetClause",value:function(e){return this.phase="OFFSET",[this.visitNumberLiteral(e[VW.NumberLiteral][0],void 0!==e[VW.Minus])]}},{key:"LabelClause",value:function(e){this.phase="LABEL";var t=e.LabelExpression;return this.visitClauseParameter(t,{getParameterName:function(e){return e.name},getValidParameter:$G})}},{key:"OrderByExpression",value:function(e){var t,r,n,a=null;a=this.visit(e.Expression[0]),this.isSelectUseAggregationFunction&&(this.haveSameParameter(a,this.output.select)||this.throwError(Ce.O6N.COL_IN_ORDER_MUST_BE_IN_SELECT,{columnName:a.name}));var o=AG.Asc,i=null!==(t=null===(r=e[VW.Asc])||void 0===r||null===(n=r[0])||void 0===n?void 0:n.image)&&void 0!==t?t:"asc";return void 0!==e[VW.Desc]&&(o=AG.Desc,i=e[VW.Desc][0].image),{type:1,name:a.name+" "+i,operator:o,parameters:[a]}}},{key:"LabelExpression",value:function(e){var t=this.visit(e.Expression[0]),r=this.visitStringLiteral(e[VW.StringLiteral][0]),n=this.output.select;return 1===n[0].type&&n[0].operator===AG.SelectAllColumn||this.haveSameParameter(t,n)||this.throwError(Ce.O6N.COL_IN_LABEL_MUST_BE_IN_SELECT,{columnName:t.name}),{type:1,name:r.name,operator:AG.Label,parameters:[t,r]}}},{key:"Expression",value:function(e){return this.visitBinaryOp(e,VW.Or)}},{key:"AndExpression",value:function(e){return this.visitBinaryOp(e,VW.And)}},{key:"IsExpression",value:function(e){var t=this.visit(e.ComparisonExpression);if(void 0!==e[VW.Is]&&void 0!==e[VW.NullLiteral]){var r={type:2,name:e[VW.NullLiteral][0].image,constantType:6,value:null};void 0!==e[VW.Not]&&(r={type:1,name:e[VW.Not][0].image+" "+r.name,operator:AG.Not,parameters:[r]}),t={type:1,name:t.name+" "+e[VW.Is][0].image+" "+r.name,operator:AG.Is,parameters:[t,r]}}return t}},{key:"ComparisonExpression",value:function(e){return this.visitBinaryOp(e,VW.ComparisonOperator)}},{key:"AdditionAndSubtractionExpression",value:function(e){return this.visitBinaryOp(e,VW.AdditionAndSubtraction)}},{key:"MultiplicationAndDivisionAndModuloExpression",value:function(e){return this.visitBinaryOp(e,VW.MultiplicationAndDivisionAndModulo)}},{key:"NotExpression",value:function(e){var t=null,r=e.Literal;Array.isArray(r)&&(t=this.visit(r));var n=e.GroupExpression;Array.isArray(n)&&(t=this.visit(n));var a=e.Function;Array.isArray(a)&&(t=this.visit(a));var o=e[VW.Identifier];if(Array.isArray(o)&&1===o.length&&(t=this.visitColumn(o[0])),null===t)throw new Error;var i=e[VW.Not];return Array.isArray(i)&&(t={type:1,name:i[0].image+t.name,operator:AG.Not,parameters:[t]}),t}},{key:"GroupExpression",value:function(e){var t=this.visit(e.Expression);return{type:1,name:"("+t.name+")",operator:AG.Group,parameters:[t]}}},{key:"Function",value:function(e){var t=e[VW.Identifier][0].image,r=t.toUpperCase();ZG.includes(r)||this.throwError(Ce.O6N.FUNCTION_NO_SUPPORT,{functionName:t});var n=[],a=0,o="";if(Array.isArray(e.argument1)){var i=this.visit(e.argument1[0]);n.push(i),o+=i.name,a++}if(Array.isArray(e.restArguments)){a+=e.restArguments.length;for(var u=0;u<e.restArguments.length;u++){var s=this.visit(e.restArguments[u]);n.push(s),o+=", "+s.name}}var l=t+"("+o+")";if(bG.includes(r)){var c=$G(n[0]);1===a&&0===c.type||this.throwError(Ce.O6N.AGG_CAN_ONLY_TAKE_A_COLUMN_AS_AN_ARGUMENT,{functionName:t,parameterName:o});var h=QG[this.phase];void 0!==h&&this.throwError(h,{keyword:this.phase,functionName:t}),"ORDER BY"===this.phase&&this.hasPivotExpression&&this.throwError(Ce.O6N.NO_AGG_IN_ORDER_WHEN_PIVOT,{functionName:t}),r!==AG.Avg&&r!==AG.Sum||this.appendToColumnDataTypeAssert(c.colIndex,this.avgAndSumParamAssert(l))}if(MG.includes(r)){var f=nj[r];a!==f.count&&this.throwError(f.countError,{scalarFunctionName:t});var d=$G(n[0]);f.check(d)||this.throwError(f.typeError,{scalarFunctionName:t}),0===d.type&&this.appendToColumnDataTypeAssert(d.colIndex,this.scalarParamAssert(l,f.typeError))}var v={type:1,name:l,operator:r,parameters:n};if(bG.includes(r)){var p=this.aggregationFunctionMap[this.phase]||new Set;p.add(v),this.aggregationFunctionMap[this.phase]=p}return v}},{key:"Literal",value:function(e){return void 0!==e[VW.NumberLiteral]?this.visitNumberLiteral(e[VW.NumberLiteral][0],void 0!==e[VW.Minus]):void 0!==e[VW.StringLiteral]?this.visitStringLiteral(e[VW.StringLiteral][0]):void 0!==e[VW.BooleanLiteral]?this.visitBooleanLiteral(e[VW.BooleanLiteral][0]):void 0!==e[VW.DateLiteral]?this.visitDateLiteral(e[VW.DateLiteral][0]):void 0!==e[VW.DateTimeLiteral]?this.visitDateTimeLiteral(e[VW.DateTimeLiteral][0]):this.visitTimeOfDay(e[VW.TimeOfDayLiteral][0])}},{key:"visitColumn",value:function(e){var t,r=e.image;if(r.startsWith("`")&&r.endsWith("`")&&(r=r.slice(1,-1)),0===this.options.refType&&!KG.test(r)){var n,a=null!==(n=this.innerRefColumns[r])&&void 0!==n?n:-1;return-1===a&&(((a=(0,Ce.pen)(r))<this.options.colFrom||a>=this.options.colFrom+this.options.colCount)&&(a=-1),a-=this.options.colFrom),(Number.isNaN(a)||a<0)&&this.throwError(Ce.O6N.NO_COLUM,{columnName:r}),this.innerRefColumns[r]=a,this.firstInnerRef||(this.firstInnerRef=r),{type:0,name:r,colIndex:a}}var o=null!==(t=this.outerRefColumns[r])&&void 0!==t?t:-1;if(-1===o){var i=r.match(XG);null!==i&&(o=Number(i[1])-1)}return(Number.isNaN(o)||o<0)&&this.throwError(Ce.O6N.NO_COLUM,{columnName:r}),0===this.options.refType&&(Object.keys(this.innerRefColumns).length&&this.firstInnerRef&&this.throwError(Ce.O6N.NO_COLUM,{columnName:this.firstInnerRef}),this.options.refType=1),this.outerRefColumns[r]=o,{type:0,name:r,colIndex:o}}},{key:"visitBinaryOp",value:function(e,t){var r=this.visit(e.lhs);if(void 0===e.rhs)return r;for(var n=0;n<e.rhs.length;n++){var a=this.getValidBinaryOperator(e[t][n].tokenType.name);0===r.type&&ej[a]&&this.appendToColumnDataTypeAssert(r.colIndex,this.binaryOpParamAssert(ej[a],e[t][n].image));var o=a===AG.And||a===AG.Or,i=$G(r);!o||1===i.type&&xG.includes(i.operator)||this.throwError(tj[a]);var u=this.visit(e.rhs[n]);0===u.type&&ej[a]&&this.appendToColumnDataTypeAssert(u.colIndex,this.binaryOpParamAssert(ej[a],e[t][n].image));var s=$G(u);!o||1===s.type&&xG.includes(s.operator)||this.throwError(tj[a]),"WHERE"!==this.phase&&xG.includes(a)&&this.throwError(Ce.O6N.LOGICAL_OPERATOR_ONLY_IN_WHERE),(1===i.type&&bG.includes(i.operator)||1===s.type&&bG.includes(s.operator))&&this.throwError(Ce.O6N.AGG_ARE_INCALCULABLE),r={type:1,name:r.name+e[t][n].image+u.name,operator:a,parameters:[r,u]}}return r}},{key:"appendToColumnDataTypeAssert",value:function(e,t){var r=this.columnDataTypeAssert[e]||[];r.push(t),this.columnDataTypeAssert[e]=r}},{key:"visitClauseParameter",value:function(e,t){for(var r=[],n=new Set,a=[],o=0;o<e.length;o++){var i=this.visit(e[o]),u=t.getValidParameter(i),s=t.getParameterName(i);this.haveSameParameter(u,a)&&this.throwError(Ce.O6N.COLUMN_ONLY_ONCE,{keyword:s}),n.add(s),r.push(i),a.push(u)}if("PIVOT"===this.phase){var l,c=yr(this.aggregationFunctionMap.SELECT.values());try{for(c.s();!(l=c.n()).done;){var h=l.value.parameters[0].name;n.has(h)&&this.throwError(Ce.O6N.AGG_IN_SELECT_NO_PIVOT,{columnName:h})}}catch(e){c.e(e)}finally{c.f()}}return r}},{key:"paramUseAggregationFunction",value:function(e,t){var r,n=this;return 1===e.type&&(!(null===(r=this.aggregationFunctionMap[t])||void 0===r||!r.has(e))||null!==e.parameters&&e.parameters.some((function(e){return n.paramUseAggregationFunction(e,t)})))}},{key:"haveSameParameter",value:function(e,t){for(var r=0;r<t.length;r++){var n=t[r];if(this.isSameParameter(e,n))return!0}return!1}},{key:"isSameParameter",value:function(e,t){var r=this;if(e.type!==t.type)return!1;switch(e.type){case 0:if(e.colIndex!==t.colIndex)return!1;break;case 2:if(e.constantType!==t.constantType)return!1;if(e.value instanceof Date&&e.value.getTime()!==t.value.getTime())return!1;if(e.value!==t.value)return!1;break;case 1:return e.operator===t.operator&&(null===e.parameters&&null===t.parameters||null!==e.parameters&&null!==t.parameters&&e.parameters.length===t.parameters.length&&e.parameters.every((function(e,n){return r.isSameParameter(e,t.parameters[n])})))}return!0}},{key:"getValidBinaryOperator",value:function(e){return e===VW.Asterisk?AG.Multiply:e}},{key:"selectAllColumn",value:function(){for(var e=0;e<this.options.colCount;e++){var t=(0,Ce.hdC)(e+this.options.colFrom);this.innerRefColumns[t]=e;var r="Col"+(e+1);this.outerRefColumns[r]=e}return[{type:1,name:"*",operator:AG.SelectAllColumn,parameters:null}]}},{key:"visitNumberLiteral",value:function(e,t){return{type:2,name:t?"-"+e.image:e.image,constantType:0,value:Number(e.image)*(t?-1:1)}}},{key:"visitStringLiteral",value:function(e){var t=e.image;return t.startsWith("`")&&t.endsWith("`")?this.visitColumn(e):(t=t.slice(1,-1),{type:2,name:e.image,constantType:2,value:t})}},{key:"visitBooleanLiteral",value:function(e){var t="TRUE"===e.image.toUpperCase();return{type:2,name:e.image,constantType:1,value:t}}},{key:"visitDateLiteral",value:function(e){var t,r,n,a=e.image,o=a.match(/date\s+'(\d+\.?\d*)'/i);if(o&&o[1]){var i=we.SheetDate.fromNumber(Number(o[1])).getUTCDate();return i&&Number.isFinite(i.getTime())||this.throwError(Ce.O6N.DATE_LITERAL_FORMATTER_ERROR),{type:2,name:a,constantType:3,value:i}}var u=a.match(YG),s=null!==(t=u&&(null!==(r=u[2])&&void 0!==r?r:u[3]))&&void 0!==t?t:"";""===s&&this.throwError(Ce.O6N.DATE_LITERAL_FORMATTER_ERROR);var l=null===(n=we.SheetDate.fromString(s+" 00:00:00"))||void 0===n?void 0:n.getUTCDate();return l&&Number.isFinite(l.getTime())||this.throwError(Ce.O6N.DATE_LITERAL_FORMATTER_ERROR),{type:2,name:a,constantType:3,value:l}}},{key:"visitDateTimeLiteral",value:function(e){var t,r,n,a=e.image,o=a.match(/datetime\s+'(\d+\.?\d*)'/i);if(o&&o[1]){var i=we.SheetDate.fromNumber(Number(o[1])).getUTCDate();return i&&Number.isFinite(i.getTime())||this.throwError(Ce.O6N.DATETIME_LITERAL_FORMATTER_ERROR),{type:2,name:a,constantType:4,value:i}}var u=a.match(qG),s=null!==(t=u&&(null!==(r=u[2])&&void 0!==r?r:u[3]))&&void 0!==t?t:"";""===s&&this.throwError(Ce.O6N.DATETIME_LITERAL_FORMATTER_ERROR);var l=null===(n=we.SheetDate.fromString(s))||void 0===n?void 0:n.getUTCDate();return l&&Number.isFinite(l.getTime())||this.throwError(Ce.O6N.DATETIME_LITERAL_FORMATTER_ERROR),{type:2,name:a,constantType:4,value:l}}},{key:"visitTimeOfDay",value:function(e){var t,r,n,a=e.image,o=a.match(JG),i=null!==(t=o&&(null!==(r=o[2])&&void 0!==r?r:o[3]))&&void 0!==t?t:"";""===i&&this.throwError(Ce.O6N.TIMEOFDAY_LITERAL_FORMATTER_ERROR);var u=null===(n=we.SheetDate.fromString(jG+" "+i))||void 0===n?void 0:n.getUTCDate();return u&&Number.isFinite(u.getTime())||this.throwError(Ce.O6N.TIMEOFDAY_LITERAL_FORMATTER_ERROR),{type:2,name:a,constantType:5,value:u}}},{key:"throwError",value:function(e,t){throw new wW(e,this.errorMessage(e),t)}},{key:"errorMessage",value:function(e){return"[Sheet Query Formula Error]: "+e}},{key:"isSelectUseAggregationFunction",get:function(){var e;return!(null===(e=this.aggregationFunctionMap.SELECT)||void 0===e||!e.size)}}]),t}(e)}(e.getBaseCstVisitorConstructor());WG=new t}return WG}function oj(e,t){var r=_G(e);if(Array.isArray(r.errors)&&0!==r.errors.length)return{error:new wW(Ce.O6N.PARSE_ERROR,r.errors[0].message)};var n=(null===RG&&(RG=new VG),RG),a=n.parse(r.tokens);if(Array.isArray(n.errors)&&0!==n.errors.length)return{error:new wW(Ce.O6N.PARSE_ERROR,n.errors[0].message)};var o=aj(n);try{return{result:o.visitTree(a,t),columnDataTypeAssert:o.getColumnDataTypeAssert(),referencedColumns:o.getReferencedColumns()}}catch(e){return{error:e}}}function ij(e,t){if(!t)return null;switch(e){case AG.Year:return t.getUTCFullYear();case AG.Month:return t.getUTCMonth()+1;case AG.Day:return t.getUTCDate()}return null}function uj(e,t,r){if(null===t||null===r)return null;switch(e){case AG.Plus:return t+r;case AG.Minus:return t-r;case AG.Multiply:return t*r;case AG.Divide:return t/r;case AG.Modulo:return t%r}return null}var sj=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"toArray",value:function(e){for(var t=[],r=0;r<this.size;r++)(null==e?void 0:e.has(r))||t.push(this.nth(r));return t}}]),e}(),lj=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e,n.size=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"nth",value:function(e){return this.value}}]),t}(sj),cj=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e,r.size=r.value.length,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"nth",value:function(e){var t;return null!==(t=this.value[e])&&void 0!==t?t:null}}]),t}(sj),hj=function(e){function t(e,r,n){var a;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this))).op=e,a.left=r,a.right=n,a.size=r.size,a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"nth",value:function(e){return uj(this.op,this.left.nth(e),this.right.nth(e))}}]),t}(sj),fj=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this))).op=e,n.arg=r,n.size=n.arg.size,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"nth",value:function(e){var t;return null!==(t=ij(this.op,this.arg.nth(e)))&&void 0!==t?t:null}}]),t}(sj);function dj(e,t,r,n){if(null===t||null===r)return e===AG.NotEqual?t!==r:t===r;switch(n&&(t instanceof Date&&(t=we.SheetDate.from({year:t.getFullYear(),month:t.getMonth()+1,date:t.getDate()}).getUTCDate()),r instanceof Date&&(r=we.SheetDate.from({year:r.getFullYear(),month:r.getMonth()+1,date:r.getDate()}).getUTCDate())),e!==AG.Like&&(t instanceof Date&&(t=t.getTime()),r instanceof Date&&(r=r.getTime())),e){case AG.GreaterThan:return t>r;case AG.LessThan:return t<r;case AG.GreaterThanEqual:return t>=r;case AG.LessThanEqual:return t<=r;case AG.Equal:return t===r;case AG.NotEqual:return t!==r;case AG.Like:return function(e,t){return e=vj(e),XP((t=vj(t)).replace(/~|\?|\*/g,"~$1").replace(/%/g,"*").replace(/_/g,"?")).test(e)}(t,r)}return!1}function vj(e){return"string"==typeof e?e:null==e?"":e.toString()}var pj=function e(){(0,y.Z)(this,e)},mj=function(e){function t(e,r,n){var a;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this))).op=e,a.left=r,a.right=n,a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calc",value:function(e){var t=this.left.calc(e),r=this.right.calc(e);return uj(this.op,t,r)}}]),t}(pj),gj=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this))).op=e,n.value=r,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calc",value:function(e){return ij(this.op,this.value.calc(e))}}]),t}(pj),yj=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).value=e,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calc",value:function(e){var t;return 0===this.value.type?null!==(t=e[this.value.colIndex])&&void 0!==t?t:null:this.value.value}}]),t}(pj);function _j(e,t){if(1!==e.type)return new yj(e);if(MG.includes(e.operator))return new gj(e.operator,_j($G(e.parameters[0])));if(!FG.includes(e.operator))throw Error("where condition is error, please recheck your input");var r=$G(e.parameters[0]),n=$G(e.parameters[1]);return new mj(e.operator,_j(r),_j(n))}var Rj=function e(){(0,y.Z)(this,e)},Cj=function(e){function t(e,r,n){var a;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this))).op=e,a.left=r,a.right=n,a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exec",value:function(e){var t=2===this.left.type&&3===this.left.constantType||2===this.right.type&&3===this.right.constantType;return dj(this.op,_j(this.left).calc(e),_j(this.right).calc(e),t)}}]),t}(Rj),wj=function(e){function t(e,r,n){var a;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this))).op=e,a.left=r,a.right=n,a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"exec",value:function(e){return function(e,t,r,n){switch(e){case AG.And:return t.exec(n)&&r.exec(n);case AG.Or:return t.exec(n)||r.exec(n)}return!1}(this.op,this.left,this.right,e)}}]),t}(Rj);function Ej(e,t){if(!e)return null;var r=[];if(1===e.type){var n=e.parameters;if(!n||0===n.length)return null;n.forEach((function(e){var n=Ej($G(e),t);n&&r.push(n)}))}if(2===e.type){var a=t.rowCount;return new lj(e.value,a)}if(0===e.type)return new cj(t.valueMatrix[e.colIndex]);if(1===e.type){var o=e.operator;if(FG.includes(o)){var i=r[0],u=r[1];return(null==i?void 0:i.size)!==(null==u?void 0:u.size)?null:new hj(o,i,u)}if(MG.includes(o))return new fj(o,r[0])}return null}function kj(e,t){var r={},n=e.select,a=e.groupBy,o=e.pivot,i=e.orderBy,u=function(e){if(!r[e.name]&&1===e.type){var n=Ej($G(e),t);n&&(r[e.name]=n)}};return null!=n&&n.forEach(u),null!=a&&a.forEach(u),null!=o&&o.forEach(u),null!=i&&i.forEach((function(e){return u(e.parameters[0])})),r}function Tj(e){var t=$G(e.parameters[0]),r=$G(e.parameters[1]);if(e.operator===AG.Is)return function(e,t){return 1===t.type&&t.operator===AG.Not?new Cj(AG.NotEqual,e,t.parameters[0]):new Cj(AG.Equal,e,t)}(t,r);if([AG.And,AG.Or].includes(e.operator)){var n=Tj(t),a=Tj(r);return new wj(e.operator,n,a)}return new Cj(e.operator,t,r)}var Sj=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,null,[{key:"pivotViewGeneratorFromDataSource",value:function(t,r){var n=e.pivotCacheGenerator("cache",t),a=e.queryCubeGenerator(n,r);return e.pivotViewGenerator(n,a,r)}},{key:"pivotCacheGenerator",value:function(e,t){var r=(0,Ft._R)(t,{});return new Ft.SL(e,r,t.slice(1))}},{key:"queryCubeGenerator",value:function(e,t){var r=(0,Rt.Mp)(t),n=(0,Rt.J0)(t);return new Ft.mx(e,r,n)}},{key:"pivotViewGenerator",value:function(e,t,r){var n=new Rt.bY,a=new Rt.pq({service:n,getName:function(){return""}},"");a.fromJSON(r),n.setCacheForService(a.getCacheName(),e);var o=new Rt.b$;(0,Rt.NK)(t,a,o,{errorValueShowAs:"",emptyValueShowAs:"Error"});var i=(0,Rt.o_)(e,a);return o.setFormatMap(i),delete a._host,o.toJSON()}}]),e}(),Aj=(tt={},(0,l.Z)(tt,AG.Avg,Ft.wl.average),(0,l.Z)(tt,AG.Count,Ft.wl.count),(0,l.Z)(tt,AG.Max,Ft.wl.max),(0,l.Z)(tt,AG.Min,Ft.wl.min),(0,l.Z)(tt,AG.Sum,Ft.wl.sum),tt);function Ij(e,t,r,n){var a=function(e,t){var r=e.select,n=e.groupBy,a=e.pivot,o=[],i=[],u=[],s=new Set;return null!=n&&n.forEach((function(e){if(0===(e=$G(e)).type||1===e.type&&t[e.name]){var r=UG(e.name);i.push({cacheFieldId:r,sourceName:r,fieldName:r,fieldType:Rt.Tj.dim}),s.add(r)}})),null!=r&&r.forEach((function(e){var t=UG((e=$G(e)).name);1===e.type&&bG.includes(e.operator)?o.push({cacheFieldId:UG(e.parameters[0].name),sourceName:UG(e.parameters[0].name),fieldName:t,fieldType:Rt.Tj.measure,summaryType:Aj[e.operator]}):s.has(t)||i.push({cacheFieldId:t,sourceName:t,fieldName:t,fieldType:Rt.Tj.dim})})),null!=a&&a.forEach((function(e){var t=UG((e=$G(e)).name);u.push({cacheFieldId:t,sourceName:t,fieldName:t,fieldType:Rt.Tj.dim})})),{dim:{page:[],hide:[],row:i,col:u},measure:o,cacheName:"",valuePosition:1,valueIndex:1,hiddenTotalInfo:{row:!0,col:!0,fieldDefault:!0},collapseInfo:{},repeatLabelInfo:{}}}(e,r),o={data:PG(t,r,n),formatMap:{}};return{fieldsModel:a,viewDataModel:Sj.pivotViewGeneratorFromDataSource(o.data,a)}}function Oj(e,t){var r={0:function(e){return Number(e)},2:function(e){return Number(e)},4:function(e){return Boolean(e)},3:function(e){return null},1:function(e){return e}};return e.map((function(e,n){return r[t[n]](e)}))}function Vj(e,t,r){var n=e.row,a=e.col,o=e.value,i={titles:{},values:[[]]},u=!!t.dim.row.length,s=!!t.dim.col.length,l=a.pivotInfos;if(!u&&s){var c=n.pivotInfos.map((function(e){return e.valueFieldName})),h=function(e){var t=l[e];t.fieldName.forEach((function(e,n){var a=HG(e);if(r[a]){var o,i,u=Number(t.items[n]);isNaN(u)||(t.items[n]=null!==(o=null===(i=r[a])||void 0===i?void 0:i.getDisplayText(u))&&void 0!==o?o:"")}}))};for(var f in l)h(f);for(var d in c){var v,p=null!==(v=c[d])&&void 0!==v?v:t.measure[0].fieldName;for(var m in i.titles[p]||(i.titles[p]=[]),l){var g=(l[m].items.join(" ")+" "+p).trimLeft(),y=Number(d)*a.range.colCount+Number(m);i.titles[p].push({value:g,colIndex:y}),i.values[0][y]=o.dataTable[Number(d)][Number(m)].value}}return i}var _=n.range.colCount;for(var R in l){var C,w=l[R],E=w.items,k=w.valueFieldName,T=(E.join(" ")+" "+(null!==(C=k)&&void 0!==C?C:"")).trimLeft(),S=_+Number(R);if(k)i.titles[k]||(i.titles[k]=[]),i.titles[k].push({value:T,colIndex:S});else{var A=t.measure[0].fieldName;i.titles[A]||(i.titles[A]=[]),i.titles[A].push({value:T,colIndex:S})}}return i.values=function(e){var t=e.dataTable,r=[];for(var n in t){var a=Number(n);for(var o in r[a]||(r[a]=[]),t[n]){var i,u=Number(o);isNaN(u)||(r[a][u]=null!==(i=t[n][o].value)&&void 0!==i?i:null)}}return r}(o),i}function Nj(e){var t=[];for(var r in e)Array.isArray(e[r])?e[r].forEach((function(e){var r=e.value,n=e.colIndex;t[n]=r})):t[e[r]]=r;return t}function bj(e,t,r){for(var n=function(e,t,r){var n=e.corner,a=e.row,o=e.col,i={titles:{},values:[]};if(!t.dim.row.length)return i;var u=o.range.rowCount-1,s=n.dataTable[u];for(var l in s){var c=s[l].value;c&&"string"==typeof c&&(i.titles[c]=Number(l))}for(var h=a.range.rowCount,f=a.range.colCount,d=0;d<h;d++){var v=a.pivotInfos[d],p=v.items,m=v.types;p.length===f&&i.values.push(Oj(p,m))}return i}(e,t),a=Vj(e,t,r),o=Object.assign(n.titles,a.titles),i=Nj(o),u=[],s=0;s<a.values.length;s++){var l,c;u[s]=[].concat(null!==(l=n.values[s])&&void 0!==l?l:[],null!==(c=a.values[s])&&void 0!==c?c:[])}return{fieldNameColumnInfos:o,titles:i,valueMatrix:u}}function Mj(e,t,r){for(var n=e[r-t];n<r;)n=e[n-t];return n}function Fj(e,t,r,n){return e.sort((function(e,a){return function(e,t,r,n,a){for(var o=0,i=0;i<n.length;i++){if(n[i]){var u=n[i],s=u.index,l=u.ascending;if(0<=s){var c=void 0,h=void 0,f=r?e:s,d=r?s:e,v=r?t:s,p=r?s:t;a?(c=a[f][d],h=a[v][p]):(c=this.getCellToSortValue(f,d),h=this.getCellToSortValue(v,p)),o=ug(c,h,l)}}if(0!==o)break}return o}(e,a,t,r,n)}))}var Zj=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getCellToSortValue",value:function(e,t){return sg(this.getValue(e,t))}},{key:"_sortRange",value:function(e,t,r,n,a,o){try{return this.suspendEvent(),function(e,t,r,n,a,o,i,u){var s,l,c=o?n:a,h=o?t:r,f=[];for(s=0;s<c;s++)f[s]=h+s;var d=[];if(o)for(l=f.length-1;l>=0;l--){var v=f[l];(e._isRowFilterOut&&e._isRowFilterOut(v)||!e.getRowVisible(v))&&(f.splice(l,1),d.push({_index:l,_value:v}))}if(f=Fj(f,o,i,u),o)for(l=d.length-1;l>=0;l--){var p=d[l];f.splice(p._index,0,p._value)}return f}(this,e,t,r,n,a,o,this.getCellValueCache(e,r,t,n))}catch(e){throw e}finally{(0,Ce.$1K)().clearPinyinCache(),this.resumeEvent()}}},{key:"getCellValueCache",value:function(e,t,r,n){for(var a=[],o=e;o<e+t;o++){a[o]=[];for(var i=r;i<r+n;i++)a[o][i]=this.getCellToSortValue(o,i)}return a}},{key:"iterSortedRangeToSwapNode",value:function(e,t,r,n,a,o){var i,u,s,l,c=this._getModel();o?(i=e,u=e+t,s=r,l=r+n):(i=r,u=r+n,s=e,l=e+t);for(var h,f=0,d=0,v=0,p=0,m=i;m<u;m++)if(m!==(h=Mj(a,i,m))){o?(f=m,v=h):(d=m,p=h);for(var g=s;g<l;g++)o?(d=g,p=g):(f=g,v=g),c.swapNode(f,d,v,p)}}},{key:"iterSortedRangeToUpdateFormula",value:function(e,t,r,n,a,o){var i=this,u=[],s=new qd,l=this.getCalcEngine();return n.forEach((function(n,c){var h=n,f=c+r;if(f!==h){var d=u[u.length-1];(a?null==d?void 0:d.endRow:null==d?void 0:d.endCol)===h?a?d.endRow++:d.endCol++:u.push(a?new Qi(h,h+1,e,t,o):new Qi(e,t,h,h+1,o));for(var v=e;v<t;v++){var p=v,m=v;a?p=f:m=f;var g=i.getVar(p,m);if(g.isFormula()){var y=i._updateFmlSpaceWatch(g,p,m);s.set(p,m,l.formulaRefService.formulaRefPool.add({formula:y.formula,refMap:y.getRefMap()}))}}}})),[u,s]}},{key:"_updateFmlSpaceWatch",value:function(e,t,r){var n=e.getRef();return n.setRowFrom(t),n.setColFrom(r),this._getModel().setVar(t,r,e),e}}]),t}(HM);function xj(e,t,r){var n=[e[r],e[t]];e[t]=n[0],e[r]=n[1]}function Dj(e,t,r){e.forEach((function(e){var n=[e[r],e[t]];e[t]=n[0],e[r]=n[1]}))}function Pj(e,t){e.splice(t,1)}function $j(e,t){e.forEach((function(e){e.splice(t,1)}))}function Lj(e,t,r,n){if(e.includes(void 0))throw Error("changeList value cannot be undefined");for(var a=0,o=e.length;a<o;a++)for(var i=e[a];a!==e[a];i=e[a])t?xj(r,i,e[i]):(Dj(r,i,e[i]),n&&xj(n,i,e[i])),xj(e,a,i)}function Bj(e,t){for(var r=t.fieldNameColumnInfos,n=t.valueMatrix,a=t.titles,o=function(e,t){var r,n,a=t.fieldNameColumnInfos,o=t.titles,i={};if(1===(null===(r=e[0])||void 0===r?void 0:r.type)&&(null===(n=e[0])||void 0===n?void 0:n.operator)===AG.SelectAllColumn){for(var u=0,s=0;u<o.length;u++)/^\$\$_(Col[0-9]*|[A-Z]+)_\$\$$/.exec(o[u])&&(i[o[u]]=s++);return i}for(var l=function(t,r){var n=UG(e[t].name);a[n]&&Array.isArray(a[n])?a[n].forEach((function(e){var t=e.value;i[t]=r++})):i[n]=r++,h=r},c=0,h=0;c<e.length;c++)l(c,h);return i}(e,{fieldNameColumnInfos:r,titles:a}),i=[],u=0;u<a.length;u++){var s=o[a[u]];void 0!==s?i[s]=u:($j(n,u),Pj(a,u--))}return i}function Uj(e,t){Lj(function(e,t){for(var r=t.titles,n=t.valueMatrix,a=e.map((function(e){var t=e=$G(e),n=t.parameters,a=t.operator;return{index:r.findIndex((function(e){return e===UG(n[0].name)})),ascending:a===AG.Asc}})),o=new Array(n.length),i=0;i<n.length;i++)o[i]=i;return Fj(o,!0,a,n)}(e,t),!0,t.valueMatrix)}function Hj(e,t){var r=e.select,n=e.orderBy;return n&&Uj(n,t),r&&function(e,t){Lj(Bj(e,t),!1,t.valueMatrix,t.titles)}(r,t),t}function zj(e,t,r){var n,a=kj(t,r),o=function(e,t){if(e){for(var r=new Set,n=Tj($G(e[0])),a=function(e){var a=[];t.valueMatrix.forEach((function(t,r){a[r]=t[e]})),n.exec(a)||r.add(e)},o=0;o<t.rowCount;o++)a(o);return r}}(t.where,r),i=function(e){if(e&&e.length){var t={};return e.forEach((function(e){var r=e.parameters,n=UG(r[0].name),a=r[1];t[n]=a.value})),t}}(t.label);if(function(e){var t=e.select,r=e.groupBy;if(null!=r&&r.length)return!0;if(null!=t&&t.length)for(var n=0;n<t.length;n++){var a=$G(t[n]);if(1===a.type&&bG.includes(a.operator))return!0}return!1}(t)){var u=Ij(t,r,a,o);n=bj(u.viewDataModel,u.fieldsModel,r.formatterMap)}else n=function(e,t,r){var n=DG(e,t,r),a={};for(var o in e.referencedColumns)a[UG(o)]=e.referencedColumns[o];return{valueMatrix:n,titles:Nj(a),fieldNameColumnInfos:a}}(r,a,o);return n=Hj(t,n),n=function(e,t,r){var n=r.valueMatrix.length,a=n,o=0;if(e){var i=e[0].value;i>=0&&i<n&&(a=i)}if(t){var u=t[0].value;u>=0&&u<=n?o=u:u>n&&(o=n)}return r.valueMatrix=r.valueMatrix.slice(o,a+o),r}(t.limit,t.offset,n),function(e,t,r,n){var a,o,i=e.titles,u=e.valueMatrix,s=t.refNameTitleMap,l=t.formatterMap,c=[];if(Object.keys(s).length>0){var h;c[0]=[];for(var f=Object.entries(null!==(h=r)&&void 0!==h?h:{}),d=0;d<i.length;d++){for(var v=i[d],p=0;p<f.length;p++){var m=(0,g.Z)(f[p],2),y=m[0],_=m[1];v.includes(y)&&(v=v.replace(y,_))}v=HG(v,s),c[0][d]=new it.StringVar(v)}}for(var R=i.length,C=0;C<u.length;C++){for(var w=u[C],E=[],k=0;k<R;k++){var T,S=Ky(w[k]);if(null!==S){var A=HG(i[k]);!(null!=S&&S.isNull())&&l[A]&&null!=S&&S.setSpecialInfo({customData:{autoFormat:null===(T=l[A])||void 0===T?void 0:T.getFormatCode()}}),E.push(S)}else E.push(it.NULL_VAR)}c.push(E)}return 0===c.length||0===c[0].length?CW(Ce.O6N.NO_QUERY_OUTPUT,""):(null!=n&&n.info&&null!==(a=c[0][0].getSpecialInfo())&&void 0!==a&&a.customData&&(n.info.customData=null===(o=c[0][0].getSpecialInfo())||void 0===o?void 0:o.customData),new gs(c))}(n,r,i,e)}var Wj=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=3,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[33,260,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[2]?t[2].getValue():null,a=ro(r)?0:1,o=oj(t[1]?t[1].getValue():"",{refType:a,colFrom:ro(r)?r.getRef().startCol:0,colCount:r.colCount()}),i=o.error,u=o.result,s=o.columnDataTypeAssert,l=o.referencedColumns;if(i)return CW(i.code,i.message,i.args);var c=kW(r,{rowFrom:0,columnDataTypeAssert:s,referencedColumns:l,headerCount:n,ctx:e});return c instanceof it.ErrorVar?c:zj(e,u,{valueMatrix:c.dataMatrix,formatterMap:c.formatterMap,rowCount:c.rowCount,referencedColumns:l,refNameTitleMap:c.refNameTitleMap})}}]),t}(pw("QUERY",1,2,0,Md|Ld,[YE.MATRIX_AND_SHEET_REF,{type:Nd,default:new it.StringVar("")},{type:Vd|Od,default:it.NULL_VAR}]));Wj=Vu([Cp("QUERY")],Wj);var Gj=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),t}(pw("",0,0,0,Nd,[]));function jj(e,t){if(!function(e){return!(/\(\?<=.*?\)/g.test(e)&&!/\[.*?(\?<=.*?)\]/g.test(e)||/\(\?<!.*?\)/g.test(e)&&!/\[.*?(\?<!.*?)\]/g.test(e))}(e))return{regExp:null,error:Ce.d$b[Ce.O6N.REF_INVALID_REGULAR_EXPRESSION]()};try{var r=t?new RegExp(e,"ug"):new RegExp(e,"u");return ar()(r)?{regExp:r,error:null}:{regExp:null,error:Ce.d$b[Ce.O6N.REF_UNSAFE_REGULAR_EXPRESSION]()}}catch(e){return{regExp:null,error:Ce.d$b[Ce.O6N.REF_INVALID_REGULAR_EXPRESSION]()}}}var Yj=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="REGEXMATCH",e.operands=2,e.resultType=Nd,e.paramsDesc=[{type:Nd},{type:Nd}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[260,260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=jj(t[1].getValue(),!1);if(r.error)return r.error;var n=r.regExp.test(t[0].getValue());return new it.BooleanVar(n)}}]),t}(Gj),qj=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="REGEXEXTRACT",e.operands=2,e.resultType=Nd|Zd,e.paramsDesc=[{type:Nd|Zd},{type:Nd}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[260,260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=jj(t[1].getValue(),!1);if(r.error)return r.error;var n=t[0].getValue().match(r.regExp);if(!n||Array.isArray(n)&&n.length<=0)return Ce.d$b[Ce.O6N.NA_REGULAR_EXPRESSION_NO_MATCH]();var a=n.length;if(a>1){for(var o=[],i=1;i<a;i++)o.push(new it.StringVar(n[i]||""));return new gs([o])}return new it.StringVar(n[0])}}]),t}(Gj);qj=Vu([Cp("REGEXEXTRACT")],qj);var Jj=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="REGEXREPLACE",e.operands=3,e.resultType=Nd,e.paramsDesc=[{type:Nd},{type:Nd},{type:Nd}],e.$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[260,260,260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=jj(t[1].getValue(),!0);if(r.error)return r.error;var n=t[0].getValue(),a=t[2].getValue(),o=n.replace(r.regExp,a);return new it.StringVar(o)}}]),t}(Gj);function Kj(e,t){var r=e.getValue(),n=0|t.getValue();return{num:MZ(r,n),dec:Math.max(0,n)}}var Xj,Qj=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,259,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0],a=t[1]&&za(t[1])?t[1]:new it.NumberVar(2),o=!!t[2]&&t[2].getValue();if(a.getValue()>127)return _l(this.name,2,a.getValue(),127);var i=null===(r=e.service.spread)||void 0===r?void 0:r.formatterService;if(!i)return it.VALUE_ERR_VAR;var u=Kj(n,a),s=u.num,l=u.dec,c=i.getFormatter(zy(l,!o)[1]),h=i.getFormattedText(c,s);return new it.StringVar(h)}}]),t}(pw("FIXED",1,2,0,Nd,[{type:Vd,default:new it.NumberVar(0)},{type:Vd,default:new it.NumberVar(2)},{type:bd,default:it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE]}])),eY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n,a=t[1]&&za(t[1])?t[1]:new it.NumberVar(2);if(a.getValue()>127)return _l(this.name,2,a.getValue(),127);var o=null===(r=e.service.spread)||void 0===r?void 0:r.formatterService;if(!o)return it.VALUE_ERR_VAR;var i="USD";if(null===(n=e.service.spread)||void 0===n?void 0:n.locale){var u,s=(0,Ce.sBS)(null===(u=e.service.spread)||void 0===u?void 0:u.locale);s&&(i=s[0])}var l=Kj(t[0],a),c=l.num,h=zy(l.dec,!0,i)[1],f=o.getFormatter("".concat(h,";(").concat(h,")")),d=o.getFormattedText(f,c);return new it.StringVar(d)}}]),t}(pw("DOLLAR",1,1,0,Nd,[{type:Vd,default:new it.NumberVar(0)},{type:Vd,default:new it.NumberVar(2)}])),tY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue().toLowerCase().replace(/(^|\b|\W|\d|_)[a-z]/g,(function(e){return e.toUpperCase()}));return new it.StringVar(r)}}]),t}(pw("PROPER",1,0,0,Nd,[{type:Nd,default:new it.StringVar("")}])),rY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="RANK.EQ",e}return(0,p.Z)(t,e),t}(ez),nY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="RANK.AVG",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getCompareValue(),n=!t[2]||!1===t[2].getValue(),a=XH(0,t[1],r,n,!0);return a.err||(a.exist?new it.NumberVar(a.rankNum):Yl(this.name))}}]),t}(ez);function aY(e,t){var r=e.ref;return r.hostId===t.hostId&&r.startRow===t.startRow&&r.startCol===t.startCol}!function(e){e.ADDRESS="ADDRESS",e.COL="COL",e.CONTENTS="CONTENTS",e.FORMAT="FORMAT",e.PREFIX="PREFIX",e.ROW="ROW",e.TYPE="TYPE",e.WIDTH="WIDTH"}(Xj||(Xj={}));var oY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$cacheType=0,e.$$expanded=!0,e.$$paramsDesc=[260,64],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue().toUpperCase(),n=t[1],a=n?n.getRef():e.ref,o=Ps(e.workbook,a);if(!o)return it.VALUE_ERR_VAR;a.hostName||(a.hostName=o.name());var i=a.startRow,u=a.startCol;switch(r){case Xj.ADDRESS:var s="".concat(function(e,t){var r=e.sheetName||e.hostName;return!r||t&&e.hostId===t?"":Bo(r)+"!"}(a,e.ref.hostId),"$").concat((0,Ce.hdC)(u),"$").concat(i+1);return new it.StringVar(s);case Xj.COL:return new it.NumberVar(u+1);case Xj.CONTENTS:return!n||aY(e,a)?Ce.aHq:Zs([new Fs(new Qi(i,i+1,u,u+1,a.hostId,a.hostName,a.status))],(function(e){return e[0].at(0,0)}));case Xj.FORMAT:var l=function(e,t,r,n,a){return t?function(e,t){var r=Ps(e.workbook,t);return r?aY(e,t)?r.getCellFormatter(t.startRow,t.startCol):r.getActualFormatter(t.startRow,t.startCol,e):null}(e,t):r.getCellFormatter(n,a)}(e,a,o,i,u);return l?function(e){if((0,Ee.isGeneralFormatter)(e)||(0,Ee.isTextFormatter)(e))return new it.StringVar("G");var t=e.getFormatCode(),r=function(e){var t=e.split(";")[0].replace(/_\(/g,"");return/\(/.test(t)}(t)?"()":"";if((0,Ee.isDigitalFormatter)(e)){var n=e.getFormatters()[0],a=(0,Ee.getDigitalFormatterDecimalState)(n).decimalSize;if(/^0(\.0+)?%$/.test(t))return new it.StringVar("P"+a+r);if(/^0(\.0+)*E\+00$/.test(t))return new it.StringVar("S"+a+r);if(!/%|(E\+00)/.test(t))return(0,Ce.MFi)().test(t)?new it.StringVar("C"+a+r):/#,##/.test(t)?new it.StringVar(","+a+r):new it.StringVar("F"+a+r)}return Ce.d$b[Ce.O6N.CELL_FORMAT_NO_MATCH]()}(l):new it.StringVar("G");case Xj.PREFIX:return function(e){return e===Ce.KqL.Left?new it.StringVar("'"):e===Ce.KqL.Right?new it.StringVar('"'):e===Ce.KqL.Center?new it.StringVar("^"):new it.StringVar("")}(o.getStyle(i,u)._hAlign);case Xj.ROW:return new it.NumberVar(i+1);case Xj.TYPE:return!n||aY(e,a)?Ce.aHq:Zs([new Fs(new Qi(i,i+1,u,u+1,a.hostId,a.hostName,a.status))],(function(e){return function(e,t){return t.isNull()?new it.StringVar("b"):t.isString()?new it.StringVar("l"):new it.StringVar("v")}(0,e[0].at(0,0))}));case Xj.WIDTH:var c=o.getColumnWidth(u),h=o.defaults.colWidth,f=Math.round((c-5)/7),d=c===h;return new gs([[new it.NumberVar(f),new it.BooleanVar(d)]]);default:return Ce.d$b[Ce.O6N.INVALID_CELL_INFO_TYPE]({funcName:this.name,num:1,errorValue:r,correctValue:'"'.concat(Object.keys(Xj).join('", "'),'"')})}}}]),t}(pw("CELL",1,1,0,Nd||Vd||Zd,[{type:Nd},{type:Zd}]));oY=Vu([Cp("CELL")],oY);var iY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=4,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[32,32,265,265],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1]||it.NULL_VAR,a=!t[2]||!Ga(t[2])||t[2].getValue(),o=!(!t[3]||!Ga(t[3]))&&t[3].getValue(),i=WL(r,n,this.name,a);return i.error?i.error:i.type===ZL.SIMPLE?function(e,t,r,n,a,o){var i=cB(e,t,r,n,a,!1);if(i.error)return i.error;var u=i.knownYArray,s=i.weights,l=i.knownXArray;if(isNaN(s[0][0]))return Ce.d$b[Ce.O6N.TREND_POINT_NUM_UNENOUGHT]({funcName:n,expectedNum:2,receivedNum:1});var c=oB(s);if(!o)return new gs(c);var h,f,d,v=qL(u),p=qL(l),m=u.length,g=iB(l,s),y=KL(u,g),_=JL(g,v,a);if(a){h=aB(m,2);var R=JL(l,p,!0);f=new it.NumberVar(XL(y,R,h)),d=new it.NumberVar(QL(y,p,R,h,m))}else{h=aB(m,1);var C=JL(l,0,!1);f=new it.NumberVar(XL(y,C,h)),d=Ce.d$b[Ce.O6N.LINEST_NO_STATISTICAL_INFO]()}var w=new it.NumberVar(eB(_,y)),E=h&&y?new it.NumberVar(rB(_,y,h)):Ys,k=new it.NumberVar(tB(y,h));return c.push([f,d],[w,k],[E,new it.NumberVar(h)],[new it.NumberVar(_),new it.NumberVar(y)]),new gs(c)}(e,r,n,this.name,a,o):function(e,t,r,n,a,o){var i=hB(e,t,r,n,a,!1);if(i.error)return i.error;var u=i.knownYMatrix,s=i.weights,l=i.knownXMatrix,c=i.inverseMatrix,h=s[0].length,f=oB(s);if(!o)return new gs(f);for(var d=[],v=u.flat(),p=qL(v),m=v.length,g=sB(l,s),y=KL(v,g),_=JL(g,p,a),R=h-1,C=c.length,w=aB(m,C),E=w?new it.NumberVar(nB(_,R,y,w)):Ys,k=new it.NumberVar(eB(_,y)),T=new it.NumberVar(tB(y,w)),S=Ce.d$b[Ce.O6N.LINEST_NO_STATISTICAL_INFO](),A=[E,new it.NumberVar(w),S],I=[k,T,S],O=[new it.NumberVar(_),new it.NumberVar(y),S],V=C-1;V>=0;V--)w?d.push(new it.NumberVar(Math.sqrt(y/w*c[V][V]))):d.push(new it.NumberVar(0)),V<C-2&&(A.push(S),I.push(S),O.push(S));if(a){var N=d.shift();d.push(N)}else d.push(S);return f.push(d,I,A,O),new gs(f)}(e,r,n,this.name,a,o)}}]),t}(pw("LINEST",1,3,0,Zd,[{type:Zd|Fd},{type:Zd|Fd,default:it.NULL_VAR},{type:bd,default:new it.BooleanVar(!0)},{type:bd,default:new it.BooleanVar(!1)}]));iY=Vu([Cp("LINEST")],iY);var uY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=4,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[32,32,32,265],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1]||it.NULL_VAR,a=!t[3]||!Ga(t[3])||t[3].getValue(),o=t[2]||it.NULL_VAR,i=WL(r,n,this.name,a,o);return i.error?i.error:i.type===ZL.SIMPLE?function(e,t,r,n,a,o){var i=cB(e,t,r,a,o,!1,n);if(i.error)return i.error;var u=i.newXArray,s=i.weights,l=i.newXRowCount,c=s[0][0];if(isNaN(c))return Ce.d$b[Ce.O6N.TREND_POINT_NUM_UNENOUGHT]({funcName:a,expectedNum:2,receivedNum:1});var h=iB(u,s,l);return new gs(oB(h))}(e,r,n,o,this.name,a):function(e,t,r,n,a,o){var i=hB(e,t,r,a,o,!1,n);if(i.error)return i.error;var u=i.newXMatrix,s=i.weights,l=i.isYColCountEqualOne,c=oB(sB(u,s,!0));return l||(c=$L(c)),new gs(c)}(e,r,n,o,this.name,a)}}]),t}(pw("TREND",1,3,0,Zd,[{type:Zd|Fd},{type:Zd|Fd,default:it.NULL_VAR},{type:Zd|Od|Vd,default:it.NULL_VAR},{type:bd,default:new it.BooleanVar(!0)}]));var sY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="GROWTH",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1]||it.NULL_VAR,a=!t[3]||!Ga(t[3])||t[3].getValue(),o=t[2]||it.NULL_VAR,i=WL(r,n,this.name,a,o);return i.error?i.error:i.type===ZL.SIMPLE?function(e,t,r,n,a,o){var i=cB(e,t,r,a,o,!0,n);if(i.error)return i.error;var u=i.newXArray,s=i.weights,l=i.newXRowCount,c=s[0][0];if(isNaN(c))return Ce.d$b[Ce.O6N.TREND_POINT_NUM_UNENOUGHT]({funcName:a,expectedNum:2,receivedNum:1});var h=uB(u,s,l).predictResult;return new gs(oB(h))}(e,r,n,o,this.name,a):function(e,t,r,n,a,o){var i=hB(e,t,r,a,o,!0,n);if(i.error)return i.error;var u=i.newXMatrix,s=i.weights,l=i.isYColCountEqualOne,c=oB(lB(u,s,!0).predictResult);return l||(c=$L(c)),new gs(c)}(e,r,n,o,this.name,a)}}]),t}(uY=Vu([Cp("TREND")],uY));sY=Vu([Cp("GROWTH")],sY);var lY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LOGEST",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1]||it.NULL_VAR,a=!t[2]||!Ga(t[2])||t[2].getValue(),o=!(!t[3]||!Ga(t[3]))&&t[3].getValue(),i=WL(r,n,this.name,a);return i.error?i.error:i.type===ZL.SIMPLE?function(e,t,r,n,a,o){var i=cB(e,t,r,n,a,!0);if(i.error)return i.error;var u=i.lnKnowYArray,s=i.weights,l=i.knownXArray;if(isNaN(s[0][0]))return Ce.d$b[Ce.O6N.TREND_POINT_NUM_UNENOUGHT]({funcName:n,expectedNum:2,receivedNum:1});var c=oB(s);if(!o)return new gs(c);var h,f,d,v=qL(u),p=qL(l),m=u.length,g=uB(l,s).lnPredictResult,y=KL(u,g),_=JL(g,v,a);if(a){h=aB(m,2);var R=JL(l,p,!0);f=new it.NumberVar(XL(y,R,h)),d=new it.NumberVar(QL(y,p,R,h,m))}else{h=aB(m,1);var C=JL(l,0,!1);f=new it.NumberVar(XL(y,C,h)),d=Ce.d$b[Ce.O6N.LINEST_NO_STATISTICAL_INFO]()}var w=new it.NumberVar(eB(_,y)),E=h&&y?new it.NumberVar(rB(_,y,h)):Ys,k=new it.NumberVar(tB(y,h));return c.push([f,d],[w,k],[E,new it.NumberVar(h)],[new it.NumberVar(_),new it.NumberVar(y)]),new gs(c)}(e,r,n,this.name,a,o):function(e,t,r,n,a,o){var i=hB(e,t,r,n,a,!0);if(i.error)return i.error;var u=i.lnKnowYMatrix,s=i.weights,l=i.knownXMatrix,c=i.inverseMatrix,h=s[0].length,f=oB(s);if(!o)return new gs(f);for(var d=[],v=u.flat(),p=qL(v),m=v.length,g=lB(l,s).lnPredictResult,y=KL(v,g),_=JL(g,p,a),R=h-1,C=c.length,w=aB(m,C),E=w?new it.NumberVar(nB(_,R,y,w)):Ys,k=new it.NumberVar(eB(_,y)),T=new it.NumberVar(tB(y,w)),S=Ce.d$b[Ce.O6N.LINEST_NO_STATISTICAL_INFO](),A=[E,new it.NumberVar(w),S],I=[k,T,S],O=[new it.NumberVar(_),new it.NumberVar(y),S],V=C-1;V>=0;V--)w?d.push(new it.NumberVar(Math.sqrt(y/w*c[V][V]))):d.push(new it.NumberVar(0)),V<C-2&&(A.push(S),I.push(S),O.push(S));if(a){var N=d.shift();d.push(N)}else d.push(S);return f.push(d,I,A,O),new gs(f)}(e,r,n,this.name,a,o)}}]),t}(iY);lY=Vu([Cp("LOGEST")],lY);var cY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.trunc(t[0].getValue()),n=Math.trunc(t[1].getValue()),a=t[2].getValue();if(a<=0)return Js(this.name,a,3,0);var o=function(e,t){var r=we.SheetDate.fromNumber(e),n=we.SheetDate.fromNumber(t);if((0,we.daysBetween)(r,n)>we.SheetDate.from({year:r.year+1,month:r.month,date:r.date}).toNumber()-e)return{err:Ce.d$b[Ce.O6N.NUM_MATURITY_DATE_NOT_THAN_SETTLEMENT_DATE_ONE_YEAR]({funcName:"",settlementDate:w$(e),maturityDate:w$(t)})};var a=E$(e,t);return a.isValid?{settlement:r,maturity:n}:a}(r,n);return o.err?SL(o.err,this.name,t[0],t[1],e):this.calcFuncResult(r,n,a)}}]),t}(pw("",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),hY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TBILLEQ",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcFuncResult",value:function(e,t,r){if(r>=1)return tl(this.name,r,3,1);var n,a=we.SheetDate.fromNumber(e),o=we.SheetDate.fromNumber(t),i=(0,we.daysBetween)(a,o),u=100*(1-(t-e)*r/360),s=i/365;return n=i<=182?(100-u)/u*(365/i):(-s+Math.sqrt(s*s-(2*s-1)*(1-100/u)))/(s-.5),new it.NumberVar(n)}}]),t}(cY),fY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TBILLPRICE",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcFuncResult",value:function(e,t,r){if(r>=1)return tl(this.name,r,3,1);var n=we.SheetDate.fromNumber(e),a=we.SheetDate.fromNumber(t),o=(0,we.daysBetween)(n,a);return new it.NumberVar(100*(1-r*o/360))}}]),t}(cY),dY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TBILLYIELD",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcFuncResult",value:function(e,t,r){var n=we.SheetDate.fromNumber(e),a=we.SheetDate.fromNumber(t),o=(0,we.daysBetween)(n,a);return new it.NumberVar((100-r)/r*360/o)}}]),t}(cY),vY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32,265,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=[],n=!Ga(t[1])||t[1].getValue(),a=t[0],o=a.size();if(0===o)return it.VALUE_ERR_VAR;1===o&&(Ba(a)?Wa(a)||(a=a.toStringVar()):a=a.at(0,0).toStringVar());var i=a.forEach((function(e){if(ja(e))return e}));if(i)return i;for(var u=a.colCount(),s=0,l=2;l<t.length;++l){var c=t[l].forEach((function(e){if(ja(e))return e;var t,i=Wa(e)?e.getValue():e.toStringVar().getValue();!i&&n||(1===o?t=a:(t=xc(a.at(s/o|0,s%o)),s=(s+1)%u),r.push(i||""),r.push(t.getValue()||""))}));if(c)return c}return r.pop(),new it.StringVar(r.join(""))}}]),t}(pw("TEXTJOIN",3,256,1,Nd,[{type:Nd|Zd},{type:bd,default:it.BOOLEAN_VAR_MAP[it.BooleanConstant.TRUE]},{type:Nd|Zd},{type:Nd|Zd}])),pY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(0===r?Math.PI/2:Math.atan(1/r)+(r>0?0:Math.PI))}}]),t}(pw("ACOT",1,0,0,Vd,[{type:Vd}])),mY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return Math.abs(r)<=1?function(e,t,r){return Ce.d$b[Ce.O6N.NUM_NOT_BE_BETWEEN_INCLUSIVE_PARAMETER]({funcName:e,index:t,value:r})}(this.name,1,r):new it.NumberVar(.5*Math.log((r+1)/(r-1)))}}]),t}(pw("ACOTH",1,0,0,Vd,[{type:Vd}]));function gY(e,t,r){if(0===e&&!r)return Hl(t);var n=Math.pow(2,27);return!(Math.abs(e)>=n)||js(t,1,e,-n,n)}var yY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=gY(r,this.name);return n instanceof it.ErrorVar?n:new it.NumberVar(1/Math.tan(r))}}]),t}(pw("COT",1,0,0,Vd,[{type:Vd}])),_Y=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=gY(r,this.name);return n instanceof it.ErrorVar?n:new it.NumberVar(1/Math.tanh(r))}}]),t}(pw("COTH",1,0,0,Vd,[{type:Vd}])),RY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=gY(r,this.name);return n instanceof it.ErrorVar?n:new it.NumberVar(1/Math.sin(r))}}]),t}(pw("CSC",1,0,0,Vd,[{type:Vd}])),CY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=gY(r,this.name);return n instanceof it.ErrorVar?n:new it.NumberVar(1/Math.sinh(r))}}]),t}(pw("CSCH",1,0,0,Vd,[{type:Vd}])),wY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r>=1||r<=0)return js(this.name,1,r,0,1);var n=t[1].getValue();if(n<=0)return Js(this.name,n,2,0);var a=Math.trunc(t[2].getValue());return a<1?Qs(this.name,a,3,1):new it.NumberVar(-eZ(r/2,0,1)*(n/Math.sqrt(a)))}}]),t}(pw("CONFIDENCE.NORM",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),EY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CONFIDENCE",e}return(0,p.Z)(t,e),t}(wY);function kY(e,t,r){return TY(-e,t,4)*r}function TY(e,t,r){var n=sZ(t/(t+e*e),t/2,.5);switch(r){case 1:return.5*n;case 2:default:return n;case 3:return Math.pow(1+e*e/t,-(t+1)/2)/(Math.sqrt(t)*dZ(!0,.5,t/2));case 4:var a=.5*sZ(t/(e*e+t),.5*t,.5);return e<0?a:1-a}}function SY(e,t,r){return function(e,t,r){function n(e,t){return e<0&&t>0||e>0&&t<0}var a,o,i=e(t),u=e(r);for(o=0;o<1e3&&!n(i,u);o++)Math.abs(i)<=Math.abs(u)?(a=t,(t+=2*(t-r))<0&&(t=0),r=a,u=i,i=e(t)):(a=r,r+=2*(r-t),t=a,i=u,u=e(r));if(0===i)return t;if(0===u)return r;if(!n(i,u))return 0;var s=t,l=i,c=r,h=u,f=t,d=i,v=.5*(t+r),p=!0;for(o=0;o<500&&Math.abs(d)>1e-307&&r-t>222045e-21*Math.max(Math.abs(t),Math.abs(r));)p&&(p=l!==h&&h!==d&&d!==l&&(t<(v=s*d*h/(d-l)/(h-l)+f*h*l/(h-d)/(l-d)+c*l*d/(l-h)/(d-h))&&v<r)),p||(v=.5*(t+r),s=t,l=i,c=r,h=u,p=!0),s=c,c=f,f=v,l=h,h=d,n(i,d=e(v))?(r=f,u=d):(t=f,i=d),p=p&&2*Math.abs(d)<=Math.abs(h),++o;return f}(function(){var n=e,a=t,o=r;return function(e){return n-TY(e,a,o)}}(),.5*t,t)}var AY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r>=1||r<=0)return js(this.name,1,r,0,1);var n=t[1].getValue();if(n<=0)return Js(this.name,n,2,0);var a=Math.trunc(t[2].getValue());if(1===a)return Hl(this.name);if(a<1)return Qs(this.name,a,3,1);var o=1e10;return a>=o?tl(this.name,a,3,o):new it.NumberVar(n*SY(r,a-1,2)/Math.sqrt(a))}}]),t}(pw("CONFIDENCE.T",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),IY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(0===r)return new it.NumberVar(1);var n=gY(r,this.name,!0);return n instanceof it.ErrorVar?n:new it.NumberVar(1/Math.cos(r))}}]),t}(pw("SEC",1,0,0,Vd,[{type:Vd}])),OY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(0===r)return new it.NumberVar(1);var n=gY(r,this.name,!0);return n instanceof it.ErrorVar?n:new it.NumberVar(1/Math.cosh(r))}}]),t}(pw("SECH",1,0,0,Vd,[{type:Vd}])),VY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).paramsDesc=[{type:Vd|bd,default:Yl(e.name)},{type:Vd|bd,default:Yl(e.name)}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[0,0],n=this.name,a=0;a<t.length;++a){var o=t[a],i=Zc(e.service,o,!0);if(!i)return Rl(n,a+1,El(o),wl(o),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);r[a]=i.getValue()}var u=r[0],s=r[1];if(s<0)return Js(n,s,2,0);if(s>=0&&s<1)return Hl(n);var l=Math.trunc(s),c=Math.trunc(u),h=u-c;if(l%10==0||1===l||!h)return new it.NumberVar(u);for(var f=10;1<l/f;)f*=10;return this.financialCalc(c,h,l,f)}}]),t}(pw("",2,0,0,Vd,[])),NY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DOLLARDE",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"financialCalc",value:function(e,t,r,n){return new it.NumberVar(e+t/r*n)}}]),t}(VY),bY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DOLLARFR",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"financialCalc",value:function(e,t,r,n){return new it.NumberVar(e+t*r/n)}}]),t}(VY);function MY(e,t,r){return Js(e,t,r,0)}function FY(e,t,r){return Qs(e,t,r,0)}var ZY=12,xY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return FY(this.name,r,1);var n=t[1].getValue();if(n<0)return FY(this.name,n,2);var a=t[2].getValue();if(a<=0)return MY(this.name,a,3);var o=t[3].getValue();if(o<=0)return MY(this.name,o,4);var i=t[4]&&za(t[4])?Math.floor(t[4].getValue()):ZY;if(i<=0)return MY(this.name,i,5);if(i>ZY)return Gs(this.name,i,5,1,ZY);if(i===ZY&&o>a)return yl(this.name,4,o,3,a);if(i<ZY&&o>a+1)return el(this.name,o,4,a+1);if(Yy(e),0===r)return new it.NumberVar(0);if(n===r)return new it.NumberVar(0);var u=0===Math.floor(o)?1:Math.floor(o),s=Number((1-Math.pow(n/r,1/a)).toFixed(3)),l=r*s*i/ZY;if(1===u)return new it.NumberVar(l);var c,h=l;return h=(h-r)*Math.pow(1-s,u-2|0)+r,c=i!==ZY&&u===a+1?(r-h)*s*(ZY-i)/ZY:(r-h)*s,new it.NumberVar(c)}}]),t}(pw("DB",4,1,0,Vd,[{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:new it.NumberVar(ZY)}])),DY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=6,e.$$maxOperands=7,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=Math.trunc(t[0].getValue()),a=Math.trunc(t[1].getValue()),o=t[2].getValue(),i=t[3].getValue(),u=t[4].getValue(),s=Math.trunc(t[5].getValue()),l=t[6]?Math.trunc(t[6].getValue()):0,c=function(e,t,r,n,a,o,i,u){return t<=0?{err:MY(e,t,1)}:r<=0?{err:MY(e,r,2)}:n<0?{err:FY(e,n,3)}:a<=0?{err:MY(e,a,4)}:o<=0?{err:MY(e,o,5)}:kL(t,r,i,u,6)}(this.name,n,a,o,i,u,s,l);if(c.err)return SL(c.err,this.name,t[0],t[1],e);var h=gL(we.SheetDate.fromNumber(n),we.SheetDate.fromNumber(a),s),f=IL(c),d=h.start.toNumber(),v=b$(d<0?0:d,n,l).duration,p=null===(r=b$(n,a,l))||void 0===r?void 0:r.duration;if(!p)return new it.NumberVar(0);var m,g=h.count,y=o/s,_=i/100+v/f*y;if(1!==g){for(var R=function(e){return qH(n,a,o,e,u,s,l,c)},C=0,w=o||.01,E=R(w),k=E-i;100>=C&&1e-7<Math.abs(k);C++)E=R(1.01*w),k=(E=R(w=-k/(E-i-k)*w*.01+w))-i;return new it.NumberVar(w)}return m=(u/100+y-_)/_*s*f/p,new it.NumberVar(m)}}]),t}(pw("YIELD",6,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(0)}]));var PY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=5,e.$$maxOperands=6,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.trunc(t[0].getValue());if(r<=0)return MY(this.name,r,1);var n=Math.trunc(t[1].getValue());if(n<=0)return MY(this.name,n,2);if(r>=n)return ml(this.name,w$(r),w$(n));var a=t[2].getValue();if(a<0)return FY(this.name,a,3);if(a>r)return Ce.d$b[Ce.O6N.DATE_PARAMETER_SHOULD_BE_ON_OR_BEFORE_OTHER_DATE_PARAMETER]({funcName:this.name,index:3,firstDate:w$(a),secondArgIndex:1,secondDate:w$(r)});var o=t[3].getValue();if(o<0)return FY(this.name,o,4);var i=t[4].getValue();if(i<=0)return MY(this.name,i,5);var u=t[5]?Math.floor(t[5].getValue()):0;if(u>4||u<0)return Gs(this.name,6,u,0,4);var s=b$(r,n,u),l=b$(a,r,u),c=b$(a,n,u);if(!s||!l||!c)return new it.NumberVar(0);var h=((100+c.value*o*100)/(i+l.value*o*100)-1)/s.value;return new it.NumberVar(h)}}]),t}(pw("YIELDMAT",5,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(0)}])),$Y=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.trunc(t[0].getValue());if(r<=0)return MY(this.name,r,1);var n=Math.trunc(t[1].getValue());if(n<=0)return MY(this.name,n,2);if(r>=n)return ml(this.name,w$(r),w$(n));var a=t[2].getValue();if(a<=0)return MY(this.name,a,3);var o=t[3].getValue();if(o<=0)return MY(this.name,o,4);var i=t[4]?Math.floor(t[4].getValue()):0;if(i>4||i<0)return Gs(this.name,5,i,0,4);var u=b$(r,n,i);if(!u)return new it.NumberVar(0);var s=(o/a-1)/u.value;return new it.NumberVar(s)}}]),t}(pw("YIELDDISC",4,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(0)}])),LY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=5,e.$$maxOperands=7,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,258,258,259,265],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return FY(this.name,r,1);var n=t[1].getValue();if(n<0)return FY(this.name,n,2);if(n>r)return yl(this.name,n,2,1,r);var a=t[2].getValue();if(a<=0)return MY(this.name,a,3);var o=t[3].getValue();if(o<0)return FY(this.name,o,4);var i=t[4].getValue();if(i<0)return FY(this.name,i,5);if(i>999)return el(this.name,i,5,999);if(i>a)return yl(this.name,i,5,3,a);if(o>i)return yl(this.name,o,4,5,i);var u=t[5]&&za(t[5])?t[5].getValue():2;if(u<=0)return MY(this.name,u,6);var s=!(!t[6]||!Ga(t[6]))&&t[6].getValue();if(Yy(e),0===r)return new it.NumberVar(0);if(n===r)return new it.NumberVar(0);var l=1/a*u;function c(e,t,r){var n=e-t,a=Math.floor(r),o=Math.min(e-e*Math.pow(1-l,a),n);return r>a&&(o+=Math.min((e-o)*l,n-o)*(r-a)),Math.min(n,o)}var h=r-n,f=Math.floor(o),d=Math.ceil(o),v=0;if(s){var p=c(r,n,f);if(o>f){var m=Math.min((r-p)*l,h-p);v=m*(d-o),p+=m}v+=c(r-p,n,i-d)}else{var g,y,_=o-f,R=!1,C=function(e){return 0|Math.max(Math.min(e,2147483647),-2147483648)}(a);for(y=0;y<i-_+1;y=y+1|0){var w=c(r,n,Math.max(_+y-1,0));if(c(r-w,n,1)<=(g=(h-w)/(a-Math.max(_+y-1,0)))){R=!0,C=y;break}}if(R)if(C<=f+1)v=(0===C?(h-g*_)/Math.max(a-_,1):g)*(i-o);else{var E=c(r,n,o);v=c(r-E,n,(C-1|0)-f)+g*(i-C-_+1)}else{var k=c(r,n,o);v=c(r-k,n,i-o)}}return new it.NumberVar(v)}}]),t}(pw("VDB",5,2,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(2)},{type:bd,default:new it.BooleanVar(!1)}])),BY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();if(n<0)return FY(this.name,n,2);var a=t[2].getValue();if(a<=0)return MY(this.name,a,3);var o=t[3].getValue();return o<=0?MY(this.name,o,4):o>a?yl(this.name,o,4,3,a):(Yy(e),n===r?new it.NumberVar(0):new it.NumberVar((r-n)*(a-o+1)*2/(a*(a+1))))}}]),t}(pw("SYD",4,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd}])),UY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=6,e.$$maxOperands=7,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return FY(this.name,r,1);var n=t[1].getValue();if(n<=0)return Js(this.name,n,2,0);var a=t[2].getValue();if(a<=0)return Js(this.name,a,3,0);if(n>a){var o=Ps(e.workbook,e.ref);return o?rl(this.name,o,n,2,a,3):it.VALUE_ERR_VAR}var i=t[3].getValue();if(i<0)return FY(this.name,i,4);if(i>r)return yl(this.name,4,i,1,r);var u=t[4].getValue();if(u<0)return FY(this.name,u,5);var s=t[5].getValue();if(s<=0)return MY(this.name,s,6);var l=t[6]?Math.floor(t[6].getValue()):0;if(l>4||l<0)return Gs(this.name,7,l,0,4);if(i===r)return new it.NumberVar(0);var c=b$(n,a,l);if(!c)return new it.NumberVar(0);var h=u>0&&u<2?1:u,f=r*s,d=h+(c.value||0),v=r-(0===h?0:d-1)*f;v<i&&(v=i);var p=r-d*f;return p<i&&(p=i),new it.NumberVar(v-p)}}]),t}(pw("AMORLINC",6,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(0)}])),HY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return zs(this.name,1);var n=t[1].getValue();if(n<=0)return Js(this.name,n,2,0);var a=t[2].getValue();if(a<=0)return Js(this.name,a,3,0);var o=t[3].getValue(),i=Math.exp(-Math.pow(r/a,n)),u=o?1-i:n/Math.pow(a,n)*Math.pow(r,n-1)*i;return new it.NumberVar(u)}}]),t}(pw("WEIBULL.DIST",4,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:bd}])),zY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="WEIBULL",e}return(0,p.Z)(t,e),t}(HY),WY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=1;if(r<0)return Qs(this.name,r,1,0);if(r>2147483647)return el(this.name,r,1,2147483647);if(n<0)return Qs(this.name,n,2,0);if(r<n)return yl(this.name,n,2,1,r);for(var o=(r=Math.trunc(r))-(n=Math.trunc(n))+1;o<=r;o++)a*=o;return new it.NumberVar(a)}}]),t}(pw("PERMUT",2,0,0,Vd,[{type:Vd},{type:Vd}])),GY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();return r<1?Qs(this.name,r,1,1):r>2147483647?el(this.name,r,1,2147483647):n<0?Qs(this.name,n,2,0):(r=Math.trunc(r),n=Math.trunc(n),new it.NumberVar(Math.pow(r,n)))}}]),t}(pw("PERMUTATIONA",2,0,0,Vd,[{type:Vd},{type:Vd}])),jY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue();if(r<0)return Qs(this.name,r,1,0);if(n<=0)return Js(this.name,n,2,0);var o=Math.exp(-n*r);return new it.NumberVar(a?1-o:n*o)}}]),t}(pw("EXPON.DIST",3,0,0,Vd,[{type:Vd},{type:Vd},{type:bd}])),YY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="EXPONDIST",e}return(0,p.Z)(t,e),t}(jY);function qY(e,t,r,n){if(t-e>n-r)return 0;if(n>=1029){var a=t>r?t:r,o=t>r?r:t,i=0,u=1,s=1,l=Math.floor(o*a/n);l===e&&i++;for(var c=l+1,h=1;c<=o&&1e-11<h;c++,s=h)u+=h=s*(a-c+1)*(o-c+1)/(c*(n-a-o+c)),c===e&&(i+=h);for(--l,s=c=1;0<=l&&1e-11<s;l--,c=s)u+=s=c*(l+1)*(n-a-o+l+1)/((a-l)*(o-l)),l===e&&(i+=s);return i/u}return zZ(r,e)*zZ(n-r,t-e)/zZ(n,t)}var JY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<4;++n){var a=Math.trunc(t[n].getValue());if(a<0)return Js(this.name,a,n+1,0);r.push(a)}var o=r[0],i=r[1],u=r[2],s=r[3];if(o>i)return new it.NumberVar(0);if(u>s)return yl(this.name,u,3,4,s);if(i>s)return yl(this.name,i,2,4,s);var l=qY(o,i,u,s);return new it.NumberVar(l)}}]),t}(pw("HYPGEOMDIST",4,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd}])),KY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=5,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<4;++n){var a=Math.trunc(t[n].getValue());if(a<0)return Js(this.name,a,n+1,0);r.push(a)}var o=r[0],i=r[1],u=r[2],s=r[3],l=t[4].getValue();if(o>i)return new it.NumberVar(l?1:0);if(u>s)return yl(this.name,u,3,4,s);if(i>s)return yl(this.name,i,2,4,s);if(l){for(var c=0,h=0;h<=o;h++)c+=qY(h,i,u,s);return new it.NumberVar(c)}return new it.NumberVar(qY(o,i,u,s))}}]),t}(pw("HYPGEOM.DIST",5,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:bd}])),XY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(0===r)return new it.NumberVar(0);if(r>=1||r<=-1)return js(this.name,1,r,-1,1);var n=Math.log((1+r)/(1-r))/2;return new it.NumberVar(n)}}]),t}(pw("FISHER",1,0,0,Vd,[{type:Vd}])),QY=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=Math.exp(2*r)-1,a=Math.exp(2*r)+1;return!Number.isFinite(n)&&n>0&&!Number.isFinite(a)&&a>0?new it.NumberVar(1):new it.NumberVar(n/a)}}]),t}(pw("FISHERINV",1,0,0,Vd,[{type:Vd}])),eq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.trunc(t[1].getValue());if(r<1)return Qs(this.name,r,2,1);var n=t[0].getValue(),a=t[2].getValue();return new it.NumberVar(TY(n,r,a?4:3))}}]),t}(pw("T.DIST",3,0,0,Vd,[{type:Vd},{type:Vd},{type:bd}])),tq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return Qs(this.name,r,1,0);var n=Math.trunc(t[1].getValue());if(n<1)return Qs(this.name,n,2,1);var a=Math.trunc(t[2].getValue());if(a<1||a>2)return Gs(this.name,3,a,1,2);var o=kY(r,n,a);return new it.NumberVar(o)}}]),t}(pw("TDIST",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),rq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return Qs(this.name,r,1,0);var n=Math.trunc(t[1].getValue());if(n<1)return Qs(this.name,n,2,1);var a=kY(r,n,2);return new it.NumberVar(a)}}]),t}(pw("T.DIST.2T",2,0,0,Vd,[{type:Vd},{type:Vd}])),nq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.trunc(t[1].getValue());if(r<1)return Qs(this.name,r,2,1);var n=kY(t[0].getValue(),r,1);return new it.NumberVar(n)}}]),t}(pw("T.DIST.RT",2,0,0,Vd,[{type:Vd},{type:Vd}])),aq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<=0)return Js(this.name,r,1,0);if(r>1)return el(this.name,r,1,1);if(1===r)return new it.NumberVar(0);var n=Math.trunc(t[1].getValue());return n<1?Qs(this.name,n,2,1):new it.NumberVar(function(e,t){var r,n,a,o,i,u,s,l,c,h,f=179769e303,d=e/2,v=d;return t>1e20?eZ(d,0,1):(v<.5?(h=0,u=2*v):(h=1,u=2*(1-v)),Math.abs(t-2)<1e-12?s=u>0?Math.sqrt(2/(u*(2-u))-2):f:t<1+1e-12?u>0?(i=1.5707963267948966*(u+1),s=-Math.tan(i)):s=f:(o=((94.5/((n=48/((r=1/(t-.5))*r))+(a=((20700*r/n-98)*r-16)*r+96.36))-3)/n+1)*Math.sqrt(1.5707963267948966*r)*t,(c=Math.pow(o*u,2/t))>.05+r?(l=eZ(.5*u,0,1),t<5&&(a+=.3*(t-4.5)*(l+.6)),c=(((((.4*(c=l*l)+6.3)*c+36)*c+94.5)/(a=(((.05*o*l-5)*l-7)*l-2)*l+n+a)-c-3)/n+1)*l,c=(c*=r*c)>.002?Math.exp(c)-1:.5*c*c+c):c=((1/(((t+6)/(t*c)-.089*o-.822)*(t+2)*3)+.5/(t+4))*c-1)*(t+1)/(t+2)+1/c,s=Math.sqrt(t*c)),0!==h&&(s=-s),s)}(r,n))}}]),t}(pw("T.INV.2T",2,0,0,Vd,[{type:Vd},{type:Vd}])),oq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TINV",e}return(0,p.Z)(t,e),t}(aq),iq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<=0)return Js(this.name,r,1,0);if(r>=1)return tl(this.name,r,1,1);var n=Math.trunc(t[1].getValue());if(n<1)return Qs(this.name,n,2,1);var a=r<.5?-SY(1-r,n,4):SY(r,n,4);return new it.NumberVar(a)}}]),t}(pw("T.INV",2,0,0,Vd,[{type:Vd},{type:Vd}])),uq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[32,32,258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1],a=Math.trunc(t[3].getValue()),o=r.size(),i=n.size();if(1===a&&o!==i)return Il(this.name);var u=[],s=[],l=0;if(1===a)for(var c=r.colCount(),h=n.colCount(),f=0;f<o;f++){var d=r.at(f/c|0,f%c);if(ja(d))return d;var v=n.at(f/h|0,f%h);if(ja(v))return v;if(za(d)&&za(v)){var p=d.getValue(),m=v.getValue();u.push(p),s.push(m),l++}}else{if(u=Ck(r),s=Ck(n),u instanceof it.ErrorVar)return u;if(s instanceof it.ErrorVar)return s;l=Math.min(u.length,s.length)}if(l<=1)return Hl(this.name);var g,y,_,R,C,w,E,k,T,S=Math.trunc(t[2].getValue());if(S<1||S>2)return Gs(this.name,3,S,1,2);if(a<1||a>3)return Gs(this.name,4,a,1,3);if(1===a){for(var A=[],I=0;I<u.length;I++)A.push(u[I]-s[I]);var O=wk(A);if(0===O.Q)return Hl(this.name);R=Math.sqrt(O.Q/(O.N-1)),_=(g=O.sum/O.N)/(R/Math.sqrt(O.N)),E=O.N-1}else{var V=wk(u),N=wk(s);if(0===V.Q&&0===N.Q)return Hl(this.name);if(C=V.Q/(V.N-1),w=N.Q/(N.N-1),g=V.sum/V.N,y=N.sum/N.N,k=V.N,T=N.N,2===a)E=k+T-2,_=(g-y)/(Math.sqrt(((k-1|0)*C+(s.length-1|0)*w)/E)*Math.sqrt(1/k+1/s.length));else{var b=C/k/(C/k+w/T);E=1/(b*b/(k-1)+(1-b)*(1-b)/(T-1)),_=(g-y)/Math.sqrt(C/k+w/T)}}var M=function(e,t,r){var n=0===r||1===r?0:Math.exp(aZ(e+t)-aZ(e)-aZ(t)+e*Math.log(r)+t*Math.log(1-r)),a=r>=(e+1)/(e+t+2);a&&(e=[t,t=e][0],r=1-r);var o=4450147717014403e-323,i=100,u=e+t,s=e+1,l=e-1,c=1,h=1-u*r/s;Math.abs(h)<o&&(h=o);for(var f=h=1/h,d=1,v=2;d<=i;d++,v+=2){var p=d*(t-d)*r/((l+v)*(e+v));h=1+p*h,Math.abs(h)<o&&(h=o),c=1+p/c,Math.abs(c)<o&&(c=o),f*=(h=1/h)*c,h=1+(p=-(e+d)*(u+d)*r/((e+v)*(s+v)))*h,Math.abs(h)<o&&(h=o),c=1+p/c,Math.abs(c)<o&&(c=o);var m=(h=1/h)*c;if(f*=m,Math.abs(m-1)<5e-324){var g=n*f/e;return a?1-g:g}}return 0}(.5*E,.5,E/(E+(_=Math.abs(_))*_));return new it.NumberVar(.5*S*M)}}]),t}(pw("T.TEST",4,0,0,Vd,[{type:Zd},{type:Zd},{type:Vd},{type:Vd}]));var sq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TTEST",e}return(0,p.Z)(t,e),t}(uq),lq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0,a=0;a<t.length;++a){var o=t[a];if(Ba(o)){var i=Zc(e.service,o);if(!i)return Rl(this.name,a+1,El(o),wl(o),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var u=i.getValue();n+=u,r.push(u)}else for(var s=o.rowCount(),l=o.colCount(),c=0;c<s;++c)for(var h=0;h<l;++h){var f=o.at(c,h);if(ja(f))return f;if(za(f)){var d=f.getValue();n+=d,r.push(d)}}}if(0===r.length)return jl(this.name);for(var v=n/r.length,p=0,m=0;m<r.length;++m){var g=r[m]-v;p+=g*g}return new it.NumberVar(p)}}]),t}(pw("DEVSQ",1,255,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),cq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="VAR.S",e}return(0,p.Z)(t,e),t}(R$),hq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="VAR.P",e}return(0,p.Z)(t,e),t}(C$);function fq(e,t,r){var n=function(e,t){for(var r=0,n=0,a=0;a<e.length;++a){var o=e[a].forEach((function(e){switch(e.$$type){case 2:r+=e.getValue();case 4:n++;break;case 8:e.getValue()&&r++,n++;break;case 16:return e}}));if(o)return o}return n?new it.NumberVar(r/n):Hl(t)}(t,r);if(ja(n))return n;for(var a=n.getValue(),o=0,i=0,u=0;u<t.length;++u)t[u].forEach((function(e){switch(e.$$type){case 2:o+=Math.pow(e.getValue()-a,2),i++;break;case 4:o+=Math.pow(0-a,2),i++;break;case 8:o+=Math.pow((e.getValue()?1:0)-a,2),i++}}));var s=e?i:i-1;return s<1?Hl(r):new it.NumberVar(o/s)}var dq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;++r){var n=t[r];Ba(n)&&(t[r]=Zc(e.service,n)||Rl(this.name,r+1,El(n),wl(n),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE))}return fq(!1,t,this.name)}}]),t}(pw("VARA",1,255,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),vq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;++r){var n=t[r];Ba(n)&&(t[r]=Zc(e.service,n)||Rl(this.name,r+1,El(n),wl(n),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE))}return fq(!0,t,this.name)}}]),t}(pw("VARPA",1,255,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),pq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="STDEV.P",e}return(0,p.Z)(t,e),t}(s$),mq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="STDEV.S",e}return(0,p.Z)(t,e),t}(u$),gq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n];if(Ba(a)){var o=Zc(e.service,a);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);a=o}r.push(a)}var i=fq(!1,r,this.name);if(za(i)){var u=Math.sqrt(i.getValue());return new it.NumberVar(u)}return i}}]),t}(pw("STDEVA",1,255,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),yq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n){var a=t[n];if(Ba(a)){var o=Zc(e.service,a);if(!o)return Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);a=o}r.push(a)}var i=fq(!0,r,this.name);if(za(i)){var u=Math.sqrt(i.getValue());return new it.NumberVar(u)}return i}}]),t}(pw("STDEVPA",1,255,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),_q=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();if(r<0)return FY(this.name,r,1);if(n<0)return FY(this.name,n,2);var a=t[2].getValue();if(a<=0)return MY(this.name,a,3);var o=t[3].getValue();if(o<=0)return MY(this.name,o,4);var i=t[4]&&za(t[4])?t[4].getValue():2;if(i<=0)return MY(this.name,i,5);if(o>a)return yl(this.name,4,o,3,a);if(Yy(e),0===r)return new it.NumberVar(0);if(n>=r)return new it.NumberVar(0);var u=Math.ceil(o),s=0,l=1-i/a;if(s=Math.pow(l,u-1)*(1-l)*r,(Math.pow(l,u)-1)/(l-1)*(i/a)*r>r-n&&(s=Math.max(Math.min(r-n-(Math.pow(l,u-1)-1)/(l-1)*(i/a)*r,s),0)),u<1e4&&l<0)for(var c=0,h=1;h<=u;h++)c+=s=Math.min(i/a*(r-c),r-n-c);return new it.NumberVar(s)}}]),t}(pw("DDB",4,1,0,Vd,[{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:it.NA_ERR_VAR},{type:Vd,default:new it.NumberVar(2)}]));function Rq(e){return 55296<=e&&e<=56319}function Cq(e){return 56320<=e&&e<=57343}function wq(e,t){return 65536+((1023&e)<<10)+(1023&t)}function Eq(e,t){var r=e.length;if(t>=r)return 0;var n=e.charCodeAt(t);if(Rq(n)&&t+1<r){var a=e.charCodeAt(t+1);if(Cq(a))return wq(n,a)}return n}function kq(e,t,r){for(var n=r,a=Math.min(t+r,e.length),o=t;o<a;o+=1)Eq(e,o)>255&&(n+=1);return n}function Tq(e,t,r){for(var n=0,a=0,o=t;n<r&&o<e.length;o+=1)a+=1,n+=Eq(e,o)>255?2:1;return a}var Sq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MIDB",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[1].getValue());if(r<1)return Xs(this.name,r,2,1);var n=Math.floor(t[2].getValue());if(n<0)return Ws(this.name,3);var a=t[0].getValue();if(r>a.length)return new it.StringVar("");var o=Tq(a,r-1,n);return new it.StringVar(a.substr(r-1,o))}}]),t}(tP),Aq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SEARCHB",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,r){var n=(0,f.Z)((0,v.Z)(t.prototype),"func",this).call(this,e,r);if(za(n)&&r[0].getValue().length>0){var a=n.getValue()-1,o=kq(r[1].getValue(),0,a);return new it.NumberVar(o+1)}return n}}]),t}(QP),Iq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FINDB",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,r){var n=(0,f.Z)((0,v.Z)(t.prototype),"func",this).call(this,e,r);if(za(n)&&r[0].getValue().length>0){var a=n.getValue()-1,o=kq(r[1].getValue(),0,a);return new it.NumberVar(o+1)}return n}}]),t}(Wx),Oq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="REPLACEB",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,r){var n=r[0].getValue(),a=Math.floor(r[1].getValue()),o=Math.floor(r[2].getValue());if(a<1)return Xs(this.name,a,2,1);if(o<0)return Ws(this.name,3);var i=Tq(n,a-1,o);return(0,f.Z)((0,v.Z)(t.prototype),"func",this).call(this,e,[r[0],r[1],new it.NumberVar(i),r[3]])}}]),t}(ZP),Vq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LEFTB",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[1]?za(t[1])?Math.floor(t[1].getValue()):0:1;if(r<0)return Ws(this.name,2);var n=t[0].getValue(),a=Tq(n,0,r);return new it.StringVar(n.substr(0,a))}}]),t}(GD),Nq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="RIGHTB",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[1]?za(t[1])?Math.floor(t[1].getValue()):0:1;if(r<0)return Ws(this.name,2);var n=t[0].getValue(),a=function(e,t,r){for(var n=0,a=0,o=e.length-1;n<r&&o>=t;o-=1)a+=1,n+=Eq(e,o)>255?2:1;return a}(n,0,r),o=Math.max(0,n.length-a);return new it.StringVar(n.substr(o,a))}}]),t}(xP),bq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=5,e.$$maxOperands=6,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,258,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue()),a=Math.floor(t[2].getValue()),o=t[3].getValue(),i=t[4].getValue(),u=t[5]&&za(t[5])?Math.floor(t[5].getValue()):p$.UsPsa30_360,s=[{val:r,index:1},{val:n,index:2},{val:a,index:3}].find((function(e){return e.val<0}));if(s)return Qs(this.name,s.val,s.index,0);var l=[[{val:a,index:3},{val:r,index:1}],[{val:r,index:1},{val:n,index:2}]].find((function(e){var t=(0,g.Z)(e,2),r=t[0],n=t[1];return r.val>=n.val}));if(l){var c=Ps(e.workbook,e.ref);if(!c)return it.VALUE_ERR_VAR;var h=(0,g.Z)(l,2),f=h[0],d=h[1];return rl(this.name,c,f.val,f.index,d.val,d.index)}var v=[{val:o,index:4},{val:i,index:5}].find((function(e){return e.val<0}));if(v)return Qs(this.name,v.val,v.index,0);if(!CL(u))return EL(this.name,u,6);var p=b$(a,n,u),m=b$(r,n,u),y=b$(a,r,u);return p&&m&&y?new it.NumberVar((100+p.value*o*100)/(1+m.value*i)-y.value*o*100):it.NUM_ERR_VAR}}]),t}(pw("PRICEMAT",5,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(p$.UsPsa30_360)}])),Mq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=[{val:r,index:1},{val:n,index:2}].find((function(e){return e.val<=0}));return o?Js(this.name,o.val,o.index,0):a<0?Qs(this.name,a,3,0):new it.NumberVar(Math.pow(a/n,1/r)-1)}}]),t}(pw("RRI",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),Fq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue();if(r<0)return zs(this.name,1);if(n<0)return zs(this.name,2);var o,i,u,s=Math.floor(r),l=0;if(170<s||290<s*Math.log10(n)){i=0,o=0,o++,((u=Math.floor(n))===s||a&&u<s)&&i++;for(var c=u+1,h=2*u,f=1;c<=h&&1e-11<f;++c)o+=f=f*n/c,(c===s||a&&c<s)&&(i+=f);--u;for(var d=1;0<=u&&1e-11<d;--u)o+=d=d*(u+1)/n,(u===s||a&&u<s)&&(i+=d);l=i/o}else if(a){var v=0;i=1,o=1,u=Math.exp(-n);for(var p=0;p<=s;p=p+1|0)v+=u*i/o,i*=n,o*=p+1|0;l=v}else l=Math.exp(-n)*Math.pow(n,s)/Ux(s);return new it.NumberVar(l)}}]),t}(pw("POISSON",3,0,0,Vd,[{type:Vd},{type:Vd},{type:bd}])),Zq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="POISSON.DIST",e}return(0,p.Z)(t,e),t}(Fq),xq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue();return a<=0?Js(this.name,a,3,0):new it.NumberVar((r-n)/a)}}]),t}(pw("STANDARDIZE",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),Dq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Math.floor(t[0].getValue()),n=Math.floor(t[1].getValue()),a=t[2].getValue(),o=t[3].getValue(),i=t[4]&&za(t[4])?Math.floor(t[4].getValue()):p$.UsPsa30_360,u=[{val:r,index:1},{val:n,index:2}].find((function(e){return e.val<0}));if(u)return Qs(this.name,u.val,u.index,0);if(r>=n){var s=Ps(e.workbook,e.ref);return s?rl(this.name,s,r,1,n,2):it.VALUE_ERR_VAR}var l=[{val:a,index:3},{val:o,index:4}].find((function(e){return e.val<=0}));if(l)return Js(this.name,l.val,l.index,0);if(!CL(i))return EL(this.name,i,5);var c=b$(r,n,i);if(!c)return it.NUM_ERR_VAR;var h=1-o*c.value;return h<=0?it.NUM_ERR_VAR:new it.NumberVar(a/h)}}]),t}(pw("RECEIVED",4,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(p$.UsPsa30_360)}])),Pq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="PERCENTILE.INC",e}return(0,p.Z)(t,e),t}(yP);function $q(e,t,r,n,a){var o=r.length;if(r.sort((function(e,t){return e-t})),0===o||e<r[0]||e>r[o-1])return Yl(a);var i=1===o?1:function(e,t,r){var n,a,o=e.length;if(t!==e[0]){var i=0,u=e[0];for(a=1;a<o&&e[a]<t;a++)e[a]!==u&&(i=a,u=e[a]);if(e[a]!==u&&(i=a),t===e[a])n=r?i/(o-1):(a+1)/(o+1);else if(0===i)n=0;else{var s=(t-e[i-1])/(e[i]-e[i-1]);n=r?(i-1+s)/(o-1):(i+s)/(o+1)}}else n=r?0:1/(o+1);return n}(r,e,n);return(t=Math.floor(t))<1&&(t=3),new it.NumberVar(0!==i?Math.round(i*Math.pow(10,t))/Math.pow(10,t):i)}var Lq,Bq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[32,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ck(t[0]);return r instanceof it.ErrorVar?r:$q(t[1].getValue(),t[2]&&za(t[2])?t[2].getValue():3,r,!1,this.name)}}]),t}(pw("PERCENTRANK.EXC",2,1,0,Vd,[{type:Zd},{type:Vd},{type:Vd,default:new it.NumberVar(3)}])),Uq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[32,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ck(t[0]);return r instanceof it.ErrorVar?r:$q(t[1].getValue(),t[2]&&za(t[2])?t[2].getValue():3,r,!0,this.name)}}]),t}(pw("PERCENTRANK.INC",2,1,0,Vd,[{type:Zd},{type:Vd},{type:Vd,default:new it.NumberVar(3)}])),Hq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="QUARTILE.INC",e}return(0,p.Z)(t,e),t}(OP),zq=function(){return Ce.d$b[Ce.O6N.GETPIVOTDATA_NO_MATCHING_FIELD_ITEM_PAIR]()},Wq=function(){function e(t,r,n){(0,y.Z)(this,e),this.sheet=t,this.pivotContentRange=r,this.pivotView=n}return(0,_.Z)(e,[{key:"getBlankValue",value:function(e,t,r,n){if(void 0!==this.cacheBlankValue)return this.cacheBlankValue;if(this.pivotContentRange){var a,o;"row"===e?(a=this.pivotView.col.range.rowCount+r,o=t):(a=t+1,o=this.pivotView.row.range.colCount+r);var i=this.sheet.getValue(this.pivotContentRange.rowFrom()+a,this.pivotContentRange.colFrom()+o);return this.cacheBlankValue=i,i}}}]),e}(),Gq=function(e,t,r){var n=jq(r);e.items.push([t,n]),e.maxCheckIndex=Math.max(e.maxCheckIndex,t)},jq=function(e){if("number"==typeof e){var t=String(e);return{strVal:t,dateVal:t}}if(function(e){if("CreationDoc_Sheets_PivotTable_Blank"===e)return!0;var t=e[0];return"("===t||""===t}(e))return{strVal:e,maybeBlankValue:!0};var r=e.split(" "),n=(0,g.Z)(r,2),a=n[0];if(n[1])return e;var o=a.split("/");if(3!==o.length||o.some((function(e){return e.startsWith("0")})))return e;var i=Date.UTC(Number(o[0]),Number(o[1])-1,Number(o[2]));return Number.isNaN(i)?e:{strVal:e,dateVal:String(we.SheetDate.fromUTCDate(i).toNumber())}},Yq=function(e,t,r,n,a,o){var i=r.items,u=r.maxCheckIndex;return t.reduce((function(t,r,s){if(!function(e,t,r,n,a,o,i,u){var s=r.items,l=r.types;return!(s.length<=a)&&(null===o||r.valueFieldName===o)&&n.every((function(r,n){var a=(0,g.Z)(r,2),o=a[0],c=a[1],h=s[o],f=l[n];return"string"==typeof c?h===c:3===f&&c.maybeBlankValue?i.getBlankValue(e,o,t,u)===c.strVal:h===(2===f?c.dateVal:c.strVal)}))}(e,s,r,i,u,n,a,o))return t;if(-1===t.index)return t.index=s,t.level=r.level,t.isSubTotal=r.isSubTotal,t.isConflict=!1,t;var l=t.isSubTotal,c=r.isSubTotal;if(l&&!c)return t;if(!l&&!c)return t.isConflict=!0,t;var h=t.level,f=r.level;return c&&!l||f<h?(t.index=s,t.level=r.level,t.isSubTotal=!0,t.isConflict=!1,t):f===h?(t.isConflict=!0,t):t}),{index:-1,level:1/0,isSubTotal:!1,isConflict:!1})},qq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[260,32,399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r;if(t.length%2!=0)return it.REF_ERR_VAR;for(var n=[],a=2;a<t.length;a+=2){var o=Fc(e.service,t[a],4);if(!o)return Rl(this.name,a+1,El(t[a]),wl(t[a]),it.FormulaErrorPhrases.DATA_TYPE_STRING);var i=t[a+1];if(Ga(i))i=i.toNumberVar();else if(!Ba(i))return Rl(this.name,a+2,El(i),wl(i),"".concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE,",").concat(it.FormulaErrorPhrases.DATA_TYPE_STRING));n.push(o,i)}if(!Ka(t[1]))return it.REF_ERR_VAR;var u=t[1].getRef(),s=Ps(e.workbook,u);if(!s)return it.REF_ERR_VAR;var l=kT(s,u.startRow,u.startCol,ni(u),ai(u));if(l.length<1)return it.REF_ERR_VAR;var c=null===(r=s.embeddedBlocksModel)||void 0===r?void 0:r.getBlocksMap();if(!c)return it.REF_ERR_VAR;var h=l.reduce((function(e,t){var r,n=null===(r=c[t])||void 0===r?void 0:r.position;if(!n)return e;var a=n.row,o=n.col,i=e.row,u=e.col;return(o<u||o===u&&a<i)&&(e.pivotTable=t,e.row=a,e.col=o),e}),{pivotTable:"",row:1/0,col:1/0}).pivotTable;if(!h)return it.REF_ERR_VAR;var f=s.getPivotTableManager(),d=f.getPivotInfoByName(h);if((null==d?void 0:d.errorState)!==Pp.None)return it.REF_ERR_VAR;var v=f.getViewDataModelByName(h);if(!v)return it.REF_ERR_VAR;var p=v.valueFieldInfos;if(!p||p.length<1)return it.REF_ERR_VAR;var m=t[0].getValue(),g=p.find((function(e){return e.cacheName===m||e.fieldName===m}));if(!g)return it.REF_ERR_VAR;var y=g.fieldName,_=function(e){for(var t=e.length,r=new Map,n=0;n<t-1;n+=2){var a=e[n].getValue(),o=e[n+1].getValue(),i=null===o?"":o;if(r.has(a)&&r.get(a)!==i)return null;r.set(a,i)}return r}(n);if(!_)return it.REF_ERR_VAR;var R,C=v.col,w=C.pivotInfos,E=C.colHeaderRowMap,k=v.row,T=k.pivotInfos,S=k.rowHeaderColMap,A=E&&Rt.bI in E?"col":S&&Rt.bI in S?"row":null,I={items:[],maxCheckIndex:-1},O={items:[],maxCheckIndex:-1},V=yr(_.keys());try{for(V.s();!(R=V.n()).done;){var N=R.value,b=_.get(N);if(E&&N in E)Gq(O,E[N]-1,b);else{if(!S||!(N in S))return it.REF_ERR_VAR;Gq(I,S[N],b)}}}catch(e){V.e(e)}finally{V.f()}var M=new Wq(s,d.contentRange,v),F=Yq("row",T,I,"row"===A?y:null,M,e);if(F.isConflict)return zq();var Z=Yq("col",w,O,"col"===A?y:null,M,e);if(Z.isConflict)return zq();var x=F.index,D=Z.index;if(-1===x||-1===D)return zq();var P=v.col.range.rowCount+x,$=v.row.range.colCount+D;return new it.NumberVar(Number(v.getCellValue(P,$)))}}]),t}(pw("GETPIVOTDATA",2,256,2,Vd,[{type:Nd},YE.SHEET_REF,{type:Nd},{type:Nd|Vd|Od}])),Jq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<=0)return Ks(this.name,1,r,0);var n=function(e){return 65536<=e?[55296+(e-65536>>10&1023)&65535,56320+(e-65536&1023)&65535]:[65535&e]}(r),a=String.fromCharCode.apply(null,n);return new it.StringVar(a)}}]),t}(pw("UNICHAR",1,0,0,Nd,[{type:Vd}])),Kq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=r.length;if(0===n)return Ce.d$b[Ce.O6N.PARAMETER_SHOULD_BE_NON_BLANK]({funcName:this.name,index:1});var a=r.charCodeAt(0),o=r.charCodeAt(1),i=Rq(a)&&1<n&&Cq(o)?wq(a,o):a;return new it.NumberVar(i)}}]),t}(pw("UNICODE",1,0,0,Vd,[{type:Nd}]));!function(e){e.And="AND",e.Or="OR"}(Lq||(Lq={}));var Xq=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[32,399,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1];if(!Wa(n)&&!za(n)){if(!qa(n))return Rl(this.name,2,El(n),wl(n),"".concat(it.FormulaErrorPhrases.DATA_TYPE_STRING,",").concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));n=new it.NumberVar(0)}if(r.rowCount()<2)return Gl(this.name);if(t[2].rowCount()<2)return Ce.d$b[Ce.O6N.CONDITION_ROW_MORE_THEN_TO]({funcName:this.name,value:2});for(var a=Array.from({length:r.colCount()}),o=0,i=r.colCount();o<i;o++)a[o]=r.at(0,o);var u=function(e,t){for(var r=[],n=0;n<t.length;n++){for(var a=[],o=0;o<t[n].length;o++){var i=(0,g.Z)(t[n][o],2),u=i[0],s=i[1];a.push(new Qq(e,s,u))}r.push(new eJ("AND",a))}return new eJ("OR",r)}(e,function(e,t,r){for(var n=[],a=t.rowCount(),o=t.colCount(),i=1;i<a;i++){for(var u=[],s=0;s<o;s++){var l,c=t.at(i,s);if(!qa(c)&&""!==c.getValue()){var h=tJ((null===(l=t.at(0,s).getValue())||void 0===l?void 0:l.toString())||"",r);u.push([h,c])}}n.push(u)}return n}(0,t[2],a)),s=tJ(n.getValue(),a);if(null===s)return n.isString()?al(this.name,El(n),2,a.map((function(e){return El(e)}))):gl(this.name,2,n.getValue(),1,r.colCount());var l=function(e,t){for(var r=e.rowCount(),n=e.colCount(),a=[],o=1;o<r;o++){for(var i=Array.from({length:n}),u=0;u<n;u++)i[u]=e.at(o,u);t.exec(i)&&a.push(i)}return a}(r,u);return this.execute(function(e,t){for(var r=[],n=0;n<e.length;++n)r.push(e[n][t]);return r}(l,s),e)}}]),t}(pw("",3,0,0,Vd,[YE.MATRIX_AND_SHEET_REF,{type:Vd|Nd},YE.MATRIX_AND_SHEET_REF])),Qq=function(){function e(t,r,n){if((0,y.Z)(this,e),this.fieldIndex=n,r.isString()){var a=r.getValue();!a.match(/^(<>|=|[><]=?)/)&&isNaN(Number(a))&&(r=new it.StringVar(a+"*"))}this.criteriaFunc=zP(t,r)}return(0,_.Z)(e,[{key:"exec",value:function(e){return null!==this.fieldIndex&&this.criteriaFunc(e[this.fieldIndex])}}]),e}(),eJ=function(){function e(t,r){(0,y.Z)(this,e),this.op=t,this.nodes=r}return(0,_.Z)(e,[{key:"exec",value:function(e){switch(this.op){case"AND":return this.nodes.every((function(t){return t.exec(e)}));case"OR":return this.nodes.some((function(t){return t.exec(e)}))}}}]),e}();function tJ(e,t,r){if("number"==typeof e)return 0<e&&e<=t.length?e-1:null;e=e.toLowerCase();var n=t.findIndex((function(t){var r=t.toStringVar().getValue();return null===r?-1:r.toLowerCase()===e}));return-1===n?null:n}var rJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DAVERAGE",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){return QE(t,e,null,this.name)}}]),t}(Xq),nJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DCOUNT",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){return ek(t,e)}}]),t}(Xq),aJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DCOUNTA",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){return tk(t,e)}}]),t}(Xq),oJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DPRODUCT",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){return ak(t,e)}}]),t}(Xq),iJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DSTDEV",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){var r=ik(!1,t,e,null,this.name);if(za(r)){var n=Math.sqrt(r.getValue());return new it.NumberVar(n)}return r}}]),t}(Xq),uJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DSTDEVP",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){var r=ik(!0,t,e,null,this.name);if(za(r)){var n=Math.sqrt(r.getValue());return new it.NumberVar(n)}return r}}]),t}(Xq),sJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DGET",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){for(var r=[],n=0;n<e.length;++n){var a=e[n];Ba(a)&&r.push(a)}return 0===r.length?Ce.d$b[Ce.O6N.MATCH_NOT_AVAILABLE]({funcName:"DGET"}):r.length>1?Ce.d$b[Ce.O6N.MORE_THEN_ONE_MATCH_FOUND]({funcName:"DGET"}):r[0]}}]),t}(Xq),lJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DMAX",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){return rk(t,e)}}]),t}(Xq),cJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DMIN",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){return nk(t,e)}}]),t}(Xq),hJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DSUM",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){return ok(t,e)}}]),t}(Xq),fJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DVAR",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){return ik(!1,t,e,null,this.name)}}]),t}(Xq),dJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DVARP",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e,t){return ik(!0,t,e,null,this.name)}}]),t}(Xq),vJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=tZ(t[0].getValue())-.5;return new it.NumberVar(r)}}]),t}(pw("GAUSS",1,0,0,Vd,[{type:Vd}])),pJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0].getValue(),a=t[1].getValue(),o=t[2].getValue();return n<=0?Js(this.name,n,1,0):o<=0?Js(this.name,o,3,0):(r=tZ((Math.log(n)-a)/o),new it.NumberVar(r))}}]),t}(pw("LOGNORMDIST",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),mJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LOGNORM.DIST",e}return(0,p.Z)(t,e),t}(pJ),gJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue();if(r<=0||r>=1)return js(this.name,1,r,0,1);if(a<=0)return Js(this.name,a,3,0);var o=eZ(r,0,1),i=Math.exp(n+a*o);return new it.NumberVar(i)}}]),t}(pw("LOGINV",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),yJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LOGNORM.INV",e}return(0,p.Z)(t,e),t}(gJ),_J=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue();if(r<=0||r>=1)return js(this.name,1,r,0,1);if(a<=0)return Js(this.name,a,3,0);var o=eZ(r,n,a);return new it.NumberVar(o)}}]),t}(pw("NORMINV",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),RJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="NORM.INV",e}return(0,p.Z)(t,e),t}(_J);function CJ(e,t){e=wJ(e);var r=1;(t=wJ(t))>(e-t|0)&&(t=e-t|0);for(var n=1;n<=t;n++)r*=(n+e-t|0)/n;return r}function wJ(e){return 0|Math.max(Math.min(e,2147483647),-2147483648)}function EJ(e,t,r,n){if(1029>=r){for(var a=0;e<=t;e=e+1|0)a+=CJ(r,e)*Math.pow(n,e)*Math.pow(1-n,r-e|0);return a}var o,i=wJ(r),u=wJ(r*n),s=1,l=u<=t&&u>=e?1:0,c=1;for(o=u+1|0;o<=i&&1e-13<c;o=o+1|0)s+=c*=(i-o+1|0)*n/(o*(1-n)),o<=t&&o>=e&&(l+=c);for(c=1,o=u-1|0;o>=0&&1e-13<c;o=o-1|0)s+=c*=(o+1|0)*(1-n)/((i-o|0)*n),o<=t&&o>=e&&(l+=c);return l/s}function kJ(e,t,r,n){if(e.value<0)return zs(n,e.index);var a=1e10;return t.value>a||t.value<0?Gs(n,t.index,t.value,0,a):t.value<e.value?yl(n,e.value,e.index,t.index,t.value):r.value<0||r.value>1?Gs(n,r.index,r.value,0,1):null}var TJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=kJ({index:1,value:r},{index:2,value:n},{index:3,value:a},this.name);return o||(o=EJ(t[3].getValue()?0:wJ(r),wJ(r),wJ(n),a),new it.NumberVar(o))}}]),t}(pw("BINOMDIST",4,0,0,Nd,[{type:Vd},{type:Vd},{type:Vd},{type:bd}])),SJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BINOM.DIST",e}return(0,p.Z)(t,e),t}(TJ),AJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=kJ({index:3,value:a},{index:1,value:r},{index:2,value:n},this.name),i=t[3]?t[3].getValue():a;return!o&&(i>r||i<a)&&(o=Gs(this.name,4,i,a,r)),o||(o=EJ(wJ(a),wJ(i),wJ(r),n),new it.NumberVar(o))}}]),t}(pw("BINOM.DIST.RANGE",3,1,0,Nd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd}])),IJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return zs(this.name,1);var n=t[1].getValue();if(0>=n||1<=n)return js(this.name,2,n,0,1);var a=t[2].getValue();if(0>=a||1<=a)return js(this.name,3,a,0,1);for(var o,i=wJ(r),u=0,s=i;u<s;)EJ(0,wJ(o=u+((s-u|0)/2|0)|0),i,n)>=a?s=o:u=o+1|0;return new it.NumberVar(u)}}]),t}(pw("CRITBINOM",3,0,0,Nd,[{type:Vd},{type:Vd},{type:Vd}])),OJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BINOM.INV",e}return(0,p.Z)(t,e),t}(IJ),VJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=r+n,i=NJ(this.name,r,n,a,o);if(i)return i;var u=a*EJ(wJ(n-1),wJ(n-1),wJ(o-1),a);return new it.NumberVar(u)}}]),t}(pw("NEGBINOMDIST",3,0,0,Nd,[{type:Vd},{type:Vd},{type:Vd}]));function NJ(e,t,r,n,a){var o=1e10;return t>o||t<0?Gs(e,1,t,0,o):r>o||r<1?Gs(e,2,r,1,o):a>o?Ce.d$b[Ce.O6N.NUM_PARAMETER_SUM_EXCEED_LIMIT]({funcName:e,index:1,secondArgIndex:2,value:a,upperBound:o}):n<0||n>1?Gs(e,3,r,0,1):null}var bJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3].getValue(),i=r+n,u=NJ(this.name,r,n,a,i);if(u)return u;var s=o?1-sZ(1-a,r+1,n):a*EJ(wJ(n-1),wJ(n-1),wJ(i-1),a);return new it.NumberVar(s)}}]),t}(pw("NEGBINOM.DIST",4,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:bd}])),MJ=function(e,t,r,n,a){var o=FJ(e,t);if(o.err)return o.err;var i=o.sumx,u=o.sumy,s=o.sumx2,l=o.sumy2,c=o.sumxy,h=o.count;if(0===h)return ql(n);if(1===h||h*s-i*i==0||h*l-u*u==0)return Hl(n);var f=(h*c-i*u)/Math.sqrt((h*s-i*i)*(h*l-u*u));return new it.NumberVar(a?f*f:f)};function FJ(e,t,r){for(var n=0,a=0,o=0,i=0,u=0,s=0,l=e.colCount(),c=t.colCount(),h=0,f=e.size();h<f;h++){var d=e.at(h/l|0,h%l);if(ja(d))return{err:d};var v=t.at(h/c|0,h%c);if(ja(v))return{err:v};if(za(d)&&za(v)){var p=d.getValue(),m=v.getValue();n+=p,a+=m,o+=p*p,i+=m*m,u+=p*m,s++}}return{sumx:n,sumy:a,sumx2:o,sumy2:i,sumxy:u,count:s}}var ZJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1],a=r.size(),o=n.size();return a!==o?Fl(this.name,o,a):MJ(r,n,0,this.name)}}]),t}(pw("CORREL",2,0,0,Vd,[{type:Zd},{type:Zd}])),xJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1];return 1===r.size()&&qa(r.at(0,0))||1===n.size()&&qa(n.at(0,0))?Gl(this.name):r.size()!==n.size()?Fl(this.name,r.size(),n.size()):hx(r,n,this.name,!0)}}]),t}(pw("COVARIANCE.S",2,0,0,Vd,[{type:Zd},{type:Zd}])),DJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="COVARIANCE.P",e}return(0,p.Z)(t,e),t}(dx),PJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();if(r<0)return zs(this.name,1);if(n<0)return zs(this.name,2);var a=Math.floor(r+n);if(a-1>1029)return function(e,t,r,n,a){return Ce.d$b[Ce.O6N.NUM_PARAMETER_SUM_EXCEED_LIMIT]({funcName:e,index:t,secondArgIndex:r,value:n,upperBound:a})}(this.name,1,2,a,1031);var o=zZ(a-1,Math.floor(r-1));return new it.NumberVar(o)}}]),t}(pw("COMBINA",2,0,0,Vd,[{type:Vd},{type:Vd}])),$J=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[260,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=r.length;if(255<n)return function(e,t,r,n){return it.tractorErrorVarCreators[it.ErrorCode.STRING_TOO_LONG]({funcName:e,index:t,textLength:r,maxTextLength:n})}(this.name,1,n,255);if(0===n)return new it.NumberVar(0);var a=Math.floor(t[1].getValue());if(a<2||a>36)return Gs(this.name,2,a,2,36);if("-"===r[0])return ol(this.name,r,String(a));for(var o=0;o<n&&" "===r[o];)o++;var i=0;if(o===n)return new it.NumberVar(0);for(var u=1,s=n-1;s>=o;s--){var l=32|r.charCodeAt(s),c=l-97>=0?l-87:l-48;if(c<0||c>=a)return ol(this.name,r,String(a));i+=c*u,u*=a}return new it.NumberVar(i)}}]),t}(pw("DECIMAL",2,0,0,Vd,[{type:Nd},{type:Vd}])),LJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].size(),n=t[1].size();if(r!==n)return Fl(this.name,n,r);var a=FJ(t[0],t[1]);if(a.err)return a.err;var o=a.sumx,i=a.sumy,u=a.sumy2,s=a.sumxy,l=a.count;return 0===l?Yl(this.name):1===l||l*u-i*i==0?Hl(this.name):new it.NumberVar((l*s-o*i)/(l*u-i*i))}}]),t}(pw("SLOPE",2,0,0,Vd,[{type:Zd},{type:Zd}])),BJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[1].size(),n=t[0].size();if(n!==r)return Fl(this.name,r,n);var a=FJ(t[1],t[0]);if(a.err)return a.err;var o=a.sumx,i=a.sumy,u=a.sumx2,s=a.sumy2,l=a.sumxy,c=a.count;if(c<=2||c*u-o*o==0)return Hl(this.name);var h=Math.sqrt((c*s-i*i-(c*l-i*o)*(c*l-i*o)/(c*u-o*o))/(c*(c-2)));return new it.NumberVar(h)}}]),t}(pw("STEYX",2,0,0,Vd,[{type:Zd},{type:Zd}])),UJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].size(),n=t[1].size();return r!==n?Fl(this.name,n,r):MJ(t[0],t[1],0,this.name)}}]),t}(pw("PEARSON",2,0,0,Vd,[{type:Zd},{type:Zd}])),HJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].size(),n=t[1].size();return r!==n?Fl(this.name,n,r):MJ(t[0],t[1],0,this.name,!0)}}]),t}(pw("RSQ",2,0,0,Vd,[{type:Zd},{type:Zd}])),zJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1],a=t[2],o=n.size(),i=a.size();if(o!==i)return Fl(this.name,i,o);if(1===o||1===i)return Hl(this.name);for(var u=0,s=0,l=0,c=0,h=0,f=a.colCount(),d=n.colCount(),v=0;v<o;++v){var p=n.at(v/d|0,v%d);if(ja(p))return p;var m=a.at(v/f|0,v%f);if(ja(m))return m;if(za(m)&&za(p)){var g=m.getValue(),y=p.getValue();u+=g,s+=y,l+=g*g,c+=g*y,h++}if(0===h)return Hl(this.name)}if(h*l==u*u)return Hl(this.name);var _=(h*c-s*u)/(h*l-u*u);return new it.NumberVar(s/h-_*(u/h)+_*r)}}]),t}(pw("FORECAST.LINEAR",3,0,0,Vd,[{type:Vd},{type:Zd},{type:Zd}])),WJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FORECAST",e}return(0,p.Z)(t,e),t}(zJ),GJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return Qs(this.name,r,1,0);var n=Math.trunc(t[1].getValue());if(n<1)return Qs(this.name,n,2,1);var a=Math.trunc(t[2].getValue());if(a<1)return Qs(this.name,a,3,1);var o=jJ(r,n,a);return new it.NumberVar(o)}}]),t}(pw("F.DIST.RT",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}]));function jJ(e,t,r){return 1-sZ(t*e/(t*e+r),.5*t,.5*r)}var YJ,qJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FDIST",e}return(0,p.Z)(t,e),t}(GJ),JJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return Qs(this.name,r,1,0);var n=Math.trunc(t[1].getValue());if(n<1)return Qs(this.name,n,2,1);var a=Math.trunc(t[2].getValue());if(a<1)return Qs(this.name,a,3,1);var o=0;return o=t[3].getValue()?1-sZ(a/(a+n*r),a/2,n/2):Math.pow(n/a,n/2)*Math.pow(r,n/2-1)/(Math.pow(1+r*n/a,(n+a)/2)*dZ(!0,n/2,a/2)),isFinite(o)?new it.NumberVar(o):Ys}}]),t}(pw("F.DIST",4,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:bd}])),KJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return Qs(this.name,r,1,0);if(r>1)return el(this.name,r,1,1);var n=Math.trunc(t[1].getValue());if(n<1)return Qs(this.name,n,2,1);var a=Math.trunc(t[2].getValue());if(a<1)return Qs(this.name,a,3,1);var o=fZ(1-(1-r),a/2,n/2,0,1);return new it.NumberVar(a/n*(1/o-1))}}]),t}(pw("F.INV.RT",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),XJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FINV",e}return(0,p.Z)(t,e),t}(KJ),QJ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return Qs(this.name,r,1,0);if(r>1)return el(this.name,r,1,1);var n=Math.trunc(t[1].getValue());if(n<1)return Qs(this.name,n,2,1);var a=Math.trunc(t[2].getValue());if(a<1)return Qs(this.name,a,3,1);var o=fZ(1-r,a/2,n/2,0,1);return new it.NumberVar(a/n*(1/o-1))}}]),t}(pw("F.INV",3,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd}])),eK=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ck(t[0]);if(r instanceof it.ErrorVar)return r;var n=Ck(t[1]);if(n instanceof it.ErrorVar)return n;if(1===r.length||1===r.length)return Hl(this.name);var a=wk(r),o=a.N-1,i=a.Q/(a.N-1);if(0===o||0===i)return Hl(this.name);var u=wk(n),s=u.N-1,l=u.Q/(u.N-1);if(0===s||0===l)return Hl(this.name);var c=2*(1-jJ(i/l,o,s));return c>1&&(c=2-c),new it.NumberVar(c)}}]),t}(pw("F.TEST",2,0,0,Vd,[{type:Zd},{type:Zd}])),tK=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="FTEST",e}return(0,p.Z)(t,e),t}(eK),rK=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[32,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ck(t[0]);if(r instanceof it.ErrorVar)return r;if(0===r.length)return Yl(this.name);if(1===r.length)return Hl(this.name);var n=t[1].getValue(),a=t[2]&&t[2].getValue();if(null!=a&&a<=0)return Js(this.name,a,3,0);var o=wk(r),i=o.N,u=o.Q,s=o.M,l=o.sum,c=o.sum2;if(0===u)return Hl(this.name);var h=void 0!==a?a:Math.sqrt((i*c-l*l)/(i*(i-1)));return new it.NumberVar(1-tZ((s-n)/(h/Math.sqrt(i))))}}]),t}(pw("Z.TEST",2,1,0,Vd,[{type:Zd},{type:Vd},{type:Vd,default:void 0}])),nK=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ZTEST",e}return(0,p.Z)(t,e),t}(rK),aK=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[32,32,258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1],a=r.size(),o=n.size();if(a!==o)return Fl(this.name,o,a);for(var i=t[2].getValue(),u=t[3]&&za(t[3])?t[3].getValue():i,s=0,l=0,c=0,h=r.colCount(),f=n.colCount(),d=0,v=r.size();d<v;d++){var p=r.at(d/h|0,d%h);if(ja(p))return p;var m=n.at(d/f|0,d%f);if(ja(m))return m;za(p)&&za(m)&&(i<=p.getValue()&&p.getValue()<=u&&(s+=m.getValue()),l+=m.getValue(),c++)}return c<=0?ql(this.name):1!==(0,it.convertTo15Digits)(l)?Ce.d$b[Ce.O6N.TOTAL_VALUE_SHOULD_BE_EQUAL_TO]({funcName:this.name,index:2,errorValue:l,correctValue:1}):new it.NumberVar(s)}}]),t}(pw("PROB",3,1,0,Vd,[{type:Zd},{type:Zd},{type:Vd},{type:Vd,default:void 0}])),oK=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[32,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=1-t[1].getValue();if(r>=1||r<=0)return js(this.name,2,r,0,1);var n=t[0],a=ek(e,[n]).getValue();if(a<=1)return Hl(this.name);var o=ik(!1,e,[n],null,this.name);if(!za(o))return o;var i=Math.sqrt(o.getValue());return i<=0?jl(this.name):new it.NumberVar(i*SY(r,a-1,2)/Math.sqrt(a))}}]),t}(pw("MARGINOFERROR",2,0,0,Vd,[{type:Zd},{type:Vd}])),iK=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(rZ(r,0,1))}}]),t}(pw("PHI",1,0,0,Vd,[{type:Vd}]));!function(e){e.AddTask="addTask",e.RemoveTask="removeTask",e.FinishTask="FinishTask"}(YJ||(YJ={}));var uK,sK=[[2,5e3],[4,1e4],[1/0,3e4]],lK=0,cK=null,hK=new Map,fK=new Set;function dK(e){if(e.cache_key)return e.cache_key;var t=[e.sheet_id];Object.keys(e.user_input).forEach((function(r){t.push(e.user_input[r])})),t.push(e.action_type),e.target_data&&t.push(e.target_data);var r=t.join("");try{return At()(r)}catch(e){return At()(hr.from(r).toString())}}var vK=function(e){var t=e.maxTask,r=e.retryTime,n=e.fetch,a=e.resetOperateId,o=e.getOperateId,i=e.dispatch,u=new Set,s=[],l=[],c={},h=new Map,f=function(e){delete c[e],h.delete(e),null==i||i(YJ.RemoveTask)},d=function(e){var t=h.get(e);t&&(f(e),t[1]("".concat(e," ").concat("max retry")))};function v(){var e=function(){var e=s.splice(0,t),p=!1;if(!e.length)return{v:void 0};var m=n(e,(null==o?void 0:o())||"");u.add(m),m.then((function(t){e.forEach((function(e){var n=dK(e),a=h.get(n);if(a){var o;try{o=function(e,t){return t.formula_results[e]||{}}(n,t)}catch(e){return null!=a&&a[1](e),void f(n)}switch(o.status){case Ce.crM.Success:null!=a&&a[0](o),f(n),p=!0;break;case Ce.crM.Pending:if((c[n]||0)>=r)return void d(n);c[n]=(c[n]||0)+1,l.push(e);break;case Ce.crM.PermissionDeny:case Ce.crM.Fail:case Ce.crM.Unsupported:case Ce.crM.MyAIStop:case Ce.crM.LongTimeToWait:case Ce.crM.TNS_AREA:case Ce.crM.TNS_BRAND:case Ce.crM.TNS_INPUT:case Ce.crM.TNS_OUTPUT:default:null!=a&&a[1](Object.assign({},o,{key:n})),f(n)}}}))})).catch((function(t){console.error("request fail",e,t),e.forEach((function(e){var t=dK(e);c[t]=(c[t]||0)+1,(c[t]||0)>=r&&d(t)})),e.forEach((function(e){c[dK(e)]<r&&s.push(e)}))})).finally((function(){if(u.delete(m),s.length)v();else if(0===u.size&&l.length){var e;s=(e=[l,s])[0],l=e[1],lK++;for(var t=sK.length-1,r=sK[t][1],n=0;n<t;n++)if(lK<=sK[n][0]){r=sK[n][1];break}setTimeout(v,r)}else 0===u.size&&0===l.length&&(lK=0,null!==cK&&clearTimeout(cK),cK=setTimeout((function(){s.length||u.size||l.length||null!=a&&a(),cK=null}),100));p&&(null==i||i(YJ.FinishTask))}))};for(uK=void 0;s.length&&u.size<2;){var p=e();if("object"===(0,R.Z)(p))return p.v}}return{addTask:function(e,t){var r=e.cache_key;if(t){var n=hK.get(r);n?n.push(t):hK.set(r,[t])}if(h.has(r))return h.get(r)[2];var a=function(){var e=function(){},t=e,r=e,n=new Promise((function(e,n){t=e,r=n}));return[t,r,n]}();return s.push(e),h.set(r,a),0===u.size&&void 0===uK&&(uK=setTimeout(v,0)),null!=i&&i(YJ.AddTask),a[2]},removeTask:function(e){h.has(e)&&f(e)},statusNot0Err:VK,cache:new Map,taskToCellMap:hK,longTimeTaskSet:fK,resetOperateId:a,getOperateId:o,getAiCacheKey:dK}};function pK(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}function mK(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){pK(o,n,a,i,u,"next",e)}function u(e){pK(o,n,a,i,u,"throw",e)}i(void 0)}))}}function gK(e){return yK.apply(this,arguments)}function yK(){return(yK=mK(i().mark((function e(t){var r,n,a,o,u,s,l,c,h;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.indexOf("{"),n=t.indexOf("["),a=/^[^{]+/,o=/[^}]+$/,u=/^[^\[]+/,s=/[^\]]+$/,c=t.replace(/\t/g,"  "),h="",-1!==r&&-1!==n?r<n?(h=c.replace(a,""),c=h.replace(o,"")):(h=c.replace(u,""),c=h.replace(s,"")):r>-1?(h=c.replace(a,""),c=h.replace(o,"")):n>-1&&(h=c.replace(u,""),c=h.replace(s,"")),e.prev=3,l=JSON.parse(c),e.next=12;break;case 7:return e.prev=7,e.t0=e.catch(3),e.next=11,CK(c).catch((function(e){return TK(h)}));case 11:l=e.sent;case 12:return e.abrupt("return",l);case 13:case"end":return e.stop()}}),e,null,[[3,7]])})))).apply(this,arguments)}function _K(){return RK.apply(this,arguments)}function RK(){return(RK=mK(i().mark((function e(){var t;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("vsh_2884").then(r.t.bind(r,"vsh_22884",23));case 2:return t=e.sent,e.abrupt("return",t.default||t);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function CK(e){return wK.apply(this,arguments)}function wK(){return(wK=mK(i().mark((function e(t){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_K();case 2:return e.abrupt("return",e.sent.parse(t));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function EK(){return kK.apply(this,arguments)}function kK(){return(kK=mK(i().mark((function e(){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.e("vsh_8839").then(r.bind(r,"vsh_28839"));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function TK(e){return SK.apply(this,arguments)}function SK(){return(SK=mK(i().mark((function e(t){var r;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,EK();case 2:return r=e.sent.jsonrepair(t),e.abrupt("return",JSON.parse(r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function AK(e,t){return"object"==(0,R.Z)(e)&&t.every((function(t){return t in e}))}function IK(){return(IK=mK(i().mark((function e(t,r){var n,a,o,u,s;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r.formatterService,e.prev=1,e.next=4,gK(t);case 4:if(a=e.sent,!Array.isArray(a)){e.next=8;break}return o=a[0],u=Object.keys(o),s=[u.map((function(e){return new it.StringVar(String(e))}))],e.abrupt("return",(AK(a[a.length-1],u)||a.pop(),a.forEach((function(e){var t=[];u.forEach((function(r){var a=e[r]||"";t.push(OK(a,n))})),s.push(t)})),s));case 8:return e.abrupt("return",it.RUNTIME_ERR_VAR);case 11:return e.prev=11,e.t0=e.catch(1),e.abrupt("return",it.RUNTIME_ERR_VAR);case 14:case"end":return e.stop()}}),e,null,[[1,11]])})))).apply(this,arguments)}var OK=function(e,t,r){if("number"==typeof e||/^-?[1-9]\d*(\.\d+)?$/.test(e)){var n,a=String(e);return((null===(n=a.match(/\d/g))||void 0===n?void 0:n.length)||0)>15?new it.StringVar(a):new it.NumberVar(Number(e))}var o=(0,Ee.getPreferredFormatter)(t,e),i=o.value,u=o.formatter;if(i instanceof we.SheetDate){var s=new it.NumberVar(i.toNumber()),l=u.getFormatCode();return s.setSpecialInfo({customData:{autoFormat:l}}),s}return new it.StringVar(e)},VK=new it.ErrorVar(it.ErrorType.RUNTIME_ERROR,it.ErrorConstant.RUNTIME_ERROR,Ce.O6N.REQUEST_FAIL),NK=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Ce.crM.TNS_AREA,r=Ce.crM.TNS_BRAND,n=Ce.crM.TNS_INPUT,a=Ce.crM.TNS_OUTPUT,o=Ce.crM.PermissionDeny,i=Ce.crM.MyAIStop,u=Ce.crM.LongTimeToWait,s=Ce.crM.ContextTooLong,l=e.text,c=e.status,h=e.funcName;return c===i?new it.ErrorVar(it.ErrorType.NAME,it.ErrorConstant.NAME,Ce.O6N.SHEET_AI_NO_PERMISSION_ADMIN):c===o?new it.ErrorVar(it.ErrorType.NAME,it.ErrorConstant.NAME,Ce.O6N.SHEET_AI_NO_PERMISSION_FG):[t,r,n,a].includes(c)?new it.StringVar(l):c===u?new it.ErrorVar(it.ErrorType.WAIT_ASYNC,it.ErrorConstant.WAIT_ASYNC,Ce.O6N.SHEET_AI_TAG_DATABASE_LOADING):c===s?new it.ErrorVar(it.ErrorType.RUNTIME_ERROR,it.ErrorConstant.RUNTIME_ERROR,Ce.O6N.SHEET_AI_CONTEXT_TOO_LONG,{args:h}):VK};function bK(e,t,r,n,a){var o,i=dK(t);if(t.cache_key=i,e.cache.has(i)&&!t[Ce.nbU])return e.cache.get(i);n||(n=function(t){var n=t;return 0!==n.status?e.statusNot0Err:OK(n.text,r)});var u=null===(o=e.resultMapFromServer)||void 0===o?void 0:o.get(i);if(u){var s=n(u);if(s instanceof Promise){var l=null==a?void 0:a.formula;return s.then((function(t){return e.resultMapFromServer.delete(i),c(t)})).finally((function(){l&&a&&a.service.emit("afterWaitAsyncCalc",l,2)})),it.WAIT_ASYNC_ERR_VAR}return e.resultMapFromServer.delete(i),c(s)}function c(t){return ja(t)&&t.errorType===it.ErrorType.WAIT_ASYNC&&t.errorCode!==Ce.O6N.SHEET_AI_TAG_DATABASE_LOADING||e.cache.set(i,t),t}var h=null==a?void 0:a.formula;return e.addTask(t,a?ou.fromGridRange(a.ref,Ps(a.workbook,a.ref)):void 0).then((function(e){var t=n(e);return t instanceof Promise?t.then(c):c(t)})).catch((function(t){return t.status===Ce.crM.LongTimeToWait&&a&&e.longTimeTaskSet.add(t.key),c(NK(t))})).finally((function(){h&&a&&a.service.emit("afterWaitAsyncCalc",h,2)})),a&&a.service.addCalculatingAsyncFormula(a.formula),it.WAIT_ASYNC_ERR_VAR}var MK=function(e,t,r){var n,a=e.getValue(t,r,void 0,void 0,!0);if(a&&"object"==(0,R.Z)(a))return null!==(n=a.text)&&void 0!==n?n:"";var o=e.getActualFormatter(t,r),i=e.parent.formatterService;return o?i.getFormattedText(o,a):a},FK=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:",",n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(ro(e)){var a=e.getRef(),o=Ps(t.workbook,a);if(o){for(var i=e.rowCount(),u=e.colCount(),s=[],l=0;l<i;++l)for(var c=0;c<u;++c)s.push(MK(o,a.startRow+l,a.startCol+c));return n?s.join(r):s}}return e.at(0,0).getValue()},ZK=function(e){return!!ro(e)&&1!==e.size()},xK=function(e){return!!ro(e)&&1===e.rowCount()},DK=function(e){return!!ro(e)&&1===e.colCount()},PK=function(){return new it.ErrorVar(it.ErrorType.VALUE,it.ErrorConstant.VALUE,Ce.O6N.SHEET_AI_FORBIDDEN_RANGE)},$K=function(e){return 0===String(e).trim().length},LK=function(){return(Ce.Ps3.browser.isMobile?"mb-":"pc-")+(0,Tt.v4)()+(new Date).getTime().toString()},BK=LK(),UK=function(){BK=LK()},HK=function(){return BK};function zK(e){e.setSpecialInfo({refresh:!0})}function WK(e){var t,r=null===(t=e.getSpecialInfo())||void 0===t?void 0:t.refresh;return r&&e.setSpecialInfo({refresh:null}),r}function GK(e,t){return it.tractorErrorVarCreators[it.ErrorCode.NO_VALID_DATA]({funcName:e},t)}var jK=function(){function e(){(0,y.Z)(this,e),this.cache=new Map}return(0,_.Z)(e,[{key:"getId",value:function(e,t,r){var n=e.filter((function(e){return(0,oe.default)(e,"extraMap.oldActionType")===t})),a=n.find((function(e){return(0,oe.default)(e,"extraMap.lang")===r}));if(a)return a.id;var o=n.find((function(e){return"en"===(0,oe.default)(e,"extraMap.lang")}));if(o)return o.id;var i=n[0];return null==i?void 0:i.id}},{key:"prefetchAIActions",value:function(){var e=this;if(!this.actions){var t=(0,oe.default)(Ce.Ps3,"serverApi.aiRequest.getAiActionList");return t?t().then((function(t){return e.actions=t,!0})):(console.log("sheet base version error"),!0)}return!0}},{key:"prefetchLLPPInfo",value:function(){return this.actionConfig||(this.actionConfig=Ce.Ps3.serverApi.aiRequest.getQuickActionConfig()),!0}},{key:"getActionIdByActionType",value:function(e,t){var r="".concat(e,",").concat(t),n=this.cache.get(r);return!n&&this.actions&&(n=this.getId(this.actions,e,t),this.cache.set(r,n)),n}},{key:"getTaskKeyByActionType",value:function(e,t){var r,n,a="llpp-task-key".concat(e,"-").concat(t),o=this.cache.get(a),i="zh"===t?"zh":"en";return o||(o=null===(r=this.actionConfig)||void 0===r||null===(n=r.find((function(t){return t.action_type===e&&t.lang===i})))||void 0===n?void 0:n.llpp_task_key,o&&this.cache.set(a,o)),o}}]),e}(),YK=new jK,qK=[Ce.O6N.REQUEST_FAIL,Ce.O6N.IMPORT_ERR_UNKNOWN,Ce.O6N.IMPORT_ERR_CRAWL_WAITING,Ce.O6N.IMPORT_ERR_CRAW_RUNNING,Ce.O6N.IMPORT_ERR_CRAW_FAIL],JK=3e3,KK=3e3,XK=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new QK;(0,y.Z)(this,e),this.spread=t,this.netWorkController=n,this.importFormulaContentMap=new Map,this.formulasMap=new Map,this.uniqueKeyCache=new Ce.z6B(50),this.refreshImportFormulaIds=new Set,this.onFormulaCalcFinished=function(){var e=r.spread.calcEngine,t=e.formulaSpace,n=e.formulaService;0===t.dirtyFormulas.size&&0===n.getCalculatingAsyncFormulas().size&&(r.refreshErrorContent(),r.uniqueKeyCache.clear())},this.onFormulaUnregister=function(e){var t=r.formulasMap.get(e);t&&t.size&&(t.forEach((function(t){var n=r.importFormulaContentMap.get(t);n&&(n.formulas.delete(e),n.formulas.size||r.importFormulaContentMap.delete(t))})),r.formulasMap.delete(e))},this.bindEvents()}var t;return(0,_.Z)(e,[{key:"bindEvents",value:function(){var e=this.spread.calcEngine,t=e.formulaSpace;e.formulaService.addListener(it.FormulaEvents.onFormulaValuesChanged,this.onFormulaCalcFinished),t.addListener(it.FormulaSpaceEvents.onFormulaUnregistered,this.onFormulaUnregister)}},{key:"unbindEvents",value:function(){var e=this.spread.calcEngine,t=e.formulaSpace;e.formulaService.removeListener(it.FormulaEvents.onFormulaValuesChanged,this.onFormulaCalcFinished),t.removeListener(it.FormulaSpaceEvents.onFormulaUnregistered,this.onFormulaUnregister)}},{key:"setImportFormulaContent",value:function(e,t,r,n,a){var o=this.importFormulaContentMap.get(r);o?o.formulas.add(e):this.importFormulaContentMap.set(r,{id:r,paramsJson:t,link:n,category:a,formulas:new Set([e])});var i=this.formulasMap.get(e);i?i.add(r):this.formulasMap.set(e,new Set([r]))}},{key:"fetchFormulaDataById",value:function(e){var t=this.getCurrentSpreadToken(),r=this.importFormulaContentMap.get(e);return r?(r.promise||(r.promise=this.createFetchPromise(t,r)),r.promise):Promise.reject((0,Ce.NN_)(Ce.O6N.IMPORT_ERR_INVAILD_PARAM,""))}},{key:"createFetchPromise",value:function(e,t){var r=this,n=Rw(),a=n.promise,o=n.resolve,i=n.reject;return this.netWorkController.handleFetchData(e,{uniqueKey:t.id,content:(0,Ce.h$Q)(t.paramsJson),category:t.category,resolve:o,reject:i}),a.then((function(e){return t.promise=void 0,t.data=e,e})).catch((function(n){return n instanceof Ce.AXu&&qK.includes(n.code)?t.retryTimes&&t.retryTimes>=2?(t.promise=void 0,t.data=n,n):(0,Ce.Dc1)(JK).then((function(){return void 0===t.retryTimes?t.retryTimes=1:t.retryTimes++,r.createFetchPromise(e,t)})):(t.promise=void 0,t.data=n,n)}))}},{key:"getImportFormulaId",value:function(e,t){var r=this.uniqueKeyCache.get("".concat(e,"_").concat(t));if(r)return r;var n=At()(e,t);return this.uniqueKeyCache.set("".concat(e,"_").concat(t),n),n}},{key:"getFormulaDataById",value:function(e){var t,r;return null!==(t=null===(r=this.importFormulaContentMap.get(e))||void 0===r?void 0:r.data)&&void 0!==t?t:null}},{key:"getImportFormulasById",value:function(e){var t,r=null===(t=this.importFormulaContentMap.get(e))||void 0===t?void 0:t.formulas;return r&&r.size?Array.from(r):[]}},{key:"getIdsByFormula",value:function(e){var t=this.formulasMap.get(e);return t&&t.size?Array.from(t):[]}},{key:"getIdByFormula",value:function(e){var t=this.getIdsByFormula(e);return t.length?1===t.length?t[0]:t.sort()[0]:null}},{key:"getLabelInfoById",value:function(e){var t=this.importFormulaContentMap.get(e);return t?!t.data||t.data instanceof Ce.AXu?{id:e,link:t.link,category:t.category}:{id:e,link:t.link,category:t.category,lastModifyTime:t.data.crawlTimestamp}:null}},{key:"getImportFmlContent",value:function(e){return this.importFormulaContentMap.get(e)}},{key:"getCurrentSpreadToken",value:function(){return this.spread.getService(It.UU).token}},{key:"refreshImportFormula",value:(t=(0,u.Z)(i().mark((function e(t){var r,n,a,o,u,s=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],n=yr(t);try{for(n.s();!(a=n.n()).done;)o=a.value,(u=this.importFormulaContentMap.get(o))&&(u.data=void 0,this.refreshImportFormulaIds.add(o),r.push({uniqueKey:o,category:u.category,content:(0,Ce.h$Q)(u.paramsJson)}),this.markDirtyFormulasById(o))}catch(e){n.e(e)}finally{n.f()}this.netWorkController.requestImportFormulaRefresh(this.getCurrentSpreadToken(),r),this.refreshImportFormulaTimer&&clearTimeout(this.refreshImportFormulaTimer),this.refreshImportFormulaTimer=setTimeout((function(){s.refreshImportFormulaIds.size&&(s.refreshImportFormulaIds.forEach((function(e){return s.fetchFormulaDataById(e)})),s.refreshImportFormulaIds.clear()),s.refreshImportFormulaTimer&&clearTimeout(s.refreshImportFormulaTimer)}),KK);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"handleServerMessage",value:function(e,t){this.refreshImportFormulaIds.delete(e);var r=this.importFormulaContentMap.get(e);if(r){var n=(0,Ce.R5d)(t);n?r.data=n:this.fetchFormulaDataById(e),this.markDirtyFormulasById(e)}}},{key:"markDirtyFormulasById",value:function(e){if(this.importFormulaContentMap.get(e)){var t=this.getImportFormulasById(e);this.spread.calcEngine.markDirty(t.map((function(e){return e.getRef()})),Bs)}}},{key:"reCalcImportFormulas",value:function(){var e=this,t=[];this.formulasMap.forEach((function(r,n){n.isDirty()||(r.forEach((function(t){return e.importFormulaContentMap.delete(t)})),t.push(n.getRef()))})),t.length&&this.spread.calcEngine.markDirty(t,Bs)}},{key:"refreshErrorContent",value:function(){this.importFormulaContentMap.forEach((function(e){e.data&&(e.data instanceof Ce.AXu||e.data instanceof it.ErrorVar)&&(e.data=void 0)}))}},{key:"hasBlackToken",value:function(e){var t=e.formula.tokens;if(!t||!t.length)return!0;var r=function(e){var r=t[e];if(Ce.nFA.find((function(e){return r.includes(e)})))return{v:!0}};for(var n in t){var a=r(n);if("object"===(0,R.Z)(a))return a.v}return!1}},{key:"reset",value:function(){this.importFormulaContentMap.clear(),this.uniqueKeyCache.clear(),this.netWorkController.reset()}},{key:"dispose",value:function(){this.reset(),this.unbindEvents()}}]),e}();XK.ImportFormulaPromiseMap=new Map;var QK=function(){function e(){(0,y.Z)(this,e)}var t;return(0,_.Z)(e,[{key:"setMetaProvider",value:function(e){this.metaRequestProvider=e}},{key:"setBlockProvider",value:function(e){this.blockRequestProvider=e}},{key:"setRefreshProvider",value:function(e){this.refreshRequestProvider=e}},{key:"initRequestQueue",value:function(e){this.requestQueue||(this.requestQueue=new Dw((0,l.Z)({},dw.ImportFormulas,this.requestImportFormulaData.bind(this))),void 0!==e&&this.requestQueue.setDelayTime(e))}},{key:"handleFetchData",value:function(e,t){var r;this.initRequestQueue();var n=Rw(),a=n.promise,o=n.resolve,i=n.reject;return null!==(r=this.requestQueue)&&void 0!==r&&r.push({type:dw.ImportFormulas,spreadToken:e,params:t,resolve:o,reject:i}),a}},{key:"requestImportFormulaData",value:function(e,t){var r=this;this.metaRequestProvider||(this.metaRequestProvider=Ce.Ps3.serverApi.importFormula.requestImportFormulaMeta);Ew(t.reduce((function(e,t){return e.find((function(e){return e.uniqueKey===t.uniqueKey}))||e.push(t),e}),[]),(function(t){return r.metaRequestProvider({token:e,formulas:t.map((function(e){return{category:e.category,content:e.content,uniqueKey:e.uniqueKey}}))}).then((function(n){n||t.forEach((function(e){return(0,e.reject)(Ce.rur[Ce.O6N.REQUEST_FAIL])}));for(var a=function(a){var o=n[a],i=t.find((function(e){return e.uniqueKey===o.uniqueKey})),u=(0,Ce.R5d)(o.status);if(u)null==i||i.reject(u);else if(o.formulaData)if("IMAGE"!==o.category)r.requestImportFormulaBlock(e,o).then((function(e){null==i||i.resolve(e)}));else{var s=JSON.parse((0,Ce.tVG)(o.formulaData)).fileToken;null==i||i.resolve({id:o.uniqueKey,category:o.category,crawlTimestamp:o.crawlTimestamp,fileToken:s})}else null==i||i.reject(Ce.rur[Ce.O6N.IMPORT_ERR_CRAW_FAIL])},o=0;o<n.length;o++)a(o)})).catch((function(e){t.forEach((function(t){return(0,t.reject)(e)}))}))}))}},{key:"requestImportFormulaBlock",value:(t=(0,u.Z)(i().mark((function e(t,r){var n,a,o,s,l,c,h,f,d=this;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.blockRequestProvider||(this.blockRequestProvider=Ce.Ps3.serverApi.importFormula.requestImportFormulaBlock),n=JSON.parse((0,Ce.tVG)(r.formulaData)),a=n.blockTokens,o=n.rowCounts,s=n.rowStarts,l=n.totalRowCount,c=n.totalColCount,a){e.next=4;break}return e.abrupt("return",Ce.rur[Ce.O6N.NO_QUERY_OUTPUT]);case 4:return h=[],f=function(){var e=(0,u.Z)(i().mark((function e(r){var n,a,u,l;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.blockRequestProvider({token:t,blockTokens:r});case 2:for(n=e.sent,a=0;a<n.length;a++)u=n[a],l=r.indexOf(u.blockToken),h.push({rowStart:s[l],rowCount:o[l],gzipDataTable:u.gzipDataTable});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.next=7,Ew(a,f);case 7:return e.abrupt("return",{id:r.uniqueKey,category:r.category,crawlTimestamp:r.crawlTimestamp,totalRowCount:l,totalColCount:c,table:eX(h,l,c)});case 8:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"requestImportFormulaRefresh",value:function(e,t){this.refreshRequestProvider||(this.refreshRequestProvider=Ce.Ps3.serverApi.importFormula.requestImportFormulaRefresh),this.refreshRequestProvider({token:e,formulas:t})}},{key:"reset",value:function(){this.requestQueue&&(this.requestQueue.dispose(),this.requestQueue=void 0)}}]),e}();function eX(e,t,r){for(var n=[],a=0,o=0;o<e.length;o++){for(var i=e[o],u=i.rowStart,s=i.rowCount,l=i.gzipDataTable,c=a;c<u;c++)n[c]=new Array(r).fill(it.NULL_VAR);for(var h=(0,Ce.ecX)(l),f=u+s,d=a;d<f;d++){var v;if(h.rows[d-a]){n[d]||(n[d]=[]);for(var p=null!==(v=h.rows[d-a].columns)&&void 0!==v?v:[],m=0;m<r;++m){var g=it.NULL_VAR;if(m<p.length&&p[m])g=Cw(p[m].value,{});n[d][m]=g}}else n[d]=new Array(r).fill(it.NULL_VAR)}a=f}for(var y=a;y<t;++y)n[y]=[it.NULL_VAR];return n}var tX,rX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ps(e.workbook,e.ref),n=e.workbook.aiManager;if(!r||!n)return it.RUNTIME_ERR_VAR;for(var a=r.id(),o=[],i=0;i<t.length;i++){var u=t[i];if(ZK(u)){for(var s=[],c=u.rowCount(),h=u.colCount(),f=0;f<c;f++){for(var d=0;d<h;d++){var v=u.at(f,d);if(v.isError())return v;var p=v.isNull()?"":FK(v,e,"");s.push("| ".concat(p," ")),d===h-1&&s.push("|")}f!==c-1&&s.push("\n")}o.push('"""'.concat(s.join(""),'"""'))}else{if(Ba(u)&&(Wa(u)||za(u)||(u=Zc(e.service,u)||Rl(this.name,i+1,El(u),wl(u),"".concat(it.FormulaErrorPhrases.DATA_TYPE_STRING,",").concat(it.FormulaErrorPhrases.DATA_TYPE_DOUBLE)))),ja(u.at(0,0)))return u.at(0,0);var m=FK(u,e);o.push(Ba(u)?m:'"""'.concat(m,'"""'))}}var g=o.join("");if($K(g))return GK(this.name);var y=(0,l.Z)({user_input:{user_input:g},action_type:this.actionType,sheet_id:a,funcName:this.name},Ce.nbU,WK(r.getVar(e.ref.startRow,e.ref.startCol)));return e.info.cacheKeys||(e.info.cacheKeys=[]),e.info.cacheKeys.push(dK(y)),bK(n,y,r.formatterService,void 0,e)}}]),t}(pw("AI_WRITE",1,255,1,Nd,[{type:Nd|Zd|Vd}])),nX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="AI_WRITE",e.actionType="sheet_textual_nlp",e}return(0,p.Z)(t,e),t}(rX),aX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="AI_DEEPSEEK_WRITE",e.actionType="sheet_textual_nlp_ds",e}return(0,p.Z)(t,e),t}(rX),oX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="AI_ASK",e.actionType="enterprise_qa",e}return(0,p.Z)(t,e),t}(rX),iX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$cacheType=0,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ps(e.workbook,e.ref),n=e.workbook.aiManager;if(!r||!n)return it.RUNTIME_ERR_VAR;for(var a=r.id(),o=[],i=0;i<t.length;i++){var u=t[i];if(Ba(u)&&(u=xc(u)||Rl(this.name,i+1,El(u),wl(u),it.FormulaErrorPhrases.DATA_TYPE_STRING)),ZK(u))return PK();if(ja(u.at(0,0)))return u.at(0,0);o.push(FK(u,e))}var s=o.join(",");if($K(s))return GK(this.name);var c=(0,l.Z)({user_input:{user_input:s},action_type:"sheet_import_data",sheet_id:a,funcName:this.name},Ce.nbU,WK(r.getVar(e.ref.startRow,e.ref.startCol)));return e.info.cacheKeys||(e.info.cacheKeys=[]),e.info.cacheKeys.push(dK(c)),bK(n,c,r.formatterService,(function(e){var t=e;return 0!==t.status?Promise.resolve(n.statusNot0Err):function(e,t){return IK.apply(this,arguments)}(t.text,r).then((function(e){return Array.isArray(e)?new gs(e):NK({text:"AI_IMPORTDATA parse data to JSON failed"})}))}),e)}}]),t}(pw("AI_IMPORTDATA",1,256,1,Bd|Zd|Pd,[{type:Zd|Nd}]));function uX(e,t,r,n,a,o,i){try{var u=e[o](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,a)}iX=Vu([Cp("AI_IMPORTDATA")],iX),function(e){e[e.first=0]="first",e[e.second=1]="second",e[e.third=2]="third"}(tX||(tX={}));var sX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$cacheType=0,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ps(e.workbook,e.ref),n=e.workbook.aiManager;if(!r||!n)return it.RUNTIME_ERR_VAR;for(var a=r.id(),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=[],r=[],n=[];return{add:{addExampleInputList:function(r){var n=Array.isArray(r)?r:[r];t.length<e&&(0,Ce.hTd)(t,n)},addExampleOutputList:function(e){var n=Array.isArray(e)?e:[e];r.length<t.length&&(0,Ce.hTd)(r,n)},addTargetInputList:function(e){var t=Array.isArray(e)?e:[e];(0,Ce.hTd)(n,t)}},getState:function(){return{exampleInputList:t,exampleOutputList:r,targetInputList:n}}}}(),u=0;u<t.length;u++){var s=t[u];if(!xK(s)&&!DK(s))return Jl(this.name);var c=s.forEach((function(e){if(ja(e))return e}));if(c)return c;var h=FK(s,e,",",!1);u===tX.first?o.add.addExampleInputList(h):u===tX.second?o.add.addExampleOutputList(h):u===tX.third&&o.add.addTargetInputList(h)}var f=o.getState(),d=f.exampleInputList,v=f.exampleOutputList,p=f.targetInputList,g=(0,l.Z)({user_input:{example_input:JSON.stringify(d),example_output:JSON.stringify(v),target_input:JSON.stringify(p)},action_type:"sheet_infer",sheet_id:a,funcName:this.name},Ce.nbU,WK(r.getVar(e.ref.startRow,e.ref.startCol)));return e.info.cacheKeys||(e.info.cacheKeys=[]),e.info.cacheKeys.push(dK(g)),bK(n,g,r.formatterService,function(){var e=function(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){uX(o,n,a,i,u,"next",e)}function u(e){uX(o,n,a,i,u,"throw",e)}i(void 0)}))}}(i().mark((function e(t){var r,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],e.prev=1,0===t.status){e.next=4;break}return e.abrupt("return",n.statusNot0Err);case 4:return e.next=6,gK(t.text);case 6:(a=e.sent).flat().slice(0,p.length),a.forEach((function(e){var t;if("number"==typeof(t="object"==(0,R.Z)(e)?e.value:e))r.push(new it.NumberVar(t));else{var n=new it.StringVar(String(t));r.push(n)}})),e.next=13;break;case 10:return e.prev=10,e.t0=e.catch(1),e.abrupt("return",Ce.d$b[Ce.O6N.NO_QUERY_OUTPUT]());case 13:return e.abrupt("return",new gs((0,m.Z)(r.map((function(e){return[e]})))));case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}(),e)}}]),t}(pw("AI_INFER",3,0,1,Zd|Pd,[{type:Zd}]));function lX(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cX(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})),e}sX=Vu([Cp("AI_INFER")],sX);var hX=3,fX=1e4,dX=new it.ErrorVar(it.ErrorType.REF,it.ErrorConstant.REF,Ce.O6N.SHEET_AI_TAG_DATABASE_RANGE_ROW_LIMIT),vX=new it.ErrorVar(it.ErrorType.REF,it.ErrorConstant.REF,Ce.O6N.SHEET_AI_TAG_DATABASE_RANGE_COL_LIMIT),pX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[32,258,32,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"checkError",value:function(e){if(1!==e.rowCount()||1!==e.colCount())return null;var t=e.at(0,0);return t.isError()?t:null}},{key:"func",value:function(e,t){var r=t[0];if(Ba(r)&&ja(r=xc(r)||Rl(this.name,1,El(r),wl(r),it.FormulaErrorPhrases.DATA_TYPE_STRING)))return r;var n=t[1],a=t[2];if(Ba(a)&&ja(a=xc(a)||Rl(this.name,3,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_STRING)))return a;var o=t[3]&&za(t[3])?t[3]:new it.NumberVar(20),i=Ps(e.workbook,e.ref),u=e.workbook.aiManager;if(!i||!u)return it.RUNTIME_ERR_VAR;if(ZK(r))return PK();for(var s=0,c=[r,n,a,o];s<c.length;s++){var h=c[s],f=this.checkError(h);if(f)return f}var d=[FK(r,e)],v=n.getValue();if("history"===i.parent.options.situation&&2===v)return PK();var p=function(e){switch(e){case 1:return"sheet_infer_tag";case 2:return"sheet_refer_tag";default:return"sheet_classify_tag"}}(v),m=i.id(),g=d.join(",");if($K(g))return GK(this.name);var y=(0,l.Z)({user_input:{user_input:g},action_type:p,sheet_id:m,funcName:this.name},Ce.nbU,WK(i.getVar(e.ref.startRow,e.ref.startCol)));if(2===v){if(!ro(a)&&!function(e){return 536870944===e.$$type}(a))return it.REF_ERR_VAR;var _,R;if(Xa(a)){var C=this.getTargetRangeInfo(e,a);if(C instanceof it.ErrorVar)return C;_=C;var w=a.getRef(),E=Ps(e.workbook,w).id(),k=Eu(w),T="".concat(E,"!").concat(k.toString({refStyle:"A1",ref:k}));if(!E||!T)return it.REF_ERR_VAR;y.user_input.range=T}else{var S=this.getTargetImportRangeInfo(e,a);if(S instanceof it.ErrorVar)return S;_=S,y.user_input.import_range=a.importRangeId}var A=null!==(R=o.getValue())&&void 0!==R?R:20;if(A<=0)return it.VALUE_ERR_VAR;y.user_input.topk=String(A),y.cache_key=dK(cX(function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{},n=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(r).filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable})))),n.forEach((function(t){lX(e,t,r[t])}))}return e}({},y),{target_data:_}))}else{var I=FK(a,e);if($K(I))return GK(this.name);y.user_input.tag_input=I}return e.info.cacheKeys||(e.info.cacheKeys=[]),e.info.cacheKeys.push(dK(y)),bK(u,y,i.formatterService,void 0,e)}},{key:"getDataRowCount",value:function(e,t,r,n,a,o){if(a>hX)return vX;if(n<2)return it.REF_ERR_VAR;var i=e.service.getFuncCacheManager().getInnerFuncCache("AI",{autoBuildCache:!1});if(i){var u=i.getCache(r,e).get(t);if(u)return u.valueRowCount>fX?dX:u.targetData}for(var s="",l=0,c=0;c<n;c++)for(var h=0;h<a;h++){var f,d=null!==(f=o(c,h))&&void 0!==f?f:"";if(d instanceof it.ErrorVar)return d;d&&(s+=d,c&&0===h&&""!==d&&l++)}var v={targetData:s,valueRowCount:l};return i&&n*a>300&&i.getCache(r,e).set(t,v),l>fX?(v.targetData="",dX):s}},{key:"getTargetRangeInfo",value:function(e,t){var r=t.getRef(),n=Eu(r).id(!1),a=Ps(e.workbook,r);if(!a)return it.RUNTIME_ERR_VAR;var o=a.id();return this.getDataRowCount(e,n,o,t.rowCount(),t.colCount(),(function(e,n){var o=t.at(e,n);return ja(o)?o:MK(a,r.startRow+e,r.startCol+n)}))}},{key:"getTargetImportRangeInfo",value:function(e,t){var r=t.importRangeId,n=t.rowCount(),a=t.colCount();if(!r)return it.REF_ERR_VAR;var o=Ps(e.workbook,e.ref);if(!o)return it.RUNTIME_ERR_VAR;var i=o.id();return this.getDataRowCount(e,r,i,n,a,(function(e,r){var n=t.at(e,r);return Ba(n)?ja(n)?n:n.getValue():null}))}}]),t}(pw("AI_CLASSIFY",3,1,0,Zd|Pd,[{type:Zd|Nd},{type:Vd},{type:Zd|Nd},{type:Vd,default:new it.NumberVar(20)}])),mX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ps(e.workbook,e.ref),n=e.workbook.aiManager;if(!r||!n)return it.RUNTIME_ERR_VAR;for(var a=r.id(),o=[],i="",u=0;u<t.length;u++){var s=t[u];if(Ba(s)&&(s=xc(s)||Rl(this.name,u+1,El(s),wl(s),it.FormulaErrorPhrases.DATA_TYPE_STRING)),ZK(s))return PK();if(ja(s.at(0,0)))return s.at(0,0);0===u?o.push(FK(s,e)):1===u&&(i=FK(s,e))}var c=o.join(",");if($K(c)||$K(i))return GK(this.name);var h=(0,l.Z)({user_input:{user_input:c,extract_type:i},action_type:"sheet_extract",sheet_id:a,funcName:this.name},Ce.nbU,WK(r.getVar(e.ref.startRow,e.ref.startCol)));return e.info.cacheKeys||(e.info.cacheKeys=[]),e.info.cacheKeys.push(dK(h)),bK(n,h,r.formatterService,void 0,e)}}]),t}(pw("AI_EXTRACT",2,0,1,Nd,[{type:Nd|Zd},{type:Nd|Zd}])),gX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ps(e.workbook,e.ref),n=e.workbook.aiManager;if(!r||!n)return it.RUNTIME_ERR_VAR;for(var a=r.id(),o=[],i="",u=0;u<t.length;u++){var s=t[u];if(Ba(s)&&(s=xc(s)||Rl(this.name,u+1,El(s),wl(s),it.FormulaErrorPhrases.DATA_TYPE_STRING)),ZK(s))return PK();if(ja(s.at(0,0)))return s.at(0,0);0===u?o.push(FK(s,e)):1===u&&(i=FK(s,e))}var c=o.join(",");if($K(c)||$K(i))return GK(this.name);var h=(0,l.Z)({user_input:{user_input:c,target_language:i},action_type:"sheet_translate",sheet_id:a,funcName:this.name},Ce.nbU,WK(r.getVar(e.ref.startRow,e.ref.startCol)));return e.info.cacheKeys||(e.info.cacheKeys=[]),e.info.cacheKeys.push(dK(h)),bK(n,h,r.formatterService,void 0,e)}}]),t}(pw("AI_TRANSLATE",2,0,1,Nd,[{type:Nd|Zd},{type:Nd|Zd}])),yX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ps(e.workbook,e.ref),n=e.workbook.aiManager;if(!r||!n)return it.RUNTIME_ERR_VAR;for(var a=r.id(),o=[],i=0;i<t.length;i++){var u=t[i];if(Ba(u)&&(u=xc(u)||Rl(this.name,i+1,El(u),wl(u),it.FormulaErrorPhrases.DATA_TYPE_STRING)),ZK(u))return PK();if(ja(u.at(0,0)))return u.at(0,0);o.push(FK(u,e))}var s=o.join(",");if($K(s))return GK(this.name);var c=(0,l.Z)({user_input:{user_input:s},action_type:"sheet_infer_sentiment",sheet_id:a,funcName:this.name},Ce.nbU,WK(r.getVar(e.ref.startRow,e.ref.startCol)));return e.info.cacheKeys||(e.info.cacheKeys=[]),e.info.cacheKeys.push(dK(c)),bK(n,c,r.formatterService,void 0,e)}}]),t}(pw("AI_SENTIMENT",1,0,1,Nd,[{type:Nd|Zd}])),_X=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ps(e.workbook,e.ref),n=e.workbook.aiManager;if(!r||!n)return it.RUNTIME_ERR_VAR;for(var a=r.id(),o=[],i=0;i<t.length;i++){var u=t[i];if(Ba(u)&&(u=xc(u)||Rl(this.name,i+1,El(u),wl(u),it.FormulaErrorPhrases.DATA_TYPE_STRING)),ZK(u))return PK();if(ja(u.at(0,0)))return u.at(0,0);o.push(FK(u,e))}var s=o.join(",");if($K(s))return GK(this.name);var c=(0,l.Z)({user_input:{user_input:s},action_type:"sheet_summary",sheet_id:a,funcName:this.name},Ce.nbU,WK(r.getVar(e.ref.startRow,e.ref.startCol)));return e.info.cacheKeys||(e.info.cacheKeys=[]),e.info.cacheKeys.push(dK(c)),bK(n,c,r.formatterService,void 0,e)}}]),t}(pw("AI_SUMMARY",1,0,1,Nd,[{type:Nd|Zd}])),RX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=Ps(e.workbook,e.ref),n=e.workbook.aiManager;if(!r||!n)return it.RUNTIME_ERR_VAR;for(var a=r.id(),o=[],i=0;i<t.length;i++){var u=t[i];if(Ba(u)&&(u=xc(u)||Rl(this.name,i+1,El(u),wl(u),it.FormulaErrorPhrases.DATA_TYPE_STRING)),ZK(u))return PK();if(ja(u.at(0,0)))return u.at(0,0);o.push(FK(u,e))}var s=o.join(",");if($K(s))return GK(this.name);var c=(0,l.Z)({user_input:{user_input:s},action_type:"sheet_polish",sheet_id:a,funcName:this.name},Ce.nbU,WK(r.getVar(e.ref.startRow,e.ref.startCol)));return e.info.cacheKeys||(e.info.cacheKeys=[]),e.info.cacheKeys.push(dK(c)),bK(n,c,r.formatterService,void 0,e)}}]),t}(pw("AI_POLISH",1,0,1,Nd,[{type:Nd|Zd}])),CX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258,259],e.$$calcCustomData=function(){return{autoFormat:"yyyy/mm/dd HH:mm"}},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<0)return zs(this.name,1);var n=t[1]&&za(t[1])?Math.floor(t[1].getValue()):1;if(n<1||n>3)return Gs(this.name,2,n,1,3);var a=1e3/Math.pow(10,3*(n-1));return new it.NumberVar(25569+r*a/864e5)}}]),t}(pw("EPOCHTODATE",1,1,0,Vd,[{type:Vd},{type:Vd,default:new it.NumberVar(1)}]));function wX(e,t,r,n,a,o){var i=EX(t,n);if(isNaN(i))return Wl;if(i<-o||o-1<i)return Gs(e,1,i,-o,o-1);if("number"==typeof(r=r&&Math.floor(r))&&(r<=0||r>10))return Gs(e,2,r,1,10);var u=function(e,t,r){return e<0&&(e+=Math.pow(t,10)),r||(r=0),e.toString(t).padStart(r,"0").toUpperCase()}(i,a,r);return 0<=i&&r&&r<u.length?it.tractorErrorVarCreators[it.ErrorCode.INSUFFICIENT_PLACES]({funcName:e,curPlaces:r,requiredPlaces:u.length}):new it.StringVar(u)}function EX(e,t){var r=Math.pow(t,10),n=parseInt(e,t);return r/2<=n?n-r:n}function kX(e,t){var r={strVal:""},n=t.getValue();return n.slice(0,2).toLowerCase()===_Z&&(n=n.slice(2)),n.length>10?(r.error=Hs(e,1,n.length,10),r):SZ(n)?(r.strVal=n,r):(r.error=ol(e,n,it.FormulaErrorPhrases.HEXADECIMAL),r)}function TX(e,t){var r={strVal:""},n=t.getValue();return n.length>10?(r.error=Hs(e,1,n.length,10),r):n?function(e){return/^([0-7])+$/.test(e)}(n)?(r.strVal=n,r):(r.error=ol(e,n,it.FormulaErrorPhrases.OCTAL),r):(r.error=bl(e,1),r)}var SX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[260,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=kX(this.name,t[0]);if(r.error)return r.error;var n=r.strVal,a=t[1]?t[1].getValue():null;return wX(this.name,n,a,16,2,512)}}]),t}(pw("HEX2BIN",1,1,0,Vd,[{type:Nd},{type:Vd|Od,default:it.NULL_VAR}])),AX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[260,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=kX(this.name,t[0]);if(r.error)return r.error;var n=r.strVal,a=t[1]?t[1].getValue():null;return wX(this.name,n,a,16,8,536870912)}}]),t}(pw("HEX2OCT",1,1,0,Vd,[{type:Nd},{type:Vd|Od,default:it.NULL_VAR}])),IX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[260,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=TX(this.name,t[0]);if(r.error)return r.error;var n=t[1]?t[1].getValue():null;return wX(this.name,r.strVal,n,8,2,512)}}]),t}(pw("OCT2BIN",1,1,0,Vd,[{type:Nd},{type:Vd|Od,default:it.NULL_VAR}])),OX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=TX(this.name,t[0]);if(r.error)return r.error;var n=EX(r.strVal,8);return new it.NumberVar(n)}}]),t}(pw("OCT2DEC",1,0,0,Vd,[{type:Nd}])),VX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[260,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=TX(this.name,t[0]);if(r.error)return r.error;var n=t[1]?t[1].getValue():null;return wX(this.name,r.strVal,n,8,16,549755813888)}}]),t}(pw("OCT2HEX",1,1,0,Vd,[{type:Nd},{type:Vd|Od,default:it.NULL_VAR}]));new it.NumberVar(0);var NX=it.BOOLEAN_VAR_MAP[it.BooleanConstant.TRUE],bX=it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE];NX.setSpecialInfo=function(){},bX.setSpecialInfo=function(){},it.NULL_VAR.setSpecialInfo=function(){};var MX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=ro(r)?r.getRef():null,a=n?Ps(e.workbook,n):null,o=r.rowCount(),i=r.colCount();if(o<1||i<1)return bX;for(var u=0;u<o;++u)for(var s=0;s<i;++s){var l=r.at(u,s);if(ja(l))return l;if(Wa(l)){if(!UU(e,l.getValue()))return bX}else{if(!za(l))return bX;var c,h;if(a&&n){var f=a.getActualFormatter(n.startRow+u,n.startCol+s,e);return f&&(0,Ee.isDateTimeFormatter)(f)?NX:bX}var d=null===(h=l.getSpecialInfo())||void 0===h||null===(c=h.customData)||void 0===c?void 0:c.autoFormat;if(!d)return bX;var v=e.workbook.formatterService.getFormatter(d);if(!(0,Ee.isDateTimeFormatter)(v))return bX}}return NX}}]),t}(pw("ISDATE",1,0,0,bd,[{type:Nd|Zd}])),FX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=RegExp("^(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:".concat(Ce.HjE,")$"),"i"),n=t[0].getValue(),a=!(254<n.length)&&r.test(n);return new it.BooleanVar(a)}}]),t}(pw("ISEMAIL",1,0,0,bd,[{type:Nd}])),ZX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue().replace(/^\s+|\s+$/g,""),n=r.length,a=!1,o=new RegExp("^(?:"+"(?:".concat(Ce.TfY,")://+[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?")+"|[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:".concat(Ce.HjE,")(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|mailto:(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:").concat(Ce.HjE,")|(?:news|aim):[%a-z0-9$_\\.+!*(),;/?#:@&~=-]+)$"),"i");return n<1e3&&(a=o.test(r)),new it.BooleanVar(a)}}]),t}(pw("ISURL",1,0,0,bd,[{type:Nd}])),xX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(qa(r))return zl;if(za(r))r=r.toStringVar();else if(!Wa(r))return Rl(this.name,1,El(r),wl(r),it.FormulaErrorPhrases.DATA_TYPE_STRING);if(this.checkArgs){t[0]=r;var n=this.checkArgs(t);if(n)return n}var a,o=r.getValue().replace(/\s/g,"");if(!YZ(o))return zl;try{a=XZ(o)}catch(e){return zl}var i=this.calcComplex(a,t.slice(1));if(i instanceof it.BaseVar)return i;if(isNaN(i.re))return Wl;if(i.re===1/0)return Ys;if(i.re===-1/0)return qs;var u=KZ(i,o.endsWith(WZ.j)?WZ.j:WZ.i);return new it.StringVar(u)}}]),t}(pw("",1,0,0,Nd,[{type:Nd|bd}])),DX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMSQRT",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcComplex",value:function(e){return e.sqrt()}}]),t}(xX),PX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMCOSH",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcComplex",value:function(e){return e.cosh()}}]),t}(xX),$X=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMCOT",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"checkArgs",value:function(e){var t=e[0].getValue();if("0"===t||"0+0i"===t)return Hl(this.name)}},{key:"calcComplex",value:function(e){return e.cot()}}]),t}(xX),LX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMCOTH",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"checkArgs",value:function(e){var t=e[0].getValue();if("0"===t||"0+0i"===t)return Hl(this.name)}},{key:"calcComplex",value:function(e){return e.coth()}}]),t}(xX),BX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMCSC",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcComplex",value:function(e){return e.csc()}}]),t}(xX),UX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMCSCH",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcComplex",value:function(e){return e.csch()}}]),t}(xX),HX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMLOG",e.operands=2,e.resultType=Nd,e.paramsDesc=[{type:Nd|bd},{type:Vd}],e.$$minOperands=2,e.$$maxOperands=2,e.$$paramsDesc=[399,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"checkArgs",value:function(e){var t=e[0].getValue(),r=e[1].getValue();return"0"===t||"0+0i"===t?Hl(this.name):r<=0?Js(this.name,r,2,0):void 0}},{key:"calcComplex",value:function(e,t){var r=t[0].getValue();return e.log().div(Math.log(r))}}]),t}(xX),zX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMREAL",e.resultType=Vd,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcComplex",value:function(e){return new it.NumberVar(e.re)}}]),t}(xX),WX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMSEC",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcComplex",value:function(e){return e.sec()}}]),t}(xX),GX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMSECH",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcComplex",value:function(e){return e.sech()}}]),t}(xX),jX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMSIN",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcComplex",value:function(e){return e.sin()}}]),t}(xX),YX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMSINH",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcComplex",value:function(e){return e.sinh()}}]),t}(xX),qX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMTAN",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcComplex",value:function(e){return e.tan()}}]),t}(xX),JX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="IMTANH",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcComplex",value:function(e){return e.tanh()}}]),t}(xX),KX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=this,n=[],a=function(a){var o=t[a].forEach((function(t){if(ja(t))return t;if(Ga(t))return fl(r.name,a+1,t.toStringVar().getValue());if(za(t))n.push(t.getValue());else if(Wa(t)){var o=t.toNumberVar(e.service);if(qa(o))return hl(r.name,1,t.getValue());n.push(o.getValue())}}));if(o)return{v:o}},o=0;o<t.length;++o){var i=a(o);if("object"===(0,R.Z)(i))return i.v}for(var u=1,s=0,l=0,c=n;l<c.length;l++){var h=c[l];if(s+=h=Math.trunc(h),h<0)return Pl(this.name,h);if(s>1029)return Ys;u*=zZ(s,h)}return new it.NumberVar(u)}}]),t}(pw("MULTINOMIAL",1,255,1,Vd,[{type:Ud},{type:Ud}])),XX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ISO.CEILING",e}return(0,p.Z)(t,e),t}(BZ),QX=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].at(0,0);if(ja(r))return r;var n=Zc(e.service,r);if(!n)return Rl(this.name,1,El(r),wl(r),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var a=n.getValue();if(a<=0)return Js(this.name,a||0,1,0);if(a>=3163)return il;for(var o=[],i=0;i<a;++i){for(var u=[],s=0;s<a;++s){var l=i===s?1:0;u.push(new it.NumberVar(l))}o.push(u)}return new gs(o)}}]),t}(pw("MUNIT",1,0,0,Zd,[{type:Vd|Zd}]));QX=Vu([Cp("MUNIT")],QX);var eQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[258,258,258,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=t[0].getValue(),n=t[1].getValue(),a=t[2].getValue(),o=t[3],i=0,u=o.rowCount(),s=o.colCount(),l=0;l<u;++l)for(var c=0;c<s;++c){var h=o.at(l,c);if(za(h)){var f=l*s+c;i+=(h.getValue()||0)*Math.pow(r,n+a*f)}else{if(ja(h))return h;if(Wa(h))return hl(this.name,4,h.getValue());if(Ga(h))return fl(this.name,4,h.toStringVar().getValue());if(!qa(h))return Rl(this.name,4,El(h),wl(h),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE)}}return new it.NumberVar(i)}}]),t}(pw("SERIESSUM",4,0,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Ud}])),tQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0,n=0;n<t.length;++n){var a=t[n];Ba(a)&&(a=Zc(e.service,a)||Rl(this.name,n+1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));var o=a.forEach((function(e){if(za(e)||Ga(e))r+=Math.pow(Number(e.getValue()),2);else if(ja(e))return e}));if(o)return o}return new it.NumberVar(r)}}]),t}(pw("SUMSQ",1,255,1,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),rQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[48],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=new Set,n=0;n<t.length;++n)t[n].forEach((function(e){if(!qa(e)){var t=e.getValue();""!==t&&r.add(t)}}));return new it.NumberVar(r.size)}}]),t}(pw("COUNTUNIQUE",1,255,1,Vd,[{type:Ud},{type:Ud}]));function nQ(e,t,r,n){var a=Math.floor(r.getValue()),o=Math.floor(n.getValue());if(a<0||o<0)return it.VALUE_ERR_VAR;if(!a||!o){var i=a?[o,2]:[a,1],u=(0,g.Z)(i,2),s=u[0],l=u[1];return Qs(t,s,l,1)}var c=Ps(e.workbook,e.ref);if(!c)return it.REF_ERR_VAR;var h=c.getColumnCount(),f=c.getRowCount(),d=e.ref.startRow+a-f,v=e.ref.startCol+o-h;return d>0||v>0?function(e){var t=e.needMoreRows,r=void 0===t?0:t,n=e.needMoreCols,a=void 0===n?0:n;return Ce.d$b[Ce.O6N.REF_RANDARRAY_ERROR_EXPAND]({needMoreRows:r,needMoreCols:a})}({needMoreRows:d,needMoreCols:v}):a*o>1e6?il:{rowsValInt:a,colsValInt:o}}var aQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).alwaysCalc=!0,e.$$minOperands=0,e.$$maxOperands=5,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[259,259,259,259,265],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0]&&za(t[0])?t[0]:new it.NumberVar(1),n=t[1]&&za(t[1])?t[1]:new it.NumberVar(1),a=nQ(e,this.name,r,n);if(a instanceof it.ErrorVar)return a;var o=t[2]&&za(t[2])?t[2].getValue():0,i=t[3]&&za(t[3])?t[3].getValue():1,u=!(!t[4]||!Ga(t[4]))&&t[4].getValue();if(o>i)return it.VALUE_ERR_VAR;if(o>i)return it.VALUE_ERR_VAR;if(u&&(!Number.isInteger(o)||!Number.isInteger(i)))return it.VALUE_ERR_VAR;for(var s=a.rowsValInt,l=a.colsValInt,c=[],h=0;h<s;h++){for(var f=[],d=0;d<l;d++){var v=void 0;o===i&&(v=o);var p=i-o;v=u?p<1?o:o+Math.floor((p+1)*Math.random()):o+p*Math.random(),f.push(new it.NumberVar(v))}c[h]=f}return new gs(c)}}]),t}(pw("RANDARRAY",0,5,0,Zd,[{type:Vd,default:new it.NumberVar(1)},{type:Vd,default:new it.NumberVar(1)},{type:Vd,default:new it.NumberVar(0)},{type:Vd,default:new it.NumberVar(1)},{type:bd,default:new it.BooleanVar(!1)}]));aQ=Vu([Cp("RANDARRAY")],aQ);var oQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=4,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[258,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1]&&za(t[1])?t[1]:new it.NumberVar(1),a=nQ(e,this.name,r,n);if(a instanceof it.ErrorVar)return a;for(var o=a.rowsValInt,i=a.colsValInt,u=t[3]&&za(t[3])?t[3].getValue():1,s=t[2]&&za(t[2])?t[2].getValue():1,l=[],c=0;c<o;c++){for(var h=[],f=0;f<i;f++)h.push(new it.NumberVar(s)),s+=u;l[c]=h}return new gs(l)}}]),t}(pw("SEQUENCE",1,3,0,Zd,[{type:Vd},{type:Vd,default:new it.NumberVar(1)},{type:Vd,default:new it.NumberVar(1)},{type:Vd,default:new it.NumberVar(1)}]));oQ=Vu([Cp("SEQUENCE")],oQ);var iQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$calcCustomData=function(){return{autoFormat:"yyyy-mm-dd"}},e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(qa(r))return r.toNumberVar();if(!za(r))return r;var n=r.getValue(),a=new Date(1900,0,1),o=n<0?2:1,i=new Date(a.getTime()+24*(Math.trunc(n)-o)*60*60*1e3),u=we.SheetDate.fromLocalDate(i).toNumber();return function(e){return"Invalid Date"===e.toString()}(i)||isNaN(u)||u<we.SheetDate.MIN_DATE_VALUE||u>we.SheetDate.MAX_DATE_VALUE?r:new it.NumberVar(u)}}]),t}(pw("TO_DATE",1,0,0,Vd|Nd,[{type:Vd|Nd|bd}])),uQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n,a,o=t[0].at(0,0);if(ja(o))return o;if(Ga(o)||qa(o))return o.toStringVar();if(io(o))return new it.StringVar("");if(ro(t[0])){var i=t[0].size();if(1!==t[0].size())return it.tractorErrorVarCreators[it.ErrorCode.ARGUMENTS_COUNT_SHOULD_BE_EXACTLY]({funcName:this.name,requiredOperandCount:1,argCount:i});var u=t[0].getRef(),s=Ps(e.workbook,u);s&&(a=s.getActualFormatter(u.startRow,u.startCol))}if(a){var l=e.workbook.formatterService,c=(null==l?void 0:l.getFormattedText(a,o.getValue()))||"";return new it.StringVar(c)}var h=null===(n=o.getSpecialInfo())||void 0===n||null===(r=n.customData)||void 0===r?void 0:r.autoFormat;if(h){var f=e.workbook.formatterService,d=null==f?void 0:f.getFormatter(h);if(d&&f)return new it.StringVar((null==f?void 0:f.getFormattedText(d,o.getValue()))||"")}return new it.StringVar(o.getValue().toString())}}]),t}(pw("TO_TEXT",1,0,0,Vd,[{type:Zd|Vd|Nd|bd}])),sQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(qa(r))return r.toNumberVar();if(!za(r))return r;var n=r.getValue();return new it.NumberVar(n)}}]),t}(pw("TO_PURE_NUMBER",1,0,0,Vd,[{type:Vd|Nd|bd}])),lQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(qa(r))return r.toNumberVar();if(!za(r))return r;Yy(e);var n=r.getValue();return new it.NumberVar(n)}}]),t}(pw("TO_DOLLARS",1,0,0,Vd,[{type:Vd|Nd|bd}])),cQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$calcCustomData=function(){return{autoFormat:"0%"}},e.$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[399],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(qa(r))return r.toNumberVar();if(!za(r))return r;var n=r.getValue();return new it.NumberVar(n)}}]),t}(pw("TO_PERCENT",1,0,0,Vd,[{type:Vd|Nd|bd}])),hQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="ADD",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return(0,it.addOpImpl)(t[0],t[1])}}]),t}(uW),fQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="DIVIDE",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return(0,it.divideOpImpl)(t[0],t[1])}}]),t}(uW),dQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="GT",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;r++)2176===t[r].$$type&&(t[r]=it.NULL_VAR);return new it.BooleanVar((0,it.greaterThan)(e,t[0],t[1]))}},{key:"arrayFunc",value:function(e,t){return 1===t[0].size()&&t[1].size()>=1?EU(e,t[0].at(0,0),t[1],4):t[0].size()>=1&&1===t[1].size()?EU(e,t[1].at(0,0),t[0],2):void 0}}]),t}(sW);it.GreaterThanOp.prototype.arrayFunc=dQ.prototype.arrayFunc;var vQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="GTE",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;r++)2176===t[r].$$type&&(t[r]=it.NULL_VAR);return new it.BooleanVar((0,it.greaterThanEquals)(e,t[0],t[1]))}},{key:"arrayFunc",value:function(e,t){return 1===t[0].size()&&t[1].size()>=1?EU(e,t[0].at(0,0),t[1],5):t[0].size()>=1&&1===t[1].size()?EU(e,t[1].at(0,0),t[0],3):void 0}}]),t}(sW);it.GreaterThanEqualsOp.prototype.arrayFunc=vQ.prototype.arrayFunc;var pQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=5,e.$$lazy=!1,e.$$paramsDesc=[399,399,399,265,265],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=qa(t[0])?0:t[0].getValue(),n=qa(t[1])?0:t[1].getValue(),a=qa(t[2])?0:t[2].getValue(),o=!t[3]||!Ga(t[3])||t[3].getValue(),i=!t[4]||!Ga(t[4])||t[4].getValue();return n>a?yl(this.name,n,2,3,a):new it.BooleanVar((o?r>=n:r>n)&&(i?r<=a:r<a))}}]),t}(pw("ISBETWEEN",3,2,0,bd,[{type:Fd},{type:Fd},{type:Fd},{type:bd,default:it.BOOLEAN_VAR_MAP[it.BooleanConstant.TRUE]},{type:bd,default:it.BOOLEAN_VAR_MAP[it.BooleanConstant.TRUE]}])),mQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LT",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;r++)2176===t[r].$$type&&(t[r]=it.NULL_VAR);return new it.BooleanVar((0,it.lessThan)(e,t[0],t[1]))}},{key:"arrayFunc",value:function(e,t){return 1===t[0].size()&&t[1].size()>=1?EU(e,t[0].at(0,0),t[1],2):t[0].size()>=1&&1===t[1].size()?EU(e,t[1].at(0,0),t[0],4):void 0}}]),t}(sW);it.LessThanOp.prototype.arrayFunc=mQ.prototype.arrayFunc;var gQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="LTE",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;r++)2176===t[r].$$type&&(t[r]=it.NULL_VAR);return new it.BooleanVar((0,it.lessThanEquals)(e,t[0],t[1]))}},{key:"arrayFunc",value:function(e,t){return 1===t[0].size()&&t[1].size()>=1?EU(e,t[0].at(0,0),t[1],3):t[0].size()>=1&&1===t[1].size()?EU(e,t[1].at(0,0),t[0],5):void 0}}]),t}(sW);it.LessThanEqualsOp.prototype.arrayFunc=gQ.prototype.arrayFunc;var yQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MINUS",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return(0,it.subOpImpl)(t[0],t[1])}}]),t}(uW),_Q=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MULTIPLY",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return(0,it.multiplyOpImpl)(t[0],t[1])}},{key:"arrayFunc",value:function(e,t){return hW(t[0],t[1],MD)}}]),t}(uW);it.MultiplyOp.prototype.arrayFunc=_Q.prototype.arrayFunc;var RQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="NE",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0;r<t.length;r++)2176===t[r].$$type&&(t[r]=it.NULL_VAR);return new it.BooleanVar((0,it.notEquals)(e,t[0],t[1]))}},{key:"arrayFunc",value:function(e,t){return 1===t[0].size()&&t[1].size()>=1?CQ(e,t[0].at(0,0),t[1]):t[0].size()>=1&&1===t[1].size()?CQ(e,t[1].at(0,0),t[0]):void 0}}]),t}(sW);function CQ(e,t,r){if(!ja(t)&&r.hash()){var n=mU(e,r),a=new LD,o=n.info,i=n.diff;if(t.isNull())for(var u=0,s=o.values.length;u<s;u++)!1!==o.values[u].val.getValue()&&0!==o.values[u].val.getValue()&&""!==o.values[u].val.getValue()&&yU(a,o.values[u].idx,i);else{for(var l=ZD(o.values,t),c=0;c<o.values.length;c++)c!==l&&yU(a,o.values[c].idx,i);t.isNumber()&&0===t.getValue()||""===t.getValue()||!1===t.getValue()||yU(a,o.nullIdx,i)}return new VD(a,RU(n),r.rowCount(),r.colCount())}}it.NotEqualsOp.prototype.arrayFunc=RQ.prototype.arrayFunc;var wQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="POW",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return(0,it.power)(t[0],t[1])}}]),t}(uW),EQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e.$$calcCustomData=XF,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(-r)}}]),t}(pw("UMINUS",1,0,0,Vd,[{type:Vd}])),kQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();return new it.NumberVar(r/100)}}]),t}(pw("UNARY_PERCENT",1,0,0,Vd,[{type:Vd}])),TQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e.$$calcCustomData=XF,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return t[0]}}]),t}(pw("UPLUS",1,0,0,Vd,[{type:Vd}]));function SQ(e,t,r){0===r.length&&r.push({index:0,ascending:!0});for(var n=0,a=0;a<r.length;a++){var o=r[a],i=o.index,u=o.ascending;if(0!==(n=WU(e[i],t[i],u)))break}return n}var AQ,IQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(2===t.length?t.push(new it.NumberVar(1)):qa(t[1])&&(t[2]=new it.NumberVar(1)),t.length%2!=1)return Zl(this.name,2);for(var r=t[0],n=r.rowCount(),a=r.colCount(),o=ro(r)?r.getRef():null,i=[[]],u=[],s=[],l=!1,c=!1,h=1;h<t.length;h+=2){var f=t[h+1],d=void 0;if(qa(f))d=1;else{if(1!==f.size())return Rl(this.name,h+2,El(f),wl(f),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var v=f.at(0,0);if(!Ba(v))return Rl(this.name,h+2,El(v),wl(v),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);Wa(v)&&(v=Zc(e.service,v)||v),d=v.getValue()}if(1!==d&&-1!==d)return al(this.name,null!==d?d.toString():"",h+2,"1, -1");var p=t[h];if(1===p.size())return l||c||1!==a&&1!==n?Tl(this.name,h+1,n,1,1,1):r;var m=p.colCount(),g=p.rowCount();if(0===u.length&&(l=1===m,c=1===g),c){if(1!==g||m!==a)return Tl(this.name,h+1,1,a,g,m)}else if(1!==m||g!==n)return Tl(this.name,h+1,n,1,g,m);s.push(p),u.push({index:l?s.length+a-1:s.length-1,ascending:1===d})}for(var y=0;y<n;y++){i[y]||(i[y]=[]);for(var _=0;_<a;_++){var R=r.at(y,_);null!==o&&(R=Rp(e.workbook,R,o,y,_)),i[y][_]=R}if(l)for(var C=0;C<s.length;C++)i[y][a+C]=s[C].at(y,0)}if(!(0,Ce.n5s)()){var w=e.formula;return(0,Ce.QFC)().finally((function(){e.service.emit("afterWaitAsyncCalc",w,4)})),e.service.addCalculatingAsyncFormula(w),it.WAIT_ASYNC_ERR_VAR}return function(e,t,r,n,a){var o=[[]];if(a)o=t.sort((function(e,t){return SQ(e,t,r)})),n.length>0&&(o=t.map((function(e){return e.slice(0,e.length-n.length)})));else{var i=Array.from({length:t[0].length},(function(e,t){return t}));i=i.sort((function(e,t){return function(e,t,r,n,a){for(var o=0,i=0;i<a.length;i++){var u=a[i],s=u.index,l=u.ascending;if(0!==(o=WU(n[s].at(0,e),n[s].at(0,t),l)))break}return o}(e,t,0,n,r)}));for(var u=0;u<t.length;u++){o[u]||(o[u]=[]);for(var s=0;s<i.length;s++){var l=i[s];o[u][s]=t[u][l]}}}var c,h=new gs(o);return e.info&&(e.info.customData=null===(c=h.at(0,0).getSpecialInfo())||void 0===c?void 0:c.customData),h}(e,i,u,s,l)}}]),t}(pw("SORTBY",2,255,2,Pd|Zd,[{type:Zd},{type:Zd},{type:Vd|Zd,default:new it.NumberVar(1)},{type:Zd},{type:Od|Vd|Zd}]));IQ=Vu([Cp("SORTBY")],IQ),function(e){e[e.TopN=0]="TopN",e[e.TopNDup=1]="TopNDup",e[e.TopNDistinct=2]="TopNDistinct",e[e.TopNWithRep=3]="TopNWithRep"}(AQ||(AQ={}));var OQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[32,33,33,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){if(t.length>3&&t.length%2==0)return Zl(this.name,3);var r=t[0],n=1;if(t[1]){var a=t[1];if(1!==a.size())return Rl(this.name,2,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var o=a.at(0,0);if(ja(o))return o;if(o!==ho){var i=Zc(e.service,o);if(!i)return Rl(this.name,2,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);n=Math.trunc(i.getValue())}if(n<1)return Qs(this.name,n,2,1)}var u=0;if(t[2]&&1===t[2].size()){var s=t[2].at(0,0),l=Zc(e.service,s);if(l)u=Math.trunc(l.getValue());else{if(!Wa(s)||""!==s.getValue())return Rl(this.name,3,El(s),wl(s),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);u=0}if(u<0||u>3)return Gs(this.name,3,u,0,3)}for(var c=r.rowCount(),h=r.colCount(),f=Xa(r)?r.getRef():null,d=[],v=[],p=[],m=3;m<t.length;m+=2){var g=t[m+1];if(1!==g.size())return Yl(this.name);if(ja(g=g.at(0,0)))return g;if(ja(g=Dc(g)||Rl(this.name,m+2,El(g),wl(g),it.FormulaErrorPhrases.DATA_TYPE_BOOLEAN)))return g;var y=g.getValue(),_=t[m];if(Ba(_)){if(ja(_=Zc(e.service,_)||Rl(this.name,m+1,El(_),wl(_),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE)))return _;var C=Math.trunc(_.getValue())-1;(C<0||C>=h)&&(C=-1),v.push({index:C,ascending:y})}else{var w=_.colCount(),E=_.rowCount();if(1!==w||E!==c)return Tl(this.name,m+1,c,1,E,w);var k=Xa(_)&&_.getRef();if(k&&f&&Yo(f,k)){var T=f.startCol,S=k.startCol;v.push({index:S-T,ascending:y})}else p.push(_),v.push({index:p.length+h-1,ascending:y})}}for(var A=0;A<c;A++){var I=[];d.push(I);for(var O=0;O<h;O++){var V=r.at(A,O);f&&(V=Rp(e.workbook,V,f,A,O)),I.push(V)}for(var N=0;N<p.length;N++)I.push(p[N].at(A,0))}if(!(0,Ce.n5s)()){var b=e.formula;return(0,Ce.QFC)().finally((function(){e.service.emit("afterWaitAsyncCalc",b,4)})),e.service.addCalculatingAsyncFormula(b),it.WAIT_ASYNC_ERR_VAR}return function(e,t,r,n,a,o){var i;switch(i=0===a.length?t.sort((function(e,t){return SQ(e,t,a)})):0===(a=a.filter((function(e){return e.index>=0}))).length?t:t.sort((function(e,t){return SQ(e,t,a)})),n){case 0:i=function(e,t){return e.splice(0,t)}(t,r);break;case 1:i=function(e,t,r){for(var n=e[t-1],a=t;a<e.length;a++)if(!VQ(e[a],n,r))return e.slice(0,a);return e}(t,r,a);break;case 2:i=function(e,t,r){for(var n=[],a=function(a){var o=e[a];if(0!==a&&n.some((function(e){return VQ(o,e,r)}))||n.push(o),n.length===t)return{v:n}},o=0;o<e.length;o++){var i=a(o);if("object"===(0,R.Z)(i))return i.v}return n}(t,r,a);break;case 3:i=function(e,t,r){for(var n=[],a=0,o=function(o){var i=e[o];if(0!==o&&n.some((function(e){return VQ(i,e,r)}))||a++,a>t)return{v:n};n.push(i)},i=0;i<e.length;i++){var u=o(i);if("object"===(0,R.Z)(u))return u.v}return n}(t,r,a)}o>0&&(i=i.map((function(e){return e.slice(0,e.length-o)})));var u,s=new gs(i);return e.info&&(e.info.customData=null===(u=s.getVarByPos(0,0).getSpecialInfo())||void 0===u?void 0:u.customData),s}(e,d,n,u,v,p.length)}}]),t}(pw("SORTN",1,255,2,Pd|Zd,[{type:Zd},{type:Vd|Zd,default:new it.NumberVar(1)},{type:Vd|Zd,default:new it.NumberVar(0)},{type:Vd|Zd},{type:bd|Zd}]));function VQ(e,t,r){for(var n=0;n<r.length;n++){var a=r[n].index;if(e[a].getValue()!==t[a].getValue())return!1}return!0}OQ=Vu([Cp("SORTN")],OQ);var NQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=r.rowCount(),a=r.colCount();if(n!==a)return tc(this.name,a,n);for(var o=[],i=0;i<n;i++){var u=[];o.push(u);for(var s=0;s<a;s++){var l=r.at(i,s);if(ja(l))return l;if(!za(l))return Wa(l)?hl(this.name,1,l.getValue()):Ga(l)?fl(this.name,1,l.toStringVar().getValue()):qa(l)?dl(this.name,1,""):Rl(this.name,1,El(l),wl(l),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);u.push(l.getValue())}}return new it.NumberVar(function(e){var t=zL(e),r=t.rowSwap,n=t.smallPivotDetected,a=t.luMatrix,o=t.permutation;if(n)return 0;for(var i=o.length,u=r?1:-1,s=0;s<i;s++)u*=a[s][s];return u}(o))}}]),t}(pw("MDETERM",1,0,0,Vd,[{type:Zd}])),bQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=r.rowCount(),a=r.colCount();if(n!==a)return tc(this.name,a,n);for(var o=[],i=0;i<n;i++){var u=[];o.push(u);for(var s=0;s<a;s++){var l=r.at(i,s);if(!za(l))return ja(l)?l:Wa(l)?hl(this.name,1,l.getValue()):Ga(l)?fl(this.name,1,l.toStringVar().getValue()):qa(l)?dl(this.name,1,""):hl(this.name,1,l.getValue());u.push(l.getValue())}}var c=HL(o);if(!c)return Ce.d$b[Ce.O6N.MATRIX_WAS_NOT_INVERTIBLE]({funcName:this.name});var h=c.map((function(e){return e.map((function(e){return new it.NumberVar(e)}))}));return new gs(h)}}]),t}(pw("MINVERSE",1,0,0,Zd,[{type:Zd}]));function MQ(e,t,r,n,a,o){Ba(a)&&(a=Zc(e.service,a)||Rl(t,1,El(a),wl(a),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE)),Ba(o)&&(o=Zc(e.service,o)||Rl(t,2,El(o),wl(o),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE));var i=a.size();if(i!==o.size())return Ce.d$b[Ce.O6N.NA_ARRAY_SIZES_NOT_EQUAL]({funcName:t});for(var u=n?-1:1,s=a.colCount(),l=o.colCount(),c=0,h=0;h<i;++h){var f=a.at(h/s|0,h%s);if(ja(f))return f;var d=o.at(h/l|0,h%l);if(ja(d))return d;if(za(f)&&za(d)){var v=f.getValue(),p=d.getValue();c+=r?(v-p)*(v-p):v*v+u*p*p}}return new it.NumberVar(c)}bQ=Vu([Cp("MINVERSE")],bQ);var FQ,ZQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[33,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return MQ(e,this.name,!1,!0,t[0],t[1])}}]),t}(pw("SUMX2MY2",2,0,0,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),xQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[33,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return MQ(e,this.name,!1,!1,t[0],t[1])}}]),t}(pw("SUMX2PY2",2,0,0,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),DQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[33,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return MQ(e,this.name,!0,!1,t[0],t[1])}}]),t}(pw("SUMXMY2",2,0,0,Vd,[{type:Vd|Zd},{type:Vd|Zd}])),PQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[48],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=[],n=0;n<t.length;++n)t[n].forEach((function(e){r.push([e])}));return new gs(r)}}]),t}(pw("FLATTEN",1,255,1,Vd,[{type:Ud},{type:Ud}]));PQ=Vu([Cp("FLATTEN")],PQ),function(e){e[e.keepAll=0]="keepAll",e[e.ignoreBlank=1]="ignoreBlank",e[e.ignoreErrors=2]="ignoreErrors",e[e.ignoreBlankErrors=3]="ignoreBlankErrors"}(FQ||(FQ={}));var $Q=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[49,258,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1]?Math.trunc(t[1].getValue()):0;if(n<0||n>3)return al(this.name,n.toString(),2,"0, 1, 2, 3");var a=!!t[2]&&t[2].getValue(),o=[];if(Ba(r))LQ(n,r)||o.push(r);else for(var i=a?r.colCount():r.rowCount(),u=a?r.rowCount():r.colCount(),s=0;s<i;s++)for(var l=0;l<u;l++){var c=a?l:s,h=a?s:l,f=r.at(c,h);LQ(n,f)||o.push(f)}return 0===o.length?Bl:"TOROW"===this.name?new gs([o]):new gs(o.map((function(e){return[e]})))}}]),t}(pw("",1,2,0,Zd,[{type:Fd|Zd},{type:Vd,default:new it.NumberVar(0)},{type:bd,default:it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE]}]));function LQ(e,t){switch(e){case FQ.ignoreBlank:return t.isNull();case FQ.ignoreErrors:return t.isError();case FQ.ignoreBlankErrors:return t.isNull()||t.isError();default:return!1}}var BQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TOCOL",e}return(0,p.Z)(t,e),t}($Q);BQ=Vu([Cp("TOCOL")],BQ);var UQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="TOROW",e}return(0,p.Z)(t,e),t}($Q);UQ=Vu([Cp("TOROW")],UQ);var HQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[49,32],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=t[0],n="CHOOSEROWS"===this.name?r.rowCount():r.colCount(),a=-1*n,o=[],i=1;i<t.length;i++)if(Ja(t[i]))for(var u=t[i].rowCount(),s=t[i].colCount(),l=0;l<u;l++)for(var c=0;c<s;c++){var h=t[i].at(l,c);if(!za(h))return ja(h)?h:Rl(this.name,i+1,El(h),wl(h),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var f=Math.trunc(h.getValue());if(0===f)return rc(this.name,i+1);if(f<a||f>n)return Gs(this.name,i+1,f,a,n);o.push(f>0?f-1:f+n)}else{var d=t[i].at(0,0),v=Zc(e.service,d);if(!v)return Rl(this.name,i+1,El(d),wl(d),it.FormulaErrorPhrases.DATA_TYPE_DOUBLE);var p=Math.trunc(v.getValue());if(0===p)return rc(this.name,i+1);if(p<a||p>n)return Gs(this.name,i+1,p,a,n);o.push(p>0?p-1:p+n)}return this.calcChoose(e,r,o)}}]),t}(pw("",2,255,1,Zd,[{type:Fd|Zd},{type:Vd},{type:Vd}])),zQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CHOOSECOLS",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcChoose",value:function(e,t,r){if(Ba(t))return new gs([Array.from({length:r.length},(function(){return t}))]);for(var n=t.rowCount(),a=Array.from({length:n},(function(){return[]})),o=0;o<r.length;++o)for(var i=r[o],u=0;u<n;++u)a[u].push(t.at(u,i));return new gs(a)}}]),t}(HQ);zQ=Vu([Cp("CHOOSECOLS")],zQ);var WQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="CHOOSEROWS",e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcChoose",value:function(e,t,r){if(Ba(t))return new gs((0,m.Z)(Array.from({length:r.length},(function(){return[t]}))));for(var n=t.colCount(),a=[],o=0;o<r.length;o++){var i=r[o],u=[];a.push(u);for(var s=0;s<n;s++)u.push(t.at(i,s))}return new gs(a)}}]),t}(HQ);WQ=Vu([Cp("CHOOSEROWS")],WQ);var GQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[49],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0,n=0;n<t.length;++n)r=Math.max(r,t[n].colCount());for(var a=[],o=0;o<t.length;o++)for(var i=t[o],u=i.rowCount(),s=i.colCount(),l=0;l<u;++l){var c=[];a.push(c);for(var h=0;h<r;++h)h<s?c.push(Ba(i)?i:i.at(l,h)):c.push(nc(this.name,it.ErrorConstant.NA))}return new gs(a)}}]),t}(pw("VSTACK",1,255,1,Zd,[{type:Fd|Zd},{type:Fd|Zd}]));GQ=Vu([Cp("VSTACK")],GQ);var jQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[48],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){for(var r=0,n=0;n<t.length;++n)r=Math.max(r,t[n].rowCount());for(var a=[],o=0;o<t.length;o++)for(var i=t[o],u=i.rowCount(),s=i.colCount(),l=0;l<r;l++){a[l]||(a[l]=[]);for(var c=0;c<s;c++)a[l].push(l<u?i.at(l,c):nc(this.name,it.ErrorConstant.NA))}return new gs(a)}}]),t}(pw("HSTACK",1,255,1,Zd,[{type:Fd|Zd},{type:Fd|Zd}]));jQ=Vu([Cp("HSTACK")],jQ);var YQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).paramsDesc=[{type:Fd|Zd},{type:Vd},{type:Fd,default:ac("pad_with",it.ErrorConstant.NA)}],e.$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[49,258,415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(1!==r.rowCount()&&1!==r.colCount())return Jl(this.name);var n=Math.trunc(t[1].getValue());if(n<1)return Qs(this.name,n,2,1);var a=t[2]&&!qa(t[2])?t[2]:ac("pad_with",it.ErrorConstant.NA);if(Ba(r)){var o=Array.from({length:n},(function(){return[a]}));return o[0][0]=r,new gs(o)}for(var i=[],u=r.size(),s=r.colCount(),l=Math.ceil(u/n),c=0;c<n;c++){var h=[];i.push(h);for(var f=0;f<l;f++){var d=f*n+c,v=d<u?r.at(d/s|0,d%s):a;h.push(v)}}return new gs(i)}}]),t}(pw("WRAPCOLS",2,1,0,Zd,[]));YQ=Vu([Cp("WRAPCOLS")],YQ);var qQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).paramsDesc=[{type:Fd|Zd},{type:Vd},{type:Fd,default:ac("pad_with",it.ErrorConstant.NA)}],e.$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[49,258,415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(1!==r.rowCount()&&1!==r.colCount())return Jl(this.name);var n=Math.trunc(t[1].getValue());if(n<1)return Qs(this.name,n,2,1);var a=t[2]&&!qa(t[2])?t[2]:ac("pad_with",it.ErrorConstant.NA);if(Ba(r)){var o=Array.from({length:n},(function(){return a}));return o[0]=r,new gs([o])}for(var i=[],u=r.size(),s=r.colCount(),l=Math.ceil(u/n),c=0,h=0;h<l;h++){var f=[];i.push(f);for(var d=0;d<n;d++){var v=c<u?r.at(c/s|0,c%s):a;f.push(v),c++}}return new gs(i)}}]),t}(pw("WRAPROWS",2,1,0,Zd,[]));qQ=Vu([Cp("WRAPROWS")],qQ);var JQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).optionOperands=0,e.repeatedLastParam=0,e.resultType=it.VAR_TYPE.ATOM,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[t.length-1];if(Ja(r)&&1===r.size()&&(r=r.at(0,0)),!ao(r))return ul;var n=r.getParams();return n.length!==t.length-1?function(e,t,r){return it.tractorErrorVarCreators[it.ErrorCode.ARGUMENTS_COUNT_SHOULD_BE_EXACTLY]({funcName:e,argCount:t,requiredOperandCount:r})}("LAMBDA",n.length+1,t.length):this.calcLambda(e,r,t.slice(0,-1),n)}}]),t}(it.FuncOpBase),KQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BYROW",e.operands=2,e.paramsDesc=[{type:Fd|Zd},{type:Hd}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[255,255],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcLambda",value:function(e,t,r,n){return Zs(r,(function(e){var r=n[0].index,a=t.expression;a.scope=a.scope||[];var o=e[0];if(!Ja(o))return a.scope[r]=o,a;for(var i=[],u=o.rowCount(),s=0;s<u;++s){var l=a.clone();l.scope[r]=Id(o,s,1),i.push(l)}return new ks([],i,{next:function(e,t){for(var r=[],n=0;n<u;++n){var a=t[n];if(Ba(a))r.push([a]);else if(1===a.rowCount()){for(var o=[],i=0,s=a.colCount();i<s;++i)o.push(a.at(0,i));r.push(o)}else r.push([ll])}return new gs(r)}})}))}}]),t}(JQ);KQ=Vu([Cp("BYROW")],KQ);var XQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BYCOL",e.operands=2,e.paramsDesc=[{type:Fd|Zd},{type:Hd}],e.$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[255,255],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcLambda",value:function(e,t,r,n){return Zs(r,(function(e){var r=n[0].index,a=t.expression;a.scope=a.scope||[];var o=e[0];if(!Ja(o))return a.scope[r]=o,a;for(var i=[],u=o.colCount(),s=0;s<u;++s){var l=a.clone();l.scope[r]=Ad(o,s,1),i.push(l)}return new ks([],i,{next:function(e,t){for(var r=[[]],n=0;n<u;++n){var a=t[n];if(Ba(a))r[0].push(a);else if(1===a.colCount())for(var o=0,i=a.rowCount();o<i;++o){var s=r[o];s||r.push(s=[]),s[n]=a.at(o,0)}else r[0].push(sl)}return new gs(r)}})}))}}]),t}(JQ);XQ=Vu([Cp("BYCOL")],XQ);var QQ=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MAKEARRAY",e.operands=3,e.paramsDesc=[{type:Vd},{type:Vd},{type:Hd}],e.$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[258,258,255],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcLambda",value:function(e,t,r,n){var a=r[0],o=Math.trunc(a.getValue());if(o<1)return Qs(this.name,o,1,1);var i=r[1],u=Math.trunc(i.getValue());return u<1?Qs(this.name,u,2,1):new e0(t,o,u,n).next([],[])}}]),t}(JQ);QQ=Vu([Cp("MAKEARRAY")],QQ);var e0=function(){function e(t,r,n,a){(0,y.Z)(this,e),this.lambda=t,this.rowCount=r,this.colCount=n,this.row=-1,this.col=-1,this.results=[],this.params=a}return(0,_.Z)(e,[{key:"next",value:function(e,t){var r=t[0];if(this.row>=0){var n=this.results[this.row],a=this.col;Ba(r)?n[a]=r:1===r.size()?n[a]=r.at(0,0):1===this.colCount&&1!==r.colCount()?n[a]=ll:1===this.rowCount&&1!==r.rowCount()?n[a]=sl:n[a]=cl}if(this.col=(this.col+1)%this.colCount,0===this.col){if(++this.row>=this.rowCount)return new gs(this.results);this.results.push([])}var o=this.lambda.expression;return o.scope=o.scope||[],o.scope[this.params[0].index]=new it.NumberVar(this.row+1),o.scope[this.params[1].index]=new it.NumberVar(this.col+1),new ks([],[o],this)}}]),e}(),t0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="MAP",e.operands=1,e.optionOperands=252,e.repeatedLastParam=1,e.paramsDesc=[{type:Fd|Zd},{type:Fd|Zd},{type:Hd}],e.$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[255],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcLambda",value:function(e,t,r,n){var a=this;return Zs(r,(function(e){for(var r=e[0],o=r.rowCount(),i=r.colCount(),u=1;u<e.length;++u){var s=e[u];if(o!==s.rowCount()||i!==s.colCount())return Il(a.name)}var l=t.expression;l.scope=l.scope||[];var c=r.size();if(1===c){for(var h=0;h<e.length;++h)l.scope[n[h].index]=e[h];return l}return c<1?Il(a.name):new r0(l,e,n).next([],[])}))}},{key:"repeatedParam",get:function(){return[uk.Head,1]}}]),t}(JQ);t0=Vu([Cp("MAP")],t0);var r0=function(){function e(t,r,n){(0,y.Z)(this,e),this.expr=t,this.args=r,this.params=n,this.row=-1,this.results=[]}return(0,_.Z)(e,[{key:"next",value:function(e,t){var r=this.args[0],n=r.rowCount(),a=r.colCount();if(this.row>=0){var o=[];this.results.push(o);for(var i=0;i<a;++i){var u=t[i];Ba(u)?o.push(u):1===u.size()?o.push(u.at(0,0)):1===a&&1!==u.colCount()?o.push(ll):1===n&&1!==u.rowCount()?o.push(sl):o.push(cl)}}var s=++this.row;if(s>=n)return new gs(this.results);for(var l=this.args,c=this.expr,h=this.params,f=[],d=0;d<a;++d){for(var v=c.clone(),p=0;p<l.length;++p){var m=l[p];if(ro(m)){var g=m.getRef().clone();g.startRow+=s,g.startCol+=d,g.endRow=g.startRow+1,g.endCol=g.startCol+1,v.scope[h[p].index]=new Fs(g)}else v.scope[h[p].index]=m.at(s,d)}f.push(v)}return new ks([],f,this)}}]),e}(),n0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="REDUCE",e.operands=3,e.paramsDesc=[{type:Fd|Zd},{type:Fd|Zd},{type:Hd}],e.$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[255,255,255],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcLambda",value:function(e,t,r,n){var a=r[0],o=$s(e.workbook,r[1]),i=t.expression;return i.scope=i.scope||[],1===o.size()?(i.scope[n[0].index]=a,i.scope[n[1].index]=o,i):new i0(i,n,o).next([],[a])}}]),t}(JQ);n0=Vu([Cp("REDUCE")],n0);var a0,o0,i0=function(){function e(t,r,n){(0,y.Z)(this,e),this.expr=t,this.params=r,this.array=n,this.row=-1,this.col=-1}return(0,_.Z)(e,[{key:"next",value:function(e,t){var r=t[0];if(this.col=(this.col+1)%this.array.colCount(),0===this.col&&++this.row>=this.array.rowCount())return r;var n=this.expr,a=this.params;if(n.scope[a[0].index]=r,ro(this.array)){var o=this.array.getRef().clone();o.startRow+=this.row,o.startCol+=this.col,o.endRow=o.startRow+1,o.endCol=o.startCol+1,n.scope[a[1].index]=new Fs(o)}else n.scope[a[1].index]=this.array.at(this.row,this.col);return new ks([],[n],this)}}]),e}(),u0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="SCAN",e.operands=3,e.optionOperands=0,e.repeatedLastParam=0,e.paramsDesc=[{type:Fd|Zd},{type:Fd|Zd},{type:Hd}],e.$$minOperands=3,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[255,255,255],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"calcLambda",value:function(e,t,r,n){var a=r[0],o=$s(e.workbook,r[1]),i=t.expression;return i.scope=i.scope||[],1===o.size()?(i.scope[n[0].index]=a,i.scope[n[1].index]=o,i):o.size()<1?it.NA_ERR_VAR:new s0(i,n,o).next([],[a])}}]),t}(JQ);u0=Vu([Cp("SCAN")],u0);var s0=function(){function e(t,r,n){(0,y.Z)(this,e),this.expr=t,this.params=r,this.array=n,this.row=-1,this.col=-1,this.results=[]}return(0,_.Z)(e,[{key:"next",value:function(e,t){var r=t[0];if(this.row>=0){var n=this.results[this.row],a=this.col;Ba(r)?n[a]=r:1===r.size()?n[a]=r.at(0,0):1===this.array.colCount()&&1!==r.colCount()?n[a]=ll:1===this.array.rowCount()&&1!==r.rowCount()?n[a]=sl:n[a]=cl}if(this.col=(this.col+1)%this.array.colCount(),0===this.col){if(++this.row>=this.array.rowCount())return new gs(this.results);this.results.push([])}var o=this.expr,i=this.params;if(o.scope[i[0].index]=r,ro(this.array)){var u=this.array.getRef().clone();u.startRow+=this.row,u.startCol+=this.col,u.endRow=u.startRow+1,u.endCol=u.startCol+1,o.scope[i[1].index]=new Fs(u)}else o.scope[i[1].index]=this.array.at(this.row,this.col);return new ks([],[o],this)}}]),e}();function l0(e,t,r,n,a,o,i,u,s){var l=we.SheetDate.fromNumber(e),c=we.SheetDate.fromNumber(t),h=we.SheetDate.fromNumber(n),f=we.SheetDate.fromNumber(r),d=d0(e),v=d0(t),p=d0(n),m=d0(r),g=I$(f,l,s),y=I$(l,h,s),_=I$(f,h,s),R=IL({settlement:l,maturity:c,frequency:u,basis:s}),C=gL(l,c,u).count,w=100*a/u,E=1+o/u;if(y>R){var k=I$(h,c,s),T=new Date(p.getFullYear(),p.getMonth(),p.getDate());switch(s){case 0:case 4:C=1+parseInt(Math.ceil(k/R).toString(),10);break;default:for(C=0;C<32767;C++){var S=we.SheetDate.fromUTCDate(T);if(T.setMonth(T.getMonth()+12/u),T>=v){C+=parseInt((Math.ceil(I$(S,c,s))/IL({settlement:S,maturity:we.SheetDate.fromUTCDate(T),frequency:u,basis:s})).toString(),10)+1;break}}g=R*h0(m,d,p,u,s),y=R*h0(d,p,p,u,s),_=R*h0(m,p,p,u,s)}}return i/Math.pow(E,C-1+y/R)+w*(_/R/Math.pow(E,y/R)+(1===E?1:Math.pow(E,-y/R)*(Math.pow(E,-C)-1/E)/(1/E-1))-g/R)}function c0(e,t,r,n){var a=t.getFullYear(),o=t.getMonth(),i=t.getDate(),u=new Date(1,0,1),s=0,l=i===(0,we.getDaysOfMonth)(a,o),c=12/r,h=a-e.getFullYear();u.setFullYear(1),h>0&&(h=(h-1)*r);do{h++,(u=new Date(a,o,i)).setMonth(o-h*c),l&&(s=(0,we.getDaysOfMonth)(u.getFullYear(),u.getMonth()),u=new Date(u.getFullYear(),u.getMonth(),s))}while(e<u);return n&&(h--,(u=new Date(a,o,i)).setMonth(o-h*c),l&&(s=(0,we.getDaysOfMonth)(u.getFullYear(),u.getMonth()),u=new Date(u.getFullYear(),u.getMonth(),s))),u}function h0(e,t,r,n,a){var o=c0(e,r,n,!0),i=c0(e,r,n,!1);if(o>=t)return I$(we.SheetDate.fromUTCDate(e),we.SheetDate.fromUTCDate(t),a)/IL({settlement:we.SheetDate.fromUTCDate(i),maturity:we.SheetDate.fromUTCDate(o),frequency:n,basis:a});for(var u=I$(we.SheetDate.fromUTCDate(e),we.SheetDate.fromUTCDate(o),a)/IL({settlement:we.SheetDate.fromUTCDate(i),maturity:we.SheetDate.fromUTCDate(o),frequency:n,basis:a});;){if(i=new Date(o.getFullYear(),o.getMonth(),o.getDate()),o.setMonth(o.getMonth()+12/n),o>=t)return u+I$(we.SheetDate.fromUTCDate(i),we.SheetDate.fromUTCDate(t),a)/IL({settlement:we.SheetDate.fromUTCDate(i),maturity:we.SheetDate.fromUTCDate(o),frequency:n,basis:a});u+=1}}function f0(e,t,r,n,a,o,i,u,s){for(var l=d0(t),c=d0(r),h=d0(n),f=new Date(h.getFullYear(),h.getMonth(),h.getDate());f<c;)f=new Date(f.getFullYear(),f.getMonth()+12/u,f.getDate());var d=h0(h,l,f,u,s),v=h0(h,c,f,u,s),p=h0(l,c,f,u,s);return e?(i*u+100*a*(v-d*(1+o*p/u)))/(o*p+u):(u*(i-o)+100*a*(v-d))/(p*o+100*a*d*p/u)}function d0(e){var t=we.SheetDate.fromNumber(e).time,r=t.year,n=t.month,a=t.date;return new Date(r,n-1,a)}function v0(e,t,r,n){var a=m0(t[0],t[1],t[4],t[6],t[7],t[8],r,!0);if(a instanceof it.ErrorVar)return a;var o=a.s,i=a.m,u=a.r,s=a.redem,l=a.freq,c=a.b,h=Ps(e.workbook,e.ref);if(!h)return it.VALUE_ERR_VAR;var f=t[2].getValue();if(f<=0)return Js(r,f,3,0);if(f>=o)return rl(r,h,f,3,o,1);var d=t[3].getValue();if(d<=0)return Js(r,d,4,0);if(o>=d)return rl(r,h,o,1,d,4);if(d>=i)return rl(r,h,d,4,i,2);var v=t[5].getValue();return n?v<0?Qs(r,v,6,0):l0(o,i,f,d,u,v,s,l,c):v<=0?Js(r,v,6,0):function(e,t,r,n,a,o,i,u,s){function l(o){return l0(e,t,r,n,a,o,i,u,s)}for(var c=0,h=a||.01,f=l(h),d=f-o;100>=c&&1e-7<Math.abs(d);c++)f=l(1.01*h),d=(f=l(h=-d/(f-o-d)*h*.01+h))-o;return h}(o,i,f,d,u,v,s,l,c)}function p0(e,t,r,n){var a=m0(t[0],t[1],t[3],t[5],t[6],t[7],r,!1);if(a instanceof it.ErrorVar)return a;var o=a.s,i=a.m,u=a.r,s=a.redem,l=a.freq,c=a.b,h=Ps(e.workbook,e.ref);if(!h)return it.VALUE_ERR_VAR;if(o>=i)return ml(r,w$(o),w$(i));var f=t[2].getValue();if(f<=0)return Js(r,f,3,0);if(f>=o)return rl(r,h,f,3,o,1);var d=t[4].getValue();return n?d<0?Qs(r,d,5,0):f0(!0,o,i,f,u,d,s,l,c):d<=0?Js(r,d,5,0):f0(!1,o,i,f,u,d,s,l,c)}function m0(e,t,r,n,a,o,i,u){var s=e.getValue();if(s<=0)return Js(i,s,1,0);var l=t.getValue();if(l<=0)return Js(i,l,2,0);var c=r.getValue();if(c<0)return Qs(i,c,u?5:4,0);var h=n.getValue();if(h<=0)return Js(i,h,u?7:6,0);var f=Math.floor(a.getValue());if(!RL(f))return wL(i,a.getValue(),u?8:7);var d=o?Math.floor(o.getValue()):0;return CL(d)?{s:s,m:l,r:c,redem:h,freq:f,b:d}:EL(i,o.getValue(),u?9:8)}var g0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=7,e.$$maxOperands=8,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=p0(e,t,this.name,!0);return r instanceof it.ErrorVar?r:new it.NumberVar(r)}}]),t}(pw("ODDLPRICE",7,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(0)}])),y0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=7,e.$$maxOperands=8,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=p0(e,t,this.name,!1);return r instanceof it.ErrorVar?r:new it.NumberVar(r)}}]),t}(pw("ODDLYIELD",7,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(0)}])),_0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=8,e.$$maxOperands=9,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=v0(e,t,this.name,!0);return r instanceof it.ErrorVar?r:new it.NumberVar(r)}}]),t}(pw("ODDFPRICE",8,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(0)}])),R0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=8,e.$$maxOperands=9,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=v0(e,t,this.name,!1);return r instanceof it.ErrorVar?r:new it.NumberVar(r)}}]),t}(pw("ODDFYIELD",8,1,0,Vd,[{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd},{type:Vd,default:new it.NumberVar(0)}])),C0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[33,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=t[1]?Math.floor(t[1].getValue()):0;if(0!==n&&1!==n)return al(this.name,n.toString(),2,"0, 1");if(ja(r))return r;if(Ba(r)){var a=xc(r).getValue();return new it.StringVar(0===n?a:"{".concat(a,"}"))}for(var o=r.rowCount(),i=r.colCount(),u=[],s=0;s<o;++s)for(var l=0;l<i;++l){var c=r.at(s,l);Wa(c)?u.push(1===n?'"'.concat(c.getValue(),'"'):c.getValue()):ja(c)?u.push(c.desc):u.push(c.toStringVar().getValue())}if(0===n)return new it.StringVar(u.join(", "));for(var h=r.colCount(),f=0;f<u.length-1;f++)u[f]+=(f+1)%h==0?";":",";return new it.StringVar("{".concat(u.join(""),"}"))}}]),t}(pw("ARRAYTOTEXT",1,1,0,Nd,[{type:Fd|Zd},{type:Vd,default:new it.NumberVar(0)}])),w0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0].getValue(),a=Math.floor(Math.abs(n)),o=parseFloat((Math.abs(n)-a).toFixed(2));return r=0===a?0!==o?(n<0?"":"")+E0(100*o)+"":"":0===o?(n<0?"":"")+E0(a)+"":(n<0?"":"")+E0(a)+""+E0(100*o)+"",new it.StringVar(r)}}]),t}(pw("BAHTTEXT",1,0,0,Nd,[{type:Vd}]));function E0(e){for(var t=["","","","","","",""],r=["","","","","","","","","",""],n=["","","","","","",","," ",""],a=0,o=0,i="",u="",s=e.toString(),l=s.length,c=l;0<c;--c){if(i=r[a=parseInt(s[l-c],10)],1==(o=1<c?(c-1)%6:6)&&2===a&&(i=n[4]),1===a)switch(o){case 0:case 6:u+=c<l?n[5]:i;break;case 1:break;default:u+=i}else{if(0===a){0===o&&(u+=t[o]);continue}u+=i}u+=t[o]}return u}var k0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.StringVar(function(e){for(var t="",r=0;r<e.length;r++){var n=e[r],a=e.charCodeAt(r);if(a>=33&&a<=126)t+=String.fromCharCode(65535&(a+65248|0));else{var o=T0();if(Object.prototype.hasOwnProperty.call(o,n))t+=o[n];else{var i=S0();Object.prototype.hasOwnProperty.call(i,n)?t+=i[n]:t+=n}}}return t}(t[0].getValue()))}}]),t}(pw("DBCS",1,0,0,Nd,[{type:Nd|bd}]));function T0(){return a0||(a0={"":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}),a0}function S0(){return o0||(o0={"":"","`":"","'":"",'"':"","":"","":"","":"","":""," ":""}),o0}var A0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="JIS",e}return(0,p.Z)(t,e),t}(k0),I0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue().replace(/\s+/g,""),n=t[1]?t[1].getValue():".";if(!n)return Rl(this.name,2,"",it.FormulaErrorPhrases.DATA_TYPE_EMPTY,it.FormulaErrorPhrases.DATA_TYPE_STRING);n=n[0];var a=r.split(n),o=t[2]?t[2].getValue():null,i="",u=a[0].replace(/,/g,""),s=0;if(null!==o){if(""===o)return Rl(this.name,3,"",it.FormulaErrorPhrases.DATA_TYPE_EMPTY,it.FormulaErrorPhrases.DATA_TYPE_STRING);if(n===(o=o[0]))return sc(this.name,r);u=u.split(o).join("")}if(""===r.trim())return new it.NumberVar(0);if(null===r.match(/^\s*[+-]?\s*(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:[eE][+-]?\d+)?[ \t]*/))return sc(this.name,r);var l=u.length-1;if(a.length>2)return sc(this.name,r);if(1===a.length){for(","===n&&(u=u.replace(/\./g,""));"%"===u[l];)s++,l--;u=u.replace(new RegExp("%","g"),"")}else{if(l=(i=a[1]).length-1,isNaN(Number(u)))return sc(this.name,r);for(;"%"===i[l];)s++,l--;i=i.replace(new RegExp("%","g"),"")}var c=1===a.length?Number(u):Number("".concat(u,".").concat(i));if(isNaN(c))return sc(this.name,r);for(var h=0;h<s;h++)c/=100;return new it.NumberVar(c)}}]),t}(pw("NUMBERVALUE",1,2,0,Vd,[{type:Nd},{type:Nd},{type:Nd}])),O0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=6,e.$$lazy=!1,e.$$paramsDesc=[260,32,259,258,258,277],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return V0(e,this.name,t,!1)}}]),t}(pw("TEXTAFTER",2,4,0,Fd,[{type:Nd},{type:Nd|Zd},{type:Vd|Od,default:it.NULL_VAR},{type:Vd,default:new it.NumberVar(0)},{type:Vd,default:new it.NumberVar(0)},{type:Nd|Md,default:oc}]));function V0(e,t,r,n){var a=r[0],o=r[2]&&za(r[2]),i=o?Math.floor(r[2].getValue()):1;if(0===i)return rc(t,3);var u=[],s=r[1].forEach((function(t){if(ja(t))return t;if(Wa(t))u.push(t.getValue());else{var r=t.toStringVar(e.service).getValue();null!==r&&u.push(r)}}));if(s)return s;if(u.some((function(e){return 0===e.length})))return n?i>0?new it.StringVar(""):a:i>0?a:new it.StringVar("");var l=a.getValue();if(0===l.length&&0!==u.length&&o)return bl(t,1);if(o&&i>l.length)return _l(t,3,i,l.length);var c=Math.floor(r[3]?r[3].getValue():0);if(0!==c&&1!==c)return al(t,c.toString(),4,"0, 1");var h=Math.floor(r[4]?r[4].getValue():0);if(0!==h&&1!==h)return al(t,h.toString(),5,"0, 1");1===c&&(l=l.toLocaleLowerCase(),u=u.map((function(e){return e.toLocaleLowerCase()})));for(var f=r[5]&&!qa(r[5])?r[5]:oc,d=-1,v=-1,p=i>0?0:l.length-1,m=1;m<=Math.abs(i);m++){d=-1;for(var g=0;g<u.length;g++){var y=u[g],_=i>0?l.indexOf(y,p):l.lastIndexOf(y,p);if(-1!==_){d=_,v=g,p=i>0?_+1:_-1;break}}if(-1===d)return 1===h&&m===Math.abs(i)?n&&i>0||!n&&i<0?a:new it.StringVar(""):f}var R=n?l.substring(0,d):l.substring(d+u[v].length);return new it.StringVar(R)}var N0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=6,e.$$lazy=!1,e.$$paramsDesc=[260,32,259,258,258,277],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return V0(e,this.name,t,!0)}}]),t}(pw("TEXTBEFORE",2,4,0,Fd,[{type:Nd},{type:Nd|Zd},{type:Vd|Od,default:it.NULL_VAR},{type:Vd,default:new it.NumberVar(0)},{type:Vd,default:new it.NumberVar(0)},{type:Nd|Md,default:oc}])),b0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=6,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[260,32,33,264,258,415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(""===r)return bl(this.name,1);var n=t[4]?Math.floor(t[4].getValue()):0;if(1===n)r=r.toLowerCase();else if(0!==n)return al(this.name,n.toString(),5,"0, 1");var a=F0(e,t[1],2,this.name);if(a instanceof it.ErrorVar)return a;var o=[""];if(t[2])if(Ba(t[2]))o[0]=xc(t[2]).getValue();else if((o=F0(e,t[2],3,this.name))instanceof it.ErrorVar)return o;for(var i=!!t[3]&&t[3].getValue(),u=t[5]&&!qa(t[5])?t[5]:ic,s=[],l=0;l<o.length;l++)a.includes(o[l])||s.push(o[l]);if(1===n){for(var c=0;c<a.length;++c)a[c]=a[c].toLowerCase();for(var h=0;h<s.length;++h)s[h]=s[h].toLowerCase()}var f;f=0===s.length?[r]:M0(s,r,i);for(var d=[],v=1,p=0;p<f.length;p++){var m=M0(a,f[p],i).map((function(e){return new it.StringVar(e)}));v=m.length>v?m.length:v,0===m.length&&i||d.push(m)}return d.forEach((function(e){for(var t=v-e.length,r=0;r<t;r++)e.push(u)})),new gs(d)}}]),t}(pw("TEXTSPLIT",2,4,0,Zd,[{type:Nd},{type:Nd|Zd},{type:Nd|Zd,default:new it.StringVar("")},{type:bd,default:it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE]},{type:Vd,default:new it.NumberVar(0)},{type:Fd,default:ic}]));function M0(e,t,r){if(""===t||1===e.length&&""===e[0])return[t];for(var n=[],a=0,o=1;o<=t.length;o++)for(var i=t.slice(a,o),u=0;u<e.length;u++){var s=e[u];if(-1!==i.indexOf(s)){n.push(i.split(s)[0]),o===t.length&&n.push(i.split(s)[1]),a=o;break}if(u===e.length-1&&o===t.length){n.push(i);break}}return r?n.filter((function(e){return""!==e})):n}function F0(e,t,r,n){var a=[];return t.forEach((function(e){if(ja(e))return e;var t=xc(e).getValue();if(!t)return bl(n,r);a.push(t)}))||a}b0=Vu([Cp("TEXTSPLIT")],b0);var Z0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[415,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0],a=t[1]?Math.floor(t[1].getValue()):0;return 0!==a&&1!==a?al(this.name,a.toString(),2,"0, 1"):(r=ja(n)?n.desc:Wa(n)?1===a?'"'.concat(n.getValue(),'"'):n.getValue():n.toStringVar(e.service).getValue()||"",new it.StringVar(r))}}]),t}(pw("VALUETOTEXT",1,1,0,Nd,[{type:Fd},{type:Vd,default:new it.NumberVar(0)}]));function x0(e,t){for(var r=0,n=0;n<e.length;++n)r=t*r+e[n];return r}function D0(e,t,r,n,a){if(0===t)return r;if(1===t)return n;for(var o=2/e,i=n,u=1;u<t;++u)i=n*u*o+a*r,r=n,n=i;return i}function P0(e,t,r,n){return function(a,o){if(r){if(0===a)return 1===r?-1/0:1/0;if(a<0)return NaN}return 0===o?e(a):1===o?t(a):o<0?NaN:D0(a,o|=0,e(a),t(a),n)}}var $0=function(){var e=.636619772,t=[57568490574,-13362590354,651619640.7,-11214424.18,77392.33017,-184.9052456].reverse(),r=[57568490411,1029532985,9494680.718,59272.64853,267.8532712,1].reverse(),n=[1,-.001098628627,2734510407e-14,-2073370639e-15,2.093887211e-7].reverse(),a=[-.01562499995,.0001430488765,-6911147651e-15,7.621095161e-7,-9.34935152e-8].reverse();function o(o){var i=0,u=0,s=0,l=o*o;if(o<8)i=(u=x0(t,l))/(s=x0(r,l));else{var c=o-.785398164;u=x0(n,l=64/l),s=x0(a,l),i=Math.sqrt(e/o)*(Math.cos(c)*u-Math.sin(c)*s*8/o)}return i}var i=[72362614232,-7895059235,242396853.1,-2972611.439,15704.4826,-30.16036606].reverse(),u=[144725228442,2300535178,18583304.74,99447.43394,376.9991397,1].reverse(),s=[1,.00183105,-3516396496e-14,2457520174e-15,-2.40337019e-7].reverse(),l=[.04687499995,-.0002002690873,8449199096e-15,-8.8228987e-7,1.05787412e-7].reverse();function c(t){var r=0,n=0,a=0,o=t*t,c=Math.abs(t)-2.356194491;return Math.abs(t)<8?r=(n=t*x0(i,o))/(a=x0(u,o)):(n=x0(s,o=64/o),a=x0(l,o),r=Math.sqrt(e/Math.abs(t))*(Math.cos(c)*n-Math.sin(c)*a*8/Math.abs(t)),t<0&&(r=-r)),r}return function e(t,r){if(r=Math.round(r),!isFinite(t))return isNaN(t)?t:0;if(r<0)return(r%2?-1:1)*e(t,-r);if(t<0)return(r%2?-1:1)*e(-t,r);if(0===r)return o(t);if(1===r)return c(t);if(0===t)return 0;var n=0;if(t>r)n=D0(t,r,o(t),c(t),-1);else{for(var a=!1,i=0,u=0,s=1,l=0,h=2/t,f=2*Math.floor((r+Math.floor(Math.sqrt(40*r)))/2);f>0;f--)l=f*h*s-i,i=s,s=l,Math.abs(s)>1e10&&(s*=1e-10,i*=1e-10,n*=1e-10,u*=1e-10),a&&(u+=s),a=!a,f===r&&(n=i);n/=u=2*u-s}return n}}(),L0=function(){var e=.636619772,t=[-2957821389,7062834065,-512359803.6,10879881.29,-86327.92757,228.4622733].reverse(),r=[40076544269,745249964.8,7189466.438,47447.2647,226.1030244,1].reverse(),n=[1,-.001098628627,2734510407e-14,-2073370639e-15,2.093887211e-7].reverse(),a=[-.01562499995,.0001430488765,-6911147651e-15,7.621095161e-7,-9.34945152e-8].reverse();var o=[-4900604943e3,127527439e4,-51534381390,734926455.1,-4237922.726,8511.937935].reverse(),i=[249958057e5,424441966400,3733650367,22459040.02,102042.605,354.9632885,1].reverse(),u=[1,.00183105,-3516396496e-14,2457520174e-15,-2.40337019e-7].reverse(),s=[.04687499995,-.0002002690873,8449199096e-15,-8.8228987e-7,1.05787412e-7].reverse();return P0((function(o){var i=0,u=0,s=0,l=o*o,c=o-.785398164;return o<8?i=(u=x0(t,l))/(s=x0(r,l))+e*$0(o,0)*Math.log(o):(u=x0(n,l=64/l),s=x0(a,l),i=Math.sqrt(e/o)*(Math.sin(c)*u+Math.cos(c)*s*8/o)),i}),(function(t){var r=0,n=0,a=0,l=t*t,c=t-2.356194491;return t<8?r=(n=t*x0(o,l))/(a=x0(i,l))+e*($0(t,1)*Math.log(t)-1/t):(n=x0(u,l=64/l),a=x0(s,l),r=Math.sqrt(e/t)*(Math.sin(c)*n+Math.cos(c)*a*8/t)),r}),1,-1)}(),B0=function(){var e=[1,3.5156229,3.0899424,1.2067492,.2659732,.0360768,.0045813].reverse(),t=[.39894228,.01328592,.00225319,-.00157565,.00916281,-.02057706,.02635537,-.01647633,.00392377].reverse();function r(r){return r<=3.75?x0(e,r*r/14.0625):Math.exp(r)/Math.sqrt(r)*x0(t,3.75/r)}var n=[.5,.87890594,.51498869,.15084934,.02658733,.00301532,32411e-8].reverse(),a=[.39894228,-.03988024,-.00362018,.00163801,-.01031555,.02282967,-.02895312,.01787654,-.00420059].reverse();function o(e){return e<3.75?e*x0(n,e*e/14.0625):Math.exp(e)/Math.sqrt(e)*x0(a,3.75/e)}return function e(t,n){if(0===n)return r(Math.abs(t));if(1===n)return Math.sign(t)*o(Math.abs(t));if(0===Math.abs(t))return 0;if(t===1/0)return 1/0;var a,i=0,u=0,s=1,l=0,c=2/Math.abs(t);for(a=2*Math.round((n+Math.round(Math.sqrt(40*n)))/2);a>0;a--)l=a*c*s+u,u=s,s=l,Math.abs(s)>1e10&&(s*=1e-10,u*=1e-10,i*=1e-10),a===n&&(i=u);return i*=e(t,0)/s,t<0&&n%2?-i:i}}(),U0=function(){var e=[-.57721566,.4227842,.23069756,.0348859,.00262698,1075e-7,74e-7].reverse(),t=[1.25331414,-.07832358,.02189568,-.01062446,.00587872,-.0025154,53208e-8].reverse();var r=[1,.15443144,-.67278579,-.18156897,-.01919402,-.00110404,-4686e-8].reverse(),n=[1.25331414,.23498619,-.0365562,.01504268,-.00780353,.00325614,-68245e-8].reverse();return P0((function(r){return r<=2?-Math.log(r/2)*B0(r,0)+x0(e,r*r/4):Math.exp(-r)/Math.sqrt(r)*x0(t,2/r)}),(function(e){return e<=2?Math.log(e/2)*B0(e,1)+1/e*x0(r,e*e/4):Math.exp(-e)/Math.sqrt(e)*x0(n,2/e)}),2,1)}(),H0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();if(n<0)return Qs(this.name,n,2,0);n=Math.floor(n);var a=B0(r,n);return a===1/0||isNaN(a)?Ys:new it.NumberVar(a)}}]),t}(pw("BESSELI",2,0,0,Vd,[{type:Vd},{type:Vd}])),z0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=t[1].getValue();if(n<0)return Qs(this.name,n,2,0);if(n>1e7)return el(this.name,n,2,1e7);n=Math.floor(n);var a=$0(r,n);return new it.NumberVar(a)}}]),t}(pw("BESSELJ",2,0,0,Vd,[{type:Vd},{type:Vd}])),W0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<=0)return Js(this.name,r,1,0);var n=t[1].getValue();if(n<0)return Qs(this.name,n,2,0);n=Math.floor(n);var a=U0(r,n);return a===1/0||isNaN(a)?Ys:new it.NumberVar(a)}}]),t}(pw("BESSELK",2,0,0,Vd,[{type:Vd},{type:Vd}])),G0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(r<=0)return Js(this.name,r,1,0);var n=t[1].getValue();if(n<0)return Qs(this.name,n,2,0);n=Math.floor(n);var a=L0(r,n);return a===1/0||isNaN(a)?Ys:new it.NumberVar(a)}}]),t}(pw("BESSELY",2,0,0,Vd,[{type:Vd},{type:Vd}])),j0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).name="BETAINV",e}return(0,p.Z)(t,e),t}(mZ),Y0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).alwaysCalc=!0,e.$$minOperands=0,e.$$maxOperands=1,e.$$lazy=!1,e.$$cacheType=0,e.$$paramsDesc=[239],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0];if(!n||qa(n)){var a=Ps(e.workbook,e.ref);if(!a)return Vl(this.name,-1,"");r=e.workbook.getSheetIndex(a.name())}else if(Ba(n)){var o=Wa(n)?n:n.toStringVar();if(qa(o))return Rl(this.name,1,El(n),wl(n),it.FormulaErrorPhrases.DATA_TYPE_STRING);r=e.workbook.getSheetIndex(o.getValue())}else if(ro(n)){var i=Ps(e.workbook,n.getRef());if(!i)return Vl(this.name,1,"");r=e.workbook.getSheetIndexFromId(i.id())}return null==r?it.NA_ERR_VAR:new it.NumberVar(r+1)}}]),t}(pw("SHEET",0,1,0,Vd,[{type:Zd|Nd|Od,default:it.NULL_VAR}])),q0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).alwaysCalc=!0,e.$$minOperands=0,e.$$maxOperands=0,e.$$lazy=!1,e.$$paramsDesc=[],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e){return Ps(e.workbook,e.ref)?new it.NumberVar(e.workbook.sheets.length):Vl(this.name,-1,"")}}]),t}(pw("SHEETS",0,0,0,Vd,[])),J0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[255],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=!!e.parameterScope;return new it.BooleanVar(r&&qa(t[0]))}}]),t}(pw("ISOMITTED",1,0,0,bd,[{type:Ud}])),K0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[32,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n,a=t[0],o=Math.trunc(t[1].getValue()),i=t[2]?Math.trunc(t[2].getValue()):0,u=o>0?o:0,s=a.rowCount()-Math.abs(o);if(s<1)return js(this.name,2,o,-a.rowCount(),a.rowCount());if(0!==i&&(r=i>0?i:0,(n=a.colCount()-Math.abs(i))<1))return js(this.name,3,i,-a.colCount(),a.colCount());if(Ba(a))return a;var l=Id(a,u,s);return 0!==i&&(l=Ad(l,r,n)),l}}]),t}(pw("DROP",2,1,0,Zd,[{type:Zd},{type:Vd},{type:Vd,default:new it.NumberVar(0)}]));K0=Vu([Cp("DROP")],K0);var X0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$paramsDesc=[32,258,258],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=Math.trunc(t[1].getValue());if(0===n)return rc(this.name,2);if(t[2]&&0===(r=Math.trunc(t[2].getValue())))return rc(this.name,3);var a=t[0];if(Ba(a))return a;var o=n>0?0:a.rowCount()+n;if(a=Id(a,o,Math.abs(n)),t[2]){var i=r>0?0:a.colCount()+r;a=Ad(a,i,Math.abs(r))}return a}}]),t}(pw("TAKE",2,1,0,Zd,[{type:Zd},{type:Vd},{type:Vd}]));X0=Vu([Cp("TAKE")],X0);var Q0=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=4,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[32,258,259,415],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0],n=r.rowCount(),a=r.colCount(),o=Math.trunc(t[1].getValue()),i=t[2]&&za(t[2])?Math.trunc(t[2].getValue()):a;if(o<n)return Xs(this.name,o,2,n);if(i<a)return Xs(this.name,i,3,a);for(var u=t[3]||ic,s=[],l=0;l<o;l++){var c=[];s.push(c);for(var h=0;h<i;h++)c.push(l<n&&h<a?r.at(l,h):u)}return new gs(s)}}]),t}(pw("EXPAND",2,2,0,Zd,[{type:Zd},{type:Vd},{type:Vd|Od,default:it.NULL_VAR},{type:Fd,default:ic}]));Q0=Vu([Cp("EXPAND")],Q0);var e1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=4,e.$$lazy=!1,e.$$paramsDesc=[260,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(!e.workbook.importFormulaManager)return it.RUNTIME_ERR_VAR;var n=t[2]||it.NULL_VAR,a=t[3]||it.NULL_VAR,o=n&&za(n),i=a&&za(a),u=t[1]&&za(t[1])?Math.floor(t[1].getValue()):1,s=function(e,t,r){if(e<1)return Xs("IMAGE",e,2,1);if(e>4)return _l("IMAGE",2,e,4);var n=!t.isNull(),a=!r.isNull();if(4!==e&&(n||a))return Fl("IMAGE",n&&a?4:3,2);if(4===e){if(!n||!a)return Fl("IMAGE",n||a?3:2,4);var o=t.getValue(),i=r.getValue();if(o<=0)return Xs("IMAGE",o,3,1);if(i<=0)return Xs("IMAGE",i,4,1)}return null}(u,n,a);if(s)return s;var l=e.formula,c="IMAGE",h=e.workbook.importFormulaManager;if(h.hasBlackToken(l))return Ce.d$b[Ce.O6N.IMPORT_ERR_CAN_NOT_USE_BLACK_LIST_FUNCTION]();if(!(0,Ce.CBv)(r)||r.endsWith("webp"))return Ce.d$b[Ce.O6N.IMPORT_ERR_INVAILD_URL]({value:r});var f=JSON.stringify({link:r}),d=h.getImportFormulaId(c,f);h.setImportFormulaContent(l,f,d,r,c);var v=h.getFormulaDataById(d),p=function(t){var s=e.funcCache.image?e.funcCache.image:new Map;s||(s=e.funcCache.image=new Map);var l=s.get(t);return l||(l=new ds(new fs({width:100,height:100,link:r,fileToken:t,mode:u,customWidth:o?n.getValue():void 0,customHeight:i?a.getValue():void 0})),s.set(t,l)),l};if(v){if(v instanceof Ce.AXu){var m=Ce.d$b[v.code];return m?v.code===Ce.O6N.IMPORT_ERR_DATA_SIZE_OVER_LIMIT?m({num:2}):m():(0,Ce.NN_)(v.code,"")}if(v.fileToken)return p(v.fileToken)}return h.fetchFormulaDataById(d).then((function(e){if(e instanceof Ce.AXu){var t=Ce.d$b[e.code];return t?e.code===Ce.O6N.IMPORT_ERR_DATA_SIZE_OVER_LIMIT?t({num:2}):t():(0,Ce.NN_)(e.code,"")}if(!e.fileToken)throw e;return p(e.fileToken)})).catch((function(e){return e instanceof it.ErrorVar?e:(0,Ce.NN_)(Ce.O6N.REQUEST_FAIL,null==e?void 0:e.message)})).finally((function(){e.service.emit("afterWaitAsyncCalc",l,1)})),e.service.addCalculatingAsyncFormula(l),it.WAIT_ASYNC_ERR_VAR}}]),t}(pw("IMAGE",1,3,0,$d|Pd,[{type:Nd},{type:Vd,default:new it.NumberVar(1)},{type:Vd|Od,default:it.NULL_VAR},{type:Vd|Od,default:it.NULL_VAR}]));function t1(e,t,r,n,a,o){if(t.hasBlackToken(o))return Ce.d$b[Ce.O6N.IMPORT_ERR_CAN_NOT_USE_BLACK_LIST_FUNCTION]();if(!(0,Ce.CBv)(r))return Ce.d$b[Ce.O6N.IMPORT_ERR_INVAILD_URL]({value:r});var i=t.getImportFormulaId(n,a);t.setImportFormulaContent(o,a,i,r,n);var u=t.getFormulaDataById(i);if(u){if(u instanceof Ce.AXu){var s=Ce.d$b[u.code];return s?u.code===Ce.O6N.IMPORT_ERR_DATA_SIZE_OVER_LIMIT?s({num:10}):s():(0,Ce.NN_)(u.code,"")}if(u.table)return new gs(u.table)}return t.fetchFormulaDataById(i).then((function(e){if(e instanceof Ce.AXu){var t=Ce.d$b[e.code];return t?e.code===Ce.O6N.IMPORT_ERR_DATA_SIZE_OVER_LIMIT?t({num:10}):t():(0,Ce.NN_)(e.code,"")}if(!e.table)throw e;return new gs(e.table)})).catch((function(e){return e instanceof it.ErrorVar?e:(0,Ce.NN_)(Ce.O6N.REQUEST_FAIL,null==e?void 0:e.message)})).finally((function(){e.service.emit("afterWaitAsyncCalc",o,0)})),e.service.addCalculatingAsyncFormula(o),it.WAIT_ASYNC_ERR_VAR}var r1,n1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=3,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[260,260,261],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue(),n=e.workbook;if(!n||!n.importFormulaManager)return it.RUNTIME_ERR_VAR;var a=t[2]&&Wa(t[2])?t[2].getValue():n.locale,o=e.formula;return t1(e,n.importFormulaManager,r,"IMPORTXML",JSON.stringify({link:r,xpathQuery:t[1].getValue(),language:a}),o)}}]),t}(pw("IMPORTXML",2,1,0,Zd|Pd,[{type:Nd},{type:Nd},{type:Nd|Od,default:it.NULL_VAR}]));n1=Vu([Cp("IMPORTXML")],n1),function(e){e.table="table",e.list="list"}(r1||(r1={}));var a1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=4,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[260,260,258,261],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(!e.workbook.importFormulaManager)return it.RUNTIME_ERR_VAR;var n=t[1].getValue().toLowerCase();if("table"!==n&&"list"!==n)return al("IMPORTHTML",n,2,["table","list"]);var a=t[2].getValue();if(a<1)return Xs("IMPORTHTML",a,3,1);var o=t[3]&&Wa(t[3])?t[3].getValue():e.service.spread.locale,i=e.formula;return t1(e,e.workbook.importFormulaManager,r,"IMPORTHTML",JSON.stringify({link:r,query:n,index:Math.floor(a),language:o}),i)}}]),t}(pw("IMPORTHTML",3,1,0,Zd|Pd,[{type:Nd},{type:Nd},{type:Vd},{type:Nd|Od,default:it.NULL_VAR}]));a1=Vu([Cp("IMPORTHTML")],a1);var o1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=3,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[260,261],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0].getValue();if(!e.workbook.importFormulaManager)return it.RUNTIME_ERR_VAR;if(t[1]&&Wa(t[1])){if(1!==(r=t[1].getValue()).length&&"\\t"!==r||'"'===r||" "===r)return Ce.d$b[Ce.O6N.IMPORT_ERR_INVAILD_DELIMITER]({funcName:"IMPORTDATA",value:r})}else r=n.endsWith("tsv")?"\t":",";var a=t[2]&&Wa(t[2])?t[2].getValue():e.service.spread.locale,o=e.formula;return t1(e,e.workbook.importFormulaManager,n,"IMPORTDATA",JSON.stringify({link:n,delimiter:"\\t"===r?9:r.charCodeAt(0),language:a}),o)}}]),t}(pw("IMPORTDATA",1,2,0,Zd|Pd,[{type:Nd},{type:Nd|Od,default:it.NULL_VAR},{type:Nd|Od,default:it.NULL_VAR}]));o1=Vu([Cp("IMPORTDATA")],o1);var i1=["feed","feed title","feed description","feed author","feed url","items","items title","items author","items url","items created","items summary"],u1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=4,e.$$lazy=!1,e.$$expanded=!0,e.$$paramsDesc=[260,261,264,259],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0].getValue();if(!e.workbook.importFormulaManager)return it.RUNTIME_ERR_VAR;var n=t[1]&&Wa(t[1])&&t[1].getValue().trim().toLowerCase()||"items";if(-1===i1.indexOf(n))return al("IMPORTFEED",n,2,i1);var a=!!t[2]&&t[2].getValue(),o=t[3]&&za(t[3])?t[3].getValue():void 0;if("number"==typeof o&&(o>250||o<1))return gl("IMPORTFEED",4,o,1,250);var i=e.formula;return t1(e,e.workbook.importFormulaManager,r,"IMPORTFEED",JSON.stringify({link:r,query:n,needTitle:a,limit:o}),i)}}]),t}(pw("IMPORTFEED",1,3,0,Zd|Pd,[{type:Nd},{type:Nd,default:new it.StringVar("items")},{type:bd,default:it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE]},{type:Vd|Od,default:it.NULL_VAR}]));u1=Vu([Cp("IMPORTFEED")],u1);var s1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[264,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(t[0].getValue()&&t[1].getValue())}}]),t}(pw("PRIVATE_AND",2,0,0,bd,[{type:bd},{type:bd}])),l1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[264,264],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return new it.BooleanVar(t[0].getValue()||t[1].getValue())}}]),t}(pw("PRIVATE_OR",2,0,0,bd,[{type:bd},{type:bd}]));function c1(e,t,r,n,a){var o="".concat(r,"_").concat(e,"_").concat(function(e){for(var t=[],r=0;r<e.length;++r){var n=e[r];if(ro(n)){var a=n.hash();a&&t.push(a)}}return t.sort().join("_")}(n)),i=t.funcCache.condfmt,u=i.get(o);return(0,ye.default)(u)&&(u=a(),i.set(o,u)),u}var h1=function(e,t,r,n){var a=r[0],o=r[r.length-1];switch(e){case"num":return t;case"percent":var i=Number(t)/100;return Math.round(1e3*(a+(o-a)*i))/1e3;case"percentile":var u=Number(t)/100,s=r.length,l=0;if(1===s)l=r[0];else if(it.NumberVar.doubleEqual(u,1))l=r[s-1];else{var c=u*(s-1),h=Math.floor(c),f=c-h,d=r[h];l=d+f*(r[h+1]-d)}return Math.round(1e3*l)/1e3;case"auto":return n?Math.max(o,0):Math.min(0,a);default:return n?o:a}};function f1(e,t,r,n,a,o,i){var u=t.id(),s=0,l=0;if("num"===a&&"num"===i)return{min:l=o,max:s=n,values:[]};var c=c1("getMaxMinCache",e,u,r,(function(){for(var e=[],t=0;t<r.length;++t)r[t].forEach((function(t){za(t)&&e.push(t.getValue())}));return e.sort((function(e,t){return e-t}))})),h=c[0],f=c[c.length-1];switch(a){case"num":s=n;break;case"auto":s=Math.max(f,0);break;case"percent":var d=Number(n)/100;s=Math.round(1e3*(h+(f-h)*d))/1e3;break;case"percentile":var v=Number(n)/100,p=c.length,m=0;if(1===p)m=c[0];else if(it.NumberVar.doubleEqual(v,1))m=c[p-1];else{var g=v*(p-1),y=Math.floor(g),_=g-y,R=c[y];m=R+_*(c[y+1]-R)}s=Math.round(1e3*m)/1e3;break;default:s=f}switch(i){case"num":l=o;break;case"auto":l=Math.min(h,0);break;case"percent":var C=Number(o)/100;l=Math.round(1e3*(h+(f-h)*C))/1e3;break;case"percentile":var w=Number(o)/100,E=c.length,k=0;if(1===E)k=c[0];else if(it.NumberVar.doubleEqual(w,1))k=c[E-1];else{var T=w*(E-1),S=Math.floor(T),A=T-S,I=c[S];k=I+A*(c[S+1]-I)}l=Math.round(1e3*k)/1e3;break;default:l=h}return{min:l,max:s,values:c}}function d1(e,t,r,n,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if("num"===a)return n;var i=c1("getValueTypeCache",e,t,r,(function(){for(var e=[],t=0;t<r.length;++t)r[t].forEach((function(t){if(za(t)){var r=t.getValue();e.push(r)}}));return e.sort((function(e,t){return e-t}))}));return h1(a,n,i,o)}var v1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=5,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[258,260,258,260,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n,a=t[4];if(ro(a)&&(n=Ps(e.workbook,a.getRef())),!n)return it.NULL_VAR;var o=t[1].getValue(),i=t[3].getValue(),u=f1(e,n,t.slice(5),t[2].getValue(),i,t[0].getValue(),o),s=u.max,l=u.min,c=!1;l>s&&(s=(r=[l,s])[0],l=r[1],c=!0);var h=0;l<0&&(h=Math.abs(Number((s>0?l/(s-l):1).toFixed(3))));for(var f=new qd,d=a.getRef(),v=d.startRow+a.rowCount(),p=d.startCol+a.colCount(),m=d.startRow;m<v;++m)for(var g=d.startCol;g<p;++g){var y=a.get(m,g);if(za(y)){var _=p1(y,l,s,c);f.set(m,g,{originPoint:h,percent:_})}}return new LE(f)}}]),t}(pw("PRIVATE_CONDITION_DATA_BAR",5,256,1,Nd,[{type:Vd},{type:Nd},{type:Vd},{type:Nd},YE.SHEET_REF,YE.SHEET_REF]));function p1(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.getValue(),o=0,i=function(){return Math.abs(a)===Math.abs(t)?a<0?-.5:.5:Math.abs(a)<Math.abs(t)?0:o=a/Math.abs(a)},u=function(){return a<t?0:(a-t)/(r-t)},s=function(){return a>r?0:(a-r)/Math.abs(t-r)},l=function(){return a>=0?a/Math.abs(r):a/Math.abs(t)};return o=t===r?i():t>=0?u():r<=0?s():l(),Math.abs(o)>1&&(o=o<0?-1:1),Math.abs(o)>1&&(o=o<0?-1:1),Number.isNaN(o)&&(o=0),n&&(o=o<0?-1-o:1-o),Number(o)}var m1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0];if(ro(n)&&(r=Ps(e.workbook,n.getRef())),!r)return it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE];for(var a=g1(r.id(),e,t.slice(1)),o=new qd,i=n.getRef(),u=i.startRow+n.rowCount(),s=i.startCol+n.colCount(),l=i.startRow;l<u;++l)for(var c=i.startCol;c<s;++c){var h=yd(n.get(l,c));o.set(l,c,1===a[h])}return new LE(o)}}]),t}(pw("PRIVATE_CONDITION_UNIQUE",1,256,1,bd,[YE.SHEET_REF,YE.SHEET_REF]));function g1(e,t,r){return c1("PRIVATE_CONDITION_UNIQUE",t,e,r,(function(){for(var e={},t=0;t<r.length;++t)r[t].forEach((function(t){if(!(qa(t)||Wa(t)&&!t.getValue())){var r=yd(t);e[r]=(e[r]||0)+1}}));return e}))}var y1,_1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0];if(ro(n)&&(r=Ps(e.workbook,n.getRef())),!r)return it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE];for(var a=g1(r.id(),e,t.slice(1)),o=new qd,i=n.getRef(),u=i.startRow+n.rowCount(),s=i.startCol+n.colCount(),l=i.startRow;l<u;++l)for(var c=i.startCol;c<s;++c){var h=a[yd(n.get(l,c))];o.set(l,c,!!h&&h>1)}return new LE(o)}}]),t}(pw("PRIVATE_CONDITION_DUPLICATE",1,256,1,bd,[YE.SHEET_REF,YE.SHEET_REF])),R1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=3,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33,260,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0];if(ro(n)&&(r=Ps(e.workbook,n.getRef())),!r)return it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE];var a=this.getAverageCache(r.id(),e,t.slice(2));if(a instanceof Error)return it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE];for(var o=t[1].getValue(),i=new qd,u=n.getRef(),s=u.startRow+n.rowCount(),l=u.startCol+n.colCount(),c=u.startRow;c<s;++c)for(var h=u.startCol;h<l;++h){var f=n.get(c,h);!za(f)||r.hasCheckbox(c,h)?i.set(c,h,!1):i.set(c,h,this.isNeedStyle(a,f.getValue(),o))}return new LE(i)}},{key:"isNeedStyle",value:function(e,t,r){switch(r){case"greaterThan":return t>e;case"lessThan":return t<e;case"greaterThanOrEqual":return t>=e;case"lessThanOrEqual":return t<=e}return!1}},{key:"getAverageCache",value:function(e,t,r){return c1("PRIVATE_CONDITION_AVERAGE",t,e,r,(function(){for(var e=0,t=0,n=0;n<r.length;++n)r[n].forEach((function(r){za(r)&&(e+=r.getValue(),t++)}));return 0===t?new Error("average error"):e/t}))}}]),t}(pw("PRIVATE_CONDITION_AVERAGE",3,255,1,bd,[YE.SHEET_REF,{type:Nd},YE.SHEET_REF])),C1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=4,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33,260,258,264,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0];if(ro(n)&&(r=Ps(e.workbook,n.getRef())),!r)return it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE];for(var a=t[1].getValue(),o=t[2].getValue(),i=t[3].getValue(),u=this.getSortCache(r.id(),e,t.slice(4)),s=this.getTargetValue(u,i,a,o),l=new qd,c=n.getRef(),h=c.startRow+n.rowCount(),f=c.startCol+n.colCount(),d=c.startRow;d<h;++d)for(var v=c.startCol;v<f;++v){var p=n.get(d,v);if(!za(p)||r.hasCheckbox(d,v))l.set(d,v,!1);else{var m=p.getValue(),g=i?m<=s:m>=s;l.set(d,v,g)}}return new LE(l)}},{key:"getTargetValue",value:function(e,t,r,n){var a=e.length,o=function(e){return Math.min(Math.max(t?a-e:e-1,0),a-1)};switch(r){case"sort":return e[o(n)];case"percent":return e[o(Math.round(a*n/100))]}}},{key:"getSortCache",value:function(e,t,r){return c1("PRIVATE_CONDITION_RANK",t,e,r,(function(){for(var e=[],t=0;t<r.length;++t)r[t].forEach((function(t){za(t)&&e.push(t.getValue())}));return e.sort((function(e,t){return t-e}))}))}}]),t}(pw("PRIVATE_CONDITION_RANK",4,255,1,bd,[YE.SHEET_REF,{type:Nd},{type:Vd},{type:bd},YE.SHEET_REF]));!function(e){e[e.TwoColors=2]="TwoColors",e[e.ThreeColors=3]="ThreeColors"}(y1||(y1={}));var w1=function(e,t){if(!function(e){return!(!e||![2,3].includes(e.length))}(t))return null;if(["",void 0].includes(e))return null;var r=function(e){return(0,m.Z)(e).sort((function(e,t){return e-t}))}(t),n=null;if(r.some((function(t){return t===e}))){var a=r.length;3===a&&r[1]===e&&(n=[1,1]),r[0]===e&&(n=[1,0]),r[a-1]===e&&(n=[1,a-1])}else r.some((function(t,a){if(e<t){if(0===a)return n=[1,a],!0;var o=r[a-1];return n=[(e-o)/(t-o),a],!0}return a===r.length-1&&e>t&&(n=[1,a],!0)}));return n},E1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[258,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0].getValue(),a=t[1];if(ro(a)&&(r=Ps(e.workbook,a.getRef())),!r||2!==n&&3!==n)return it.NULL_VAR;var o,i,u=t.slice(2,2*n+2),s=t.slice(2+2*n),l=u[0].getValue(),c=u[1].getValue();2===n?(o=u[2].getValue(),i=u[3].getValue()):(o=u[4].getValue(),i=u[5].getValue());for(var h=f1(e,r,s,o,i,l,c),f=h.max,d=h.min,v=h.values,p=2===n?[d,f]:[d,h1(u[3].getValue(),u[2].getValue(),v,!1),f],m=new qd,y=a.getRef(),_=y.startRow+a.rowCount(),R=y.startCol+a.colCount(),C=y.startRow;C<_;++C)for(var w=y.startCol;w<R;++w){var E=a.get(C,w);if(za(E)){var k=w1(E.getValue(),p),T=(0,g.Z)(k,2),S=T[0],A=T[1];m.set(C,w,{level:A,percent:S})}}return new LE(m)}}]),t}(pw("PRIVATE_CONDITION_COLOR_SCALE",2,255,1,$d|Od,[{type:Vd},YE.SHEET_REF,qE(jE,Nd|Vd|Zd)])),k1=function(e,t){if(!function(e){return!!Array.isArray(e)&&e.every((function(e){return"number"==typeof e.value&&["greaterThan","greaterThanOrEqual"].includes(e.operator)}))}(t))return null;if(["",void 0].includes(e))return null;var r=t.length;return t.some((function(t,n){return("greaterThan"===t.operator&&e>t.value||"greaterThanOrEqual"===t.operator&&e>=t.value)&&(r=n,!0)})),r},T1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=Co,e.$$lazy=!1,e.$$paramsDesc=[33,258,33],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r,n=t[0];if(ro(n)&&(r=Ps(e.workbook,n.getRef())),!r)return new it.NumberVar(-1);for(var a=t[1].getValue(),o=t.slice(2,3*a+2),i=t.slice(3*a+2),u=Array.from({length:a}).map((function(t,n){return{operator:o[3*n].getValue(),value:d1(e,r.id(),i,o[3*n+1].getValue(),o[3*n+2].getValue(),!1)}})),s=new qd,l=n.getRef(),c=l.startRow+n.rowCount(),h=l.startCol+n.colCount(),f=l.startRow;f<c;++f)for(var d=l.startCol;d<h;++d){var v=n.get(f,d);if(za(v)){var p=k1(v.getValue(),u);s.set(f,d,Number(p))}else s.set(f,d,-1)}return new LE(s)}}]),t}(pw("PRIVATE_CONDITION_ICONS",2,255,1,Vd,[YE.SHEET_REF,{type:Vd},qE(jE,Nd|Vd|Zd)])),S1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=1,e.$$maxOperands=1,e.$$lazy=!1,e.$$paramsDesc=[49],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){var r=t[0];if(!Ja(r))switch(r.$$type){case 16:return new it.StringVar(r.getValue());case 4:return r;case 2:var n,a,o,i=null===(a=r.getSpecialInfo())||void 0===a||null===(n=a.customData)||void 0===n?void 0:n.autoFormat;return i&&(o=(0,Ee.createFormatter)(e.workbook.formatterService,i)),o?new it.StringVar(o.format(r.getValue())):r.toStringVar();default:return xc(r)||Rl(this.name,1,El(r),wl(r),it.FormulaErrorPhrases.DATA_TYPE_STRING)}if(Qa(r))return Ol(this.name,1,"");for(var u=ro(r)?r.getRef():null,s=u?Ps(e.workbook,u):null,l=[],c=r.rowCount(),h=r.colCount(),f=0;f<c;++f){for(var d=[],v=0;v<h;++v){var p=r.at(f,v);switch(p.$$type){case 16:d.push(new it.StringVar(p.getValue()));break;case 4:d.push(p);break;case 2:var m=void 0;if(s)m=s.getActualFormatter(u.startRow+f,u.startCol+v);else{var g,y,_=null===(y=p.getSpecialInfo())||void 0===y||null===(g=y.customData)||void 0===g?void 0:g.autoFormat;_&&(m=(0,Ee.createFormatter)(e.workbook.formatterService,_))}d.push(m?new it.StringVar(m.format(p.getValue())):p.toStringVar());break;case 8:d.push(p.getValue()?yo:_o);break;case 1:d.push(go);break;default:d.push(xc(p)||Rl(this.name,1,El(p),wl(p),it.FormulaErrorPhrases.DATA_TYPE_STRING))}}l.push(d)}return new gs(l)}}]),t}(pw("PRIVATE_TO_TEXT_WITH_FMT",1,0,0,Nd,[])),A1=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).$$minOperands=2,e.$$maxOperands=2,e.$$lazy=!1,e.$$paramsDesc=[260,260],e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"func",value:function(e,t){return t[0].getValue().toUpperCase()===t[1].getValue().toUpperCase()?it.BOOLEAN_VAR_MAP[it.BooleanConstant.TRUE]:it.BOOLEAN_VAR_MAP[it.BooleanConstant.FALSE]}}]),t}(pw("PRIVATE_CONDITION_TEXT_EQ",2,0,1,bd,[{type:Nd},{type:Nd}])),I1=new Map([["=",it.EqualsOp],["<>",it.NotEqualsOp],["<",it.LessThanOp],["<=",it.LessThanEqualsOp],[">",it.GreaterThanOp],[">=",it.GreaterThanEqualsOp],["+",aw],["-",ow],["*",it.MultiplyOp],["/",it.DivideOp],["%",it.ModOp],["&",it.ConcatenateOp],["^",it.PowerOp],[" ",ZF],[",",xF],[":",FF]]),O1=new Map([["+",it.PositiveOp],["-",it.NegativeOp]]),V1=new Map([["%",it.PercentOp]]),N1=new Map([["ACCRINT",OL],["ACCRINTM",VL],["ADDRESS",yH],["ARABIC",bL],["AREAS",Dz],["ACOT",pY],["ACOTH",mY],["ARRAY_CONSTRAIN",FL],["ARRAYFORMULA",ML],["AVERAGEA",xL],["AI_WRITE",nX],["AI_DEEPSEEK_WRITE",aX],["AI_ASK",oX],["AI_IMPORTDATA",iX],["AI_INFER",sX],["AI_CLASSIFY",pX],["AI_EXTRACT",mX],["AI_TRANSLATE",gX],["AI_SENTIMENT",yX],["AI_SUMMARY",_X],["AI_POLISH",RX],["AVERAGEIF",pH],["AVERAGEIFS",mH],["AVERAGE.WEIGHTED",fB],["AMORLINC",UY],["BINOMDIST",TJ],["BINOM.DIST",SJ],["BINOM.DIST.RANGE",AJ],["BASE",dB],["BITAND",mB],["BITLSHIFT",gB],["BITOR",yB],["BITRSHIFT",_B],["BITXOR",RB],["CELL",oY],["CHOOSE",wz],["COLUMN",fH],["COLUMNS",dH],["COT",yY],["COTH",_Y],["COUNTBLANK",sz],["COUNT",lx],["COUNTIFS",vH],["COUPDAYBS",wH],["COUPDAYS",EH],["COUPDAYSNC",kH],["COUPNCD",TH],["COUPNUM",SH],["COUPPCD",AH],["CSC",RY],["CSCH",CY],["CORREL",ZJ],["COVARIANCE.P",DJ],["COVARIANCE.S",xJ],["CONFIDENCE",EY],["CONFIDENCE.T",AY],["CONFIDENCE.NORM",wY],["DATEDIF",aH],["DATE",Cz],["DATEVALUE",kz],["DCOUNT",nJ],["DCOUNTA",aJ],["DGET",sJ],["DMAX",lJ],["DMIN",cJ],["DPRODUCT",oJ],["DSTDEV",iJ],["DSTDEVP",uJ],["DSUM",hJ],["DVAR",fJ],["DVARP",dJ],["DAVERAGE",rJ],["DAY",XU],["DAYS360",uH],["DAYS",iH],["DB",xY],["DDB",_q],["DISC",LH],["DOLLAR",eY],["DURATION",GH],["EDATE",_H],["ENCODEURL",Mx],["EOMONTH",RH],["EXPONDIST",YY],["EXPON.DIST",jY],["EPOCHTODATE",CX],["FALSE",Sz],["FIXED",Qj],["FORMULATEXT",sH],["FREQUENCY",lH],["GAMMA",Wz],["GAUSS",vJ],["GEOMEAN",Gz],["HARMEAN",jz],["LOGNORMDIST",pJ],["LOGNORM.DIST",mJ],["LOGINV",gJ],["LOGNORM.INV",yJ],["NORMINV",_J],["NORM.INV",RJ],["FORECAST.LINEAR",zJ],["FORECAST",WJ],["FDIST",qJ],["F.DIST",JJ],["F.DIST.RT",GJ],["F.INV",QJ],["FINV",XJ],["F.INV.RT",KJ],["FTEST",tK],["F.TEST",eK],["ZTEST",nK],["Z.TEST",rK],["HLOOKUP",uz],["HOUR",nH],["HYPERLINK",Ez],["HYPGEOMDIST",JY],["HYPGEOM.DIST",KY],["IFNA",lz],["IMAGE",e1],["IMPORTDATA",o1],["IMPORTFEED",u1],["IMPORTHTML",a1],["IMPORTRANGE",zE],["IMPORTXML",n1],["INDEX",PU],["INDIRECT",CH],["ISBLANK",hz],["ISDATE",MX],["ISEMAIL",FX],["ISURL",ZX],["ISERROR",cz],["ISFORMULA",fz],["ISREF",dz],["ISOWEEKNUM",Xz],["JOIN",pW],["LOOKUP",BH],["LAMBDA",fk],["LET",dk],["MATCH",iL],["MAXA",HH],["MAXIFS",yW],["MDURATION",WH],["MINA",jH],["MINIFS",_W],["MINUTE",rH],["MMULT",RW],["MODE",Ak],["MODE.SNGL",Ak],["MODE.MULT",KH],["MONTH",QU],["NETWORKDAYS",pz],["NETWORKDAYS.INTL",Az],["NOW",qU],["NEGBINOMDIST",VJ],["NEGBINOM.DIST",bJ],["OFFSET",JU],["PDURATION",$H],["PRICEMAT",bq],["PRIVATE_ARRAY_LITERAL",vL],["PRIVATE_ARRAY_ROW",dL],["PRIVATE_GET_REF",B$],["PRIVATE_LIST_VALIDATION",lL],["PRIVATE_CHECKBOX",H$],["PRIVATE_FORMATTER_VALIDATION",hL],["PRIVATE_IS_INT",fL],["PRIVATE_PIVOT_TABLE",pF],["PROPER",tY],["PRICE",YH],["PRICEDISC",JH],["PEARSON",UJ],["RANK",ez],["RANK.AVG",nY],["RANK.EQ",rY],["RECEIVED",Dq],["ROW",cH],["ROWS",hH],["RRI",Mq],["RSQ",HJ],["SEC",IY],["SECH",OY],["SECOND",tH],["SKEW",Kz],["SKEW.P",qz],["SORT",nW],["SORTBY",IQ],["SORTN",OQ],["SPLIT",aW],["SUBTOTAL",lk],["SUMIF",ZU],["SUMIFS",DU],["SUMPRODUCT",EB],["STEYX",BJ],["SLOPE",LJ],["T",mW],["TBILLEQ",hY],["TBILLPRICE",fY],["TBILLYIELD",dY],["TEXT",LU],["TIME",BU],["TIMEVALUE",GU],["TODAY",jU],["TRANSPOSE",tW],["TRUE",Tz],["TYPE",oz],["TDIST",tq],["T.DIST",eq],["T.DIST.2T",rq],["T.DIST.RT",nq],["TINV",oq],["T.INV",iq],["T.INV.2T",aq],["TTEST",sq],["T.TEST",uq],["VLOOKUP",wB],["WEEKDAY",Rz],["WEEKNUM",yz],["WORKDAY",Mz],["WORKDAY.INTL",xz],["WEIBULL",zY],["WEIBULL.DIST",HY],["YEARFRAC",Nz],["YEAR",eH],["YIELD",DY],["YIELDDISC",$Y],["YIELDMAT",PY],["ABS",DF],["ACOS",PF],["ACOSH",$F],["AND",LF],["ASC",BF],["ASIN",zF],["ASINH",WF],["ATAN2",GF],["ATAN",jF],["ATANH",YF],["AVEDEV",qF],["AVERAGE",QF],["BETADIST",vZ],["BETA.DIST",pZ],["BETA.INV",mZ],["BIN2DEC",VZ],["BIN2HEX",NZ],["BIN2OCT",bZ],["BINOM.INV",OJ],["DECIMAL",$J],["CEILING",$Z],["CEILING.MATH",LZ],["CEILING.PRECISE",BZ],["CHAR",UZ],["CLEAN",HZ],["CODE",CB],["COMBIN",GZ],["COMPLEX",QZ],["CONCATENATE",rx],["CONCAT",ex],["CONVERT",nx],["COS",ux],["COSH",sx],["COUNTA",cx],["COUNTIF",Pz],["COVAR",dx],["CUMIPMT",IH],["CUMPRINC",wx],["CHIDIST",NH],["CHISQ.DIST.RT",bH],["CHISQ.INV.RT",FH],["CHIINV",MH],["CHISQ.DIST",ZH],["CHITEST",xH],["CHISQ.INV",DH],["CHISQ.TEST",PH],["CRITBINOM",IJ],["COMBINA",PJ],["DEC2BIN",Ex],["DEC2HEX",Sx],["DEC2OCT",Ox],["DEGREES",Vx],["DELTA",Nx],["DOLLARDE",NY],["DOLLARFR",bY],["EFFECT",bx],["ERFC",Zx],["ERFC.PRECISE",Zx],["ERF",xx],["ERF.PRECISE",Dx],["ERROR.TYPE",Px],["EVEN",$x],["EXACT",Lx],["EXP",Bx],["FACTDOUBLE",Hx],["FACT",zx],["FILTER",fW],["FIND",Wx],["FINDB",Iq],["FLOOR",Gx],["FLOOR.MATH",jx],["FLOOR.PRECISE",Yx],["FV",qx],["FVSCHEDULE",Jx],["FISHER",XY],["FISHERINV",QY],["GAMMA.DIST",Kx],["GAMMADIST",Kx],["GAMMA.INV",Xx],["GAMMAINV",Xx],["GAMMALN",Qx],["GAMMALN.PRECISE",Qx],["GCD",nD],["GESTEP",aD],["GETPIVOTDATA",qq],["GROWTH",sY],["HEX2DEC",oD],["HEX2BIN",SX],["HEX2OCT",AX],["IFERROR",iD],["IF",$z],["IFS",Bz],["IMABS",uD],["IMAGINARY",sD],["IMARGUMENT",lD],["IMCONJUGATE",cD],["IMCOS",hD],["IMDIV",fD],["IMEXP",dD],["IMLN",vD],["IMLOG10",pD],["IMLOG2",mD],["IMPOWER",gD],["IMPRODUCT",yD],["IMSUB",_D],["IMSUM",RD],["INTERCEPT",CD],["INT",wD],["IPMT",ED],["IRR",kD],["ISERR",TD],["ISEVEN",SD],["ISLOGICAL",AD],["ISPMT",zz],["ISNA",ID],["ISNONTEXT",OD],["ISNUMBER",BD],["ISODD",UD],["ISTEXT",HD],["INTRATE",vz],["KURT",Yz],["LARGE",zD],["LCM",WD],["LEFT",GD],["LEFTB",Vq],["LEN",jD],["LENB",YD],["LINEST",iY],["LN",qD],["LOG",JD],["LOG10",KD],["LOGEST",lY],["LOWER",XD],["MAX",QD],["MEDIAN",eP],["MID",tP],["MIDB",Sq],["MIN",rP],["MIRR",nP],["MOD",aP],["MROUND",oP],["MARGINOFERROR",oK],["N",iP],["NA",uP],["NOMINAL",sP],["NORM.DIST",lP],["NORMDIST",lP],["NORMSDIST",cP],["NORM.S.DIST",hP],["NORM.S.INV",fP],["NORMSINV",fP],["NOT",dP],["NPER",vP],["NPV",pP],["ODD",mP],["OR",gP],["OCT2BIN",IX],["OCT2DEC",OX],["OCT2HEX",VX],["PERCENTILE",yP],["PERCENTILE.INC",Pq],["PERCENTRANK",_P],["PERCENTILE.EXC",Ek],["PERCENTRANK.EXC",Bq],["PERCENTRANK.INC",Uq],["PI",wP],["PMT",EP],["PPMT",kP],["POWER",AP],["PRODUCT",TP],["PV",IP],["POISSON",Fq],["POISSON.DIST",Zq],["PROB",aK],["PHI",iK],["STANDARDIZE",xq],["PERMUT",WY],["PERMUTATIONA",GY],["QUARTILE",OP],["QUARTILE.INC",Hq],["QUARTILE.EXC",Tk],["QUOTIENT",VP],["QUERY",Wj],["RADIANS",NP],["RANDBETWEEN",bP],["RAND",MP],["RANDARRAY",aQ],["RATE",FP],["REGEXEXTRACT",qj],["REGEXMATCH",Yj],["REGEXREPLACE",Jj],["REPLACE",ZP],["REPLACEB",Oq],["REPT",tz],["RIGHT",xP],["RIGHTB",Nq],["ROMAN",az],["ROUNDDOWN",DP],["ROUND",PP],["ROUNDUP",$P],["SEARCH",QP],["SEARCHB",Aq],["SEQUENCE",oQ],["SIGN",e$],["SIN",t$],["SINH",r$],["SLN",n$],["SYD",BY],["SMALL",a$],["SQRT",o$],["SQRTPI",i$],["STDEV",u$],["STDEVP",s$],["SUBSTITUTE",l$],["SUM",c$],["SWITCH",oW],["TAN",h$],["TANH",f$],["TEXTJOIN",vY],["TO_DATE",iQ],["TO_DOLLARS",lQ],["TO_PERCENT",cQ],["TO_PURE_NUMBER",sQ],["TO_TEXT",uQ],["TREND",uY],["TRIM",d$],["TRIMMEAN",m$],["TRUNC",g$],["UNIQUE",vW],["UPPER",y$],["UNICHAR",Jq],["UNICODE",Kq],["VALUE",_$],["VAR",R$],["VARP",C$],["VAR.P",hq],["VAR.S",cq],["VARA",dq],["VARPA",vq],["STDEV.P",pq],["STDEV.S",mq],["STDEVA",gq],["STDEVPA",yq],["DEVSQ",lq],["VDB",LY],["XIRR",P$],["XLOOKUP",Iz],["XMATCH",Vz],["XNPV",$$],["XOR",L$],["IMSQRT",DX],["IMCOSH",PX],["IMCOT",$X],["IMCOTH",LX],["IMCSC",BX],["IMCSCH",UX],["IMLOG",HX],["IMREAL",zX],["IMSEC",WX],["IMSECH",GX],["IMSIN",jX],["IMSINH",YX],["IMTAN",qX],["IMTANH",JX],["MULTINOMIAL",KX],["ISO.CEILING",XX],["MUNIT",QX],["SERIESSUM",eQ],["SUMSQ",tQ],["COUNTUNIQUE",rQ],["ADD",hQ],["DIVIDE",fQ],["EQ",lW],["GT",dQ],["GTE",vQ],["ISBETWEEN",pQ],["LT",mQ],["LTE",gQ],["MINUS",yQ],["MULTIPLY",_Q],["NE",RQ],["POW",wQ],["UMINUS",EQ],["UNARY_PERCENT",kQ],["UPLUS",TQ],["MDETERM",NQ],["MINVERSE",bQ],["SUMX2MY2",ZQ],["SUMX2PY2",xQ],["SUMXMY2",DQ],["FLATTEN",PQ],["TOROW",UQ],["TOCOL",BQ],["CHOOSEROWS",WQ],["CHOOSECOLS",zQ],["VSTACK",GQ],["HSTACK",jQ],["WRAPCOLS",YQ],["WRAPROWS",qQ],["BYCOL",XQ],["BYROW",KQ],["MAKEARRAY",QQ],["MAP",t0],["REDUCE",n0],["SCAN",u0],["ODDLPRICE",g0],["ODDLYIELD",y0],["ODDFPRICE",_0],["ODDFYIELD",R0],["ARRAYTOTEXT",C0],["BAHTTEXT",w0],["DBCS",k0],["JIS",A0],["NUMBERVALUE",I0],["TEXTAFTER",O0],["TEXTBEFORE",N0],["TEXTSPLIT",b0],["VALUETOTEXT",Z0],["BESSELI",H0],["BESSELJ",z0],["BESSELK",W0],["BESSELY",G0],["BETAINV",j0],["SHEET",Y0],["SHEETS",q0],["ISOMITTED",J0],["TAKE",X0],["DROP",K0],["EXPAND",Q0],["AGGREGATE",Ok]].concat((0,m.Z)([["PRIVATE_AND",s1],["PRIVATE_OR",l1],["PRIVATE_CONDITION_COLOR_SCALE",E1],["PRIVATE_CONDITION_ICONS",T1],["PRIVATE_CONDITION_UNIQUE",m1],["PRIVATE_CONDITION_DATA_BAR",v1],["PRIVATE_CONDITION_AVERAGE",R1],["PRIVATE_CONDITION_RANK",C1],["PRIVATE_CONDITION_DUPLICATE",_1],["PRIVATE_CONDITION_TEXT_EQ",A1],["PRIVATE_TO_TEXT_WITH_FMT",S1]])));var b1,M1={Common:512,Sort:2048,AI:50,Condition:512,InvertedIndex:100,CommonCacheInner:512};!function(e){e.INVERTED_INDEX="x_"}(b1||(b1={}));var F1,Z1,x1,D1,P1,$1,L1=function(){function e(t){(0,y.Z)(this,e),this.type=t,this.cache={}}return(0,_.Z)(e,[{key:"addCache",value:function(e,t){this.cache[e]||(this.cache[e]=t)}},{key:"addCacheByKey",value:function(){}},{key:"getCacheByKey",value:function(){return null}},{key:"getKey",value:function(){return null}},{key:"getCache",value:function(e){var t=this.cache[e];return t||(t=new Ce.z6B(M1[this.type]),this.cache[e]=t),t}},{key:"isCacheValid",value:function(){return!0}},{key:"removeCache",value:function(){this.cache={}}}]),e}(),B1=function(){function e(t){(0,y.Z)(this,e),this.calcEngine=t,this.formulaMgr=new XR,this.refMapMgr=new QR,this.formulaRefPool=new KR(this.formulaMgr,this.refMapMgr),this.rangeCache=new Map}return(0,_.Z)(e,[{key:"fromJSON",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=n.enableCalculation,o=void 0===a||a,i=n.useCache,u=void 0===i||i,s=e.v,l=e.tokens,c=e.refs,h=e.params,f=e.tree,d=e.importRangeId,v=e.externalDataReference,p=Hk[s-1],m=null;try{var y;if(null==p)throw new Error("Failed to deserialize: not supported formula data version");if(m=this.cacheRefs(p.deserializeRefs(c,r,t,Object.assign({},n,{relativeRef:!0})),u),u){var _,R=this.formulaMgr.getByVal({tokens:l,params:h,importRangeId:null!==(_=d)&&void 0!==_?_:null==v?void 0:v.importRangeId});if(R)return[R,m]}var C,w=!1,E=!1,k=!1,T=null;if(o){var S=p.deserializeParams(h),A=p.deserializeTree(e.tree,m,{calcEngine:this.calcEngine,visitFunctions:p.visitFunctions,params:S}),I=(0,g.Z)(A,5);T=I[0],C=I[1],w=I[2],E=I[3],k=I[4]}var O=null===T?f:null,V=Pk(r,d,v);return[this.cacheFormula(new qR({tokens:l,serialization:O,expression:T,params:h,importRangeId:null!==(y=d)&&void 0!==y?y:null==v?void 0:v.importRangeId,importRangeMeta:null==V?void 0:V.importRangeMeta,externalDataReferenceInfo:null==V?void 0:V.externalDataReferenceInfo},{hasSubtotal:w,hasAggregate:E,hasArrayFunction:k},C,o),u),m]}catch(t){return[new qR({tokens:e.tokens,expression:[Dk(t.message)]}),m]}}},{key:"fromMutation",value:function(e,t,r,n){var a=this,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=o.enableCalculation,u=void 0===i||i,s=o.useCache,l=void 0===s||s,c=e.v,h=e.tokens,f=e.params,d=e.tree,v=e.importRangeId,p=e.externalDataReference,m=Hk[c-1],y=null;try{var _;if(null==m)throw new Error("Failed to deserialize: not supported formula data version");var R=n.formulaDataId,C=n.formulaRefMapId,w=n.cellValueRefHelper,E=null!==(_=n.refs)&&void 0!==_?_:e.refs;y=this.cacheRefsFromMutation(C,w,(function(){return m.deserializeRefs(E,r,t,Object.assign({},o,{relativeRef:!0}))}),l);var k=this.cacheFormulaFromMutation(R,w,(function(){var t,n,o=!1,i=!1,s=!1,l=null;if(u){var c=m.deserializeParams(f),_=m.deserializeTree(e.tree,y,{calcEngine:a.calcEngine,visitFunctions:m.visitFunctions,params:c}),R=(0,g.Z)(_,5);l=R[0],n=R[1],o=R[2],i=R[3],s=R[4]}var C=null===l?d:null,w=Pk(r,v,p);return new qR({tokens:h,serialization:C,expression:l,params:f,importRangeId:null!==(t=v)&&void 0!==t?t:null==p?void 0:p.importRangeId,importRangeMeta:null==w?void 0:w.importRangeMeta,externalDataReferenceInfo:null==w?void 0:w.externalDataReferenceInfo},{hasSubtotal:o,hasAggregate:i,hasArrayFunction:s},n,u)}),l);if(null==k)throw new Error("Failed to deserialize formula");return[k,y]}catch(t){return[new qR({tokens:e.tokens,expression:[Dk(t.message)]}),y]}}},{key:"fromBuilder",value:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5?arguments[5]:void 0,u=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],s=e.getTokens(),l=e.getParams(),c=e.hasSubtotal,h=e.hasAggregate,f=e.alwaysCalcOp,d=e.hasArrayFunction,v=e.getRefs(),p=this.cacheRefs(this.absolute2relativeRefs(v,t),u),m=new qR({tokens:s,serialization:n,expression:a,params:null!==(r=l)&&void 0!==r?r:void 0,externalDataReferenceInfo:o},{hasSubtotal:c,hasAggregate:h,hasArrayFunction:d},f,i);return[m=this.cacheFormula(m,u),p]}},{key:"flushRanges",value:function(e){var t=this;if(0!==this.rangeCache.size)return(void 0===e?Array.from(this.rangeCache.keys()):[e]).reduce((function(e,r){var n=t.rangeCache.get(r);return t.rangeCache.delete(r),e[r]=n?Array.from(n).map((function(e){var t=(0,g.Z)(e,2),r=t[0],n=t[1];return[r,Array.from(n.values())]})):[],e}),{})}},{key:"cacheFormula",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t?this.formulaMgr.add(e):e}},{key:"cacheRefs",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t&&e?this.refMapMgr.add(e):e}},{key:"cacheFormulaFromMutation",value:function(e,t,r){var n=this,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!a)return r();var o=null;return t.formulaDatas.checkValuesRefId(e,(function(e){var t;o=null!==(t=n.formulaMgr.get(e))&&void 0!==t?t:null}),(function(){var e=r();if(e){var t=n.formulaMgr.add(e);return o=t,n.formulaMgr.getHash(t)}})),o}},{key:"cacheRefsFromMutation",value:function(e,t,r){var n=this,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!a)return r();var o=null;return t.formulaRefMaps.checkValuesRefId(e,(function(e){var t;o=null!==(t=n.refMapMgr.get(e))&&void 0!==t?t:null}),(function(){var e=r();if(e){var t=n.refMapMgr.add(e);return o=t,n.refMapMgr.getHash(t)}})),o}},{key:"cacheRange",value:function(e,t){var r,n,a=t.hostId;if(a){var o=null!==(r=this.rangeCache.get(a))&&void 0!==r?r:new Map;this.rangeCache.set(a,o);var i=null!==(n=o.get(e))&&void 0!==n?n:new Map;o.set(e,i),i.set(t.hash(),t)}}},{key:"absolute2relativeRefs",value:function(e,t){return e?Object.entries(e).reduce((function(e,r){var n=(0,g.Z)(r,2),a=n[0],o=n[1];return e[a]=Tu(o,t),e}),{}):null}},{key:"clear",value:function(){this.refMapMgr.clear(),this.formulaMgr.clear(),this.formulaRefPool.clear(),this.rangeCache.clear()}},{key:"destroy",value:function(){this.clear()}}]),e}(),U1=function(){function e(t,r){(0,y.Z)(this,e),this.ref=t,this.data=r,this.relations=[]}return(0,_.Z)(e,[{key:"getRelation",value:function(e){return this.relations[e]||null}},{key:"addRelation",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.relations.push({node:e,rules:t}),e&&r&&e.addRelation(this,t)}},{key:"removeRelation",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.relations.length-1;r>=0;r--){var n=this.relations[r];if(n.node===e)return n.node=null,t&&e.removeRelation(this),!0}return!1}},{key:"removeRelationByIdx",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e<0||e>=this.relations.length)return!1;var r=this.relations[e];return!!r.node&&(t&&r.node.removeRelation(this),r.node=null,!0)}},{key:"clearRelations",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1?arguments[1]:void 0;if(e){for(var r=0;r<this.relations.length;r++){var n=this.relations[r];n.node&&(n.node.removeRelation(this),t&&n.node.hasNoConnectRelations()&&t(n.node))}this.relations=[]}else this.relations=[]}},{key:"iterRelations",value:function(e){if(this.relations.length)for(var t=0;t<this.relations.length;t++){var r=this.relations[t];e(r.node,r.rules,t)}}},{key:"mapRelationNodes",value:function(e,t){for(var r=[],n=0;n<this.relations.length;n++){var a=this.relations[n];a.node?r.push(e(a.node,a.rules,n)):t||r.push(e(a.node,a.rules,n))}return r}},{key:"isEmptyRelations",value:function(){return 0===this.relations.length}},{key:"hasNoConnectRelations",value:function(){return 0===this.relations.length||this.relations.every((function(e){return!e.node}))}}]),e}(),H1=function(){function e(t,r){(0,y.Z)(this,e),this.loggerService=t,this.opt=r,this.refTree=new Map,this.invalidSheetIdDepMap=new Map,this.invalidSheetNameDepMap=new Map,this.invalidMountNodesMap=new Map,this.resetGraphEffect(),this.resetTreeEffect(),this.resetInvalidEffect()}return(0,_.Z)(e,[{key:"getGraphSegmentGridRange",value:function(e,t,r){if(!e&&!t.hostId)return this.printLog("getDepRefsByMountRef sheetId and hostId is empty"),[];var n=this.searchRefNodesInTree(e,t,r);if(!n||!n.length)return[];var a=0===r;return n.map((function(e){var r=[],n=e.mapRelationNodes((function(n,o){var i=o[0].ref;return r.push(i),a?function(e,t){return Qi.fromGridRange(wi(e,t))}(Ko(t,e.ref),i):function(e,t,r){return Qi.fromGridRange(Si(e,t,r))}(Ko(t,e.ref),i,n.ref)}),!0);return{node:e,refs:n,relatives:r}}))}},{key:"resetGraphEffect",value:function(){this.graphEffect={}}},{key:"resetTreeEffect",value:function(){this.treeEffect={}}},{key:"resetInvalidEffect",value:function(){this.invalidEffect?this.invalidEffect.clear():this.invalidEffect=new Map}},{key:"flushInvalidEffect",value:function(){var e=this;this.invalidEffect.forEach((function(t,r){var n=t.add,a=t.del,o=e.getInvalidMountNodeSet(r);n.forEach((function(e){o.add(e)})),a.forEach((function(e){o.delete(e)}))})),this.resetInvalidEffect()}},{key:"relationDisconnect",value:function(e,t,r,n){var a=this,o=e.all();if(o.length)for(var i=function(e,t){var i=o[e];i.iterRelations((function(e,t){if(e){var o=e.ref.hostId;o&&(null!=n&&n(i,e,t,r),i.removeRelation(e,!0),e.hasNoConnectRelations()&&1===r&&a.getTreeEffectBySheetId(o).dep.del.add(e))}}))},u=0,s=o.length;u<s;u++)i(u)}},{key:"flushTreeEffect",value:function(){var e=this,t=Object.keys(this.treeEffect);if(t.length){for(var r=0,n=t.length;r<n;r++){var a=t[r];this.treeEffect[a].mount.del.forEach((function(t){t.clearRelations(!0,(function(t){e.getTreeEffectBySheetId(t.ref.hostId).dep.del.add(t)}))}))}for(var o=function(r,n){var a=t[r],o=e.treeEffect[a],i=e.createRefTree(a);o.mount.del.forEach((function(e){i.mount.remove(e)})),o.dep.del.forEach((function(e){i.dep.remove(e)})),i.mount.insertItems(Array.from(o.mount.add)),i.dep.insertItems(Array.from(o.dep.add))},i=0,u=(t=Object.keys(this.treeEffect)).length;i<u;i++)o(i);this.resetTreeEffect()}}},{key:"handleUpdateEffect",value:function(e,t,r){if(0!==e.update){var n=2|e.update,a=1|e.update;n&&t.mount.update(),a&&t.dep.update()}}},{key:"handleMergeEffect",value:function(e,t,r){var n=this;e.merge.size&&!t.mount.isEmpty()&&e.merge.forEach((function(r){var a=e.add.get(r.data)||[],o=a.length;n.searchNodeSibling(r.ref,r.data,t.mount,e.del,(function(t){e.del.add(t),a.push(t.ref)})),a.length>o&&(e.del.add(r),e.add.set(r.data,a))}))}},{key:"searchNodeSibling",value:function(e,t,r,n,a){var o=r.search(function(e){return new Qi(Uo(0,e.startRow-1),e.endRow+1,Uo(0,e.startCol-1),e.endCol+1,e.hostId,e.hostName,e.status)}(e));if(o.length)for(var i=0,u=o.length;i<u;i++){var s=o[i];n.has(s)||jo(s.ref,e)&&this.checkRefNodeLikely(s.data,t)&&a(s)}}},{key:"handleDeleteEffect",value:function(e,t,r){var n=this;if(e.del.size){var a=this.getInvalidMountNodeSet(r);e.del.forEach((function(e){var o=e.ref.hostId;(o===r?t:n.getTreeEffectBySheetId(o)).mount.del.add(e),(o===r?a:n.getInvalidMountNodeSet(o)).size&&n.getInvalidEffectBySheetId(o).del.add(e)}))}}},{key:"handleSplitEffect",value:function(e,t,r){var n=this,a=e.add,o=e.split,i=e.del;o.size&&o.forEach((function(e,r){if(!i.has(r)){var o,u=r.ref,s=new Set([u]),l=yr(e);try{var c=function(){var e=o.value;if(zo(e,u))return s.clear(),"break";Array.from(s).forEach((function(t){Kd(t,e,s)&&s.delete(t)}))};for(l.s();!(o=l.n()).done;){if("break"===c())break}}catch(e){l.e(e)}finally{l.f()}if(1!==s.size||!s.has(u)){if(s.size>0){var h=a.get(r.data)||[];a.set(r.data,h.concat(Array.from(s)))}t.mount.del.add(r),n.getInvalidEffectBySheetId(r.ref.hostId).del.add(r)}}}))}},{key:"handleAddEffect",value:function(e,t,r){var n=this;if(e.add.size){var a=this.getTreeBySheetIdAndType(r,0);if(!a)throw new Error("add node but no mount tree ".concat(r));e.add.forEach((function(e,r){var o=[],i=new TB,u=i.batchAdd(e);if(!a.isEmpty())for(var s=0;s<u.length;s++){var l=u[s];n.searchNodeSibling(l,r,a,t.mount.del,(function(e){o.push(e),i.add(e.ref)}));for(var c=0;c<o.length;c++){var h=o[c];i.has(h.ref)?i.delete(h.ref):(t.mount.del.add(h),t.mount.add.delete(h),n.getInvalidEffectBySheetId(h.ref.hostId).del.add(h))}o.length=0}i.forEach((function(e){var a=n.createRefNode(e,r);t.mount.add.add(a)}))}))}}},{key:"removeRefTree",value:function(e){this.refTree.delete(e)}},{key:"calcSplitAndMoveRefNode",value:function(e,t,r,n){var a=r.boundaryKeys,o=r.moveResizeCache,i=e.ref,u=i[a.startKey],s=i[a.endKey],l=jd(u,s),c=o.get(l);c||(c=function(e,t,r,n){var a=r.isAddOp,o=r.opIntervalList,i=r.maxOpIntervalStart,u=r.maxOpIntervalEnd,s=r.maxOpMoveResizePair,l=e,c=t,h=a&&i<l||!a&&u<=l,f=h?s:[0,0];n&&(f=[f[0],0]);var d=new Map([[l,f]]);if(h||n)return d;var v=l<o[0].target?0:su(o,l,hu,!0),p=c>=u?o.length-1:su(o,c,hu,!0),m=Uo(0,v),g=Ho(p,o.length-1),y=o[m],_=y.target<=l?y.total:y.total-y.count;_>0&&(f[0]=_);for(var R=f,C=m;C<=g;C++){var w=o[C],E=w.target,k=w.target+w.count;if(w.target>=c)break;if(E>l&&E<=c-1){var T=E,S=[w.total,w.count];if(d.set(T,S),!a&&k>c)break;l=T,R=S}else!a&&E<=l&&k>l&&(R[1]=Ho(k,c)-l)}return d}(u,s,r,n),o.set(l,c)),t.set(e,c)}},{key:"getConnectedNodeAry",value:function(e){var t=this,r=[];return null!=e&&e.forEach((function(e){t.getInvalidMountNodeSet(e).forEach((function(e){r.push(e)}))})),r}},{key:"getInvalidNodesBySheetInfo",value:function(e,t){var r=this.getInvalidNodesBySheetId(e),n=this.getInvalidNodesBySheetName(t),a=r.length?r:n;if(0!==a.length)return new Set(a)}},{key:"getInvalidNodesBySheetName",value:function(e){var t=this.getInvalidSheetDepByName(e);return this.getConnectedNodeAry(t)}},{key:"getInvalidNodesBySheetId",value:function(e){var t=this.getInvalidSheetDepById(e);return this.getConnectedNodeAry(t)}},{key:"graphEffectAddNewItem",value:function(e,t,r){var n=e.add.get(t)||[];n.length||e.add.set(t,[r]),n.push(r)}},{key:"getInvalidSheetDepById",value:function(e){return this.invalidSheetIdDepMap.get(e)}},{key:"createInvalidSheetDepById",value:function(e){var t=new Set;return this.invalidSheetIdDepMap.set(e,t),t}},{key:"getInvalidSheetDepByName",value:function(e){return this.invalidSheetNameDepMap.get(e)}},{key:"createInvalidSheetDepByName",value:function(e){var t=new Set;return this.invalidSheetNameDepMap.set(e,t),t}},{key:"dropInvalidSheetDepIdMap",value:function(e,t){this.invalidSheetIdDepMap.delete(e),this.invalidSheetNameDepMap.delete(t)}},{key:"getInvalidMountNodeSet",value:function(e){var t=this.invalidMountNodesMap.get(e);if(!t){var r=new Set;return this.invalidMountNodesMap.set(e,r),r}return t}},{key:"createRefTree",value:function(e){var t=this.refTree.get(e);return t||(t={mount:new VT,dep:new VT},this.refTree.set(e,t),t)}},{key:"buildRefNodeRelations",value:function(e,t){var r=e.ref,n=this.getDepRangeAndReference(r,t);if(n.length)for(var a=0;a<n.length;a++){var o=n[a],i=o.depRange,u=o.references,s=null!=i&&i.hostId?new U1(i,t):null;if(e.addRelation(s,u,!0),this.onRelationCreated(e,s),!s){var l=null==i?void 0:i.hostName,c=null==r?void 0:r.hostId;if(!l||!c)continue;(this.getInvalidSheetDepByName(l)||this.createInvalidSheetDepByName(l)).add(c)}}else this.onRelationCreated(e,null)}},{key:"updateMountRefNode",value:function(e,t,r,n){var a=this,o=n.boundaryKeys,i=o.startKey,u=o.endKey,s=n.offsetRatio;e.iterRelations((function(n,o,l){if(n&&n.ref.hostId&&0!==o.length){for(var c=o[0].idx,h=t[c],f=r[c],d=f.depMove,v=f.resize,p=f.invalidDep,m=0;m<o.length;m++)o[m].ref=h;if(p)return e.removeRelationByIdx(l,!0),void a.getTreeEffectBySheetId(n.ref.hostId).dep.del.add(n);0===d&&0===v||(n.ref[i]+=d*s,n.ref[u]+=d*s,n.ref[u]+=v*s,a.getGraphEffectBySheetId(n.ref.hostId).update|=1)}}))}},{key:"createRefNode",value:function(e,t){var r=new U1(e,t);return this.buildRefNodeRelations(r,t),r}},{key:"onRelationCreated",value:function(e,t){if(e.ref.hostId){var r=e.ref.hostId,n=null==t?void 0:t.ref.hostId;n?(n&&!this.refTree.get(n)&&this.createRefTree(n),this.getTreeEffectBySheetId(n).dep.add.add(t)):r&&this.getInvalidEffectBySheetId(r).add.add(e)}}},{key:"getTreeBySheetIdAndType",value:function(e,t){var r=this.refTree.get(e);return r?r[0===t?"mount":"dep"]:null}},{key:"searchRefNodesInTree",value:function(e,t,r){var n=this.getTreeBySheetIdAndType(e,r);return n?n.search(t):null}},{key:"getDepRefsByMountRef",value:function(e){return this.getGraphSegmentGridRange(e.hostId,e,0)}},{key:"getMountRefsByDepRef",value:function(e){return this.getGraphSegmentGridRange(e.hostId,e,1)}},{key:"onRangeValueChanged",value:function(e,t,r){var n=this;if(!this.isEmptyGraphTree(e,0)||r&&0!==r.size){var a;if(t)for(var o=0;o<t.length;o++){var i=t[o],u=this.searchRefNodesInTree(e,i,0);if(u&&u.length){a||(a=this.getGraphEffectBySheetId(e));for(var s=function(e,t){var r,o=u[e];if(a.del.has(o))return"continue";if(zo(i,o.ref))return a.del.add(o),n.invalidMountNodesMap.forEach((function(e){null==e||e.forEach((function(t){t===o&&e.delete(t)}))})),a.split.delete(o),"continue";var s=null!==(r=a.split.get(o))&&void 0!==r?r:new Set;a.split.set(o,s),s.add(i)},l=0,c=u.length;l<c;l++)s(l)}}r&&r.size>0&&(a||(a=this.getGraphEffectBySheetId(e)),r.forEach((function(t,r,o){n.graphEffectAddNewItem(a,t,new Qi(r,r+1,o,o+1,e))}))),a&&this.flushGraphEffect()}}},{key:"isEmptyGraphTree",value:function(e,t){if(0===this.refTree.size)return!0;var r=this.refTree.get(e);return!r||(void 0===t?r.mount.isEmpty()&&r.dep.isEmpty():r[0===t?"mount":"dep"].isEmpty())}},{key:"onRowColAddOrDelete",value:function(e,t,r){var n=this,a=r||new Set;if(this.isEmptyGraphTree(e))return a;for(var o=new Map,i=new Map,u=t.effectedRef(),s=this.getRelativeCache(),l=t.ranges,c=t.isRowType(),h="add"===t.type(),f=c?ci:hi,d=f.startKey,v=f.endKey,p=l[l.length-1],m=p.target,y=p.target+p.count,_=[p.total,0],R=new Map,C=new Map,w={sheetId:e,isAddOp:h,isRowOp:c,offsetRatio:h?1:-1,boundaryKeys:f,opIntervalList:l,maxOpIntervalStart:m,maxOpIntervalEnd:y,maxOpIntervalTotal:p.total,maxOpMoveResizePair:_,moveResizeCache:R},E=0;E<u.length;E++){for(var k=u[E],T=this.searchRefNodesInTree(e,k,0)||[],S=0,A=T.length;S<A;S++){var I,O=T[S];this.calcSplitAndMoveRefNode(O,o,w,null===(I=this.opt)||void 0===I?void 0:I.ignoreSplit)}for(var V=this.searchRefNodesInTree(e,k,1)||[],N=0,b=V.length;N<b;N++){var M,F=V[N],Z=F.ref;c&&Z.isCol()||!c&&Z.isRow()?F.iterRelations((function(e){e&&a.add(e.ref)})):(this.calcSplitAndMoveRefNode(F,i,w,null===(M=this.opt)||void 0===M?void 0:M.ignoreSplit),F.iterRelations((function(e){e&&(o.has(e)||o.set(e,null),a.add(e.ref))})))}}return o.forEach((function(e,t){var r=t.ref,o=[],u=n.getGraphEffectBySheetId(t.ref.hostId),l=null;if(e){var c=jd(r[d],r[v]),h=C.get(c);h?l=h:(l=Xd(e,r[v]),C.set(c,l))}t.isEmptyRelations()?o.push({channelId:"",channel:Qd(r,l,null,null,null,w,s)}):t.iterRelations((function(e,t){var n;if(e){var a=e.ref,u=i.get(e),c=null;if(u){var h=jd(a[d],a[v]),f=C.get(h);f?c=f:(c=Xd(u,a[v]),C.set(h,c))}n=Qd(r,l,a,c,t[0].ref,w,s)}else n=Qd(r,l,null,null,t[0].ref,w,s);n.length&&t.forEach((function(e){var t=e.idx;o.push({channelId:t,channel:n})}))}));var f=1!==o.length||o[0].channelId?function(e){if(0===e.length)return[];if(1===e.length){var t=e[0],r=t.channel,n=t.channelId;return r.map((function(e){var t={};t[n]=e.data[0];var r={};return r[n]=e.data[1],{start:e.start,end:e.end,data:[t,r]}}))}for(var a=[],o=[],i=[],u=0,s=0,l=0,c=0;c<e.length;c++)0===c&&(u=e[c].channel[0].start,l=e[c].channel[e[c].channel.length-1].end),o[c]=0,i[c]=e[c].channel[0].end;for(;s<=l;){s=Math.min.apply(Math,i);for(var h={},f={},d=0;d<o.length;d++){var v=o[d],p=e[d],m=p.channelId,g=p.channel,y=g[v];h[m]=y.data[0],f[m]=y.data[1],y.end<=s&&v<g.length-1&&(o[d]++,i[d]=g[v+1].end),y.start>u&&(u=y.start)}if(a.push({start:u,end:s,data:[h,f]}),s>=l)break}return a}(o):o[0].channel.map((function(e){return{start:e.start,end:e.end,data:[null,e.data[1]]}}));0===f.length&&u.del.add(t);for(var p=0;p<f.length;p++){var m=f[p],y=m.start,_=m.end,R=(0,g.Z)(m.data,2),E=R[0],k=R[1],T=E?n.getNewRelativeChangedNode(t.data,E):t.data;if(_-y==t.ref[v]-t.ref[d]&&1===f.length){t.ref[d]===y&&t.ref[v]===_||(t.ref[d]=y,t.ref[v]=_,u.update|=2,!w.isAddOp&&e&&e.has(t.ref[y])&&u.merge.add(t)),t.data=T,E&&n.updateMountRefNode(t,E,k,w),n.updateRefs(t,t.ref,T),a.add(t.ref);break}u.del.add(t);var S=u.add.get(T);S||(S=[],u.add.set(T,S));var A=t.ref.clone();A[d]=y,A[v]=_,S.push(A),a.add(A),n.updateRefs(t,A,T)}})),this.flushGraphEffect(),a}},{key:"toStringifyGraphSegment",value:function(e){var t=[];return this.refTree.forEach((function(r,n){e&&n!==e||r.mount.all().forEach((function(e){t.push("".concat(n,"!").concat(Jd(e.ref,!1)," -> ").concat(e.mapRelationNodes((function(t,r){if(t)return"".concat(t.ref.hostId,"!").concat(Jd(t.ref,!1));var n=r[0].ref;return"".concat(n.hostId||n.hostName,"!").concat(Jd(Qi.fromGridRange(wi(e.ref,n)),!1))}),!1).join(",")))}))})),t.sort()}},{key:"destroy",value:function(){this.printLog("call destroy"),this.resetGraphEffect(),this.resetTreeEffect(),this.resetInvalidEffect(),this.invalidMountNodesMap.clear(),this.invalidSheetIdDepMap.clear(),this.invalidSheetNameDepMap.clear(),this.refTree.clear()}},{key:"getGraphEffectBySheetId",value:function(e){var t=this.graphEffect[e];return t||(t={add:new Map,del:new Set,split:new Map,merge:new Set,update:0},this.graphEffect[e]=t),t}},{key:"getTreeEffectBySheetId",value:function(e){var t=this.treeEffect[e];return t||(t={mount:{add:new Set,del:new Set},dep:{add:new Set,del:new Set}},this.treeEffect[e]=t),t}},{key:"getInvalidEffectBySheetId",value:function(e){var t=this.invalidEffect.get(e);return t||(t={add:new Set,del:new Set},this.invalidEffect.set(e,t)),t}},{key:"flushGraphEffect",value:function(){var e=Object.keys(this.graphEffect);if(e.length){for(var t=0;t<e.length;t++){var r=e[t],n=this.graphEffect[r];if(0!==n.add.size||0!==n.del.size||0!==n.split.size||0!==n.merge.size||0!==n.update){var a=this.getTreeEffectBySheetId(r),o=this.createRefTree(r);this.handleUpdateEffect(n,o,r),this.handleMergeEffect(n,o,r),this.handleDeleteEffect(n,a,r),this.handleSplitEffect(n,a,r),this.handleAddEffect(n,a,r)}}this.flushTreeEffect(),this.resetGraphEffect(),this.flushInvalidEffect()}}},{key:"printLog",value:function(e,t,r){var n;null===(n=this.loggerService)||void 0===n||n.info("[DependencyRefManager] ".concat(e),t,r)}}]),e}(),z1=function(){function e(t,r){(0,y.Z)(this,e),this.formulaRefManager=t,this.formulaRefService=r}return(0,_.Z)(e,[{key:"moveRange",value:function(e){var t=this,r=e.srcRange(),n=e.targetRange(),a=r.sheet(),o=n.sheet();if(a&&o){var i=this.formulaRefManager.getGraphEffectBySheetId(o.id()),u=this.formulaRefManager.getGraphEffectBySheetId(a.id()),s=this.moveFormulaRange(e),l=(0,g.Z)(s,2),c=l[0],h=l[1],f=this.moveRefRange(e),d=this.formulaRefService.formulaRefPool,v={row:n.startRow-r.startRow,col:n.startCol-r.startCol};h.forEach((function(e,r){t.splitRefNode(i,r,e)})),c.forEach((function(r,n){t.splitRefNode(u,n,r),t.translateFormulaMountRef(o,r,e,v)})),c.forEach((function(e,r){var n=new Set([xi(e,v.row,v.col,o.id(),o.name())]),u=f.get(r);u&&Array.from(u).forEach((function(s){var l=(0,g.Z)(s,2),c=l[0],h=l[1],f=Gd(c),p=f.row,m=f.col,y=new Qi(p,p+1,m,m+1,a.id(),a.name(),0);if(zo(e,y)){var _=xi(y,v.row,v.col,o.id(),o.name());t.addRefNode(o,i,d.add({formula:r.data.formula,refMap:t.translateRefs(r.data.refMap,h,v)}),_),u.delete(c),Array.from(n).forEach((function(e){Kd(e,_,n)&&n.delete(e)}))}})),n.forEach((function(e){t.addRefNode(o,i,d.add({formula:r.data.formula,refMap:t.translateRefs(r.data.refMap,void 0,v)}),e)}))})),f.forEach((function(e,r){var n=a.parent.getSheetFromId(r.ref.hostId),o=t.formulaRefManager.getGraphEffectBySheetId(r.ref.hostId),i=h.get(r);e.forEach((function(e,a){var u=Gd(a),s=u.row,l=u.col,c=new Qi(s,s+1,l,l+1,n.id(),n.name(),0);i&&zo(i,c)||(t.addRefNode(n,o,d.add({formula:r.data.formula,refMap:t.translateRefs(r.data.refMap,e)}),c),t.splitRefNode(o,r,c))}))})),this.formulaRefManager.flushGraphEffect()}}},{key:"moveFormulaRange",value:function(e){var t=e.srcRange(),r=e.targetRange(),n=new Map,a=new Map,o=this.formulaRefManager.searchRefNodesInTree(t.sheet().id(),t,0),i=this.formulaRefManager.searchRefNodesInTree(r.sheet().id(),r,0);return null!=o&&o.forEach((function(e){Yo(e.ref,t)&&n.set(e,Qi.fromGridRange(Ko(e.ref,t)))})),null!=i&&i.forEach((function(e){Yo(e.ref,r)&&a.set(e,Qi.fromGridRange(Ko(e.ref,r)))})),[n,a]}},{key:"moveRefRange",value:function(e){var t,r,n=new Map,a=function(e,t,r,a,o){var i,u,s=Wd(e,t),l=null!==(i=n.get(r))&&void 0!==i?i:new Map;n.set(r,l);var c=null!==(u=l.get(s))&&void 0!==u?u:new Map;l.set(s,c),c.set(a,o)},o=e.srcRange(),i=e.targetRange(),u=e.toEdgeAdjust,s=null!==(t=this.formulaRefManager.searchRefNodesInTree(o.sheet().id(),o,1))&&void 0!==t?t:[],l=null!==(r=this.formulaRefManager.searchRefNodesInTree(i.sheet().id(),i,1))&&void 0!==r?r:[],c=new Set;return s.forEach((function(e){c.add(e)})),l.forEach((function(e){c.add(e)})),c.forEach((function(e){var t=Yo(e.ref,o)?Ko(e.ref,o):Yo(e.ref,i)?Ko(e.ref,i):null;t&&e.iterRelations((function(r,n,s){var l=e.getRelation(s);if(0!==n.length&&r&&l){var c=n[0].ref,h=c.clone(),f=Si(t,c,r.ref,!0);if(Ci(f))for(var d=new ou(0,0,1,1,null),v=f.startRow;v<f.endRow;v++)for(var p=f.startCol;p<f.endCol;p++){d.setRowFrom(v),d.setColFrom(p),ri(h,Ei(d,c));var m=Gi(h,o,i,u);if(m){var g=Tu(m,d,vi(c.status));a(v,p,r,l,g)}}}}))})),n}},{key:"translateRefs",value:function(e,t,r){if(!e)return null;var n=Object.assign({},e);return t&&t.forEach((function(e,t){return t.rules.forEach((function(t){var r=t.idx;return n[r]=e}))})),r&&Object.entries(n).forEach((function(e){var t=(0,g.Z)(e,2),a=t[0],o=t[1];n[a]=Di(o,-r.row,-r.col)})),n}},{key:"splitRefNode",value:function(e,t,r){var n,a=null!==(n=e.split.get(t))&&void 0!==n?n:new Set;a.add(r),e.split.set(t,a)}},{key:"addRefNode",value:function(e,t,r,n){var a,o=null!==(a=t.add.get(r))&&void 0!==a?a:[];t.add.set(r,o),o.push(n),this.updateFormulaRefs(e,n,r.refMap)}},{key:"updateFormulaRefs",value:function(e,t,r){var n=this;r&&aF(e,t,(function(e,t,a){n.formulaRefManager.updateFormulaRefMap(a,r)}))}},{key:"translateFormulaMountRef",value:function(e,t,r,n){var a=this;t=xi(t,n.row,n.col),aF(e,t,(function(t,n,o){a.formulaRefManager.moveFormulaLocation(e,o,r)}))}}]),e}();!function(e){e.FormulaRefChanged="FormulaRefChanged"}(F1||(F1={}));var W1=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this))).formulaRefService=e,r.eventWatcher=new Ce.CPL,r.depRefChangeFormulas=new Set,r.moveRangeService=new z1((0,c.Z)(r),e),r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setSpread",value:function(e){this.spread=e}},{key:"updateFormulaRefMap",value:function(e,t){this.onDepRefChanged(e,t),this.depRefChangeFormulas.add(e)}},{key:"moveFormulaLocation",value:function(e,t,r){var n,a=t.getRef(),o=a.hostId;a.onOp(r);var i=a.hostId;null===(n=a.sheet())||void 0===n||n.getCalcEngine().moveFormulaCrossSheet(t,o,i)}},{key:"flushGraphEffect",value:function(){(0,f.Z)((0,v.Z)(t.prototype),"flushGraphEffect",this).call(this),this.tigerFormulaRefChanged()}},{key:"collectRecoverFmlAndRef",value:function(e,t){var r=this,n=e.id(),a=e.name(),o=this.getInvalidNodesBySheetInfo(n,a);o&&(o.forEach((function(o){var i=!1,u=o.data.refMap,s=o.ref;if(r.formulaRefService.formulaRefPool.updateRefMap(o.data,(function(t){return t&&Object.values(t).forEach((function(t){t.hostName!==a&&t.hostId!==n||(i=!0,t.setSheet(e),t.hostId=n,t.hostName=void 0,r.formulaRefService.refMapMgr.onRangeChange(t),t.onDataChanged(),r.dropInvalidSheetDepIdMap(n,a))})),t})),s.hostId&&s.hostId!==n){var l=r.spread.getSheetFromId(s.hostId);if(i&&l){var c=s.hostId;if(c){var h=r.getGraphEffectBySheetId(c);h.del.add(o),r.graphEffectAddNewItem(h,o.data,s)}aF(l,s,(function(e,n,a){t.add(a),r.onDepHostChanged(l.id(),s,a,u),r.depRefChangeFormulas.add(a)}))}}})),this.flushGraphEffect())}},{key:"subscribeEvents",value:function(e,t){return this.eventWatcher.subscribe(e,t)}},{key:"tigerFormulaRefChanged",value:function(){this.depRefChangeFormulas.size&&(this.eventWatcher.dispatch(F1.FormulaRefChanged,this.depRefChangeFormulas),this.depRefChangeFormulas.clear())}},{key:"getDepRangeAndReference",value:function(e,t){var r=t.refMap,n=[];if(!r)return n;var a=new Map;for(var o in r){var i=r[o],u=Ni(i)?Qi.fromGridRange(wi(e,i)):null;u&&!Ci(u)&&(u=null);var s=i.hash(),l={idx:o,ref:i},c=a.get(s);if(c)c.references.push(l);else{var h={depRange:u,references:[l]};n.push(h),a.set(s,h)}}return n}},{key:"checkRefNodeLikely",value:function(e,t){return this.formulaRefService.formulaRefPool.equals(e,t)}},{key:"getNewRelativeChangedNode",value:function(e,t){return this.formulaRefService.formulaRefPool.add({formula:e.formula,refMap:t})}},{key:"updateRefs",value:function(e,t,r){var n=this,a=e.ref.hostId,o=this.spread.getSheetFromId(a);if(!o)throw new Error("formula ref manager: updateRefs failed, no sheet ".concat(a," found"));aF(o,t,(function(e,t,a){n.updateFormulaRefMap(a,r.refMap);var o=a.getRef();o.startRow!==e&&o.setRowFrom(e),o.startCol!==t&&o.setColFrom(t)}))}},{key:"getRelativeCache",value:function(){return this.formulaRefService.refMapMgr.relativeCache}},{key:"disconnectRefNodeHostInfo",value:function(e,t,r,n){var a=this;this.formulaRefService.formulaRefPool.updateRefMap(t.data,(function(e){return e&&Object.values(e).forEach((function(e){var t;e.hostId===n&&(e.hostName=null==e||null===(t=e.sheet())||void 0===t?void 0:t.name(),e.hostId=void 0,a.formulaRefService.refMapMgr.onRangeChange(e),e.setSheet(null),e.onDataChanged())})),e})),r.add(t)}},{key:"handleSheetRename",value:function(e,t){this.getInvalidNodesBySheetName(e).forEach((function(e){t.push(e.ref)}))}},{key:"handleSheetRemovedRef",value:function(e,t,r){var n=this,a=this.getInvalidSheetDepByName(t),o=this.getTreeBySheetIdAndType(e,0),i=this.getTreeBySheetIdAndType(e,1);i&&this.relationDisconnect(i,e,0,(function(e,t,r){var a=e.ref.hostId,o=t.ref.hostId,i=n.getInvalidSheetDepById(a)||n.createInvalidSheetDepById(a),u=n.getInvalidMountNodeSet(o);i.add(o),n.disconnectRefNodeHostInfo(r,t,u,a);var s=n.spread.getSheetFromId(o);s&&aF(s,t.ref,(function(e,r,a){n.onDepHostChanged(o,t.ref,a,t.data.refMap),n.depRefChangeFormulas.add(a)}))})),o&&this.relationDisconnect(o,e,1),this.flushTreeEffect(),this.removeRefTree(e),this.getInvalidNodesBySheetId(e).forEach((function(e){r.push(e.ref);var o=e.ref.hostId;o&&(a||(a=n.createInvalidSheetDepByName(t)),a.add(o))})),this.tigerFormulaRefChanged()}},{key:"onDepHostChanged",value:function(e,t,r,n){r.setRefMap(n)}},{key:"onDepRefChanged",value:function(e,t){e.setRefMap(t)}},{key:"handleCoverSnapshot",value:function(){this.refTree.clear(),this.resetGraphEffect(),this.resetTreeEffect(),this.resetInvalidEffect()}},{key:"handleCoverSheet",value:function(e,t){var r=this.getTreeBySheetIdAndType(e,0),n=this.getTreeBySheetIdAndType(e,1);r&&this.relationDisconnect(r,e,1),n&&this.relationDisconnect(n,e,0,(function(e,r,n){t.push(r.ref)})),this.flushTreeEffect()}},{key:"handleLoadSheet",value:function(e,t){var r=this,n=this.getGraphEffectBySheetId(e);t.length&&(t.forEach((function(e){var t=(0,g.Z)(e,3),a=t[0],o=t[1],i=t[2],u=r.formulaRefService.formulaRefPool.add({formula:a,refMap:o});n.add.set(u,i)})),this.createRefTree(e),this.flushGraphEffect())}},{key:"getNodeCount",value:function(e,t){var r=0;if(void 0===t&&(t=0),void 0===e)this.refTree.forEach((function(e){r+=e[0===t?"mount":"dep"].getSize()}));else{var n=this.getTreeBySheetIdAndType(e,t);n&&(r=n.getSize())}return r}},{key:"checkRefNodePosition",value:function(){var e=this,t=[];return this.refTree.forEach((function(r,n){r.mount.all().forEach((function(r){var a=r.ref,o=e.spread.getSheetFromId(a.hostId||"");if(a.hostId&&o){var i={errorType:"position",sheetId:n,nodeRef:a.toGridRange(),errorFormula:[]};aF(o,a,(function(e,t,r){var n=r.getRef();n.startRow===e&&n.startCol===t||i.errorFormula.push({expected:{row:e,col:t},current:{row:n.startRow,col:n.startCol},id:r.getId(),hasRefMap:Boolean(r.getRefMap())})})),i.errorFormula.length&&t.push(i)}else t.push({errorType:"sheetId",sheetId:n,nodeRef:a.toGridRange(),errorFormula:[]})}))})),t}},{key:"excludeFormulaInTree",value:function(e,t,r){var n=this.getTreeBySheetIdAndType(e,0);if(n){var a=this.spread.getSheetFromId(e);a&&n.all().forEach((function(e){var n=e.ref;aF(a,n,(function(e,r,n){var a=n.getRef();a.startRow===e&&a.startCol===r&&t.delete(n)}),(function(e,t,n){r.push({row:e,col:t,type:n.type})}))}))}}},{key:"destroy",value:function(){this.depRefChangeFormulas.clear(),(0,f.Z)((0,v.Z)(t.prototype),"destroy",this).call(this),this.eventWatcher.destroy()}}]),t}(H1),G1=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getDepends",value:function(e){for(var t=[],r=this.getDepRefsByMountRef(e),n=0;n<r.length;++n)t.push.apply(t,r[n].refs);return t}},{key:"updateDynamicRefs",value:function(e,t,r){var n,a;if(t.sheet?a=t.sheet():(n=e.getFormulaService().spread)&&(a=Ps(n,t)),a){n||(n=a.getParent());var o=new Set,i={},u=0;if(r){u=r.length;for(var s=0,l=0;s<u;++s){var c=r[s],h=c.sheet?c.sheet():Ps(n,c);if(h){var f=Eu(Qi.fromGridRange(ki(t,c)),h),d=f.hash(!1,!0);o.has(d)||(i["R"+ ++l]=f,o.add(d))}}}var v,p=a.id(),m=this.searchRefNodesInTree(p,t,0)||[];if(u||m.length)if(u>0&&(i=this.formulaRefService.refMapMgr.add(i)),!(m.length>0&&i===m[0].data.refMap))u>0&&(v=new qd).set(t.startRow,t.startCol,this.formulaRefService.formulaRefPool.add({formula:e.formula,refMap:i})),this.onRangeValueChanged(p,[t],v)}}},{key:"onDepHostChanged",value:function(e,t,r,n){this.updateCustomDeps(r,n)}},{key:"onDepRefChanged",value:function(e,t){this.updateCustomDeps(e,t)}},{key:"updateCustomDeps",value:function(e,t){e.registerCustomDepends(t?Object.keys(t).sort().map((function(r){return ku(t[r],e.getRef())})):null)}},{key:"moveFormulaLocation",value:function(e,t,r){}},{key:"handleSheetRename",value:function(e,t){var r;null===(r=this.getTreeBySheetIdAndType(e,1))||void 0===r||r.all().forEach((function(e){e.iterRelations((function(e){null!==e&&t.push(e.ref)}))}))}}]),t}(W1);function j1(e,t){eu.prototype.onOp.call(e,t)}!function(e){e[e.Mount=0]="Mount",e[e.Dep=1]="Dep"}(Z1||(Z1={})),function(e){e.Mount="mount",e.Dep="dep"}(x1||(x1={})),function(e){e[e.Edit=0]="Edit",e[e.VisibleChanged=1]="VisibleChanged",e[e.Load=2]="Load",e[e.Recover=3]="Recover"}(D1||(D1={})),function(e){e[e.None=0]="None",e[e.Dep=1]="Dep",e[e.Mount=2]="Mount",e[e.ALL=3]="ALL"}(P1||(P1={}));var Y1=function(){function e(){(0,y.Z)(this,e),this.uuid=0,this.refTree=new Map,this.callbackMap=new Map,this.recoverMap=new Map}return(0,_.Z)(e,[{key:"watchRef",value:function(e,t,r,n,a){var o=this,i=this.getRTree(e),u={dirtyCallback:t,validateOp:r,afterRefOp:n,recoverSheet:a};this.callbackMap.set(this.uuid,u);var s={ref:e,id:this.uuid++};return i.insert(s),function(){o.callbackMap.delete(s.id),i.remove(s)}}},{key:"watchRefs",value:function(e,t,r,n){var a=this,o={dirtyCallback:t,validateOp:r,afterRefOp:n},i=this.uuid++;this.callbackMap.set(i,o);var u=e.map((function(e){var t=a.getRTree(e),r={ref:e,id:i};return t.insert(r),r}));return function(){a.callbackMap.delete(i),u.forEach((function(e){var t=a.refTree.get(e.ref.hostId);t&&t.remove(e)}))}}},{key:"getRTree",value:function(e){var t=this.refTree,r=e.hostId;void 0===r&&(t=this.recoverMap,r=e.hostName);var n=t.get(r);return n||(n=new VT,t.set(r,n)),n}},{key:"search",value:function(e){var t=this.refTree.get(e.hostId);return t?t.search(e):[]}},{key:"onRefOp",value:function(e){var t=this;if("DelSheetOp"!==e.type()){var r=e.effectedRef();if("MoveRangeOp"===e.type()||r.length>1)this.moveRange(e,r);else{var n=[],a=new Set,o=r[0],i=this.refTree.get(o.hostId);if(i){i.search(o,n);for(var u=0;u<n.length;u++){var s,l,c=n[u],h=this.callbackMap.get(c.id);!1!==(null==h||null===(s=h.validateOp)||void 0===s?void 0:s.call(h,c.ref,e))?(i.remove(c),j1(c.ref,e),null!=h&&null!==(l=h.afterRefOp)&&void 0!==l&&l.call(h,c.ref,e),(null==h?void 0:h.dirtyCallback)&&a.add(c.id)):n.splice(u--,1)}i.insertItems(n),a.forEach((function(r){var n,a;null===(n=t.callbackMap.get(r))||void 0===n||null===(a=n.dirtyCallback)||void 0===a||a.call(n,e)}))}}}else this.delSheet(e)}},{key:"moveRange",value:function(e,t){var r=this,n=new Map,a=new Set;t.forEach((function(e){r.search(e).forEach((function(e){if(e.ref.hostId){var t=n.get(e.ref.hostId);t||(t=new Set,n.set(e.ref.hostId,t)),t.add(e)}}))})),n.forEach((function(t,n){var o=r.refTree.get(n);o&&t.forEach((function(t){var n,i,u=r.callbackMap.get(t.id);if(!1!==(null==u||null===(n=u.validateOp)||void 0===n?void 0:n.call(u,t.ref,e))){o.remove(t);var s=t.ref.hostId;j1(t.ref,e),null!=u&&null!==(i=u.afterRefOp)&&void 0!==i&&i.call(u,t.ref,e),null!=u&&u.dirtyCallback&&a.add(t.id),t.ref.hostId===s?o.insert(t):r.getRTree(t.ref).insert(t)}}))})),a.forEach((function(n){var a,o;null===(a=r.callbackMap.get(n))||void 0===a||null===(o=a.dirtyCallback)||void 0===o||o.call(a,e,void 0,t)}))}},{key:"delSheet",value:function(e){var t=this,r=e.getSheet().id(),n=this.refTree.get(r);if(n){var a=new Set,o=n.all();this.recoverMap.set(e.getSheet().name(),n),o.forEach((function(r){var o,i,u=t.callbackMap.get(r.id);!1!==(null==u||null===(o=u.validateOp)||void 0===o?void 0:o.call(u,r.ref,e))?(j1(r.ref,e),null!=u&&null!==(i=u.afterRefOp)&&void 0!==i&&i.call(u,r.ref,e),(null==u?void 0:u.dirtyCallback)&&a.add(r.id)):n.remove(r)})),a.forEach((function(r){var n,a;null===(n=t.callbackMap.get(r))||void 0===n||null===(a=n.dirtyCallback)||void 0===a||a.call(n,e)})),this.refTree.delete(r)}}},{key:"recoverRef",value:function(e){var t=this,r=e.name(),n=this.recoverMap.get(r);if(n){var a=new Set,o=new Map;this.recoverMap.delete(r),this.refTree.set(e.id(),n),n.all().forEach((function(r){r.ref instanceof eu&&r.ref.setSheet(e),o.set(r.id,r.ref);var n=t.callbackMap.get(r.id);(null==n?void 0:n.dirtyCallback)&&a.add(r.id)})),a.forEach((function(r){var n,a,i=t.callbackMap.get(r);null==i||null===(n=i.dirtyCallback)||void 0===n||n.call(i,void 0,{dirtySource:D1.Recover});var u=o.get(r);u&&(null==i||null===(a=i.recoverSheet)||void 0===a||a.call(i,u,e))}))}}},{key:"markDirtyCompleted",value:function(e,t,r){var n=this,a=new Set;e.forEach((function(e){a.add(e.id)})),a.forEach((function(e){var a,o;null===(a=n.callbackMap.get(e))||void 0===a||null===(o=a.dirtyCallback)||void 0===o||o.call(a,void 0,r,t)}))}},{key:"destroy",value:function(){this.refTree.clear(),this.callbackMap.clear()}}]),e}(),q1=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"conditionMarkDirtyCompleted",value:function(e){var t,r=yr(e.entries());try{for(r.s();!(t=r.n()).done;){var n,a,o=(0,g.Z)(t.value,2),i=o[0].id,u=o[1];null===(n=this.callbackMap.get(i))||void 0===n||null===(a=n.dirtyCallback)||void 0===a||a.call(n,void 0,{},u)}}catch(e){r.e(e)}finally{r.f()}}}]),t}(Y1),J1=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,void 0,{ignoreSplit:!0}))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"addRuleRanges",value:function(e,t){var r=this;return this.getGraphEffectBySheetId(e.getSheetId()).add.set(e,t),this.flushGraphEffect(),t.map((function(t){for(var n=r.getDepRefsByMountRef(t),a=0;a<n.length;a++){var o=n[a].node;if(o.data===e)return o}})).filter(Boolean)}},{key:"removeRuleRanges",value:function(e,t){var r=this.getGraphEffectBySheetId(e.getSheetId());t.forEach((function(e){r.del.add(e)})),this.flushGraphEffect()}},{key:"getDepRangeAndReference",value:function(e,t){e=e.clone();var r=[];if(!(t instanceof wb))return r.push({depRange:e,references:[{idx:"R1",ref:Qi.fromGridJSON({startCol:0,startRow:0,endCol:1,endRow:1,sheetId:e.hostId})}]}),r;var n=t.getFormulaVar(),a=null==n?void 0:n.getRefMap();if(!a)return r;for(var o in a){var i=a[o],u=ku(i,e),s=e.clone();s.startRow=s.endRow-1,s.startCol=s.endCol-1;var l=ku(i,s),c={depRange:Qi.fromGridRange(u.union(l)),references:[{idx:o,ref:i}]};r.push(c)}return r}},{key:"checkRefNodeLikely",value:function(e,t){return!1}},{key:"getNewRelativeChangedNode",value:function(e,t){return e}},{key:"getRelativeCache",value:function(){return{}}},{key:"updateRefs",value:function(e,t,r){}},{key:"disconnectRefNodeHostInfo",value:function(e,t,r,n){}}]),t}(H1);!function(e){e.RangeMarkDirtyFinish="RangeMarkDirtyFinish"}($1||($1={}));var K1=hv(lv),X1=hv(Up),Q1=function(){function e(t,r){var n=this;(0,y.Z)(this,e),this.workbook=t,this.formulaRefService=new B1(this),this.precisionOps={Add:null,Sub:null},this.parenOperator=null,this.InvokeFunctionOperator=null,this.statistics=new mF,this.cfmStatistics=new _F,this.pivotStatistics=new RF,this.prefixes=null,this.subscriber=null,this.formulaIdCounter=new Map,this.formulaIdMap=new Map,this.formulaRefManager=new W1(this.formulaRefService),this.dynamicRefManager=new G1(this.formulaRefService),this.depRefManager=new Y1,this.conditionDependencyRefManager=new q1,this.conditionRefManager=new J1,this.loadSheetMarked=new Set,this.errors=null,this.conditionalDirtyFormulas=new Set,this.markDirtyCacheOptimize=!1,this.calcEventWatcher=new Ce.CPL,this.disabledMarkDirty=!1,this.handleSheetRemoved=function(e){var t=e.sheet,r=[],a=t.id(),o=t.name();n.formulaRefManager.handleSheetRemovedRef(a,o,r),n.dynamicRefManager.handleSheetRemovedRef(a,o,r),n.markDirty(r)},this.handleSheetAdded=function(e){var t=e.sheet;n.buildSheetFormulaReferences(t.id()),n.markAlwaysCalcDirty()},this.handleCoverSheet=function(e,t){var r=[];n.formulaRefManager.handleCoverSheet(t.id(),r),n.dynamicRefManager.handleCoverSheet(t.id(),r),n.buildSheetFormulaReferences(t.id()),n.markDirty(r)},this.handleCoverSnapshot=function(){n.formulaRefManager.handleCoverSnapshot(),n.dynamicRefManager.handleCoverSnapshot(),n.buildSheetFormulaReferences()},this.handleFormulaCacheApplyed=function(e){n.statistics.isFirstApplyResult||n.statistics.onFirstApplyResult(e.size);var t=[];e.forEach((function(e){t.push(e.getRef())})),n.markDepRefDirty(t)},this.markAlwaysCalcDirty=function(){n.markDirty([])},this.dirtyArrayRefs=[],this.handleDataChanged=function(e){var t=e.range,r=e.type,a=e.changedRanges,o=e.formulaCellMap,i=t.sheet();if(i&&(a||o)){var u=i.id();n.formulaRefManager.onRangeValueChanged(u,a,o),n.dynamicRefManager.onRangeValueChanged(u,a)}0!==r&&n.markDirty([t])},this.handleMoveRange=function(e){var t,r=e.fromRange,a=e.toRange,o=e.toEdgeAdjust;n.markDirty([r,a]);var i=new pu(r,a.sheet(),a.rowFrom(),a.colFrom());o&&i.setShouldAdjustToEdge(!!o),n.formulaRefManager.moveRangeService.moveRange(i),n.dynamicRefManager.moveRangeService.moveRange(i),n.depRefManager.onRefOp(i),n.conditionDependencyRefManager.onRefOp(i),null===(t=a.sheet())||void 0===t||t.conditionalFormatModel.reInitRules()},this.handleOutlineStateChanged=function(e){var t=e.range,r=t.sheet();r&&t.colCount()===r.getColumnCount()&&n.markAlwaysCalcDirty()},this.handleFormulaRegistered=function(e){var t=e.getRef(),r=t.sheet();t.isValid()&&(n.addFormulaToSheet(e,r.id()),n.statistics.isModuleInit||"number"!=typeof e.getId()||n.statistics.initModule())},this.handleFormulaUnregistered=function(e){var t=e.getRef(),r=t.sheet();if(t.isValid()){var a=r.id();n.removeFormulaFromSheet(e,a)}if(null!=n.workbook){var o=n.workbook,i=o.importRangeManager,u=o.importRangeManagerV3;dv(e)&&(e.getExternalDataReferenceInfo()?i.clearMetaAndData(e):u.V3Enable&&u.delFormula(e))}},this.compiler=new Gk(this),this.formulaService=new dF(this,t,r),t&&(this.pivotCalculateEngine=new VF(this,t)),this.initFuncCache(),this.bindEvents(),this.bindWorkbookEvents(),this.formulaService.getFormulaStack().setMaxStackSize(128),t&&(this.formulaRefManager.setSpread(t),this.dynamicRefManager.setSpread(t))}return(0,_.Z)(e,[{key:"isCalcDone",value:function(){if(void 0!==this.isDone)return this.isDone;var e=this.formulaSpace.dirtyFormulas.size,t=this.formulaService.getCalculatingAsyncFormulas().size;return 0===e&&0===t}},{key:"setCalcDone",value:function(e){this.isDone=e}},{key:"getFormulaFromId",value:function(e,t){var r;return null===(r=this.formulaIdMap.get(e))||void 0===r?void 0:r.get(t)}},{key:"getSheetFormulaCount",value:function(e){var t;return(null===(t=this.formulaIdMap.get(e))||void 0===t?void 0:t.size)||0}},{key:"getFuncStatistics",value:function(){return this.compiler.builder.getFuncStatistics()}},{key:"initFuncCache",value:function(){this.formulaService.getFuncCacheManager().registerInnerCache("AI",new L1("AI"))}},{key:"createFormula",value:function(e,t){var r=t.refMap,n=void 0===r?null:r,a=t.enableCalculation,o=void 0===a||a,i=t.formula,u=t.isArrayFormula;void 0===u&&(null!=i.expression?u=ld(i.expression):null!=i.serialization&&(u=cd(i.serialization)));var s=new(u?o?Up:X1:o?lv:K1)(this.formulaService,e,{formula:i});if(null!==n&&(s.setRefMap(n),this.workbook))for(var l in n){var c=n[l].sheet(),h=null==c?void 0:c.id();h&&!this.loadSheetMarked.has(h)&&(this.workbook.detectWorksheet(c),this.loadSheetMarked.add(h))}return s}},{key:"serializeFormula",value:function(e,t,r){return Tp(e,t,r)}},{key:"deserializeFormula",value:function(e,t,r,n){var a,o=null===(a=null==r?void 0:r.enableCalculation)||void 0===a||a;return zk(e,t,this.formulaRefService,Object.assign({},r,{enableCalculation:o}),n)}},{key:"unregisterFormulas",value:function(e){var t=[];this.formulaSpace.formulas.forEach((function(r){r.getRef().sheet()===e&&t.push(r)}));for(var r=0;r<t.length;r++)this.formulaSpace.unRegisterFml(t[r])}},{key:"recoverInvalidRefs",value:function(e){var t=new Set;this.formulaRefManager.collectRecoverFmlAndRef(e,t),this.dynamicRefManager.collectRecoverFmlAndRef(e,t),this.depRefManager.recoverRef(e),this.conditionDependencyRefManager.recoverRef(e);var r,n=[],a=yr(t);try{for(a.s();!(r=a.n()).done;){var o=r.value.getRef();n.push(o)}}catch(e){a.e(e)}finally{a.f()}n.length&&this.markDirty(n)}},{key:"compile",value:function(e,t){return this.compiler.compile(e,t)}},{key:"compileTokens",value:function(e){return this.compiler.compileTokens(e)}},{key:"decompile",value:function(e,t){return kp(e,t)}},{key:"dispose",value:function(){var e,t;this.unbindEvents(),this.calcEventWatcher.destroy(),null!==(e=this.subscriber)&&void 0!==e&&e.unsubscribe(),this.subscriber=null,this.loadSheetMarked.clear(),this.formulaService.getBinaryOpManager().clear(),this.formulaService.getFunctionOpManager().clear(),this.formulaService.getPrefixUnaryOpManager().clear(),this.formulaService.getSuffixUnaryOpManager().clear(),this.formulaService.getFuncCacheManager().dispose(),sf.dispose(),nw.dispose(),Of.dispose(),Zf.dispose(),xf=null,Df=null,Lf=null,Bf=null,Hf=null,zf=null,this.formulaService.dispose(),yG=null,RG=null,WG=null,this.destroyRefCache(),null===(t=this.pivotCalculateEngine)||void 0===t||t.dispose()}},{key:"destroyRefCache",value:function(){this.formulaRefService.destroy(),this.formulaRefManager.destroy(),this.dynamicRefManager.destroy(),this.depRefManager.destroy(),this.conditionDependencyRefManager.destroy(),this.conditionRefManager.destroy(),this.formulaIdCounter.clear(),this.formulaIdMap.clear()}},{key:"bindWorkbookEvents",value:function(){var e;this.subscriber=(null===(e=this.workbook)||void 0===e?void 0:e.subscribe(this.getWorkbookEvents()))||null}},{key:"getWorkbookEvents",value:function(){return{FormatterChanged:this.handleDataChanged,RangeChanged:this.handleDataChanged,Sort:this.handleDataChanged,MoveRange:this.handleMoveRange,RowVisible:this.markAlwaysCalcDirty,RowAdded:this.handleRowColAddedOrDeleted.bind(this,"add",!0),RowDeleted:this.handleRowDeleted.bind(this),ColumnAdded:this.handleRowColAddedOrDeleted.bind(this,"add",!1),ColumnDeleted:this.handleRowColAddedOrDeleted.bind(this,"delete",!1),OutlineStateChanged:this.handleOutlineStateChanged,CoverSheet:this.handleCoverSheet,Renamed:this.handleSheetRenamed.bind(this),SheetMoved:this.markAlwaysCalcDirty,SheetRemoved:this.handleSheetRemoved,SheetAdded:this.handleSheetAdded,CoverSnapshot:this.handleCoverSnapshot,FormulaCacheApplied:this.handleFormulaCacheApplyed}}},{key:"handleSheetRenamed",value:function(e){var t=e.sheet,r=[];this.formulaRefManager.handleSheetRename(t.name(),r),this.dynamicRefManager.handleSheetRename(t.id(),r),this.markDirty(r)}},{key:"buildSheetFormulaReferences",value:function(e){if(this.workbook){var t=this.formulaRefService.flushRanges(e);if(t)for(var r=Object.entries(t),n=0;n<r.length;n++){var a=(0,g.Z)(r[n],2),o=a[0],i=a[1],u=this.workbook.getSheetFromId(o);if(u&&i.length){var s=this.groupSimilarFormulaTuples(i,u);this.formulaRefManager.handleLoadSheet(o,s)}}}}},{key:"groupSimilarFormulaTuples",value:function(e,t){var r,n=[],a=yr(e);try{var o=function(){var e,a=(0,g.Z)(r.value,2),o=a[0],i=a[1],u=new Map,s=yr(i);try{for(s.s();!(e=s.n()).done;){var l=e.value,c=t.getVar(l.startRow,l.startCol);if(c instanceof lv){var h,f=c.getRefMap(),d=null!==(h=u.get(f))&&void 0!==h?h:[];u.set(f,d),d.push(Qi.fromGridRange(l))}}}catch(e){s.e(e)}finally{s.f()}for(var v=Array.from(u).map((function(e){var t=(0,g.Z)(e,2),r=t[0],n=t[1];return[o,r,n]})),p=0;p<v.length;p++)n.push(v[p])};for(a.s();!(r=a.n()).done;)o()}catch(e){a.e(e)}finally{a.f()}return n}},{key:"getConditionalDirtyRanges",value:function(e){for(var t=this.conditionRefManager.getMountRefsByDepRef(e),r=[],n=0;n<t.length;++n)for(var a=t[n].refs,o=0;o<a.length;++o)r.push(a[o]);return this.conditionRefManager.getDepRefsByMountRef(e).length>0&&r.push(e),r}},{key:"markDirty",value:function(e,t){var r,n=this;if(this.formulaService.globalCtx=void 0,!this.disabledMarkDirty){var a=Date.now(),o=new wc,i=e.slice(),u=new Set,s=[],l=new Set,c=null==t||null===(r=t.validator)||void 0===r?void 0:r.validateFn;for((null===(h=null==t?void 0:t.isDirtyAlwaysCalc)||void 0===h||h)&&this.addAlwaysCalcRange(i);i.length;){var h,f,d=i.pop();if(d.hostId){var v=null===(f=this.workbook)||void 0===f?void 0:f.getSheetFromId(d.hostId);if(v){var p=$i(d,v);if(Ci(p))for(var m=o.splitAndAdd(p),y=0,_=m.length;y<_;y++){var R=m[y];(0,Ce.hTd)(s,this.getConditionalDirtyRanges(R)),aF(v,R,(function(e,t,r){c&&!c(r)||r.markDirty()}));var C=this.formulaRefManager.getMountRefsByDepRef(R).concat(this.dynamicRefManager.getMountRefsByDepRef(R));if(this.depRefManager.search(R).forEach((function(e){u.add(e)})),C.length){for(var w=new Map,E=0;E<C.length;++E)for(var k=C[E],T=k.refs,S=k.relatives,A=k.node,I=0;I<T.length;++I){var O,V=T[I],N=A.ref,b=S[I],M=V.hostId,F=null===(O=this.workbook)||void 0===O?void 0:O.getSheetFromId(M);if(F){var Z="";if(this.markDirtyCacheOptimize){var x=yi(b),D=_i(b);if(x||D){var P=Ko(N,R);Z=x?"".concat(M,"_").concat(P.startRow,"_").concat(P.endRow,"_").concat(b.hash()):"".concat(M,"_").concat(P.startCol,"_").concat(P.endCol,"_").concat(b.hash())}if(Z&&l.has(Z))continue}var $=w.get(M);$||($=new Map,w.set(M,$));var L=$.get(b);L||(L=[[],Z],$.set(b,L)),L[0].push(Eu(V,F))}}w.forEach((function(e,t){var r;if(null===(r=n.workbook)||void 0===r?void 0:r.getSheetFromId(t))if(n.markDirtyCacheOptimize){var a=[];e.forEach((function(e,t){for(var r=(0,g.Z)(e,2),n=r[0],o=r[1],i=a2(n),u=0;u<i.length;++u)a.push(i[u]);o&&l.add(o)}));for(var o=a2(a),u=0;u<o.length;++u)i.push(o[u])}else e.forEach((function(e,t){var r=(0,g.Z)(e,1)[0];r.sort((function(e,t){return e.startRow!==t.startRow?e.startRow-t.startRow:e.startCol-t.startCol}));var n=[];r.forEach((function(e){n2(n,e)}));for(var a=0;a<n.length;++a)i.push(n[a])}))}))}}}}}this.formulaService.getFuncCacheManager().clear(),this.depRefManager.markDirtyCompleted(u,e,t),this.notifySheetConditionDirty(s),this.calcEventWatcher.dispatch($1.RangeMarkDirtyFinish,e,{duration:Date.now()-a}),this.formulaSpace.dirtyFormulas.size&&this.formulaSpace.emit(it.FormulaSpaceEvents.onBatchFormulasDirty,this.formulaSpace.dirtyFormulas)}}},{key:"notifySheetConditionDirty",value:function(e){var t=this,r=(0,M.Z)(e,(function(e){return e.hostId}));Object.entries(r).forEach((function(e){var r,n=(0,g.Z)(e,2),a=n[0],o=n[1],i=null===(r=t.workbook)||void 0===r?void 0:r.getSheetFromId(a);i&&i.conditionalFormatModel.markRangeDirty(o.map((function(e){return(e=$i(e=e.clone(),i)).status=0,Eu(e,i)})))}))}},{key:"arrayFormulaExpand",value:function(e){var t=this;0===this.dirtyArrayRefs.length&&Promise.resolve().then((function(){t.markDirtyAfterCalc()})),this.dirtyArrayRefs.push(e)}},{key:"markDirtyAfterCalc",value:function(){var e=this;if(0!==this.dirtyArrayRefs.length){for(var t=[],r=new Set,n=[],a=function(a,o){var i=e.dirtyArrayRefs[a];(0,Ce.hTd)(n,e.getConditionalDirtyRanges(i));for(var u=e.formulaRefManager.getMountRefsByDepRef(i).concat(e.dynamicRefManager.getMountRefsByDepRef(i)),s=0;s<u.length;++s)for(var l=u[s].refs,c=0;c<l.length;++c){var h=l[c];t.push(h)}e.depRefManager.search(i).forEach((function(e){e.ref!==i&&r.add(e)}))},o=0,i=this.dirtyArrayRefs.length;o<i;o++)a(o);this.depRefManager.markDirtyCompleted(r,this.dirtyArrayRefs),this.notifySheetConditionDirty(n),this.markDirty(t,Bs),this.dirtyArrayRefs.length=0}}},{key:"addAlwaysCalcRange",value:function(e){var t,r=new Map,n=yr(this.formulaSpace.getAlwaysCalcFormulas());try{for(n.s();!(t=n.n()).done;){var a,o=(0,g.Z)(t.value,2),i=o[0],u=yr(o[1]);try{for(u.s();!(a=u.n()).done;){if(a.value.shouldMarkDirty()){var s=i.getRef(),l=s.hostId,c=r.get(l);c||(c=new TB,r.set(l,c)),c.add(s);break}}}catch(e){u.e(e)}finally{u.f()}}}catch(e){n.e(e)}finally{n.f()}r.forEach((function(t){t.forEach((function(t){e.push(t)}))}))}},{key:"markDepRefDirty",value:function(e,t){for(var r=e.slice(),n=new Set;r.length;){var a,o=r.pop();(null===(a=this.workbook)||void 0===a?void 0:a.getSheetFromId(o.hostId))&&this.depRefManager.search(o).forEach((function(e){n.add(e)}))}this.depRefManager.markDirtyCompleted(n,e,t)}},{key:"handleRowColAddedOrDeleted",value:function(e,t,r,n){for(var a=new Set,o=n.id(),i=0,u=r.length;i<u;i++){var s=r[i],l=s.target,c=s.count,h=new vu(t,e,l,c,n);this.formulaRefManager.onRowColAddOrDelete(o,h,a),this.dynamicRefManager.onRowColAddOrDelete(o,h,a),this.conditionRefManager.onRowColAddOrDelete(o,h,a),this.depRefManager.onRefOp(h),this.conditionDependencyRefManager.onRefOp(h)}n.conditionalFormatModel.reInitRules(),this.markDirty(Array.from(a))}},{key:"handleRowDeleted",value:function(e,t){var r=this;if(0!==e.length){var n=function(e){return e.every((function(e,t,r){return 0===t||r[t-1].target>=e.target+e.count}))}(e),a=new Set,o=t.id();if(n){var i=new fu(e.reverse(),t);this.formulaRefManager.onRowColAddOrDelete(o,i,a),this.dynamicRefManager.onRowColAddOrDelete(o,i,a),this.conditionRefManager.onRowColAddOrDelete(o,i,a),this.depRefManager.onRefOp(i),this.conditionDependencyRefManager.onRefOp(i)}else{e.forEach((function(e){var n=new vu(!0,"delete",e.target,e.count,t);r.formulaRefManager.onRowColAddOrDelete(o,n,a),r.dynamicRefManager.onRowColAddOrDelete(o,n,a),r.conditionRefManager.onRowColAddOrDelete(o,n,a)})),e.sort((function(e,t){return e.target-t.target}));var u=new fu(e,t);this.depRefManager.onRefOp(u),this.conditionDependencyRefManager.onRefOp(u),this.depRefManager.onRefOp(u)}t.conditionalFormatModel.reInitRules(),this.markDirty(Array.from(a))}}},{key:"iterFormulasDependOn",value:function(e,t,r){for(var n=this,a=this.formulaRefManager.getMountRefsByDepRef(e),o=0;o<a.length;o++)for(var i=a[o],u=i.refs,s=i.relatives,l=function(e){var t,a=u[e].hostId;if(!a)return"continue";var o=null===(t=n.workbook)||void 0===t?void 0:t.getSheetFromId(a);if(!o)return"continue";var i=s[e];return aF(o,u[e],(function(e,t,n){return r(n,ku(i,n.getRef()))}))?{v:void 0}:void 0},c=0;c<u.length;c++){var h=l(c);if("continue"!==h&&"object"===(0,R.Z)(h))return h.v}}},{key:"checkFormulaOutBox",value:function(e){var t=this,r=new Map,n=new Map;if(!this.workbook)return{output:r,miss:n};var a=new Map;return this.formulaSpace.formulas.forEach((function(t){var r,n=t.getRef(),o=null===(r=n.sheet())||void 0===r?void 0:r.id();if(o&&!(e&&o!==e||n.startRow<0&&n.startCol<0)){var i=a.get(o);i||(i=new Set,a.set(o,i)),i.add(t)}})),!a.size&&e&&a.set(e,new Set),a.forEach((function(e,a){var o;if(null===(o=t.workbook)||void 0===o?void 0:o.getSheetFromId(a)){var i=[],u=e.size;if(t.formulaRefManager.excludeFormulaInTree(a,e,i),e.size){var s=[];e.forEach((function(e){var t=e.getRef(),r=t.startRow,n=t.startCol;s.push({row:r,col:n,sheetId:a,fmlId:e.getId(),totalCount:u})})),r.set(a,s)}i.length&&n.set(a,i)}})),{output:r,miss:n}}},{key:"bindEvents",value:function(){this.formulaService.addListener(it.FormulaEvents.onFormulaValueChanged,Up.handleValueChanged),this.bindFormulaSpaceEvent()}},{key:"unbindEvents",value:function(){this.formulaService.removeListener(it.FormulaEvents.onFormulaValueChanged,Up.handleValueChanged),this.unbindFormulaSpaceEvent()}},{key:"bindFormulaSpaceEvent",value:function(){this.formulaSpace.addListener(it.FormulaSpaceEvents.onFormulaRegistered,this.handleFormulaRegistered),this.formulaSpace.addListener(it.FormulaSpaceEvents.onFormulaUnregistered,this.handleFormulaUnregistered)}},{key:"unbindFormulaSpaceEvent",value:function(){this.formulaSpace.removeListener(it.FormulaSpaceEvents.onFormulaRegistered,this.handleFormulaRegistered),this.formulaSpace.removeListener(it.FormulaSpaceEvents.onFormulaUnregistered,this.handleFormulaUnregistered)}},{key:"addFormulaToSheet",value:function(e,t){var r,n;pv(e)?n=e.getId():(n=(null!==(r=this.formulaIdCounter.get(t))&&void 0!==r?r:0)+1,this.formulaIdCounter.set(t,n)),e.setId(n);var a=this.formulaIdMap.get(t);void 0===a&&(a=new Map,this.formulaIdMap.set(t,a)),a.set(n,e),this.statistics.add(t,lF.FormulaCount)}},{key:"removeFormulaFromSheet",value:function(e,t){var r;null!==(r=this.formulaIdMap.get(t))&&void 0!==r&&r.delete(e.getId()),this.statistics.sub(t,lF.FormulaCount)}},{key:"moveFormulaCrossSheet",value:function(e,t,r){t!==r&&(this.removeFormulaFromSheet(e,t),this.addFormulaToSheet(e,r))}},{key:"getPrecisionAddOp",value:function(){return null==this.precisionOps.Add&&(this.precisionOps.Add=new iw),this.precisionOps.Add}},{key:"getPrecisionSubOp",value:function(){return null==this.precisionOps.Sub&&(this.precisionOps.Sub=new uw),this.precisionOps.Sub}},{key:"getBinaryOp",value:function(e){var t=this.formulaService.getBinaryOpManager(),r=t.find(e);if(null!=r)return r;var n=t2(e),a=I1.get(n);if(null==a)return null;var o=new a(n);return t.register(o),o}},{key:"getFunctionOp",value:function(e){var t=this.formulaService.getFunctionOpManager(),r=t.find(e);if(null!=r)return r;var n=t2(e),a=N1.get(n);if(null==a)return null;var o=new a(n);return t.register(o),o}},{key:"getSuffixUnaryOp",value:function(e){var t=this.formulaService.getSuffixUnaryOpManager(),r=t.find(e);if(null!=r)return r;var n=t2(e),a=V1.get(n);if(null==a)return null;var o=new a(n);return t.register(o),o}},{key:"getPrefixUnaryOp",value:function(e){var t=this.formulaService.getPrefixUnaryOpManager(),r=t.find(e);if(null!=r)return r;var n=t2(e),a=O1.get(n);if(null==a)return null;var o=new a(n);return t.register(o),o}},{key:"getPrefixFunction",value:function(e){if(""===e)return[];null==this.prefixes&&(this.prefixes=Array.from(N1.keys()).sort());for(var t=[],r=(0,Yt.lowerBound)(this.prefixes,e,(function(e,t){return e<t}));r<this.prefixes.length;r++){var n=this.prefixes[r];if(!n.startsWith(e))break;t.push(n)}return t}},{key:"getParenOp",value:function(){return null===this.parenOperator&&(this.parenOperator=new it.ParenOp),this.parenOperator}},{key:"subscribeEvents",value:function(e,t){return this.calcEventWatcher.subscribe(e,t)}},{key:"getInvokeFunctionOp",value:function(){return null===this.InvokeFunctionOperator&&(this.InvokeFunctionOperator=new gp),this.InvokeFunctionOperator}},{key:"watchConditionalRule",value:function(e,t,r,n){return this.conditionDependencyRefManager.watchRefs(e,t,r,n)}},{key:"watchFormulaRefMap",value:function(e,t,r,n){if(!this.formulaSpace.formulas.has(e)){var a=new Map,o=e.getRefMap(),i=e.getRef();for(var u in o){var s=ku(o[u],i);a.set(s,u)}return this.depRefManager.watchRefs(Array.from(a.keys()),t,r,(function(t,r){var o=a.get(t);if(o){var u=e.getRefMap(),s={};for(var l in u)s[l]=o!==l?u[l]:Tu(t,i);e.setRefMap(s),null==n||n(t,r)}}))}}},{key:"reactivitySpace",get:function(){return this.formulaService.reactivitySpace}},{key:"formulaSpace",get:function(){return this.formulaService.getFormulaSpace()}}]),e}(),e2=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,e,fF))).workbook=e,r.statistics.disableApplyResultReport=!1,r.cfmStatistics.disableApplyResultReport=!1,r.pivotStatistics.disableApplyResultReport=!1,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"markDirty",value:function(e,t){this.formulaService.globalCtx=void 0,this.markDepRefDirty(e,t)}},{key:"compile",value:function(e,t){var r;return t.enableCalculation=null!==(r=t.enableCalculation)&&void 0!==r&&r,this.compiler.compile(e,t)}},{key:"deserializeFormula",value:function(e,t,r,n){var a,o=null!==(a=null==r?void 0:r.enableCalculation)&&void 0!==a&&a;return zk(e,t,this.formulaRefService,Object.assign({},r,{enableCalculation:o}),n)}},{key:"createFormula",value:function(e,r){var n=r.refMap,a=void 0===n?null:n,o=r.enableCalculation,i=void 0!==o&&o,u=r.formula,s=r.isArrayFormula;return(0,f.Z)((0,v.Z)(t.prototype),"createFormula",this).call(this,e,{refMap:a,enableCalculation:i,formula:u,isArrayFormula:s})}}]),t}(Q1);function t2(e){if(e.length<=1)return e;var t=e.trim();return 0===t.length?" ":t}function r2(e){return"function"==typeof e.union&&"function"==typeof e.isUnionable}function n2(e,t){if(r2(t)){for(var r=0;r<e.length;r++)if(t.isUnionable(e[r])){var n=t.union(e[r]);if(null!==n)return void(e[r]=n)}e.push(t)}else e.push(t)}function a2(e){if(e.length<=1)return e;e.sort((function(e,t){return e.startCol!==t.startCol?e.startCol-t.startCol:e.startRow-t.startRow}));var t=[];return e.forEach((function(e){if(0!==t.length){var r=function(e,t){if(!r2(e)||!r2(t))return t;if(!t.isUnionable(e))return t;var r=t.union(e);return null!==r?r:t}(t[t.length-1],e);r===e?t.push(e):t[t.length-1]=r}else t.push(e)})),t}var o2=function(){function e(t){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:50;(0,y.Z)(this,e),this._idle=t,this._taskTime=n,this.taskFnMap=new Map,this.priorityList=[],this.start=!1,this.isTabVisible="visible"===document.visibilityState,this.taskCount={},this.activeSheetId=null,this.forceStopStatus=!1,this.tabChange=function(){r.isTabVisible="visible"===document.visibilityState},this.visibilityWatcher=new Ce.ze4,this.visibilityWatcher.watch(),this.bindEvent()}return(0,_.Z)(e,[{key:"getTaskCount",value:function(e){return this.taskCount[e]||0}},{key:"bindEvent",value:function(){this.visibilityWatcher.on(Ce.zOj,this.tabChange)}},{key:"unbindEvent",value:function(){this.visibilityWatcher.off(Ce.zOj,this.tabChange)}},{key:"add",value:function(e,t){var r=this.taskFnMap.get(e);r||(r=[],this.taskFnMap.set(e,r),this.priorityList.push(e)),r.push(t)}},{key:"updateSheet",value:function(e){this.activeSheetId=e,this.raisePriority(e)}},{key:"raisePriority",value:function(e){if(this.taskFnMap.get(e)){var t=this.priorityList.indexOf(e);-1!==t&&this.priorityList.splice(t,1),this.priorityList.unshift(e)}}},{key:"removePriority",value:function(e){if(!this.taskFnMap.has(e)){var t=this.priorityList.indexOf(e);t>-1&&this.priorityList.splice(t,1)}}},{key:"run",value:function(){var e=this;if(!this.start&&!this.forceStopStatus){this._idle.turnOnIdle(),this._idle.registerIdleCallback((function t(){if(!e.forceStopStatus){var r=e.isTabVisible?e._taskTime:5e3;null!==e.activeSheetId&&e.priorityList[0]!==e.activeSheetId&&e.raisePriority(e.activeSheetId);for(var n=Date.now();Date.now()-n<r&&e.taskFnMap.size;){var a=e.priorityList[0];e.runImmediately(a)}e.taskFnMap.size?e._idle.registerIdleCallback(t,99999):(e._idle.turnOffIdle(),e.start=!1)}}),99999),this.start=!0}}},{key:"runImmediately",value:function(e){var t=this.taskFnMap.get(e);if(t)return 0===t.length?(this.taskFnMap.delete(e),void this.removePriority(e)):void(null==t[0].next()&&t.shift());this.removePriority(e)}},{key:"addSheetAppliedRowCount",value:function(e){this.taskCount[e]=this.getTaskCount(e)+1}},{key:"suspend",value:function(){this.forceStopStatus=!0}},{key:"resume",value:function(){this.forceStopStatus=!1,this.start&&(this.start=!1),this.run()}},{key:"clear",value:function(){this.priorityList.length=0,this.taskCount={},this.taskFnMap.clear(),this.start=!1,this.visibilityWatcher.unwatch(),this.unbindEvent()}}]),e}();function i2(e,t){return e instanceof s2&&(!t||e.blockType===t)}var u2,s2=function(e){function t(e,r,n,a,o,i){var u,s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]&&arguments[7];if((0,y.Z)(this,t),(u=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r,l,n)))._blockId=o,u._isNew=s,u._blockType=a,i)u._blockToken=i,u.getBlockToken=function(){return Promise.resolve(i)};else{var c=new Promise((function(e){u._updateTokenResolve=e}));u.getBlockToken=function(){return c}}return(0,d.Z)(u)}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setBlockToken",value:function(e){return!(this._blockToken||!this._updateTokenResolve||(this._blockToken=e,this._updateTokenResolve(e),delete this._updateTokenResolve,0))}},{key:"toJSON",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,f.Z)((0,v.Z)(t.prototype),"toJSON",this).call(this,e,r);return n.externalResource={blockType:this.blockType,blockToken:this.blockToken,blockId:this.blockId},n}},{key:"sheetType",get:function(){return"blockSheet"}},{key:"isNew",get:function(){return this._isNew}},{key:"blockId",get:function(){return this._blockId}},{key:"blockType",get:function(){return this._blockType}},{key:"blockToken",get:function(){return this._blockToken}}]),t}(zM),l2=function(){function e(){(0,y.Z)(this,e),this.ISVRelationshipMap=new Map}return(0,_.Z)(e,[{key:"initISVRelationshipMap",value:function(e){var t=this;e.forEach((function(e){t.setISVRelationshipData(e)}))}},{key:"setISVRelationshipData",value:function(e,t){var r=e.sheetId,n=e.version,a=e.status,o=this.ISVRelationshipMap.get(r);if(!(!t&&o&&o.version>=n)){var i={version:n,status:a};this.ISVRelationshipMap.set(r,i)}}},{key:"getIsISVRelatedBySheetId",value:function(e){if(!e)return!1;var t=this.ISVRelationshipMap.get(e);return!!t&&0===t.status}},{key:"getSpreadIsExistRelationship",value:function(){if(this.ISVRelationshipMap){var e,t=yr(this.ISVRelationshipMap);try{for(t.s();!(e=t.n()).done;){if(0===e.value[1].status)return!0}}catch(e){t.e(e)}finally{t.f()}return!1}return!1}},{key:"getISVRelationshipData",value:function(){return(0,te.Z)(this.ISVRelationshipMap)}}]),e}(),c2=function(){function e(){(0,y.Z)(this,e),this._arr=[]}return(0,_.Z)(e,[{key:"enqueue",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=this._arr.length,n=r,a=r-1;a>=0&&t>this._arr[a][1];a--)n=a;this._arr.splice(n,0,[e,t])}},{key:"dequeue",value:function(){var e=this._arr.shift();return e?e[0]:null}},{key:"remove",value:function(e){var t=this._arr.findIndex((function(t){return t[0]===e}));return-1!==t&&(this._arr.splice(t,1),!0)}},{key:"peek",value:function(){return this.isEmpty()?null:this._arr[0][0]}},{key:"isEmpty",value:function(){return 0===this._arr.length}},{key:"clear",value:function(){this._arr.length=0}},{key:"getItemPriority",value:function(e){var t=this._arr.find((function(t){return t[0]===e}));return null==t?null:t[1]}}]),e}(),h2=function(){function e(){(0,y.Z)(this,e),this.queue=new c2,this.isSuspended=!1,this.isExecuting=!1}return(0,_.Z)(e,[{key:"addTask",value:function(e){this.queue.enqueue(e),this.runTask()}},{key:"removeTask",value:function(e){this.queue.remove(e)}},{key:"suspend",value:function(){this.isSuspended=!0}},{key:"resume",value:function(){this.isSuspended=!1,this.runTask()}},{key:"runTask",value:function(){for(var e=this;!this.queue.isEmpty();){if(this.isSuspended||this.isExecuting)return;var t=this.queue.dequeue();if(!t)return;var r=void 0;if(this.isExecuting=!0,(r="function"==typeof t?t():t.fn.apply(t.context,t.param))instanceof Promise){r.then((function(){e.isExecuting=!1,e.runTask()}));break}this.isExecuting=!1}}},{key:"destroy",value:function(){this.queue.clear()}},{key:"getTaskPriority",value:function(e){return this.queue.getItemPriority(e)}}]),e}();!function(e){e[e.LoadData=99999]="LoadData",e[e.CalculateFormulas=200]="CalculateFormulas",e[e.CalculateConditionalFormatStyle=199]="CalculateConditionalFormatStyle",e[e.ApplyCalculationResults=100]="ApplyCalculationResults",e[e.UpdateConditionalFormatStyle=99]="UpdateConditionalFormatStyle",e[e.Default=0]="Default"}(u2||(u2={}));var f2=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).call(this))).turnOnCount=0,e.isRegister=!1,e.queue=new c2,e.port=null,e.nextTickFn=null,e._isIdle=!1,e._forceIdle=!1,e._callback=function(){var r=e.queue.dequeue();r&&r(),e.isRegister=!1,e.queue.isEmpty()||(e.isRegister=!0,(0,f.Z)(((0,c.Z)(e),(0,v.Z)(t.prototype)),"registerIdleCallback",(0,c.Z)(e)).call((0,c.Z)(e),e._callback))},e.initChannel(),e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"initChannel",value:function(){var e=this;try{var t=new MessageChannel,r=t.port1;this.port=t.port2,r.onmessage=function(){var t=e.nextTickFn;t&&(e.nextTickFn=null,t())}}catch(e){this.port=null}}},{key:"getCurrentTime",value:function(){return performance.now()}},{key:"setTimer",value:function(e){return setTimeout(e,20)}},{key:"cancelTimer",value:function(e){return clearTimeout(e)}},{key:"turnOnIdle",value:function(){this.turnOnCount++,this._forceIdle=!0,this.threshold=0}},{key:"turnOffIdle",value:function(){this.turnOnCount=this.turnOnCount<=0?0:this.turnOnCount-1,0===this.turnOnCount&&(this._forceIdle=!1,this.threshold=200)}},{key:"nextTick",value:function(e){this.port?(this.nextTickFn=e,this.port.postMessage(null)):window.setTimeout(e,0)}},{key:"registerIdleCallback",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.isRegister||(this.isRegister=!0,(0,f.Z)((0,v.Z)(t.prototype),"registerIdleCallback",this).call(this,this._callback)),this.queue.enqueue(e,r)}},{key:"unRegisterIdleCallback",value:function(e){this.queue.remove(e),this.queue.isEmpty()&&this.isRegister&&(this.isRegister=!1,(0,f.Z)((0,v.Z)(t.prototype),"unRegisterIdleCallback",this).call(this,this._callback))}},{key:"destroy",value:function(){this.queue.clear(),this.isRegister&&(this.isRegister=!1,(0,f.Z)((0,v.Z)(t.prototype),"unRegisterIdleCallback",this).call(this,this._callback))}},{key:"isIdle",get:function(){return this._isIdle||this._forceIdle},set:function(e){this._isIdle=e}}]),t}(_t.Idle),d2=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setTimer",value:function(e){return-1}},{key:"registerIdleCallback",value:function(e){}},{key:"unRegisterIdleCallback",value:function(e){}}]),t}(f2),v2=function(){function e(){(0,y.Z)(this,e),this._stashEditorSelection=null,this._stashActiveEditor=null}return(0,_.Z)(e,[{key:"getStashEditorSelection",value:function(){return this._stashEditorSelection}},{key:"stashEditorSelection",value:function(e){this._stashEditorSelection=e}},{key:"stashActiveEditor",value:function(e){this._stashActiveEditor=e}},{key:"getStashActiveEditor",value:function(){return this._stashActiveEditor}}]),e}(),p2=function(){function e(){(0,y.Z)(this,e),this.executors=new Map}return(0,_.Z)(e,[{key:"registerAction",value:function(e){if(this.executors.has(e.action))throw new Error("duplicated register, action: ".concat(e.action));this.executors.set(e.action,e)}},{key:"getActionExecutor",value:function(e){return this.executors.get(e)}}]),e}(),m2=new p2;function g2(e){return e&&"cell"!==e.type?(void 0!==e.row_count&&(e.rowCount=e.row_count,delete e.row_count),void 0!==e.col_count&&(e.colCount=e.col_count,delete e.col_count),e):e}function y2(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(t&&(e=ga(e)),e.target=g2(e.target),!(0,ue.default)(e.value)&&"setSpans"===e.action){var r,n=yr(e.value);try{for(n.s();!(r=n.n()).done;){var a=r.value;a.target=g2(a.target)}}catch(e){n.e(e)}finally{n.f()}}return e}var _2=function(){function e(){(0,y.Z)(this,e),this.prepare=[],this.finish=[],this.proxy=null,this.options={logger:console,needClone:!0},this.strategy=new C2}return(0,_.Z)(e,[{key:"registerCsPreare",value:function(e){this.prepare.push(e)}},{key:"registerCsFinish",value:function(e){this.finish.push(e)}},{key:"registerProxy",value:function(e){this.proxy=e}},{key:"updateOptions",value:function(e){Object.assign(this.options,e)}},{key:"setStrategy",value:function(e){this.strategy=e}},{key:"batchExecBegin",value:function(){this.strategy.batchExecBegin()}},{key:"batchExecFinish",value:function(){this.strategy.batchExecFinish()}},{key:"destroy",value:function(){this.prepare.length=0,this.finish.length=0,this.proxy=null}},{key:"notifyPrepare",value:function(e,t,r,n){this.prepare.forEach((function(a){return a(e,t,r,n)}))}},{key:"notifyFinish",value:function(e,t,r,n){this.finish.forEach((function(a){return a(e,t,r,n)}))}},{key:"execBatchActions",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0;this.strategy.batchExecBegin();for(var o=0;o<t.length;o++){var i=t[o];if((0,ue.default)(i))return;this.execAction(e,i,r,n,a,0==o)}this.strategy.batchExecFinish()}},{key:"execAction",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,o=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],i=e;(0,Ce.X_h)(t.action)||((i=e.getSheetFromId(t.sheet_id))||this.logger.trace(cr("sheet.spread.target_not_exit_tips"),t));var u=t,s=u.action,l=t.sheet_id;(0,Ce._8D)(t)&&(l=t.value.sheet_id);var c=-1;t=y2(t,this.options.needClone),!r&&i&&i.suspendEvent();try{this.notifyPrepare(i,s,l,t),this.proxy&&this.proxy[s]?this.proxy[s](this,i,t,n,a):this.strategy.excuteActionImpl(i,t,a,n),this.notifyFinish(i,s,l,t),c=0}catch(e){o&&Ce.Ps3.moirae.teaLog({key:"client_sheet_changeset_exeAction_fail",sheetExist:!!i,action:s,stack:e.stack}),this.logger.error("execAction error: ".concat(s,"|").concat(e.stack)),c=e.code||-1}finally{!r&&i&&i.resumeEvent()}return c}},{key:"excuteActionImpl",value:function(e,t,r,n){return this.strategy.excuteActionImpl(e,t,r,n)}},{key:"logger",get:function(){return this.options.logger}}]),e}(),R2=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"batchExecBegin",value:function(){this.execContext={}}},{key:"excuteActionImpl",value:function(e,t){var r=m2.getActionExecutor(t.action);if(!r)throw new Error("Error: unknown changeset action ".concat(t.action));var n=r.execute(e,t,this.execContext);return r.batchDone&&r.batchDone(this.execContext),n}},{key:"batchExecFinish",value:function(){this.execContext={}}}]),e}(),C2=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).batchDoneSet=new Set,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"excuteActionImpl",value:function(e,t,r,n){var a=this,o=m2.getActionExecutor(t.action);if(!o)throw new Error("Error: unknown changeset action ".concat(t.action));this.batchDoneSet.forEach((function(e){e.needBatchDone&&e.needBatchDone(t,a.execContext)&&e.batchDone&&(e.batchDone(a.execContext),a.batchDoneSet.delete(e))}));var i=o.execute(e,t,this.execContext,r,n);return o.batchDone&&this.batchDoneSet.add(o),i}},{key:"batchExecFinish",value:function(){var e=this;this.batchDoneSet.size&&this.batchDoneSet.forEach((function(t){t.batchDone&&t.batchDone(e.execContext)})),this.batchDoneSet.clear(),(0,f.Z)((0,v.Z)(t.prototype),"batchExecFinish",this).call(this)}}]),t}(R2),w2=function(){function e(){(0,y.Z)(this,e),this.action="addBlock"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e,function(e,t){var r=t.value,n=r.block_token?r.block_token:void 0,a=!0,o=e.creatBlockWorksheet(r.sheet_id,r.sheet_name,r.block_type,r.block_id,n,a);e.dispatch("SheetInit",o),e._addSheet(r.index,o)}(e,t)}}]),e}();m2.registerAction(new w2);var E2=function(){function e(){(0,y.Z)(this,e),this.action="addCol"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=t.target;e.addColumns(o.col,o.colCount,n),e.dispatch("ColumnAdded",[{target:o.col,count:o.colCount}],_V(n,a))}}]),e}();m2.registerAction(new E2);var k2=function(){function e(){(0,y.Z)(this,e),this.action="addComments"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.target,a=t.value,o=n.row,i=n.col;if(a.hasOwnProperty("comments")){var u=e.getComments(o,i)||[],s=(0,b.Z)(u,a.comments).reverse(),l=(0,N.Z)(s,"id").reverse();return e._setComments(o,i,l),s}return[]}}]),e}();m2.registerAction(new k2);var T2=function(){function e(){(0,y.Z)(this,e),this.action="addConditionalFormat"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value;e._addConditionalFormat(n.cfId,n)}}]),e}();m2.registerAction(new T2);var S2=function(){function e(){(0,y.Z)(this,e),this.action="addRow"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=t.target;e.addRows(o.row,o.rowCount,n),r.addRowWorksheet=e,r.addRowInfo||(r.addRowInfo=[]),r.addRowInfo.push({target:o.row,count:o.rowCount}),r.fromUndoRedo=n,r.local=a}},{key:"needBatchDone",value:function(e,t){return"addRow"!==e.action||!!t.addRowWorksheet&&t.addRowWorksheet.id()!==e.sheet_id}},{key:"batchDone",value:function(e){if(e.addRowInfo&&e.addRowWorksheet){var t=e.fromUndoRedo,r=e.local;e.addRowWorksheet.dispatch("RowAdded",e.addRowInfo,_V(t,r)),delete e.addRowInfo,delete e.addRowWorksheet,delete e.fromUndoRedo,delete e.local}}}]),e}();m2.registerAction(new S2);var A2=function(){function e(){(0,y.Z)(this,e),this.action="addSheet"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e;var o=t.value,i=t.sheet_name,u=t.sheet_id,s=e.createWorksheet(u,i,!1);e._addSheet(o.index,s,_V(n,a))}}]),e}();m2.registerAction(new A2);var I2=function(){function e(){(0,y.Z)(this,e),this.action="addView"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){var n=t.value,a=n.view_id,o=n.name,i=n.empty;e.viewsModel.addView(a,o,i)}}]),e}();m2.registerAction(new I2);var O2=function(){function e(){(0,y.Z)(this,e),this.action="copySheet"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e,e.logger.info(">>>copySheet|value:".concat(t.value.index)),function(e,t){var r=t.value,n=e.createWorksheet(r.sheet_id,r.sheet_name,!1);if(r.snapshot){if(r.snapshot.name=r.sheet_name,void 0===r.schemaVersion&&(r.schemaVersion=0),void 0===r.snapshot.comment&&void 0===r.snapshot.mention&&void 0===r.snapshot.image&&void 0===r.snapshot.entities||(r.schemaVersion=1),1!==r.schemaVersion){var a=(new eM).convertSheet(r.schemaVersion,1,r.snapshot).sheetSnapshot;r.snapshot=a}n.fromJSON(r.snapshot)}var o=e.getSheetFromId(n.id()),i=e.getSheetFromName(n.name());o&&o.name()!==n.name()?(e.logger.warn("SHEET_CHANGESET_COPYSHEET_ID_REPEAT"),Ce.Ps3.moirae&&Ce.Ps3.moirae.ravenCatch("SHEET_CHANGESET_COPYSHEET_ID_REPEAT",{tags:{scm:JSON.stringify(window.scm),key:"SHEET_CHANGESET_COPYSHEET_ID_REPEAT"}})):(i&&(e.logger.warn("SHEET_CHANGESET_COPYSHEET_NAME_REPEAT"),Ce.Ps3.moirae&&Ce.Ps3.moirae.ravenCatch("SHEET_CHANGESET_COPYSHEET_NAME_REPEAT",{tags:{scm:JSON.stringify(window.scm),key:"SHEET_CHANGESET_COPYSHEET_NAME_REPEAT"}}),e.removeSheetFromId(i.id())),e._addSheet(r.index,n))}(e,t)}}]),e}();m2.registerAction(new O2);var V2=function(){function e(){(0,y.Z)(this,e),this.action="copySheetMutation"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e;var n=t.value,a=n.sheet_id,o=n.sheet_name,i=n.index,u=n.snapshot;e.logger.info(">>>CopySheetMutation|value:".concat(i));var s=e.getSheetFromId(a),l=e.getSheetFromName(o);if(s&&s.name()!==o)return e.logger.warn("SHEET_CHANGESET_COPYSHEET_ID_REPEAT"),void(Ce.Ps3.moirae&&Ce.Ps3.moirae.ravenCatch("SHEET_CHANGESET_COPYSHEET_ID_REPEAT",{tags:{scm:JSON.stringify(window.scm),key:"SHEET_CHANGESET_COPYSHEET_ID_REPEAT"}}));if(l&&(e.logger.warn("SHEET_CHANGESET_COPYSHEET_NAME_REPEAT"),Ce.Ps3.moirae&&Ce.Ps3.moirae.ravenCatch("SHEET_CHANGESET_COPYSHEET_NAME_REPEAT",{tags:{scm:JSON.stringify(window.scm),key:"SHEET_CHANGESET_COPYSHEET_NAME_REPEAT"}}),e.removeSheetFromId(l.id())),u){(0,Ce.ei5)(t),e.applyCommands(u.topSnapshot),e.applyCommands(u.resource),e.applyCommands(u.dataTable);var c=e.getSheetFromId(a);c&&e.dispatch("SheetAdded",{sheet:c})}else{var h=e.createWorksheet(a,o,!1);e._addSheet(i,h)}}}]),e}();m2.registerAction(new V2);var N2=function(){function e(){(0,y.Z)(this,e),this.action="coverSheet"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value,a=n.sheet,o=n.blockData;a.blocks&&a.blocks.length&&a.blocks.forEach((function(e){var t=e.token,r=o[t];if(r){var n=(0,Ce.Bep)(r,e.startRowIndex);a.data?Object.assign(a.data.dataTable,n):a.data={dataTable:n}}})),a.name=e.name();var i=t.value.schemaVersion;if(void 0===i&&(i=0),1!==i){var u=(new eM).convertSheet(i,1,a).sheetSnapshot;a=u}e.fromJSON(a),e.dispatch("CoverSheet")}}]),e}();m2.registerAction(new N2);var b2=function(){function e(){(0,y.Z)(this,e),this.action="coverSnapshot"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e;var n=t.value,a=n.contentMeta,o=n.blockData,i=a.sheets,u=function(e){var t=i[e];t.blocks&&t.blocks.length&&t.blocks.forEach((function(e){var r=e.token,n=o[r];if(n){var a=(0,Ce.Bep)(n,e.startRowIndex);t.data?Object.assign(t.data.dataTable,a):t.data={dataTable:a}}}))};for(var s in i)u(s);void 0===a.schemaVersion&&(a.schemaVersion=0),1!==a.schemaVersion&&(a=(new eM).convert(a.schemaVersion,1,a).snapshot),a.lang=e.lang,a.locale=e.locale,e.fromJSON(a),e.setActiveSheetIndex(0,!0,!0),e.permissionManager.refreshPermission(),e.dispatch("CoverSnapshot",{contentMeta:a}),e.dispatch("ActiveSheetChanged",{newSheet:e.getSheetFromIndex(0)}),e.calcEngine.markDirty([])}}]),e}();m2.registerAction(new b2);var M2=function(){function e(){(0,y.Z)(this,e),this.action="delBlock"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e,e.removeSheetFromId(t.sheet_id)}}]),e}();m2.registerAction(new M2);var F2=function(){function e(){(0,y.Z)(this,e),this.action="delChart"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent(),e._deleteChart(t.value.chartId)}}]),e}();m2.registerAction(new F2);var Z2=function(){function e(){(0,y.Z)(this,e),this.action="delCol"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=t.target;e.deleteColumns(o.col,o.colCount,n),function(e){for(var t=e.getColumnCount(),r=e.getSelections(),n=!1,a=1,o=1,i=0,u=0,s=0;s<r.length;s++){var l=r[s];if(l.colFrom()+l.colCount()>t){n=!0,l.colFrom()>=t?(u=t,a=1):(u=l.colFrom(),a=t-l.colFrom()),i=l.rowFrom(),o=l.rowCount();break}}n&&e.setSelection(new ou(i,u,o,a,e))}(e),e.dispatch("ColumnDeleted",[{target:o.col,count:o.colCount}],_V(n,a))}}]),e}();m2.registerAction(new Z2);var x2=function(){function e(){(0,y.Z)(this,e),this.action="delConditionalFormat"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value;e._deleteConditionalFormat(n.cfId)}}]),e}();function D2(e,t){if(e.filterModel===t){var r=t.getAllFilteredOutRows();return function(){var t=e.filterModel.getAllFilteredOutRows();!function(e,t,r){var n=function(e,t){for(var r=[],n=Array.from(e),a=Array.from(t),o=0,i=n.length;o<i;o++){var u=n[o];t.has(u)||r.push({row:u,count:1,oldValue:!1,newValue:!0})}for(var s=0,l=a.length;s<l;s++){var c=a[s];e.has(c)||r.push({row:c,count:1,oldValue:!0,newValue:!1})}return r}(t,r);n.length&&e.dispatch("RowVisible",{changes:n,type:1})}(e,r,t)}}return D.default}m2.registerAction(new x2);var P2=function(){function e(){(0,y.Z)(this,e),this.action="delFilter"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){var n=D2(e,e.sheetFilterModel);e.sheetFilterModel.removeFilter(),n(),e.dispatch("FilterChanged")}}]),e}();m2.registerAction(new P2);var $2=function(){function e(){(0,y.Z)(this,e),this.action="delFloatImage"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent(),e._deleteFloatImage(t.value.floatImageId)}}]),e}();m2.registerAction(new $2);var L2=function(){function e(){(0,y.Z)(this,e),this.action="delRow"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=t.target;e.deleteRows(o.row,o.rowCount,n),function(e){for(var t=e.getRowCount(),r=e.getSelections(),n=!1,a=1,o=1,i=0,u=0,s=0;s<r.length;s++){var l=r[s];if(l.rowFrom()+l.rowCount()>t){n=!0,l.rowFrom()>=t?(i=t,o=1):(i=l.rowFrom(),o=t-l.rowFrom()),u=l.colFrom(),a=l.colCount();break}}n&&e.setSelection(new ou(i,u,o,a,e))}(e),r.delRowWorksheet=e,r.delRowInfo||(r.delRowInfo=[]),r.delRowInfo.push({target:o.row,count:o.rowCount}),r.fromUndoRedo=n,r.local=a}},{key:"needBatchDone",value:function(e,t){return"delRow"!==e.action||!!t.delRowWorksheet&&t.delRowWorksheet.id()!==e.sheet_id}},{key:"batchDone",value:function(e){e.delRowInfo&&e.delRowWorksheet&&(e.delRowWorksheet.dispatch("RowDeleted",e.delRowInfo,_V(e.fromUndoRedo,e.local)),delete e.delRowInfo,delete e.delRowWorksheet,delete e.fromUndoRedo,delete e.local)}}]),e}();m2.registerAction(new L2);var B2=function(){function e(){(0,y.Z)(this,e),this.action="delSheet"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=e.parent,i=e.name();o.removeSheet(o.getSheetIndex(i),_V(n,a))}}]),e}();m2.registerAction(new B2);var U2=function(){function e(){(0,y.Z)(this,e),this.action="delView"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){var n,a=t.value.view_id,o=D2(e,null===(n=e.viewsModel.getViewById(a))||void 0===n?void 0:n.getFilterModel());e.viewsModel.deleteViewById(a),o()}}]),e}();m2.registerAction(new U2);var H2=function(){function e(){(0,y.Z)(this,e),this.action="freezeSheet"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.target,a=n.row,o=n.col;a>=0&&e.frozenRowCount(a),o>=0&&e.frozenColumnCount(o)}}]),e}();m2.registerAction(new H2);var z2=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.rowVisibleSheet=e,r.book=e.getParent(),r.rowVisibleInfo||(r.rowVisibleInfo=[]);var o=t.target;return r.rowVisibleInfo.push(function(e,t,r,n){var a=Math.max(0,t);return e.setRowVisible(a,n,void 0,r),{row:t,count:r,newValue:n,oldValue:!n}}(e,o.row,o.rowCount,this.visible)),r.fromUndoRedo=n,r.local=a,!0}},{key:"needBatchDone",value:function(e,t){return!(!t.rowVisibleSheet||t.rowVisibleSheet.id()===e.sheet_id)}},{key:"batchDone",value:function(e){var t=e.rowVisibleSheet,r=e.rowVisibleInfo,n=e.fromUndoRedo,a=e.local;t&&r&&(t.dispatch("RowVisible",{changes:r,type:0},_V(n,a)),delete e.rowVisibleSheet,delete e.rowVisibleInfo,delete e.fromUndoRedo,delete e.local)}}]),e}(),W2=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.colVisibleSheet=e,r.book=e.getParent(),r.colVisibleInfo||(r.colVisibleInfo=[]);var o=t.target;return r.colVisibleInfo.push(function(e,t,r,n){var a=Math.max(0,t);return e.setColumnVisible(a,n,void 0,r),{col:t,count:r,newValue:n,oldValue:!n}}(e,o.col,o.colCount,this.visible)),r.fromUndoRedo=n,r.local=a,!0}},{key:"needBatchDone",value:function(e,t){return!(!t.colVisibleSheet||t.colVisibleSheet.id()===e.sheet_id)}},{key:"batchDone",value:function(e){var t=e.colVisibleSheet,r=e.colVisibleInfo,n=e.fromUndoRedo,a=e.local;t&&r&&(t.dispatch("ColumnVisibleChanged",r,_V(n,a)),delete e.colVisibleSheet,delete e.colVisibleInfo,delete e.fromUndoRedo,delete e.local)}}]),e}(),G2=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).action="hideCol",e.visible=!1,e}return(0,p.Z)(t,e),t}(W2);m2.registerAction(new G2);var j2=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).action="hideRow",e.visible=!1,e}return(0,p.Z)(t,e),t}(z2);m2.registerAction(new j2);var Y2=function(){function e(){(0,y.Z)(this,e),this.action="localActiveView"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){var n=D2(e,e.filterModel);e.viewsModel.tryEntryViewById(t.value.view_id),e.dispatch("EnterLocalFilterView"),n()}}]),e}();m2.registerAction(new Y2);var q2=function(){function e(){(0,y.Z)(this,e),this.action="localDeactiveView"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){var n=D2(e,e.filterModel);e.viewsModel.tryExistView(),n()}}]),e}();m2.registerAction(new q2);var J2=function(){function e(){(0,y.Z)(this,e),this.action="lockCol"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.target,a=t.value,o=n.col,i=n.colCount,u=a.perm_id,s=a.lock_info,l=a.creator_id;e.protectionModel.setProtection(u,{description:s,creatorId:l,ranges:[{col:o,colCount:i,type:Ce.xj7.COL}]})}}]),e}();m2.registerAction(new J2);var K2=function(){function e(){(0,y.Z)(this,e),this.action="lockRow"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.target,a=t.value,o=n.row,i=n.rowCount,u=a.perm_id,s=a.lock_info,l=a.creator_id;e.protectionModel.setProtection(u,{description:s,creatorId:l,ranges:[{row:o,rowCount:i,type:Ce.xj7.ROW}]})}}]),e}();m2.registerAction(new K2);var X2,Q2=function(){function e(){(0,y.Z)(this,e),this.action="lockSheet"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e;var n=e.permissionManager,a=t.value,o=t.sheet_id,i=a.perm_id,u=a.lock_info,s=a.creator_id,l=e.getSheetFromId(o);l&&n.setPerm(i,{permId:i,lockInfo:u,sheetId:l.id(),sheetName:l.name(),creatorId:s})}}]),e}();function e3(e,t,r,n,a){if(!a){var o=t.toJSON(),i=o.row,u=o.col,s=o.rowCount,l=o.colCount,c=n.toJSON(),h=c.row,f=c.col,d=h-i,v=f-u,p=e!==r,m=t.intersect(n),y=e.getSparklineModel(),_=r.getSparklineModel();if(function(e,t,r,n,a,o){e.iterWithPos(t,r,n,a).forEach((function(t){var r=(0,g.Z)(t,2)[1];(null==o?void 0:o.containCell(r.row,r.col))||e.deleteSparklineByCell(r.row,r.col)}))}(_,h,f,s,l,m),m){var R=m.toJSON();t3(y,_,r,R.row,R.col,R.rowCount,R.colCount,d,v,!1,null)}t3(y,_,r,i,u,s,l,d,v,p,m)}}function t3(e,t,r,n,a,o,i,u,s,l,c){e.iterWithPos(n,a,o,i).forEach((function(r){var n=(0,g.Z)(r,2),a=n[0],o=n[1];if(null==c||!c.containCell(o.row,o.col)){var i=a.getId(),l=a.getGroupId(),h=e.getSparklineGroupByGroupId(l),f=a.getPosition(),d={row:f.row+u,col:f.col+s};e.deleteSparklineById(i),t.get(d.row,d.col)&&t.deleteSparklineByCell(d.row,d.col),t.getSparklineGroupByGroupId(l)||t.addGroupById(l,null==h?void 0:h.getRawConfig()),a.updatePosition(d.row,d.col),t.addSparklineById(i,a)}}))}m2.registerAction(new Q2),function(e){e[e.SingleValue=0]="SingleValue",e[e.MultipleValue=1]="MultipleValue"}(X2||(X2={}));var r3,n3=new Map;function a3(e){if(1&e&&4&e)throw new Error("");if(2&e&&8&e)throw new Error("")}!function(e){e[e.normal=0]="normal",e[e.ignoreRow=1]="ignoreRow",e[e.ignoreCol=2]="ignoreCol",e[e.skipRow=4]="skipRow",e[e.skipCol=8]="skipCol"}(r3||(r3={}));var o3=dn._Types._isNullOrUndefined;function i3(e){return e.getRowCount()}function u3(e){return e.getColumnCount()}function s3(e,t){return t._isRowFilterOut&&t._isRowFilterOut(e)}function l3(e){if(!e)return e;if("number"==typeof e||"string"==typeof e||"boolean"==typeof e||o3(e))return e;if(e.clone)return e.clone();if(e instanceof Date)return new Date(e);var t;for(var r in t=e instanceof Object?new e.constructor:new e.constructor(e.valueOf()),e)if(e.hasOwnProperty(r)){var n=e[r];e.hasOwnProperty(r)&&t[r]!==n&&(t[r]="object"==(0,R.Z)(n)?l3(n):n)}return t}function c3(e,t){if(e&&e.length>0){var r=e.toArray();return t?r.filter((function(t){return!e.isPivotSpan(t)})):r}return null}function h3(e,t,r,n,a,o,i,u,s,l,c){var h=new Set;l=l||i,c=c||u;for(var f=0;f<i;f++)for(var d=f%l,v=0;v<u;v++){var p=v%c,m=e.getVar(t+d,r+p,s);Wp(m)?h.add(m):e===n&&jp(m)&&m.getArrayRef().containCell(a+f,o+v)&&h.add(m.formula)}return h}function f3(e,t,r,n,a,o,i,u,s,l,c){var h=!(e===n&&e._name===n._name),f=e._getSpanModel(c),d=n._getSpanModel(c);h&&f&&d?(function(e,t,r,n,a,o,i,u,s,l){var c,h,f,d,v,p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:{copyMoveMode:0},m=p.copyMoveMode,g=p.ignoredRows,y=c3(e,!0),_=c3(n),R=[],C=Boolean(4&m&&g),w=C?g.size:0,E=C?Ov(g,s):[];function k(e){var t,r=yr(g);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(n<=e)++e;else if(e<n&&n<=e+d-1);else if(e+d-1<n)break}}catch(e){r.e(e)}finally{r.f()}return e}if(y)for(var T=0;T<y.length;T++)if(c=y[T],h=c.rowFrom(),f=c.colFrom(),d=c.rowCount(),v=c.colCount(),!(d*v<=1||_3(l,h,f)))if(-1===t){if(r<=f&&f+v<=r+u){var S=h,A=o+f-r;C&&(S=k(S)),R.push(new ou(S,A,d,v,s))}}else if(-1===r){if(t<=h&&h+d<=t+i){var I=a+h-t,O=f;C&&(I=k(I)),R.push(new ou(I,O,d,v,s))}}else if(t<=h&&h<t+i&&r<=f&&f<r+u){var V=a+h-t,N=o+f-r;C&&(V=k(V)),R.push(new ou(V,N,d,v,s))}if(_)for(var b=0;b<_.length;b++){c=_[b],h=c.rowFrom();var M=(f=c.colFrom())>=o&&f<o+u,F=h>=a&&h<a+i+w;if(-1===t?M:-1===r?F:F&&M)for(var Z=function(e){var t=n[e];if(t.rowFrom()===h&&t.colFrom()===f&&E.every((function(e){return!e.contain(t)})))return n.removeSpan(e,1),"break"},x=0;x<n.length;x++){if("break"===Z(x))break}}for(var D=0;n&&D<R.length;D++)n.addSpan(R[D])}(f,t,r,d,a,o,i,u,n,e,l),s&&f&&f.clear(t,r,i,u)):f&&(s?f.move(t,r,a,o,i,u,l):f.copy(t,r,a,o,i,u,l))}function d3(e,t,r,n,a,o,i,u,s,l){var c=t,h=r;c<0&&(c=0,i=Math.min(i3(e),i3(n))),a<0&&(a=0),h<0&&(h=0,u=Math.min(u3(e),u3(n))),o<0&&(o=0),t<0&&f3(e,-1,h,n,-1,o,-1,u,s,l,1),r<0&&f3(e,c,-1,n,a,-1,i,-1,s,l,2),f3(e,c,h,n,a,o,i,u,s,l)}function v3(e,t,r,n,a,o,i){t<0&&(t=0,a=Math.min(e.getColumnCount(),r.getColumnCount())),n<0&&(n=0);if((16&o)>0)for(var u=0;u<a;u++){var s=e._getActualColumnWidth(u+t);o3(s)||(i&&e.setColumnWidth(u+t,e.defaults.colWidth),r.setColumnWidth(u+n,s));var l=e.getColumnVisible(u+t);o3(l)||(i&&e.setColumnVisible(u+t,!0),r.setColumnVisible(u+n,l));var c=e.getActualStyle(-1,u+t);c?(r._setStyleWithoutLocked(-1,u+n,c.clone()),i&&e._setStyleWithoutLocked(-1,u+t,null)):r._setStyleWithoutLocked(-1,u+n,null),(c=e.getActualStyle(-1,u+t,1))?(r._setStyleWithoutLocked(-1,u+n,c.clone(),1),i&&e._setStyleWithoutLocked(-1,u+t,null,1)):r._setStyleWithoutLocked(-1,u+n,null,1);var h=e.getRowColProperty(u+t,"fId",!1);if(!o3(h)){var f={fId:h};i&&e.setRowColProperty(u+t,{fId:void 0},!1),r.setRowColProperty(u+n,f,!1)}}}function p3(e,t,r,n,a,o,i,u){var s=i.copyMoveMode,l=i.ignoredRows;t<0&&(t=0,a=Math.min(i3(e),i3(r))),n<0&&(n=0);for(var c=0,h=0;h<a;h++){var f=n+h+c;if(4&s)for(;l&&l.has(f);)f=n+h+ ++c;else if(1&s&&s3(f,r))continue;if((16&o)>0){var d=e._getActualRowHeight(h+t);o3(d)||(u&&e.setRowHeight(h+t,e.defaults.rowHeight),r.setRowHeight(f,d));var v=e.getRowVisible(h+t);o3(v)||(u&&e.setRowVisible(h+t,!0),v||r.setRowVisible(f,v));var p=e.getActualStyle(h+t,-1);p?(r._setStyleWithoutLocked(f,-1,p.clone()),u&&e._setStyleWithoutLocked(h+t,-1,null)):r._setStyleWithoutLocked(f,-1,null),(p=e.getActualStyle(h+t,-1,2))?(r._setStyleWithoutLocked(f,-1,p.clone(),2),u&&e._setStyleWithoutLocked(h+t,-1,null,2)):r._setStyleWithoutLocked(f,-1,null,2);var m=e.getRowColProperty(h+t,"fId",!0);if(!o3(m)){var g={fId:m};u&&e.setRowColProperty(h+t,{fId:void 0},!0),r.setRowColProperty(f,g,!0)}}}}function m3(e,t,r,n){if(e!==t||e._name!==t._name){if((16&r)>0){var a=e.getDefaultStyle();t.setDefaultStyle(n?a:a.clone()),a=e.getDefaultStyle(1),t.setDefaultStyle(n?a:a.clone(),1),a=e.getDefaultStyle(2),t.setDefaultStyle(n?a:a.clone(),2),n&&(e.setDefaultStyle(null),e.setDefaultStyle(null,1),e.setDefaultStyle(null,2))}var o=t.defaults,i=e.defaults;o.colWidth=i.colWidth,o.rowHeight=i.rowHeight,o.rowHeaderColWidth=i.rowHeaderColWidth}}function g3(e,t,r,n,a,o,i,u,s,l,c,h,f,d){var v,p,m,g=l.copyMoveMode,y=l.ignoredRows,_=ET(e,t,r,i,u),R=!(e===n&&e._name===n._name),C=function(t,r){var n;return!d&&(_3(e,t,r)||_&&(null===(n=e.getPivotTableManager())||void 0===n?void 0:n.getPivotTableByCell(t,r)))};if(!(2&~s)&&t<0){var w=r,E=o;if(v=Math.min(i3(e),i3(n)),p=u,r<0&&(w=0,p=u3(e)),o<0&&(E=0),R)for(var k=0;k<v;k++)for(var T=0;T<p;T++)C(k,w+T)||h(n,k,E+T,l3(m=c(e,k,w+T,1)),1);else{n3.clear();for(var S=0;S<v;S++)for(var A=0;A<p;A++)C(S,w+A)||(m=c(e,S,w+A,1),o3(m)||n3.set("".concat(S,"_").concat(A),l3(m)));for(var I=0;I<v;I++)for(var O=0;O<p;O++)C(I,w+O)||h(n,I,E+O,n3.get("".concat(I,"_").concat(O)),1)}}if(!(1&~s)&&r<0){var V=t,N=a;if(v=i,p=Math.min(u3(e),u3(n)),t<0&&(V=0,v=i3(e)),a<0&&(N=0),R)for(var b=0;b<v;b++)for(var M=0;M<p;M++)C(V+b,M)||h(n,N+b,M,l3(m=c(e,V+b,M,2)),2);else{n3.clear();for(var F=0;F<v;F++)for(var Z=0;Z<p;Z++)C(V+F,Z)||(m=c(e,V+F,Z,2),o3(m)||n3.set("".concat(F,"_").concat(Z),l3(m)));for(var x=0;x<v;x++)for(var D=0;D<p;D++)h(n,N+x,D,n3.get("".concat(x,"_").concat(D)),2)}}var P=t,$=r,L=a,B=o,U=i,H=u;if(t<0&&(P=0),r<0&&($=0),a<0&&(L=0),o<0&&(B=0),R)for(var z=0,W=0;W<U;W++){var G=L+W+z;if(4&g)for(;y&&y.has(G);)G=L+W+ ++z;else if(1&g&&s3(G,n))continue;for(var j=0;j<H;j++)C(P+W,$+j)||h(n,G,B+j,l3(m=c(e,P+W,$+j,3,f)),3)}else{var Y=0;n3.clear();try{for(var q=0;q<U;q++)for(var J=0;J<H;J++)C(P+q,$+J)||(m=c(e,P+q,$+J,3,f),o3(m)||n3.set("".concat(q,"_").concat(J),l3(m)));for(var K=0;K<U;K++){var X=L+K+Y;if(4&g)for(;y&&y.has(X);)X=L+K+ ++Y;else if(1&g&&s3(X,n))continue;for(var Q=0;Q<H;Q++)C(P+K,$+Q)||h(n,X,B+Q,n3.get("".concat(K,"_").concat(Q)),3)}}catch(e){Ce.Ps3.moirae.ravenCatch(e)}}}function y3(e,t,r,n,a,o,i,u,s){var l=arguments.length>9&&void 0!==arguments[9]&&arguments[9],c=arguments.length>10?arguments[10]:void 0,h=h3(e,t,r,n,a,o,i,u);function f(e,t,r,n,a){var o=e.getMultipleValues(t,r),i=e.getReminderJSON(t,r);if(o)return{type:1,multipleValues:o,reminderJSON:i};var u,c=e.getSegmentArray(t,r);16&s||!c||(c="string"==typeof(u=mR(c))?null:u);var f,d=(0,Ce.qdm)(c),v=null;if(l)v=c,!d&&v||(v=e.getValue(t,r,n,void 0,void 0,a));else if(e.hasFormula(t,r)){var p=e.getVar(t,r);f={ref:p.getRef()},v=Tp(p,f,{refType:1})}else v=e.isProxyArrayFormula(t,r)&&h.has(e.getVar(t,r).formula)?null:c||e.getValue(t,r,n);return{type:0,value:v,ctx:f,reminderJSON:i}}function d(e,t,r,n){var a=FC(n.reminderJSON);switch(e._setReminder(t,r,a),n.type){case 0:var o=n.value,i=n.ctx;o3(o)?e.setValue(t,r,null):e.setValue(t,r,o,{ctx:i});break;case 1:e.setValue(t,r,n.multipleValues)}}g3(e,t,r,n,a,o,i,u,s,c,f,d)}function _3(e,t,r){var n=e.getPivotTableManager();return bA(e,null==n?void 0:n.getPivotTableNameByCell(t,r),"isCopy")}function R3(e,t,r,n,a,o,i,u,s,l,c){var h=new ou(t,r,i,u,e),f=h3(e,t,r,n,a,o,i,u,!0);g3(e,t,r,n,a,o,i,u,s,c,(function(e,t,r,n,a){var o=e.getMultipleValues(t,r),i=e.getReminder(t,r),u=e._getModel(),s=_3(e,t,r),l={type:0,value:null,nodeVar:it.NULL_VAR,reminder:null,clone:function(){return this}};if(o)l={type:1,multipleValues:o,reminder:i,clone:function(){return this}};else{var c=u.getVar(t,r,a),h=e.getSegmentArray(t,r,void 0,!0)||e.getValue(t,r,void 0,void 0,void 0,a);s||(l={type:0,value:h,nodeVar:c,reminder:i,clone:function(){return this}})}return s||(e.setValue(t,r,null),e._setReminder(t,r,null)),l}),(function(e,t,r,n){switch(e._setReminder(t,r,n.reminder),n.type){case 0:var a=n.value,o=n.nodeVar;if(o&&jp(o)&&f.has(o.formula)&&(a=null,o=it.NULL_VAR),o&&o!==it.NULL_VAR){var i=e._getModel(),u=Array.isArray(a)?a:null;u?i.setSegmentArray(t,r,u):i.setVar(t,r,o,{skipCompile:!0},null)}else e.setValue(t,r,a);break;case 1:e.setValue(t,r,n.multipleValues)}}),!0);var d=new pu(h,n,a,o);e.getParent().watchHubsOnRefOp(d)}function C3(e,t,r,n,a,o,i,u,s,l,c){g3(e,t,r,n,a,o,i,u,s,c,(function(e,t,r){var n,a=null;if(e.hasFormula(t,r)){var o=e.getVar(t,r);a="="+e.getCalcEngine().decompile(o,{refStyle:"R1C1",ref:o.getRef()}),n={refStyle:"R1C1"}}var i=e.getReminder(t,r);return l&&(e.setValue(t,r,null),e._setReminder(t,r,null)),{value:a,ctx:n,reminder:i}}),(function(e,t,r,n){var a=n.value,o=n.ctx,i=n.reminder;if(!o3(a)){if(l)e._setReminder(t,r,i);else{var u=FC(i?i.toJSON():null);e._setReminder(t,r,u)}e.setValue(t,r,a,{ctx:o})}}))}function w3(e,t,r,n,a,o,i,u,s,l,c){var h={};g3(e,t,r,n,a,o,i,u,s,c,(function(e,t,r,n){var a=(3===n||o3(n))&&h[t]&&h[t][r],o=e._getCompositeStyle(t,r,n,void 0,l,void 0,void 0,void 0,a);return l&&e._setStyleWithoutLocked(t,r,null,n),o}),(function(e,t,r,n,a){e._setStyleWithoutLocked(t,r,n,a)}),void 0,l)}function E3(e,t,r,n,a,o,i,u,s,l,c){g3(e,t,r,n,a,o,i,u,s,c,(function(e,t,r){var a=e.getDropdown(t,r),o={needDeepClone:!0};l&&(o.refSheet=n);var i=e.getDataValidationJSON(t,r,o);return l&&(e.setDataValidation(t,r,null),e.setDropdown(t,r,null)),{dataValidationJSON:i,dropdown:a}}),(function(e,t,r,n){var a=n.dropdown,o=n.dataValidationJSON,i=o?Ey(o,e):null;if(a&&e.setDropdown(t,r,a),i)e.setDataValidation(t,r,i);else{var u=e.getDataValidation(t,r);!u||!c.forceOverrideDataValidation&&T_(u)||e.setDataValidation(t,r,null)}}))}function k3(e,t,r,n){var a=T3(e,t);S3(e,t),S3(r,n),A3(r,n,a)}function T3(e,t){var r=t.toJSON(),n=r.row,a=r.col,o=r.rowCount,i=r.colCount,u=[];return e._getModel().iterNoteWithPos(n,a,o,i).forEach((function(e){if(e){var t=(0,g.Z)(e,2),r=t[0],o=t[1];r&&u.push([o.row-n,o.col-a,(0,Re.default)(r)])}})),u}function S3(e,t){var r=t.toJSON(),n=r.row,a=r.col,o=r.rowCount,i=r.colCount;e._getModel().clearCellNote(n,a,o,i)}function A3(e,t,r){var n=t.toJSON(),a=n.row,o=n.col;r.forEach((function(t){var r=(0,g.Z)(t,3),n=r[0],i=r[1],u=r[2];e._setCellNote(a+n,o+i,u)}))}var I3=function(){return{copyMoveMode:0}};function O3(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{copyMoveMode:0},o=arguments.length>5?arguments[5]:void 0,i=a.copyMoveMode,u=a.ignoredRows;a3(i);var s=e.sheet(),l=e.rowFrom(),c=e.colFrom(),h=t.sheet(),f=t.rowFrom(),d=t.colFrom(),v=e.rowCount(),p=e.colCount();if(!s||!h)return!1;if(V3(s,e,h,t),(16&r)>0&&w3(s,l,c,h,f,d,v,p,r,n,a),128&r&&E3(s,l,c,h,f,d,v,p,r,n,a),n){s.getCalcEngine().formulaSpace;R3(s,l,c,h,f,d,v,p,r,0,a)}else(1&r)>0?y3(s,l,c,h,f,d,v,p,r,!((2&r)>0),a):2&r&&C3(s,l,c,h,f,d,v,p,r,n,a);return(8&r)>0&&(n||1!==v||1!==p)&&d3(s,l,c,h,f,d,v,p,n,a),(64&r)>0&&(e instanceof iu?p3(s,l,h,f,v,r,a,n):e instanceof nu&&v3(s,c,h,d,p,r,n)),l<0&&f<=0&&c<0&&d<=0&&m3(s,h,r,n),g_(h,f,d,v+(Boolean(4&i)&&u?u.size:0),p),e3(s,e,h,t,o),k3(s,e,h,t),!0}function V3(e,t,r,n){e.id()===r.id()&&function(e,t,r,n,a){var o=[];e.forEach((function(e){var t=function(e,t,r){console.log("--oldCommentItem--",e);var n=(0,Re.default)(e),a=t.toJSON(),o=a.row,i=a.col,u=r.toJSON(),s=u.row,l=u.col,c=s-o,h=l-i,f=e.col,d=e.row;return n.row=d+c,n.col=f+h,console.log("--newCommentItem--",n),n}(e,n,a);!function(e,t,r,n){var a=t.row,o=t.col,i=r.row,u=r.col,s=r.comments;n.find((function(e){return e.row===a&&e.col===o}))||e._setComments(a,o,null),e._setComments(i,u,s),n.push({row:i,col:u})}(r,e,t,o)})),t.forEach((function(e){!function(e,t,r){var n=t.row,a=t.col;r.find((function(e){return e.row===n&&e.col===a}))||e._setComments(n,a,null)}(r,e,o)}))}(N3(e,t),N3(e,n),e,t,n)}function N3(e,t){var r=t.toJSON(),n=r.row,a=r.col,o=r.rowCount,i=r.colCount,u=n+o,s=a+i;if(!e.getAllComments)return[];var l=e.getAllComments().filter((function(e){var t=e.row,r=e.col;return t>=n&&t<u&&r>=a&&r<s}));return(0,Re.default)(l)}var b3=Object.freeze({__proto__:null,get CopyMoveMode(){return r3},getIgnoreArrayFmls:h3,copyProperty:g3,getNotesInRange:T3,setNotesInRange:A3,getDefaultCopyMoveOptions:I3,copyMoveRangeTo:O3});function M3(e,t){return e instanceof iu?function(e,t){var r=e.sheet();if(!r)return!1;for(var n=x3(e,t),a=n.srcRow,o=n.targetRow,i=n.rowCount,u=r._getModel(),s=r._getRowInfos(),l=0;l<i;l++)u.swapRow(a+l,o+l),r.embeddedBlocksModel.swapRow(a+l,o+l),s.swap(a+l,o+l);return r.onRowColChanged(o,2,o,a,"row"),F3(e,t,r),Z3(e,t,r),!0}(e,t):e instanceof nu&&function(e,t){var r=e.sheet();if(!r)return!1;for(var n=x3(e,t),a=n.srcColumn,o=n.targetColumn,i=n.columnCount,u=r._getModel(),s=r._getColInfos(),l=0;l<i;l++)u.swapCol(a+l,o+l),r.embeddedBlocksModel.swapCol(a+l,o+l),s.swap(a+l,o+l);return r.onRowColChanged(o,2,o,a,"col"),F3(e,t,r),Z3(e,t,r),!0}(e,t)}function F3(e,t,r){var n=x3(e,t),a=n.srcRow,o=n.srcColumn,i=n.targetRow,u=n.targetColumn,s=n.rowCount,l=n.columnCount;r._getSpanModel().move(a,o,i,u,s,l)}function Z3(e,t,r){var n=x3(e,t),a=n.srcRow,o=n.srcColumn,i=n.targetRow,u=n.targetColumn,s=n.rowCount,l=n.columnCount,c=new ou(a,o,s,l,r),h=new pu(c,r,i,u);r.getParent().watchHubsOnRefOp(h)}function x3(e,t){return{srcRow:e.rowFrom(),srcColumn:e.colFrom(),targetRow:t.rowFrom(),targetColumn:t.colFrom(),rowCount:e.rowCount(),columnCount:e.colCount()}}var D3=function(){function e(){(0,y.Z)(this,e),this.action="moveRange"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){var o;r.book=e;var i=t.value.source,u=t.value.target,s=t.value.type,l=e.getSheetFromId(i.sheetId),c=e.getSheetFromId(u.sheetId),h=ou.fromJSON(i,t.value.type,l),f=ou.fromJSON(u,t.value.type,c),d=null===(o=t.extra)||void 0===o?void 0:o.commandType,v="addCell"===d||"delCell"===d,p=v?Object.assign({},{copyMoveMode:0},{forceOverrideDataValidation:!0}):void 0,m=!1;try{m=function(e,t,r,n,a){if(e.rowCount()!==t.rowCount()||e.colCount()!==t.colCount())return!1;var o=e.sheet(),i=t.sheet();return o&&o===i&&i.inject(_I).actionEventBus$.next({type:"moveRange",sourceRange:e,targetRange:t}),r!==Ce.xj7.ROW&&r!==Ce.xj7.COL||!o||o!==i?O3(e,t,511,!0,n,a):M3(e,t)}(h,f,s,p,v)}catch(e){throw m=!0,e}finally{c&&m&&c.dispatch("MoveRange",{fromRange:h,toRange:f,toEdgeAdjust:v},_V(n,a))}}}]),e}();m2.registerAction(new D3);var P3=function(){function e(){(0,y.Z)(this,e),this.action="moveSheet"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=t.value,i=e.getParent();i._moveSheet(i.getSheetIndex(e.name()),Math.min(o.target,i.sheets.length-1),!1,_V(n,a))}}]),e}();m2.registerAction(new P3);var $3=function(){function e(){(0,y.Z)(this,e),this.action="restoreBlock"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e;var n=t.value;if(!n.block_token)throw new Error("block token is empty");var a=e.creatBlockWorksheet(n.sheet_id,n.sheet_name,n.block_type,n.block_id,n.block_token);e._addSheet(n.index,a)}}]),e}();m2.registerAction(new $3);var L3=function(){function e(){(0,y.Z)(this,e),this.action="restoreSheet"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e;var n=e.getSheetFromId(t.sheet_id);n&&n.clearDelTime()}}]),e}();m2.registerAction(new L3);var B3=new pA,U3=B3;function H3(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.style){var a=B3.add(n.style),o=a.ref,i=a.id;t[i]=o,n.styleId=i,delete n.style}Array.isArray(n.texts)&&H3(n.texts,t)}return e}function z3(e){var t={};if(Array.isArray(e.value.value)&&H3(e.value.value,t),0!==Object.keys(t).length){var r=e.extra||{};r.styles=t,e.extra=r}return e}function W3(e,t){var r=e.extra;if(!r)return e;var n=r.styles;return n&&Object.keys(n).length&&e.value&&function(e,t,r){if(null!=t.styleId){var n=e[t.styleId];if(n)t.style=n;else{console.error("[Sheet Apply Error] Can not find styleJSON ref by styleId!!"),Ce.Ps3.collectSuiteEvent("sheet_action_style_ref_error_dev");var a=null==r?void 0:r.getParent();a&&a.logger.info("sheet_action_style_ref_error_dev")}delete t.styleId}Array.isArray(t.value)&&G3(e,t.value,r)}(n,e.value,t),e}function G3(e,t,r){for(var n=0;n<t.length;n++){var a=t[n],o=a.styleId;if(null!=o){var i=e[o];if(i)a.style=i;else{console.error("[Sheet Apply Error] Can not find styleJSON ref by styleId!!"),Ce.Ps3.collectSuiteEvent("sheet_action_style_ref_error_dev");var u=null==r?void 0:r.getParent();u&&u.logger.info("sheet_action_style_ref_error_dev")}}delete a.styleId,Array.isArray(a.texts)&&G3(e,a.texts,r)}return t}function j3(e,t,r,n){if(null!=n.multipleValues){var a=new l_(e.parent);return a.fromJSON(n.multipleValues),void e.setValue(t,r,a)}if(n.hasOwnProperty("value")){var o=n.value;Array.isArray(o)&&dR(o)&&(o=o.reduce((function(e,t){return e+t.text}),"")),n.formula||n.formulaData||e.setValue(t,r,o,{skipCompile:!0})}!function(e,t,r,n){n.formulaData?Y3(e,t,r,n):n.formula&&("="!==n.formula[0]&&(n.formula="="+n.formula),e.setValue(t,r,n.formula))}(e,t,r,n)}function Y3(e,t,r,n){if(n.hasOwnProperty("value")||!e.getMultipleValues(t,r)&&!e.getSegmentArray(t,r)){var a=e.parent.calcEngine.deserializeFormula(n.formulaData,new ou(t,r,1,1,e)),o={formulaData:n.formulaData,skipCompile:!0};e.setValue(t,r,a,o)}}function q3(e,t,r,n){n.hasOwnProperty("note")&&e._setCellNote(t,r,n.note)}function J3(e,t,r,n){!function(e,t,r,n){if(n.hasOwnProperty("style")){if(n.style&&n.style.cellType&&"8"===n.style.cellType.typeName){var a=n.style.cellType.link,o=n.value;delete n.style.cellType,"string"==typeof o&&(n.value=[{type:"url",text:o||a,link:a}])}if(n.style){var i=Om.fromJSON(e.parent.formatterService,n.style,e.getDefaultStyle());e.setStyle(t,r,i)}else e.setStyle(t,r,null),e.setDropdown(t,r,null)}}(e,t,r,n);var a=e.getSpan(t,r);return(!a||a.rowFrom()===t&&a.colFrom()===r)&&(j3(e,t,r,n),function(e,t,r,n){if(n.style&&n.style.dropdown&&!n.dataValidation){var a=Ey(f_(n.style.dropdown),e);e.setDataValidation(t,r,a)}else if(n.hasOwnProperty(Qg)){var o=n.dataValidation;if(o){var i=Ey(o,e);e.setDataValidation(t,r,i)}else e.setDataValidation(t,r,null)}}(e,t,r,n),q3(e,t,r,n),K3(e,t,r,n),!0)}function K3(e,t,r,n){!function(e,t,r,n){if(n.hasOwnProperty("reminder")){var a=n.reminder;if(a){var o=new zC(a.id);o.fromChangeset(a),e._setReminder(t,r,o)}else e._setReminder(t,r,null)}}(e,t,r,n)}function X3(e,t){var r,n,a=function(e,t){if(t.multipleValues){var r=new l_(e.parent);return r.fromJSON(t.multipleValues),r}if(t.hasOwnProperty("value")){var n=t.value;return Array.isArray(n)?dR(n)?n.reduce((function(e,t){return e+t.text}),""):new Og(e.parent,n):n}}(t,e);return!e.multipleValues&&e.formula&&(e.formula="="+e.formula),e.style&&(r=e.style.dropdown,delete e.style.dropdown),e.hasOwnProperty(Qg)&&(n=e.dataValidation?Ey(e.dataValidation,t):null),{cellValue:a,dropdown:r,dataValidation:n}}var Q3=function(){function e(){(0,y.Z)(this,e),this.action="setCell"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){var n;if("dlpDeleteSensitiveFile"!==(null===(n=t.extra)||void 0===n?void 0:n.commandType)){W3(t,e);var a=t.target,o=t.value,i=a.row,u=a.col;r.setCellInfo||(r.setCellInfo={sheet:e,ranges:[],valueChangeCells:[]}),r.formulaCellMap||(r.formulaCellMap=new qd);var s,l=e.getParent(),c=0,h=J3(e,i,u,o);if(h&&(o.hasOwnProperty("value")||o.formulaData||o.multipleValues||o.formula)&&(c|=1,r.setCellInfo.valueChangeCells.push([i,u])),o.hasOwnProperty("style")&&(c|=2,s=e.getStyle(i,u).formatter),h&&o.hasOwnProperty("dataValidation")&&(c|=2),1&c&&r.formulaCellMap.delete(i,u),h&&(o.formulaData||o.formula)){var f=e.getVar(i,u);f!==it.NULL_VAR&&mv(f)&&l&&r.formulaCellMap.set(i,u,l.calcEngine.formulaRefService.formulaRefPool.add({formula:f.formula,refMap:f.getRefMap()}))}if(2&c){var d=e.getStyle(i,u).formatter;d&&s&&d.equals(s)||!d&&!s||(c|=4)}for(var v=0;v<3;v++)if(1<<v&c){var p=r.setCellInfo.ranges[v];p?(p[0]=Math.min(p[0],i),p[1]=Math.min(p[1],u),p[2]=Math.max(p[2],i),p[3]=Math.max(p[3],u)):r.setCellInfo.ranges[v]=[i,u,i,u]}o.hasOwnProperty("note")&&e.dispatch("NoteChanged",{row:i,col:u,note:o.note})}}},{key:"needBatchDone",value:function(e,t){return"setCell"!==e.action||!!t.setCellInfo&&t.setCellInfo.sheet.id()!==e.sheet_id}},{key:"batchDone",value:function(e){if(e.setCellInfo){for(var t=e.setCellInfo.sheet,r=["RangeChanged","StyleChanged","FormatterChanged"],n=0,a=r.length;n<a;n++)if(e.setCellInfo.ranges[n]){var o=(0,g.Z)(e.setCellInfo.ranges[n],4),i=o[0],u=o[1],s=o[2],l=o[3],c={range:new ou(i,u,s-i+1,l-u+1,t)};"RangeChanged"===r[n]&&(c.formulaCellMap=e.formulaCellMap,c.changedRanges=e.setCellInfo.valueChangeCells.map((function(e){return new Qi(e[0],e[0]+1,e[1],e[1]+1,t.id())}))),t.dispatch(r[n],c)}delete e.setCellInfo,delete e.formulaCellMap}}}]),e}();m2.registerAction(new Q3);var e5=function(){function e(){(0,y.Z)(this,e),this.action="setChart"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=function(e){return{sheetId:e.sheet_id,chartId:e.value.chartId,blockSetting:Object.assign({},e.value.blockSetting,{row:e.target.row,col:e.target.col}),graphSetting:e.value.graphSetting}}(t);e._setChart(n.chartId,n,!0)}}]),e}();m2.registerAction(new e5);var t5=function(){function e(){(0,y.Z)(this,e),this.action="setColProperty"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.target,a=t.value;return e.setRowColProperty(n.col,a,!1)}}]),e}();m2.registerAction(new t5);var r5=function(){function e(){(0,y.Z)(this,e),this.action="setColumnWidth"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){var n=t.target,a=t.value,o=t.is_local,i=n.col,u=n.colCount;if("object"!=(0,R.Z)(a)){if(void 0===o&&e.localColumnWidthChanged(i,u))return!0;r.colSizeWorksheet=e,r.colSizeInfo||(r.colSizeInfo=[]);var s=e.setColumnWidth(i,a,3,o,u),l=s.oldValue,c=s.value;r.colSizeInfo.push({col:i,oldValue:l,newValue:c,count:n.colCount})}return!0}},{key:"needBatchDone",value:function(e,t){return!!t.colSizeWorksheet&&t.colSizeWorksheet.id()!==e.sheet_id}},{key:"batchDone",value:function(e){var t=e.colSizeWorksheet,r=e.colSizeInfo;t&&r&&(t.dispatch("ColumnSizeChanged",r),delete e.colSizeInfo,delete e.colSizeWorksheet)}}]),e}();m2.registerAction(new r5);var n5=function(){function e(){(0,y.Z)(this,e),this.action="setConditionalFormat"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value;e._setConditionalFormat(n.cfId,n)}}]),e}();m2.registerAction(new n5);var a5=function(){function e(){(0,y.Z)(this,e),this.action="setFilter"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.target,a=t.value,o=t.recalc,i=PI(a),u=e.inject($I);if(o)e.filterModel.recalc();else{var s=D2(e,u);u.setRange(n),i&&u.setFilter(i.col,i,i.filteredRowsMap),s(),e.dispatch("FilterChanged")}}}]),e}();m2.registerAction(new a5);var o5=function(){function e(){(0,y.Z)(this,e),this.action="setFilterView"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value,a=n.view_id,o=n.range,i=n.filter_value,u=e.viewsModel.getViewById(a);if(u){var s=u.getFilterModel(),l=D2(e,s),c=n.calculate&&!(null!=i&&i.filteredRowsMap);if(o){if(s.setRange({row:o.row,col:o.col,rowCount:o.row_count,colCount:o.col_count},c),i){var h=PI(i);h&&s.setFilter(h.col,h,h.filteredRowsMap)}}else s.removeFilter();l()}else Ce.Ps3.moirae.ravenCatch("expected to get viewModel but get null")}}]),e}();m2.registerAction(new o5);var i5=function(){function e(){(0,y.Z)(this,e),this.action="setFloatBlock"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=function(e){return{sheetId:e.sheet_id,blockToken:e.value.blockToken,blockType:e.value.blockType,blockSetting:{x:e.value.x,y:e.value.y,row:e.value.row,col:e.value.col,width:e.value.width,height:e.value.height,zIndex:e.value.zIndex}}}(t);e._setFloatBlock(n.blockToken,n,!0)}}]),e}();m2.registerAction(new i5);var u5=function(){function e(){(0,y.Z)(this,e),this.action="delFloatBlock"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent(),e._delFloatBlock(t.value.blockToken)}}]),e}();m2.registerAction(new u5);var s5=function(){function e(){(0,y.Z)(this,e),this.action="setEmbeddedBlock"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=function(e){return{blockToken:e.value.blockToken,blockType:e.value.blockType,position:e.target,blockSetting:e.value.blockSetting}}(t);e._setEmbeddedBlock(o.blockToken,o,!0)&&e.dispatch("EmbeddedBlockChanged",{sheetId:e.id(),embeddedBlockChangeParams:{changeType:1,embeddedBlock:o,blockToken:o.blockToken}},_V(n,a))}}]),e}();m2.registerAction(new s5);var l5=function(){function e(){(0,y.Z)(this,e),this.action="delEmbeddedBlock"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=t.value.blockToken,i=e.embeddedBlocksModel.getBlock(o);e._delEmbeddedBlock(o),e.dispatch("EmbeddedBlockChanged",{sheetId:e.id(),embeddedBlockChangeParams:{changeType:2,embeddedBlock:i,blockToken:o}},_V(n,a))}}]),e}();m2.registerAction(new l5);var c5=function(){function e(){(0,y.Z)(this,e),this.action="setFloatImage"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=function(e){return{sheetId:e.sheet_id,floatImageId:e.value.floatImageId,floatImageSetting:Object.assign({},e.value.floatImageSetting,{row:e.target.row,col:e.target.col})}}(t);e._setFloatImage(n.floatImageId,n,!0)}}]),e}();m2.registerAction(new c5);var h5=function(){function e(){(0,y.Z)(this,e),this.action="setFormData"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();for(var o=t.value,i=0,u=Object.keys(o);i<u.length;i++)for(var s=u[i],l=o[s],c=0,h=Object.keys(l);c<h.length;c++){var f=h[c],d=l[f],v=e.getRowByFId(s),p=e.getColByFId(f);null!=v&&null!=p&&(J3(e,v,p,d),e.dispatch("RangeChanged",{range:new ou(v,p,1,1,e)},_V(n,a)))}}}]),e}();m2.registerAction(new h5);var f5=function(){function e(){(0,y.Z)(this,e),this.action="setFormula"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.target,a=t.value;if(n)return e.setValue(n.row,n.col,a)}}]),e}();m2.registerAction(new f5);var d5=function(){function e(){(0,y.Z)(this,e),this.action="setRange"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){var o=e.getParent();r.book=o;var i=t.value,u=ou.fromJSON(i.target,i.target.type,e),s=u.rowFrom(),l=u.rowCount(),c=u.colFrom(),h=u.colCount();delete i.target,r.setRangeInfo?(r.setRangeInfo.range=r.setRangeInfo.range.union(u),r.setRangeInfo.changedRanges.push(u)):r.setRangeInfo={range:u,changedRanges:[u],formulaCellMap:new qd,actionType:_V(n,a),sheet:e};var f,d,v=r.setRangeInfo.formulaCellMap,p=X3(i,e),m=p.cellValue,g=p.dropdown,y=p.dataValidation,_=y;if(i.style){g&&!y&&(_=Ey(f_(g),e));var R=i.style,C=Om.fromJSON(e.parent.formatterService,R,e.getDefaultStyle());d=e._dataModel.getStyleDropdownModel().getStyleRefMgr().add(C).id}else null===i.style&&(d=null);if(void 0!==_){var w=e._dataModel.getDataValidationModel().getRefMgr();f=_?w.add(_).id:null}for(var E=s;E<s+l;E++)for(var k=c;k<c+h;k++){null===f?e.setDataValidation(E,k,null):"number"==typeof f&&e.setDataValidationById(E,k,f),void 0!==d&&(null===d?e.setStyle(E,k,null):e.setStyleById(E,k,d));var T=e.getSegmentArray(E,k);if(Array.isArray(T))if(i.hasOwnProperty("style")&&!i.hasOwnProperty("value")){var S=mR(T);e.setValue(E,k,S)}else if(i.hasOwnProperty("value")&&!i.hasOwnProperty("style")){var A=e.getStyle(E,k),I=e.getStyleWithoutPartialStyle(E,k);A.equals(I)||e.setStyle(E,k,A)}if((i.hasOwnProperty("value")||null!=i.multipleValues)&&(null==m?e.setValue(E,k,null,{skipCompile:!0}):m instanceof Og?e.setValue(E,k,m.getSegmentArray(),{skipCompile:!0}):e.setValue(E,k,m,{skipCompile:!0})),!i.multipleValues){i.formulaData?Y3(e,E,k,i):i.formula&&e.setValue(E,k,i.formula);var O=e.getVar(E,k);v.delete(E,k),O!==it.NULL_VAR&&mv(O)&&o&&v.set(E,k,o.calcEngine.formulaRefService.formulaRefPool.add({formula:O.formula,refMap:O.getRefMap()}))}q3(e,E,k,i),K3(e,E,k,i)}}},{key:"needBatchDone",value:function(e,t){return"setRange"!==e.action||!!t.setRangeInfo&&t.setRangeInfo.sheet.id()!==e.sheet_id}},{key:"batchDone",value:function(e){e.setRangeInfo&&(e.setRangeInfo.sheet.dispatch("RangeChanged",{range:e.setRangeInfo.range,changedRanges:e.setRangeInfo.changedRanges,formulaCellMap:e.setRangeInfo.formulaCellMap},e.setRangeInfo.actionType),delete e.setRangeInfo)}}]),e}();m2.registerAction(new d5);var v5=function(){function e(){(0,y.Z)(this,e),this.action="setRowHeight"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){var n=t.target,a=t.value,o=t.is_local,i=n.row,u=n.rowCount;if("object"!=(0,R.Z)(a)){if(void 0===o&&e.localRowHeightChanged(i,u))return!0;r.rowSizeWorksheet=e,r.rowSizeInfo||(r.rowSizeInfo=[]);var s=e.setRowHeight(n.row,a,3,o,u),l=s.oldValue,c=s.value;r.rowSizeInfo.push({row:n.row,oldValue:l,newValue:c,count:n.rowCount})}return!0}},{key:"needBatchDone",value:function(e,t){return!!t.rowSizeWorksheet&&t.rowSizeWorksheet.id()!==e.sheet_id}},{key:"batchDone",value:function(e){var t=e.rowSizeWorksheet,r=e.rowSizeInfo;t&&r&&(t.dispatch("RowSizeChanged",r),delete e.rowSizeInfo,delete e.rowSizeWorksheet)}}]),e}();m2.registerAction(new v5);var p5=function(){function e(){(0,y.Z)(this,e),this.action="setRowProperty"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.target,a=t.value;return e.setRowColProperty(n.row,a,!0)}}]),e}();m2.registerAction(new p5);var m5=function(){function e(){(0,y.Z)(this,e),this.action="setSheet"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value;if(e)switch(n.property_name){case"visibility":!function(e,t){var r=t.value;if(e&&(r.sheet_name&&e.name(r.sheet_name),"boolean"==typeof r.hidden)){var n=e.parent,a=e.name();e.setHidden(r.hidden),e.name(r.sheet_name),n._hideSheet&&n._hideSheet(n.getSheetIndex(a))}}(e,t);break;case"gridLine":!function(e,t){var r=t.value;if(e){var n=e.inject(UI);"boolean"==typeof r.grid_line_hidden&&n.setGridLine(r.grid_line_hidden)}}(e,t);break;case"tabColor":!function(e,t){var r=t.value;if(e){var n=e.inject(HI);"string"==typeof r.tab_color&&n.setTabColor(r.tab_color)}}(e,t);break;case"tabType":!function(e,t){var r=t.value;if(e){var n=e.inject(jO);"number"==typeof r.tab_type&&n.setTabType(r.tab_type)}}(e,t);break;default:!function(e,t){var r=t.value;e&&(r.sheet_name&&e.name(r.sheet_name),"boolean"==typeof r.hidden&&e.setHidden(r.hidden))}(e,t)}}}]),e}();m2.registerAction(new m5);var g5=function(){function e(){(0,y.Z)(this,e),this.action="setSpans"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=t.target,i=t.value,u=void 0===i?[]:i;if(Array.isArray(u)){var s,l=new ou(o.row,o.col,o.rowCount,o.colCount,e),c=e.clearSpans(l),h=[],f=yr(u);try{for(f.s();!(s=f.n()).done;){var d=s.value.target,v=d.row,p=d.rowCount,m=d.col,g=d.colCount;e.addSpan(v,m,p,g);for(var y=e.getCellStyle(v,m),_=e.getReminder(v,m),R=v;R<v+p;R++)for(var C=m;C<m+g;C++)R===v&&C===m||(e.setStyle(R,C,y),e._getModel().removeDropdown(R,C),e.setDataValidation(R,C,null),e.setValue(R,C,null),e._setReminder(R,C,null),e._setCellNote(R,C,null));_&&e._setReminder(v,m,_),p>1&&h.push(new ou(v+1,m,p-1,1,e)),g>1&&h.push(new ou(v,m+1,p,g-1,e))}}catch(e){f.e(e)}finally{f.f()}return(c||u.length)&&e.dispatch("RangeChanged",{range:l,changedRanges:h},_V(n,a)),e.dispatch("SpanChanged",l),u}}}]),e}();m2.registerAction(new g5);var y5=function(){function e(){(0,y.Z)(this,e),this.action="setStyle"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.target,a=t.value;if(a&&a.dropdown){var o=a.dropdown;e.setDropdown(n.row,n.col,Rg.fromJSON(o)),delete a.dropdown}var i=e.getDefaultStyle().clone();return i.fromJSON(e.parent,a),e.setStyle(n.row,n.col,i)}}]),e}();m2.registerAction(new y5);var _5=function(){function e(){(0,y.Z)(this,e),this.action="setValue"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=t.target,i=t.value;e.setValue(o.row,o.col,i),e.dispatch("RangeChanged",{range:new ou(o.row,o.col,1,1,e)},_V(n,a))}}]),e}();m2.registerAction(new _5);var R5=function(){function e(){(0,y.Z)(this,e),this.action="setView"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value,a=n.view_id,o=n.name,i=e.viewsModel.getViewById(a);i&&i.setName(o)}}]),e}();m2.registerAction(new R5);var C5=function(){function e(){(0,y.Z)(this,e),this.action="softDelSheet"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e;var n=e.getSheetFromId(t.sheet_id);n&&n.setDelTime(t.value.del_time)}}]),e}();m2.registerAction(new C5);var w5=function(){function e(){(0,y.Z)(this,e),this.action="sort"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=t.target,i=t.value,u=o.row,s=o.col,l=o.rowCount,c=o.colCount;if(i&&o){var h,f,d;e.suspendEvent();try{e.iterSortedRangeToSwapNode(u,l,s,c,i,!0);var v=s+c,p=e.iterSortedRangeToUpdateFormula(s,v,u,i,!0,e.id()),m=(0,g.Z)(p,2);d=m[0],f=m[1]}catch(e){Ce.Ps3.moirae&&Ce.Ps3.moirae.ravenCatch(e),h=e}finally{e.resumeEvent();var y=new ou(o.row,o.col,o.rowCount,o.colCount,e);e.dispatch("Sort",{changedRanges:d,formulaCellMap:f,range:y},_V(n,a))}if(h)throw h}}}]),e}();m2.registerAction(new w5);var E5=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).action="unhideCol",e.visible=!0,e}return(0,p.Z)(t,e),t}(W2);m2.registerAction(new E5);var k5=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).action="unhideRow",e.visible=!0,e}return(0,p.Z)(t,e),t}(z2);m2.registerAction(new k5);var T5=function(){function e(){(0,y.Z)(this,e),this.action="unlockCol"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value.perm_id;e.protectionModel.delProtection(n)}}]),e}();m2.registerAction(new T5);var S5=function(){function e(){(0,y.Z)(this,e),this.action="unlockRow"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value.perm_id;e.protectionModel.delProtection(n)}}]),e}();m2.registerAction(new S5);var A5=function(){function e(){(0,y.Z)(this,e),this.action="unlockSheet"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e;var n=e.permissionManager,a=t.value.perm_id;n.removePerm(a)}}]),e}();m2.registerAction(new A5);var I5=function(){function e(){(0,y.Z)(this,e),this.action="updateRange"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=t.value,i=t.is_local,u=ou.fromJSON(o.target,o.target.type,e),s=u.rowFrom(),l=u.rowCount(),c=u.colFrom(),h=u.colCount();delete o.target;var f=X3(o,e),d=f.cellValue,v=f.dropdown,p=f.dataValidation,m=function(t,r,n){n?n instanceof Og?e.setValue(t,r,n.getSegmentArray(),{skipCompile:!0}):e.setValue(t,r,n,{skipCompile:!0}):e.setValue(t,r,null,{skipCompile:!0})},g=new Map,y=!1,_=!1,R=[],C=[],w=s+l,E=c+h;(a||i)&&e._dataModel.removeWorkWrapValue(s,c,w,E);for(var k=s;k<s+l;k++){for(var T=c;T<c+h;T++){var S=!1,A=!1,I=d,O=e.getCellStyle(k,T,void 0,!0),V=O,N=!0,b=o,M=e.getSegmentArray(k,T);if(b.style){if(v&&null==p){var F=Ey(f_(v),e);e.setDataValidation(k,T,F)}if(i&&void 0!==b.style.wordWrap)e._dataModel.setWordWrapValue(k,T,b.style.wordWrap);else if(Array.isArray(M)&&M.length){var Z=pR(M,V,e,b.style),x=Z.value,D=Z.style;Z.hasChanged&&(A=!0,I=Array.isArray(x)?new Og(e.parent,x):x,V=D)}else{var P=g.get(V);if("number"!=typeof P){var $=e._dataModel.getStyleDropdownModel().getStyleRefMgr(),L=e.getDefaultStyle(),B=Om.withUpdateStyle(V||L.clone(),b.style,e.formatterService);P=B.equals(L)?-1:$.add(B).id,g.set(V,P)}-1!==P?e.setStyleById(k,T,P):e.setStyle(k,T,null),N=!1}}else if(null===b.style){if(V=null,Array.isArray(M)&&M.length){A=!0;var U=mR(M);I=Array.isArray(U)?new Og(e.parent,U):U}e.setDropdown(k,T,null)}if((b.hasOwnProperty("value")||b.multipleValues)&&(m(k,T,d),A=!1,S=!0,_=!0),A&&(m(k,T,I),S=!0),!N||null!==V&&null!=O&&O.equals(V)||e.setStyle(k,T,V),(p||null===p&&!v)&&e.setDataValidation(k,T,p),q3(e,k,T,o),K3(e,k,T,o),null===b.style&&null!=O&&O.formatter&&(y=!0),S){var H=C[C.length-1];H&&T===H.endCol?H.endCol++:C.push(new Qi(k,k+1,T,T+1,e.id()))}}for(var z=C.length-1,W=1;z>=0;z--,W++){var G=C[z],j=R[R.length-W];if(!j||j.startCol!==G.startCol||j.endCol!==G.endCol||j.endRow!==G.startRow){for(var Y=0;Y<=z;Y++)R.push(C[Y]);break}ti(j,G)}C=[]}if((y||o.style&&o.style.hasOwnProperty("formatter"))&&e.dispatch("FormatterChanged",{range:u},_V(n,a)),e.dispatch("StyleChanged",{range:u},_V(n,a)),R.length){var q=_?void 0:1;e.dispatch("RangeChanged",{range:u,changedRanges:R,type:q},_V(n,a))}}}]),e}();m2.registerAction(new I5);var O5=function(){function e(){(0,y.Z)(this,e),this.action="updateReference"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value,a=n.type,o=n.oldRef,i=n.newRef,u=e._getModel().updateReference(a,o,i);u&&e.dispatch("DataValidationRefChanged",u)}}]),e}();m2.registerAction(new O5);var V5=function(){function e(){(0,y.Z)(this,e),this.action="setDataRange"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=N5(t);e._setDataRange(n)}}]),e}(),N5=function(e){var t=e.sheet_id,r=e.value,n=r.range_id,a=r.usage_type,o=r.create_time;switch(e.target.type){case 3:return{sheetId:t,rangeId:n,type:Ce.xj7.ALL,usageType:a,createTime:o};case 1:return{sheetId:t,rangeId:n,type:Ce.xj7.ROW,row:e.target.row,rowCount:e.target.rowCount,usageType:a,createTime:o};case 2:return{sheetId:t,rangeId:n,type:Ce.xj7.COL,col:e.target.col,colCount:e.target.colCount,usageType:a,createTime:o};default:return{sheetId:t,rangeId:n,type:Ce.xj7.NORMAL,row:e.target.row,col:e.target.col,rowCount:e.target.rowCount,colCount:e.target.colCount,usageType:a,createTime:o}}};m2.registerAction(new V5);var b5=function(){function e(){(0,y.Z)(this,e),this.action="delDataRange"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent(),e._delDataRange(t.value.range_id)}}]),e}();m2.registerAction(new b5);var M5=function(){function e(){(0,y.Z)(this,e),this.action="moveConditionalFormat"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value;e._moveConditionalFormat(n)}}]),e}();m2.registerAction(new M5);var F5=Ce.TcH,Z5=function(){function e(){(0,y.Z)(this,e),this.action="setRangeValues"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){r.book=e.getParent();var o=t.value,i=t.target,u=i.row+i.rowCount-1,s=i.col+i.colCount-1,l=e.getParent().calcEngine;r.setRangeValuesInfo||(r.setRangeValuesInfo={eventNotifyRanges:[],changedRanges:[],formulaCellMap:new qd,sheet:e});var c=r.setRangeValuesInfo.formulaCellMap,h=r.setRangeValuesInfo.eventNotifyRanges,f=r.setRangeValuesInfo.changedRanges,d=o.style?pA.deserialize(o.style):{},v={},p={},m=[],g=[],y=e._dataModel.getStyleDropdownModel().getStyleRefMgr(),_=e._dataModel.getDataValidationModel().getRefMgr(),R=o.value,C=0,w=[];(a||t.is_local)&&e._dataModel.removeWorkWrapValue(i.row,i.col,u,s);for(var E=i.row;E<=u;E++){for(var k=i.col;k<=s;k++,C++){var T=R[C];if(Array.isArray(T)){var S=void 0,A=!1,I=!1,O=!1,V=!1,N=T[F5.CHANGED_FLAG];if(P5(F5.STYLE_INDEX,N)){A=!0;var b=T[F5.STYLE_INDEX];if("number"==typeof b){var M;S=null===(M=e.getCellStyle(E,k))||void 0===M?void 0:M.formatter;var F=d[b];if(F){var Z=void 0;t.is_local?void 0!==(Z=Om.fromJSON(e.parent.formatterService,F,e.getDefaultStyle())).wordWrap&&e._dataModel.setWordWrapValue(E,k,Z.wordWrap):(void 0===v[b]&&(Z=Om.fromJSON(e.parent.formatterService,F,e.getDefaultStyle()),v[b]=y.add(Z).id),e.setStyleById(E,k,v[b]))}else e.setStyle(E,k,null)}else e.setStyle(E,k,null)}var x=T[F5.MULTIPLE_VALUE_INDEX];if(P5(F5.MULTIPLE_VALUE_INDEX,N)&&Array.isArray(x)&&o.multipleValues){I=!0,c.delete(E,k);var D=x.map((function(e){return o.multipleValues[e]})),P=new l_(e.parent);P.fromJSON(D),e.setValue(E,k,P)}else if(P5(F5.CELL_VALUE,N)){I=!0,c.delete(E,k);var $=T[F5.CELL_VALUE];Array.isArray($)&&($.forEach((function(e){return x5(d,e)})),dR($)&&($=$.reduce((function(e,t){return e+t.text}),"")));var L=T[F5.FORMULADATA_INDEX];if(P5(F5.FORMULADATA_INDEX,N)&&"number"==typeof L&&o.formulaData){var B=o.formulaData[L];if(B){var U=new ou(E,k,1,1,e),H=void 0;if(void 0!==m[L]){var z=m[L],W={root:z.getRoot(),formula:z.formula,refMap:z.getRefMap(),isArrayFormula:Wp(z)};H=l.createFormula(U,W)}else H=l.deserializeFormula(B,U),m[L]=H,g[L]=l.formulaRefService.formulaRefPool.add({formula:H.formula,refMap:H.getRefMap()});e.setValue(E,k,H,{formulaData:B,skipCompile:!0}),mv(e.getVar(E,k))&&c.set(E,k,g[L])}}else e.setValue(E,k,$,{skipCompile:!0})}if(P5(F5.DATAVALIDATION_INDEX,N)){A=!0;var G=T[F5.DATAVALIDATION_INDEX];if("number"==typeof G&&o.dataValidation){var j=o.dataValidation[G];if(j&&void 0===p[G]){var Y=Ey(j,e);p[G]=Y?_.add(Y).id:null}j&&null!==p[G]?e.setDataValidationById(E,k,p[G]):e.setDataValidation(E,k,null)}else e.setDataValidation(E,k,null)}var q=T[F5.REMINDER];if(P5(F5.REMINDER,N))if(q){var J=new zC(q.id);J.fromChangeset(q),e._setReminder(E,k,J)}else e._setReminder(E,k,null);var K=T[F5.NOTE];if(P5(F5.NOTE,N)&&(V=!0,e._setCellNote(E,k,K)),A){var X,Q=null===(X=e.getCellStyle(E,k))||void 0===X?void 0:X.formatter;Q&&S&&Q.equals(S)||!Q&&!S||(O=!0)}if(L5(h,{cellValueChanged:I,styleChanged:A,formatterChanged:O,noteChanged:V},E,k),!I)continue;var ee=w[w.length-1];ee&&k===ee.endCol?ee.endCol++:w.push(new Qi(E,E+1,k,k+1,e.id()))}}for(var te=w.length-1,re=1;te>=0;te--,re++){var ne=w[te],ae=f[f.length-re];if(!ae||ae.startCol!==ne.startCol||ae.endCol!==ne.endCol||ae.endRow!==ne.startRow){for(var oe=0;oe<=te;oe++)f.push(w[oe]);break}ti(ae,ne)}w=[]}}},{key:"needBatchDone",value:function(e,t){return"setRangeValues"!==e.action||!!t.setRangeValuesInfo&&t.setRangeValuesInfo.sheet.id()!==e.sheet_id}},{key:"batchDone",value:function(e){if(e.setRangeValuesInfo){var t=e.setRangeValuesInfo.sheet;(function(e,t,r){for(var n=["RangeChanged","StyleChanged","FormatterChanged","NoteChanged"],a=0,o=n.length;a<o;a++)if(e[a]){var i=(0,g.Z)(e[a],4),u=i[0],s=i[1],l=i[2],c=i[3],h={range:new ou(u,s,l-u+1,c-s+1,t)};r[n[a]]&&Object.assign(h,r[n[a]]),t.dispatch(n[a],h)}})(e.setRangeValuesInfo.eventNotifyRanges,t,{RangeChanged:{formulaCellMap:e.setRangeValuesInfo.formulaCellMap,changedRanges:e.setRangeValuesInfo.changedRanges}}),delete e.setRangeValuesInfo}}}]),e}();function x5(e,t){if("number"==typeof t.styleId){var r=e[t.styleId];r&&(t.style=r),delete t.styleId}Array.isArray(t.texts)&&t.texts.forEach((function(t){return x5(e,t)}))}m2.registerAction(new Z5);var D5=(rt={},(0,l.Z)(rt,F5.CELL_VALUE,1),(0,l.Z)(rt,F5.STYLE_INDEX,2),(0,l.Z)(rt,F5.FORMULADATA_INDEX,4),(0,l.Z)(rt,F5.DATAVALIDATION_INDEX,8),(0,l.Z)(rt,F5.MULTIPLE_VALUE_INDEX,16),(0,l.Z)(rt,F5.REMINDER,32),(0,l.Z)(rt,F5.NOTE,512),rt);function P5(e,t){return Boolean((D5[e]||1<<e-1)&t)}function $5(e,t){var r=D5[e];return r&&r&t?r^t:t}function L5(e,t,r,n){for(var a=[t.cellValueChanged,t.styleChanged,t.formatterChanged,t.noteChanged],o=0;o<a.length;o++)if(a[o]){var i=e[o];i?(i[0]=Math.min(i[0],r),i[1]=Math.min(i[1],n),i[2]=Math.max(i[2],r),i[3]=Math.max(i[3],n)):e[o]=[r,n,r,n]}}function B5(e){var t=ga(e);return!t||t.type!==Ce.xj7.ROW&&t.type!==Ce.xj7.COL?null:(void 0!==t.row_count&&(t.rowCount=t.row_count,delete t.row_count),void 0!==t.col_count&&(t.colCount=t.col_count,delete t.col_count),t)}var U5=function(){function e(){(0,y.Z)(this,e),this.action="addOutline"}return(0,_.Z)(e,[{key:"execute",value:function(e,t){var r=t.value.state,n=t.target,a=e.outlineGroupModel,o=B5(n);o&&a.addRange(o,r)}}]),e}();m2.registerAction(new U5);var H5=function(){function e(){(0,y.Z)(this,e),this.action="updateOutline"}return(0,_.Z)(e,[{key:"execute",value:function(e,t){var r=t.value.state,n=t.target,a=e.outlineGroupModel,o=B5(n);if(o){a.updateOutline(o,r);var i=o.type===Ce.xj7.ROW?new iu(o.row,o.rowCount,e):new nu(o.col,o.colCount,e);e.dispatch("OutlineStateChanged",{range:i,state:r})}}}]),e}();m2.registerAction(new H5);var z5=function(){function e(){(0,y.Z)(this,e),this.action="delOutline"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n,a){var o=t.target,i=e.outlineGroupModel,u=B5(o);if(u){i.cancelRange(u);var s=u.type===Ce.xj7.ROW?new iu(u.row,u.rowCount,e):new nu(u.col,u.colCount,e);e.dispatch("OutlineStateChanged",{range:s},_V(n,a))}}}]),e}();m2.registerAction(new z5);var W5=function(){function e(){(0,y.Z)(this,e),this.action="addSparklineGroup"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent(),function(e,t){var r=e.getSparklineModel();if(t)for(var n=0,a=Object.entries(t.value);n<a.length;n++){var o=(0,g.Z)(a[n],2),i=o[0],u=o[1],s=null==u?void 0:u.config;r.addGroupById(i,s);var l=(u||{}).sparklines;if(l)for(var c=0,h=Object.entries(l);c<h.length;c++){var f=(0,g.Z)(h[c],2),d=f[0],v=f[1];if(r.getSparklineById(d))r.setSparklineById(d,i);else{var p=v||{},m=p.source,y=p.position;if(!m||!y)continue;r.createSparkline(m,y,d,i)}}}}(e,t),e.dispatch("SparklineAddActionApply",{sheetId:e.id()})}}]),e}();m2.registerAction(new W5);var G5=function(){function e(){(0,y.Z)(this,e),this.action="updateSparklineGroup"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent(),function(e,t){var r=e.getSparklineModel();if(t)for(var n=0,a=Object.entries(t.value);n<a.length;n++){var o=(0,g.Z)(a[n],2),i=o[0],u=o[1];if(u){var s=u.config||{};if(i){r.getSparklineGroupByGroupId(i)?Object.keys(s).length&&r.updateGroupConfig(i,s):r.addGroupById(i,s);var l=u.sparklines;if(l)for(var c=0,h=Object.entries(l);c<h.length;c++){var f=(0,g.Z)(h[c],2),d=f[0],v=f[1];if(null===v)r.deleteSparklineById(d);else{var p=v||{},m=p.source,y=p.position;if(r.getSparklineById(d))r.setSparklineById(d,i,y,m);else{if(!m||!y)continue;r.createSparkline(m,y,d,i)}}}}}}}(e,t),e.dispatch("SparklineUpdateActionApply",{sheetId:e.id()})}}]),e}();m2.registerAction(new G5);var j5=function(){function e(){(0,y.Z)(this,e),this.action="delSparklineGroup"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent(),function(e,t){var r=e.getSparklineModel();(null==t?void 0:t.value)&&Array.isArray(t.value)&&t.value.forEach((function(e){r.deleteGroupById(e)}))}(e,t),e.dispatch("SparklineDeleteActionApply",{sheetId:e.id()})}}]),e}();m2.registerAction(new j5);var Y5=function(){function e(){(0,y.Z)(this,e),this.action="setRangeProtection"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent();var n=t.value;e.protectionModel.setProtection(n.id,{creatorId:n.creator_id,description:n.description,ranges:n.ranges.map((function(e){switch(e.type){case Ce.xj7.COL:return{col:e.col,colCount:e.col_count,type:e.type};case Ce.xj7.ROW:return{row:e.row,rowCount:e.row_count,type:e.type};case Ce.xj7.NORMAL:return{row:e.row,rowCount:e.row_count,col:e.col,colCount:e.col_count,type:e.type};default:throw new Error("Unsupported protection range type ".concat(JSON.stringify(e)," in ").concat(n.id))}}))})}}]),e}();m2.registerAction(new Y5);var q5=function(){function e(){(0,y.Z)(this,e),this.action="delRangeProtection"}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r){r.book=e.getParent(),e.protectionModel.delProtection(t.value.id)}}]),e}();m2.registerAction(new q5);var J5=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"taskLength",value:function(){return this._tasks.length}}]),t}(_t.FIdleScheduler),K5=function(){function e(){(0,y.Z)(this,e),this._crossHighlightEnabled$=new ft.X(!1),this._crossHighlightColor$=new ft.X("crossLightYellow"),this.crossHighlightEnabled$=this._crossHighlightEnabled$.asObservable(),this.crossHighlightColor$=this._crossHighlightColor$.asObservable()}return(0,_.Z)(e,[{key:"init",value:function(e){e.crossHighlightState&&this.setEnable(e.crossHighlightState),e.crossHighlightColor&&this.setColor(e.crossHighlightColor)}},{key:"setEnable",value:function(e){e!==this.crossHighlightEnabled&&this._crossHighlightEnabled$.next(e)}},{key:"setColor",value:function(e){e!==this.crossHighlightColor&&this._crossHighlightColor$.next(e)}},{key:"crossHighlightEnabled",get:function(){return this._crossHighlightEnabled$.getValue()}},{key:"crossHighlightColor",get:function(){return this._crossHighlightColor$.getValue()}}]),e}();function X5(e){var t=new ht.W;return t.bind(iV).toDynamicValue(e.getCommandManager),t.bind(uV).toDynamicValue(e.getWorkbook),t.bind(It.UU).to(It.lO).inSingletonScope(),t.bind(It.tb).to(It.E4).inSingletonScope(),t.bind(It.QX).to(It.mQ).inSingletonScope(),t.bind(It.zv).to(It.zB).inSingletonScope(),t.bind(It.Jv).to(It.Dp).inSingletonScope(),t.bind(sV).toDynamicValue(e.getWatchHub),function(e){e.bind(K5).toSelf().inSingletonScope()}(t),function(e,t){e.bind(HV).to(CV).inSingletonScope(),t?e.bind(WV).to(KV).inSingletonScope():e.bind(zV).to(JV).inSingletonScope()}(t,e.isWorker),t}K5=Vu([(0,st.b)()],K5);var Q5=function(){function e(t,r){(0,y.Z)(this,e),this._sheet=t,this._meta=r,this._cache=new Map,this._formula2id=new Map,this._id2formula=new Map,this._cachedFormula=new Set,this._dirtyFormula=new Set,this._maxFormulaId=0,this._hasDirtyFormula=!0,r&&this.setMeta(r)}return(0,_.Z)(e,[{key:"setMeta",value:function(e){this._maxFormulaId=e.maxFormulaId,this._hasDirtyFormula=e.hasDirtyFormula}},{key:"applyFormulaCache",value:function(e,t){for(var r=this,n=0;n<e.length;++n)e[n].forEach((function(e){var n=r._id2formula.get(e);n&&r.setFormulaCache(n,e,t)}));this._sheet.parent.dispatch("FormulaCacheApplied",this._dirtyFormula),this._dirtyFormula.clear()}},{key:"loadFormulaCacheBlock",value:function(e,t){var r=0,n=new Set;for(var a in e){var o,i=void 0,u=void 0,s=a.split("_");if(s.length>1){if(!t)continue;i=a,u=Number(s[0])}else u=i=Number(a),null==e[a].p&&r++;if(null===(o=this._id2formula.get(u))||void 0===o||!o.ignoreApplyCache){n.add(u);var l=e[a];if(!t){l={p:{s:this._sheet._id_,r:Ce.Dcv,c:Ce.Dcv}};var c=e[a].a;c&&(l.a={e:c.e});var h=e[a].ai;h&&(l.ai=h)}this._cache.set(i,l)}}return this._sheet.parent.calcEngine.statistics.add(this._sheet.id(),lF.ServerSideCacheFormulaCount,r),n}},{key:"setFormulaCache",value:function(e,t,r){var n=this;this._maxFormulaId<t&&(this._maxFormulaId=t),this._formula2id.set(e,t),this._id2formula.set(t,e);var a=this._cache.get(t);if(null!=a){!function(e,t){var r=e.a;if(null!=r){var n=r.r,a=r.c;if(null!=n&&null!=a){for(var o=n*a,i=[],u=0;u<o;u++)i.push(t(u));r.m=i}}}(a,(function(e){var r="".concat(t,"_").concat(e),a=n._cache.get(r);return n._cache.delete(r),a}));var o=this._sheet.parent.calcEngine,i=!1;(function(e){return null==e.p})(a)&&(i=!e.ignoreApplyCache&&e.fromCache(a,{loadRuntimeError:r})),this._cache.delete(t);var u=this._sheet.parent.aiManager,s=a.ai;if(s){var l,c=s.u;c&&(null===(l=u.setFormulaCreator)||void 0===l||l.call(u,e,c))}i&&(o.statistics.add(this._sheet.id(),lF.ServerSideCacheHitFormulaCount),this._cachedFormula.add(t),this._dirtyFormula.add(e))}}},{key:"isFormulaCached",value:function(e){var t=this._formula2id.get(e);return"number"==typeof t&&this._cachedFormula.has(t)&&!e.ignoreApplyCache}},{key:"getFormulaId",value:function(e){return this._formula2id.get(e)}},{key:"clearCache",value:function(){this._cache.clear()}},{key:"destroy",value:function(){this._cache.clear(),this._cachedFormula.clear(),this._dirtyFormula.clear(),this._formula2id.clear(),this._id2formula.clear()}}]),e}(),e4=function(){function e(t){(0,y.Z)(this,e),this.workbook=t,this._sheetManagers=new Map,this._formulaCacheVersionMatch=!0,this.isFormulaCacheDisabled=!1}return(0,_.Z)(e,[{key:"disableFormulaCache",value:function(){this.isFormulaCacheDisabled=!0,this._sheetManagers.forEach((function(e){e.clearCache()}))}},{key:"setSheetManager",value:function(e){if(!this._sheetManagers.get(e)){var t=this.workbook.getSheetFromId(e);if(!t)return;this._sheetManagers.set(e,new Q5(t))}}},{key:"loadFormulaCacheMeta",value:function(e,t){var r=this._sheetManagers.get(e);if(r)r.setMeta(t);else{var n=this.workbook.getSheetFromId(e);if(!n)return;this._sheetManagers.set(e,new Q5(n,t))}}},{key:"loadFormulaCacheBlock",value:function(e,t){if(this.isFormulaCacheDisabled)return null;var r=this._sheetManagers.get(e);return r?r.loadFormulaCacheBlock(t,this._formulaCacheVersionMatch):null}},{key:"applyFormulaCache",value:function(e,t){var r=this._sheetManagers.get(e);r&&r.applyFormulaCache(t,!1)}},{key:"setFormulaCache",value:function(e,t,r){var n=t._id_,a=this._sheetManagers.get(n);a||(a=new Q5(t),this._sheetManagers.set(n,a)),a.setFormulaCache(e,r,!1)}},{key:"isFormulaCached",value:function(e){var t=e.getRef().sheet();if(!t)return!1;var r=this._sheetManagers.get(t.id());return!!r&&r.isFormulaCached(e)}},{key:"getFormulaId",value:function(e,t){var r=this._sheetManagers.get(t);if(r)return r.getFormulaId(e)}},{key:"destroy",value:function(){this._sheetManagers.forEach((function(e){return e.destroy()})),this._sheetManagers.clear()}}]),e}(),t4=function(){function e(){(0,y.Z)(this,e),this.errSheetName2SheetId={}}return(0,_.Z)(e,[{key:"fromJSON",value:function(e){var t=this;e.errFml&&Object.keys(e.errFml).forEach((function(r){var n=r.split("_")[0];e.errFml[r].forEach((function(e){t.errSheetName2SheetId[e]?t.errSheetName2SheetId[e].add(n):t.errSheetName2SheetId[e]=new Set([n])}))}))}},{key:"getErrFmlSheetIdsBySheetName",value:function(e){var t=this.errSheetName2SheetId[e];return t?(delete this.errSheetName2SheetId[e],(0,m.Z)(t)):[]}},{key:"reset",value:function(){this.errSheetName2SheetId={}}}]),e}(),r4=sa,n4=".gcSpread",a4=".gcSpreadInternal";function o4(e){return e.getActiveSheet()}var i4={left:0,center:1,right:2,nearest:3},u4={top:0,center:1,bottom:2,nearest:3},s4={allowUndo:!0,defaultDragFillType:5,embed:!1,template:!1,copyPasteHeaderOptions:0,font:null,isShowProtectedRange:!1,isProtected:!0,remainUserPerms:!1,enableIdle:!0,isWorker:!1,canUseWorker:!1,situation:""},l4={floor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return FZ(e,t)},ceil:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return ZZ(e,t)},round:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return MZ(e,t)},toPrecision:function(e,t){return rn._toPrecision(e,t)}},c4=function(){function e(t,r){var n,a=this;(0,y.Z)(this,e),this._userLang=Ce.Ps3.getLanguage(),this.name="",this._availableSheetIndex=-1,this._activeSheetIndex=0,this.uiEvents=new(ir()),this.sheets=[],this.sheetIdToIndexMap=new Map,this.activeSheet$=new ft.X(void 0),this.importRangeManager=new FE(this),this.logger=console,this._watchHub=new jt.WatchedRefHub,this._hasArrayFormula=!1,this._bitableBlockNum=0,this.taskQueue=new h2,this.apiHookManager=new fg,this._userEvents=[],this._userEventsElem=Zm("input"),this._eventSuspended=0,this._namedStyles={},this.validationHasRandom=!1,this.isvRelationshipManager=null,this.isSearching=!1,this.isRangeSelecting=!1,this.hyperlinkWithEditor=new v2,this.subscriber=new Map,this.changesetExec=new _2,this.formatterService=new Ee.FormatterService,this.pivotService=new Rt.bY,this._removeRangesInfluencedBySheet=function(e){a.sheets.forEach((function(t){t.rangeModel.delRangesBySheet(e)}))},this.nextControl=xm("nextControl",null),this.previousControl=xm("previousControl",null),t&&t.store&&(this.store=t.store),this.options=Dm(s4,(function(e,t,r){a._onOptionChanged(e,t,r)})),this.options.IOCConfig=null==t?void 0:t.IOCConfig,Object.assign(this.options._ps,t),!1!==this.options.enableIdle?this._idle=new f2:this._idle=new d2,this.$watcher=new Ce.CPL,this.workbookIOC=X5({getCommandManager:this.commandManager.bind(this),getWorkbook:function(){return a},getWatchHub:this.watchHub.bind(this),isWorker:this.options.isWorker}),this.fIdleScheduler=new _t.FIdleScheduler(this._idle,10),this.formulaIdleScheduler=new J5(this._idle,10,_t.Direction.HEAD),null!=this.options&&!this.options.isWorker&&this.options.canUseWorker?this.calcEngine=new e2(this):this.calcEngine=new Q1(this),this.importFormulaManager=new XK(this),this.calcEngine.formulaService.setScheduler(this.formulaIdleScheduler),this.fiberTaskScheduler=new o2(this._idle),t&&t.IOCConfig&&this.bindWorkbookIOCService(t.IOCConfig),this._init(),this._context=r||WM,this.graphDataGenerator=new QM(this),this.permissionManager=new rF(this,this._context.isEmbed()||"history"===this.options.situation),this.isvRelationshipManager=new l2,this._blockManager=new t4,this.formatterService=new Ee.FormatterService("en",(function(e,t){return new Ee.I18NService(e,t,{currencies:Object.keys((0,Ce.w9Z)())})}),l4),this.importRangeManagerV3=new HE(this),this.importRangeManagerV3.V3Enable=Ce.Ps3.getImportRangeV3Enable()&&!Ce.Ps3.getImportRangeV2Enable(),this._pivotFormulaService=new TF(this),this.pivotService.setFormulaService(this._pivotFormulaService),this.pivotService.setI18n(cr),(0,Rt.Hi)(Ce.$1K),this.aiManager=vK({maxTask:20,retryTime:50,fetch:(n=(0,u.Z)(i().mark((function e(t,r){var n,o,u,s,l,c;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=a.userLanguage,o=a.getService(It.UU),u=o.token,s=o.memberId,l=Ce.Ps3.getSheetAiQuickActionEnabled()?YK.prefetchLLPPInfo():YK.prefetchAIActions(),e.t0=l instanceof Promise,!e.t0){e.next=5;break}return e.next=5,l;case 5:return c=t.map((function(e){if(Ce.Ps3.getSheetAiQuickActionEnabled()){var t=YK.getTaskKeyByActionType(e.action_type||"",n);return Object.assign({},e,{task_key:t})}var r=YK.getActionIdByActionType(e.action_type||"",n);return Object.assign({},e,{action_id:r})})),e.abrupt("return",Ce.Ps3.serverApi.aiRequest.getAiResult(c,u||"",Number(s||0),n||"en",r,!!a._context.getHistoryType()));case 7:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)}),resetOperateId:UK,getOperateId:HK})}return(0,_.Z)(e,[{key:"subscribe",value:function(e,t){return this.$watcher.subscribe(e,t)}},{key:"dispatch",value:function(e,t,r){this.$watcher.dispatch(e,t,r)}}]),(0,_.Z)(e,[{key:"resetPivotInWorker",value:function(){this._pivotDataSourceManagerV2||(this._pivotDataSourceManagerV2=this.workbookIOC.get(HV)),this.sheets.forEach((function(e){e.resetPivotTableManager()}))}},{key:"updateBlockReference",value:function(e){e&&(this._blockManager=new t4,this._blockManager.fromJSON(e))}},{key:"getBlockManager",value:function(){return this._blockManager}},{key:"getPivotDataSourceManager",value:function(){return this.getPivotDataSourceManagerV2()}},{key:"getPivotDataSourceManagerV2",value:function(){return this._pivotDataSourceManagerV2||(this._pivotDataSourceManagerV2=this.workbookIOC.get(HV)),this._pivotDataSourceManagerV2}},{key:"getPivotSyncModelManager",value:function(){return this._pivotSyncModelManager||(this._pivotSyncModelManager=this.options.isWorker?this.workbookIOC.get(WV):this.workbookIOC.get(zV)),this._pivotSyncModelManager}},{key:"bindWorkbookIOCService",value:function(e){if(e){var t=e.configWorkbookIOCService;t&&t(this.workbookIOC)}}},{key:"bindWorksheetIOCService",value:function(e){var t;e.parent=this.workbookIOC;var r=null===(t=this.options.IOCConfig)||void 0===t?void 0:t.configWorksheetIOCService;r&&r(e)}},{key:"watchHub",value:function(){return this._watchHub}},{key:"watchHubsOnRefOp",value:function(e){this.watchHubs.forEach((function(t){t.onRefOp(e)}))}},{key:"setUserPermissionManager",value:function(e){this.userPermissionManager&&(this.userPermissionManager.destroy(),this.userPermissionManager=null),this.userPermissionManager=e}},{key:"getUserPermissionManager",value:function(){return this.userPermissionManager}},{key:"getUserLanguage",value:function(){return this._userLang}},{key:"detectWorksheet",value:function(e){this.dispatch("LoadSheet",e)}},{key:"injectServices",value:function(e){e(this.workbookIOC)}},{key:"getService",value:function(e){return this.workbookIOC.get(e)}},{key:"unbindService",value:function(e){return this.workbookIOC.unbind(e)}},{key:"initFormulaCacheManager",value:function(){this.formulaCacheManager=new e4(this),this.setFormulaCache=this.formulaCacheManager.setFormulaCache.bind(this.formulaCacheManager),this.getFormulaId=this.formulaCacheManager.getFormulaId.bind(this.formulaCacheManager)}},{key:"setEmbedPermissionManager",value:function(e){this.embedPermissionManager&&(this.embedPermissionManager.destroy(),this.embedPermissionManager=null),this.embedPermissionManager=e}},{key:"getEmbedPermissionManager",value:function(){return this.embedPermissionManager}},{key:"commandManager",value:function(){return this._commandManager}},{key:"hookManager",value:function(){return this._hookManager}},{key:"undoManager",value:function(){return this._undoManager}},{key:"_init",value:function(){var e=this;if(!this.options.embed){var t=this.createWorksheet("1",e._getDefaultSheetName(0),!1);e.sheets.push(t),t._onAttached(e),e.updateSheetArrayInternalState()}}},{key:"_getDefaultSheetName",value:function(e){var t=this,r=this.sheets.filter((function(e){return!e.blockId})).length;t._availableSheetIndex<r?t._availableSheetIndex=r:t._availableSheetIndex++,(Or(e)||e<t._availableSheetIndex)&&(e=t._availableSheetIndex);var n,a=!1,o=t.sheets;do{n="Sheet"+(e+1);for(var i=o.length,u=0;u<i;u++)if(u in o){if(o[u]._name===n){e++,a=!0;break}a&&(a=!1)}}while(a);return n}},{key:"_dispose",value:function(){var e,t,r,n=this,a=n.sheets;for(n._disposeUserEvents(),r=0;r<a.length;r++)a[r]._dispose(!0);a.splice(0,a.length),n.sheetIdToIndexMap.clear(),n.fiberTaskScheduler.clear(),n._bitableBlockNum=0,n.isvRelationshipManager=null,n._userEventsElem=null,delete n._undoManager,delete n.graphDataGenerator,n.permissionManager&&!n.options.remainUserPerms&&(n.permissionManager.destroy(),delete n.permissionManager),delete n._commandManager,delete n._hookManager,Ca._dispose(),n.uiEvents.removeAllListeners(),this.userPermissionManager&&!n.options.remainUserPerms&&this.userPermissionManager.destroy(),this.embedPermissionManager&&this.embedPermissionManager.destroy(),this.formatterService.dispose(),this.importRangeManager.dispose(),this.importRangeManagerV3.dispose(),this.importFormulaManager.dispose(),this.calcEngine.dispose(),this.pivotService.dispose(),null!==(e=this.getPivotDataSourceManager())&&void 0!==e&&e.dispose(),this._pivotDataSourceManagerV2=void 0,this.getPivotSyncModelManager().dispose(),this._idle.destroy(),this.$watcher.destroy(),this.taskQueue.destroy(),this.changesetExec.destroy(),n.calcEngine.dispose(),delete n.calcEngine,null===(t=this.formulaCacheManager)||void 0===t||t.destroy()}},{key:"_disposeUserEvents",value:function(){var e=this.sheets;r4(this._userEventsElem).unbind(n4);for(var t=0;t<e.length;t++)e[t]._disposeUserEvents()}},{key:"destroy",value:function(){this.clearSubscriber(),this._dispose(),this.activeSheet$.complete(),this.unbindAll(),this.workbookIOC.unbindAll(),this._watchHub.clear()}},{key:"clearSubscriber",value:function(){this.subscriber.forEach((function(e){e.unsubscribe()})),this.subscriber.clear()}},{key:"unSubscribe",value:function(e){var t=this.subscriber.get(e);t&&(t.unsubscribe(),this.subscriber.delete(e))}},{key:"getBitableBlockNum",value:function(){return this._bitableBlockNum}},{key:"updateSheetArrayInternalState",value:function(){this.updateBitableBlockNum(),this.updateIdToIndexMapping()}},{key:"updateBitableBlockNum",value:function(){this._bitableBlockNum=this.sheets.reduce((function(e,t){return i2(t)?e+1:e}),0)}},{key:"updateIdToIndexMapping",value:function(){var e=this;this.sheetIdToIndexMap.clear(),this.sheets.forEach((function(t,r){e.sheetIdToIndexMap.set(t.id(),r)}))}},{key:"getActiveSheet",value:function(){return this.sheets[this.getActiveSheetIndex()]}},{key:"setActiveSheet",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.sheets,n=0;n<r.length;n++)r[n].name()===e&&this._setActiveSheetIndexImp(n,{triggerEvent:t})}},{key:"setActiveSheetById",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=this.sheets,a=0;a<n.length;a++)n[a].id()===e&&this._setActiveSheetIndexImp(a,{triggerEvent:t,source:r})}},{key:"getActiveSheetIndex",value:function(){return this._activeSheetIndex}},{key:"setActiveSheetIndexCore",value:function(e){e<0&&(e=0),this._activeSheetIndex=e}},{key:"_addSheet",value:function(e,t,r){this._addSheetImp(e,2,t,r)}},{key:"removeSheet",value:function(e,t){var r=this.sheets[e];arguments.length>0&&this._removeSheetImp(e,t),this.unSubscribe(r.id())}},{key:"_hideSheet",value:function(e){var t=1;arguments.length>0&&this._hideSheetImp(e,t)}},{key:"_moveSheet",value:function(e,t,r,n){this._moveSheetImpl(e,t,r,n)}},{key:"_setActiveSheetIndexImp",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{triggerEvent:!0};if(-1!==e&&"number"==typeof e){var r=this;if(null!=t&&t.forceUpdate||e!==r.getActiveSheetIndex()){var n=null==t?void 0:t.prevSheet,a=r.sheets[e];if(a&&a.visible())if(null!=t&&t.forceUpdate||!n||n!==a){var o=o4(r),i={oldSheet:o,newSheet:a,triggerEvent:t.triggerEvent};this.dispatch("BeforeActiveSheetChange",i),this.setActiveSheetIndexCore(e),a!==o&&(o&&o._dispose(!1),this._setActiveSheetImp(i)),t.triggerEvent&&window.dispatchEvent((0,Ce.t35)("sheet:mobile:activeSheetChanged",{detail:Object.assign(i,{source:null==t?void 0:t.source})}))}else this.setActiveSheetIndexCore(e)}}}},{key:"_setActiveSheetImp",value:function(e){var t=e.newSheet,r=e.oldSheet,n=e.triggerEvent;(void 0===n||n)&&this.dispatch("ActiveSheetChanged",{newSheet:t,oldSheet:r||void 0}),this.activeSheet$.next(t);var a=t.id();this.fiberTaskScheduler.updateSheet(a)}},{key:"_addSheetImp",value:function(e,t,r,n){this.doAddSheet(e,r),r.getCalcEngine().recoverInvalidRefs(r),this.dispatch("SheetAdded",{sheet:r},n)}},{key:"checkNameValidity",value:function(e){for(var t=this.sheets,r=t.length,n=0;n<r;n++)if(t[n]._name===e._name)throw console.error("SheetName Repeat ".concat(n," ").concat(e._name)),new Error("NotSupportException SheetName Repeat")}},{key:"updateSheetsByInsertSheet",value:function(e,t){this.sheets.splice(e,0,t),this.updateSheetArrayInternalState()}},{key:"getActiveIndexByInsertSheet",value:function(e){var t=this.sheets.length,r=this.getActiveSheetIndex();return 1===t&&r>=0?0:(r<0?r=this._getNextVisibleIndex(r):r>=e&&r++,r)}},{key:"getRangeDatas",value:function(e,t){var r=this.getSheetFromId(e);return r?r.getRangeDatas(t):[]}},{key:"getColHeaderWidth",value:function(e){var t=this.getSheetFromId(e);return null==t?void 0:t.getColHeaderWidth()}},{key:"getRowHeaderHeight",value:function(e){var t=this.getSheetFromId(e);return null==t?void 0:t.getRowHeaderHeight()}},{key:"scrollTo",value:function(e,t,r){var n=this.getSheetFromId(e);return n&&n.scrollTo(t,r)}},{key:"scroll",value:function(e,t,r){var n=this.getSheetFromId(e);return n&&n.scroll({posX:t,posY:r})}},{key:"getCellRect",value:function(e,t,r){var n=this.getSheetFromId(e);return null==n?void 0:n.getCellRect(t,r)}},{key:"getHiddenCols",value:function(e){var t=this.getSheetFromId(e);return null==t?void 0:t.getHiddenCols()}},{key:"getHiddenRows",value:function(e){var t=this.getSheetFromId(e);return null==t?void 0:t.getHiddenRows()}},{key:"doAddSheet",value:function(e,t){var r=this;t._name?this.checkNameValidity(t):t._name=r._getDefaultSheetName(e);var n=this.getActiveSheet();r._copyUserEvents(t),t._onAttached(r),this.updateSheetsByInsertSheet(e,t);var a=this.getActiveIndexByInsertSheet(e);this._setActiveSheetIndexImp(a,{triggerEvent:!1,prevSheet:n})}},{key:"setWorkbookHasArrayFormula",value:function(e){this._hasArrayFormula=e}},{key:"hasArrayFormula",value:function(){return this._hasArrayFormula}},{key:"initAddSheet",value:function(e,t){this.doAddSheet(e,t)}},{key:"_getPreVisibleIndex",value:function(e){for(var t=this.sheets,r=e-1;r>=0;r--){var n=t[r];if(n&&n.visible())return r}return 0}},{key:"_getNextVisibleIndex",value:function(e){for(var t=this.sheets,r=t.length,n=e+1;n<r;n++){var a=t[n];if(a&&a.visible())return n}return 0}},{key:"_hideSheetImp",value:function(e,t){var r=this.sheets,n=r.length;if(isNaN(e)||e<0||e>=n)throw new Error("Index is out of range!");r[this.getActiveSheetIndex()].getHiddenStatus()&&this._setActiveSheetIndexImp(this.pickUnhiddenSheetIndex())}},{key:"pickUnhiddenSheet",value:function(e){var t=this.pickUnhiddenSheetIndex(e);return this.sheets[t]}},{key:"pickUnhiddenSheetIndex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.sheets,r=t.length;e=e||0,arguments.length<=0&&(e=this.getActiveSheetIndex());var n,a=-1;for(n=e;n<r;n++){var o=t[n];if(o&&!o.getHiddenStatus()){a=n;break}}if(-1===a)for(n=e-1;n>=0;n--)if(!t[n].getHiddenStatus()){a=n;break}return(n>=r||n<0)&&(a=0),a}},{key:"_removeSheetImp",value:function(e,t){var r=this,n=r.sheets,a=n.length;if(isNaN(e)||e<0||e>=a)throw new Error("Index is out of range!");var o=e<=r.getActiveSheetIndex()||e===a-1,i=o4(r),u=r.getActiveSheetIndex();e<r.getActiveSheetIndex()&&r.setActiveSheetIndexCore(--u);var s=n[e],l=r.getCalcEngine();l.unregisterFormulas(s);var c=new vu(!0,"delete",0,s.getRowCount(),s),h=new vu(!1,"delete",0,s.getColumnCount(),s);if(this.watchHubsOnRefOp(c),this.watchHubsOnRefOp(h),l.depRefManager.onRefOp(new mu(s)),s._disposeUserEvents(),n.splice(e,1),this.updateSheetArrayInternalState(),this.setActiveSheetIndexCore(this.pickUnhiddenSheetIndex()),this._removeRangesInfluencedBySheet(s.id()),l.pivotCalculateEngine.destoryBySheetId(s.id()),o){var f=n[r.getActiveSheetIndex()];if(i!==f&&(i&&i._dispose(!1),f)){var d={oldSheet:i,newSheet:f};r._setActiveSheetImp(d)}}this.dispatch("SheetRemoved",{sheet:s},t)}},{key:"_clearSheetsImpl",value:function(){for(var e=this.sheets,t=0;t<e.length;t++)e[t]._disposeUserEvents(),e[t]._dispose(!1);e.splice(0,e.length),this._bitableBlockNum=0,this.setActiveSheetIndexCore(0)}},{key:"getSheetFromIndex",value:function(e){var t=this.sheets;return e>=0&&e<t.length?t[e]:null}},{key:"getSheetFromId",value:function(e){var t=null,r=this.sheetIdToIndexMap.get(e);if(!(0,ye.default)(r)&&((t=this.getSheetFromIndex(r))&&t.id()===e))return t;var n=this.sheets;this.sheetIdToIndexMap.clear();for(var a=0;a<n.length;a++){var o=n[a].id();o===e&&(t=n[a]),this.sheetIdToIndexMap.set(o,a)}return t}},{key:"removeSheetFromId",value:function(e){for(var t=this.sheets,r=0,n=t.length;r<n;r++){var a=t[r];if(a&&a.id()===e){this.removeSheet(r);break}}}},{key:"getSheetFromName",value:function(e){for(var t=this.sheets,r=0;r<t.length;r++)if(t[r].name()===e)return t[r];return null}},{key:"getSheetIds",value:function(){for(var e=this.sheets,t=[],r=0;r<e.length;r++)t.push(e[r].id());return t}},{key:"getSheetIndex",value:function(e){for(var t=this.sheets,r=0;r<t.length;r++)if(t[r].name()===e)return r;return null}},{key:"getSheetIndexFromId",value:function(e){for(var t=this.sheets,r=0;r<t.length;r++)if(t[r].id()===e)return r;return null}},{key:"getSheetCount",value:function(){return this.sheets.length}},{key:"getVisiableSheetsLength",value:function(){var e=this.sheets,t=0;return e.forEach((function(e){e.getHiddenStatus()||t++})),t}},{key:"getISVRelationshipManager",value:function(){return this.isvRelationshipManager}},{key:"bind",value:function(e,t,r){var n=this,a=n.sheets;n._userEvents.push({type:e,data:t,fn:r}),r4(n._userEventsElem).bind(e+n4,t,r);for(var o=0;o<a.length;o++)a[o].bind(e,t,r)}},{key:"unbind",value:function(e,t){for(var r=this,n=r.sheets,a=r._userEvents,o=0;o<a.length;o++){var i=a[o];i.type!==e||t&&t!==i.data&&t!==i.fn||a.splice(o,1)}r4(r._userEventsElem).unbind(e+n4,t);for(var u=0;u<n.length;u++)n[u].unbind(e,t)}},{key:"unbindAll",value:function(){var e=this,t=e.sheets;e._userEvents.length=0,r4(e._userEventsElem).unbind(n4);for(var r=0;r<t.length;r++)t[r].unbindAll()}},{key:"_bind",value:function(e,t,r){var n=this,a=n.sheets;n._userEvents.push({type:e,data:t,fn:r}),r4(n._userEventsElem).bind(e+a4,t,r);for(var o=0;o<a.length;o++)a[o]._bind(e,t,r)}},{key:"_unbind",value:function(e,t){for(var r=this,n=r.sheets,a=r._userEvents,o=0;o<a.length;o++){var i=a[o];i.type!==e||t&&t!==i.data&&t!==i.fn||a.splice(o,1)}r4(r._userEventsElem).unbind(e+a4,t);for(var u=0;u<n.length;u++)n[u]._unbind(e,t)}},{key:"_unbindAll",value:function(){var e=this,t=e.sheets;e._userEvents.length=0,r4(e._userEventsElem).unbind(a4);for(var r=0;r<t.length;r++)t[r]._unbindAll()}},{key:"trigger",value:function(e,t){this._trigger(e,t)}},{key:"_trigger",value:function(e,t){0===this._eventSuspended&&r4(this._userEventsElem).trigger(e,t)}},{key:"_copyUserEvents",value:function(e){for(var t=this._userEvents,r=0;r<t.length;r++){var n=t[r];e.bind(n.type,n.data,n.fn)}}},{key:"suspendEvent",value:function(){var e=this.sheets;this._eventSuspended++;for(var t=0;t<e.length;t++){var r=e[t];r&&r.suspendEvent()}}},{key:"resumeEvent",value:function(){var e=this,t=e.sheets;e._eventSuspended--,e._eventSuspended<0&&(e._eventSuspended=0);for(var r=0;r<t.length;r++){var n=t[r];n&&n.resumeEvent()}}},{key:"forceResumeEvent",value:function(){for(;this._eventSuspended>0;)this.resumeEvent()}},{key:"_moveSheetImpl",value:function(e,t,r,n){var a=this.sheets,o=t,i=e,u=-1,s=this.getActiveSheet();if(-1!==o&&-1!==i&&i!==o){var l,c=this.sheets,h=c[i];if(i>o){for(l=i;l>o;l--)c[l]=c[l-1];c[o]=h,u=o}else if(i<o){for(l=i;l<o;l++)c[l]=c[l+1];c[o]=h,u=o}if(r)this.setActiveSheetIndexCore(u);else{for(l=0;l<a.length;l++)a[l]===s&&(u=l);this.setActiveSheetIndexCore(u)}}this.dispatch("SheetMoved",{sourceIndex:e,targetIndex:t},n)}},{key:"reorder",value:function(e){var t=this.sheets,r=t[this.getActiveSheetIndex()],n=0,a=t.reduce((function(e,t){return e[t.id()]=t,e}),{}),o=e.map((function(e,t){var o=a[e];return o===r&&(n=t),o})).filter((function(e){return void 0!==e}));this.sheets=o,this.updateSheetArrayInternalState(),this.setActiveSheetIndexCore(n)}},{key:"getCalcEngine",value:function(){return this.calcEngine}},{key:"applyAction",value:function(e,t,r,n){this.changesetExec.batchExecBegin();var a=this.changesetExec.execAction(this,e,t,r,void 0,n);return this.changesetExec.batchExecFinish(),a}},{key:"applyBatchAction",value:function(e,t,r,n){return this.changesetExec.execAction(this,e,t,r,void 0,n)}},{key:"batchExecBegin",value:function(){this.changesetExec.batchExecBegin()}},{key:"batchExecFinish",value:function(){this.changesetExec.batchExecFinish()}},{key:"applyActions",value:function(e,t,r,n){var a=this;this.dispatch("AnalyzeActionDeps",{actions:e,local:r,fromUndoRedo:n}),this.taskQueue.addTask((function(){a.dispatch("BeforeApply",{actions:e,local:r,fromUndoRedo:n}),t||a.suspendEvent(),a.changesetExec.execBatchActions(a,e,t,r,n),t||a.resumeEvent(),a.dispatch("AfterApply",{actions:e,local:r,fromUndoRedo:n})}))}},{key:"suspendActions",value:function(){this.taskQueue.suspend()}},{key:"resumeActions",value:function(){this.taskQueue.resume()}},{key:"throwError",value:function(e,t){this.dispatch("SpreadError",{type:e,context:t})}},{key:"notifySheetSoftDeleted",value:function(e){this.getSheetFromId(e)&&this.dispatch("SheetSoftDeleted",{sheetId:e})}},{key:"registerCsPreare",value:function(e){this.changesetExec.registerCsPreare(e)}},{key:"registerCsFinish",value:function(e){this.changesetExec.registerCsFinish(e)}},{key:"proxyChangeset",value:function(e){this.changesetExec.registerProxy(e)}},{key:"updateChangesetOpts",value:function(e){this.changesetExec.updateOptions(e)}},{key:"setChangesetExecStrategy",value:function(e){this.changesetExec.setStrategy(e)}},{key:"getCellFormulaValidation",value:function(e,t,r){return this.getCellFormulaErrorValidation(e,t,r)}},{key:"getCellFormulaErrorValidation",value:function(e,t,r){var n=e.getVar(t,r);return Kp(e,n)}},{key:"hasFormula",value:function(e,t){return(0,V.Z)(this.sheets,(function(e){return e.hasFormula()}))}},{key:"setHook",value:function(e,t){this._hookManager&&this._hookManager.setHook(e,t)}},{key:"setHooks",value:function(e,t){this._hookManager&&this._hookManager.setHooks(e,t)}},{key:"removeHook",value:function(e,t){this._hookManager&&this._hookManager.removeHook(e,t)}},{key:"sheetIdle",get:function(){return this._idle}},{key:"watchHubs",get:function(){var e=[this.watchHub()];return this.sheets.forEach((function(t){return t.watchHubs.forEach((function(t){return e.push(t)}))})),e}},{key:"userLanguage",get:function(){return this._userLang},set:function(e){this._userLang=e}}]),e}();c4._defaultOptions=s4,c4._defaultSheetCount=1,c4._defaultActiveSheetIndex=0;var h4=function(){function e(){(0,y.Z)(this,e),this.executors=new Map}return(0,_.Z)(e,[{key:"registerMutation",value:function(e){if(this.executors.has(e.mutationType))throw new Error("duplicated register, Mutation: ".concat(e.mutationType));this.executors.set(e.mutationType,e)}},{key:"getMutationExecutor",value:function(e){return e?this.executors.get(e):void 0}}]),e}(),f4=new h4,d4=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"batchExecBegin",value:function(e){var t;this.execContext=null!==(t=e)&&void 0!==t?t:{}}},{key:"excuteMutationImpl",value:function(e,t,r){var n=f4.getMutationExecutor(t.type);if(n){var a=n.execute(e,t,this.execContext,r);return n.batchDone&&n.batchDone(e,this.execContext),a}console.error(new Error("Error: unknown Mutation ".concat(t.type)))}},{key:"batchExecFinish",value:function(e){this.execContext={}}}]),e}(),v4=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).batchDoneSet=new Set,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"excuteMutationImpl",value:function(e,t,r){var n=this,a=f4.getMutationExecutor(t.type);if(a){this.batchDoneSet.forEach((function(r){r.needBatchDone&&r.needBatchDone(t,n.execContext)&&r.batchDone&&(r.batchDone(e,n.execContext),n.batchDoneSet.delete(r))}));var o=a.execute(e,t,this.execContext,r);return a.batchDone&&this.batchDoneSet.add(a),o}console.error(new Error("Error: unknown Mutation ".concat(t.type)))}},{key:"batchExecFinish",value:function(e){var r=this;this.batchDoneSet.size&&this.batchDoneSet.forEach((function(t){t.batchDone&&t.batchDone(e,r.execContext)})),this.batchDoneSet.clear(),(0,f.Z)((0,v.Z)(t.prototype),"batchExecFinish",this).call(this,e)}}]),t}(d4),p4=function(){function e(){(0,y.Z)(this,e),this.strategy=new v4}return(0,_.Z)(e,[{key:"applyCommands",value:function(e,t,r){var n;if(null!=t&&null!==(n=t.commands)&&void 0!==n&&n.length){var a,o=yr(t.commands);try{for(o.s();!(a=o.n()).done;){var i=a.value,u=Object.assign({},r,{sheetId:i.sheetId});i.type===Ce.B2l.CommandType.CommandType_RESOURCE_SNAPSHOT&&(u.resourceRefs=i.resourceRefs),this.strategy.batchExecBegin(u),i.mutations&&this.applyMutations(e,i.mutations),this.strategy.batchExecFinish(e)}}catch(e){o.e(e)}finally{o.f()}}}},{key:"applyMutations",value:function(e,t){var r,n=yr(t);try{for(n.s();!(r=n.n()).done;){var a=r.value;this.strategy.excuteMutationImpl(e,a)}}catch(e){n.e(e)}finally{n.f()}}}]),e}(),m4=function(){function e(){(0,y.Z)(this,e),this.filterStrings=new LS,this.dateGroupItems=new $S}return(0,_.Z)(e,[{key:"getCommandResourceRefs",value:function(){return{filterStrings:xS(this.filterStrings.toArray()),dateGroupItems:xS(this.dateGroupItems.toArray())}}}]),e}(),g4=Ce.B2l.CommandType.CommandType_TOP_SNAPSHOT,y4=Ce.B2l.CommandType.CommandType_RESOURCE_SNAPSHOT,_4=Ce.B2l.CommandType.CommandType_TABLE_SNAPSHOT;function R4(e){var t,r=new Set(null!==(t=e)&&void 0!==t?t:[g4,y4,_4]),n={};return r.forEach((function(e){e===g4&&(n[g4]={commands:[]}),e===y4&&(n[y4]={commands:[]}),e===_4&&(n[_4]={commands:[]})})),n}var C4=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).mutationExec=new p4,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"serialize",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=R4(t.typeArr),n=null===(e=r[g4])||void 0===e?void 0:e.commands;return n&&n.push({type:g4,mutations:[this.serializeWorkbookMutation()]}),this.serializeWorksheetMutations(r,t),r}},{key:"serializeWorkbookMutation",value:function(){var e,t=this.defaults;if(t){var r=FR(Om.fromJSON(this.formatterService,t.style));e={styles:{numFmt:r.numFmt,font:r.font,fill:r.fill,border:r.border,alignment:r.alignment},format:{defaultColWidth:t.colWidth,defaultRowHeight:t.rowHeight,lineHeightFactor:t.lineHeightFactor,inlineAlign:t.inlineAlign,cellPadding:{top:t.cellPadding[0],right:t.cellPadding[1],bottom:t.cellPadding[2],left:t.cellPadding[3]}}}}var n={workbookPr:{lang:this.lang,locale:this.locale},defaults:e};return{type:Ce.B2l.MutationType.MutationType_SetWorkbookProperties,setWorkbookProperties:n}}},{key:"serializeWorksheet",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=R4(r.typeArr);return this.serializeWorksheetImp(e,t,n,r)}},{key:"serializeWorksheetImp",value:function(e,t,r){var n,a,o,i,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=null===(n=r[g4])||void 0===n?void 0:n.commands,l=null===(a=r[y4])||void 0===a?void 0:a.commands,c=null===(o=r[_4])||void 0===o?void 0:o.commands;s&&s.push({type:g4,mutations:e.serializeTopSnapshot(t,u),sheetId:u.customSheetId||e.id()});var h=u.isForShortcut,f=u.customSheetId,d=u.gridRanges,v=[{}];if(null!=d&&d.length&&(v=d.filter((function(t){return t.sheetId===e.id()})),null===(i=v)||void 0===i||!i.length))return r;if(l){var p=new m4,m=e.serializeResourceSnapshot(p,u);h&&d&&(0,Ce.hTd)(m,e.serializePTViewDataModel(d)),l.push({type:y4,mutations:m,sheetId:f||e.id(),resourceRefs:p.getCommandResourceRefs()})}if(c){var g=[];v.forEach((function(t){var r={gridRange:t,isForShortcut:h,gridOffset:h?{row:0,col:0}:void 0,customSheetId:u.customSheetId},n=e.serializeTableSnapshot(r).mutation;n.type===Ce.B2l.MutationType.MutationType_SetRangeValues&&g.push(n)})),g.length&&c.push({type:_4,mutations:g,sheetId:f||e.id()})}return r}},{key:"serializeWorksheetMutations",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getSheetCount(),n=0;n<r;n++){var a=this.getSheetFromIndex(n);a&&this.serializeWorksheetImp(a,n,e,t)}return e}},{key:"encodeCommandsMap",value:function(e){for(var t={},r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];t[a]=this.encodeCommands(e[a])}return t}},{key:"encodeCommands",value:function(e){return(0,Ce.J1c)(e)}},{key:"decodeCommandsMap",value:function(e){for(var t={},r=0,n=Object.keys(e);r<n.length;r++){var a=n[r];t[a]=this.decodeCommands(e[a])}return t}},{key:"decodeCommands",value:function(e){return(0,Ce.Z6r)(e)}},{key:"applyCommandsMap",value:function(e,t){for(var r=0,n=Object.keys(e);r<n.length;r++){var a=e[n[r]];this.mutationExec.applyCommands(this,a,t)}}},{key:"applyCommands",value:function(e,t){this.mutationExec.applyCommands(this,e,t)}},{key:"applyMutationSnapshot",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{isApplySnapshot:!0},n=e.gzipTopSnapshot,a=e.topSnapshot,o=e.gzipResource,i=e.resource,u=e.blocks,s=e.cellBlockMetaMap,l=e.blocksCommands,c=a||(n?this.decodeCommands(n):void 0),h=i||(o?this.decodeCommands(o):void 0);c&&this.executeMutations(c,r),this.executeMutations(h,r),u&&Object.keys(u).forEach((function(e){var n;if(s&&s[e]){var a=s[e].range;n={row:a.rowStart,col:a.colStart}}var o=null!=l&&l[e]?null==l?void 0:l[e]:t.decodeCommands(u[e]);t.executeMutations(o,Object.assign({},r,{offsetRange:n}))}))}},{key:"executeMutations",value:function(e,t){e&&this.applyCommands(e,t)}}]),t}(c4),w4=new Set(["IOCConfig","_ps","enableIdle"]);function E4(e,t){return void 0!==t[e]||w4.has(e)}var k4=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"toJSON",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={};(0,L.Z)(this.options,(function(e,t){w4.has(t)||c4._defaultOptions[t]===e||(r[t]=e)}));var n=this.getSheetCount();r.sheetCount=n;var a=this.getActiveSheetIndex();e&&e.isServerExport||a===c4._defaultActiveSheetIndex||(r.activeSheetIndex=a);for(var o={},i=0;i<n;i++){var u=this.getSheetFromIndex(i);u&&(o[u._name]=u.toJSON(e,t),o[u._name].index=i)}return(0,ue.default)(o)||(r.sheets=o),r.lang=this.lang,r.locale=this.locale,r.schemaVersion=1,r.hasArrayFormula=this.hasArrayFormula(),r.defaults=this.defaults,r}},{key:"fromJSON",value:function(e){var t=this;if(e){this.lang=e.lang,this.locale=e.locale,this.initFormulaCacheManager(),this.setWorkbookHasArrayFormula(!0===e.hasArrayFormula),this.getUserLanguage(),this.formatterService.i18n.setLanguage(this.lang||this.getUserLanguage()),(0,Ce.sus)("zh-CN"),"object"==(0,R.Z)(e.defaults)?this.defaults=Object.assign(e.defaults,this.defaults||{}):void 0===e.defaults&&"object"==(0,R.Z)(this.defaults)&&(e.defaults=this.defaults),this.suspendEvent();try{this._availableSheetIndex=-1,this._clearSheetsImpl();var r=c4._defaultOptions;for(var n in r)if(!E4(n,this.options)){var a=e[n];this.options[n]=Fm(a)?a:r[n]}var o=e.sheetCount;Fm(o)||(o=c4._defaultSheetCount);var i=e.sheets;if(i){var u=(0,O.Z)(i).sort((function(e,t){return e.index=e.index||0,t.index=t.index||0,e.index-t.index})),s=[];u.forEach((function(e,r){e.index=r;var n=t.createWorksheetByData(e),a=n.constructor;t.initAddSheet(r,n);var o=e.rowCount||a._defaultRowCount,i=e.columnCount||a._defaultColCount;n.setRowCount(o),n.setColumnCount(i),s.push({sheet:n,data:e,schema:!1})})),s.forEach((function(t){t.sheet.fromJSON(t.data,!1,t.schema,e)}))}var l=e.activeSheetIndex;Fm(l)||(l=c4._defaultActiveSheetIndex)}finally{this.resumeEvent()}}}},{key:"createWorksheetByData",value:function(e){return this.createWorksheet(e.id,e.name,e.hidden)}}]),t}(C4),T4=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"addSheet",value:function(e,t){return this._executeCmdBase(Ce.rvF.ADD_SHEET,{sheetName:e,index:t})}},{key:"delSheet",value:function(e){return this._executeCmdBase(Ce.rvF.DELETE_SHEET,{sheetId:e})}},{key:"copySheet",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._executeCmdBase(Ce.rvF.COPY_SHEET,Object.assign({sheetId:e},t))}},{key:"moveSheet",value:function(e,t,r){return this._executeCmdBase(Ce.rvF.MOVE_SHEET,{sheetId:e,sourceIndex:t,targetIndex:r})}},{key:"renameSheet",value:function(e,t){var r=this.getSheetFromId(e);if(!r)return!1;if(t!==r.name()){var n=function(e,t,r){var n=[];if(!e)return[4];if(!e||!(0,ce.Z)(e))return[1];if(e.length>100&&n.push(2),/[*:/?[\]\\]/.test(e)&&n.push(1),n.length>0)return n;if(!t)return[0];for(var a=0,o=t.length;a<o;a++){var i=t[a];if(r!==i&&e===i._name)return[3]}return[0]}(t,this.sheets,r);if(0===n[0])return this._executeCmdBase(Ce.rvF.SET_SHEET_PROPERTY,{sheetId:e,name:t,property_name:"name"});r.dispatch("InvalidOperation",{invalidSheetName:t,invalidType:5,subInvalidType:n})}return!1}},{key:"hideSheet",value:function(e){return this._executeCmdBase(Ce.rvF.SET_SHEET_PROPERTY,{sheetId:e,hidden:!0,property_name:"visibility"})}},{key:"unhideSheet",value:function(e){return this._executeCmdBase(Ce.rvF.SET_SHEET_PROPERTY,{sheetId:e,hidden:!1,property_name:"visibility"})}},{key:"hideGridLine",value:function(e,t){return this._executeCmdBase(Ce.rvF.SET_SHEET_PROPERTY,{sheetId:e,grid_line_hidden:t,property_name:"gridLine"})}},{key:"setTabColor",value:function(e,t){return this._executeCmdBase(Ce.rvF.SET_SHEET_PROPERTY,{sheetId:e,tab_color:t,property_name:"tabColor"})}},{key:"setTabType",value:function(e,t){return this._executeCmdBase(Ce.rvF.SET_SHEET_PROPERTY,{sheetId:e,tab_type:t,property_name:"tabType"})}},{key:"protectSheet",value:function(e,t,r,n){return this._executeCmdBase(Ce.rvF.LOCK_SHEET,{sheetId:e,lockInfo:t,permId:r,creatorId:n})}},{key:"unprotectSheet",value:function(e,t){return this._executeCmdBase(Ce.rvF.UNLOCK_SHEET,{sheetId:e,permId:t})}},{key:"setDataRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e&&e.length)return this._executeCmdBase(Ce.rvF.SET_DATA_RANGE,{commandType:0,dontAddToCommandStack:t,data:e})}},{key:"delDataRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._executeCmdBase(Ce.rvF.SET_DATA_RANGE,{commandType:1,dontAddToCommandStack:t,data:e})}},{key:"_executeCmdBase",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null!==(t=null===(r=this.commandManager())||void 0===r?void 0:r.execute(Object.assign({cmd:e,sheetId:this.getActiveSheet().id()},n)))&&void 0!==t&&t}}]),t}(k4),S4=function(){function e(){var t=this;(0,y.Z)(this,e),this._suspendCount=0,this.suspendKeyBoardEventCallback=function(e){t._suspendCount>0&&(e.preventDefault(),e.stopImmediatePropagation())},this.suspendEvent=function(){++t._suspendCount},this.resumeEvent=function(){t._suspendCount>0?--t._suspendCount:t._suspendCount=0},window.addEventListener("keydown",this.suspendKeyBoardEventCallback,!0),window.addEventListener("keypress",this.suspendKeyBoardEventCallback,!0),window.addEventListener("keyup",this.suspendKeyBoardEventCallback,!0)}return(0,_.Z)(e,[{key:"destory",value:function(){window.removeEventListener("keydown",this.suspendKeyBoardEventCallback,!0),window.removeEventListener("keypress",this.suspendKeyBoardEventCallback,!0),window.removeEventListener("keyup",this.suspendKeyBoardEventCallback,!0)}}]),e}(),A4=(0,l.Z)({},Ce.kHU.BITABLE_BLOCK,"Database"),I4=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).checkUseAnonymousLogin=null,e.permissionVersion=0,e.handleSheetPropagation=function(t){var r=t.type,n=t.props,a=t.$sheet,o=t.source;e.$watcher.dispatch(r,n,a,o)},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setUndoManger",value:function(e){this._undoManager=e}},{key:"getSheetsChangeEvents",value:function(){return["SheetAdded","SheetRemoved","SheetMoved","ActiveSheetChanged","PermissionChanged","Renamed","SheetHidden","SheetVisible"]}},{key:"setActiveSheetId",value:function(e,t,r){for(var n=this.sheets,a=0;a<n.length;a++)if(n[a].id()===e){this._setActiveSheetIndexImp(a,{triggerEvent:t,source:r});break}}},{key:"_onOptionChanged",value:function(e,t,r){"allowUndo"===e&&this._undoManager&&(this._undoManager._allowUndo=t)}},{key:"toggleShowProtectedRange",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!this.options.isShowProtectedRange;this.options.isShowProtectedRange=e;var t=this.getActiveSheet();return t&&t.notifyShell(47),t&&t.dispatch("ProtectedRangeChanged"),e}},{key:"setActiveSheetIndex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0;this._setActiveSheetIndexImp(e,{triggerEvent:t,forceUpdate:r})}},{key:"removeSheetFromId",value:function(e){for(var t=this.sheets,r=0,n=t.length;r<n;r++){var a=t[r];if(a&&a.id()===e){this.removeSheet(r);break}}}},{key:"getAllMentionsInSpread",value:function(){var e=this.sheets,t=[];return e.forEach((function(e){(0,Ce.hTd)(t,e.getAllMentionsInSheet())})),t}},{key:"getAllUserMentionsInSpread",value:function(){var e=this.sheets,t=[];return e.forEach((function(e){var r=e.getAllMentionsInSheet();(0,Ce.hTd)(t,r.filter((function(e){return 0===e.other.mentionType})))})),t}},{key:"onSetActiveBlock",value:function(e){var t=this;this.sheets.some((function(r){return r.blockToken===e&&(t.setActiveSheet(r.name(),!0),!0)}))}},{key:"_init",value:function(){var e=this;if((0,f.Z)((0,v.Z)(t.prototype),"_init",this).call(this),!0!==this.options.isWorker){this.keyboardEventSuspendHelper=new S4;var r=Ce.Ps3.imageHelper.ImageWorker;r&&(this._imageWorker=new r(this)),this._undoDispatcher=new Pr,this._undoManager=new Lr(this,-1,this.options.allowUndo,this._undoDispatcher);var n=this._commandManager=new Zr(this);n.addListener("workbookUndo",(function(t){var r=n[t.command.cmd];r&&r.canUndo()&&e.undoManager()._addCommand(t.command,t._actionType)})),this._hookManager=new fn(this)}}},{key:"_dispose",value:function(){(0,f.Z)((0,v.Z)(t.prototype),"_dispose",this).call(this),this.cacheSubscription&&(this.cacheSubscription.unsubscribe(),this.cacheSubscription=null),this._imageWorker&&(this._imageWorker.destroy(),this._imageWorker=null),this._undoDispatcher&&(this._undoDispatcher.clear(),delete this._undoDispatcher);var e=this._undoManager;e&&(e.dispose(),delete this._undoManager),this.blockManager=void 0,this.keyboardEventSuspendHelper&&(this.keyboardEventSuspendHelper.destory(),this.keyboardEventSuspendHelper=null)}},{key:"createWorksheet",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new zM(e,t,r,this);return this.dispatch("SheetInit",n),this.subscribeSheetPropagation(n),n}},{key:"subscribeSheetPropagation",value:function(e){var t=e.subscribePropagation(this.handleSheetPropagation);this.subscriber.set(e.id(),t)}},{key:"creatBlockWorksheet",value:function(e,t,r,n,a){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],i=arguments.length>6&&void 0!==arguments[6]&&arguments[6],u=new s2(e,t,this,r,n,a,o,i);return this.subscribeSheetPropagation(u),u}},{key:"createWorksheetByData",value:function(e){return e.externalResource?this.creatBlockWorksheet(e.id,e.name,e.externalResource.blockType,e.externalResource.blockId,e.externalResource.blockToken):(0,f.Z)((0,v.Z)(t.prototype),"createWorksheetByData",this).call(this,e)}},{key:"getDefaultBlockSheetName",value:function(e){if(e===Ce.kHU.BITABLE_BLOCK){var t=A4[e],r=this.sheets.reduce((function(e,r){var n=new RegExp("^".concat(t,"(\\d+)$")).exec(r.name());return n?Math.max(e,Number(n[1])):e}),0);return t+(r+1)}return this._getDefaultSheetName(this.sheets.length)}},{key:"updatePermissionVersion",value:function(){this.permissionVersion++}},{key:"getPermissionVersion",value:function(){return this.permissionVersion}},{key:"getProtectionTotalCount",value:function(){var e=this;return this.sheets.reduce((function(t,r){return t+e.permissionManager.findPermDetail(r.id()).length+r.protectionModel.getProtectionsCount()}),0)}},{key:"getBlockWorksheetIsNew",value:function(e){var t=this.sheets.find((function(t){return t.blockToken===e}));return!!(t&&t instanceof s2&&t.isNew)}},{key:"scrollTo",value:function(e,t,r){var n=this.getSheetFromId(e);return n&&n.scrollTo(t,r)}},{key:"scroll",value:function(e,t,r){var n=this.getSheetFromId(e);return n&&n.scroll({posX:t,posY:r})}},{key:"undoDispatcher",get:function(){return this._undoDispatcher}}]),t}(T4),O4=Math.max,V4=Math.min;function N4(e,t){return e.getColumnCount(t)}function b4(e,t){return e.getRowCount(t)}function M4(e){var t;return(t={},(0,l.Z)(t,Ce.VDZ.Left,"left"),(0,l.Z)(t,Ce.VDZ.Right,"right"),(0,l.Z)(t,Ce.VDZ.Up,"up"),(0,l.Z)(t,Ce.VDZ.Down,"down"),(0,l.Z)(t,Ce.VDZ.Home,"home"),(0,l.Z)(t,Ce.VDZ.End,"end"),(0,l.Z)(t,Ce.VDZ.PageDown,"page_down"),(0,l.Z)(t,Ce.VDZ.PageUp,"page_up"),t)[e]}function F4(e,t){var r=e.intersect(t),n=e.sheet();if(r){var a=[];return e.rowFrom()+e.rowCount()>r.rowFrom()+r.rowCount()&&a.push(new ou(r.rowFrom()+r.rowCount(),e.colFrom(),e.rowFrom()+e.rowCount()-(r.rowFrom()+r.rowCount()),e.colCount(),n)),e.colFrom()+e.colCount()>r.colFrom()+r.colCount()&&a.push(new ou(Math.max(e.rowFrom(),r.rowFrom()),r.colFrom()+r.colCount(),r.rowCount(),e.colFrom()+e.colCount()-(r.colFrom()+r.colCount()),n)),e.colFrom()<r.colFrom()&&a.push(new ou(Math.max(e.rowFrom(),r.rowFrom()),e.colFrom(),r.rowCount(),r.colFrom()-e.colFrom(),n)),e.rowFrom()<r.rowFrom()&&a.push(new ou(e.rowFrom(),e.colFrom(),r.rowFrom()-e.rowFrom(),e.colCount(),n)),a}return[e]}var Z4,x4,D4,P4=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"addSelection",value:function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=arguments.length>4?arguments[4]:void 0;if(this.parent.apiHookManager.getHooks(1).every((function(t){return t(e)}))){var o=this._selectionModel.toArray();e=this.extendSelectedRangeForMergeCell(e,t),this._selectionModel.add(e);var i=this._selectionModel.toArray();n&&this._raiseSelectionChanging(o,i)&&this._raiseSelectionChanged(o,r,a)}}},{key:"extendSelectedRangeForMergeCell",value:function(e,t){if(e instanceof ou){var r=this._getSpanModel().getSpans();!t&&r&&r.length>0&&(e=this._cellRangeInflate(r,e.clone()))}return e}},{key:"setSelection",value:function(e,t,r){var n=this,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,u=arguments.length>6?arguments[6]:void 0;if(this.parent.apiHookManager.getHooks(0).every((function(r){return r(e,{sheet:n,cell:t,endCell:i,editMode:u})}))){var s=this;s._clearSelectionImp();var l=e.rgType===Ce.xj7.ALL||e.rgType===Ce.xj7.ROW||e.rgType===Ce.xj7.COL;if(t){if(l){var c=s.getFirstVisibleCellIndex(),h=c.row,f=c.col;t.row=h>t.row?h:t.row,t.col=f>t.col?f:t.col}s._setActiveCellImp(t.row,t.col,1,1)}else if(l){var d=s.getFirstVisibleCellIndex(),v=d.row,p=d.col,m=v>e.rowFrom()?v:e.rowFrom(),g=p>e.colFrom()?p:e.colFrom();s._setActiveCellImp(m,g,1,1)}else s._setActiveCellImp(e.rowFrom(),e.colFrom(),1,1);this.addSelection(e,void 0,r,a,o)}}},{key:"setSelections",value:function(e,t,r){var n=this,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=this._selectionModel.toArray();this._clearSelectionImp(),t&&this._setActiveCellImp(t.row,t.column,1,1),e.forEach((function(e){return n.addSelection(e,void 0,r,!1)}));var i=this._selectionModel.toArray();a&&this._raiseSelectionChanging(o,i)&&this._raiseSelectionChanged(o,r)}},{key:"getSelections",value:function(){return this._selectionModel.toArray()}},{key:"isSingleCellOrSpan",value:function(e){if(1===e.length){var t=e[0],r=this.getSpans(t);return this.isSingleCell(t)||this.isSingleSpan(t,r)}return!1}},{key:"isSingleCell",value:function(e){return 1===e.size()}},{key:"isSingleSpan",value:function(e,t){return 1===t.length&&e.equal(t[0])}},{key:"clearSelection",value:function(){if(this.parent.apiHookManager.getHooks(3).every((function(e){return e()}))){var e=this.getSelections();this._clearSelectionImp(),this._setActiveCellImp(0,0),this.dispatch("SelectionChanged",{oldSelections:e,newSelections:this.getSelections(),sheet:this,sheetName:this.name()})}}},{key:"_clearSelectionImp",value:function(){this._selectionModel.clear()}},{key:"_canSelect",value:function(e,t,r){var n=this,a=n.options,o=a.protectionOptions,i=!1!==o.allowSelectLockedCells,u=!1!==o.allowSelectUnlockedCells;if(!a.isProtected||i&&u)return!0;if(!i&&!u)return!1;var s=r?r.locked:n._getStyleProperty(e,t,"locked"),l=t<0,c=e<0;if(i===s&&(c||l)){var h=c?b4(n):1;e=c?0:e;var f=l?N4(n):1;t=l?0:t;for(var d,v,p=n._getModel(),m=e+h-1,g=t+f-1,y=p.iterStyle(e,t,m,g),_=y.next();null!==_;_=y.next())if(_&&i!==_.locked)return!1;if(c)for(d=e;d<=m;d++){var R=p.getStyle(d,-1);if(R&&i!==R.locked)return!1}if(l)for(v=t;v<=g;v++){var C=p.getStyle(-1,v);if(C&&i!==C.locked)return!1}}return i===s}},{key:"_saveAndClearSheetSelections",value:function(){var e=this,t=e._selectionModel;t&&t.length>0&&(e._selectionModelCache=t.toJSON(),e._clearSelectionImp())}},{key:"_loadAndSetSheetSelections",value:function(){var e=this._selectionModelCache;e&&this._selectionModel.fromJSON(e,this)}},{key:"_moveActiveCellUp",value:function(e,t,r){var n=this,a=n._getMoveUpCell(e,t,r,n._leadingCellCol||0);if(a){var o=a.row,i=a.col,u=a.leadingCellCol;n._canMoveCurrentTo(o,i)&&(n._leadingCellRow=o,n._leadingCellCol=u,n._setActiveCellCore(o,i))}}},{key:"_getMoveUpCell",value:function(e,t,r,n){var a=this,o=b4(a),i=N4(a),u=e,s=t;if(0===u&&!r||0===o||0===i)return null;var l=a._getPrevRow(u,n);return r||a._adjustCell(l),u=l.r,s=l.c,u<0&&r&&(((s=a._getPrevVisualColumn(s))<0||Or(s))&&(s=a._getPrevVisualColumn(i)),n=s,u=(l=a._getPrevRow(o,s)).r,(s=l.c)===t&&u<=e)?null:{row:u,col:s,leadingCellCol:n}}},{key:"_moveActiveCellDown",value:function(e,t,r,n){var a=this,o=void 0!==n?n:a._leadingCellCol||0,i=a._getMoveDownCell(e,t,r,o);if(i&&(i.row!==e||i.col!==t)){var u=i.row,s=i.col,l=i.leadingCellCol;a._canMoveCurrentTo(u,s)&&(a._leadingCellRow=u,a._leadingCellCol=l,a._setActiveCellCore(u,s))}}},{key:"_getMoveDownCell",value:function(e,t,r,n){var a=this,o=b4(a),i=N4(a),u=e,s=t;if(u===o-1&&!r||0===o||0===i)return null;var l=a._getNextRow(u,n);return r||a._adjustCell(l),u=l.r,s=l.c,u===o&&r&&(((s=a._getNextVisualColumn(s))>=i||Or(s))&&(s=a._getNextVisualColumn(-1)),n=s,u=(l=a._getNextRow(-1,s)).r,(s=l.c)===t&&u>=e)?null:{row:u,col:s,leadingCellCol:n}}},{key:"_moveActiveCellLast",value:function(){var e=this,t=e._getMoveLastCell();if(t){var r=t.row,n=t.col;e._leadingCellRow=r,e._leadingCellCol=n,e._setActiveCellCore(r,n)}}},{key:"_getMoveLastCell",value:function(){var e=this,t=e._getLastVisualRow(),r=e._getLastVisualColumn(),n=r;if(!t||!n)return null;var a=e.options,o=a.protectionOptions,i=!1!==o.allowSelectLockedCells,u=!1!==o.allowSelectUnlockedCells;if(!a.isProtected||i&&u)return{row:t,col:n};if(!i&&!u)return null;for(;null!==t&&t>=0;t=e._getPrevVisualRow(t))for(n=r;null!==n&&n>=0;n=e._getPrevVisualColumn(n))if(i===e._getStyleProperty(t,n,"locked"))return{row:t,col:n};return null}},{key:"_moveActiveCellFirst",value:function(){var e=this,t=e._getMoveFirstCell();if(t){var r=t.row,n=t.col;e._leadingCellRow=r,e._leadingCellCol=n,e._setActiveCellCore(r,n)}}},{key:"_getMoveFirstCell",value:function(){var e=this,t=e._getNextVisualRow(e.frozenRowCount()-1),r=e._getNextVisualColumn(e.frozenColumnCount()-1),n=r;if(null===t||null===n)return null;var a=e.options,o=a.protectionOptions,i=!1!==o.allowSelectLockedCells,u=!1!==o.allowSelectUnlockedCells;if(!a.isProtected||i&&u)return{row:t,col:n};if(!i&&!u)return null;for(var s=this._getLastVisualRow()||0,l=this._getLastVisualColumn()||0;null!==t&&t<=s;t=e._getNextVisualRow(t))for(n=r;null!==n&&n<=l;n=e._getNextVisualColumn(n))if(i===e._getStyleProperty(t,n,"locked"))return{row:t,col:n};return null}},{key:"_moveActiveCellLeft",value:function(e,t,r){var n=this,a=n._getMoveLeftCell(e,t,r,n._leadingCellRow||0);if(a){var o=a.row,i=a.col,u=a.leadingCellRow;n._canMoveCurrentTo(o,i)&&(n._leadingCellRow=u,n._leadingCellCol=i,n._setActiveCellCore(o,i))}}},{key:"_getMoveLeftCell",value:function(e,t,r,n){var a=this,o=b4(a),i=N4(a),u=e,s=t;if(0===s&&!r||0===o||0===i)return null;var l=a._getPrevColumn(n,s),c=n;for(r||a._adjustCell(l),u=l.r,s=l.c;s<0&&r;){if(((u=a._getPrevVisualRow(u,3,!0))<0||Or(u))&&(u=a._getPrevVisualRow(o,3,!0)),n=u,u=(l=a._getPrevColumn(n,i)).r,s=l.c,u===e&&s<t)return null;if(u===e&&s===t){if(n===c)return null;u=(l=a._getPrevColumn(n,s)).r,s=l.c}}return{row:u,col:s,leadingCellRow:n}}},{key:"_adjustCell",value:function(e){var t=this,r=!1;if(e.r<0?e.r=t._getFirstVisualRow():e.r>=b4(t)&&(e.r=t._getLastVisualRow(),r=!0),e.c<0?e.c=t._getFirstVisualColumn():e.c>=N4(t)&&(e.c=t._getLastVisualColumn(),r=!0),r){var n=t._getSpanModel().get(e.r,e.c);n.rowFrom()!==e.r&&(e.r=n.rowFrom()),n.colFrom()!==e.c&&(e.c=n.colFrom())}}},{key:"_moveActiveCellLeftInSelection",value:function(e,t){for(var r,n=this,a=n._selectionModel,o=a.activeSelectedRangeIndex,i=-1,u=n._getActiveSelectedRange(),s=u.rowFrom(),l=u.colFrom(),c=u.colTo(),h=e,f=t;h=(r=n._getPrevColumnInSelection(h,f)).r,!((f=r.c)>=l);){if(i===o)return;if(--h>=s)f=c+1;else{var d=n._getActiveSelectedRange(3);i=a.activeSelectedRangeIndex,s=d.rowFrom(),l=d.colFrom(),c=d.colTo(),h=d.rowTo(),f=c+1}}h>=0&&(n._setActiveCellCore(h,f),n._leadingCellRow=h,n._leadingCellCol=f)}},{key:"_moveActiveCellRightInSelection",value:function(e,t){for(var r,n=this,a=n._selectionModel,o=a.activeSelectedRangeIndex,i=-1,u=n._getActiveSelectedRange(),s=u.colFrom(),l=u.rowTo(),c=u.colTo(),h=e,f=t;h=(r=n._getNextColumnInSelection(h,f)).r,!((f=r.c)<=c);){if(i===o)return;if(++h<=l)f=s-1;else{var d=n._getActiveSelectedRange(4);i=a.activeSelectedRangeIndex,s=d.colFrom(),l=d.rowTo(),c=d.colTo(),h=d.rowFrom(),f=d.colFrom()-1}}h>=0&&(n._setActiveCellCore(h,f),n._leadingCellRow=h,n._leadingCellCol=f)}},{key:"_baseMoveRightCell",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,o=this,i=o._getMoveRightCell(e,t,r,o._leadingCellRow||0);if(i&&(i.row!==e||i.col!==t)){var u=i.row,s=i.col,l=i.leadingCellRow;a&&a(u),o._canMoveCurrentTo(u,s)&&(o._leadingCellRow=l,o._leadingCellCol=s,o._setActiveCellCore(u,s,n))}}},{key:"_tabMoveCellRight",value:function(e,t,r){var n=this;n._baseMoveRightCell(e,t,r,!0,(function(r){void 0===n._firstTabCol&&(n._firstTabCol=t),r!==e&&(n._firstTabCol=n._getFirstVisualColumn())}))}},{key:"_moveActiveCellRight",value:function(e,t,r){this._baseMoveRightCell(e,t,r)}},{key:"_getMoveRightCell",value:function(e,t,r,n){var a=this,o=b4(a),i=N4(a),u=e,s=t;if(s===i-1&&!r||0===o||0===i)return null;var l=a._getNextColumn(n,s),c=n;for(r||a._adjustCell(l),u=l.r,s=l.c;s===i&&r;){if(((u=a._getNextVisualRow(u))>=o||Or(u))&&(u=a._getNextVisualRow(-1)),n=u,u=(l=a._getNextColumn(n,-1)).r,s=l.c,u===e&&s>t)return null;if(u===e&&s===t){if(n===c)return null;u=(l=a._getNextColumn(n,s)).r,s=l.c}}return{row:u,col:s,leadingCellRow:n}}},{key:"_getPrevColumn",value:function(e,t){for(var r,n=this,a=t;a>=0&&(r=e,!(--a<0));){var o=n.getSpans(new ou(r,a,1,1,n));if(o&&o.length>0){var i=o[0];a>=i.colFrom()&&(a=i.colFrom(),r=i.rowFrom())}if(n._canMoveCurrentTo(r,a))return{r:r,c:a}}return{r:r,c:a}}},{key:"_getPrevColumnInSelection",value:function(e,t){for(var r=this;t>=0&&!(--t<0);){var n=r._getSpanModel().find(e,t);if(n){var a=r._getActiveSelectedRange();if(!(a.rowFrom()<=n.rowFrom()&&n.rowFrom()+n.rowCount()<=a.rowFrom()+a.rowCount()&&a.colFrom()<=n.colFrom()&&n.colFrom()+n.colCount()<=a.colFrom()+a.colCount()))continue;if(n.rowFrom()!==e||n.colFrom()!==t)continue;t>=n.colFrom()&&(t=n.colFrom(),e=n.rowFrom())}if(r._canMoveCurrentTo(e,t))return{r:e,c:t}}return{r:e,c:t}}},{key:"_getNextColumn",value:function(e,t){for(var r,n=this,a=N4(n),o=t;o<a&&(r=e,!((o+=n._getSpanModel().get(r,o).colCount())>=a));){var i=n.getSpans(new ou(r,o,1,1,n));if(i&&i.length>0){var u=i[0];o>u.colFrom()?o=O4(o,u.colFrom()+u.colCount()):r=u.rowFrom()}if(n._canMoveCurrentTo(r,o))return{r:r,c:o}}return{r:r,c:o}}},{key:"_getNextColumnInSelection",value:function(e,t){for(var r=this,n=r._getSpanModel(),a=N4(r);t<a;){var o=n.get(e,t);if((t=o.colFrom()+o.colCount())>=a)break;var i=n.find(e,t);if(i){var u=r._getActiveSelectedRange();if(!(u.rowFrom()<=i.rowFrom()&&i.rowFrom()+i.rowCount()<=u.rowFrom()+u.rowCount()&&u.colFrom()<=i.colFrom()&&i.colFrom()+i.colCount()<=u.colFrom()+u.colCount()))continue;if(i.rowFrom()!==e||i.colFrom()!==t)continue;t>i.colFrom()?t=O4(t,i.colFrom()+i.colCount()):e=i.rowFrom()}if(r._canMoveCurrentTo(e,t))return{r:e,c:t}}return{r:e,c:t}}},{key:"_canMoveCurrentTo",value:function(e,t){var r=this;if(!r._canSelect(e,t))return!1;var n=e>=0&&e<b4(r)&&t>=0&&t<N4(r)&&r.getRowVisible(e)&&r.getColumnVisible(t),a=!!r._isTabNavigation;return!0===n&&!0===a&&!1===r._getStyleProperty(e,t,"tabStop")&&(n=!1),n}},{key:"_getPrevRow",value:function(e,t){for(var r=this;e>=0&&!(--e<0);){var n=r.getSpans(new ou(e,t,1,1,r));if(n&&n.length>0){var a=n[0];e>=a.rowFrom()&&(e=a.rowFrom(),t=a.colFrom())}if(r._canMoveCurrentTo(e,t))return{r:e,c:t}}return{r:e,c:t}}},{key:"_getNextRow",value:function(e,t){for(var r=this,n=b4(r);e<n&&!((e+=r._getSpanModel().get(e,t).rowCount())>=n);){var a=r.getSpans(new ou(e,t,1,1,r));if(a&&a.length>0){var o=a[0];e>o.rowFrom()?e=O4(e,o.rowFrom()+o.rowCount()):t=o.colFrom()}if(r._canMoveCurrentTo(e,t))return{r:e,c:t}}return{r:e,c:t}}},{key:"_setSelectedRange",value:function(e){this._selectionModel.add(e)}},{key:"_expandSelectedRange",value:function(e){if(this.parent.apiHookManager.getHooks(4).every((function(t){return t(e)}))){var t=this,r=t._getExtendedRange(e.rowTo(),e.colTo(),e.rowFrom(),e.colFrom()),n=r.rowFrom(),a=r.colFrom(),o=r.rowCount(),i=r.colCount(),u=t._selectionModel,s=u.toArray(),l=u.length-1;if(u.length>0){var c;c=e instanceof nu?new nu(a,i,t):e instanceof iu?new iu(n,o,t):new ou(n,a,o,i,t),u.splice(l,1,c);var h=t._selectionModel.toArray();t._raiseSelectionChanging(s,h)&&t._raiseSelectionChanged(s)}}}},{key:"_extractSelectedRange",value:function(e){if(this.parent.apiHookManager.getHooks(4).every((function(t){return t(e)}))){var t=this,r=t._getExtendedRange(e.rowTo(),e.colTo(),e.rowFrom(),e.colFrom()),n=t._selectionModel,a=n.toArray(),o=n.length-1;if(o>0){var i,u=t.getActiveCellIndex();n.splice(o,1);for(var s=Date.now(),l=0;l<o;l++){var c=n.shift();if(!c)return;var h=F4(c,r);(0,Ce.hTd)(n,h)}if(!n.length){var f=t.getSpan(u.row,u.column)||new uu(u.row,u.column,t);n.push(f)}var d=n[n.length-1];t._setActiveCellImp(d.rowFrom(),d.colFrom()),n.activeSelectedRangeIndex=n.length-1;var v=n.toArray();t._raiseSelectionChanging(a,v)&&t._raiseSelectionChanged(a),null===(i=Ce.Ps3.collectSheetEvent)||void 0===i||i.call(Ce.Ps3,"ccm_sheet_content_page_click",{click:"invert_select",target:"none",count:o,duration:Date.now()-s})}}}},{key:"_extendSelectedRange",value:function(e,t){var r=this,n=r._getExtendedRange(e,t,r._activeRowIndex,r._activeColIndex);r._replaceActiveSelectedRange(n)}},{key:"_getExtendedRange",value:function(e,t,r,n,a){var o=this;Or(r)&&(r=o._activeRowIndex),Or(n)&&(n=o._activeColIndex);var i=o._getSpanModel(),u=i.get(r,n),s=i.get(e,t);if(a&&u.equal(s))return new ou(u.rowFrom(),u.colFrom(),1,1,o);var l=u.union(s),c=o.getSpans();return c&&c.length>0&&(l=o._inflateRangeToCoverSpans(c,l)),l}},{key:"_replaceActiveSelectedRange",value:function(e){var t=this._selectionModel;t.length>0?t.splice(t.activeSelectedRangeIndex,1,e):t.add(e)}},{key:"_changeActiveSelectedRange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;if(!(r._selectionModel.length<=0)){var n=r._getActiveSelectedRange(),a=r._getKeyboardSelectedRange(n,e,t);if(a){var o=r._selectionModel.toArray();r._replaceActiveSelectedRange(a);var i=r._selectionModel.toArray();r._raiseSelectionChanging(o,i)&&r._raiseSelectionChanged(o)}}}},{key:"_getKeyboardSelectedRange",value:function(e,t,r,n,a){var o,i=this;return(0,Ce.vRF)(Ce.FHD.SELECTION_RANGE_CALC,0,{direction:M4(t),isCtrl:r?1:0}),t===Ce.VDZ.Left?o=r?i._searchSelectedRangebyLeftCtrl(e,!1,n,a):i._searchSelectedRangebyLeft(e,n,a):t===Ce.VDZ.Right?o=r?i._searchSelectedRangebyRightCtrl(e,!1,n,a):i._searchSelectedRangebyRight(e,n,a):t===Ce.VDZ.Up?o=r?i._searchSelectedRangebyUpCtrl(e,!1,n,a):i._searchSelectedRangebyUp(e,n,a):t===Ce.VDZ.Down?o=r?i._searchSelectedRangebyDownCtrl(e,!1,n,a):i._searchSelectedRangebyDown(e,n,a):t===Ce.VDZ.Home?o=r?i._searchSelectedRangebyHomeCtrl(e,n,a):i._searchSelectedRangebyHome(e,n,a):t===Ce.VDZ.End?o=r?i._searchSelectedRangebyEndCtrl(e,n,a):i._searchSelectedRangebyEnd(e,n,a):t===Ce.VDZ.PageUp?o=i._searchSelectedRangebyPageUp(e,n,a):t===Ce.VDZ.PageDown&&(o=i._searchSelectedRangebyPageDown(e,n,a)),o=function(e,t,r){return t?e instanceof nu?new nu(t.colFrom(),t.colCount(),r):e instanceof iu?new iu(t.rowFrom(),t.rowCount(),r):e instanceof au?new au(r):t:null}(e,o,i),(0,Ce.vRF)(Ce.FHD.SELECTION_RANGE_CALC,1),o}},{key:"_searchSelectedRangebyLeft",value:function(e,t,r){for(var n=this,a=e.rowFrom(),o=e.colFrom(),i=e.rowCount(),u=e.colCount(),s=o+u-1,l=a+i-1;s>0;)if(s--,n._canMoveCurrentTo(l,s)){var c=n._getExtendedRange(l,s,t,r),h=V4(a,c.rowFrom()),f=V4(o,c.colFrom()),d=O4(e.rowTo(),c.rowTo()),v=V4(e.colTo(),c.colTo()),p=d-h+1,m=v-f+1;if(h!==a||f!==o||p!==i||m!==u){var g=n._scrollLeftCol,y=n._activeColIndex;return o<y?f<=g&&n._scrollToCol(f):o===y&&v<=g&&n._scrollToCol(v),new ou(h,f,p,m,n)}}return null}},{key:"_searchSelectedRangebyLeftCtrl",value:function(e,t,r,n){var a=this,o=e.rowFrom(),i=e.colFrom(),u=Or(n)?a._activeColIndex:n,s=e.colTo(),l=a.frozenColumnCount(),c=l?a._getNextVisualColumn(l-1):a._getFirstVisualColumn(),h=t?c:a._getFirstVisualColumn();if(!Or(h)){for(var f,d=!1,v=s>u?s:i,p=v;p>0;p--){var m,g=null!==(m=f)&&void 0!==m?m:a.hasContent(o,p),y=f=a.hasContent(o,p-1);if(p!==v||g&&(!g||y)){if(d){if(g){h=p;break}}else if(g&&!y){h=p;break}}else d=!0}a._scrollToCol(h);var _=a._getExtendedRange(o,h,r,n),R=V4(o,_.rowFrom()),C=V4(i,_.colFrom()),w=O4(e.rowTo(),_.rowTo()),E=V4(e.colTo(),_.colTo());return new ou(R,C,w-R+1,E-C+1,a)}}},{key:"_searchSelectedRangebyRight",value:function(e,t,r){for(var n=this,a=e.rowFrom(),o=e.colFrom(),i=e.rowCount(),u=e.colCount(),s=o,l=N4(n)-1,c=e.rowTo();s<l;)if(s++,n._canMoveCurrentTo(c,s)){var h=n._getExtendedRange(c,s,t,r),f=V4(a,h.rowFrom()),d=O4(o,h.colFrom()),v=O4(e.rowTo(),h.rowTo()),p=O4(e.colTo(),h.colTo()),m=v-f+1,g=p-d+1;if(f!==a||d!==o||m!==i||g!==u){var y=n._activeColIndex;return o<y?n._scrollToCol(d):o===y&&n._scrollToCol(p),new ou(f,d,m,g,n)}}return null}},{key:"_searchSelectedRangebyRightCtrl",value:function(e,t,r,n){for(var a,o=this,i=e.rowFrom(),u=e.colFrom(),s=Or(n)?o._activeColIndex:n,l=e.colTo(),c=!1,h=o.getColumnCount(),f=o._getLastVisualColumn()||0,d=l>s?l:u,v=d;v<h;v++){var p,m=null!==(p=a)&&void 0!==p?p:o.hasContent(i,v),g=a=o.hasContent(i,v+1);if(v!==d||m&&(!m||g)){if(c){if(m){f=v;break}}else if(m&&!g){f=v;break}}else c=!0}o._scrollToCol(f);var y=o._getExtendedRange(i,f,r,n),_=V4(i,y.rowFrom()),R=O4(u,y.colFrom()),C=O4(e.rowTo(),y.rowTo()),w=O4(e.colTo(),y.colTo());return new ou(_,R,C-_+1,w-R+1,o)}},{key:"_searchSelectedRangebyUp",value:function(e,t,r){for(var n=this,a=e.rowFrom(),o=e.colFrom(),i=e.rowCount(),u=e.colCount(),s=a+i-1,l=o+u-1;s>0;)if(s--,n._canMoveCurrentTo(s,l)){var c=n._getExtendedRange(s,l,t,r),h=V4(a,c.rowFrom()),f=V4(o,c.colFrom()),d=V4(e.rowTo(),c.rowTo()),v=d-h+1,p=O4(e.colTo(),c.colTo())-f+1;if(h!==a||f!==o||v!==i||p!==u){var m=n._scrollTopRow,g=n._activeRowIndex;return a<g?h<=m&&n._scrollToRow(h):a===g&&d<=m&&n._scrollToRow(d),new ou(h,f,v,p,n)}}return null}},{key:"_searchSelectedRangebyUpCtrl",value:function(e,t,r,n){var a=this,o=e.rowFrom(),i=e.colFrom(),u=Or(r)?a._activeRowIndex:r,s=e.rowTo(),l=a.frozenRowCount(),c=l?a._getNextVisualRow(l-1):a._getFirstVisualRow(),h=t?c:a._getFirstVisualRow();if(!Or(h)){for(var f,d=!1,v=s>u?s:o,p=v;p>0;p--){var m,g=null!==(m=f)&&void 0!==m?m:a.hasContent(p,i),y=f=a.hasContent(p-1,i);if(p!==v||g&&(!g||y)){if(d){if(g){h=p;break}}else if(g&&!y){h=p;break}}else d=!0}a._scrollToRow(h);var _=a._getExtendedRange(h,i,r,n),R=V4(o,_.rowFrom()),C=V4(i,_.colFrom()),w=V4(e.rowTo(),_.rowTo()),E=O4(e.colTo(),_.colTo());return new ou(R,C,w-R+1,E-C+1,a)}}},{key:"_searchSelectedRangebyDown",value:function(e,t,r){for(var n=this,a=e.rowFrom(),o=e.colFrom(),i=e.rowCount(),u=e.colCount(),s=a,l=b4(n)-1,c=o+u-1;s<l;)if(s++,n._canMoveCurrentTo(s,c)){var h=n._getExtendedRange(s,c,t,r),f=O4(a,h.rowFrom()),d=V4(o,h.colFrom()),v=O4(e.rowTo(),h.rowTo()),p=v-f+1,m=O4(e.colTo(),h.colTo())-d+1;if(f!==a||d!==o||p!==i||m!==u){var g=n._activeRowIndex;return a<g?n._scrollToRow(f):a===g&&n._scrollToRow(v),new ou(f,d,p,m,n)}}return null}},{key:"_searchSelectedRangebyDownCtrl",value:function(e,t,r,n){for(var a,o=this,i=e.rowFrom(),u=e.colFrom(),s=Or(r)?o._activeRowIndex:r,l=e.rowTo(),c=o.getRowCount(),h=!1,f=Number(o._getLastVisualRow()),d=l>s?l:i,v=d;v<c;v++){var p,m=null!==(p=a)&&void 0!==p?p:o.hasContent(v,u),g=a=o.hasContent(v+1,u);if(v!==d||m&&(!m||g)){if(h){if(m){f=v;break}}else if(m&&!g){f=v;break}}else h=!0}o._scrollToRow(f);var y=o._getExtendedRange(f,u,r,n),_=O4(i,y.rowFrom()),R=V4(u,y.colFrom()),C=O4(e.rowTo(),y.rowTo()),w=O4(e.colTo(),y.colTo());return new ou(_,R,C-_+1,w-R+1,o)}},{key:"_searchSelectedRangebyHome",value:function(e,t,r){for(var n=this,a=e.rowFrom(),o=e.colFrom(),i=e.rowCount(),u=e.colCount(),s=n.frozenColumnCount()-1,l=n._activeColIndex,c=a+i-1;s<l;)if(s++,n._canMoveCurrentTo(c,s)){if(o<=s&&o+u-1===n._activeColIndex)break;var h=n._getExtendedRange(c,s,t,r),f=V4(a,h.rowFrom()),d=V4(o,h.colFrom()),v=O4(e.rowTo(),h.rowTo())-f+1,p=V4(e.colTo(),h.colTo())-d+1;return n._scrollToCol(Number(n._getFirstVisualColumn())),new ou(f,d,v,p,n)}return null}},{key:"_searchSelectedRangebyHomeCtrl",value:function(e,t,r){var n=this._searchSelectedRangebyLeftCtrl(e,!0,t,r);if(n)return this._searchSelectedRangebyUpCtrl(n,!0,t,r)}},{key:"_searchSelectedRangebyEnd",value:function(e,t,r){for(var n=this,a=e.rowFrom(),o=e.colFrom(),i=e.rowCount(),u=e.colCount(),s=N4(n),l=n._activeColIndex,c=a+i-1;s>l;)if(s--,n._canMoveCurrentTo(c,s)){if(o+u-1>=s&&o===n._activeColIndex)break;var h=n._getExtendedRange(c,s,t,r),f=V4(a,h.rowFrom()),d=O4(o,h.colFrom()),v=O4(e.rowTo(),h.rowTo())-f+1,p=O4(e.colTo(),h.colTo())-d+1;return n._scrollToCol(n.getColumnCount()),new ou(f,d,v,p,n)}return null}},{key:"_searchSelectedRangebyEndCtrl",value:function(e,t,r){return e=this._searchSelectedRangebyRightCtrl(e,!0,t,r),this._searchSelectedRangebyDownCtrl(e,!0,t,r)}},{key:"_searchSelectedRangebyPageUp",value:function(e,t,r){var n=this,a=e.rowFrom(),o=e.colFrom(),i=n._scrollTopRow,u=n.prePage(),s=-1;i!==n._scrollTopRow?s=Number(n._getNextVisualRow(a+n._scrollTopRow-i)):n.frozenRowCount()<=0&&(s=Number(n._getFirstVisualRow())),s<n._scrollTopRow?s=n._scrollTopRow:s>=u.row+u.rowCount&&(s=Number(n._getPrevVisualRow(u.row+u.rowCount)));var l=n._getExtendedRange(s,o,t,r),c=V4(a,l.rowFrom()),h=V4(o,l.colFrom()),f=V4(e.rowTo(),l.rowTo()),d=O4(e.colTo(),l.colTo());return new ou(c,h,f-c+1,d-h+1,n)}},{key:"_searchSelectedRangebyPageDown",value:function(e,t,r){var n,a,o,i,u=this,s=e.rowFrom(),l=e.colFrom(),c=u.nextPage(),h=Number(u._getNextVisualRow(c.row));h<u._scrollTopRow?h=u._scrollTopRow:h>=c.row+c.rowCount&&(h=Number(u._getPrevVisualRow(c.row+c.rowCount)));var f=u._getExtendedRange(h,l,t,r);return n=O4(s,f.rowFrom()),a=V4(l,f.colFrom()),o=O4(e.rowTo(),f.rowTo()),i=O4(e.colTo(),f.colTo()),new ou(n,a,o-n+1,i-a+1,u)}},{key:"_getLastVisualRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=b4(this,e);return this._getPrevVisualRow(t,e)}},{key:"_getLastVisualColumn",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,t=N4(this,e);return this._getPrevVisualColumn(t,e)}},{key:"_inflateRangeToCoverSpans",value:function(e,t){if(e)for(var r=0,n=e.length;r<n;r++){var a=e[r];if(t.intersect(a)){e.splice(r--,1);var o=t.union(a);if(t.contain(o)){n--;continue}return this._inflateRangeToCoverSpans(e,o)}}return t}},{key:"_getActiveSelectedRange",value:function(e){var t=this._selectionModel,r=t.length,n=new au(this);return r<=0||(3===e?(t.activeSelectedRangeIndex--,t.activeSelectedRangeIndex<0&&(t.activeSelectedRangeIndex=r-1)):4===e&&(t.activeSelectedRangeIndex++,t.activeSelectedRangeIndex>=r&&(t.activeSelectedRangeIndex=0)),t.activeSelectedRangeIndex>=0&&(n=t[t.activeSelectedRangeIndex])),n}},{key:"rangeStringToRange",value:function(e){return tA(this,e)}},{key:"selectAll",value:function(){this.setSelection(new au(this))}},{key:"isTabNavigation",set:function(e){this._isTabNavigation=e}}]),e}(),$4=tA,L4=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"getFormatCode",value:function(e,t){var r=this.getActualFormatter(e,t);return r&&r.getFormatCode()}}]),e}(),B4=function(e){return null==e},U4=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"_setComments",value:function(e,t,r,n){if(0!==(n=B4(n)?3:n)){this._getModel().setComment(e,t,r);var a=this.id();this.dispatch("CommentChanged",{row:e,col:t,comments:r,type:0,sheet_id:a})}return null}},{key:"getComments",value:function(e,t,r){var n=this._getModel();return n&&n.getComment(e,t)||null}},{key:"getAllComments",value:function(e){var t=this._getModel();if(!t)return[];var r=[];return t.iterCommentWithPos(0,0,this.getRowCount(),this.getColumnCount()).forEach((function(e){if(e){var t=(0,g.Z)(e,2),n=t[0],a=t[1];n&&r.push({row:a.row,col:a.col,comments:n})}})),r.sort((function(e,t){return e.row===t.row?e.col-t.col:e.row-t.row})),r}},{key:"findComment",value:function(e){return this.getAllComments().find((function(t){return t.comments.some((function(t){return t.id===e}))}))}},{key:"setHoverComment",value:function(e,t,r){this._commentHoverResult={row:e,col:t,rowCount:1,colCount:1},this.notifyShell(50,{row:e,col:t})}},{key:"getHoverComment",value:function(){return this._commentHoverResult?Object.assign({},this._commentHoverResult):null}},{key:"getHoverCellComment",value:function(e,t){return!!this._commentHoverResult&&this._commentHoverResult.row===e&&this._commentHoverResult.col===t}},{key:"clearHoverComment",value:function(){this._commentHoverResult=null,this.notifyShell(51)}},{key:"clearAllComments",value:function(){var e=this;this.getAllComments().forEach((function(t){e._setComments(t.row,t.col,null)})),this.notifyShell(51)}},{key:"addActiveComment",value:function(e,t,r){this._commentActiveResult||(this._commentActiveResult={}),this._commentActiveResult[e+"_"+t]={row:e,col:t,rowCount:1,colCount:1},this._activeCommentId=r;var n=this.id();this.dispatch("CommentChanged",{row:e,col:t,type:1,sheet_id:n,commentId:r})}},{key:"getActiveCommentId",value:function(){return this._activeCommentId}},{key:"addActiveCommentById",value:function(e){var t=this.findComment(e);t&&this.addActiveComment(t.row,t.col,e)}},{key:"getActiveComment",value:function(e,t){return this._commentActiveResult?this._commentActiveResult[e+"_"+t]:null}},{key:"getActiveComments",value:function(){var e=[],t=this._commentActiveResult;return t?(Object.keys(t).forEach((function(r){if(t.hasOwnProperty(r)){var n=t[r];e.push(n)}})),e):e}},{key:"removeActiveComment",value:function(e,t,r){this._commentActiveResult||(this._commentActiveResult={});var n=e+"_"+t,a=this._commentActiveResult;a[n]&&(delete a[n],this._activeCommentId=null);var o=this.id();this.dispatch("CommentChanged",{row:e,col:t,type:2,sheet_id:o})}},{key:"clearActiveComment",value:function(){this._commentActiveResult={},this._activeCommentId=null;var e=this.id();this.dispatch("CommentChanged",{type:3,sheet_id:e})}},{key:"shouldShowCommentPanel",value:function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=e.getActiveSheet();if(!o)return!1;var i=!!o.floatImageModel.activeFloatImageIds.length,u=!(null!=t&&t.eventTargetSource)||Ce.ned[null===(r=t.eventTargetSource)||void 0===r?void 0:r.type],s=t&&"MENTION_CLICK"===t.source;return!(n||a||t&&"range-selector"===t.source||s||i||e.isRangeSelecting||!u)}}]),e}(),H4=dn._Types,z4=null,W4=H4._isNullOrUndefined,G4=H4._toDouble,j4="number",Y4="date";function q4(e){return"string"!=typeof e&&H4._isNumber(e)}function J4(e){var t=[e];return t.rowCount=1,t.colCount=e&&e.length,t}function K4(e){return e}function X4(e,t,r,n){var a=J4(t),o=J4(r),i=J4([n]),u=e?dn._trend(a,o,i,!0,K4,z4,z4,z4):dn._growth(a,o,i,!0,z4,z4,z4),s=u&&u[0][0];return(0,R.Z)(s)===j4&&s.toString().length>=13?+s.toPrecision(13):s}function Q4(e){var t=this;t._indexes=[],t._innerValues=[],t._type=z4,t._startIndex=W4(e)?-1:e}!function(e){e[e.copyCells=0]="copyCells",e[e.fillSeries=1]="fillSeries",e[e.fillFormattingOnly=2]="fillFormattingOnly",e[e.fillWithoutFormatting=3]="fillWithoutFormatting",e[e.clearValues=4]="clearValues",e[e.auto=5]="auto"}(Z4||(Z4={})),function(e){e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down"}(x4||(x4={})),Q4.prototype={_dataCount:function(){return this._innerValues&&this._innerValues.length},_values:function(){var e,t,r=this,n=[],a=r._innerValues;for(e=0;e<a.length;e++)t=a[e],n.push("object"===r._type?r._toDateTime(t):t);return n},_indexes2:function(){var e=this._indexes;if(e&&e.length>0){var t,r=this._startIndex,n=[];for(-1===r&&(r=e[0]),t=0;t<e.length;t++)n[t]=e[t]-r+1;return n}return z4},_values2:function(){var e=this._innerValues;return e&&e.length?e:z4},_add:function(e,t){var r=this;W4(r._type)&&(t instanceof Date?r._type=Y4:r._type=j4),r._indexes.push(e),r._innerValues.push(G4(t))},_toActualValue:function(e){return this._type===Y4?this._toDateTime(e):e},_toDateTime:function(e){var t=z4;return e instanceof Date&&(t=e),t}},function(e){e[e.vertical=0]="vertical",e[e.horizontal=1]="horizontal"}(D4||(D4={}));var e6=function(){function e(t,r){(0,y.Z)(this,e),this._sheet=t,this.fillCb=r}return(0,_.Z)(e,[{key:"fillAuto",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=e.rowFrom(),i=e.colFrom(),u=e.rowCount(),s=e.colCount(),l=t.rowFrom(),c=t.colFrom(),h=!(o<l||i<c);return this._autoFillRange(t,u,s,r,n,h,a)}},{key:"_autoFillRange",value:function(e,t,r,n,a,o,i){var u=o?1:-1,s=e.rowFrom(),l=e.colFrom(),c=e.rowCount(),h=e.colCount();if(1===n){var f=Math.floor(r/h),d=r%h;if(!a)for(var v=1;v<f;v++){var p=new ou(s,l+v*u*h,c,h,this._sheet);this._copyRange(e,p,n,4,a,!1,0,0,!1,i)}if(a&&f>1&&0===d&&(f-=1,d=h),f>0&&d>0){var m=new ou(s,o?l+f*h:l-f*h+h-d,c,d,this._sheet);return this._copyRange(e,m,n,4,a,o,0,o?0:h-d,!1,i)}}else{var g=Math.floor(t/c),y=t%c;if(!a)for(var _=1;_<g;_++){var R=new ou(s+_*u*c,l,c,h,this._sheet);this._copyRange(e,R,n,4,a,!1,0,0,!0,i)}if(a&&g>1&&0===y&&(g-=1,y=c),g>0&&y>0){var C=new ou(o?s+g*c:s-g*c+c-y,l,y,h,this._sheet);return this._copyRange(e,C,n,4,a,o,o?0:c-y,0,!0,i)}}}},{key:"_copyRange",value:function(e,t,r,n,a,o,i,u,s,l){for(var c,h=1===r,f=h?e.rowFrom():e.colFrom(),d=h?e.colFrom():e.rowFrom(),v=h?t.rowFrom():t.colFrom(),p=h?t.colFrom():t.rowFrom(),m=h?e.rowCount():e.colCount(),g=h?e.colCount():e.rowCount(),y=h?t.colCount():t.rowCount(),_=this._sheet,R=null,C=0;C<m;C++){for(var w=z4,E=z4,k=0,T=f+C,S=v+C,A=T,I=S,O=(h?u:i)||0,V=h?0:O,N=!h&&s;k<g;){var b=d+k,M=p+k-O,F=z4,Z=b,x=M;h||(T=[b,b=A][0],S=[M,M=I][0]),R=_._getSpanModel().find(T,b);var D=!1;if(_.hasFormula(T,b))D=!0;else if(_.isProxyArrayFormula(T,b))F=null;else{var P=_.getMultipleValues(T,b);if(P)F=P;else F=_.getSegmentArray(T,b)||_.getValue(T,b)}if(4===n&&q4(F)){w||(w=new Q4);var $=F instanceof Date?Y4:j4;if(E||(E=$),E===$){w._add(Z,F),R?k+=h?R.colCount():R.rowCount():k++;continue}}if(F&&w&&w._dataCount()){if(c=this._autoFillTrendValues(h,e,t,A,I,w,a,o,V,N,l),a&&c)return c;w=z4,E=z4}else{if(!R||R&&(h?R.rowFrom():R.colFrom())===A){var L=x===p+y-1;if(a){if(R&&L||!R&&(L&&o||!o&&x===p))return F instanceof l_?F:Array.isArray(F)?_.getValue(T,b):F}else x<p+y&&x>=p&&(h||!h&&!(s&&_._isRowFilterOut&&_._isRowFilterOut(x)))&&this._executeFillCell(_,T,b,S,M,F,n,l,D)}R?k+=h?R.colCount():R.rowCount():k++}}if(w&&w._dataCount()&&(c=this._autoFillTrendValues(h,e,t,A,I,w,a,o,V,N,l),a&&c))return c}return z4}},{key:"_executeFillCell",value:function(e,t,r,n,a,o,i,u){var s=arguments.length>8&&void 0!==arguments[8]&&arguments[8];this.fillCb&&this.fillCb(e,t,r,n,a,o,i,u,s)}},{key:"_autoFillTrendValues",value:function(e,t,r,n,a,o,i,u,s,l,c){var h,f,d,v,p=this,m=p._sheet,g=e?r.colFrom():r.rowFrom(),y=e?t.colFrom():t.rowFrom(),_=e?r.colCount():r.rowCount(),R=e?t.colCount():t.rowCount();s=s||0;var C=o._dataCount(),w=(g-y-s)/R,E=p._isArithmeticProgression(o._indexes,o._innerValues);if(E){for(d=[],f=0;f<C;f++)d[f]=f+1;h=C}else v=o._indexes[0],h=o._indexes[C-1]-v+1,1===C&&o._add(o._indexes[0]+1,o._toActualValue(o._innerValues[0]+1)),d=o._indexes2();for(f=0;f<h;f++){var k=X4(!0,o._values2(),d,h*w+f+1),T=g+_-1,S=E?o._indexes[f]:v+f,A=S+w*R;if(i){if(E&&(u&&A===T||!u&&A===g)||!E&&A+s===T)return o._toActualValue(k)}else A<g+_&&A>=g&&(e?p._executeFillCell(m,n,S,a,A,o._toActualValue(k),4,c):l&&m._isRowFilterOut&&m._isRowFilterOut(A)||p._executeFillCell(m,S,n,A,a,o._toActualValue(k),4,c))}return z4}},{key:"_isArithmeticProgression",value:function(e,t){var r=t&&t.length;if(r<=1||(e&&e.length)!==r)return!1;var n,a=e[1]-e[0],o=t[1]-t[0];for(n=2;n<r;n++)if(e[n]-e[n-1]!==a||t[n]-t[n-1]!==o)return!1;return!0}}]),e}(),t6=dn._Types._isNullOrUndefined;var r6=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"fillAuto",value:function(e,t,r){if(!t)throw new Error("range is null");var n=r.series,a=r.direction,o=r.withTag,i=new e6(this);(function(e,t,r,n){return!!(e&&t&&t.contain(e))&&(!t6(r)&&(1===r&&e.rowFrom()===t.rowFrom()&&e.rowCount()===t.rowCount()||0===r&&e.colFrom()===t.colFrom()&&e.colCount()===t.colCount())||!(t6(n)||(2!==n&&3!==n||e.colFrom()!==t.colFrom()||e.colCount()!==t.colCount())&&(0!==n&&1!==n||e.rowFrom()!==t.rowFrom()||e.rowCount()!==t.rowCount())))})(e,t,a?null:n,a)&&i.fillAuto(t,e,n,!1,o)}}]),e}(),n6=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"getAllMentionsInSheet",value:function(){var e=this,t=this._getModel();if(!t)return[];var r=[];return t.iterContentWithPos(0,0,this.getRowCount(),this.getColumnCount()).forEach((function(t){var n=(0,g.Z)(t,2),a=n[0],o=n[1],i=null==a?void 0:a.segmentArray;i&&i.forEach((function(t){"mention"===t.type&&r.push({sheetId:e.id(),row:o.row,col:o.col,mentionId:t.mentionId,other:t})}))})),r.sort((function(e,t){return e.row===t.row?e.col-t.col:e.row-t.row})),r}},{key:"updateHighlightCellCfg",value:function(e,t,r){if(r&&this._highlightCells){var n=this.getHighlightCell(e,t);this._highlightCells.set(e,t,Object.assign({},"object"!=(0,R.Z)(n)?{}:n,{},r))}}},{key:"getHighlightCell",value:function(e,t){return!(!this._highlightCells||!this._highlightCells.size)&&this._highlightCells.get(e,t)}},{key:"hasHighLightCell",value:function(){return!!this._highlightCells&&this._highlightCells.size>0}}]),e}(),a6=dn._Types._isNullOrUndefined,o6=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"_tabMoveCell",value:function(e,t,r){var n=this;void 0===t&&(t=n._activeRowIndex),void 0===r&&(r=n._activeColIndex),2===e?(void 0!==n._firstTabCol&&Ce.Ps3.collectSuiteEvent("sheet_opration",{action:"tab_enter_next_row"}),n._moveActiveCellDown(t,r,!1,n._firstTabCol)):3===e?n._moveActiveCellLeft(t,r,!0):4===e&&n._tabMoveCellRight(t,r,!0),n._moveActiveCellEnd()}},{key:"_moveActiveCell",value:function(e,t,r,n){var a=this;a6(r)&&(r=a._activeRowIndex),a6(n)&&(n=a._activeColIndex),3===e?a._moveActiveCellLeft(r,n,t):4===e?a._moveActiveCellRight(r,n,t):1===e?a._moveActiveCellUp(r,n,t):2===e?a._moveActiveCellDown(r,n,t):5===e?a._moveActiveCellFirst():6===e&&a._moveActiveCellLast(),a._moveActiveCellEnd()}},{key:"_moveActiveCellEnd",value:function(){var e=this,t=e._selectionModel,r=t.toArray();e._isNavigateInSelection||e._clearSelectionImp();var n=e._activeRowIndex,a=e._activeColIndex,o=e._getSpanModel().get(n,a);if(e._activeRowCount=o.rowCount(),e._activeColCount=o.colCount(),!e._isNavigateInSelection){var i=e._getExtendedRange(n,a);e._replaceActiveSelectedRange(i);var u=t.toArray();e._raiseSelectionChanging(r,u)&&e._raiseSelectionChanged(r)}e._scrollByMoveCell(n,a);var s={sheet:e,sheetName:e._name,row:n,col:a};e._trigger(Ce.zW2.EnterCell,s)}}]),e}(),i6=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"getReminderPosById",value:function(e){var t=this._getModel();if(!t)return null;for(var r=t.iterReminderWithPos(0,0,this.getRowCount(),this.getColumnCount()),n=r.next();null!==n;n=r.next())if(n){var a=n,o=(0,g.Z)(a,2),i=o[0],u=o[1];if(i.id===e)return u}return null}}]),e}(),u6=function(){function e(){(0,y.Z)(this,e)}return(0,_.Z)(e,[{key:"hasApply2AllHighlightCell",value:function(){return!!this._dropdownApply2AllHighlightCell&&this._dropdownApply2AllHighlightCell.size>0}},{key:"getApply2AllHighlightCell",value:function(e,t){return this._dropdownApply2AllHighlightCell&&this._dropdownApply2AllHighlightCell.size&&this._dropdownApply2AllHighlightCell.get(e,t)||!1}}]),e}();function s6(e,t,r){var n=r.value;return r.value=function(){var e;return!(null!=this&&null!==(e=this.options)&&void 0!==e&&e.isProtected)&&n.apply(this,arguments)},r}var l6=function(){function e(){(0,y.Z)(this,e)}var t;return(0,_.Z)(e,[{key:"dataSplit",value:function(e,t,r,n,a,o,i,u,s,l,c){return this._executeCmdBase(Ce.rvF.DATA_SPLIT,{startRow:e,startCol:t,rowCount:r,colCount:n,spans:a,splitData:o,addColCount:i,extendFilterTargetRange:u,hideCount:s,format:l,realColCount:c})}},{key:"addChart",value:function(e,t){return this._executeCmdBase(Ce.rvF.SET_CHART,{commandType:0,chartId:e,data:t})}},{key:"addCheckbox",value:function(e){return this._executeCmdBase(Ce.rvF.SET_CHECKBOX_VALIDATION,{selections:e,dataValidationJSON:{type:"checkbox",formulas:[1,0],options:{handledWayOnInvalidData:1}}})}},{key:"setDataValidationAPI",value:function(e,t,r,n){return this._executeCmdBase(Ce.rvF.SET_DATA_VALIDATION,{activeCell:e,selections:t,dataValidationJSON:r,needApplyToAll:n})}},{key:"setDateTimeValidation",value:function(e,t,r,n){return this._executeCmdBase(Ce.rvF.SET_DATE_TIME_VALIDATION,{activeCell:e,selections:t,dataValidationJSON:r,needApplyToAll:n})}},{key:"addConditionalFormat",value:function(e){return this._executeCmdBase(Ce.rvF.SET_CONDITIONAL_FORMAT,{commandType:"add",data:e})}},{key:"moveConditionalFormat",value:function(e,t){return this._executeCmdBase(Ce.rvF.SET_CONDITIONAL_FORMAT,{commandType:"move",data:{oldIndex:e,newIndex:t}})}},{key:"addFilter",value:function(e){return this._executeCmdBase(Ce.rvF.SET_FILTER,{range:e,col:null,value:null})}},{key:"addFilterView",value:function(e,t){return this._executeCmdBase(Ce.rvF.ADD_VIEW,{isLocal:e,value:t})}},{key:"addFloatImage",value:function(e){return this._executeCmdBase(Ce.rvF.SET_FLOAT_IMAGE,{commandType:0,data:e})}},{key:"addReminder",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getSelections(),r=arguments.length>2?arguments[2]:void 0;return!t||0===t.length||!e||this._executeCmdBase(Ce.rvF.ADD_REMINDER,{selections:t,data:e,source:r})}},{key:"setColumnsSize",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._executeCmdBase(Ce.rvF.AUTO_FIT_COLUMN,{columns:e,size:t,isLocal:r})}},{key:"autoFitRow",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this._executeCmdBase(Ce.rvF.AUTO_FIT_ROW,{rows:e,isLocal:t})}},{key:"clearFormatting",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getSelections();return this._executeCmdBase(Ce.rvF.DO_CLEAR,{ranges:e})}},{key:"clearRangeConditionalFormat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"clear-duplicate-values";return this._executeCmdBase(Ce.rvF.SET_CONDITIONAL_FORMAT,{commandType:"clearRange",ranges:e,source:t})}},{key:"clearPivotTables",value:function(){var e,t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getSelections(),n=arguments.length>1?arguments[1]:void 0,a=this.getPivotTableManager();if(!a.hasPivotTable())return!0;var o,i=[],u=yr(r);try{for(u.s();!(o=u.n()).done;){var s=o.value;if(n)(0,Ce.hTd)(i,ST(this,s));else{var l,c=kT(this,s.rowFrom(),s.colFrom(),s.rowCount(),s.colCount()),h=yr(c);try{for(h.s();!(l=h.n()).done;){var f=l.value,d=a.getPositionCell(f),v=d.row,p=d.col;if(!s.containCell(v,p))return Ce.Ps3.Toast.warning({key:"cannotDeletePivotTable",content:cr("CreationDoc_Sheets_PivotTable_Failed_CanNotEditPivot")}),!1;i.push(f)}}catch(e){h.e(e)}finally{h.f()}}}}catch(e){u.e(e)}finally{u.f()}return i.forEach((function(e){t.delEmbeddedBlock({blockType:Zt.kH.PIVOT_TABLE,blockToken:e,reserveDepRanges:!1})})),i.length>0&&null!==(e=Ce.Ps3.collectSheetEvent)&&void 0!==e&&e.call(Ce.Ps3,"ccm_sheet_content_page_click",{click:"delete_data_pivotd",target:"none"}),!0}},{key:"clearValues",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getSelections(),t=arguments.length>1?arguments[1]:void 0;if(!t&&!this.clearPivotTables(e))return!1;var r=[];if(e=e.filter((function(e){return!!(e&&wu(e)&&e.isValidBoundaryInsideSheet())||(r.push(e),!1)})),r.length>0){var n=this.getRowCount(),a=this.getColumnCount();Ce.Ps3.collectSuiteEvent("client_sheet_command_tracker_dev",{trace_code:19,info:"clearValues range invalid ".concat(r.map((function(e){return e.toGridJSON&&JSON.stringify(e.toGridJSON(!0))})).join("|")," maxRowCount:").concat(n," maxColCount:").concat(a)})}return this._executeCmdBase(Ce.rvF.CLEAR_VALUES,{ranges:e})}},{key:"formatPivotTableRange",value:function(e,t,r,n,a,o,i){return this._executeCmdBase(Ce.rvF.FORMAT_PIVOT_TABLE_RANGE,{ranges:e,pivotTableName:t,shouldAutoFitCol:n,shouldClear:r,addRowCount:a,addColCount:o,dontAddToCommandStack:i})}},{key:"clearValuesAndFormatting",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getSelections();return this._executeCmdBase(Ce.rvF.CLEAR_VALUES_STYLE,{ranges:e})}},{key:"clearNotes",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getSelections();return this._executeCmdBase(Ce.rvF.CLEAR_NOTES,{ranges:e})}},{key:"clearDataValidation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getSelections(),t=this.getActiveCellIndex();return this._executeCmdBase(Ce.rvF.SET_DATA_VALIDATION,{selections:e,activeCell:{row:t.row,col:t.column},needApplyToAll:!1,dataValidationJSON:null})}},{key:"clearDateValidation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getSelections(),t=this.getActiveCellIndex();return this._executeCmdBase(Ce.rvF.SET_DATE_TIME_VALIDATION,{selections:e,activeCell:{row:t.row,col:t.column},needApplyToAll:!1,dataValidationJSON:null})}},{key:"delChart",value:function(e){return this._executeCmdBase(Ce.rvF.SET_CHART,{commandType:2,chartId:e})}},{key:"delConditionalFormat",value:function(e){return this._executeCmdBase(Ce.rvF.SET_CONDITIONAL_FORMAT,{commandType:"del",cfIds:e})}},{key:"delFilter",value:function(){return this._executeCmdBase(Ce.rvF.SET_FILTER,{range:null,col:null,value:null})}},{key:"delFilterView",value:function(e,t){return this._executeCmdBase(Ce.rvF.DEL_VIEW,{value:{viewName:t,viewId:e}})}},{key:"transFilterView",value:(t=(0,u.Z)(i().mark((function e(t,r,n){return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._executeCmdBase(Ce.rvF.ADD_VIEW_NOT_UNDO,{isLocal:!1,value:n})&&this._executeCmdBase(Ce.rvF.DEL_VIEW_NOT_UNDO,{value:{viewName:r,viewId:t}}));case 1:case"end":return e.stop()}}),e,this)}))),function(e,r,n){return t.apply(this,arguments)})},{key:"delFloatImage",value:function(e){return this._executeCmdBase(Ce.rvF.SET_FLOAT_IMAGE,{commandType:2,floatImageIds:e})}},{key:"delReminder",value:function(e,t,r){return this._executeCmdBase(Ce.rvF.SET_REMINDER,{row:e,col:t,reminder:null,cellValue:r})}},{key:"formatPainter",value:function(e,t){return t.conditionFormat&&lS(t.conditionFormat,"format_painter"),this._executeCmdBase(Ce.rvF.FORMAT_PAINTER,Object.assign({},e,{},t))}},{key:"freeze",value:function(e,t){var r=this.inject(It.f3);return!(!r.protectionPermission.curSheetEditable||!r.sheetBusinessEditable)&&this._executeCmdBase(Ce.rvF.FREEZE_SHEET,{target:{row:e,col:t}})}},{key:"enterFilterView",value:function(e){return this._executeCmdBase(Ce.rvF.ENTER_VIEW,{value:{view_id:e}})}},{key:"exitFilterView",value:function(){return this._executeCmdBase(Ce.rvF.EXIT_VIEW)}},{key:"mergeCells",value:function(e){return this._executeCmdBase(Ce.rvF.MERGE_CELLS,{ranges:e,isMerge:!0})}},{key:"splitCells",value:function(e){return this._executeCmdBase(Ce.rvF.MERGE_CELLS,{ranges:e,isMerge:!1})}},{key:"moveRange",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._executeCmdBase(Ce.rvF.MOVE_RANGE,{fromRow:e.row,fromCol:e.col,rowCount:e.rowCount,colCount:e.colCount,toRow:t.row,toCol:t.col,isRowMove:r.isRowMove,isColMove:r.isColMove})}},{key:"protectCol",value:function(e,t,r,n,a){return this._executeCmdBase(Ce.rvF.LOCK_COL,{col:e,colCount:t,lockInfo:r,permId:n,creatorId:a})}},{key:"protectRow",value:function(e,t,r,n,a){return this._executeCmdBase(Ce.rvF.LOCK_ROW,{row:e,rowCount:t,lockInfo:r,permId:n,creatorId:a})}},{key:"resizeCol",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._executeCmdBase(Ce.rvF.RESIZE_COLUMN,{columns:e,size:t,isLocal:r})}},{key:"resizeRow",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._executeCmdBase(Ce.rvF.RESIZE_ROW,{rows:e,size:t,isLocal:r})}},{key:"setCellSegmentArray",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=n.autoFormat,o=void 0!==a&&a,i=n.from,u=n.dontAddToCommandStack,s=void 0!==u&&u;return this._executeCmdBase(Ce.rvF.EDIT_CELL,{row:e,col:t,newSegmentArray:r,autoFormat:o,from:i,dontAddToCommandStack:s})}},{key:"setCellValue",value:function(e,t,r,n,a){return this._executeCmdBase(Ce.rvF.EDIT_CELL,{row:e,col:t,newValue:r,autoFormat:n,newSegmentArray:a})}},{key:"setCellValueByDataValidation",value:function(e,t,r,n,a,o){return this._executeCmdBase(Ce.rvF.SET_VALUE_BY_DATA_VALIDATION,{sheetId:this.id(),sheetName:this.name(),row:e,col:t,text:r,isMultiple:n,formula:a,formulaVar:o})}},{key:"setCellNote",value:function(e,t,r){return this._executeCmdBase(Ce.rvF.SET_CELL_NOTE,{sheetId:this.id(),sheetName:this.name(),row:e,col:t,note:r})}},{key:"setChart",value:function(e,t){return this._executeCmdBase(Ce.rvF.SET_CHART,{commandType:1,chartId:e,data:t})}},{key:"setComments",value:function(e,t,r){return this._executeCmdBase(Ce.rvF.SET_COMMENTS,{target:{row:e,col:t},value:{comments:r}})}},{key:"setConditionalFormat",value:function(e,t){return this._executeCmdBase(Ce.rvF.SET_CONDITIONAL_FORMAT,{commandType:"set",cfId:e,data:t})}},{key:"setFilter",value:function(e,t,r){return this._executeCmdBase(Ce.rvF.SET_FILTER,{range:e,col:t,value:r})}},{key:"setFilterView",value:function(e,t,r){var n=r.range,a=r.col,o=r.value;return this._executeCmdBase(Ce.rvF.SET_FILTER_VIEW,{viewId:e,isLocal:t,range:n,col:a,value:o})}},{key:"setFloatImage",value:function(e){return this._executeCmdBase(Ce.rvF.SET_FLOAT_IMAGE,{commandType:1,data:e})}},{key:"setFontStyle",value:function(e,t,r,n){return this._executeCmdBase(Ce.rvF.SET_STYLE_FONT,{prop:t,value:r,selections:e,isIncrease:n})}},{key:"setFormatter",value:function(e,t){return this._executeCmdBase(Ce.rvF.SET_FORMATTER,{selections:e,value:t})}},{key:"setTextDecoration",value:function(e,t,r){return this._executeCmdBase(Ce.rvF.SET_TEXT_DECORATION,{selections:e,active:r,flag:t})}},{key:"setTextWordWrap",value:function(e,t,r){return this._executeCmdBase(Ce.rvF.SET_RANGE_STYLE,{prop:"wordWrap",value:t,selections:e,isLocal:r})}},{key:"setRangeStyle",value:function(e,t,r,n){return this._executeCmdBase(Ce.rvF.SET_RANGE_STYLE,{prop:t,value:r,selections:e,isLocal:n})}},{key:"setRangeValue",value:function(e,t){return this._executeCmdBase(Ce.rvF.MODIFY_VALUES,{ranges:e,getValueFn:t})}},{key:"setReminder",value:function(e,t,r,n){return this._executeCmdBase(Ce.rvF.SET_REMINDER,{row:e,col:t,reminder:r,cellValue:n})}},{key:"sortRange",value:function(e,t,r){return this._executeCmdBase(Ce.rvF.SORT_RANGE,{target:e,sortConditions:t,sortType:r})}},{key:"moveRowCol",value:function(e,t){return this._executeCmdBase(Ce.rvF.MOVE_ROW_COL,{sourceRg:e,targetRg:t})}},{key:"unfreeze",value:function(e,t){return this._executeCmdBase(Ce.rvF.FREEZE_SHEET,{target:{row:0,col:0}})}},{key:"addFloatBlock",value:function(e){return this._executeCmdBase(Ce.rvF.SET_FLOAT_BLOCK,{commandType:0,data:e})}},{key:"setFloatBlock",value:function(e){return this._executeCmdBase(Ce.rvF.SET_FLOAT_BLOCK,{commandType:1,data:e})}},{key:"delFloatBlock",value:function(e){return this._executeCmdBase(Ce.rvF.SET_FLOAT_BLOCK,{commandType:2,data:e})}},{key:"addEmbeddedBlock",value:function(e){return this._executeCmdBase(Ce.rvF.SET_EMBEDDED_BLOCK,{commandType:0,data:e})}},{key:"setEmbeddedBlock",value:function(e){return this._executeCmdBase(Ce.rvF.SET_EMBEDDED_BLOCK,{commandType:1,data:e})}},{key:"delEmbeddedBlock",value:function(e){return this._executeCmdBase(Ce.rvF.SET_EMBEDDED_BLOCK,{commandType:2,data:e})}},{key:"fill",value:function(e,t,r,n){return this._executeCmdBase(Ce.rvF.FILL,{startRange:e,fillRange:t,autoFillType:r,fillDirection:n})}},{key:"fillRange",value:function(e,t){return this._executeCmdBase(Ce.rvF.FILL_RANGE,{startRange:e,fillRanges:t})}},{key:"horizontalFill",value:function(e,t){return this._executeCmdBase(Ce.rvF.HORIZONTAL_FILL,{startRange:e,fillRange:t})}},{key:"unprotectCol",value:function(e){return this._executeCmdBase(Ce.rvF.UNLOCK_COL,{permId:e})}},{key:"unprotectRow",value:function(e){return this._executeCmdBase(Ce.rvF.UNLOCK_ROW,{permId:e})}},{key:"verticalFill",value:function(e,t){return this._executeCmdBase(Ce.rvF.VERTICAL_FILL,{startRange:e,fillRange:t})}},{key:"hideRow",value:function(e){return this._executeCmdBase(Ce.rvF.SET_ROW_COL_VISIBLE,{ranges:e,action:"hideRow"})}},{key:"unhideRow",value:function(e){return this._executeCmdBase(Ce.rvF.SET_ROW_COL_VISIBLE,{ranges:e,action:"unhideRow"})}},{key:"hideCol",value:function(e){return this._executeCmdBase(Ce.rvF.SET_ROW_COL_VISIBLE,{ranges:e,action:"hideCol"})}},{key:"unhideCol",value:function(e){return this._executeCmdBase(Ce.rvF.SET_ROW_COL_VISIBLE,{ranges:e,action:"unhideCol"})}},{key:"delRow",value:function(e){var t=this,r=[],n=[],a=!1;return(e=Hv(e)).forEach((function(e){var o=e.target,i=e.count;!i||i<=0||o<0?a=!0:(r.push({type:"row",method:"del",target:o,count:i}),n.push(new iu(o,i,t)))})),!a&&this._executeCmdBase(Ce.rvF.SET_ROW_COL_CHANGE,{type:"row",method:"del",ranges:r})}},{key:"delCol",value:function(e){var t=this,r=[],n=[],a=!1;return(e=Hv(e)).forEach((function(e){var o=e.target,i=e.count;!i||i<=0||o<0?a=!0:(r.push({type:"col",method:"del",target:o,count:i}),n.push(new nu(o,i,t)))})),!a&&this._executeCmdBase(Ce.rvF.SET_ROW_COL_CHANGE,{type:"col",method:"del",ranges:r})}},{key:"addRow",value:function(e,t,r){var n=[],a=!1;return r.forEach((function(r){var o,i,u=r.target,s=r.count;!t||t<=0||u<0?a=!0:("up"===e?(o=u,i=u):i=(o=u+s)-1,n.push({type:"row",method:"add",target:o,count:t,source:i,size:r.size}))})),!a&&this._executeCmdBase(Ce.rvF.SET_ROW_COL_CHANGE,{type:"row",method:"add",direction:e,ranges:n})}},{key:"addCol",value:function(e,t,r){var n=[],a=!1;return r.forEach((function(r){var o,i,u=r.target,s=r.count;!t||t<=0||u<0?a=!0:("left"===e?(o=u,i=u):i=(o=u+s)-1,n.push({type:"col",method:"add",target:o,count:t,source:i,size:r.size}))})),!a&&this._executeCmdBase(Ce.rvF.SET_ROW_COL_CHANGE,{type:"col",method:"add",direction:e,ranges:n})}},{key:"_executeCmdBase",value:function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=arguments.length>2?arguments[2]:void 0;return null!==(t=null===(r=this._commandManager())||void 0===r?void 0:r.execute(Object.assign({cmd:e,sheetId:this.id(),sheetName:this.name()},n),a))&&void 0!==t&&t}}]),e}();function c6(e,t){Object.getOwnPropertyNames(t.prototype).forEach((function(r){if("constructor"!==r){var n=Object.getOwnPropertyDescriptor(t.prototype,r);n&&Object.defineProperty(e.prototype,r,n)}}))}function h6(e,t){Object.getOwnPropertyNames(t.prototype).forEach((function(t){"constructor"!==t&&delete e.prototype[t]}))}Vu([s6],l6.prototype,"addCheckbox",null),Vu([s6],l6.prototype,"addFloatImage",null),Vu([s6],l6.prototype,"addReminder",null),Vu([s6],l6.prototype,"clearFormatting",null),Vu([s6],l6.prototype,"clearRangeConditionalFormat",null),Vu([s6],l6.prototype,"clearValues",null),Vu([s6],l6.prototype,"formatPivotTableRange",null),Vu([s6],l6.prototype,"clearValuesAndFormatting",null),Vu([s6],l6.prototype,"clearNotes",null),Vu([s6],l6.prototype,"delReminder",null),Vu([s6],l6.prototype,"formatPainter",null),Vu([s6],l6.prototype,"mergeCells",null),Vu([s6],l6.prototype,"splitCells",null),Vu([s6],l6.prototype,"moveRange",null),Vu([s6],l6.prototype,"setCellSegmentArray",null),Vu([s6],l6.prototype,"setCellValue",null),Vu([s6],l6.prototype,"setCellValueByDataValidation",null),Vu([s6],l6.prototype,"setCellNote",null),Vu([s6],l6.prototype,"setFontStyle",null),Vu([s6],l6.prototype,"setFormatter",null),Vu([s6],l6.prototype,"setTextDecoration",null),Vu([s6],l6.prototype,"setRangeStyle",null),Vu([s6],l6.prototype,"setRangeValue",null),Vu([s6],l6.prototype,"setReminder",null),Vu([s6],l6.prototype,"sortRange",null),Vu([s6],l6.prototype,"moveRowCol",null),Vu([s6],l6.prototype,"unfreeze",null),Vu([s6],l6.prototype,"fill",null),Vu([s6],l6.prototype,"fillRange",null),Vu([s6],l6.prototype,"horizontalFill",null),Vu([s6],l6.prototype,"verticalFill",null),Vu([s6],l6.prototype,"hideRow",null),Vu([s6],l6.prototype,"unhideRow",null),Vu([s6],l6.prototype,"hideCol",null),Vu([s6],l6.prototype,"delRow",null),Vu([s6],l6.prototype,"delCol",null),Vu([s6],l6.prototype,"addRow",null),Vu([s6],l6.prototype,"addCol",null),c6(zM,U4),c6(zM,P4),c6(zM,Zj),c6(zM,r6),c6(zM,L4),c6(zM,n6),c6(zM,o6),c6(zM,i6),c6(zM,u6),c6(zM,l6);var f6=function(e,t,r){var n=e.conditionalFormatModel.getRulesByRange(t);return"clear-duplicate-values"===(null==r?void 0:r.source)?n.filter((function(e){return"duplicateValues"===e.ruleType})):n};function d6(e,t,r){var n=f6(e,t,r),a=[],o=[];return!!n.every((function(r){if(r.isIntersect(t)){var n=function(e,t,r){var n=t.subBaseRanges(r),a=p6(e,t.cfId);return!!a&&(n.length?g6(e,t.cfId,Object.assign({},a,{ranges:n.map((function(e){return gu(e)}))})):v6(e,t.cfId))}(e,r,t);if(!n)return!1;(0,Ce.hTd)(a,n.actions),(0,Ce.hTd)(o,n.oldActions)}return!0}))&&{actions:a,oldActions:o}}function v6(e,t){if(!t||!t.length)return!1;Array.isArray(t)||(t=[t]);var r=[],n=[];return!!t.every((function(t){var a=function(e,t){var r=e.id(),n=e.conditionalFormatModel.getRuleIndex(t);if(n<0)return!1;var a={action:"delConditionalFormat",sheet_id:r,value:{cfId:t,index:n}},o=m6(e,t);return!!o&&{action:a,oldAction:{action:"addConditionalFormat",sheet_id:r,value:Object.assign({},o,{index:n})}}}(e,t);return!!a&&(r.push(a.action),n.push(a.oldAction),!0)}))&&{actions:r,oldActions:n}}function p6(e,t){var r=m6(e,t);return!!r&&(delete r.cfId,Object.assign({},r))}function m6(e,t){var r=uS(e,t);return!!r&&Object.assign({},r.toJSON())}function g6(e,t,r){var n=e.id();if(!t)return!1;var a={action:"setConditionalFormat",sheet_id:n,value:Object.assign({},r,{cfId:t})},o=m6(e,t);return!!o&&{actions:[a],oldActions:[{action:"setConditionalFormat",sheet_id:n,value:o}]}}var y6=function(e,t,r,n){var a=f6(e,t,r).every((function(t){return!e.checkRangesProtected(t.getRanges())}));return!a&&n&&e._raiseInvalidOperation(8,cr("sheet.protection.cannot_start_edit")),a};var _6=function(e,t){return new ou(e.row,e.col,e.rowCount,e.colCount,t)};function R6(e){var t=null==e?void 0:e.sheet();if(!e||!t)return[];var r=t.conditionalFormatModel,n=t.cellModel;if(!r||!n)return[];var a=r.getAllRules();if(a.length<=0)return[];var o=Uv(n.iterVisibleCell(e.rowFrom(),e.colFrom(),e.rowTo(),e.colTo()).reduce((function(e,r){var n=new ou(e.row,e.col,1,1,t);return r.push(n),r}),[])),i=[],u=o[0];return u&&a.forEach((function(e){var t=e.getRanges().map((function(e){return e.intersect(u)})).filter((function(e){return e}));t.length>0&&i.push({rule:e.toJSON(),relativeRanges:t.map((function(e){return is(e,{ref:u},1)}))})})),i}function C6(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3?arguments[3]:void 0,a=Ce.Ps3.getSheetCfCopyEnabled(),o=n||{},i=o.toRanges,u=void 0===i?e.getSelections():i,s=o.isInside,l=void 0===s||s,c=[],h=[],f=e.conditionalFormatModel,d=u[0];if(!d||!f||!a)return{changeset:[],undoChangeset:[]};var v=[],p=f.getAllRules(),y=k6(p.length),_=p.filter((function(e){return e.getRanges().some((function(e){return e.contain(d)}))})),R=function(e){return _.some((function(t){return t.cfId===e}))},C=t.filter((function(e){var t=e.rule;return!R(t.cfId)})),w=C.length===t.length,E=f.getLastIndex(),k=4===r;switch(r){case 0:case 4:if(u&&u[0]){var T=new ou(d.rowFrom(),d.colFrom(),u[0].rowCount(),u[0].colCount(),e);v.push(T),v.push(d)}case 6:var S,A=yr(C);try{for(A.s();!(S=A.n()).done;){var I=S.value,O=I.relativeRanges.map((function(t){return k&&(t={col:t.row,row:t.col,colCount:t.rowCount,rowCount:t.colCount,type:t.type}),ls(t,e,(function(){return e}),{ref:d})})).filter((function(e){return e}));6===r||(0,Ce.hTd)(v,O);var V=w6(I.rule,e,O,E,l),N=(0,g.Z)(V,2),b=N[0],M=N[1];"addConditionalFormat"===b.action&&(E++,y.counting(b)),c.push(b),h.unshift(M)}}catch(e){A.e(e)}finally{A.f()}}if(y.check()){var F=[],Z=[];if(w){var x=d6(e,v,{source:"clear-format"});x&&(F=x.actions,Z=x.oldActions)}return{changeset:[].concat((0,m.Z)(F),c),undoChangeset:[].concat(h,(0,m.Z)(Z))}}return{changeset:[],undoChangeset:[],isOverLimit:!0}}function w6(e,t,r,n,a){var o,i,u=function(e){return!new Set(["uniqueValues","duplicateValues","aboveAverage","dataBar","iconSet","colorScale","expression"]).has(e)}(e.ruleType),s=t.conditionalFormatModel.getRuleById(e.cfId);if(a&&u&&s){var l=s.toJSON(),c=(0,Re.default)(l);o={action:"setConditionalFormat",sheet_id:t.id(),value:Object.assign({},c,{ranges:l.ranges.concat(r.map((function(e){return gu(e,!0)})))})},i={action:"setConditionalFormat",sheet_id:t.id(),value:Object.assign({},c)}}else{var h=iS(t),f=Object.assign({},(0,Re.default)(e),{ranges:r.map((function(e){return gu(e,!0)})),index:n,cfId:h});o={action:"addConditionalFormat",sheet_id:t.id(),value:Object.assign({},f)},i={action:"delConditionalFormat",sheet_id:t.id(),value:{cfId:h,index:n}}}return[o,i]}function E6(e,t,r,n){var a=Ce.Ps3.getSheetCfCopyEnabled(),o=[],i=[],u=function(e,t){var r=e.rowCount(!0),n=e.colCount(!0),a=t.rowCount(!0),o=t.colCount(!0);return{rows:Math.floor(a/r),cols:Math.floor(o/n),lastCopyRows:a%r,lastCopyCols:o%n,fromRangeRowCount:r,fromRangeColCount:n}}(r,n),s=n.rowFrom(),l=n.colFrom();if(!a)return{changeset:o,undoChangeset:i};var c,h=e.conditionalFormatModel,f=h.getLastIndex(),d=k6(h.getAllRules().length),v=[new ou(s,l,u.lastCopyRows+u.rows*u.fromRangeRowCount,u.lastCopyCols+u.cols*u.fromRangeColCount,e)],p=d6(e,v,{source:"clear-format"})||{},y=p.actions,_=void 0===y?[]:y,R=p.oldActions,C=void 0===R?[]:R,w=function(t,r){return _6({row:t+s,col:r+l,rowCount:u.fromRangeRowCount,colCount:u.fromRangeColCount},e)},E=yr(t);try{for(E.s();!(c=E.n()).done;){var k=c.value,T=k.relativeRanges.map((function(t){for(var r=function(r,n){var a=ls(t,e,(function(){return e}),{ref:r}),o=["col","all"].includes(n),i=["row","all"].includes(n);return _6({row:r.rowFrom(),rowCount:i?u.lastCopyRows:r.colCount(),col:r.colFrom(),colCount:o?u.lastCopyCols:r.rowCount()},e).intersect(a)},n=[],a=1;a<=u.rows;a++)for(var o=1;o<=u.cols;o++){var i=(a-1)*u.fromRangeRowCount,s=(o-1)*u.fromRangeColCount,l=w(i,s),c=ls(t,e,(function(){return e}),{ref:l});if(n.push(c),o===u.cols&&u.lastCopyCols){var h=r(w(i,o*u.fromRangeColCount),"col");h&&n.push(h)}if(a===u.rows&&u.lastCopyRows){var f=r(w(a*u.fromRangeRowCount,s),"row");f&&n.push(f)}if(a===u.rows&&o===u.cols&&u.lastCopyRows&&u.lastCopyCols){var d=r(w(a*u.fromRangeRowCount,o*u.fromRangeColCount),"all");d&&n.push(d)}}return Uv(n,void 0,!0)})).filter((function(e){return e.length})),S=w6(k.rule,e,(0,B.Z)(T),f,!0),A=(0,g.Z)(S,2),I=A[0],O=A[1];"addConditionalFormat"===I.action&&(f++,d.counting(I)),o.push(I),i.unshift(O),(0,Ce.hTd)(v,(0,B.Z)(T))}}catch(e){E.e(e)}finally{E.f()}if(d.check()){var V=d6(e,v,{source:"clear-format"});return V&&(_=V.actions,C=V.oldActions),{changeset:[].concat((0,m.Z)(_),o),undoChangeset:[].concat(i,(0,m.Z)(C))}}return{changeset:_,undoChangeset:C,isOverLimit:!0}}function k6(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ce.Ps3.sheetCfMaxCount,r=0,n=function(){return r++},a=function(){return r--};return{counting:function(e){switch(e.action){case"addConditionalFormat":n();break;case"delConditionalFormat":a()}return!0},check:function(){return!(r+e>t)}}}var T6=function(){function e(t){(0,y.Z)(this,e),this.sheet=t,this._spanCache={},this._textCache={},this._styleCache={},this._dropdownCache={},this._dataValidationCache={},this._fontStyleCache={},this._reminderCache={},this._formulaDataCache=new Map}return(0,_.Z)(e,[{key:"getKey",value:function(e,t,r){return"".concat(this.sheet.id(),"|").concat(e,"|").concat(t,"|").concat(r)}},{key:"initConditionalFormatCache",value:function(e){if(!this._conditionalFormatCache&&e){var t;this._conditionalFormatCache=R6(e);var r=null===(t=this.sheet.conditionalFormatModel)||void 0===t?void 0:t.helper;r&&r.saveActionForCopy(this._conditionalFormatCache)}}},{key:"getSpan",value:function(e,t,r){return this.getProperty(e,t,r,this._spanCache,this.sheet.getSpan)}},{key:"getText",value:function(e,t,r){return this.getProperty(e,t,r,this._textCache,this.sheet.getText)}},{key:"getActualStyle",value:function(e,t,r){return this.getProperty(e,t,r,this._styleCache,this.sheet.getStyleWithConditionalFormat)}},{key:"getDropdown",value:function(e,t,r){return this.getProperty(e,t,r,this._dropdownCache,this.sheet.getDropdown)}},{key:"getDataValidation",value:function(e,t){var r=this.getKey(e,t),n=this._dataValidationCache[r];return void 0===n&&(this._dataValidationCache[r]=n=this.sheet.getDataValidation(e,t)),n}},{key:"getConditionalFormat",value:function(e){return!this._conditionalFormatCache&&e&&this.initConditionalFormatCache(e),this._conditionalFormatCache||[]}},{key:"getReminderJSON",value:function(e,t){return this.getProperty(e,t,3,this._reminderCache,this.sheet.getReminderJSON)}},{key:"getFontStyle",value:function(e){var t=this._fontStyleCache[e];return void 0===t&&(this._fontStyleCache[e]=t=wa(e)),t}},{key:"getProperty",value:function(e,t,r,n,a){var o=this.getKey(e,t,r),i=n[o];return void 0===i&&(n[o]=i=a.call(this.sheet,e,t,r)),i}},{key:"serializeFormula",value:function(e){var t=this._formulaDataCache.get(e);if(t)return t;var r={ref:e.getRef()},n=Tp(e,r,{refType:1});return function(e,t){var r=t.refs;for(var n in r){var a=r[n];if(a.sheetId){var o=e.getSheetFromId(a.sheetId);o&&(delete a.sheetId,a.sheetName=o.name())}}}(this.sheet.getParent(),n),this._formulaDataCache.set(e,n),n}}]),e}(),S6=function(){function e(t,r){(0,y.Z)(this,e),this.rowsHasIgnoredCount=0,this.colsHasIgnoredCount=0,this.ignoredRows=new Set,this.ignoredCols=new Set,this.firstRowIndexInFilteredRange=-1,this.sheet=t,this.cache=r||new T6(this.sheet)}return(0,_.Z)(e,[{key:"getIgnoredRowCountInSpan",value:function(e){for(var t=e.rowFrom(),r=e.rowTo(),n=this.firstRowIndexInFilteredRange-t,a=this.firstRowIndexInFilteredRange+1;a<=r;a++)this.ignoredRows.has(a)&&n++;return n}},{key:"getCellInfoPos",value:function(e,t,r){var n=this.cache.getSpan(e,t,r);return{row:n&&e===this.firstRowIndexInFilteredRange?n.rowFrom():e,col:t}}},{key:"isHiddenInSpan",value:function(e,t,r){var n=this.cache.getSpan(e,t,r);return!(!n||this.firstRowIndexInFilteredRange===e&&n.colFrom()===t)}},{key:"serialize",value:function(){var e=this.sheet,t=this.range,r=t.rowFrom(),n=t.colFrom(),a=!1,o=!1,i=e.parent.options.copyPasteHeaderOptions;t instanceof nu&&!(2&~i)&&(a=!0),t instanceof iu&&!(1&~i)&&(o=!0);var u=t.rowCount(),s=t.colCount(),l=this.getRangeImp({row:r,col:n,rowCount:u,colCount:s},3),c=[],h=[],f=[];if(o){var d=e.getColumnCount();c=this.getRangeImp({row:r,rowCount:u,col:0,colCount:d},2)}if(a){var v=e.getRowCount();h=this.getRangeImp({row:0,rowCount:v,col:n,colCount:s},1)}return o&&a&&(f=this.serializeCorner(this.getDefaultValue())),this.join(l,c,h,f)}},{key:"getRangeImp",value:function(e,t){var r=this.ignoredRows,n=this.ignoredCols,a=e.row,o=e.col,i=e.rowCount,u=e.colCount,s=[];this.rowsHasIgnoredCount=0;for(var l=0;l<i;l++){var c=a+l;if(r.has(c))++this.rowsHasIgnoredCount;else{var h=[];this.colsHasIgnoredCount=0;for(var f=0;f<u;f++){var d=o+f;if(n.has(d))++this.colsHasIgnoredCount;else{var v=this.cache.getSpan(c,d,t);v&&v.rowFrom()>this.firstRowIndexInFilteredRange&&(this.firstRowIndexInFilteredRange=c),h.push(this.serializeCell(c,d,t))}}s.push(h)}}return s}},{key:"join",value:function(e,t,r,n){var a=r.length;return a&&(e=r.concat(e)),t.length&&(a&&(t=this.serializeCorner(this.getDefaultValue()).concat(t)),e=t.map((function(t,r){return t.concat(e[r])}))),this.serializeTable(e)}},{key:"getColGroup",value:function(){for(var e=this.sheet,t=this.range,r=this.ignoredCols,n=t.colFrom(),a=t.colCount(),o=[],i=0;i<a;i++){var u=n+i;if(!r.has(u)){var s=e.getColumnWidth(u);o.push(s)}}return o}},{key:"serializeCorner",value:function(e){var t=this.sheet,r=t.getRowCount(),n=t.getColumnCount(),a=new Array(r),o=new Array(n);return o.fill(e),a.fill(o),a}}]),e}(),A6={cellDelimiter:'"',columnDelimiter:"\t",commaDelimiter:",",rowDelimiter:sr()&&sr().windows?"\r\n":"\n"};var I6,O6=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).rowDelimiter=A6.rowDelimiter,e.columnDelimiter=A6.columnDelimiter,e.cellDelimiter=A6.cellDelimiter,e.forceCellDelimiter=!1,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getDefaultValue",value:function(){return""}},{key:"serializeCell",value:function(e,t,r){if(this.isHiddenInSpan(e,t,r))return"";var n=this.getCellInfoPos(e,t,r),a=n.row,o=n.col,i=this.forceCellDelimiter,u=this.columnDelimiter,s=this.cellDelimiter;return function(e,t){var r=t.columnDelimiter,n=t.cellDelimiter;if(arguments.length>2&&void 0!==arguments[2]&&arguments[2]||e.indexOf(r)>-1||/\r\n?|\n/.test(e)){var a=new RegExp(n,"g");e=n+e.replace(a,n+n)+n}return e}(this.cache.getText(a,o,r)||"",{columnDelimiter:u,cellDelimiter:s},i)}},{key:"serializeRow",value:function(e){return e.join(this.columnDelimiter)}},{key:"serializeTable",value:function(e){var t=this;return e.map((function(e){return t.serializeRow(e)})).join(this.rowDelimiter)}}]),t}(S6);function V6(e){if(null==e)return!0;for(var t in e)if(void 0!==e[t])return!1;return!0}function N6(e,t){if(!0===e.wordWrap&&(e.wordWrap=1),!1===e.wordWrap&&(e.wordWrap=0),t&&(e.wordWrap===t.wordWrap&&delete e.wordWrap,e.hAlign===t.hAlign&&delete e.hAlign,e.vAlign===t.vAlign&&delete e.vAlign,e.font&&-1!==t.fonts.indexOf(e.font.replace(/\s+/g,""))&&delete e.font),e.font&&!e.fontInfo){var r=em(e.font),n=r.fontSize,a=r.fontStyle,o=r.fontWeight;e.fontInfo={fontSize:n,fontStyle:a,fontWeight:o},delete e.font}["borderLeft","borderRight","borderTop","borderBottom"].forEach((function(t){e[t]&&e[t].style&&(e[t].width=e[t].style,delete e[t].style),e[t]&&""===e[t].color&&delete e[t]}));var i=function(e){if(null!=e){if("string"==typeof e)return""===e||!e.match(/;/gi)&&e.match(/general/gi)?void 0:{formatCached:e};if(e.formatCached&&"general"!==e.formatCached.toLowerCase())return e}};if(void 0!==e.formatter){var u=i(e.formatter);void 0===u?delete e.formatter:e.formatter=u}if(void 0!==e.autoFormatter){var s=i(e.autoFormatter);void 0===s?delete e.autoFormatter:e.autoFormatter=s}["parentName","hintWidth","hintHeight","watermark","name","validator","themeFont","locked","imeMode","backgroundImageLayout","labelOptions","textIndent","shrinkToFit","backgroundImage","tabStop","cellPadding","cellType"].forEach((function(t){return delete e[t]}))}function b6(e,t){if(e&&e.styles)for(var r in e.styles){var n=e.styles[r];if(null!=n){if(void 0!==n.dropdown){var a=e.dropdowns[n.dropdown];delete n.dropdown,V6(a)||(n.dropdown=a)}N6(n,t)}else e.styles[r]=void 0}return 0}function M6(e){for(var t in e)if("type"!==t&&"id"!==t)throw new Error("mention or image should be a refSegment")}function F6(e,t){return e.value&&Array.isArray(e.value)&&(e.value=e.value.map((function(e){if(e.type){if("mention"===e.type)return M6(e),t.mention[e.id];if("embed-image"===e.type)return M6(e),t.image[e.id];if("attachment"===e.type)return void 0!==e.id?t.attachment[e.id]:e}return delete e.style,void 0!==e.styleId&&t.entities&&t.entities.segmentStyles&&(V6(t.entities.segmentStyles[e.styleId])||(e.style=Z6(t.entities.segmentStyles[e.styleId])),delete e.styleId),e.texts&&Array.isArray(e.texts)&&e.texts.forEach((function(e){void 0!==e.styleId&&t.entities&&t.entities.segmentStyles&&(V6(t.entities.segmentStyles[e.styleId])?delete e.style:e.style=Z6(t.entities.segmentStyles[e.styleId]),delete e.styleId)})),e}))),void 0===e.styleId&&void 0!==e.style&&delete e.style,void 0!==e.styleId&&t.entities&&t.entities.styles&&(V6(t.entities.styles[e.styleId])?delete e.style:(e.style=Z6(t.entities.styles[e.styleId]),e.style&&e.style.dropdown&&(e.dataValidation=f_(e.style.dropdown),delete e.style.dropdown)),delete e.styleId),t.dataValidations&&void 0!==e.dataValidationId&&(V6(t.dataValidations[e.dataValidationId])?delete e.dataValidation:e.dataValidation=Z6(t.dataValidations[e.dataValidationId]),delete e.dataValidationId),0}function Z6(e){return null==e?e:JSON.parse(JSON.stringify(e))}function x6(e,t){var r={mention:Z6(e.mention),image:Z6(e.image),entities:Z6(e.entities),dataValidations:Z6(e.dataValidations),attachment:Z6(e.attachment)};delete e.mention,delete e.image,delete e.entities,delete e.dataValidations,delete e.attachment;var n=e.data&&e.data.dataTable;if(!n)return 0;if(r.entities&&r.entities.segmentStyles)for(var a in r.entities.segmentStyles){var o=r.entities.segmentStyles[a];if(delete o.vAlign,delete o.hAlign,delete o.wordWrap,delete o.borderTop,delete o.borderLeft,delete o.borderRight,delete o.borderBottom,delete o.backColor,delete o.autoFormatter,delete o.formatter,delete o.textRotation,o.font&&!o.fontInfo){var i=em(o.font),u=i.fontSize,s=i.fontStyle,l=i.fontWeight;o.fontInfo={fontSize:u,fontStyle:s,fontWeight:l},delete o.font}}if(b6(r.entities,t),r.mention)for(var c in r.mention){var h=r.mention[c];delete h.text,delete h.icon,delete h.mentionKeyId,void 0!==h.styleId&&r.entities&&r.entities.segmentStyles&&(V6(r.entities.segmentStyles[h.styleId])?delete h.style:h.style=Z6(r.entities.segmentStyles[h.styleId]),delete h.styleId),0!==h.mentionType?(delete h.mentionNotify,delete h.block_notify,delete h.not_notify,delete h.is_external):h.category||(h.category="at-user-block"),"undefined"===h.category&&delete h.category}if(r.dataValidations)for(var f in r.dataValidations){var d=r.dataValidations[f];if(ky(d)){if(d.options){var v={handledWayOnInvalidData:d.options.handledWayOnInvalidData,helpText:d.options.helpText};switch(d.type){case"number":v.validNumType=d.options.validNumType,d.options=v;break;case"date":v.isDatePickerVisibleInCell=d.options.isDatePickerVisibleInCell,d.options=v;break;case"textLength":case"checkbox":d.options=v}}}else"listFromRange"!==d.type?r.dataValidations[f]=null:d.invalid=!0}if(r.attachment)for(var p in r.attachment){var m=r.attachment[p];void 0!==m.styleId&&r.entities&&r.entities.segmentStyles&&(V6(r.entities.segmentStyles[m.styleId])?delete m.style:m.style=Z6(r.entities.segmentStyles[m.styleId]),delete m.styleId)}if(r.image)for(var g in r.image){var y=r.image[g];y.mode&&delete y.mode}for(var _ in n)if(n[_])for(var R in n[_])n[_][R]&&F6(n[_][R],r);return 0}function D6(e){if(!e.sheets)return 0;var t=function(e){var t={fonts:['10pt/1.5"HelveticaNeue",PingFangSC-Regular,"MicrosoftYaHei","HelveticaNeue","MyriadPro","HiraginoSansGB","LucidaGrande",sans-serif','10pt/1.5-apple-system,BlinkMacSystemFont,"HelveticaNeue",Tahoma,"PingFangSC","MicrosoftYahei",Arial,"HiraginoSansGB",sans-serif','10pt/1.5LarkEmojiFont,-apple-system,BlinkMacSystemFont,"HelveticaNeue",Tahoma,"PingFangSC","MicrosoftYahei",Arial,"HiraginoSansGB",sans-serif,"AppleColorEmoji","SegoeUIEmoji","SegoeUISymbol","NotoColorEmoji"','10pt/1.5-apple-system,BlinkMacSystemFont,"HelveticaNeue",Tahoma,"PingFangSC","MicrosoftYahei",Arial,"HiraginoSansGB",sans-serif,"AppleColorEmoji","SegoeUIEmoji","SegoeUISymbol","NotoColorEmoji"'],vAlign:2,hAlign:3,wordWrap:0};if(e.defaults&&e.defaults.style){var r=e.defaults.style;r.font&&(t.fonts=[r.font.replace(/\s+/g,"")]),r.vAlign&&(t.vAlign=r.vAlign),r.hAlign&&(t.hAlign=r.hAlign),r.wordWrap&&(t.wordWrap=r.wordWrap)}return t}(e);for(var r in e.sheets){var n=x6(e.sheets[r],t);if(0!==n)return n}return 0}!function(e){e[e.LayoutChange=0]="LayoutChange",e[e.InvalidateRowHeight=1]="InvalidateRowHeight",e[e.CellMerged=2]="CellMerged",e[e.CellChanged=3]="CellChanged",e[e.ValueChanged=4]="ValueChanged",e[e.RangeChanged=5]="RangeChanged",e[e.SelectionChanged=6]="SelectionChanged",e[e.FormulatextboxRangeChanged=7]="FormulatextboxRangeChanged",e[e.RowHeightChanged=8]="RowHeightChanged",e[e.RowHeightChanging=9]="RowHeightChanging",e[e.ClipboardPasted=10]="ClipboardPasted",e[e.ClipboardPasting=11]="ClipboardPasting",e[e.ColumnWidthChanging=12]="ColumnWidthChanging",e[e.ColumnWidthChanged=13]="ColumnWidthChanged",e[e.UserFormulaEntered=14]="UserFormulaEntered",e[e.ClipboardChanging=15]="ClipboardChanging",e[e.ClipboardChanged=16]="ClipboardChanged",e[e.CancelCutCopyIndicator=17]="CancelCutCopyIndicator",e[e.CommentRemoving=18]="CommentRemoving",e[e.CommentRemoved=19]="CommentRemoved",e[e.CellClick=20]="CellClick",e[e.CellDoubleClick=21]="CellDoubleClick",e[e.BeforeDragDrop=22]="BeforeDragDrop",e[e.DragDropBlock=23]="DragDropBlock",e[e.EditorStatusChanged=24]="EditorStatusChanged",e[e.FrozenChanged=25]="FrozenChanged",e[e.EditEnd=26]="EditEnd",e[e.EditEnding=27]="EditEnding",e[e.EditEnded=28]="EditEnded",e[e.FormulaTextBoxCaretChanged=29]="FormulaTextBoxCaretChanged",e[e.CellRect=30]="CellRect",e[e.TableViewRect=31]="TableViewRect",e[e.SheetContentRect=32]="SheetContentRect",e[e.ScrollRowTo=33]="ScrollRowTo",e[e.ScrollColTo=34]="ScrollColTo",e[e.NextPage=35]="NextPage",e[e.PrePage=36]="PrePage",e[e.HistoryRangesChanged=37]="HistoryRangesChanged",e[e.HistoryTextChanged=38]="HistoryTextChanged",e[e.SearchChanged=39]="SearchChanged",e[e.SetFormatPainter=40]="SetFormatPainter",e[e.SetFilter=41]="SetFilter",e[e.GetResizerStatus=42]="GetResizerStatus",e[e.MobileEditing=43]="MobileEditing",e[e.CHANNEL_STATE_CHANGE=44]="CHANNEL_STATE_CHANGE",e[e.ScrollTo=45]="ScrollTo",e[e.SetScrollPos=46]="SetScrollPos",e[e.ProtectedRangeChange=47]="ProtectedRangeChange",e[e.ConditionalFormatChange=48]="ConditionalFormatChange",e[e.UserPermissionChange=49]="UserPermissionChange",e[e.MoveInCommentCard=50]="MoveInCommentCard",e[e.MoveOutCommentCard=51]="MoveOutCommentCard",e[e.Sorted=83]="Sorted",e[e.EmbedPermissionChange=84]="EmbedPermissionChange",e[e.OrientationChanged=85]="OrientationChanged",e[e.RecordFPSLog=86]="RecordFPSLog",e[e.AddCfSelectionHighlight=87]="AddCfSelectionHighlight",e[e.RemoveCfSelectionHighlight=88]="RemoveCfSelectionHighlight",e[e.AddProtectionSelectionHighlight=89]="AddProtectionSelectionHighlight",e[e.RemoveProtectionSelectionHIghlight=90]="RemoveProtectionSelectionHIghlight",e[e.ConditionalFormatSelectionChange=91]="ConditionalFormatSelectionChange",e[e.BlockSelectionStateChanged=92]="BlockSelectionStateChanged",e[e.PlayReminderNotifyAnimation=93]="PlayReminderNotifyAnimation",e[e.MarkDirty=94]="MarkDirty",e[e.FloatImageMoveEnd=95]="FloatImageMoveEnd",e[e.GridLineHidden=96]="GridLineHidden",e[e.getCanvasBoundingClientRect=97]="getCanvasBoundingClientRect",e[e.NotExpendCellRect=98]="NotExpendCellRect",e[e.ExportablePermissionChanged=99]="ExportablePermissionChanged",e[e.LogicCellRect=100]="LogicCellRect",e[e.ThemeChanged=101]="ThemeChanged",e[e.PivotTableRangeChange=102]="PivotTableRangeChange",e[e.UpdatePivotTableHighlightRanges=103]="UpdatePivotTableHighlightRanges",e[e.RemovePivotTableHighlightRanges=104]="RemovePivotTableHighlightRanges",e[e.CanvasOutsideMouseUp=105]="CanvasOutsideMouseUp",e[e.CellWidthHint=106]="CellWidthHint",e[e.AiHighlightAreaChange=107]="AiHighlightAreaChange",e[e.UpdateSparklineHighlightRanges=108]="UpdateSparklineHighlightRanges",e[e.RemoveSparklineHighlightRanges=109]="RemoveSparklineHighlightRanges",e[e.ScrollRangeTo=110]="ScrollRangeTo",e[e.HideInvisibleSheet=111]="HideInvisibleSheet",e[e.ShowVisibleSheet=112]="ShowVisibleSheet"}(I6||(I6={}));var P6,$6,L6=function(){function e(t,r,n){var a=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};(0,y.Z)(this,e),this.subscriber=null,this._isDeleted=!1,this.handleDeleteRow=function(e,t){e.forEach((function(e){var r=e.target,n=e.count;a.row>=r&&a.row<r+n&&(a._isDeleted=!0,a.onDeleted&&a.onDeleted("RowDeleted",{sheetId:t.id(),rowFrom:r,rowCount:n}))}))},this.handleDeleteCol=function(e,t){e.forEach((function(e){var r=e.target,n=e.count;a.col>=r&&a.col<r+n&&(a._isDeleted=!0,a.onDeleted&&a.onDeleted("ColumnDeleted",{sheetId:t.id(),colFrom:r,colCount:n}))}))},this.handleDeleteSheet=function(e){var t=e.sheetId;t===a.sheet.id()&&(a._isDeleted=!0,a.onDeleted&&a.onDeleted("SheetSoftDeleted",{sheetId:t}))},this.sheet=n,this.range=new uu(t,r,n),this.onDeleted=o.onDeleted,n.parent.watchHub().watchRef(this.range,null),this.subscriber=this.sheet.parent.subscribe(this.getDepends())}return(0,_.Z)(e,[{key:"getDepends",value:function(){return{SheetSoftDeleted:this.handleDeleteSheet,RowDeleted:this.handleDeleteRow,ColumnDeleted:this.handleDeleteCol}}},{key:"destroy",value:function(){this.sheet.parent.watchHub().unWatchRef(this.range),this.subscriber&&(this.subscriber.unsubscribe(),this.subscriber=null)}},{key:"getValue",value:function(){return this.sheet.getValue(this.row,this.col)}},{key:"getSegmentArray",value:function(){return this.sheet.getSegmentArray(this.row,this.col)}},{key:"getChangesetValue",value:function(){return this.sheet.getChangesetValue(this.row,this.col)}},{key:"getText",value:function(){return this.sheet.getText(this.row,this.col)}},{key:"row",get:function(){return this.range.rowFrom()}},{key:"col",get:function(){return this.range.colFrom()}},{key:"isDeleted",get:function(){return this._isDeleted}}]),e}();!function(e){e.Sheet="sheet",e.BlockSheet="blockSheet"}(P6||(P6={})),function(e){e.Sheet="spreadsheet",e.Grid="grid",e.Kanban="kanban",e.Gantt="gantt",e.Gallery="gallery",e.Form="form",e.Template="Template",e.Calendar="calendar"}($6||($6={}));var B6,U6,H6,z6={},W6={_util:_g,_ThemeContext:Pm,_SpanModel:DA,_SheetDataModel:TA,_SelectionModel:$A,AxisModel:tI,CellModel:uI,Range:ou,util:_g,GC$:sa,findControl:function(e){return"string"==typeof e&&(e=document.getElementById(e)),pg(e).data("workbook")},getTypeFromString:function(e){var t=!1,r=window;if("string"==typeof e){for(var n=e.split("."),a=0,o=n.length;a<o&&r;a++)r=r[n[a]];r&&o>0&&a===o&&(t=!0)}return t?r:void 0},CursorResource:{ResizeCol:"col-Resize",ResizeRow:"row-resize",ResizeHiddenCol:"w-resize",ResizeHiddenRow:"n-resize"},VisualState:{normal:0,highlight:1,selected:2,active:3,hover:4},SortState:{none:0,ascending:1,descending:2},Point:La,Rect:$a,Style:Om,LineBorder:dm,Workbook:I4,HorizontalPosition:i4,VerticalPosition:u4,ShowResizeTip:{none:0,column:1,row:2,both:3},ResizeZeroIndicator:{default:0,enhanced:1},Worksheet:zM,HeaderAutoText:{blank:0,numbers:1,letters:2},CommandKeys:Ce.rvF,staticMembers:b3,SelectionPolicy:{single:0,range:1,multiRange:2},SelectionUnit:{cell:0,row:1,column:2},Fill:z6,Dropdown:Rg,Touch:{},FloatingObjects:{},Filter:{},Tables:{},Slicers:{}};function G6(e,t){if(t){var r=t.value,n=t.range,a=t.col;e.setFilter(n,a,r)}else e.delFilter()}function j6(e){return{type:Ce.xj7.ROW,row:e.row,rowCount:e.row_count}}function Y6(e,t){return{type:Ce.xj7.ROW,sheetId:t,row:e.row,rowCount:e.row_count}}function q6(e){return{row:e.row,row_count:e.rowCount}}function J6(e){return{type:Ce.xj7.COL,col:e.col,colCount:e.col_count}}function K6(e,t){return{type:Ce.xj7.COL,sheetId:t,col:e.col,colCount:e.col_count}}function X6(e){return{col:e.col,col_count:e.colCount}}function Q6(e,t){return{type:Ce.xj7.CELL,row:e,col:t,rowCount:1,colCount:1}}function e8(e){return{type:Ce.xj7.NORMAL,row:e.row,col:e.col,rowCount:e.row_count,colCount:e.col_count}}function t8(e,t){return{type:Ce.xj7.NORMAL,sheetId:t,row:e.row,col:e.col,rowCount:e.row_count,colCount:e.col_count}}function r8(e){return{row:e.row,col:e.col,row_count:e.rowCount,col_count:e.colCount}}function n8(e,t){return{type:Ce.xj7.NORMAL,sheetId:t,row:e.row,col:e.col,rowCount:1,colCount:1}}function a8(e){return{type:Ce.xj7.NORMAL,row:e.row,col:e.col,rowCount:1,colCount:1}}function o8(e){return{row:e.row,col:e.col}}function i8(e){return{type:Ce.xj7.NORMAL,row:e.row,col:e.col,rowCount:e.rowCount,colCount:e.colCount}}function u8(e,t){return t.row>=e.row&&t.rowEnd<=e.rowEnd&&t.col>=e.col&&t.colEnd<=e.colEnd}function s8(e,t){return t.row===e.row&&t.rowEnd===e.rowEnd&&t.col===e.col&&t.colEnd===e.colEnd}function l8(e,t){var r=f8(e),n=f8(t);return n.row<=r.rowEnd&&n.rowEnd>=r.row&&n.col<=r.colEnd&&n.colEnd>=r.col}function c8(e,t){return e.row<=t.row+t.row_count-1&&e.row+e.row_count-1>=t.row&&e.col<=t.col+t.col_count-1&&e.col+e.col_count-1>=t.col}function h8(e,t){if(!l8(e,t))return null;var r=f8(e),n=f8(t);return{row:Math.max(r.row,n.row),rowEnd:Math.min(r.rowEnd,n.rowEnd),col:Math.max(r.col,n.col),colEnd:Math.min(r.colEnd,n.colEnd)}}function f8(e){switch(e.type){case Ce.xj7.ALL:return{row:0,col:0,rowEnd:1/0,colEnd:1/0};case Ce.xj7.CELL:return{row:e.row,col:e.col,rowEnd:e.row,colEnd:e.col};case Ce.xj7.ROW:return{row:e.row,rowEnd:e.row+e.rowCount-1,col:0,colEnd:1/0};case Ce.xj7.COL:return{row:0,rowEnd:1/0,col:e.col,colEnd:e.col+e.colCount-1};default:return{row:e.row,rowEnd:e.row+e.rowCount-1,col:e.col,colEnd:e.col+e.colCount-1}}}function d8(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Merge",n=e.index,a=e.count,o=t.index,i=t.count;if(o>n+a-1)return e;if(o>n)switch(r){case"Merge":return{index:n,count:a+i};case"Split":return[{index:o+i,count:a-(o-n)},{index:n,count:o-n}]}return{index:n+i,count:a}}function v8(e,t){var r=e.index,n=e.count,a=t.index,o=t.count,i=a+o-1;if(i<r)return{index:r-o,count:n};var u=r+n-1;return a>u?e:a<=r?i>=u?null:{index:a,count:u-i}:i>=u?{index:r,count:a-r}:{index:r,count:n-o}}function p8(e,t){return t.index<e?e+t.count:e}function m8(e,t){var r=t.index,n=t.count,a=r+n-1;return r<e&&e<=a?r:e>a?e-n:e}function g8(e,t){return t.index<=e?e+t.count:e}function y8(e,t){var r=t.index,n=t.count,a=r+n-1;return r<=e&&e<=a?Math.max(0,r-1):e>a?e-n:e}function _8(e,t){for(var r=[],n=0;n<t.length;n++){var a=R8(e,t[n]);null!=a&&r.push(a)}return r}function R8(e,t){if(t.type===Ce.xj7.ALL)return t;switch(e.type){case 0:if(t.type===Ce.xj7.COL)break;return C8(e,t);case 1:if(t.type===Ce.xj7.ROW)break;return E8(e,t);case 2:if(t.type===Ce.xj7.COL)break;return w8(e,t);case 3:if(t.type===Ce.xj7.ROW)break;return k8(e,t)}return t}function C8(e,t,r){var n={index:t.row,count:t.rowCount},a=d8(n,e,r);if(a===n)return t;if(Array.isArray(a))return a.map((function(e){var r=e.index,n=e.count;return Object.assign({},t,{row:r,rowCount:n})}));var o=a.index,i=a.count;return Object.assign({},t,{row:o,rowCount:i})}function w8(e,t){var r={index:t.row,count:t.rowCount},n=v8(r,e);if(!n)return null;if(r===n)return t;var a=n.index,o=n.count;return t.type===Ce.xj7.CELL?Object.assign({},t,{row:a,rowCount:1}):Object.assign({},t,{row:a,rowCount:o})}function E8(e,t,r){var n={index:t.col,count:t.colCount},a=d8(n,e,r);if(a===n)return t;if(Array.isArray(a))return a.map((function(e){var r=e.index,n=e.count;return Object.assign({},t,{col:r,colCount:n})}));var o=a.index,i=a.count;return Object.assign({},t,{col:o,colCount:i})}function k8(e,t){var r={index:t.col,count:t.colCount},n=v8(r,e);if(!n)return null;if(n===r)return t;var a=n.index,o=n.count;return t.type===Ce.xj7.CELL?Object.assign({},t,{col:a,colCount:1}):Object.assign({},t,{col:a,colCount:o})}function T8(e,t,r){for(var n=[],a=0;a<r.dataRanges.length;a++){var o=r.dataRanges[a];if(o.sheetId===t){var i=R8(e,r.dataRanges[a]);null!=i&&n.push(i)}else n.push(o)}r.dataRanges=n}function S8(e){var t=Array.isArray(e)?e:[e];return function(e,r){return e.sheet_id!==r.sheet_id?r:"value"in e&&"value"in r&&e.value&&r.value&&t.every((function(t){return e.value&&r.value&&e.value[t]===r.value[t]}))?null:r}}!function(e){e[e.SUCC=0]="SUCC",e[e.FAIL_PERM_ID_REPERT=1]="FAIL_PERM_ID_REPERT",e[e.FAIL_PERM_ID_EMPTY=2]="FAIL_PERM_ID_EMPTY",e[e.FAIL_PERM_ID_INVALID=3]="FAIL_PERM_ID_INVALID"}(B6||(B6={})),function(e){e[e.AddRow=0]="AddRow",e[e.AddCol=1]="AddCol",e[e.DelRow=2]="DelRow",e[e.DelCol=3]="DelCol"}(U6||(U6={})),function(e){e.Merge="Merge",e.Split="Split"}(H6||(H6={}));var A8=function(){function e(t){(0,y.Z)(this,e),this.op=t,this.isDirty=!1}return(0,_.Z)(e,[{key:"setOp",value:function(e){return this.isDirty||(this.isDirty=!0,this.op=ga(this.op)),e(this.op),this.op}},{key:"getOp",value:function(){return this.op}}]),e}();function I8(e,t){var r=ga(e);return t(r),r}var O8=function(e,t){if("copySheetMutation"===e.action||"copySheetMutation"===t.action)return!0;var r=[e.value.block_type,t.value.block_type].every((function(e){return e===Ce.kHU.DOCX_BLOCK})),n=[e.action,t.action].every((function(e){return["addBlock","restoreBlock"].includes(e)}));return!r||!n};function V8(e){console.error("Unexpected object",e)}function N8(e,t,r){return C8({type:1,index:t.row,count:t.rowCount},e,r)}function b8(e,t,r){return E8({type:1,index:t.col,count:t.colCount},e,r)}function M8(e,t){return w8({type:2,index:t.row,count:t.rowCount},e)}function F8(e,t){return k8({type:3,index:t.col,count:t.colCount},e)}function Z8(e,t){if("delConditionalFormat"===t.action||"moveConditionalFormat"===t.action)return t;if(t.value.hasRef)return!1;var r=[];switch(e.action){case"addRow":r=_8({type:0,index:e.target.row,count:e.target.row_count},t.value.ranges);break;case"addCol":r=_8({type:1,index:e.target.col,count:e.target.col_count},t.value.ranges);break;case"delRow":r=_8({type:2,index:e.target.row,count:e.target.row_count},t.value.ranges);break;case"delCol":r=_8({type:3,index:e.target.col,count:e.target.col_count},t.value.ranges)}return I8(t,(function(e){e.value.ranges=r}))}function x8(e){return"addConditionalFormat"===e.action||"setConditionalFormat"===e.action||"delConditionalFormat"===e.action}function D8(e){for(var t=0;t<e.length;)fw(e[t])?e.splice(t,1):t++}function P8(e){return!(!(0,Ce.i55)(e)||!(e.value.target.col<0||e.value.target.row<0||e.value.target.colCount<1||e.value.target.rowCount<1)||(Ce.Ps3.moirae.teaLog(Object.assign({key:"client_sheet_action_range_invalid",from:"follow"},e.value.target)),0))}function $8(e){for(var t=0;t<e.length;)P8(e[t])?e.splice(t,1):t++;return e}function L8(e,t){if("delFloatBlock"===t.action)return t;if(e.sheet_id!==t.sheet_id)return t;switch(e.action){case"addRow":var r=R8({type:0,index:e.target.row,count:e.target.row_count},Q6(t.value.row,t.value.col));if(r)return I8(t,(function(e){e.value.row=r.row}));break;case"addCol":var n=R8({type:1,index:e.target.col,count:e.target.col_count},Q6(t.value.row,t.value.col));if(n)return I8(t,(function(e){e.value.col=n.col}));break;case"delRow":return I8(t,(function(r){r.value.row=y8(t.value.row,{index:e.target.row,count:e.target.row_count})}));case"delCol":return I8(t,(function(r){r.value.col=y8(t.value.col,{index:e.target.col,count:e.target.col_count})}))}return t}function B8(e){return["setFloatBlock","delFloatBlock"].includes(e.action)}function U8(e,t){if("delEmbeddedBlock"===t.action)return t;if(e.sheet_id!==t.sheet_id)return t;switch(e.action){case"addRow":var r=R8({type:0,index:e.target.row,count:e.target.row_count},Q6(t.target.row,t.target.col));if(r)return I8(t,(function(e){e.target.row=r.row}));break;case"addCol":var n=R8({type:1,index:e.target.col,count:e.target.col_count},Q6(t.target.row,t.target.col));if(n)return I8(t,(function(e){e.target.col=n.col}));break;case"delRow":return I8(t,(function(r){r.target.row=y8(t.target.row,{index:e.target.row,count:e.target.row_count})}));case"delCol":return I8(t,(function(r){r.target.col=y8(t.target.col,{index:e.target.col,count:e.target.col_count})}))}return t}function H8(e){return["setEmbeddedBlock","delEmbeddedBlock"].includes(e.action)}var z8=function(){function e(){(0,y.Z)(this,e),this.sheets=new Map}return(0,_.Z)(e,[{key:"getSheetFromId",value:function(e){return this.sheets.get(e)||null}},{key:"createSheetFromId",value:function(e,t){var r;return this.sheets.has(e)?(r=this.sheets.get(e)).name(t):(r=new W8(this,e,t),this.sheets.set(e,r)),r}}]),e}(),W8=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;(0,y.Z)(this,e),this.parent=t,this._id=r,this._name=n}return(0,_.Z)(e,[{key:"id",value:function(){return this._id}},{key:"name",value:function(e){return e&&(this._name=e),this._name}},{key:"getRowCount",value:function(){return No}},{key:"getColumnCount",value:function(){return bo}},{key:"getParent",value:function(){return this.parent}}]),e}(),G8=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"equals",value:function(e,t){return(0,me.default)(e,t)}},{key:"getHash",value:function(e){return Fa(e)}}]),t}(Iy),j8=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"equals",value:function(e,t){return e.tokens.length===t.tokens.length&&e.tokens.join("")===t.tokens.join("")&&JSON.stringify(e.refs)===JSON.stringify(t.refs)&&JSON.stringify(e.params)===JSON.stringify(t.params)&&e.importRangeId===t.importRangeId&&JSON.stringify(e.externalDataReference)===JSON.stringify(t.externalDataReference)}},{key:"getHash",value:function(e){return Fa({tokens:e.tokens,refs:e.refs,externalDataReference:e.externalDataReference,importRangeId:e.importRangeId})}},{key:"serializeRef",value:function(e){return e}}]),t}(Iy),Y8=Ce.TcH,q8=function(e,t,r,n,a){r.ignoreValue=null===a.getSegmentArray(e,t);var o=a.getCellStyle(e,t),i=o?n.styleRefMgr.getStyleId(o):null;r.styleId=i,X8(e,t,a,n,r)},J8=function(e,t,r,n,a){if(!r.ignoreStyle){var o=a.getCellStyle(e,t,void 0,!0),i=o?n.styleRefMgr.getStyleId(o):null;r.styleId=i}if(!r.ignoreDataValidation){var u=a.getDataValidation(e,t),s=u?n.dvJSONRefMgr.getValidationId(u):null;r.dataValidationId=s}X8(e,t,a,n,r)};function K8(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{ignoreValue:!1,ignoreStyle:!1,ignoreDataValidation:!1,ignoreFilterRow:!1,ignorePivotTable:!1},n=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,o=t7(e.id(),t);null==a||a(r,o);for(var i=t.row+t.rowCount-1,u=t.col+t.colCount-1,s=t.row;s<=i;s++)if(!r.ignoreFilterRow||e.filterModel.isVisible(s))for(var l=t.col;l<=u;l++)n?n(s,l,r,o,e):X8(s,l,e,o,r);return Q8(o),o}function X8(e,t,r,n){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},o=a.cellValue,i=a.ignoreDataValidation,u=a.ignoreValue,s=a.ignoreStyle,l=a.ignoreFormulaData,c=a.ignoreMultipleValues,h=a.ignoreReminder,f=a.needNote,d=a.ignorePivotTable,v=a.styleId,p=a.dataValidationId,m=a.isLocal,g=n.target,y=g.row,_=g.col,R=g.col_count,C=[0,null,null,null,null,null,null,null,null,null,null],w=0;if(!u){var E=o?o.value:r.getChangesetValue(e,t,d);w=a7(Y8.CELL_VALUE),Array.isArray(E)&&(n7(E,n.styleRefMgr),E.some(Ce.S3_)&&(w=a7(8,w)),E.some(Ce.MgP)&&(w=a7(9,w))),C[Y8.CELL_VALUE]=E}if(!s)if(w=a7(Y8.STYLE_INDEX,w),null===v||"number"==typeof v)C[Y8.STYLE_INDEX]=v;else{var k,T=o?o.style:(null===(k=r._getStyleImp(e,t,void 0,d))||void 0===k?void 0:k.toJSON())||null;C[Y8.STYLE_INDEX]=T?n.styleRefMgr.add(T).id:null}if(!l){w=a7(Y8.FORMULADATA_INDEX,w);var S=o?o.formulaData:r.getFormulaData(e,t,void 0,d,!0);S&&(S.externalDataReference&&(w=a7(7,w)),C[Y8.FORMULADATA_INDEX]=S?n.formulaDataRefMgr.add(S).id:null)}if(!i)if(w=a7(Y8.DATAVALIDATION_INDEX,w),null===p||"number"==typeof p)C[Y8.DATAVALIDATION_INDEX]=p;else{var A=o?o.dataValidation:r.dataValidationService.getDataValidationJSON(e,t,{needDeepClone:!0},d);A&&(C[Y8.DATAVALIDATION_INDEX]=n.dvJSONRefMgr.add(A).id)}if(!c){w=a7(Y8.MULTIPLE_VALUE_INDEX,w);var I=o?o.multipleValues:r.getMultipleValuesJSON(e,t);I&&(C[Y8.MULTIPLE_VALUE_INDEX]=I.map((function(e){return n.multipleValuesJSONRefMgr.add(e).id})))}if(!h){w=a7(Y8.REMINDER,w);var O=o?o.reminder:r.getReminderChangeset(e,t);O&&(C[Y8.REMINDER]=O)}if(f){w=a7(Y8.NOTE,w);var V=o?o.note:r.getCellNoteJSON(e,t);V&&(C[Y8.NOTE]=V)}return m&&(n.is_local=m),C[Y8.CHANGED_FLAG]=w,0!==w&&(r7(C,C.length-1),n.value.value[(e-y)*R+(t-_)]=C),n}function Q8(e){e.styleRefMgr.isEmpty()||(e.value.style=e.styleRefMgr.toArray()),e.formulaDataRefMgr.isEmpty()||(e.value.formulaData=e.formulaDataRefMgr.toArray()),e.dvJSONRefMgr&&!e.dvJSONRefMgr.isEmpty()&&(e.value.dataValidation=e.dvJSONRefMgr.toArray()),e.multipleValuesJSONRefMgr&&!e.multipleValuesJSONRefMgr.isEmpty()&&(e.value.multipleValues=e.multipleValuesJSONRefMgr.toArray()),delete e.styleRefMgr,delete e.formulaDataRefMgr,delete e.dvJSONRefMgr,delete e.multipleValuesJSONRefMgr}function e7(e,t,r,n){return e<0||t<0||r<=0||n<=0||!Number.isFinite(r*r)||r*n%1!=0||r*n>67108864}function t7(e,t){var r=t.row,n=t.col,a=t.rowCount,o=t.colCount;if(e7(r,n,a,o))throw new Error("invalid target row: ".concat(r,", col: ").concat(n,", rowCount: ").concat(a,", colCount: ").concat(o));var i={action:"setRangeValues",sheet_id:e,target:{row:t.row,col:t.col,row_count:t.rowCount,col_count:t.colCount},value:{value:new Array(t.colCount*t.rowCount).fill(null)}};return function(e){e.styleRefMgr=new pA(-1),e.formulaDataRefMgr=new j8(-1),e.dvJSONRefMgr=new Y_(-1),e.multipleValuesJSONRefMgr=new G8(-1)}(i),i}function r7(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=1,a=e[Y8.CHANGED_FLAG],o=Math.min(t,e.length-1);o>r;o--)if(P5(o,a)&&!(0,re.Z)(e[o])){n=o+1;break}e.length=n}function n7(e,t){return e.forEach((function(e){e.style&&(e.styleId=t.add(e.style).id,delete e.style),e.texts&&(e.texts.length>0?e.texts.forEach((function(e){e.style&&(e.styleId=t.add(e.style).id,delete e.style)})):delete e.texts)}))}function a7(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;switch(e){case Y8.CELL_VALUE:return 1|t;case Y8.STYLE_INDEX:return 2|t;case Y8.FORMULADATA_INDEX:return 4|t;case Y8.DATAVALIDATION_INDEX:return 8|t;case Y8.MULTIPLE_VALUE_INDEX:return 16|t;case Y8.REMINDER:return 32|t;case 7:return 64|t;case 8:return 128|t;case 9:return 256|t;case Y8.NOTE:return 512|t;default:return 1<<e-1|t}}function o7(e,t,r){switch(e){case"addRow":return[new vu(!0,"add",r.row,r.row_count,t)];case"addCol":return[new vu(!1,"add",r.col,r.col_count,t)];case"delRow":return[new vu(!0,"delete",r.row,r.row_count,t)];case"delCol":return[new vu(!1,"delete",r.col,r.col_count,t)];case"delSheet":return[new mu(t)];default:return[]}}var i7=new Set(["addRow","addCol","delRow","delCol","delSheet","setSheet","copySheet","copySheetMutation"]);var u7=function(){function e(){(0,y.Z)(this,e),this.fmlRefWatch=new jt.WatchedRefHub,this.invalidRef=new Map,this.dirtyTree=new Set,this.workbook=new z8,this.actionRefFollowHandlerMap={setCell:new s7,setRangeValues:new l7}}return(0,_.Z)(e,[{key:"classifyAndRegisterRef",value:function(e,t){for(var r in t){var n=t[r];n.isValid()?this.fmlRefWatch.watchRef(n,e):this.invalidRef.has(e)?this.invalidRef.get(e).add(n):this.invalidRef.set(e,new Set([n]))}}},{key:"isActionChangeSheetName",value:function(e){return"setSheet"===e.action&&"name"===e.value.property_name||(0,Ce._8D)(e)&&void 0===e.value.snapshot}},{key:"changeSheetNameHandler",value:function(e){var t=this,r=new Map;this.invalidRef.forEach((function(n,a){n.forEach((function(n){if(n.sheetName===e.value.sheet_name){var o=t.workbook.createSheetFromId(e.sheet_id,e.value.sheet_name);n.setSheet(o),t.fmlRefWatch.watchRef(n,a),r.set(a,n),t.dirtyTree.add(a)}}))})),r.forEach((function(e,r){var n=t.invalidRef.get(r);n&&(n.delete(e),0===n.size&&t.invalidRef.delete(r))}))}},{key:"applyActionsToRefs",value:function(e){var t,r=this,n=yr(e);try{for(n.s();!(t=n.n()).done;){var a=(0,g.Z)(t.value,1)[0];if(this.isActionChangeSheetName(a))this.changeSheetNameHandler(a);else{var o=this.workbook.createSheetFromId(a.sheet_id);"delSheet"===a.action&&o.name(a.value.sheet_name);var i=a.target,u=o7(a.action,o,i);this.fmlRefWatch.onRefOp(u,(function(e,t){r.dirtyTree.add(t)}))}}}catch(e){n.e(e)}finally{n.f()}}},{key:"exportDirtyFormulaData",value:function(e){var t=this;this.dirtyTree.forEach((function(r){Object.values(t.actionRefFollowHandlerMap).forEach((function(n){n.exportDirtyFormulaData(r,t.workbook,e)}))}))}},{key:"follows",value:function(e,t){var r=this,n=function(e,t){for(var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=new Map,a=r;a<e.length;a++)t(e[a])&&n.set(e[a],a);return n}(e,(function(e){return i7.has(e.action)}));if(0===n.size)return t.Ops;var a=t.filter((function(e){return!!r.actionRefFollowHandlerMap[e.action]&&r.actionRefFollowHandlerMap[e.action].filter(e)}));if(0===a.size)return t.Ops;var o,i=yr(a);try{for(i.s();!(o=i.n()).done;){var u=o.value,s=t.getAction(u);this.actionRefFollowHandlerMap[s.action].getRefRangesAndFormulaTreeInAction(s,this.workbook,u).forEach((function(e){var t=e.fmlTree,n=e.refRanges;n&&r.classifyAndRegisterRef(t,n)}))}}catch(e){i.e(e)}finally{i.f()}return this.applyActionsToRefs(n),this.exportDirtyFormulaData(t),t.toJSON()}}]),e}(),s7=function(){function e(){(0,y.Z)(this,e),this.tree2ActionIdx=new Map}return(0,_.Z)(e,[{key:"filter",value:function(e){return"string"==typeof e.value?function(e){return e.includes('"formulaData"')}(e.value):function(e){return void 0!==e.formulaData}(e.value)}},{key:"getRefRangesAndFormulaTreeInAction",value:function(e,t,r){var n=e.sheet_id,a=e.value,o=new jk(a.formulaData,t.createSheetFromId(n),(function(e){return t.createSheetFromId(e)})),i=o.getRefs();return null!==i&&this.tree2ActionIdx.set(o,r),[{fmlTree:o,refRanges:i}]}},{key:"exportDirtyFormulaData",value:function(e,t,r){var n=this.tree2ActionIdx.get(e);if("number"==typeof n){var a=r.getActionMut(n);if(a){var o=a.target,i=o.col,u=o.row,s=new ou(u,i,1,1,t.getSheetFromId(a.sheet_id));a.value.formulaData.refs=e.exportRefs(s)}}}}]),e}(),l7=function(){function e(){(0,y.Z)(this,e),this.fmlData2ActionAndIndexArrMap=new Map}return(0,_.Z)(e,[{key:"filter",value:function(e){return void 0!==e.value.formulaData}},{key:"exportDirtyFormulaData",value:function(e,t,r){var n=this.fmlData2ActionAndIndexArrMap.get(e.formulaData);if(n){var a=r.getActionMut(n.idxInOpWrapper),o=a.sheet_id,i=a.target,u=i.row,s=i.col,l=i.col_count,c=a.value,h=c.value,f=c.formulaData;n.indexInValue.forEach((function(r){var n=Math.floor(r/l),a=new ou(n+u,r-n*l+s,1,1,t.getSheetFromId(o));h[r][Ce.TcH.FORMULADATA_INDEX]=f.length;var i=ga(e.formulaData);i.refs=e.exportRefs(a),f.push(i)}))}}},{key:"getRefRangesAndFormulaTreeInAction",value:function(e,t,r){for(var n=[],a=e.sheet_id,o=0;o<e.value.value.length;o++){var i=e.value.value[o];if(i&&"number"==typeof i[Ce.TcH.FORMULADATA_INDEX]){var u=i[Ce.TcH.FORMULADATA_INDEX],s=e.value.formulaData[u];if(s){var l=this.fmlData2ActionAndIndexArrMap.get(s);if(l)l.indexInValue.push(o);else{this.fmlData2ActionAndIndexArrMap.set(s,{idxInOpWrapper:r,indexInValue:[o]});var c=new jk(s,t.createSheetFromId(a),(function(e){return t.createSheetFromId(e)})),h=c.getRefs();n.push({fmlTree:c,refRanges:h})}}}}return n}}]),e}(),c7=function(){function e(t){(0,y.Z)(this,e),this.ops=t,this.opsLen=t.length}return(0,_.Z)(e,[{key:"filter",value:function(e){for(var t=new Set,r=0;r<this.opsLen;r++)e(this.ops[r])&&t.add(r);return t}},{key:"Ops",get:function(){return this.ops}}]),e}(),h7=function(e){function t(e){var r;return(0,y.Z)(this,t),(r=(0,d.Z)(this,(0,v.Z)(t).call(this,e))).ops=e,r.mutActionMap=new Map,r}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"getAction",value:function(e){return this.ops[e]}},{key:"getActionMut",value:function(e){if(this.mutActionMap.has(e))return this.mutActionMap.get(e);var t=ga(this.ops[e]);return this.mutActionMap.set(e,t),t}},{key:"toJSON",value:function(){if(0===this.mutActionMap.size)return this.ops;var e,t=Array.from(this.ops),r=yr(this.mutActionMap);try{for(r.s();!(e=r.n()).done;){var n=(0,g.Z)(e.value,2),a=n[0],o=n[1];t[a]=o}}catch(e){r.e(e)}finally{r.f()}return t}}]),t}(c7);function f7(e,t,r){switch(e.action){case"setCell":if(r&&y7(e.target,t.target)){e.extra&&(e=W3(ga(e)));var n=t7(t.sheet_id,a8(e.target));return X8(e.target.row,e.target.col,C7(t.sheet_id),n,{cellValue:e.value,ignoreValue:void 0===e.value.value,ignoreStyle:void 0===e.value.style,ignoreDataValidation:void 0===e.value.dataValidation,ignoreReminder:void 0===e.value.reminder,ignoreFormulaData:void 0===e.value.formulaData,ignoreMultipleValues:void 0===e.value.multipleValues,needNote:void 0!==e.value.note}),Q8(n),v7(n,t,!0)}return t;case"setRange":if(r){var a=i8(e.value.target),o=e8(t.target);if(l8(a,o)){var i=(new z8).createSheetFromId(t.sheet_id),u=new ou(a.row,a.col,a.rowCount,a.colCount,i),s=new ou(o.row,o.col,o.rowCount,o.colCount,i);return v7(_7(e,u.intersect(s).toJSON()),t,!0)}}return t;case"updateRange":if(r){var l=i8(e.value.target),c=e8(t.target);if(l8(l,c)){for(var h=(new z8).createSheetFromId(t.sheet_id),f=new ou(l.row,l.col,l.rowCount,l.colCount,h),d=new ou(c.row,c.col,c.rowCount,c.colCount,h),v=f.intersect(d),p=new Map,m=e.value.style,g=ga(t),y=v.rowFrom();y<=v.rowTo();y++)for(var _=v.colFrom();_<=v.colTo();_++){var C=g.value.value[p7(y,_,c.row,c.col,c.rowCount,c.colCount)];if(Array.isArray(C)){var w=C[Ce.TcH.CHANGED_FLAG];for(var E in e.value)if("style"===E)if(m){var k;if(!P5(Ce.TcH.STYLE_INDEX,w))continue;var T=null!==(k=C[Ce.TcH.STYLE_INDEX])&&void 0!==k?k:null;if(null===T){w=$5(Ce.TcH.STYLE_INDEX,w);continue}if(!p.has(T)&&g.value.style){var S=g.value.style.length;p.set(T,S);var A=ga(g.value.style[T]);if(m.fontInfo){var I=A[0];if("object"==(0,R.Z)(I)){var O=vm.withUpdate(I,m.fontInfo);A[0]=O.toJSON()}else if(hm())A[0]=Ca._updateFont(I||"",m.fontInfo).font;else{var V=I?vm.valueOf(I):vm.EMPTY;V=vm.withUpdate(V,m.fontInfo),A[0]=V.toJSON()}}for(var N in m.textDecoration&&("number"!=typeof m.textDecoration?A[3]=Ca._updateTextDecoration(A[3],m.textDecoration):A[3]=m.textDecoration),m)"fontInfo"!==N&&"textDecoration"!==N&&(A[Ce.Wa0[N]]=m[N]);C[Ce.TcH.STYLE_INDEX]=S,g.value.style.push(A)}else C[Ce.TcH.STYLE_INDEX]=p.get(T)||null}else e.value.hasOwnProperty("style")&&(w=$5(Ce.TcH.STYLE_INDEX,w));else d7[E]&&(w=$5(d7[E],w));C[Ce.TcH.CHANGED_FLAG]=w}}return m7([g])}}return t;case"sort":var b=e8(e.target),M=e8(t.target);if(l8(b,M)){var F=(new z8).createSheetFromId(t.sheet_id),Z=new ou(b.row,b.col,b.rowCount,b.colCount,F),x=new ou(M.row,M.col,M.rowCount,M.colCount,F).intersect(Z);if(null!==x){for(var D=[],P={},$=0;$<e.value.length;$++)P[e.value[$]]=$+b.row;var L=new ou(x.rowFrom(),x.colFrom(),x.rowCount(),x.colCount(),F),B=ga(t);return L.splitByRow().forEach((function(e){var r=e.rowFrom(),n=g7(t);n.target={row:P[r],col:e.colFrom(),row_count:1,col_count:e.colCount()};for(var a=p7(r,n.target.col,M.row,M.col,M.rowCount,M.colCount),o=a;o<a+n.target.col_count;o++)n.value.value.push(B.value.value[o]),B.value.value[o]=null;D.push(n,B)})),m7(D)}}return t;case"setSpans":var U=e8(e.target),H=e8(t.target);if((0,ue.default)(e.value)||!l8(U,H))return t;var z=(new z8).createSheetFromId(t.sheet_id),W=new ou(H.row,H.col,H.rowCount,H.colCount,z),G=ga(t),j=[G];return e.value.forEach((function(e){var t=e.target;if(l8(e8(t),H)){var r=new ou(t.row,t.col,1,1,z),n=new ou(t.row,t.col,t.row_count,t.col_count,z);if(W.contain(r)){var a=n.intersect(W),o=G.value.value[p7(t.row,t.col,H.row,H.col,H.rowCount,H.colCount)],i=null;if(o){var u=o[Ce.TcH.CHANGED_FLAG],s=o[Ce.TcH.STYLE_INDEX];P5(Ce.TcH.STYLE_INDEX,u)&&"number"==typeof s&&(i=[a7(Ce.TcH.STYLE_INDEX),null,s])}for(var l=a.rowFrom();l<=a.rowTo();l++)for(var c=a.colFrom();c<=a.colTo();c++){var h;l===t.row&&c===t.col||(G.value.value[p7(l,c,H.row,H.col,H.rowCount,H.colCount)]=(null===(h=i)||void 0===h?void 0:h.slice())||null)}if(i){var f,d=n.sub(a),v=i[Ce.TcH.STYLE_INDEX],p=null,m=i.slice();m[Ce.TcH.STYLE_INDEX]=0,null!==(f=G.value.style)&&void 0!==f&&f[v]&&(p=[G.value.style[v]]),d.forEach((function(e){j.push({action:"setRangeValues",sheet_id:G.sheet_id,target:e.toNormalRange(),value:{value:new Array(e.size()).fill(m.slice()),style:ga(p)}})}))}}else{var g=n.intersect(W);if(g)for(var y=g.rowFrom();y<=g.rowTo();y++)for(var _=g.colFrom();_<=g.colTo();_++)G.value.value[p7(y,_,H.row,H.col,H.rowCount,H.colCount)]=null}}})),m7(j);case"addRow":var Y=e.target.row,q=e.target.row_count,J=t.target,K=J.row,X=J.row_count,Q=J.col_count,ee=K+X-1;return Y<=K?I8(t,(function(e){e.target.row+=q})):K<Y&&Y<=ee?I8(t,(function(e){e.target.row_count+=q,(0,Ce.b$t)(e.value.value,(Y-K)*Q,0,new Array(q*Q).fill(null))})):t;case"addCol":var te=e.target.col,re=e.target.col_count,ne=t.target,ae=ne.col,oe=ne.col_count,ie=ne.row_count,se=ae+oe-1;if(te<=ae)return I8(t,(function(e){e.target.col+=re}));if(ae<te&&te<=se){var le=g7(t);le.target.col_count+=re;for(var ce=0;ce<ie;ce++)for(var he=0;he<le.target.col_count;he++){var fe=null;he+ae<te?fe=t.value.value[ce*oe+he]:he+ae>=te+re&&(fe=t.value.value[ce*oe+he-re]),le.value.value.push(fe)}return le}return t;case"delRow":var de=j6(e.target),ve=e8(t.target),pe=M8(ve,de);return null===pe?null:pe!==ve?pe.rowCount===ve.rowCount?I8(t,(function(e){e.target=r8(pe)})):I8(t,(function(e){e.target=r8(pe);var t=ve.colCount;e.value.value.splice((de.row-ve.row)*t,de.rowCount*t)})):t;case"delCol":var me=J6(e.target),ge=me.col,ye=ge+me.colCount-1,_e=e8(t.target),Re=_e.col,we=_e.rowCount,Ee=_e.colCount,ke=F8(_e,me);if(null===ke)return null;if(ke!==_e){if(ke.colCount===_e.colCount)return I8(t,(function(e){e.target=r8(ke)}));var Te=g7(t);Te.target=r8(ke);for(var Se=0;Se<we;Se++)for(var Ae=0;Ae<Ee;Ae++)(Ae+Re<ge||Ae+Re>ye)&&Te.value.value.push(t.value.value[Se*Ee+Ae]);return Te}return t;case"moveRange":var Ie=e.value,Oe=Ie.target,Ve=Ie.source,Ne=e8(t.target),be=t.target,Me=be.row,Fe=be.col,Ze=be.row_count,xe=be.col_count,De=Object.assign({sheetId:t.sheet_id},Ne),Pe=G7(Ve,De),$e=G7(Oe,De);if(!Pe&&!$e)return t;var Le=(new z8).createSheetFromId(e.value.source.sheetId),Be=(new z8).createSheetFromId(e.value.target.sheetId),Ue=[];if(Pe){var He=new ou(Ve.row,Ve.col,Ve.rowCount,Ve.colCount,Le),ze=new ou(Me,Fe,Ze,xe,Le).intersect(He).toJSON(),We=ze.row,Ge=ze.col,je=ze.rowCount,Ye=ze.colCount,qe=We+je-1,Je=Ge+Ye-1;Ue.push(I8(t,(function(e){for(var t=We;t<=qe;t++)for(var r=Ge;r<=Je;r++)e.value.value[p7(t,r,Me,Fe,Ze,xe)]=null})));var Ke=g7(t);Ke.sheet_id=e.value.target.sheetId,Ke.target={row:We-He.rowFrom()+Oe.row,col:Ge-He.colFrom()+Oe.col,row_count:je,col_count:Ye};for(var Xe=0;Xe<je;Xe++)for(var Qe=0;Qe<Ye;Qe++)Ke.value.value.push(ga(t.value.value[p7(We+Xe,Ge+Qe,Me,Fe,Ze,xe)]));Ue.push(Ke)}if($e){var et,tt=new ou(Oe.row,Oe.col,Oe.rowCount,Oe.colCount,Be),rt=new ou(Me,Fe,Ze,xe,Be).intersect(tt),nt=rt.rowFrom(),at=rt.colFrom();et=Ue[0]?Ue[0]:ga(t);for(var ot=0;ot<rt.rowCount();ot++)for(var it=0;it<rt.colCount();it++)et.value.value[p7(ot+nt,it+at,Me,Fe,Ze,xe)]=null;Ue[0]||Ue.push(et)}return m7(Ue)}return t}var d7={value:Ce.TcH.CELL_VALUE,style:Ce.TcH.STYLE_INDEX,formulaData:Ce.TcH.FORMULADATA_INDEX,dataValidation:Ce.TcH.DATAVALIDATION_INDEX,multipleValues:Ce.TcH.MULTIPLE_VALUE_INDEX,reminder:Ce.TcH.REMINDER,note:Ce.TcH.NOTE};function v7(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!r)return t;switch(t.action){case"setCell":if(y7(t.target,e.target)){t.extra&&(t=W3(ga(t)));var n=e.value.value[p7(t.target.row,t.target.col,e.target.row,e.target.col,e.target.row_count,e.target.col_count)];if(!Array.isArray(n))break;return v7(e,_7(t,a8(t.target)),!0)}break;case"setRangeValues":var a=e8(e.target),o=e8(t.target);if(l8(a,o)){var i=(new z8).createSheetFromId(e.sheet_id),u=new ou(a.row,a.col,a.rowCount,a.colCount,i),s=new ou(o.row,o.col,o.rowCount,o.colCount,i),l=u.intersect(s);t=ga(t);for(var c=l.rowFrom();c<=l.rowTo();c++)for(var h=l.colFrom();h<=l.colTo();h++){var f=p7(c,h,a.row,a.col,a.rowCount,a.colCount),d=p7(c,h,o.row,o.col,o.rowCount,o.colCount);t.value.value[d]=R7(e.value.value[f],t.value.value[d])}return m7([t])}break;case"updateRange":var v=e8(e.target),p=i8(t.value.target);if(l8(v,p)){var m=(new z8).createSheetFromId(e.sheet_id),g=new ou(v.row,v.col,v.rowCount,v.colCount,m),y=new ou(p.row,p.col,p.rowCount,p.colCount,m),_=g.intersect(y),R=g7(e);R.target=_.toNormalRange();for(var C=_.rowFrom();C<=_.rowTo();C++)for(var w=_.colFrom();w<=_.colTo();w++)R.value.value.push(e.value.value[p7(C,w,v.row,v.col,v.rowCount,v.colCount)]);return[t,R]}break;case"setRange":var E=e8(e.target),k=i8(t.value.target);if(l8(E,k))return v7(e,_7(t,k),!0)}return t}function p7(e,t,r,n,a,o){return(e-r)*o+t-n}function m7(e){return e.filter((function(e){if("setRangeValues"===e.action){if(0===e.value.value.length)return!1;for(var t=0;t<e.value.value.length;t++)if(Array.isArray(e.value.value[t])&&0!==e.value.value[t][Ce.TcH.CHANGED_FLAG])return!0;return!1}return!0}))}function g7(e){var t={action:"setRangeValues",sheet_id:e.sheet_id,target:{row:e.target.row,col:e.target.col,row_count:e.target.row_count,col_count:e.target.col_count},value:{value:[]}};return e.value.style&&(t.value.style=ga(e.value.style)),e.value.formulaData&&(t.value.formulaData=ga(e.value.formulaData)),e.value.dataValidation&&(t.value.dataValidation=ga(e.value.dataValidation)),e.value.multipleValues&&(t.value.multipleValues=ga(e.value.multipleValues)),t}function y7(e,t){return e.row>=t.row&&e.row<t.row+t.row_count&&e.col>=t.col&&e.col<t.col+t.col_count}function _7(e,t){var r={};for(var n in e.value){var a=e.value[n];"target"!==n&&void 0!==a&&(r[n]=a)}return K8(C7(e.sheet_id),t,{cellValue:r,ignoreValue:void 0===e.value.value,ignoreStyle:void 0===e.value.style,ignoreDataValidation:void 0===e.value.dataValidation,ignoreReminder:void 0===e.value.reminder,ignoreFormulaData:void 0===e.value.formulaData,ignoreMultipleValues:void 0===e.value.multipleValues,needNote:void 0!==e.value.note})}function R7(e,t){if(!Array.isArray(e)||!Array.isArray(t))return t||null;function r(e,t,r){return!P5(r,n)&&P5(r,a)}var n=e[Ce.TcH.CHANGED_FLAG],a=t[Ce.TcH.CHANGED_FLAG],o=Boolean(53&n);for(var i in Ce.TcH)switch(i){case"CHANGED_FLAG":break;case"CELL_VALUE":!o&&r(0,0,Ce.TcH.CELL_VALUE)||(t[Ce.TcH.CELL_VALUE]=null,a=$5(Ce.TcH.CELL_VALUE,a));break;case"STYLE_INDEX":r(0,0,Ce.TcH.STYLE_INDEX)||(t[Ce.TcH.STYLE_INDEX]=null,a=$5(Ce.TcH.STYLE_INDEX,a));break;case"FORMULADATA_INDEX":!o&&r(0,0,Ce.TcH.FORMULADATA_INDEX)||(t[Ce.TcH.FORMULADATA_INDEX]=null,a=$5(Ce.TcH.FORMULADATA_INDEX,a));break;case"DATAVALIDATION_INDEX":r(0,0,Ce.TcH.DATAVALIDATION_INDEX)||(t[Ce.TcH.DATAVALIDATION_INDEX]=null,a=$5(Ce.TcH.DATAVALIDATION_INDEX,a));break;case"MULTIPLE_VALUE_INDEX":!o&&r(0,0,Ce.TcH.MULTIPLE_VALUE_INDEX)||(t[Ce.TcH.MULTIPLE_VALUE_INDEX]=null,a=$5(Ce.TcH.MULTIPLE_VALUE_INDEX,a));break;case"REMINDER":!o&&r(0,0,Ce.TcH.REMINDER)||(t[Ce.TcH.REMINDER]=null,a=$5(Ce.TcH.REMINDER,a));break;case"NOTE":r(0,0,Ce.TcH.NOTE)||(t[Ce.TcH.NOTE]=null,a=$5(Ce.TcH.NOTE,a))}return 0===a?null:(t[Ce.TcH.CHANGED_FLAG]=a,r7(t,t.length-1),t)}function C7(e){return{id:function(){return e}}}function w7(e,t){return e.row===t.row&&e.col===t.col}function E7(e,t){return w7(e.target,t.target)?null:t}var k7,T7=["value","multipleValues","formula","formulaData","reminder","note"];function S7(e){for(var t=!1,r=0;r<T7.length;r++)if(e.hasOwnProperty(T7[r])){t=!0;break}return t}function A7(e,t){var r={},n=S7(e);for(var a in t)T7.includes(a)&&n||(r[a]=t[a]);return ga(r)}function I7(e){if(e.style&&e.style.dropdown&&!e.dataValidation){var t=f_(e.style.dropdown);return Object.assign({},e,{style:Object.assign({},e.style,{dropdown:null}),dataValidation:t})}return e}function O7(e,t){t.value.dataValidation&&e.style&&e.style.dropdown&&(e.hasOwnProperty(Qg)?t.value.dataValidation=e.dataValidation:delete t.value.dataValidation)}function V7(e){return e.dataValidation&&e.style&&(e.style=Object.assign({},e.style,{dropdown:null})),e}function N7(e){return e.style&&e.style.dropdown&&!e.dataValidation&&(e.dataValidation=null),e}function b7(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!e.value.hasOwnProperty("style")&&null===e.value.dataValidation&&!t.value.hasOwnProperty("style")&&t.value.dataValidation)return[t,e];var a=0===n?e:t,o=A7(e.value,t.value);return I8(a,(function(t){o=I7(o);var r=I7(e.value);o=N7(o=V7(o)),t.value=Object.assign({},o,r),O7(r,t)}))}!function(e){e[e.OP1=0]="OP1",e[e.OP2=1]="OP2"}(k7||(k7={}));var M7={updateRange:{updateRange:function(e,t,r){if(!r)return t;var n=ga(e.value),a=A7(e.value,t.value),o=ga(t.value);if(n=I7(n),a=I7(a),o=I7(o),a=V7(a),o=N7(o),n.style){var i,u=yr(["dropdown"]);try{for(u.s();!(i=u.n()).done;){var s=i.value;void 0!==n.style[s]&&a.style&&delete a.style[s]}}catch(e){u.e(e)}finally{u.f()}}var l={},c="updateRange";if(null===n.style)l=null;else if(null===a.style)if(void 0===n.style)l=null;else{c="setRange";var h=Mm().clone().toJSON(!0);D7(n.style,h),l=h}else l=(0,ae.Z)({},a.style,n.style),n.style&&void 0!==n.style.dropdown||!l||!(null===a.style||void 0===a.style&&a.dataValidation)||(l.dropdown=null);var f=Object.assign({},o,n);return f.style=l,I8(e,(function(e){e.action=c,e.value=f,O7(n,e)}))},setRange:function(e,t,r){return b7(t,e,r,!t.value.style&&e.value.style?1:0)}},setRange:{setRange:function(e,t,r){return r?b7(e,t):t},updateRange:function(e,t,r){return b7(e,t,r,!e.value.style&&t.value.style?1:0)}}};function F7(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(t.action){case"setCell":var n=f8(i8(e.value.target)),a=f8(a8(t.target));if(!r||!u8(n,a))return t;if("setRange"===e.action)return I8(t,(function(t){return x7(e,t),t}));if("updateRange"===e.action)return I8(t,(function(t){return P7(e,t),t}));break;case"setRangeValues":return f7(e,t,r);case"delSheet":return(!r||e.sheet_id!==t.sheet_id)&&t;case"setRange":case"updateRange":var o=i8(e.value.target),i=i8(t.value.target);if(!l8(o,i))return t;var u=(new z8).createSheetFromId(t.sheet_id),s=new ou(o.row,o.col,o.rowCount,o.colCount,u),l=new ou(i.row,i.col,i.rowCount,i.colCount,u);if(s.equal(l))return M7[e.action][t.action](e,t,r);if(!r)return t;var c=l.intersect(s),h=[t];if(null!==c){var f=I8(e,(function(e){e.value.target={type:Ce.xj7.NORMAL,row:c.rowFrom(),col:c.colFrom(),rowCount:c.rowCount(),colCount:c.colCount()}}));h.push(f)}return $8(h)}return t}function Z7(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(e.action){case"setCell":var n=f8(a8(e.target)),a=f8(i8(t.value.target));return r&&u8(a,n)?[t,e]:t;case"addRow":var o=e.target.row,i=e.target.row_count,u=t.value.target,s=u.row,l=u.rowCount,c=s+l-1;if(o<=s)return I8(t,(function(e){e.value.target.row+=i}));if(s<o&&o<=c){var h=I8(t,(function(e){e.value.target.rowCount=o-s})),f=I8(t,(function(e){e.value.target.row=o+i,e.value.target.rowCount=l-h.value.target.rowCount}));return $8([h,f])}return t;case"addCol":var d=e.target.col,v=e.target.col_count,p=t.value.target,m=p.col,g=p.colCount,y=m+g-1;if(d<=m)return I8(t,(function(e){e.value.target.col+=v}));if(m<d&&d<=y){var _=I8(t,(function(e){e.value.target.colCount=d-m})),C=I8(t,(function(e){e.value.target.col=d+v,e.value.target.colCount=g-_.value.target.colCount}));return $8([_,C])}return t;case"delRow":var w=j6(e.target),E=i8(t.value.target),k=M8(E,w);if(null===k)return null;if(k!==E)return $8([I8(t,(function(e){e.value.target=Object.assign({},k,{type:Ce.xj7.NORMAL})}))]);break;case"delCol":var T=J6(e.target),S=i8(t.value.target),A=F8(S,T);if(null===A)return null;if(A!==S)return $8([I8(t,(function(e){e.value.target=Object.assign({},A,{type:Ce.xj7.NORMAL})}))]);break;case"setSpans":var I=e8(e.target),O=i8(t.value.target);if((0,ue.default)(e.value)||!l8(I,O))return t;var V,N=(new z8).createSheetFromId(t.sheet_id),b=[t],M=yr(e.value);try{var F=function(){var e,r=V.value.target,n=new ou(r.row,r.col,1,1,N),a=[],o=yr(b);try{var i=function(){var o=e.value,i=i8(o.value.target),u=new ou(r.row,r.col,r.row_count,r.col_count,N),s=new ou(i.row,i.col,i.rowCount,i.colCount,N),l=s.sub(u);if(s.contain(n)){var c=u.sub(n);if(o.value.style){var h=ga(o.value.style);delete h.dropdown,(0,ue.default)(h)||c.forEach((function(e){var t=e.toJSON();a.push({action:o.action,sheet_id:o.sheet_id,value:{target:{type:Ce.xj7.NORMAL,row:t.row,col:t.col,rowCount:t.rowCount,colCount:t.colCount},style:h}})}))}l.push(n)}for(var f=function(e){var r=l[e].toJSON(),n=I8(t,(function(e){e.value.target={type:e.value.target.type,row:r.row,col:r.col,rowCount:r.rowCount,colCount:r.colCount}}));a.push(n)},d=0;d<l.length;d++)f(d)};for(o.s();!(e=o.n()).done;)i()}catch(e){o.e(e)}finally{o.f()}b=[].concat(a)};for(M.s();!(V=M.n()).done;)F()}catch(e){M.e(e)}finally{M.f()}return $8(b);case"sort":var Z=e8(e.target),x=i8(t.value.target);if(l8(Z,x)){var D=function(){for(var r=(new z8).createSheetFromId(t.sheet_id),n=new ou(Z.row,Z.col,Z.rowCount,Z.colCount,r),a=new ou(x.row,x.col,x.rowCount,x.colCount,r),o=a.intersect(n),i=[],u={},s=0;s<e.value.length;s++)u[e.value[s]]=s;if(null!==o){var l,c=new ou(o.rowFrom(),o.colFrom(),o.rowCount(),o.colCount(),r),h=yr(c.splitByRow());try{var f=function(){var r=l.value,n=r.rowFrom(),a=I8(t,(function(t){t.value.target={type:Ce.xj7.NORMAL,row:u[n]+e.target.row,col:r.colFrom(),rowCount:r.rowCount(),colCount:r.colCount()}}));i.push(a)};for(h.s();!(l=h.n()).done;)f()}catch(e){h.e(e)}finally{h.f()}for(var d=a.sub(c),v=function(e){var r=d[e].toJSON(),n=I8(t,(function(e){e.value.target={type:Ce.xj7.NORMAL,row:r.row,col:r.col,rowCount:r.rowCount,colCount:r.colCount}}));i.push(n)},p=0;p<d.length;p++)v(p)}return{v:$8(i)}}();if("object"===(0,R.Z)(D))return D.v}return t;case"moveRange":var P=e.value,$=P.target,L=P.source,B=i8(t.value.target),U=Object.assign({sheetId:t.sheet_id},B),H=G7(L,U),z=G7($,U);if(!H&&!z)return t;var W,G=(new z8).createSheetFromId(e.value.source.sheetId),j=(new z8).createSheetFromId(e.value.target.sheetId),Y=[ga(t)];if(H){var q=Y.shift(),J=new ou(L.row,L.col,L.rowCount,L.colCount,G),K=new ou(B.row,B.col,B.rowCount,B.colCount,G),X=K.intersect(J),Q=new A8(q);Q.setOp((function(e){e.sheet_id=$.sheetId})),Q.setOp((function(e){e.value.target.row=$.row+(X.rowFrom()-L.row),e.value.target.col=$.col+(X.colFrom()-L.col),e.value.target.rowCount=X.rowCount(),e.value.target.colCount=X.colCount()})),W=Q.getOp();var ee,te=K.sub(X),re=yr(te);try{var ne=function(){var e=ee.value,t=I8(q,(function(t){t.value.target.row=e.rowFrom(),t.value.target.col=e.colFrom(),t.value.target.rowCount=e.rowCount(),t.value.target.colCount=e.colCount()}));Y.push(t)};for(re.s();!(ee=re.n()).done;)ne()}catch(e){re.e(e)}finally{re.f()}}if(z){var ae,oe=new ou($.row,$.col,$.rowCount,$.colCount,j),ie=[],se=yr(Y);try{for(se.s();!(ae=se.n()).done;){var le,ce=ae.value,he=new ou(ce.value.target.row,ce.value.target.col,ce.value.target.rowCount,ce.value.target.colCount,j).sub(oe),fe=yr(he);try{var de=function(){var e=le.value,r=I8(t,(function(t){t.value.target.row=e.rowFrom(),t.value.target.col=e.colFrom(),t.value.target.rowCount=e.rowCount(),t.value.target.colCount=e.colCount()}));ie.push(r)};for(fe.s();!(le=fe.n()).done;)de()}catch(e){fe.e(e)}finally{fe.f()}}}catch(e){se.e(e)}finally{se.f()}Y=ie}return W&&Y.push(W),$8(Y)}return t}function x7(e,t){var r=!1;for(var n in"string"==typeof t.value&&(r=!0,t.value=JSON.parse(t.value)),e.value)t.value[n]=e.value[n];r&&(t.value=JSON.stringify(t.value))}function D7(e,t){if(e.fontInfo)if(t.fontInfo){var r=vm.withUpdate(t.fontInfo,e.fontInfo);t.fontInfo=r.toJSON(),delete t.font}else if(hm())t.font=Ca._updateFont(t.font||"",e.fontInfo).font;else{var n=vm.valueOf(t.font);n=vm.withUpdate(n,e.fontInfo),t.fontInfo=n.toJSON(),delete t.font}for(var a in e.textDecoration&&((0,ve.default)(e.textDecoration)?t.textDecoration=e.textDecoration:t.textDecoration=Ca._updateTextDecoration(t.textDecoration,e.textDecoration)),e)"fontInfo"!==a&&"textDecoration"!==a&&(t[a]=e[a])}function P7(e,t){var r=!1;for(var n in"string"==typeof t.value&&(r=!0,t.value=JSON.parse(t.value)),e.value)"style"!==n&&(t.value[n]=e.value[n]);e.value.style?(t.value.style=t.value.style?t.value.style:{},D7(e.value.style,t.value.style)):e.value.hasOwnProperty("style")&&(t.value.style=null),r&&(t.value=JSON.stringify(t.value))}function $7(e){return tA((new z8).createSheetFromId("mock"),e)}function L7(e,t){return e.setRowFrom(t.row),e.setColFrom(t.col),e.setRowCount(t.rowCount),e.setColCount(t.colCount),e.toString({ref:e})}function B7(e,t){if(e.sheet_id!==t.sheet_id)return t;if("delSparklineGroup"===t.action)return t;var r=ga(t);switch(e.action){case"addRow":r=I8(r,(function(r){for(var n=0,a=Object.entries(t.value);n<a.length;n++){var o=(0,g.Z)(a[n],2),i=o[0],u=o[1];if(null!=u&&u.sparklines)for(var s=0,l=Object.entries(u.sparklines);s<l.length;s++){var c=(0,g.Z)(l[s],2),h=c[0],f=c[1];if(f){if(f.position){var d=U7(e.target,0,f.position,!0);d&&(r.value[i].sparklines[h].position.row=d.row)}var v=$7(f.source);if(v){var p=H7(e.target,0,v.toJSON(),!0);p&&(r.value[i].sparklines[h].source=L7(v,p))}}}}}));break;case"addCol":r=I8(r,(function(r){for(var n=0,a=Object.entries(t.value);n<a.length;n++){var o=(0,g.Z)(a[n],2),i=o[0],u=o[1];if(null!=u&&u.sparklines)for(var s=0,l=Object.entries(u.sparklines);s<l.length;s++){var c=(0,g.Z)(l[s],2),h=c[0],f=c[1];if(f){if(f.position){var d=U7(e.target,1,f.position,!1);d&&(r.value[i].sparklines[h].position.col=d.col)}var v=$7(f.source);if(v){var p=H7(e.target,1,v.toJSON(),!1);p&&(r.value[i].sparklines[h].source=L7(v,p))}}}}}));break;case"delRow":r=I8(r,(function(r){for(var n=0,a=Object.entries(t.value);n<a.length;n++){var o=(0,g.Z)(a[n],2),i=o[0],u=o[1];if(null!=u&&u.sparklines)for(var s=0,l=Object.entries(u.sparklines);s<l.length;s++){var c=(0,g.Z)(l[s],2),h=c[0],f=c[1];if(null!=f&&f.position){var d=U7(e.target,2,f.position,!0);if(!d){var v;null===(v=r.value[i])||void 0===v||delete v.sparklines[h];break}r.value[i].sparklines[h].position.row=d.row}if(null!=f&&f.source){var p=$7(f.source);if(!p)break;var m=H7(e.target,2,p.toJSON(),!0);m&&(r.value[i].sparklines[h].source=L7(p,m))}}}}));break;case"delCol":r=I8(r,(function(r){for(var n=0,a=Object.entries(t.value);n<a.length;n++){var o=(0,g.Z)(a[n],2),i=o[0],u=o[1];if(u.sparklines)for(var s=0,l=Object.entries(u.sparklines);s<l.length;s++){var c=(0,g.Z)(l[s],2),h=c[0],f=c[1];if(null!=f&&f.position){var d=U7(e.target,3,f.position,!1);if(!d){delete r.value[i].sparklines[h];break}r.value[i].sparklines[h].position.col=d.col}if(null!=f&&f.source){var v=$7(f.source);if(!v)break;var p=H7(e.target,3,v.toJSON(),!1);p&&(r.value[i].sparklines[h].source=L7(v,p))}}}}));break;case"moveRange":r=I8(r,(function(r){var n=e.value,a=n.source,o=n.target;if(a.sheetId===t.sheet_id||o.sheetId===t.sheet_id)for(var i=a.sheetId!==o.sheetId,u=Object.assign({},e.value.source,{type:e.value.type}),s=Object.assign({},e.value.target,{type:e.value.type}),l=0,c=Object.entries(t.value);l<c.length;l++){var h=(0,g.Z)(c[l],2),f=h[0],d=h[1];if(d.sparklines)for(var v=0,p=Object.entries(d.sparklines);v<p.length;v++){var m=(0,g.Z)(p[v],2),y=m[0],_=m[1];if(null!=_&&_.position){var R=n8(_.position,t.sheet_id);if(a.sheetId===t.sheet_id&&G7(u,R)){if(i){delete r.value[f].sparklines[y];break}r.value[f].sparklines[y].position={row:e.value.target.row+_.position.row-e.value.source.row,col:e.value.target.col+_.position.col-e.value.source.col}}else if(o.sheetId===t.sheet_id&&G7(s,R)){delete r.value[f].sparklines[y];break}}var C=$7(null==_?void 0:_.source);if(C&&!i){var w=Object.assign({},C.toJSON(),{type:Ce.xj7.NORMAL});j7(u,w)&&(C.setRowFrom(e.value.target.row+w.row-e.value.source.row),C.setColFrom(e.value.target.col+w.col-e.value.source.col),C.setRowCount(w.rowCount),C.setColCount(w.colCount),r.value[f].sparklines[y].source=C.toString({ref:C}))}}}}))}return r}function U7(e,t,r,n){return R8({type:t,index:n?e.row:e.col,count:n?e.row_count:e.col_count},Q6(r.row,r.col))}function H7(e,t,r,n){return R8({type:t,index:n?e.row:e.col,count:n?e.row_count:e.col_count},e8({row:r.row,col:r.col,row_count:r.rowCount,col_count:r.colCount}))}function z7(e){return["addSparklineGroup","updateSparklineGroup","delSparklineGroup"].includes(e.action)}function W7(e,t){var r=Object.assign({},t.value.source,{type:t.value.type}),n=Object.assign({},t.value.target,{type:t.value.type});switch(e.action){case"sort":case"setSpans":var a=t8(e.target,e.sheet_id);return!G7(a,r)&&!G7(a,n)&&t;case"delSheet":var o=e.sheet_id===t.value.source.sheetId,i=e.sheet_id===t.value.target.sheetId;return o&&i?null:!o&&!i&&t;case"addRow":var u=t.value.source.row,s=u+t.value.source.rowCount-1,l=t.value.target.row,c=l+t.value.target.rowCount-1,h=e.target.row,f=e.sheet_id===t.value.source.sheetId,d=e.sheet_id===t.value.target.sheetId;if(f&&h>u&&h<s)return!1;if(d&&h>l&&h<c)return!1;var v=new A8(t);return f&&h<=u&&v.setOp((function(t){return t.value.source.row+=e.target.row_count})),d&&h<=l&&v.setOp((function(t){return t.value.target.row+=e.target.row_count})),v.getOp();case"addCol":var p=t.value.source.col,m=p+t.value.source.colCount-1,g=t.value.target.col,y=g+t.value.target.colCount-1,_=e.target.col,R=e.sheet_id===t.value.source.sheetId,C=e.sheet_id===t.value.target.sheetId;if(R&&_>p&&_<m)return!1;if(C&&_>g&&_<y)return!1;var w=new A8(t);return R&&_<=p&&w.setOp((function(t){return t.value.source.col+=e.target.col_count})),C&&_<=g&&w.setOp((function(t){return t.value.target.col+=e.target.col_count})),w.getOp();case"delRow":var E=t.value.source.row,k=t.value.target.row,T=Y6(e.target,e.sheet_id),S=e.target.row,A=e.sheet_id===t.value.source.sheetId,I=e.sheet_id===t.value.target.sheetId;if(G7(T,r))return!1;if(G7(T,n))return!1;var O=new A8(t);return A&&S<=E&&O.setOp((function(t){return t.value.source.row-=e.target.row_count})),I&&S<=k&&O.setOp((function(t){return t.value.target.row-=e.target.row_count})),O.getOp();case"delCol":var V=t.value.source.col,N=t.value.target.col,b=K6(e.target,e.sheet_id),M=e.target.col,F=e.sheet_id===t.value.source.sheetId,Z=e.sheet_id===t.value.target.sheetId;if(G7(b,r))return!1;if(G7(b,n))return!1;var x=new A8(t);return F&&M<=V&&x.setOp((function(t){return t.value.source.col-=e.target.col_count})),Z&&M<=N&&x.setOp((function(t){return t.value.target.col-=e.target.col_count})),x.getOp()}return t}function G7(e,t){return e.sheetId===t.sheetId&&l8(e,t)}function j7(e,t){return e.type===Ce.xj7.ALL||(e.type===Ce.xj7.ROW?e.row<=t.row&&e.row+e.rowCount>=t.row+t.rowCount:e.type===Ce.xj7.COL?e.col<=t.col&&e.col+e.colCount>=t.col+t.colCount:e.type===Ce.xj7.CELL?e.row===t.row&&e.rowCount===t.rowCount&&e.col===t.col&&e.colCount===t.colCount:e.type===Ce.xj7.NORMAL&&e.row<=t.row&&e.row+e.rowCount>=t.row+t.rowCount&&e.col<=t.col&&e.col+e.colCount>=t.col+t.colCount)}function Y7(e){return"moveRange"===e.action}var q7=function(e,t){if("delSheet"===e.action)return null;switch(e.action){case"addRow":return K7(t,"row","row_count",e.target.row,e.target.row_count);case"addCol":return K7(t,"col","col_count",e.target.col,e.target.col_count);case"delRow":return X7(t,"row","row_count",e.target.row,e.target.row_count);case"delCol":return X7(t,"col","col_count",e.target.col,e.target.col_count)}return t},J7=function(e,t){return"delSheet"===e.action?null:t},K7=function(e,t,r,n,a){var o=e.target[t],i=e.target[t]+e.target[r]-1,u=n-1;return u>=o&&u<i?I8(e,(function(e){e.target[r]+=a})):u<o?I8(e,(function(e){e.target[t]+=a})):e},X7=function(e,t,r,n,a){var o=e.target[t],i=e.target[t]+e.target[r]-1,u=n+a-1;return u<o?I8(e,(function(e){e.target[t]-=a})):n<=o&&u>=o&&u<i?I8(e,(function(e){e.target[t]=n,e.target[r]-=u-o+1})):n>o&&n<i&&u<i?I8(e,(function(e){e.target[r]-=a})):n<=o&&u>=i?null:n>o&&n<=i&&u>=i?I8(e,(function(e){e.target[r]=n-o})):e},Q7=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(t.action){case"setRangeProtection":case"delRangeProtection":return e.value.perm_id!==t.value.id?t:r||"unlockRow"===e.action||"unlockCol"===e.action?null:t}return t},e9=function(e){var t=e.type;return t===Ce.xj7.NORMAL?e8(e):t===Ce.xj7.ROW?j6(e):J6(e)},t9=function(e){var t=e.type;return t&&t!==Ce.xj7.NORMAL?t===Ce.xj7.ROW?Object.assign({},q6(e),{type:t}):Object.assign({},X6(e),{type:t}):Object.assign({},r8(e),{type:Ce.xj7.NORMAL})},r9=function(e,t){if("delRangeProtection"===t.action)return t;switch(e.action){case"addRow":var r=j6(e.target),n=t.value.ranges.map((function(e){if(e.type===Ce.xj7.COL)return e;var t=e9(e);return t9(N8(t,r))}));return I8(t,(function(e){e.value.ranges=n}));case"delRow":var a=j6(e.target),o=[];return t.value.ranges.forEach((function(e){if(e.type!==Ce.xj7.COL){var t=M8(e9(e),a);t&&o.push(t9(t))}else o.push(e)})),o.length<1?null:I8(t,(function(e){e.value.ranges=o}));case"addCol":var i=J6(e.target),u=t.value.ranges.map((function(e){if(e.type===Ce.xj7.ROW)return e;var t=e9(e);return t9(b8(t,i))}));return I8(t,(function(e){e.value.ranges=u}));case"delCol":var s=J6(e.target),l=[];return t.value.ranges.forEach((function(e){if(e.type!==Ce.xj7.ROW){var t=F8(e9(e),s);t&&l.push(t9(t))}else l.push(e)})),l.length<1?null:I8(t,(function(e){e.value.ranges=l}))}return t};function n9(e){return["setRangeProtection","delRangeProtection"].includes(e.action)}function a9(e,t){if(t.value.range){var r=J6(e.target),n=e8(t.value.range),a=b8(n,r);return n===a?t:I8(t,(function(e){e.value.range=r8(a),e.value.filter_value&&(e.value.filter_value.col=g8(e.value.filter_value.col,{index:r.col,count:r.colCount}))}))}return t}function o9(e,t){var r=new A8(t);if(t.value.range){var n=J6(e.target),a=e8(t.value.range),o=F8(a,n);null!==o&&o!==a&&r.setOp((function(e){e.value.range=r8(o)}))}if(t.value.filter_value){var i=t.value.filter_value.col;if(e.target.col<=i)if(e.target.col+e.target.col_count-1<i)r.setOp((function(t){t.value.filter_value.col=t.value.filter_value.col-e.target.col_count}));else{if(!t.value.range)return null;r.setOp((function(e){e.value.filter_value=null}))}}return r.getOp()}function i9(e,t){if((0,ue.default)(e.value)||(0,ue.default)(e.value.filteredRowsMap))return e;var r=e8(e.target),n=e8(t.target);if(l8(r,n)){var a=e.value,o=a.filteredRowsMap,i=a.col;return I8(e,(function(e){e.value.filteredRowsMap=o.map((function(e,a){if(i!==a+r.col||i<n.col||i>=n.col+n.colCount)return e;var o=[];return e.forEach((function(e){var a=t.value.findIndex((function(t){return t===e}));if(-1!==a){var i=a+n.row;r.row<i&&i<r.row+r.rowCount&&o.push(i)}else o.push(e)})),o}))}))}return e}function u9(e){if(e.value&&e.value.filteredRowsMap)for(var t=e.value.filteredRowsMap,r=0;r<e.target.col_count;r++)t[r]||(t[r]=[])}function s9(e,t){var r=j6(e.target);return("sort"!==t.action||!l8(r,e8(t.target)))&&t}function l9(e,t){return!l8(e8(e.target),a8(t.target))&&t}function c9(e,t,r,n,a){if(n&&a)for(var o=0;o<a.length;o++){var i=a[o].toJSON();i.colCount>0&&i.rowCount>0&&e.push({action:"setRange",sheet_id:t,value:{target:Object.assign({type:Ce.xj7.NORMAL},i),value:null}})}e.push({action:"setRange",sheet_id:t,value:{target:Object.assign({type:Ce.xj7.NORMAL},r),style:null}})}var h9=function(e){return function(t,r,n){var a=e[r.action];return a?a(t,r,n):r}}({moveRange:W7,setRange:Z7,updateRange:Z7,sort:function(e,t){var r=e8(t.target);return!l8(e8(e.target),r)&&t},setValue:l9,setFormula:l9,setStyle:l9,setCell:function(e,t){var r=a8(t.target);return l8(e8(e.target),r)?function(e,t){var r,n={row:t.target.row,col:t.target.col,row_count:1,col_count:1},a=yr(e.value);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(c8(o.target,n)){if(!function(e,t){return e.row===t.row&&e.col===t.col}(o.target,n))return null;var i=[];if(t.value.hasOwnProperty("style"))for(var u=t.value.style,s=o.target,l=s.row,c=s.col,h=s.row_count,f=s.col_count,d=l;d<l+h;d++)for(var v=c;v<c+f;v++)if(d!==l||v!==c){var p={action:"setCell",sheet_id:t.sheet_id,target:{row:d,col:v},value:{style:Object.assign({},u,{dropdown:null})}};t.hasOwnProperty("type")&&(p.type=t.type),t.hasOwnProperty("extra")&&(p.extra=t.extra),i.push(p)}if(i.length>0)return i.unshift(t),i}}}catch(e){a.e(e)}finally{a.f()}return t}(e,t):t},setSpans:function(e,t,r){var n=e8(e.target),a=e8(t.target);if(!l8(n,a))return t;var o=[],i=(new z8).createSheetFromId(e.sheet_id);if(r)for(var u=new ou(n.row,n.col,n.rowCount,n.colCount,i),s=new ou(a.row,a.col,a.rowCount,a.colCount,i).sub(u),l=0;l<s.length;l++){var c=s[l].toJSON();o.push({action:"setSpans",sheet_id:e.sheet_id,target:{row:c.row,col:c.col,row_count:c.rowCount,col_count:c.colCount},value:[]})}var h,f=yr(e.value);try{for(f.s();!(h=f.n()).done;){var d,v=h.value.target,p=yr(t.value);try{for(p.s();!(d=p.n()).done;){var m=d.value.target,g=e8(v),y=e8(m);if(l8(g,y)){var _=new ou(y.row,y.col,1,1,i),R=new ou(y.row,y.col,y.rowCount,y.colCount,i).sub(_);c9(o,t.sheet_id,g,!1),c9(o,t.sheet_id,y,r,R)}}}catch(e){p.e(e)}finally{p.f()}}}catch(e){f.e(e)}finally{f.f()}return r||o.push(t),o},setRangeValues:f7});function f9(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(0,Ce.It9)(t))return t;switch(t.action){case"addSheet":return(0,T.Z)(v9,(function(t){return f9(e,t,r)}),(function(e){return!1!==e&&(Array.isArray(e)?e.map((function(e){return(0,Ce._8D)(e)?p9(e):e})):(0,Ce._8D)(e)?p9(e):e)}))(t);case"setSheet":if(e.value.sheet_id===t.sheet_id||e.value.sheet_name===t.value.sheet_name)return!1;break;case"copySheet":case"addBlock":case"copySheetMutation":case"restoreBlock":if(!O8(e,t))return!1;if(e.value.sheet_id===t.value.sheet_id)return!1;if(e.sheet_id===t.value.sheet_id)return!1;if((0,Ce._8D)(t)&&null==t.value.snapshot&&(e.sheet_id===t.sheet_id||e.value.sheet_id===t.sheet_id))return!1;var n=new A8(t),a=(0,lr.addFollowAdd)(e.value.index,t.value.index,r);if(a!==t.value.index&&n.setOp((function(e){e.value.index=a,"copySheetMutation"===e.action&&(0,Ce.gwk)(e,(function(e){e.index=a}))})),e.value.sheet_name===t.value.sheet_name){if(r){var o=d9(t);return n.setOp((function(e){e.value.sheet_name=o,"copySheet"===e.action&&null!=e.value.snapshot&&(e.value.snapshot.name=o),"copySheetMutation"===e.action&&(0,Ce.gwk)(e,(function(e){e.name=o}))})),n.getOp()}return[{action:"setSheet",sheet_id:e.value.sheet_id,value:{origin_name:e.value.sheet_name,sheet_name:d9(e)}},n.getOp()]}return n.getOp();case"moveSheet":var i=(0,lr.addFollowMove)(e.value.index,t.value.source,t.value.target,r);if(null!=i&&(t.value.source!==i.source||t.value.target!==i.target))return I8(t,(function(e){e.value.source=i.source,e.value.target=i.target}));break;case"delSheet":case"delBlock":if(e.value.sheet_id===t.sheet_id)return!1;var u=(0,lr.addFollowDelete)(e.value.index,t.value.index,r);if(u!==t.value.index)return I8(t,(function(e){e.value.index=u}));break;case"softDelSheet":case"restoreSheet":case"lockSheet":case"unlockSheet":break;default:V8(t)}return t}function d9(e){return"".concat(e.value.sheet_name,"_conflict_").concat(e.value.sheet_id)}function v9(e){return{action:"copySheet",sheet_id:e.sheet_id,value:{sheet_id:e.sheet_id,sheet_name:e.sheet_name,index:e.value.index}}}function p9(e){return{action:"addSheet",sheet_id:e.sheet_id,sheet_name:e.value.sheet_name,value:{index:e.value.index}}}function m9(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(t.action){case"addBlock":case"restoreBlock":if(e.value.block_id===t.value.block_id)return!1}return f9(e,t,r)}var g9=new Set(["addView","delView","setFilterView","setView"]);function y9(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(Y7(t))return W7(e,t,r);if(r&&((0,Ce.i55)(t)||"setRangeValues"===t.action)&&t.sheet_id===e.sheet_id)return null;if("setDataRange"===t.action)return q7(e,t);if("delDataRange"===t.action)return J7(e,t);if(!(0,Ce.It9)(t))return e.sheet_id===t.sheet_id?!!g9.has(t.action)&&null:t;switch(t.action){case"addSheet":case"copySheet":case"copySheetMutation":case"addBlock":case"restoreBlock":if(e.sheet_id===t.sheet_id)return!1;var n=(0,lr.deleteFollowAdd)(e.value.index,t.value.index,r);if(n!==t.value.index)return I8(t,(function(e){return e.value.index=n}));break;case"moveSheet":if(e.sheet_id===t.sheet_id)return null;var a=(0,lr.deleteFollowMove)(e.value.index,t.value.source,t.value.target,r);if(null==a)return null;if(t.value.source!==a.source||t.value.target!==a.target)return I8(t,(function(e){e.value.source=a.source,e.value.target=a.target}));break;case"delSheet":case"delBlock":case"setSheet":if(e.sheet_id===t.sheet_id)return null}return e.sheet_id!==t.sheet_id&&t}function _9(e,t,r,n){if(!l8(e,t))return n;var a=function(e,t){var r=t.value.indexOf(e);return-1===r?e:t.target.row+r}(n.target.row,r);return a!==n.target.row?I8(n,(function(e){e.target.row=a})):n}var R9=function(e,t){var r=(0,g.Z)(e,2),n=r[0],a=r[1],o=(0,g.Z)(t,2),i=o[0];return n<=o[1]&&a>=i},C9=function(e,t){return R9([e.row,e.row+e.row_count],[t.row,t.row+t.row_count])&&R9([e.col,e.col+e.col_count],[t.col,t.col+t.col_count])};function w9(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e.value.view_id!==t.value.view_id)return t;var n=e.value.range,a=t.value.range;if(n&&a&&C9(n,a)){var o=Math.min(n.row,a.row),i=Math.max(n.row+n.row_count,a.row+a.row_count),u=Math.min(n.col,a.col),s=Math.max(n.col+n.col_count,a.col+a.col_count);t=I8(t,(function(e){e.value.range={row:o,row_count:i-o,col:u,col_count:s-u}}))}var l=e.value.filter_value,c=t.value.filter_value;return l&&c?E9(e,t,r):t}function E9(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.value.filter_value,a=t.value.filter_value;if(n.col!==a.col)return t;var o=null===n.type&&!n.contents,i=null===a.type&&!a.contents;return o&&!i?null:!o&&i||r?t:null}function k9(e,t){return e+"_conflict_"+t}function T9(e){return e.value.name=e.value.name+"_conflict_"+e.value.view_id,e}var S9={sort:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!("target"in t))return Y7(t)?W7(e,t,r):(0,Ce.i55)(t)?Z7(e,t,r):("setFilterView"!==t.action||!t.value.range||!l8(e8(e.target),e8(t.value.range)))&&t;var n=e8(e.target);switch(t.action){case"sort":case"setSpans":if(l8(n,e8(t.target)))return!1;break;case"setEmbeddedBlock":case"delEmbeddedBlock":if(l8(n,e8(Object.assign({},t.target,{row_count:1,col_count:1}))))return!1;break;case"delRow":case"hideRow":if(l8(n,j6(t.target)))return!1;break;case"addRow":case"addCol":case"delCol":case"setRowHeight":case"setColumnWidth":case"freezeSheet":case"hideCol":case"unhideCol":case"unhideRow":case"lockCol":case"unlockCol":case"lockRow":case"unlockRow":case"setChart":case"setFloatImage":case"setColProperty":case"setDataRange":case"setRowProperty":case"addOutline":case"delOutline":case"updateOutline":return t;case"setFilter":return i9(t,e);case"setValue":case"setStyle":case"setFormula":case"setCell":case"addComments":return _9(n,a8(t.target),e,t);case"setRangeValues":return f7(e,t,r);default:V8(t)}return t},setSpans:h9,addRow:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!("target"in t)){if(x8(t))return Z8(e,t);if(B8(t))return L8(e,t);if(Y7(t))return W7(e,t,r);if((0,Ce.i55)(t))return Z7(e,t,r);if("setFilterView"===t.action&&t.value.range){var n=e8(t.value.range),a=N8(n,j6(e.target));return n===a?t:I8(t,(function(e){e.value.range=r8(a)}))}return n9(t)?r9(e,t):t}if(H8(t))return U8(e,t);if(z7(t))return B7(e,t);var o=j6(e.target);switch(t.action){case"setRangeValues":return f7(e,t,r);case"setSpans":var i=e8(t.target),u=N8(i,o);return i===u?t:I8(t,(function(e){e.target=r8(u),e.value=e.value.map((function(e){var t=e8(e.target),r=N8(t,o);return r!==t&&(e.target=r8(r)),e}))}));case"setDataRange":return q7(e,t);case"sort":var s=e8(t.target),l=N8(s,o);return s===l?t:I8(t,(function(t){t.target=r8(l);for(var r=0;r<t.value.length;r++)t.value[r]>=e.target.row&&(t.value[r]+=o.rowCount);var n=o.row-s.row;if(n>0){var a,i=(0,S.Z)(o.row,o.row+o.rowCount);(a=t.value).splice.apply(a,[n,0].concat((0,m.Z)(i)))}}));case"addCol":case"delCol":case"setColumnWidth":case"setColProperty":case"hideCol":case"unhideCol":case"lockCol":case"unlockCol":break;case"freezeSheet":var c=p8(t.target.row,{index:o.row,count:o.rowCount});if(c!==t.target.row)return I8(t,(function(e){e.target.row=c}));break;case"setValue":case"setStyle":case"setFormula":case"setCell":case"setFloatImage":case"addComments":var h=a8(t.target),f=N8(h,o);return h===f?t:I8(t,(function(e){e.target=o8(f)}));case"lockRow":case"unlockRow":var d=j6(t.target),v=N8(d,o);return d===v?t:I8(t,(function(e){e.target=q6(v)}));case"addRow":if(t.target.row>o.row||!r&&t.target.row===o.row)return I8(t,(function(e){e.target.row+=o.rowCount}));break;case"delRow":case"hideRow":case"unhideRow":case"setRowProperty":case"setRowHeight":var p=j6(t.target),g=N8(p,o,"Split");return p===g?t:Array.isArray(g)?g.map((function(e){return I8(t,(function(t){return t.target=q6(e)}))})):I8(t,(function(e){return e.target=q6(g)}));case"setFilter":var y=e8(t.target),_=N8(y,o);return y===_?t:I8(t,(function(t){t.target=r8(_),null!=t.value&&null!=t.value.filteredRowsMap&&(t.value.filteredRowsMap=t.value.filteredRowsMap.map((function(t){return t.map((function(t){return t>=o.row?t+e.target.row_count:t}))})))}));case"setChart":var R=new A8(t);if(e.sheet_id===t.sheet_id){var C=a8(t.target),w=N8(C,o);w!==C&&R.setOp((function(e){e.target=o8(w)}))}return R.setOp((function(t){T8({type:0,index:e.target.row,count:e.target.row_count},e.sheet_id,t.value.graphSetting)})),R.getOp();case"addOutline":case"delOutline":case"updateOutline":return t;default:return V8(t),!1}return t},delRow:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!("target"in t)){if(x8(t))return Z8(e,t);if(B8(t))return L8(e,t);if(Y7(t))return W7(e,t,r);if((0,Ce.i55)(t))return Z7(e,t,r);if("setFilterView"===t.action&&t.value.range){var n=j6(e.target),a=e8(t.value.range);if(n.row<=a.row&&a.row<n.row+n.rowCount)return null;var o=M8(a,n);return null==o?null:o===a?t:I8(t,(function(e){e.value.range=r8(o),e.value}))}return n9(t)?r9(e,t):t}if(H8(t))return U8(e,t);if(z7(t))return B7(e,t);var i=j6(e.target);switch(t.action){case"setRangeValues":return f7(e,t,r);case"setSpans":var u=e8(t.target),s=M8(u,i);if(s===u)return t;if(null==s)return null;var l=ga(t);l.target=r8(s);for(var c=[],h=[],f=0;f<t.value.length;f++){var d=e8(t.value[f].target),v=M8(d,i);v!==d?null!=v&&((v.rowCount>1||v.colCount>1)&&c.push(Object.assign({},t.value[f],{target:r8(v)})),r&&d.row>=e.target.row&&d.row<=e.target.row+e.target.row_count-1&&h.push({action:"setCell",sheet_id:t.sheet_id,target:{row:v.row,col:v.col},value:{value:null,style:null,formula:null}})):c.push(t.value[f])}return l.value=c,r?c.length>0&&h.length>0?[l].concat(h):c.length>0?l:h.length>0?h:null:l;case"setDataRange":return q7(e,t);case"sort":var p=e8(t.target);if(l8(i,p))return!1;var m=M8(p,i);if(null==m)return null;if(m!==p)return I8(t,(function(e){e.target=r8(m),e.value.length>0&&(e.value=e.value.map((function(e){return e-i.rowCount})))}));break;case"addRow":var g=m8(t.target.row,{index:i.row,count:i.rowCount});if(g!==t.target.row)return I8(t,(function(e){return e.target.row=g}));break;case"delRow":case"hideRow":case"unhideRow":case"lockRow":case"unlockRow":case"setRowProperty":case"setRowHeight":var y=j6(t.target),_=M8(y,i);if(null==_)return null;if(_!==y)return I8(t,(function(e){e.target=q6(_)}));break;case"setValue":case"setStyle":case"setFormula":case"setCell":case"setFloatImage":case"addComments":var R=a8(t.target),C=M8(R,i);if(null==C)return null;if(C!==R)return I8(t,(function(e){return e.target=o8(C)}));break;case"freezeSheet":var w=m8(t.target.row,{index:i.row,count:i.rowCount});if(w!==t.target.row)return I8(t,(function(e){return e.target.row=w}));break;case"addCol":case"delCol":case"setColumnWidth":case"setColProperty":case"hideCol":case"unhideCol":case"lockCol":case"unlockCol":break;case"setFilter":var E=e8(t.target);if(i.row<=E.row&&E.row<i.row+i.rowCount)return null;var k=M8(E,i);return null==k?null:k===E?t:I8(t,(function(e){if(e.target=r8(k),null!=e.value&&null!=e.value.filteredRowsMap){var t=e.value.filteredRowsMap;e.value.filteredRowsMap=t.map((function(e){for(var t=[],r=0;r<e.length;r++){var n=e[r],a=M8({type:Ce.xj7.ROW,row:n,rowCount:1},i);null!=a&&t.push(a.row)}return t}))}}));case"setChart":var T=new A8(t);if(e.sheet_id===t.sheet_id){var S=y8(t.target.row,{index:e.target.row,count:e.target.row_count});S!==t.target.row&&T.setOp((function(e){e.target.row=S}))}return T.setOp((function(t){var r=t.value.graphSetting;T8({type:2,index:e.target.row,count:e.target.row_count},e.sheet_id,r)})),T.getOp();case"addOutline":case"delOutline":case"updateOutline":return t;default:return V8(t),!1}return t},addCol:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!("target"in t))return x8(t)?Z8(e,t):B8(t)?L8(e,t):Y7(t)?W7(e,t,r):(0,Ce.i55)(t)?Z7(e,t,r):"setFilterView"===t.action?a9(e,t):n9(t)?r9(e,t):t;if(H8(t))return U8(e,t);if(z7(t))return B7(e,t);var n=J6(e.target);switch(t.action){case"setSpans":var a=e8(t.target),o=b8(a,n);return a===o?t:I8(t,(function(e){e.target=r8(o),e.value=e.value.map((function(e){var t=e8(e.target),r=b8(t,n);return r!==t&&(e.target=r8(r)),e}))}));case"setDataRange":return q7(e,t);case"sort":var i=e8(t.target),u=b8(i,n);return i===u?t:I8(t,(function(e){e.target=r8(u)}));case"setValue":case"setStyle":case"setFormula":case"setCell":case"setFloatImage":case"addComments":var s=a8(t.target),l=b8(s,n);return s===l?t:I8(t,(function(e){e.target=o8(l)}));case"setRangeValues":return f7(e,t,r);case"freezeSheet":var c=p8(t.target.col,{index:n.col,count:n.colCount});if(c!==t.target.col)return I8(t,(function(e){e.target.col=c}));break;case"addCol":if(t.target.col>n.col||!r&&t.target.col===n.col)return I8(t,(function(e){e.target.col+=n.colCount}));break;case"delCol":case"hideCol":case"unhideCol":case"setColProperty":case"setColumnWidth":var h=J6(t.target),f=b8(h,n,"Split");return h===f?t:Array.isArray(f)?f.map((function(e){return I8(t,(function(t){return t.target=X6(e)}))})):I8(t,(function(e){return e.target=X6(f)}));case"lockCol":case"unlockCol":var d=J6(t.target),v=b8(d,n);return d===v?t:I8(t,(function(e){e.target=X6(v)}));case"addRow":case"delRow":case"setRowHeight":case"setRowProperty":case"hideRow":case"unhideRow":case"lockRow":case"unlockRow":break;case"setFilter":if(n.col>t.target.col&&n.col<t.target.col+t.target.col_count){var p=new A8(t);if(p.setOp((function(t){return t.target.col_count+=e.target.col_count})),null!=t.value&&(p.setOp((function(t){t.value.col>=e.target.col&&(t.value.col+=e.target.col_count)})),!(0,ue.default)(t.value.filteredRowsMap))){var m=e.target.col-t.target.col,g=t.value.col-t.target.col;if(m<=g){for(var y=[],_=0;_<e.target.col_count;++_)y.push([]);p.setOp((function(e){var t;(t=e.value.filteredRowsMap).splice.apply(t,[m,0].concat(y))}))}}return p.getOp()}var R=e8(t.target),C=b8(R,n);return R===C?t:I8(t,(function(e){e.target=r8(C),e.value&&(e.value.col=g8(e.value.col,{index:n.col,count:n.colCount}))}));case"setChart":var w=new A8(t);if(e.sheet_id===t.sheet_id){var E=a8(t.target),k=b8(E,n);k!==E&&w.setOp((function(e){e.target=o8(k)}))}return w.setOp((function(t){T8({type:1,index:e.target.col,count:e.target.col_count},e.sheet_id,t.value.graphSetting)})),w.getOp();case"addOutline":case"delOutline":case"updateOutline":return t;default:return V8(t),!1}return t},delCol:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!("target"in t))return x8(t)?Z8(e,t):B8(t)?L8(e,t):Y7(t)?W7(e,t,r):(0,Ce.i55)(t)?Z7(e,t,r):"setFilterView"===t.action?o9(e,t):n9(t)?r9(e,t):t;if(H8(t))return U8(e,t);if(z7(t))return B7(e,t);var n=J6(e.target);switch(t.action){case"setRangeValues":return f7(e,t,r);case"setSpans":var a=e8(t.target),o=F8(a,n);if(o===a)return t;if(null==o)return null;var i=ga(t);i.target=r8(o);for(var u=[],s=[],l=0;l<t.value.length;l++){var c=e8(t.value[l].target),h=F8(c,n);h!==c?null!=h&&((h.rowCount>1||h.colCount>1)&&u.push(Object.assign({},t.value[l],{target:r8(h)})),r&&c.col>=n.col&&c.col<n.col+n.colCount&&s.push({action:"setCell",sheet_id:t.sheet_id,target:{row:h.row,col:h.col},value:{value:null,style:null,formula:null}})):u.push(t.value[l])}return i.value=u,r?u.length>0&&s.length>0?[i].concat(s):u.length>0?i:s.length>0?s:null:i;case"setDataRange":return q7(e,t);case"sort":var f=e8(t.target),d=F8(f,n);if(null==d)return null;if(d!==f)return I8(t,(function(e){e.target=r8(d)}));break;case"addCol":var v=m8(t.target.col,{index:n.col,count:n.colCount});if(v!==t.target.col)return I8(t,(function(e){return e.target.col=v}));break;case"delCol":case"hideCol":case"unhideCol":case"lockCol":case"unlockCol":case"setColProperty":case"setColumnWidth":var p=J6(t.target),m=F8(p,n);if(null==m)return null;if(m!==p)return I8(t,(function(e){e.target=X6(m)}));break;case"setFormula":case"setValue":case"setStyle":case"setCell":case"setFloatImage":case"addComments":var g=a8(t.target),y=F8(g,n);if(null==y)return null;if(y!==g)return I8(t,(function(e){e.target=o8(y)}));break;case"addRow":case"delRow":case"setRowHeight":case"setRowProperty":case"hideRow":case"unhideRow":case"lockRow":case"unlockRow":break;case"setFilter":var _=e8(t.target),R=F8(_,n);if(null==R)return null;var C=new A8(t);if(R!==_&&C.setOp((function(e){e.target=r8(R)})),null==t.value)return C.getOp();var w=F8({type:Ce.xj7.COL,col:t.value.col,colCount:1},n);if(null==w)return null;if(w.col!==t.value.col&&C.setOp((function(e){e.value&&(e.value.col=w.col)})),t.value.filteredRowsMap&&n.col>=_.col){var E=n.col-_.col,k=n.colCount;C.setOp((function(e){e.value&&e.value.filteredRowsMap&&e.value.filteredRowsMap.splice(E,k)}))}return C.getOp();case"freezeSheet":var T=m8(t.target.col,{index:n.col,count:n.colCount});if(T!==t.target.col)return I8(t,(function(e){e.target.col=T}));break;case"setChart":var S=new A8(t);if(e.sheet_id===t.sheet_id){var A=y8(t.target.col,{index:n.col,count:n.colCount});A!==t.target.col&&S.setOp((function(e){e.target.col=A}))}return S.setOp((function(t){var r=t.value.graphSetting;T8({type:3,index:n.col,count:n.colCount},e.sheet_id,r)})),S.getOp();case"addOutline":case"delOutline":case"updateOutline":return t;default:return V8(t),!1}return t},hideRow:s9,unhideRow:s9,addSheet:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return(0,T.Z)(v9,(function(e){return f9(e,t,r)}))(e)},setSheet:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(0,Ce.It9)(t))return t;switch(t.action){case"addSheet":if(e.sheet_id===t.sheet_id||e.value.sheet_name===t.sheet_name)return!1;break;case"copySheet":case"copySheetMutation":case"addBlock":case"restoreBlock":if(e.sheet_id===t.value.sheet_id||e.value.sheet_name===t.value.sheet_name)return!1;break;case"delSheet":case"delBlock":case"moveSheet":e.sheet_id===t.sheet_id&&(t.value.sheet_name=e.value.sheet_name);break;case"setSheet":if(e.sheet_id!==t.sheet_id&&e.value.sheet_name===t.value.sheet_name)return!1;if(e.sheet_id===t.sheet_id){var n=e.value.property_name||"name",a=t.value.property_name||"name";if(r&&n===a)return null;var o=new A8(t);return"name"===n&&(o.setOp((function(t){t.value.origin_name=e.value.sheet_name})),"name"!==a&&o.setOp((function(t){t.value.sheet_name=e.value.sheet_name}))),o.getOp()}break;case"softDelSheet":case"restoreSheet":case"lockSheet":case"unlockSheet":break;default:V8(t)}return t},copySheet:f9,copySheetMutation:f9,delSheet:y9,moveSheet:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!(0,Ce.It9)(t))return t;switch(t.action){case"addSheet":case"copySheetMutation":case"copySheet":case"addBlock":case"restoreBlock":var n=(0,lr.moveFollowAdd)(e.value.source,e.value.target,t.value.index,r);if(n!==t.value.index)return I8(t,(function(e){return e.value.index=n}));break;case"delSheet":case"delBlock":var a=(0,lr.moveFollowDelete)(e.value.source,e.value.target,t.value.index,r);if(a!==t.value.index)return I8(t,(function(e){return e.value.index=a}));break;case"setSheet":case"lockSheet":case"unlockSheet":case"restoreSheet":case"softDelSheet":break;case"moveSheet":var o=(0,lr.moveFollowMove)(e.value.source,e.value.target,t.value.source,t.value.target,r);if(null==o)return null;if(t.value.source!==o.source||t.value.target!==o.target)return I8(t,(function(e){e.value.source=o.source,e.value.target=o.target}));break;default:V8(t)}return t},coverSheet:function(e,t){switch(t.action){case"copySheetMutation":case"copySheet":case"moveSheet":return t}return e.sheet_id!==t.sheet_id&&t},softDelSheet:function(e,t){switch(t.action){case"restoreSheet":case"softDelSheet":if(e.sheet_id===t.sheet_id)return!1}return t},restoreSheet:function(e,t){switch(t.action){case"restoreSheet":case"softDelSheet":if(e.sheet_id===t.sheet_id)return!1}return t},setFilter:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!("target"in t))return t;var n=e8(e.target);switch(t.action){case"setValue":case"setFormula":case"setStyle":case"setCell":case"addComments":case"setColumnWidth":case"setRowHeight":case"hideRow":case"unhideRow":case"hideCol":case"unhideCol":case"addCol":case"delCol":case"addRow":case"delRow":case"freezeSheet":case"lockCol":case"unlockCol":case"lockRow":case"unlockRow":case"setChart":case"setFloatImage":case"setColProperty":case"setDataRange":case"setRowProperty":case"setEmbeddedBlock":case"delEmbeddedBlock":case"addOutline":case"delOutline":case"updateOutline":break;case"setSpans":return t;case"sort":if((0,ue.default)(e.value)||(0,ue.default)(e.value.filteredRowsMap))break;if(l8(n,e8(t.target)))return[t,i9(e,t)];break;case"setFilter":var a=e8(t.target);if(!l8(n,a))return r?null:[{action:"delFilter",sheet_id:e.sheet_id},t];var o=new A8(t);if(s8(f8(n),f8(a))||o.setOp((function(t){var r=Math.min(e.target.col,t.target.col),n=Math.max(e.target.col+e.target.col_count-1,t.target.col+t.target.col_count-1);t.target.col=r,t.target.col_count=n-r+1,t.target.row_count=Math.max(e.target.row_count,t.target.row_count),u9(t)})),!e.value||!t.value)return o.getOp();if(e.value.col===t.value.col)return r?null:o.getOp();var i=e.value.col-e.target.col,u=e.value.col-t.target.col;return i>=0&&u>=0&&u<t.target.col_count&&i<e.target.col_count&&e.value.filteredRowsMap&&t.value.filteredRowsMap&&e.value.filteredRowsMap[i]?o.setOp((function(t){t.value.filteredRowsMap[u]=Array.from(e.value.filteredRowsMap[i])})):o.getOp();case"setRangeValues":return f7(e,t,r);default:V8(t)}return t},delFilter:function(e,t){switch(t.action){case"delFilter":case"setFilter":return null}return t},delChart:function(e,t){switch(t.action){case"setChart":case"delChart":if(e.sheet_id===t.sheet_id&&e.value.chartId===t.value.chartId)return null}return t},setFloatImage:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"setFloatImage"===t.action&&e.value.floatImageId===t.value.floatImageId&&e.value.floatImageSetting.imageToken===t.value.floatImageSetting.imageToken&&r?null:t},delFloatImage:function(e,t){switch(t.action){case"setFloatImage":case"delFloatImage":if(e.value.floatImageId===t.value.floatImageId)return null}return t},setFloatBlock:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"setFloatBlock"===t.action&&e.value.blockToken===t.value.blockToken&&e.value.blockType===t.value.blockType&&r?null:t},delFloatBlock:function(e,t){switch(t.action){case"setFloatBlock":case"delFloatBlock":if(e.value.blockToken===t.value.blockToken&&e.value.blockType===t.value.blockType)return null}return t},setEmbeddedBlock:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"setEmbeddedBlock"===t.action?e.value.blockToken===t.value.blockToken&&e.value.blockType===t.value.blockType?r?null:t:e.target.row===t.target.row&&e.target.col===t.target.col?null:t:t},delEmbeddedBlock:function(e,t){switch(t.action){case"setEmbeddedBlock":case"delEmbeddedBlock":if(e.value.blockToken===t.value.blockToken&&e.value.blockType===t.value.blockType)return null}return t},updateSparklineGroup:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=ga(t);return"updateSparklineGroup"===t.action&&(n=I8(n,(function(n){for(var a=0,o=Object.keys(t.value);a<o.length;a++){var i=o[a];if(Object.prototype.hasOwnProperty.call(e.value,i)){if(e.value[i].config&&t.value[i].config&&r){var u=(0,I.Z)(Object.keys(e.value[i].config||{}),Object.keys(t.value[i].config||{}));n.value[i].config=(0,A.default)(n.value[i].config,u)}if(t.value[i].sparklines)for(var s=0,l=Object.keys(t.value[i].sparklines);s<l.length;s++){var c,h,f,d=l[s];if(null===(null===(c=e.value[i].sparklines)||void 0===c?void 0:c[d]))delete n.value[i].sparklines[d];else if(null!==(h=e.value[i].sparklines)&&void 0!==h&&h[d]&&null!==(f=t.value[i].sparklines)&&void 0!==f&&f[d]&&r){var v,p=(0,I.Z)(Object.keys((null===(v=e.value[i].sparklines)||void 0===v?void 0:v[d])||{}),Object.keys(t.value[i].sparklines[d]||{}));n.value[i].sparklines[d]=(0,A.default)(n.value[i].sparklines[d],p)}}}}}))),n},delSparklineGroup:function(e,t){var r=ga(t);switch(t.action){case"addSparklineGroup":case"updateSparklineGroup":var n=function(e){t.value[e]&&(r=I8(r,(function(t){delete t.value[e]})))};for(var a in e.value)n(a);if(0===Object.keys(r.value).length)return null}return r},setDataRange:function(e,t){return t},delDataRange:function(e,t){return t},freezeSheet:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(t.action){case"setChart":if(e.sheet_id===t.sheet_id){var n=Math.max(e.target.row,t.target.row),a=Math.max(e.target.col,t.target.col);if(n!==t.target.row||a!==t.target.col)return I8(t,(function(e){e.target.row=n,e.target.col=a}))}break;case"setFloatBlock":if(e.sheet_id===t.sheet_id){var o=Math.max(e.target.row,t.value.row),i=Math.max(e.target.col,t.value.col);if(o!==t.value.row||i!==t.value.col)return I8(t,(function(e){e.value.row=o,e.value.col=i}))}break;case"freezeSheet":if(!r)return t;if(e.sheet_id!==t.sheet_id)return t;var u=e.target,s=t.target,l=u.row>=0?u.row:s.row,c=u.col>=0?u.col:s.col;if(l!==s.row||c!==s.col)return I8(t,(function(e){e.target.row=l,e.target.col=c}))}return t},addConditionalFormat:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(t.action){case"addConditionalFormat":if(e.value.cfId===t.value.cfId)return!1;var n=(0,lr.addFollowAdd)(e.value.index,t.value.index,r);if(n!==t.value.index)return I8(t,(function(e){return e.value.index=n}));break;case"delConditionalFormat":if(e.value.cfId===t.value.cfId)return!1;var a=(0,lr.addFollowDelete)(e.value.index,t.value.index,r);if(a!==t.value.index)return I8(t,(function(e){return e.value.index=a}));break;case"moveConditionalFormat":var o=(0,lr.addFollowMove)(e.value.index,t.value.source,t.value.target,r);if(null!=o&&(t.value.source!==o.source||t.value.target!==o.target))return I8(t,(function(e){e.value.source=o.source,e.value.target=o.target}))}return t},delConditionalFormat:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(t.action){case"addConditionalFormat":if(e.value.cfId===t.value.cfId)return!1;var n=(0,lr.deleteFollowAdd)(e.value.index,t.value.index,r);if(n!==t.value.index)return I8(t,(function(e){e.value.index=n}));break;case"delConditionalFormat":if(e.value.cfId===t.value.cfId)return null;var a=(0,lr.deleteFollowDelete)(e.value.index,t.value.index,r);if(null==a)return null;if(a!==t.value.index)return I8(t,(function(e){e.value.index=a}));break;case"setConditionalFormat":if(e.value.cfId===t.value.cfId)return null;break;case"moveConditionalFormat":if(e.value.index===t.value.source)return null;var o=(0,lr.deleteFollowMove)(e.value.index,t.value.source,t.value.target,r);if(null==o)return null;if(t.value.source!==o.source||t.value.target!==o.target)return I8(t,(function(e){e.value.source=o.source,e.value.target=o.target}))}return t},moveConditionalFormat:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(t.action){case"addConditionalFormat":if(e.value.target===t.value.index)return!1;var n=(0,lr.moveFollowAdd)(e.value.target,e.value.target,t.value.index,r);if(n!==t.value.index)return I8(t,(function(e){return e.value.index=n}));break;case"moveConditionalFormat":var a=(0,lr.moveFollowMove)(e.value.source,e.value.target,t.value.source,t.value.target,r);if(null==a)return null;if(t.value.source!==a.source||t.value.target!==a.target)return I8(t,(function(e){e.value.source=a.source,e.value.target=a.target}));break;case"delConditionalFormat":var o=(0,lr.moveFollowDelete)(e.value.source,e.value.target,t.value.index,r);if(o!==t.value.index)return I8(t,(function(e){return e.value.index=o}))}return t},moveRange:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(t.sheet_id!==e.value.source.sheetId&&t.sheet_id!==e.value.target.sheetId)return t;if(z7(t))return B7(e,t);var n=Object.assign({},e.value.source,{type:e.value.type}),a=Object.assign({},e.value.target,{type:e.value.type}),o=e.value.type;switch(t.action){case"setCell":case"setValue":case"setStyle":case"setFormula":var i=n8(t.target,t.sheet_id);return G7(n,i)?I8(t,(function(t){t.sheet_id=a.sheetId,t.target={row:e.value.target.row+t.target.row-e.value.source.row,col:e.value.target.col+t.target.col-e.value.source.col}})):G7(a,i)?null:t;case"setRangeValues":return f7(e,t,r);case"unhideCol":case"hideCol":case"setColumnWidth":case"setColProperty":if(o!==Ce.xj7.COL)return t;var u=K6(t.target,t.sheet_id),s=h8(n,u);if(n.sheetId===u.sheetId&&s){var l=s.colEnd-s.col+1,c=[],h=I8(t,(function(t){t.sheet_id=a.sheetId,t.target={col:s.col+e.value.target.col-e.value.source.col,col_count:l}}));if(t.target.col_count<=l)return h;if(c.push(h),e.value.source.col-t.target.col>0){var f=I8(t,(function(e){e.sheet_id=a.sheetId,e.target={col:e.target.col,col_count:s.col-e.target.col}}));c.push(f)}if(t.target.col+t.target.col_count-(e.value.source.col+e.value.source.colCount)>0){var d=t.target.col_count-(s.colEnd-t.target.col)-1;if(d>0){var v=I8(t,(function(e){e.sheet_id=a.sheetId,e.target={col:s.col+l,col_count:d}}));c.push(v)}}return c}return G7(a,u)?null:t;case"unhideRow":case"hideRow":case"setRowHeight":case"setRowProperty":if(o!==Ce.xj7.ROW)return t;var p=Y6(t.target,t.sheet_id),m=h8(n,p);if(n.sheetId===p.sheetId&&m){var g=m.rowEnd-m.row+1,y=[],_=I8(t,(function(t){t.sheet_id=a.sheetId,t.target={row:m.row+e.value.target.row-e.value.source.row,row_count:g}}));if(t.target.row_count<=g)return _;if(y.push(_),e.value.source.row-t.target.row>0){var R=I8(t,(function(e){e.sheet_id=a.sheetId,e.target={row:e.target.row,row_count:m.row-e.target.row}}));y.push(R)}if(t.target.row+t.target.row_count-(e.value.source.row+e.value.source.rowCount)>0){var C=t.target.row_count-(m.rowEnd-t.target.row)-1;if(C>0){var w=I8(t,(function(e){e.sheet_id=a.sheetId,e.target={row:m.row+g,row_count:C}}));y.push(w)}}return y}return G7(a,p)?null:t;case"delRow":var E=Y6(t.target,t.sheet_id);return!G7(n,E)&&!G7(a,E)&&t;case"delCol":var k=K6(t.target,t.sheet_id);return!G7(n,k)&&!G7(a,k)&&t;case"sort":case"setSpans":var T=t8(t.target,t.sheet_id);return!G7(n,T)&&!G7(a,T)&&t;case"moveRange":var S=Object.assign({},t.value.source,{type:t.value.type}),A=Object.assign({},t.value.target,{type:t.value.type});return!G7(n,S)&&!G7(n,A)&&!G7(a,S)&&!G7(a,A)&&t;case"delSheet":if(!r)return t;var I=t.sheet_id===e.value.source.sheetId,O=t.sheet_id===e.value.target.sheetId;return(I&&O||!I&&!O)&&t;case"setRange":case"updateRange":return Z7(e,t,r)}return t},addBlock:m9,delBlock:y9,restoreBlock:m9,recover:function(e,t){return!1},setRange:F7,setRangeValues:v7,updateRange:F7,updateReference:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(t.action){case"setCell":case"setRange":case"updateRange":var n=t.value.dataValidation;if(n&&"dataValidation"===e.value.type&&d_.isSameDataValidationJSON(e.value.oldRef,n))return I8(t,(function(t){return t.value.dataValidation=ga(e.value.newRef)}));break;case"setRangeValues":if(t.value.dataValidation&&"dataValidation"===e.value.type)for(var a=function(r){if(d_.isSameDataValidationJSON(e.value.oldRef,t.value.dataValidation[r]))return{v:I8(t,(function(t){t.value.dataValidation[r]=ga(e.value.newRef)}))}},o=0;o<t.value.dataValidation.length;o++){var i=a(o);if("object"===(0,R.Z)(i))return i.v}break;case"updateReference":if(r&&"dataValidation"===e.value.type){var u=e.value.oldRef,s=e.value.newRef,l=t.value.oldRef,c=t.value.newRef;if(d_.isSameDataValidationJSON(u,l)&&!d_.isSameDataValidationJSON(s,c))return!1;if(d_.isSameDataValidationJSON(u,c))return d_.isSameDataValidationJSON(s,l)?null:I8(t,(function(t){return t.value.newRef=ga(e.value.newRef)}));if(d_.isSameDataValidationJSON(s,l))return!1;if(d_.isSameDataValidationJSON(s,c))return t}}return t},setFilterView:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return"setFilterView"===t.action?w9(e,t,r):t},addView:function(e,t,r){if("addView"===t.action){if(t.value.view_id===e.value.view_id)return!1;if(t.value.name===e.value.name)return r?[(0,Ce.OU8)(e.sheet_id,{type:0,origin_name:e.value.name,view_id:e.value.view_id,name:k9(e.value.name,e.value.view_id)}),t]:I8(t,(function(e){e.value.name=k9(e.value.name,e.value.view_id)}))}if("setView"===t.action){if(t.value.view_id===e.value.view_id)return!1;if(t.value.name===e.value.name)return r?[(0,Ce.OU8)(e.sheet_id,{type:0,origin_name:e.value.name,view_id:e.value.view_id,name:k9(e.value.name,e.value.view_id)}),t]:(0,Ce.OU8)(t.sheet_id,{type:0,origin_name:t.value.origin_name,view_id:t.value.view_id,name:k9(t.value.name,t.value.view_id)})}return t},delView:function(e,t){switch(t.action){case"setView":case"delView":case"setFilterView":if(e.sheet_id===t.sheet_id&&e.value.view_id===t.value.view_id)return null}return t},setView:function(e,t,r){return"setView"===t.action?function(e,t,r){return e.value.view_id===t.value.view_id?r?null:t:t.value.name===e.value.name?r?T9(ga(t)):[T9(ga(e)),t]:t}(e,t,r):"delView"===t.action?function(e,t,r){return e.value.view_id===t.value.view_id?I8(t,(function(t){t.value.name=e.value.name})):t}(e,t):"addView"===t.action?function(e,t,r){if(t.value.name===e.value.name)return r?[T9(ga(e)),t]:T9(ga(t));return t}(e,t,r):t},setRangeProtection:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(t.action){case"setRangeProtection":return e.value.id!==t.value.id?t:r?null:t;case"delRangeProtection":return e.value.id,t.value.id,t;case"lockRow":case"unlockRow":case"lockCol":case"unlockCol":return e.value.id!==t.value.perm_id||!r||"lockRow"!==t.action&&"lockCol"!==t.action?t:null}return t},delRangeProtection:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];switch(t.action){case"setRangeProtection":case"delRangeProtection":return e.value.id!==t.value.id?t:null;case"lockRow":case"unlockRow":case"lockCol":case"unlockCol":return e.value.id!==t.value.perm_id||!r||"unlockRow"!==t.action&&"unlockCol"!==t.action?t:null}return t},lockRow:Q7,unlockRow:Q7,lockCol:Q7,unlockCol:Q7},A9={setValue:{setValue:E7,updateRange:Z7,setRange:Z7},setStyle:{setStyle:E7,updateRange:Z7,setRange:Z7},setFormula:{setFormula:E7,updateRange:Z7,setRange:Z7},setCell:{setCell:function(e,t){if(w7(e.target,t.target)){if(!e.value.hasOwnProperty("style")&&e.value.hasOwnProperty(Qg)&&!e.value.dataValidation&&!t.value.hasOwnProperty("style")&&t.value.dataValidation)return[t,e];var r=I7(e.value),n=I7(t.value);n=function(e){if(e.dataValidation){if(e.style)return Object.assign({},e,{style:Object.assign({},e.style,{dropdown:null})})}else if(e.style&&e.style.dropdown)return Object.assign({},e,{dataValidation:null});return e}(n);var a=!1,o=!0,i={},u=S7(r);for(var s in n)r.hasOwnProperty(s)||T7.includes(s)&&u?(a=!0,void 0!==r[s]&&(i[s]=r[s])):(o=!1,i[s]=n[s]);if(o)return null;var l=function(e,t){var r=!1;return t.dataValidation&&e.style&&e.style.dropdown?(delete t.dataValidation,r=!0):t.style&&t.style.dropdown&&e.dataValidation&&(t.style=Object.assign({},t.style,{dropdown:null}),r=!0),{needClone:r,newValue:t}}(r,i);if(!0===l.needClone&&(a=!0),i=l.newValue,a){var c={action:"setCell",sheet_id:t.sheet_id,target:{row:t.target.row,col:t.target.col},value:i};return u?(e.hasOwnProperty("type")&&(c.type=e.type),e.hasOwnProperty("extra")&&(c.extra=e.extra)):(t.hasOwnProperty("type")&&(c.type=t.type),t.hasOwnProperty("extra")&&(c.extra=t.extra)),c}}return t},updateRange:Z7,setRange:Z7,setRangeValues:f7},setRangeValues:{setRangeValues:v7},setRowHeight:{setRowHeight:function(e,t){return function(e,t){return e.row===t.row&&e.row_count===t.row_count}(e.target,t.target)?null:t}},setColumnWidth:{setColumnWidth:function(e,t){return function(e,t){return e.col===t.col&&e.col_count===t.col_count}(e.target,t.target)?null:t}},addComments:{addComments:function(e,t){if((0,me.default)(e.target,t.target)){var r=e.value.comments,n=t.value.comments;return Object.assign({},t,{value:{comments:(0,N.Z)(n,r,"id")}})}return t}},setChart:{setChart:S8("chartId")},setFloatImage:{setFloatImage:S8("floatImageId")},setFloatBlock:{setFloatBlock:S8(["blockToken","blockType"])},setConditionalFormat:{setConditionalFormat:S8("cfId")}};function I9(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(N9(e)||N9(t))return!1;if(!O9(e,t))return t;if("tidSplit"===e.action||"tidSplit"===t.action)return t;if(!r&&V9(e))return t;var n=null;return r&&A9[e.action]&&(n=A9[e.action][t.action]),null==n&&(n=S9[e.action]),null!=n?n(e,t,r):t}function O9(e,t){return!(!(0,Ce.FqT)(e)&&!(0,Ce.FqT)(t)&&e.sheet_id!==t.sheet_id)}function V9(e){return Z9.has(e.action)}function N9(e){return x9.has(e.action)}var b9,M9,F9,Z9=new Set(["setRowHeight","setColumnWidth","setValue","setStyle","setFormula","setCell","hideCol","unhideCol","localDeactiveView","localActiveView","tidSplit"]),x9=new Set(["coverSnapshot","recover"]);function D9(e,t){D8(e),D8(t)}function P9(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(D9(e,t),0===e.length||0===t.length)return t;var n=e.length,a=t.length;try{var o=Date.now(),i=(0,lr.follow)(e,t,r,I9),u=Date.now();return Ce.Ps3.moirae.teaLog({key:"client_sheet_follow",isCover:r,time_cost:u-o,op1_length:n,op2_length:a,complexity:n*a}),i}catch(e){if(e instanceof lr.FollowException){var s=JSON.parse(e.info.op1),l=JSON.parse(e.info.op2);"action"in s&&"action"in l&&Ce.Ps3.moirae.teaLog({key:"client_sheet_follow_conflict",op1:s.action,op2:l.action,isCover:r})}throw e}}function $9(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=P9(e,t,r),a=new u7,o=new h7(n);return a.follows(e,o)}function L9(e,t,r,n){var a;if(e){var o=e.type,i=e.checkCellValid(t,r).getValue();T_(e)&&(o=e.options.supportMultipleValues?"list_multiple":"list_single"),k_(e)&&(o="text_length");var u=[],s=null===(a=e.options)||void 0===a?void 0:a.handledWayOnInvalidData;s?(1&~s||u.push("show_warning"),2&~s||u.push("reject_input")):u=["show_warning","reject_input"],Ce.Ps3.ccmEventTracking("ccm_sheet_content_page_click",Object.assign({},(0,Ce.dK5)(),{click:"edit_data_valid_value",target:"none",valid_type:o,alarm_type:u.join("-"),is_pass:i,action_type:n}))}}function B9(e,t){var r,n;if((0,Ee.isBigNumber)(t))r=rn._parseFloat(t),n=(0,Ee.createFormatter)(e.formatterService);else{var a=(0,Ee.getPreferredFormatter)(e.formatterService,t);r=a.value,n=a.formatter,r instanceof we.SheetDate&&(r=r.toNumber())}return{value:r,formatter:n}}function U9(e){var t=e.sheet();return"".concat(t?t.id():"","_").concat(e.rowFrom(),"_").concat(e.colFrom(),"_").concat(e.rowTo(),"_").concat(e.colTo())}function H9(e,t,r,n,a){var o=t.getSegmentArray(r,n);if(o){var i=z9(o,t.getStyle(r,n),a),u=i.hasChanged,s=i.value;u&&(e.value=s)}}function z9(e,t,r){var n=(0,m.Z)(e),a=cm(t,r,e),o=!1;return a.forEach((function(e,t){if(e){var r=n[t];n[t]=Object.assign({},r,{style:e}),o=!0}})),o?{hasChanged:o,value:Og.getSegmentArray4Changeset(n)}:{hasChanged:o,value:void 0}}function W9(e,t,r){if(e.getDropdown(t,r))return!0;var n=e.getDataValidation(t,r);return n&&T_(n)}function G9(e,t,r,n){var a=e.getText(t,r),o=e.getValue(t,r);if((0,k.Z)(o)){var i=e.getActualStyle(t,r);return n.list.some((function(t){var r=_g._parseText2Value(e.formatterService,i,t,!0);return o+""==(r&&r.value)+""}))}return""===a||-1!==n.list.indexOf(a)}function j9(e){return function(e){var t=e.split("-");return{zh:"zh-CN",en:"en-US",ja:"ja-JP"}[(0,g.Z)(t,1)[0]]||"en-US"}(e)}function Y9(e,t){return Object.prototype.hasOwnProperty.call(e,t)}!function(e){e.ADD="add",e.DEL="del"}(b9||(b9={})),function(e){e.ROW="row",e.COL="col"}(M9||(M9={})),function(e){e.zh="zh",e.en="en",e.ja="ja"}(F9||(F9={}));var q9=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function J9(e){switch((0,R.Z)(e)){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}}function K9(e,t){if(e.map)return e.map(t);for(var r=[],n=0;n<e.length;n++)r.push(t(e[n],n));return r}var X9=Object.keys||function(e){var t=[];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t};var Q9=["columns","data","frozenColCount","frozenRowCount","id","index","name","rowFilter","rows","spans","rowCount","columnCount","chartMap","floatImageMap","floatBlocks","embeddedBlocks","dataRanges","conditionalFormats","entities","mention","image","attachment","views","reminders","users","dataValidations","importRangeIDs","gridLineHidden","group","sparklineGroup","tabColor"],eee=Q9.concat(["externalResource"]);function tee(e,t){for(var r=e.getRowCount(),n=e.getColumnCount(),a=0;a<t.length;a++){var o=t[a];if(("addRow"===o.action||"addCol"===o.action)&&r*n>(0,Ce.$$w)())return!0}return!1}function ree(e,t,r){Array.isArray(e)||(e=[e]),e.forEach((function(e,n){for(var a=e.rowFrom(),o=e.colFrom(),i=e.rowCount(),u=e.colCount(),s=a;s<a+i;s++)if(!r(s))for(var l=o;l<o+u;l++)t(s,l,n)}))}function nee(e,t){var r=t.rowFrom(),n=t.colFrom(),a=e.getSpan(r,n);return!!a&&a.equal(t)}function aee(e,t,r){var n=e.getSpan(t,r);if(n){var a=n.rowFrom(),o=n.colFrom();return a!==t||o!==r}return!1}function oee(e,t,r){var n;e.getSheetFromId(t)&&(null===(n=e.formulaCacheManager)||void 0===n||n.loadFormulaCacheMeta(t,r))}function iee(e,t,r){var n,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(e.getSheetFromId(t)){a&&(e.calcEngine.statistics.set(lF.ReceiveCompleteServerSideCacheTime,Date.now()),e.calcEngine.statistics.tryReportCalculationCacheTimeDifference());for(var o=[],i=0;i<r.length;++i){var u,s=r[i],l=null===(u=e.formulaCacheManager)||void 0===u?void 0:u.loadFormulaCacheBlock(t,s);null!=l&&o.push(l)}null===(n=e.formulaCacheManager)||void 0===n||n.applyFormulaCache(t,o)}}function uee(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=e.getSheetFromId(t);a&&IA(r,a._getModel(),a,n)}function see(e){return(0,G.Z)(e,Q9)}function lee(e){return(0,G.Z)(e,eee)}function cee(e){return fee(e,see)}function hee(e){return fee(e,lee)}function fee(e,t){var r=e.sheets,n={};for(var a in r){var o=r[a];n[a]=t(o)}return{sheetCount:Object.keys(n).length,sheets:n,lang:e.lang,locale:e.locale,schemaVersion:e.schemaVersion,hasArrayFormula:e.hasArrayFormula,defaults:e.defaults}}function dee(e){var t=e.data.dataTable;if(!t)return e;for(var r=Object.keys(t),n=0;n<r.length;n++)for(var a=t[r[n]],o=Object.keys(a||{}),i=0;i<o.length;i++){var u=a[o[i]];u&&u.comments&&delete u.comments}return e}function vee(e){return Object.keys(e.sheets).forEach((function(t){return dee(e.sheets[t])})),e}function pee(e){var t=window.location,r=t.origin,n=t.search,a=t.hash,o=function(e,t,r,n){t=t||"&",r=r||"=";var a={};if("string"!=typeof e||0===e.length)return a;var o=/\+/g;e=e.split(t);var i=1e3;n&&"number"==typeof n.maxKeys&&(i=n.maxKeys);var u=e.length;i>0&&u>i&&(u=i);for(var s=0;s<u;++s){var l,c,h,f,d=e[s].replace(o,"%20"),v=d.indexOf(r);v>=0?(l=d.substr(0,v),c=d.substr(v+1)):(l=d,c=""),h=decodeURIComponent(l),f=decodeURIComponent(c),Y9(a,h)?q9(a[h])?a[h].push(f):a[h]=[a[h],f]:a[h]=f}return a}(n.slice(1)),i={from:"copy"};return o.v&&(i.v=o.v),o.sheet?i.sheet=o.sheet:a&&(i.sheet=a.slice(1)),"".concat(r).concat(Ce.Ps3.prependSpace("/sheet/".concat(e,"?").concat(function(e,t,r,n){return t=t||"&",r=r||"=",null===e&&(e=void 0),"object"==(0,R.Z)(e)?K9(X9(e),(function(n){var a=encodeURIComponent(J9(n))+r;return q9(e[n])?K9(e[n],(function(e){return a+encodeURIComponent(J9(e))})).join(t):a+encodeURIComponent(J9(e[n]))})).join(t):n?encodeURIComponent(J9(n))+r+encodeURIComponent(J9(e)):""}(i))))}function mee(e,t,r,n){if(!n||"string"!=typeof n||n.length<=1||!["=","+"].includes(n[0]))return{isFormula:!1,text:n,formulaVar:null,compileContext:{}};var a="="===n[0],o=a?n.substr(1):n;o=o.replace(/[\u000d\u000a]/g,"");var i=r.parent,u=i.getCalcEngine(),s=new ou(e,t,1,1,r),l={ref:s,spread:i},c=u.compiler;c.startCollectPerformance();var h=u.compile(o,l);if(null!=c){var f=c.getPerformanceData();null!=f&&Ce.Ps3.moirae.teaLog({key:"client_sheet_formula_compile",time_cost:f.timeCost,formula_count:f.formulaCount,lexical_analysis:f.LexicalAnalysis,syntax_analysis:f.SyntaxAnalysis,semantic_analysis:f.SemanticAnalysis}),c.stopCollectPerformance()}var d=u.compileTokens(o).tokens;if(null!=h.errors&&(h=function(e,t,r,n,a){for(var o=[],i=0;i<a.length;i++){var u=a[i];if(u.tokenType===af.CloseParen&&o.length>0){var s=o[o.length-1];s.tokenType!==af.OpenParen&&s.tokenType!==af.FunctionName||o.pop()}else u.tokenType!==af.OpenParen&&u.tokenType!==af.FunctionName||o.push(u)}return o.length>0?(e+=")".repeat(o.length),t.compile(e,r)):n}(o,u,l,h,d),null!=h.errors))return{isFormula:!1,text:"'"+n,formulaVar:null,compileContext:l};var v=h.formulaVar;if(null==v)return{isFormula:!1,text:"'"+n,formulaVar:null,compileContext:l};var p,m=yr(d);try{for(m.s();!(p=m.n()).done;){var g=p.value;if(g.tokenType===af.FunctionName&&"string"==typeof g.image){var y=g.image.slice(0,g.image.length-1).toUpperCase();Ce.Ps3.collectSuiteEvent("click_insert_formula",{op_item:y,object_id:r&&r.id(),source:"body"})}}}catch(e){m.e(e)}finally{m.f()}try{Ce.Ps3.collectSuiteEvent("client_sheet_confuse_formula",{formula:Ree(d)})}catch(e){console.error("[SHEET LOG]: confuse formula error",e)}if(l.error){var _=l.error;Ce.Ps3.collectSuiteEvent("sheet_error_mark",{error_type:"formula_error",op_item:_,object_id:r&&r.id()}),_.getValue()===it.ErrorConstant.NAME&&Ce.Ps3.collectSuiteEvent("sheet_opration_for_AI",{action:"collect_#name_error",error_keyword:o,object_id:r&&r.id()})}return!a&&v.isFormula()&&v.getRoot().isNumber()?{isFormula:!1,text:n,formulaVar:null,compileContext:l}:{isFormula:!0,text:"="+u.decompile(v,{ref:s}),formulaVar:v,compileContext:l}}function gee(e,t){var r=e.getActiveCellIndex(),n=mee(r.row,r.column,e,t),a=n.isFormula,o=n.compileContext;return a&&!(null!=o&&o.error)}function yee(e,t){return"col"===e?(0,Ce.hdC)(t):(t+1).toString()}function _ee(e,t,r){return e?Eg(e,t,r)?cr("comment.quote.picture"):e.getText(t,r,void 0,void 0,void 0,!0)||"":""}function Ree(e){for(var t={count:0,map:{}},r={strMap:{}},n="",a=0;a<e.length;a++){var o=e[a];switch(o.tokenType){case af.StringConstant:n+="string";break;case af.NumericalConstant:n+="number";break;case af.LogicalTrue:case af.LogicalFalse:n+="boolean";break;case af.ErrorConstant:case af.RefConstant:var i=o.image.toUpperCase().trim(),u=t.map[i];u||(u="error"+t.count++,t.map[o.image]=u),n+=u;break;case af.FunctionName:n+=o.image.toUpperCase().trim();break;case af.LocalReferenceA1:case af.ExternalReferenceA1:case af.LocalReferenceR1C1:case af.ExternalReferenceR1C1:var s=Cee(o.image.toUpperCase().trim(),r,o.tokenType===af.ExternalReferenceA1||o.tokenType===af.ExternalReferenceR1C1);if(!s)return"";n+=s;break;default:n+=o.image.trim()}}return n}function Cee(e,t,r){var n=t.strMap[e];if(n)return n;if(n="",r){var a=e.split(/!|\uFF01/);if(2!==a.length)return n;var o=a[0];if(e=a[1],o){var i=t.sheet;i||(i={count:0,map:{}},t.sheet=i);var u=i.map[o];u||(u=""+i.count++,i.map[o]=u),n+=u+"!"}}var s=/(\$)?([A-Za-z]+)?(\$)?(\d+)?/;return n+=e.split(/:|\uFF1A/).map((function(e){return e.replace(s,(function(e,r,n,a,o){var i="";if(void 0!==r&&(i+="$"),void 0!==n){var u=t.col;u||(u={count:0,map:{}},t.col=u);var s=u.map[n];s||(s="C"+u.count++,u.map[n]=s),i+=s}if(void 0!==a&&(i+="$"),void 0!==o){var l=t.row;l||(l={count:0,map:{}},t.row=l);var c=l.map[o];c||(c="R"+l.count++,l.map[o]=c),i+=c}return i}))})).join(":"),t.strMap[e]=n,n}function wee(e,t,r,n,a,o){var i=o||e.getActiveSheet();if(!i)return!1;for(var u="row"===n?i._getRowInfos():i._getColInfos(),s=0;s<r;s++){var l=u.getFId(t+s);if(a){if(l===a)return!0}else if(void 0!==l)return!0}return!1}function Eee(e,t,r,n){var a=e.rowFrom(),o=e.rowCount(),i=e.colFrom(),u=e.colCount();return wee(t,a,o,"row",r,n)&&wee(t,i,u,"col",r,n)}function kee(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=e.importRangeManager;if(!n)return!1;for(var a=r?t._oldChangesets:t._changesets,o=0,i=function(t){var r=a[t];if("setCell"===r.action&&r.type&&1&r.type||"setRangeValues"===r.action&&Array.isArray(r.value.formulaData)){if(n.isImportRangeNumExceedLimit(o))return{v:(Ce.Ps3.Toast.error({key:"crossTableError_num",closable:!0,content:cr("CreationDoc_Sheets_ImportrangeToLimit",Ce.Ps3.getSheetImportRangeCountLimit())}),!1)};"setCell"===r.action?i(r.value.formulaData):"setRangeValues"===r.action&&r.value.formulaData.forEach((function(e){return i(e)}))}function i(t){if(t){var r=t.externalDataReference;r&&(Tee(r,e),o++)}}},u=0;u<a.length;++u){var s=i(u);if("object"===(0,R.Z)(s))return s.v}return!0}function Tee(e,t,r,n){var a=e.spreadToken,o=id(e.ref);if(o){var i=t.importRangeManager;if(i){var u=i.generateImportRangeId(o,a);void 0!==r&&void 0!==n&&i.setImportRangeAutoExpand("".concat(u,"_").concat(r,"_").concat(n)),e.importRangeId=u}}}function See(e){var t=e.getActiveSheet(),r=t.getSelections(),n=!1,a=!1;if(1===r.length){var o=r[0];t.getSpans(o).length?n=!0:(o.rowCount()>1||o.colCount()>1)&&(a=!0)}return{mergable:a,splitable:n}}function Aee(e){var t=e.getActiveSheet(),r=t.getSelections()[0];if(!r)return!1;for(var n=r.rowFrom(),a=r.colFrom(),o=r.rowCount(),i=r.colCount(),u=0,s=n;s<n+o;s++)for(var l=a;l<a+i;l++)(null!==t.getValue(s,l)||t.getSegmentArray(s,l))&&u++;return u<=1}function Iee(e,t){var r=See(e),n=r.mergable,a=r.splitable,o=e.getActiveSheet(),i=o.getSelections();if(t){if(n)return o.mergeCells(i)}else if(a)return o.splitCells(i);return!1}function Oee(e){var t=!1;return e&&(t=!e.getParent().permissionManager.hasPermission(e.id())),t}function Vee(e){if(e){var t=e.filterModel&&e.filterModel.filterRange;return 0!==e.getPermissionDeniedRangeList(t).length}return!1}function Nee(e,t){var r,n=e.getService(It.f3);if(null==n||!n.suiteEditable)return!1;var a=t.sheetId,o=t.row,i=t.col,u=e.getSheetFromId(a);if(!u)return!1;var s=e.permissionManager;return(null==s?void 0:s.hasPermission(a))&&(null===(r=u.protectionModel)||void 0===r?void 0:r.getRangePermissions([new uu(o,i,u)]).hasPermission)}var bee,Mee=function(e){return e.getSelections()[0]},Fee=function(e){var t=Mee(e);return t?t.rowCount():0},Zee=function(e){var t=Mee(e);return t?t.colCount():0},xee=function(e,t){return function(e){var t=e.getColumnCount();return Fee(e)>=1&&Zee(e)===t}(e)?"row":function(e){var t=e.getRowCount();return Zee(e)>=1&&Fee(e)===t}(e)?"col":function(e){var t=Mee(e);return 1===(null==t?void 0:t.size())}(e)?"cell":t};function Dee(e){var t=e.expected,r=e.contents;return 0===t.length&&null===r}function Pee(e,t,r){return":".concat(e.getFormula(t,r),"\n:").concat(e.getText(t,r))}function $ee(e,t,r){return e.getValue(t,r)?"true":"false"}!function(e){e[e[""]=0]="",e[e[""]=1]="",e[e[""]=2]="",e[e[""]=3]="",e[e[""]=4]="",e[e[""]=5]="",e[e[""]=6]=""}(bee||(bee={}));var Lee=function(e){for(var t=/\`\`\`([^```]*)?```/g,r=[],n=t.exec(e);n;){var a=n[1].replace(/\n/g,"");r.push(a),n=t.exec(e)}var o=/[^/s]/;return(0,m.Z)(new Set(r.filter((function(e){var t=o.exec(e);return!!t&&"="===t[0]}))))},Bee=function(e){var t=e.row,r=e.col,n=e.colCount,a=e.rowCount;return[{area:a*n,positionList:{start:[t,r],end:[t+a,r+n]}}]};function Uee(e,t,r){if(zee(r,e,t)){var n,a=null===(n=r._spanModel.find(e,t))||void 0===n?void 0:n.toJSON();a&&(e=a.row,t=a.col)}return r.dataValidationService.hasCheckbox(e,t)?$ee(r,e,t):r.getValue(e,t)}var Hee=function(e,t){for(var r={},n={},a=[],o=function(e,t,r){var n=e,a=e+Math.min(t,40),o=Math.max((40-t)/2,0);n-=Math.ceil(o),a+=Math.floor(o);var i=0-n;i>0&&(a+=i);var u=a-r;return u>0&&(n-=u),[Math.max(0,n),Math.min(a,r)]}(t.col,t.colCount,e.getColumnCount()),i=(0,g.Z)(o,2),u=i[0],s=i[1],l=u;l<s;l++){var c=Uee(0,l,e);if(c){var h=(0,Ce.hdC)(l);if(void 0===n[h]){n[h]=c,r[0]||(r[0]={}),r[0][l]=c;var f={name:c,index:l,column:h};a.push(f)}}}return{colMap:n,positionMap:r,colList:a}};function zee(e,t,r){return e&&e._spanModel.find(t,r)}var Wee,Gee=function(e){return e},jee=function(e){var t=e.sheet();if(!t)return[];var r=e.toJSON();if(1===r.rowCount&&1===r.colCount){var n=r.row,a=r.col;if(t.getVar(n,a).isFormula())return[[Pee(t,n,a)]]}for(var o=[],i=0;i<r.rowCount;i++){for(var u=[],s=0;s<r.colCount;s++){var l=i+r.row,c=s+r.col,h=t.dataValidationService.hasCheckbox(l,c)?$ee(t,l,c):t.getText(l,c);u.push(h)}o.push(u)}return o},Yee=function(e){var t;!function(e){e.ArrayStart="ArrayStart",e.ArrayEnd="ArrayEnd",e.ObjectStart="ObjectStart",e.ObjectEnd="ObjectEnd",e.SingleQuotation="SingleQuotation",e.DoubleQuotation="DoubleQuotation",e.Text="text"}(t||(t={}));for(var r=/^\[$/,n=/^]$/,a=/^\{$/,o=/^\}$/,i=/^'$/,u=/^"$/,s=function(e){return r.test(e)?t.ArrayStart:n.test(e)?t.ArrayEnd:a.test(e)?t.ObjectStart:o.test(e)?t.ObjectEnd:i.test(e)?t.SingleQuotation:u.test(e)?t.DoubleQuotation:t.Text},l=[],c=[],h=function(e){var r=c[c.length-1];r.type===t.Text?r.text+=e:c.push({type:t.Text,text:e})},f=function(e){return!!e.find((function(e){return[t.SingleQuotation,t.DoubleQuotation].includes(e.type)}))},d=function(e,t){var r=new Array(t.length).fill(0);return e.forEach((function(e){t.find((function(t,n){var a=t===e.type;return a&&r[n]++,a}))})),r},v=0;v<=e.length;v++){var p=e[v];switch(s(p)){case t.ArrayStart:c.push({type:t.ArrayStart,text:p});break;case t.ArrayEnd:if(!c.length)continue;if(f(c)){h(p);break}c.push({type:t.ArrayEnd,text:p});var m=d(c,[t.ObjectStart,t.ObjectEnd,t.ArrayStart,t.ArrayEnd]),y=(0,g.Z)(m,4),_=y[0],R=y[1];_+y[2]===R+y[3]&&l.push(c.splice(0));break;case t.ObjectStart:c.push({type:t.ObjectStart,text:p});break;case t.ObjectEnd:if(!c.length)continue;if(f(c)){h(p);break}c.push({type:t.ObjectEnd,text:p});var C=d(c,[t.ObjectStart,t.ObjectEnd,t.ArrayStart,t.ArrayEnd]),w=(0,g.Z)(C,4),E=w[0],k=w[1];E+w[2]===k+w[3]&&l.push(c.splice(0));break;case t.SingleQuotation:if(!c.length)continue;var T=c.findIndex((function(e){return e.type===t.SingleQuotation}));if(-1!==T){var S=c.splice(T).map((function(e){return e.text})).join("");c.push({type:t.Text,text:S+"'"})}else c.push({type:t.SingleQuotation,text:p});break;case t.DoubleQuotation:if(!c.length)continue;var A=c.findIndex((function(e){return e.type===t.DoubleQuotation}));if(-1!==A){var I=c.splice(A).map((function(e){return e.text})).join("");c.push({type:t.Text,text:I+'"'})}else c.push({type:t.DoubleQuotation,text:p});break;case t.Text:if(!c.length)continue;h(p)}}return l.map((function(e){return e.map((function(e){return e.text})).join("")})).map((function(e){try{return JSON.parse(e)}catch(e){return null}})).filter((function(e){return!!e}))},qee=function(e){return Yee(e).map((function(e){return Array.isArray(e)?e.filter((function(e){return!!e.action})):e.action?[e]:null})).reduce((function(e,t){return e&&(0,Ce.hTd)(e,t||[]),e}),[])},Jee=function(e){try{return Yee(e)[0]||{}}catch(e){return{}}};!function(e){e.AI_WRITE="AI_WRITE",e.AI_DEEPSEEK_WRITE="AI_DEEPSEEK_WRITE",e.AI_ASK="AI_ASK",e.AI_CLASSIFY="AI_CLASSIFY",e.AI_EXTRACT="AI_EXTRACT",e.AI_IMPORTDATA="AI_IMPORTDATA",e.AI_INFER="AI_INFER",e.AI_POLISH="AI_POLISH",e.AI_SENTIMENT="AI_SENTIMENT",e.AI_SUMMARY="AI_SUMMARY",e.AI_TRANSLATE="AI_TRANSLATE"}(Wee||(Wee={}));var Kee,Xee=new Set(["AI_WRITE","AI_DEEPSEEK_WRITE","AI_ASK","AI_CLASSIFY","AI_EXTRACT","AI_IMPORTDATA","AI_INFER","AI_POLISH","AI_SENTIMENT","AI_SUMMARY","AI_TRANSLATE"]),Qee=function(e){return Xee.has(e)},ete=function(e){return e.startsWith("F:")},tte=function(e){return function(e){var t,r=[],n=yr(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(ete(a)){var o=a.split(":")[1];o&&r.push(o)}}}catch(e){n.e(e)}finally{n.f()}return r}(e).some((function(e){return Qee(e)}))},rte=[Ce.O6N.SHEET_AI_NO_PERMISSION_ADMIN,Ce.O6N.SHEET_AI_NO_PERMISSION_FG,Ce.O6N.REQUEST_FAIL],nte=function(e,t){return tte(e)&&rte.includes(t)},ate=function(e){if(e){for(var t=e.parent,r=[],n=e.iterContentWithPos(0,0,e.getRowCount(),e.getColumnCount()),a=n.next();null!==a;a=n.next()){var o=a,i=(0,g.Z)(o,2),u=i[0],s=i[1],l=u.formulaVar;if(l&&l.isFormula()){var c=l.getRawVar();if(c.isError()){var h=e.getFormulaData(s.row,s.col);(null==h?void 0:h.tree)&&nte(h.tree,c.errorCode)&&(zK(l),r.push(l.getRef()))}}}r.length>0&&t.calcEngine.markDirty(r)}};function ote(e,t,r){var n=e.getValue(t,r);if(null===n)return!0;if("number"!=typeof n)return!1;var a=e.getActualFormatter(t,r);return!a||!(0,Ee.isDateTimeFormatter)(a)}!function(e){e[e.PivotTable=0]="PivotTable",e[e.SpanCells=1]="SpanCells",e[e.ProtectRange=2]="ProtectRange",e[e.ArrayFormula=3]="ArrayFormula",e[e.Error=4]="Error"}(Kee||(Kee={}));var ite=function(){function e(t,r){(0,y.Z)(this,e),this.spread=t,this.processHandler=r,this.sortOptions={}}var t,r;return(0,_.Z)(e,[{key:"sort",value:(r=(0,u.Z)(i().mark((function e(t,r,n){var a,o,u,s,l,c,h,f,d,v,p,m,g,y,_,R;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.sortType=t?"asc":"desc",this.sortOptions=null!==(a=n)&&void 0!==a?a:{},v=this.spread.getActiveSheet(),this.trackEnterSort(),p=null!==(o=r)&&void 0!==o?o:v.getSelections()[0],this.checkValidSort(v,p),m=this.isEnableConfirmExpand(p),e.t0=m,!e.t0){e.next=11;break}return e.next=10,this.confirmToExpand(v,p);case 10:e.t0=e.sent;case 11:if(!(g=e.t0)||g.continueSort){e.next=14;break}return e.abrupt("return");case 14:return y=g&&(null==g?void 0:g.shouldExpand),_=y?this.getExpandedRange(v,p):p,null!==(u=(s=this.processHandler).onPrepareSort)&&void 0!==u&&u.call(s,v.getHasFormulaByRange(_)),e.next=18,Promise.all([(0,Ce.QFC)(),XE(v,_.rowFrom(),_.colFrom(),_.rowCount(),_.colCount())]);case 18:null!==(l=(c=this.processHandler).onBeforeSort)&&void 0!==l&&l.call(c),this.trackConfirmSort(m,y),R=null!==(h=this.sortOptions.selectIndex)&&void 0!==h?h:p.colFrom(),v.sortRange(this.checkIsFilterFirstRow(v,_,R),[{index:R,ascending:t}],this.sortType),null===(f=(d=this.processHandler).onAfterSort)||void 0===f||f.call(d);case 22:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return r.apply(this,arguments)})},{key:"checkIsFilterFirstRow",value:function(e,t,r){return this.sortOptions.isFromFilterMenu||function(e,t,r,n){for(var a=t;a<t+r;a++){var o=ote(e,a,n);if(a===t){if(o)return!0}else if(!o)return!0}return!1}(e,t.rowFrom(),t.rowCount(),r)?t:new ou(t.rowFrom()+1,t.colFrom(),t.rowCount()-1,t.colCount(),e)}},{key:"isEnableConfirmExpand",value:function(e){return 1===e.colCount()&&!this.sortOptions.forceNotExpand}},{key:"trackEnterSort",value:function(){this.sortOptions.sortSource&&Ce.Ps3.ccmEventTracking("ccm_sheet_content_page_click",{click:"sort_type",target:"none",sort_type:this.sortType,action_type:this.sortOptions.sortSource})}},{key:"trackConfirmSort",value:function(e,t){this.sortOptions.sortSource&&Ce.Ps3.ccmEventTracking("ccm_sheet_content_page_click",{click:"finish_sort",target:"none",sort_method:e?"confirm_button":"direct",sort_type:this.sortType,action_type:this.sortOptions.sortSource,sort_area:t?"extend_area":"current_area"})}},{key:"confirmToExpand",value:(t=(0,u.Z)(i().mark((function e(t,r){var n,a;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getHasFormulaByRange(r),e.next=3,this.processHandler.onExpandSortRange(n,this.sortType,this.sortOptions);case 3:return a=e.sent,e.abrupt("return",(Ce.Ps3.collectSuiteEvent("sheet_opration",{action:"sort",source:"popup",has_formula:n,should_expand:a.shouldExpand,object_id:t.id()}),a));case 5:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"getExpandedRange",value:function(e,t){var r=e.inject(jm).getResponsableRange(t,this.sortOptions.expandDirection,{isExcludePivotTable:!0});if(!r.equal(t)){e.setSelection(r);var n=e.getSelections()[0];return this.checkValidSort(e,n),n}return t}},{key:"checkValidSort",value:function(e,t){var r=e.getSpans(t);if(r.length>0)throw{type:Kee.SpanCells,spans:r,sortType:this.sortType};if(zv(e,t))throw{type:Kee.ArrayFormula};if(CT(e,t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()))throw{type:Kee.PivotTable};if(e.getPermissionDeniedRangeList(ou.toNormalRange(t)).length>0)throw{type:Kee.ProtectRange}}}]),e}(),ute=function(e,t){return e.rowFrom()<t.rowFrom()||!(e.rowFrom()>t.rowFrom())&&e.colFrom()<t.colFrom()},ste=function(e){for(var t=e[0],r=1;r<e.length;r++)ute(t,e[r])||(t=e[r]);var n=Mv(t);return 1===e.length?cr("CreationDoc_Sheets_MergedCellsCanNotSort",n):cr("CreationDoc_Sheets_MergedCellsCanNotSortPlural",n,e.length)},lte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_AddComment}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a,o=t.addComment;if(o){var i=r.sheetId,u=o.value.cell,s=e.getSheetFromId(i);if(s){var l=u.startRow,c=u.startCol,h=s.getComments(l,c)||[],f=(0,b.Z)(h,[{id:o.value.id,isResolved:null===(a=o.value.isResolved)||void 0===a||a}]).reverse(),d=(0,N.Z)(f,"id").reverse();s._setComments(l,c,d)}}}}]),e}(),cte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_AddConditionalFormatting}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.addConditionalFormatting;if(a){var o=r.sheetId,i=e.getSheetFromId(o);null==i||i._addConditionalFormatV2(a)}}}]),e}(),hte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_AddCustomView}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.addCustomView;if(a){var o=r.sheetId,i=e.getSheetFromId(o);if(i){var u=a.value;i.viewsModel.addView(u.id,u.name,!0).getFilterModel().deserialize(u.autoFilter,r.resourceRefs)}}}}]),e}(),fte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_AddEmbeddedBlock}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.addEmbeddedBlock;if(a){var o=r.sheetId,i=e.getSheetFromId(o);if(i){var u=a.value;i._setEmbeddedBlock(u.id,{blockToken:u.id,blockType:dte(u.blockType),position:{row:u.cell.startRow,col:u.cell.startCol},blockSetting:{}},!0)}}}}]),e}();function dte(e){return e===Ce.B2l.EmbeddedBlockType.EmbeddedBlockType_PIVOT_TABLE?Zt.kH.PIVOT_TABLE:Zt.kH.FALLBACK}var vte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_AddFloatBlock}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.addFloatBlock;if(a){var o=r.sheetId,i=e.getSheetFromId(o);if(i){var u=a.value,s=u.anchor;i._setFloatBlock(u.id,{sheetId:o,blockToken:u.id,blockType:pte(u.type),blockSetting:{row:s.cell.startRow,col:s.cell.startCol,x:s.cellOff.x,y:s.cellOff.y,width:s.size.w,height:s.size.h,zIndex:s.zIndex}},!0)}}}}]),e}();function pte(e){return e===Ce.B2l.FloatBlockType.FloatBlockType_CHART?Zt.kH.CHART:Zt.kH.FALLBACK}var mte,gte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_AddFloatImage}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.addFloatImage;if(a){var o=r.sheetId,i=e.getSheetFromId(o);if(i){var u=a.value,s=u.anchor;i._setFloatImage(u.id,{sheetId:o,floatImageId:u.id,floatImageSetting:{row:s.cell.startRow,col:s.cell.startCol,x:s.cellOff.x,y:s.cellOff.y,width:s.size.w,height:s.size.h,imageToken:u.token,zIndex:s.zIndex}},!0)}}}}]),e}(),yte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_AddRangeProtection}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a,o=t.addRangeProtection;if(o){var i=r.sheetId,u=e.getSheetFromId(i);if(u){var s=o.value,l=[];null!==(a=s.ranges)&&void 0!==a&&a.forEach((function(e){var t=gu(hs(e,u));l.push(t)})),u.protectionModel.setProtection(s.id,{creatorId:s.creatorId,description:s.description,ranges:l})}}}}]),e}(),_te=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_SetSheetProtection}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.setSheetProtection;if(a){var o=a.sheetId,i=e.getSheetFromId(o);if(i){var u=a.value;e.permissionManager.setPerm(u.id,{permId:u.id,lockInfo:u.description,sheetId:o,creatorId:u.creatorId,sheetName:i.name()})}}}}]),e}(),Rte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_AddReminder}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.addReminder;if(a){var o=r.sheetId,i=e.getSheetFromId(o);if(i){var u=new zC(a.value.id);u.deserialize(a.value),i._dataModel.setReminderById(a.value.id,u)}}}}]),e}(),Cte=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(t.length<1)return[];var r=[];return t.forEach((function(t){if(t){var n=t.split("_")[0];if(n){var a=e.getSheetFromId(n);if(a){var o=a.rangeModel.getRangesFromId([t])[0];!o||void 0!==o.type&&o.type!==Ce.xj7.NORMAL||r.push(o)}}}})),r},wte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_AddWorkbookRange}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.addWorkbookRange;if(a){var o=r.sheetId,i=e.getSheetFromId(o),u=a.value,s=u.range,l=u.id,c=u.type;if(i&&s&&l){var h=function(e,t,r,n,a){var o;return Object.assign({},gu(hs(e,t)),{sheetId:null!==(o=e.sheetId)&&void 0!==o?o:r,rangeId:n,usageType:a})}(s,i,o,l,c);h&&(r.isApplySnapshot?(r.rangeMap||(r.rangeMap={}),r.rangeMap[l]=h):i.rangeModel.setRange(h))}}}},{key:"batchDone",value:function(e,t){if(t.isApplySnapshot){var r=t.sheetId,n=e.getSheetFromId(r);n&&(n.rangeModel=JN.fromJSON(n,t.rangeMap))}}}]),e}(),Ete=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_InsertSheet}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a,o,i,u,s,l,c,h,f,d=t.insertSheet;if(d){var v,p=d.worksheetProperties,m=null!==(a=null==p?void 0:p.id)&&void 0!==a?a:"",g=null==p?void 0:p.externalBlock,y=(null==p?void 0:p.sheetState)===Ce.B2l.SheetState.SheetState_HIDDEN;if((v=g&&g.blockId&&g.blockType?e.creatBlockWorksheet(m,null!==(o=p.name)&&void 0!==o?o:"",yM[g.blockType],g.blockId,g.blockToken,!0,y):e.createWorksheet(m,null!==(i=null==p?void 0:p.name)&&void 0!==i?i:"",y)).setRowCount(null!==(u=null==p?void 0:p.rowCount)&&void 0!==u?u:0),v._getRowInfos().deserialize([]),v.setColumnCount(null!==(s=null==p?void 0:p.colCount)&&void 0!==s?s:0),v._getColInfos().deserialize([]),null!=p&&p.sheetView){var _=p.sheetView,R=_.frozenRowCount,C=_.frozenColCount,w=_.hideGridLines;Number.isInteger(R)&&R>=0&&v.frozenRowCount(R),Number.isInteger(C)&&C>=0&&v.frozenColumnCount(C),"boolean"==typeof w&&v.inject(UI).setGridLine(w)}if(null!=p&&p.softDelTime&&v.setDelTime(p.softDelTime),v.tabColor.setTabColor(null==p||null===(l=p.sheetPr)||void 0===l||null===(c=l.tabColor)||void 0===c?void 0:c.rgb),v.tabType.setTabType(null==p||null===(h=p.sheetPr)||void 0===h?void 0:h.tabType),e.initAddSheet(null!==(f=null==p?void 0:p.index)&&void 0!==f?f:0,v),null!=p&&p.importRanges){var E=p.importRanges,k=e.importRangeManager;k.collectImportRangeCount(E.length,0,0),E.forEach((function(e){var t=e.ref;t.sheetId=m;var r=Object.assign({},gu(hs(t,v),!0),{sheetName:t.sheetName}),n=m;k.setFromJsonImportRangeMeta(Object.assign({},e,{ref:r,sheetId:n}))}))}}}}]),e}(),kte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_MergeCells}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.mergeCells;if(a){var o=r.sheetId,i=a.ranges;if(o&&i){var u=e.getSheetFromId(o);if(u)if(r.isApplySnapshot)u.spansFromJSON(i.map((function(e){return{row:e.startRow||0,col:e.startCol||0,rowCount:(e.endRow||0)-(e.startRow||0),colCount:(e.endCol||0)-(e.startCol||0)}})));else{var s,l=yr(i);try{for(l.s();!(s=l.n()).done;){var c=s.value,h=c.startRow,f=c.startCol,d=c.endRow,v=c.endCol;u.addSpan(h||0,f||0,(d||0)-(h||0),(v||0)-(f||0))}}catch(e){l.e(e)}finally{l.f()}}}}}}]),e}(),Tte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_SetAutoFilter}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.setAutoFilter;if(a){var o=r.sheetId,i=a.value,u=e.getSheetFromId(o);u&&u.inject($I).deserialize(i,r.resourceRefs)}}}]),e}(),Ste=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_SetRangeValues}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a,o,i=t.setRangeValues;if(i){var u=r.offsetRange,s=r.isApplySnapshot,l=r.applyLimitRanges,c=null!==(a=null==u?void 0:u.row)&&void 0!==a?a:0,h=null!==(o=null==u?void 0:u.col)&&void 0!==o?o:0,f=i.range,d=i.valueRefDelta,v=i.resourceRefDelta,p=i.formatDelta,m=i.cellsDelta,g=i.cells,y=f.sheetId,_=e.getSheetFromId(y),R=new zS(d,v,p,s);if(null!=g&&g.cellIds&&g.cells&&f)for(var C=f.endCol-f.startCol,w=f.startRow+c,E=f.startCol+h,k=null==l?void 0:l.map((function(e){return{startRow:e.startRow||0,endRow:e.endRow||0,startCol:e.startCol||0,endCol:e.endCol||0}})),T=g.cellIds.length,S=function(e){var t=Math.floor(e/C)+w,r=Math.floor(e%C)+E;if(k&&!k.some((function(e){return Wo(e,t,r)})))return"continue";var n=g.cellIds[e],a=g.cells[n];_._dataModel.deserializeCell(t,r,a,R)},A=0;A<T;A++)S(A);if(null!=m&&m.denseCells&&f)for(var I=f.endCol-f.startCol,O=f.startRow+c,V=f.startCol+h,N=m.denseCells.length,b=0;b<N;b++){var M=Math.floor(b/I)+O,F=Math.floor(b%I)+V,Z=m.denseCells[b];_._dataModel.deserializeCellV1(M,F,Z,R)}else if(null!=m&&m.sparseCells)for(var x=m.sparseCells.length,D=0;D<x;D++){var P=m.sparseCells[D];_._dataModel.deserializeCellV1(P.row+c,P.col+h,P.cell,R)}}}}]),e}(),Ate=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_SetDimensionProperties}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.setDimensionProperties;if(a){var o=r.sheetId,i=e.getSheetFromId(o);if(i){var u=a.rowDimensions,s=a.colDimensions,l=a.rowOutlineGroups,c=a.colOutlineGroups;i._getRowInfos().deserialize(u||[]),i.outlineGroupModel.deserialize(l||[],!0),i._getColInfos().deserialize(s||[]),i.outlineGroupModel.deserialize(c||[],!1)}}}}]),e}(),Ite=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_SetWorkbookProperties}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a,o,i=t.setWorkbookProperties;if(i){var u=i.workbookPr,s=i.defaults;e.lang=null!==(a=null==u?void 0:u.lang)&&void 0!==a?a:void 0,e.locale=null!==(o=null==u?void 0:u.locale)&&void 0!==o?o:void 0,e.formatterService.i18n.setLanguage(e.lang||e.getUserLanguage());var l=c4._defaultOptions;for(var c in l)if(!E4(c,e.options)){var h=null==u?void 0:u[c];e.options[c]=Fm(h)?h:l[c]}if(e.initFormulaCacheManager(),null!=s&&s.format){var f,d,v,p,m,g,y,_,R=s.format,C=s.styles,w=R.defaultColWidth,E=R.defaultRowHeight,k=R.lineHeightFactor,T=R.inlineAlign,S=R.cellPadding;e.defaults=Object.assign({},e.defaults||{},{colWidth:null!==(f=w)&&void 0!==f?f:0,rowHeight:null!==(d=E)&&void 0!==d?d:0,lineHeightFactor:null!==(v=k)&&void 0!==v?v:0,inlineAlign:null!==(p=T)&&void 0!==p&&p,cellPadding:[null!==(m=null==S?void 0:S.top)&&void 0!==m?m:0,null!==(g=null==S?void 0:S.right)&&void 0!==g?g:0,null!==(y=null==S?void 0:S.bottom)&&void 0!==y?y:0,null!==(_=null==S?void 0:S.left)&&void 0!==_?_:0],style:C?ZR(C):{}})}}}}]),e}(),Ote=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_AddSparklineGroup}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.addSparklineGroup;if(a){var o=r.sheetId,i=e.getSheetFromId(o);if(i){var u=a.value;if(u){var s=i.getSparklineModel(),l=u.id,c=u.config,h=u.sparklines;if(l&&null!==c&&(5===(null==c?void 0:c.themeType)&&(c.themeType=Ce.fW_.pro),s.addGroupById(l,c),h))for(var f=0,d=Object.entries(h);f<d.length;f++){var v=(0,g.Z)(d[f],2),p=v[0],m=v[1];if(s.getSparklineById(p))s.setSparklineById(p,l);else{var y=m||{},_=y.source,R=y.position;if(!_||!R)continue;s.createSparkline(_,{row:R.startRow,col:R.startCol},p,l)}}}}}}}]),e}(),Vte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_SetChartMap}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.setChartMap;if(a){var o=r.sheetId,i=e.getSheetFromId(o);if(i)try{var u=JSON.parse(a.chartMap);i.chartModel=cI.fromJSON(i,u)}catch(e){console.error("SetChartMapExecutor parse chartMap error!",e)}}}}]),e}(),Nte=function(){function e(){(0,y.Z)(this,e),this.mutationType=Ce.B2l.MutationType.MutationType_AddCalcResult}return(0,_.Z)(e,[{key:"execute",value:function(e,t,r,n){var a=t.addCalcResult;if(a){var o=r.sheetId,i=e.getSheetFromId(o),u=a.pivotTableViewModels;if(i&&u)try{u.forEach((function(e){var t=e.id,r=e.viewModel?JSON.parse(e.viewModel):void 0,n=e.errorState,a=i.embeddedBlocksModel.getBlock(t).position,o=a.row,u=a.col;"function"==typeof Ce.Ps3.pivotTableHelper.renderPivotTableWithPosition&&Ce.Ps3.pivotTableHelper.renderPivotTableWithPosition(i,t,o,u,r,{errorState:n})}))}catch(e){console.error(e)}}}}]),e}();f4.registerMutation(new Ite),f4.registerMutation(new Ete),f4.registerMutation(new Ate),f4.registerMutation(new kte),f4.registerMutation(new Ste),f4.registerMutation(new wte),f4.registerMutation(new lte),f4.registerMutation(new Rte),f4.registerMutation(new yte),f4.registerMutation(new _te),f4.registerMutation(new cte),f4.registerMutation(new Tte),f4.registerMutation(new hte),f4.registerMutation(new gte),f4.registerMutation(new vte),f4.registerMutation(new fte),f4.registerMutation(new Ote),f4.registerMutation(new Vte),f4.registerMutation(new Nte),function(e){e[e.NO_VALIDATOR=0]="NO_VALIDATOR",e[e.VALIDATE_FAILED=1]="VALIDATE_FAILED"}(mte||(mte={}));var bte=function(){function e(t){(0,y.Z)(this,e),this.sheetContexts={},this.spreadContext=null,this.spread=t}return(0,_.Z)(e,[{key:"validate",value:function(t){var r=this,n=[];return{status:t.every((function(t,a){var o=e.validators[t.action];if(!o)return n.push({type:0,action:t,index:a}),!0;var i=o.call(r,t,r.getSheetContext(t.sheet_id));return i||n.push({type:1,action:t,index:a}),i})),errors:n}}},{key:"getSpread",value:function(){return this.spread}},{key:"getSheetContext",value:function(e){if(!(e in this.sheetContexts)){var t=this.spread.getSheetFromId(e);if(!t)return{targetSheet:null,rowCount:-1/0,colCount:-1/0};var r=t.getRowCount(),n=t.getColumnCount();this.sheetContexts[e]={targetSheet:t,rowCount:r,colCount:n}}return this.sheetContexts[e]}},{key:"getSpreadContext",value:function(){if(!this.spreadContext){var e=this.spread,t=e.importRangeManager,r=e.importRangeManagerV3;this.spreadContext={importRangeCount:t.countImportRange(),isImportRangeExceedLimit:r.V3Enable?function(){return!1}:t.isImportRangeNumExceedLimitWithRangeCache.bind(t)}}return this.spreadContext}},{key:"getActionInfo",value:function(e,t){return this.getActionInfoBySheetId(t.sheet_id)}},{key:"getActionInfoBySheetId",value:function(e){return this.getSheetContext(e)}}]),e}();bte.validators={},bte.add=function(e,t){bte.validators[e]=t},bte.remove=function(e){delete bte.validators[e]};var Mte=function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=e.getSheetFromId(t.sheet_id);return!(!r||!n)||!r&&!n},Fte=function(e,t,r){return!(null==e.row||e.row<0||e.row>=t||null==e.col||e.col<0||e.col>=r)},Zte=function(e){if(e){if(e.value&&e.value instanceof Array&&e.value.some((function(e){return void 0===e.text||null===e.text})))return!1;if(e.formulaData&&!e.hasOwnProperty("value"))return!1}return!0},xte=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!(null==e.row||null==e.row_count||e.row_count<=0||e.row+e.row_count>t+r)},Dte=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!(null==e.col||null==e.col_count||e.col_count<=0||e.col+e.col_count>t+r)},Pte=function(e,t,r,n){return!(!e.getSheetFromId(t.sheetId)||t.row+t.rowCount>r||t.col+t.colCount>n)};function $te(e){return!(e.style&&e.style.dropdown&&e.dataValidation)}function Lte(e){return function(e){if(e.hasOwnProperty(Qg)&&(null===e.dataValidation||void 0===e.dataValidation))return e.hasOwnProperty("style");var t=e.hasOwnProperty("style")&&!e.style,r=Boolean(e.style&&!e.style.dropdown);return!t&&!r||e.hasOwnProperty(Qg)}(e)}function Bte(e,t){return!t.isImportRangeExceedLimit(e)||(Ce.Ps3.Toast.error({key:"crossTableError_num",closable:!0,content:cr("CreationDoc_Sheets_ImportrangeToLimit",Ce.Ps3.getSheetImportRangeCountLimit())}),!1)}function Ute(e,t,r){switch(e.type){case Ce.xj7.ROW:var n=e.row,a=e.row_count;return!(void 0===n||void 0===a||a<=0)&&xte({row:n,row_count:a},t);case Ce.xj7.COL:var o=e.col,i=e.col_count;return!(void 0===o||void 0===i||i<=0)&&Dte({col:o,col_count:i},r);default:return!1}}function Hte(e){return!(!e.value||!e.value.range_id)}function zte(e,t,r){if(1===e.type){var n=e.row,a=e.row_count;return!(void 0===n||void 0===a||a<=0)&&xte({row:n,row_count:a},t)}if(2===e.type){var o=e.col,i=e.col_count;return!(void 0===o||void 0===i||i<=0)&&Dte({col:o,col_count:i},r)}return 0!==e.type||function(e,t,r){var n=e.row,a=e.col,o=e.row_count,i=e.col_count;return!(void 0===n||void 0===a||void 0===o||void 0===i||o<=0||i<=0)&&xte({row:n,row_count:o},t)&&Dte({col:a,col_count:i},r)}(e,t,r)}function Wte(e){return function(e){if(e.hasOwnProperty(Qg)&&(null===e.dataValidation||void 0===e.dataValidation))return e.hasOwnProperty("style");var t=e.hasOwnProperty("style")&&null===e.style,r=Boolean(e.style&&!e.style.dropdown);return!t&&!r||e.hasOwnProperty(Qg)}(e)}var Gte={sort:function(e,t){var r=this.getActionInfo(e,t),n=r.rowCount,a=r.colCount;return Fte(t.target,n,a)&&xte(t.target,n)&&Dte(t.target,a)},setCell:function(e,t){var r=this.getActionInfo(e,t),n=r.rowCount,a=r.colCount,o=t.value.dataValidation;if(o&&!ky(o))return!1;var i=this.getSpreadContext();return Zte(t.value)&&Fte(t.target,n,a)&&$te(t.value)&&Lte(t.value)&&function(e,t){return null==e.formulaData||null==e.formulaData.externalDataReference||Bte([e.formulaData.externalDataReference],t)}(t.value,i)},setRange:function(e,t){var r=t.value.dataValidation;return!(r&&!ky(r))&&Zte(t.value)&&$te(t.value)&&Wte(t.value)},updateRange:function(e,t){var r=t.value.dataValidation;return!(r&&!ky(r))&&$te(t.value)},setSpans:function(e,t){var r=this.getActionInfo(e,t),n=r.rowCount,a=r.colCount,o=function(e){return Fte(e,n,a)&&xte(e,n)&&Dte(e,a)&&e.row_count*e.col_count>1},i=o(t.target);return Array.isArray(t.value)&&(i=i&&t.value.every((function(e){return o(e.target)}))),i},setColumnWidth:function(e,t){var r=this.getActionInfo(e,t).colCount;return Dte(t.target,r)&&null!=t.value},setRowHeight:function(e,t){var r=this.getActionInfo(e,t).rowCount;return xte(t.target,r)&&null!=t.value},addRow:function(e,t){var r=this.getActionInfo(e,t),n=xte(t.target,r.rowCount,t.target.row_count);return r.rowCount+=t.target.row_count,n},addCol:function(e,t){var r=this.getActionInfo(e,t),n=Dte(t.target,r.colCount,t.target.col_count);return r.colCount+=t.target.col_count,n},delRow:function(e,t){var r=this.getActionInfo(e,t);if(!xte(t.target,r.rowCount))return r.rowCount-=t.target.row_count,!1;var n=new Set(Object.keys(r.targetSheet.getHiddenRows())),a=new Array(t.target.row_count).fill(0).map((function(e,r){return r+t.target.row})),o=a.filter((function(e){return n.has("".concat(e))})).length;return!(t.target.row_count-o>=r.rowCount-n.size||(r.rowCount-=t.target.row_count,0))},delCol:function(e,t){var r=this.getActionInfo(e,t);if(!Dte(t.target,r.colCount))return r.colCount-=t.target.col_count,!1;var n=new Set(Object.keys(r.targetSheet.getHiddenCols())),a=new Array(t.target.col_count).fill(0).map((function(e,r){return r+t.target.col})),o=a.filter((function(e){return n.has("".concat(e))})).length;return!(t.target.col_count-o>=r.colCount-n.size||(r.colCount-=t.target.col_count,0))},hideRow:function(e,t){var r=this.getActionInfo(e,t).rowCount;return xte(t.target,r)},unhideRow:function(e,t){var r=this.getActionInfo(e,t).rowCount;return xte(t.target,r)},hideCol:function(e,t){var r=this.getActionInfo(e,t).colCount;return Dte(t.target,r)},unhideCol:function(e,t){var r=this.getActionInfo(e,t).colCount;return Dte(t.target,r)},delFilter:function(e,t){var r=this.getActionInfo(e,t).targetSheet;return!(!r||!r.filterModel.info)},setFilter:function(e,t){var r=this.getActionInfo(e,t),n=r.rowCount,a=r.colCount;return xte(t.target,n)&&Dte(t.target,a)},freezeSheet:function(e,t){var r=this.getActionInfo(e,t),n=r.rowCount,a=r.colCount;return!(t.target.row<-1||t.target.col<-1||t.target.row>=n||t.target.col>=a)},addComments:function(e,t){var r=this.getActionInfo(e,t),n=r.rowCount,a=r.colCount;return Fte(t.target,n,a)&&t.value.comments.length>0},recover:function(e,t){return!0},setChart:function(e,t){return!0},delChart:function(e,t){return!0},addSheet:function(e,t){return!!Mte(e,t,!1)},setSheet:function(e,t){return!!Mte(e,t)},copySheetMutation:function(e,t){if(t.sheet_id===t.value.sheet_id){if(!Mte(e,t,!1))return!1}else if(!Mte(e,t,!0))return!1;return!0},copySheet:function(e,t){if(t.value.snapshot){var r=t.value.snapshot,n=r.rowCount,a=void 0===n?0:n,o=r.columnCount;if(0===a||0===(void 0===o?0:o))return!1}if(t.sheet_id===t.value.sheet_id){if(!Mte(e,t,!1))return!1}else if(!Mte(e,t,!0))return!1;return!0},delSheet:function(e,t){return!!Mte(e,t)},softDelSheet:function(e,t){return!0},restoreSheet:function(e,t){return!0},moveSheet:function(e,t){return!!Mte(e,t)},moveRange:function(e,t){var r=this.getActionInfoBySheetId(t.value.source.sheetId),n=r.rowCount,a=r.colCount,o=this.getActionInfoBySheetId(t.value.target.sheetId),i=o.rowCount,u=o.colCount,s=t.value.source,l=t.value.target;return!(!Pte(e,s,n,a)||!Pte(e,l,i,u))},addConditionalFormat:function(e,t){return!0},setConditionalFormat:function(e,t){return!0},delConditionalFormat:function(e,t){return!0},moveConditionalFormat:function(e,t){return!0},setFloatBlock:function(e,t){return!!t.value},delFloatBlock:function(e,t){if(!t.value)return!1;var r=t.value,n=r.blockToken,a=r.blockType;return!(!n||!a)},setEmbeddedBlock:function(e,t){return!(!t.value||!t.target)},delEmbeddedBlock:function(e,t){if(!t.value)return!1;var r=t.value,n=r.blockToken,a=r.blockType;return!(!n||!a)},addView:function(e,t){return Boolean(t.value)},delView:function(e,t){return Boolean(t.value)},setView:function(e,t){return Boolean(t.value)},setFilterView:function(e,t){if(!t.value)return!1;if(t.value.range){var r=t.value.range,n=r.col_count,a=r.row_count;if(n<=0||a<=0)return!1}return!0},setRangeValues:function(e,t){return t.value.value.length===t.target.row_count*t.target.col_count&&function(e,t){if(!e.value.formulaData||0===e.value.formulaData.length)return!0;for(var r=[],n=new Set,a=0;a<e.value.formulaData.length;a++){var o=e.value.formulaData[a].externalDataReference;o&&(n.add(a),r.push(o))}return Bte(r,t)}(t,this.getSpreadContext())},setDataRange:function(e,t){var r=this.getActionInfo(e,t);return function(e,t,r){return!!Hte(e)&&!!zte(e.target,t,r)}(t,r.rowCount,r.colCount)},delDataRange:function(e,t){return!!Hte(t)},addOutline:function(e,t){var r=this.getActionInfo(e,t),n=r.rowCount,a=r.colCount;return Ute(t.target,n,a)},updateOutline:function(e,t){var r=this.getActionInfo(e,t),n=r.rowCount,a=r.colCount;return Ute(t.target,n,a)},delOutline:function(e,t){var r=this.getActionInfo(e,t),n=r.rowCount,a=r.colCount;return Ute(t.target,n,a)},setRangeProtection:function(e,t){var r=this.getActionInfo(e,t);return function(e,t,r){for(var n=e.value.ranges,a=0,o=n.length;a<o;a++){var i=n[a];switch(i.type){case Ce.xj7.NORMAL:if(!(Fte(i,t,r)&&xte(i,t)&&Dte(i,r)))return!1;break;case Ce.xj7.ROW:if(!xte(i,t))return!1;break;case Ce.xj7.COL:if(!Dte(i,r))return!1}}return!0}(t,r.rowCount,r.colCount)}},jte=function(e){bte.add(e,(function(t){return Gte[e].call(this,this.getSpread(),t)}))};for(var Yte in Gte)jte(Yte);function qte(e,t,r){for(var n=e.sheets.map((function(e){return e.name()})),a=2,o=Jte(t,r);-1!==n.indexOf(o);)o=Jte(t,r,a),a+=1;return o}function Jte(e,t,r){return"".concat(e,"").concat(t).concat(r||"","")}var Kte=[{pred:function(e){return Array.isArray(e.value)&&e.value.some(Ce.MgP)},type:4},{pred:function(e){return Array.isArray(e.value)&&e.value.some(Ce.S3_)},type:2},{pred:function(e){return null!=e.formulaData&&null!=e.formulaData.externalDataReference},type:1},{pred:function(e){return null!=e.note},type:8}];function Xte(e){return e.map((function(e){var t=e.type,r=(0,s.Z)(e,mr);return Object.assign({type:t},(0,Ce.W43)(r))}))}var Qte=function(){function e(t,r){(0,y.Z)(this,e),this._changesets=[],this.style2Json=new Map,this._sheet=t,this._sheetId=t&&t.id(),this._command=r,r.isFirstExecution=!r._changesets,r._changesets=r._changesets||[],r._oldChangesets=r._oldChangesets||[]}return(0,_.Z)(e,[{key:"execute",value:function(e){return!1}},{key:"canExecute",value:function(){return!0}},{key:"canUndo",value:function(e){return!!this.checkRangeValid(this._sheet.parent,this._command._oldChangesets)}},{key:"undo",value:function(e){return!0}},{key:"_collRangeInfo",value:function(e,t){this._beforeAction(e);var r=this.collectRangeActions(e,t);return this._afterAction(e),this.collectColumnWidthActions(e,t).forEach((function(e){return r.push(e)})),r}},{key:"saveChangesets",value:function(e,t){var r=t?this._command._oldChangesets:this._command._changesets;e.forEach((function(e){r.push(e)}))}},{key:"saveNewSetColumnWidthAction",value:function(e,t){var r=this._sheet,n=r.defaults.colWidth,a=r._getColInfos().getSize(e);return(a===n&&t!==n||a<t)&&(this.command._changesets.push(this._colWidthAction(e,t||n)),!0)}},{key:"_beforeAction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||e.suspendEvent()}},{key:"_afterAction",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t||e.resumeEvent()}},{key:"_styleToChangeset",value:function(e,t,r,n){var a=n?this._command._oldChangesets:this._command._changesets,o=this._styleAction(e,t,r);a.push(o)}},{key:"_rangeStyleToChangeset",value:function(e,t,r,n,a){var o=n?this._command._oldChangesets:this._command._changesets,i=this._rangeStyleAction(e,t,r,a);o.push(i)}},{key:"_cellValueToChangeset",value:function(e,t,r,n){var a=n?this._command._oldChangesets:this._command._changesets,o=this._cellValueAction(e,t,r);a.push(o)}},{key:"_rangeOpToChangeset",value:function(e,t,r,n){if(e.colCount()<1||e.rowCount()<1)Ce.Ps3.moirae.teaLog({key:"client_sheet_action_range_invalid",from:this.commandName,row:e.rowFrom(),col:e.colFrom(),rowCount:e.rowCount(),colCount:e.colCount()});else{var a=r?this._command._oldChangesets:this._command._changesets,o=this._updateRangeAction(e,t,n);a.push(o)}}},{key:"_setRangeToChangeset",value:function(e,t,r){if(e.colCount()<1||e.rowCount()<1)Ce.Ps3.moirae.teaLog({key:"client_sheet_action_range_invalid",from:this.commandName,row:e.rowFrom(),col:e.colFrom(),rowCount:e.rowCount(),colCount:e.colCount()});else{var n=r?this._command._oldChangesets:this._command._changesets,a=this._setRangeAction(e,t);n.push(a)}}},{key:"_setRangeValuesActionToChangeset",value:function(e,t,r){var n=t?this._command._oldChangesets:this._command._changesets;r?n.unshift(e):n.push(e)}},{key:"_cellStyleAndValueToCS",value:function(e,t,r,n,a,o){var i=a?this._command._oldChangesets:this._command._changesets,u=this._styleAction(e,t,n,o);if(r){var s=this._cellValueAction(e,t,r);if(null!=u.value.styleId){var l=u.value.styleId;s.value.styleId=l;var c=s.extra||{},h=c.styles||{};h[l]=U3.getById(l),c.styles=h,s.extra=c}return s.value.style=u.value.style,s.value.dataValidation=u.value.dataValidation,void i.push(s)}i.push(u)}},{key:"_cellCommentsToChangeset",value:function(e,t,r,n){var a=n?this._command._oldChangesets:this._command._changesets,o=this._cellCommentsAction(e,t,r);a.push(o)}},{key:"_styleCloneToJson",value:function(e){if(null==e)return null;var t=e.clone();return"function"==typeof t.toJSON?t.toJSON():null}},{key:"_spanToChangeset",value:function(e,t,r){var n=r?this._command._oldChangesets:this._command._changesets;1===e.rowCount()&&1===e.colCount()||n.push(this._setSpansAction(e,t))}},{key:"_rowHeightToChangeset",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=r?this._command._oldChangesets:this._command._changesets,o=this._rowHeightAction(e,t,n);a.push(o)}},{key:"batchRowHeightToChangeset",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=r?this._command._oldChangesets:this._command._changesets,o=e.target,i=e.count,u={action:"setRowHeight",sheet_id:this._sheetId,is_local:n,target:{row:o,row_count:i},value:t};a.push(u)}},{key:"_columnWidthToChangeset",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=r?this._command._oldChangesets:this._command._changesets,o=this._colWidthAction(e,t,n);a.push(o)}},{key:"batchColumnWidthToChangeset",value:function(e,t,r,n){var a=r?this._command._oldChangesets:this._command._changesets,o=e.target,i=e.count,u={action:"setColumnWidth",sheet_id:this._sheetId,is_local:n,target:{col:o,col_count:i},value:t};a.push(u)}},{key:"_rowFIdToChangeset",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=r?this._command._oldChangesets:this._command._changesets,a=this._rowfIdAction(e,t);n.push(a)}},{key:"_columnFIdToChangeset",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=r?this._command._oldChangesets:this._command._changesets,a=this._columnfIdAction(e,t);n.push(a)}},{key:"_sortToChangeset",value:function(e,t,r,n,a,o){var i=o?this._command._oldChangesets:this._command._changesets,u={action:"sort",sheet_id:this._sheetId,target:{row:e,row_count:r,col:t,col_count:n},value:a};i.push(u)}},{key:"_applyChangsetWithEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,n=this._sheet;try{return n.getParent().applyActions(e,t,!0,r),!0}catch(e){return Ce.Ps3.moirae.ravenCatch(e),!1}}},{key:"_applySpreadChangsetWithEvent",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;try{return e.applyActions(t,r,!0,n),!0}catch(e){return Ce.Ps3.moirae.ravenCatch(e),!1}}},{key:"collectRangeActions",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.id(),o=e.getSpans(t,void 0,!0),i=[],u=t.rowFrom(),s=t.colFrom(),l=t.rowCount(),c=t.colCount();l*c>1&&i.push({action:"setSpans",sheet_id:a,target:this._transformRange(t),value:o?o.map((function(e){return{target:r._transformRange(e)}})):[]});var h=K8(e,{row:u,col:s,rowCount:l,colCount:c},n,J8);return i.push(h),i}},{key:"getAddCommentsAction",value:function(e,t,r){var n=[],a=e.getComments(t,r),o=e.id();return Array.isArray(a)&&a.length>0&&n.push({action:"addComments",sheet_id:o,target:{row:t,col:r},value:{comments:a}}),n}},{key:"getSetCellAction",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=n.ignorePivotTable,o=n.handleStyleRef,i=void 0===o||o,u=e.getStyleWithDropdown(t,r,!0),s=u&&u.toJSON()||null,l=e.getFormula(t,r,void 0,a),c=e.getMultipleValuesJSON(t,r),h=e.getReminderChangeset(t,r),f=e.getDataValidationJSON(t,r,{needDeepClone:!0}),d={style:s,formula:l,value:l?null:e.getChangesetValue(t,r,a),reminder:h,dataValidation:f,multipleValues:c};if(n&&!0!==n.ignoreFormulaData){var v=e.getFormulaData(t,r,void 0,a);v&&(d.formulaData=v)}if(n&&n.needNote){var p=e.getCellNoteJSON(t,r);p&&(d.note=p)}var m={action:"setCell",sheet_id:e.id(),target:{row:t,col:r},value:d};i&&(m=z3(m));var g=ere(m.value);return null!==g&&(m.type=g),m}},{key:"collectColumnWidthActions",value:function(e,t){for(var r=e.id(),n=t.colCount(),a=t.colFrom(),o=[],i=0;i<n;i++){var u=i+a;o.push({action:"setColumnWidth",sheet_id:r,target:{col:u,col_count:1},value:e.getColumnWidth(u)})}return o}},{key:"collectRowHeightActions",value:function(e,t){for(var r=e.id(),n=t.rowCount(),a=t.rowFrom(),o=[],i=0;i<n;i++){var u=i+a;o.push({action:"setRowHeight",sheet_id:r,target:{row:u,row_count:1},value:e._getActualRowHeight(u)})}return o}},{key:"_rangeActionsCollect",value:function(e,t,r,n,a,o,i){var u,s=this,l=i||this._sheet,c=l.getRowCount(),h=l.getColumnCount(),f=l.getSpans(new ou(t,r,n,a,l))||[],d=[];n*a>1&&(d=[{action:"setSpans",sheet_id:l.id(),target:{row:t,row_count:n,col:r,col_count:a},value:f.map((function(e){return{target:s._transformRange(e)}}))}]),this._beforeAction(l);try{u=e.reduce((function(e,t){var r=Object.assign({},t);if(void 0!==r.column&&(r.col=r.column),r.row>=c||r.col>=h)return e;var n=l.getStyleWithDropdown(r.row,r.col),a=l.getChangesetValue(r.row,r.col),o=l.getFormula(r.row,r.col),i=l.getMultipleValuesJSON(r.row,r.col),u=l.getReminderChangeset(r.row,r.col),s=l.getDataValidationJSON(r.row,r.col,{needDeepClone:!0}),f=n?n.toJSON():n;f&&f.dropdown&&(f.dropdown.isValid=function(e,t,r){var n=e.getDropdown(t,r);return!n||G9(e,t,r,n)}(l,r.row,r.col));var d={style:f,formula:o,value:a,reminder:u,dataValidation:s,multipleValues:i},v=l.getFormulaData(r.row,r.col);v&&(d.formulaData=v);var p=z3({action:"setCell",sheet_id:l.id(),target:{row:r.row,col:r.col},value:d}),m=ere(p.value);return null!==m&&(p.type=m),e.push(p),e}),[])}catch(e){throw e}finally{this._afterAction(l)}return d.concat(u)}},{key:"_addRowsAction",value:function(e,t){return{action:"addRow",sheet_id:this._sheetId,target:{row:e,row_count:t}}}},{key:"_delRowsAction",value:function(e,t){return{action:"delRow",sheet_id:this._sheetId,target:{row:e,row_count:t}}}},{key:"_addColsAction",value:function(e,t){return{action:"addCol",sheet_id:this._sheetId,target:{col:e,col_count:t}}}},{key:"_delColsAction",value:function(e,t){return{action:"delCol",sheet_id:this._sheetId,target:{col:e,col_count:t}}}},{key:"_rowHeightAction",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return{action:"setRowHeight",sheet_id:this._sheetId,is_local:r,target:{row:e,row_count:n},value:t}}},{key:"_colWidthAction",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return{action:"setColumnWidth",sheet_id:this._sheetId,is_local:r,target:{col:e,col_count:n},value:t}}},{key:"_rowfIdAction",value:function(e,t){return{action:"setRowProperty",sheet_id:this._sheetId,target:{row:e,row_count:1},value:{fId:t}}}},{key:"_columnfIdAction",value:function(e,t){return{action:"setColProperty",sheet_id:this._sheetId,target:{col:e,col_count:1},value:{fId:t}}}},{key:"_setSpansAction",value:function(e,t,r){var n=this;return{action:"setSpans",sheet_id:this._sheetId,target:this._transformRange(e,r),value:t?t.map((function(e){return{target:n._transformRange(e,r)}})):[]}}},{key:"_cellValueAction",value:function(e,t,r,n){return this.sheetCellValueAction(this._sheetId,e,t,r,n)}},{key:"sheetCellValueAction",value:function(e,t,r,n,a){var o=Object.assign({},n),i=n.style;i&&(i.toJSON?o.style=i.toJSON():(i.formatter&&null==i.formatter.formatCached||i.autoFormatter&&null==i.autoFormatter.formatCached)&&console.error('The value for property "formatter" or "autoFormatter" in style is invalid'));var u=n.hasOwnProperty("style")&&!i,s=i&&!i.dropdown,l=this._sheet.parent.getSheetFromId(e);if(!l)throw new Error("Can not find sheet by id. ".concat(e));if(!u&&!s||n.hasOwnProperty(Qg)||(o.dataValidation=l.getDataValidationJSON(t,r,{needDeepClone:!0})),n.hasOwnProperty(Qg)&&!n.dataValidation&&!n.hasOwnProperty("style")){var c=l.getStyleWithDropdown(t,r,a);o.style=c&&c.toJSON()}Array.isArray(n.value)&&n.value.length&&(o.value=Og.getSegmentArray4Changeset(n.value));var h={action:"setCell",sheet_id:e,target:{row:t,col:r},value:o};this._command.dontNeedStyleRef||(h=z3(h));var f=ere(h.value);return null!==f&&(h.type=f),h}},{key:"_cellCommentsAction",value:function(e,t,r){return{action:"addComments",sheet_id:this._sheetId,target:{row:e,col:t},value:{comments:r}}}},{key:"_styleAction",value:function(e,t,r,n){var a=null;if(r){var o=this.style2Json.get(r);o?a=o:(a=r.toJSON()||null,this.style2Json.set(r,a))}var i={style:a};return r&&!r.dropdown&&(i.dataValidation=this._sheet.getDataValidationJSON(e,t,{needDeepClone:!0},n)),z3({action:"setCell",sheet_id:this._sheetId,target:{row:e,col:t},value:i})}},{key:"_rangeStyleAction",value:function(e,t,r,n){return{action:"updateRange",sheet_id:this._sheetId,is_local:n,value:{target:{row:e,col:t,rowCount:1,colCount:1,type:Ce.xj7.CELL},style:r||null}}}},{key:"_moveRangeAction",value:function(e,t,r,n,a){return{action:"moveRange",sheet_id:t,value:{source:{sheetId:e,row:r.rowFrom(),col:r.colFrom(),rowCount:r.rowCount(!0),colCount:r.colCount(!0)},target:{sheetId:t,row:n.rowFrom(),col:n.colFrom(),rowCount:r.rowCount(!0),colCount:r.colCount(!0)},type:a}}}},{key:"_updateRangeAction",value:function(e,t,r){return{action:"updateRange",is_local:r,sheet_id:this._sheetId,value:Object.assign({},t,{target:{type:e.rgType,row:e.rowFrom(),col:e.colFrom(),rowCount:e.rowCount(),colCount:e.colCount()}})}}},{key:"_updateReference",value:function(e){return{action:"updateReference",sheet_id:this._sheetId,value:e}}},{key:"_setRangeAction",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this._setRangeActionCore(this._sheetId,e,t,r)}},{key:"_setRangeActionCore",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return{action:"setRange",sheet_id:e,value:Object.assign({},r,{target:{type:t.rgType,row:t.rowFrom(),col:t.colFrom(),rowCount:t.rowCount(n),colCount:t.colCount(n)}})}}},{key:"getSheetNoConflictName",value:function(e,t,r){return qte(e,t,r)}},{key:"_transformRange",value:function(e,t){return{row:e.rowFrom(),col:e.colFrom(),row_count:e.rowCount(t),col_count:e.colCount(t)}}},{key:"_colStyleAction",value:function(e,t,r){var n=this._sheet,a=n.getStyle(e,t,void 0,r),o=n.getDefaultStyle();if(!a||a.equals(o))return null;var i={style:a&&a.toJSON()||null,dataValidation:null};return z3({action:"setCell",sheet_id:this._sheetId,target:{row:e,col:t},value:i})}},{key:"_getCSWithoutFilterRow",value:function(e){if(!Array.isArray(e))return e;for(var t=[],r=0;r<e.length;r++){var n=e[r];"setCell"===n.action&&null!=n.target&&this._isFilterRow(n.target.row)||t.push(n)}return t}},{key:"_isFilterRow",value:function(e){return!this._sheet.filterModel.isVisible(e)}},{key:"splitSelectionByFilterRow",value:function(e){var t=e.rowFrom(),r=e.rowTo();if(1===e.rowCount())return this._isFilterRow(t)?[]:[e];for(var n,a,o=this._sheet.filterModel.getAllFilteredOutRowsArray(),i=0,u=o.length-1;i<o.length;i++,u--)void 0===n&&o[i]>=t&&(n=i),void 0===a&&o[u]<=r&&(a=u);if(void 0===n||void 0===a)return[e];var s=o.slice(n,a+1);return this._splitRangeByRows(e,s)}},{key:"_splitRangeByRows",value:function(e,t){var r=this,n=e.rowFrom(),a=e.rowTo(),o=e.colFrom(),i=e.colCount(),u=[];return t.forEach((function(e){e-1>=n&&u.push(new ou(n,o,e-n,i,r._sheet)),n=e+1})),n<=a&&u.push(new ou(n,o,a-n+1,i,this._sheet)),u}},{key:"_getCellValue",value:function(e,t){var r=this._sheet.getStyleWithDropdown(e,t),n=r&&r.toJSON()||null,a=this._sheet.getChangesetValue(e,t),o=this._sheet.getFormula(e,t),i=this._sheet.getFormulaData(e,t),u=this._sheet.getReminderChangeset(e,t),s=this._sheet.getDataValidationJSON(e,t,{needDeepClone:!0}),l=this._sheet.getMultipleValues(e,t);return{value:a,style:n,formula:o,formulaData:i,reminder:u,dataValidation:s,multipleValues:l?l.toJSON():null,note:this._sheet.getCellNoteJSON(e,t)}}},{key:"clearRangeInChartBlock",value:function(e){var t={chartId:e.chartId,blockSetting:Object.assign({},e.blockSetting),graphSetting:(0,Re.default)(e.graphSetting)};return delete t.blockSetting.row,delete t.blockSetting.col,t}},{key:"appendOldChartChangeset",value:function(e){var t=this,r=this._command._oldChangesets;e.forEach((function(e,n){r.push({action:"setChart",sheet_id:t._sheetId,target:{row:e.blockSetting.row,col:e.blockSetting.col},value:t.clearRangeInChartBlock(e)})}))}},{key:"getSetDataRangeAction",value:function(e){var t;switch(e.type){case Ce.xj7.ROW:t={action:"setDataRange",sheet_id:e.sheetId,value:{range_id:e.rangeId,usage_type:e.usageType,create_time:e.createTime},target:{type:1,row:e.row,row_count:e.rowCount}};break;case Ce.xj7.COL:t={action:"setDataRange",sheet_id:e.sheetId,value:{range_id:e.rangeId,usage_type:e.usageType,create_time:e.createTime},target:{type:2,col:e.col,col_count:e.colCount}};break;case Ce.xj7.ALL:t={action:"setDataRange",sheet_id:e.sheetId,value:{range_id:e.rangeId,usage_type:e.usageType,create_time:e.createTime},target:{type:3}};break;case Ce.xj7.NORMAL:default:t={action:"setDataRange",sheet_id:e.sheetId,value:{range_id:e.rangeId,usage_type:e.usageType,create_time:e.createTime},target:{type:0,row:e.row,row_count:e.rowCount,col:e.col,col_count:e.colCount}}}return t}},{key:"getDelDataRangeAction",value:function(e){return{action:"delDataRange",sheet_id:e.sheetId,value:{range_id:e.rangeId}}}},{key:"appendOldRangeChangeset",value:function(e,t){var r=this,n=this._command._oldChangesets;t.forEach((function(t){t.sheetId===e&&n.push(r.getSetDataRangeAction(t))}))}},{key:"clearRangeInFloatImageBlock",value:function(e){return{floatImageId:e.floatImageId,floatImageSetting:(0,A.default)(e.floatImageSetting,["row","col"])}}},{key:"appendOldFloatImageChangeset",value:function(e){var t=this,r=this._command._oldChangesets;e.forEach((function(e,n){r.push({action:"setFloatImage",sheet_id:t._sheetId,target:{row:e.floatImageSetting.row,col:e.floatImageSetting.col},value:t.clearRangeInFloatImageBlock(e)})}))}},{key:"tryApplyActions",value:function(e,t,r,n,a){return!!this.checkRangeValid(e,t,n)&&this._applyChangsetWithEvent(t,r,a)}},{key:"checkRangeValid",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=new bte(e).validate(t),a=n.status;if(!a){var o=e.commandManager().getExecutingType(),i=JSON.stringify((0,Ce.W43)(t)).substr(0,2048);if(console.error("RangeInvalid: ".concat(this.commandName," ").concat(i," from ").concat(o)),Ce.Ps3.moirae.teaLog({key:"client_sheet_action_validator_fail",command:this.commandName,detail:i,from:o,errors:JSON.stringify(Xte(n.errors)).substr(0,2048),raiseException:r}),r){var u=JSON.stringify(Xte(n.errors)).substr(0,2048);throw console.error("errors: ".concat(u)),new Error("CheckRangeValid Fail")}throw new Error(Vr)}return a}},{key:"checkCellValid",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.getRowCount(),o=e.getColumnCount(),i=Fte({row:t,col:r},a,o);if(!i){var u=e.parent.commandManager().getExecutingType(),s=JSON.stringify({row:t,col:r,rowCount:a,colCount:o});if(console.error("CellInValid: ".concat(this.commandName," ").concat(s," from ").concat(u)),Ce.Ps3.moirae.teaLog({key:"client_sheet_action_validator_fail",command:this.commandName,detail:s,from:u,raiseException:n}),n)throw new Error("CheckCellValid Fail")}return i}},{key:"checkRangeDuplicate",value:function(e,t,r,n){for(var a=this._sheet,o=0;o<e.length;o++){var i=e[o],u=U9(i);t.has(u)?Ce.Ps3.moirae.teaLog({key:"client_sheet_command_range_duplicate",callStack:(new Error).stack||"",selections:JSON.stringify(n)||"",splitRanges:JSON.stringify(e)||"",filterRows:JSON.stringify(a.filterModel.getAllFilteredOutRowsArray())}):(t.add(u),r.push(i))}}},{key:"filterDuplicateRange",value:function(e,t){var r=new Set,n=[];if(t){var a,o=yr(e);try{for(o.s();!(a=o.n()).done;){var i=a.value,u=this.splitSelectionByFilterRow(i);this.checkRangeDuplicate(u,r,n,e)}}catch(e){o.e(e)}finally{o.f()}}else this.checkRangeDuplicate(e,r,n,e);return n}},{key:"getPerformanceInfo",value:function(){}},{key:"getSparklineInitialDoAndUndoAction",value:function(e){return{doActions:[{action:"addSparklineGroup",sheet_id:e,value:{}},{action:"updateSparklineGroup",sheet_id:e,value:{}}],undoActions:[{action:"updateSparklineGroup",sheet_id:e,value:{}},{action:"delSparklineGroup",sheet_id:e,value:[]}]}}},{key:"command",get:function(){return this._command}},{key:"commandName",get:function(){return"unknown"}}]),e}();function ere(e){var t=Kte.reduce((function(t,r){var n=r.pred,a=r.type;return n(e)?t|a:t}),0);return t||null}function tre(e,t,r){var n=t._changesets[0],a=e.getSheetFromId(n.sheet_id);if(!a)throw new Error("Sheet not found by id: ".concat(n.sheet_id));var o=Object.assign({},n.value);return delete o.block_token,t._changesets=[{action:"restoreBlock",sheet_id:n.sheet_id,value:Object.assign({},o,{block_token:a.blockToken})}],t._oldChangesets[0].value.block_token=a.blockToken,r(e,t._oldChangesets,!0)}function rre(e,t,r,n,a,o){var i=!1;r(t);try{i=e.isFirstExecution?n(t,e):a(e)}catch(e){return Ce.Ps3.moirae.ravenCatch(e),o(t),!1}return o(t),i}var nre=function(e,t){var r=t.ranges,n=t.id,a=t.creatorId,o=t.description;return{action:"setRangeProtection",sheet_id:e,value:{id:n,creator_id:a,description:o,ranges:r.map((function(e){switch(e.type){case Ce.xj7.NORMAL:return{type:Ce.xj7.NORMAL,row:e.row,row_count:e.rowCount,col:e.col,col_count:e.colCount};case Ce.xj7.COL:return{type:Ce.xj7.COL,col:e.col,col_count:e.colCount};case Ce.xj7.ROW:return{type:Ce.xj7.ROW,row:e.row,row_count:e.rowCount};default:throw new Error("Unsupported protection range: ".concat(JSON.stringify(e)," in ").concat(n))}}))}}};function are(e,t){return{action:"delRangeProtection",sheet_id:e,value:{id:t.id}}}var ore=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e){if(this._command.isFirstExecution){var t=e.getSheetIds(),r=(0,Ce.lYS)(t),n=this._command.index,a=this._command.blockType,o=this._command.blockId,i=this._command.blockToken||"",u=this._command.blockData||"",s=this._command.sheetName;if(!o)return!1;if(e.getSheetFromName(s)&&(s=this.getSheetNoConflictName(e,s,cr("sheet.copy_item"))),n<0||n>e.sheets.length)return!1;if(a===Ce.kHU.BITABLE_BLOCK){if(!this._command.blockData)return Ce.Ps3.moirae.teaLog({key:"client_sheet_block_data_undefined",command_name:Ce.rvF.ADD_BLOCK,value:""+this._command.blockData}),!1;if(""!==i){var l="AddBlock  Bitable Block  blockToken  blockToken ".concat(i);return console.error(l),Ce.Ps3.moirae.ravenCatch(new Error(l)),!1}}if(a===Ce.kHU.DOCX_BLOCK){if(""===i){var c="AddBlock  Docx Block  blockToken ".concat(i);return console.error(c),Ce.Ps3.moirae.ravenCatch(new Error(c)),!1}if(""!==u){var h="AddBlock  Docx Block  blockData  ".concat(u);return console.error(h),Ce.Ps3.moirae.ravenCatch(new Error(h)),!1}if(e.sheets.find((function(e){return e.blockType===Ce.kHU.DOCX_BLOCK})))return!1}this._command._oldChangesets=[{action:"delBlock",sheet_id:r,value:{sheet_name:s,index:n,block_type:a,block_id:o,block_token:i}}],this._command._changesets=[{action:"addBlock",sheet_id:r,value:{sheet_id:r,sheet_name:s,index:n,block_type:a,block_id:o,block_token:i,block_data:u}}]}var f=this._applySpreadChangsetWithEvent(e,this._command._changesets,!0);return f&&e.setActiveSheetIndex(this._command._changesets[0].value.index,!0),f}},{key:"undo",value:function(e){return tre(e,this._command,this._applySpreadChangsetWithEvent)}},{key:"canUndo",value:function(e){var t=this._command._changesets[0].sheet_id,r=e.getSheetFromId(t);return Boolean(r&&r.blockToken)}},{key:"commandName",get:function(){return Ce.rvF.ADD_BLOCK}}]),t}(Qte);function ire(e,t,r,n){return t===Ce.xj7.ROW?{action:"addOutline",sheet_id:e,value:{state:n},target:{type:t,row:r[0],row_count:r[1]}}:{action:"addOutline",sheet_id:e,value:{state:n},target:{type:t,col:r[0],col_count:r[1]}}}function ure(e,t,r){return{action:"addOutline",sheet_id:e,value:{state:r},target:cre(t)}}function sre(e,t){return{action:"delOutline",sheet_id:e,target:cre(t)}}function lre(e,t,r){return{action:"updateOutline",sheet_id:e,value:{state:r},target:cre(t)}}function cre(e){return e.type===Ce.xj7.ROW?{type:e.type,row:e.row,row_count:e.rowCount}:{type:e.type,col:e.col,col_count:e.colCount}}var hre,fre=function(e,t){return t?e.rowInterval():e.colInterval()},dre=function(e,t,r,n){var a=[],o=[],i=e.outlineGroupModel,u=t.outlineGroupModel,s=t.inject(It.tb).resolve("outlineGroupMaxCount",Ce.VVE);if(i.rowOutlineTree.length+i.colOutlineTree.length>=s)return Ce.Ps3.Toast.show({type:"error",content:cr("LarkCCM_Sheets_Group_NewFailed_Toast",{num:s}),duration:2e3}),{newChangesets:a,oldChangesets:o};var l=r[0],c=l.fromRange,h=l.toRange;return[!0,!1].forEach((function(r){if(function(e,t,r){var n=t?r.getColumnCount():r.getRowCount();return(t?e.colCount():e.rowCount())===n}(c,r,t)){var s=fre(c,r),l=(0,g.Z)(s,2),f=l[0],d=l[1],v=Pu(f,d,r),p=u.getInfluencedOutlines(v),m=fre(h,r),y=(0,g.Z)(m,2),_=y[0],R=y[1],C=Pu(_,R,r),w=i.getInfluencedOutlines(C),E=[];(p.length||w.length)&&(w.sort((function(e,t){return t.level-e.level})),vre(w,{newChangesets:a,oldChangesets:o},_,R,e.id(),r),p.sort((function(e,t){return e.level-t.level})),p.forEach((function(e){for(var t=e.start,r=e.count,a=e.state,o=Zu([f,d],[t,r]),i=(0,g.Z)(o,2),u=i[0],s=i[1],l=mre(R,d,n),c=_-f,h=0,v=0;v<l;v++)E.push([u+c+h,s,a]),h+=d})),pre(E).forEach((function(t){var n=Pu(t[0],t[1],r);a.push(ure(e.id(),n,t[2])),o.push(sre(e.id(),n))})),n&&vre(p,{newChangesets:a,oldChangesets:o},f,d,t.id(),r))}})),{newChangesets:a,oldChangesets:o}},vre=function(e,t,r,n,a,o){var i=t.newChangesets,u=t.oldChangesets;e.forEach((function(e){var t=e.start,s=e.count,l=e.state,c=Zu([r,n],[t,s]),h=(0,g.Z)(c,2),f=h[0],d=h[1],v=Pu(f,d,o);i.push(sre(a,v)),u.push(ure(a,v,l))}))},pre=function(e){e.sort((function(e,t){return e[0]!==t[0]?e[0]-t[0]:t[1]-e[1]}));for(var t=e.length-1,r=e.length-2;t>=0;){var n=e[t],a=e[r];a&&n[0]===a[0]&&n[1]===a[1]&&n[2]!==a[2]&&(a[2]=n[2]),t--,r--}return e},mre=function(e,t,r){return r||e<=t||e/t%1!=0?1:e/t},gre=function(e){var t=e.map((function(e){return e.fromRange})),r=t[0].sheet(),n=(0,ge.Z)(t.map((function(e){return e.colInterval().toString()}))),a=t.map((function(e){return e.rowInterval()})).sort((function(e,t){return e[0]!==t[0]?e[0]-t[0]:t[1]-e[1]})),o=e.map((function(e){return Array.from(e.ignoredRows||[])})).sort((function(e,t){return e[0]-t[0]})),i=0;if(1===n.length)for(var u=0;u<a.length;u++){var s=a[u],l=a[1+u];if(i+=s[1],l&&s[0]+s[1]!==l[0]-o[u].length)return}if(i+o.flat().length===r.getRowCount()){var c=n[0].split(",").map(Number);return e.map((function(e){return e.fromRange=new ou(0,c[0],r.getRowCount(),c[1],r),e}))}},yre=function(e,t){return"del"===t.method?function(e,t){var r=[],n=[],a=e.outlineGroupModel,o=t.type,i=t.target,u=t.count,s=[i,u],l="row"===o,c=Pu(i,u,l),h=a.getInfluencedOutlines(c),f=Pu(i-1,1,l),d=Pu(i+u,1,l),v=a.getInfluencedOutlines(f).filter((function(e){return e.start+e.count===i})),p=a.getInfluencedOutlines(d).filter((function(e){return e.start===i+u}));return h.length||v.length&&p.length?(v.length&&p.length&&(0,ge.Z)(v.concat(p)).forEach((function(t){t.state===Au.Fold&&n.push(lre(e.id(),Pu(t.start,t.count,t.type===Ce.xj7.ROW),t.state))})),h.forEach((function(t){var a=t.start,o=t.count,i=t.state,u=Zu([a,o],s),c=Pu(u[0],u[1],l);r.push(sre(e.id(),c)),n.push(ure(e.id(),c,i))})),{newChangesets:r,oldChangesets:n}):{newChangesets:r,oldChangesets:n}}(e,t):function(e,t){var r=[],n=[],a=e.outlineGroupModel,o=t.type,i=t.source,u=t.target,s=t.count,l=i-u==0,c="row"===o,h=xu(c?Ce.xj7.ROW:Ce.xj7.COL,[u,s]),f=Pu(l?u:u-1,1,c),d=a.getInfluencedOutlines(f);return d.length?(d.forEach((function(t){var a=t.state;r.push(ure(e.id(),h,a)),n.push(sre(e.id(),h))})),{newChangesets:r,oldChangesets:n}):{newChangesets:r,oldChangesets:n}}(e,t)},_re=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets)}},{key:"doAction",value:function(){return!!this._saveChangeSets()&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_saveChangeSets",value:function(){var e=this._sheet,t=this.command,r=t.target,n=t.state,a=e.outlineGroupModel;if(r.type!==Ce.xj7.ROW&&r.type!==Ce.xj7.COL)return!1;var o=e.inject(It.tb).resolve("outlineGroupMaxCount",Ce.VVE);if(a.rowOutlineTree.length+a.colOutlineTree.length>=o)return Ce.Ps3.Toast.show({type:"error",content:cr("LarkCCM_Sheets_Group_NewFailed_Toast",{num:o}),duration:2e3}),!1;var i=a.getInfluencedOutlines(r).sort((function(e,t){return e.level-t.level})),u=i.length,s=Du(r);if(0!==u&&i[u-1].level===Su.Seven&&Mu([i[u-1].start,i[u-1].count],s)!==Iu.Empty&&Mu([i[u-1].start,i[u-1].count],s)!==Iu.EmptyButPoint)return Ce.Ps3.Toast.show({type:"error",content:cr("LarkCCM_Sheets_Group_ReachMaxLevels_Toast",{num:7}),duration:2e3}),!1;var l=ure(e.id(),r,n),c=sre(e.id(),r);return this._command._changesets.push(l),this._command._oldChangesets.push(c),!0}},{key:"commandName",get:function(){return Ce.rvF.ADD_OUTLINE}}]),t}(Qte),Rre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"_setCellValue",value:function(e,t,r,n,a,o,i,u,s){if(void 0===r&&void 0===o&&void 0===n&&void 0===i&&void 0===u)return!1;var l=this._sheet;if(!this.checkCellValid(l,e,t,!0))return!1;var c=null===o,h=o&&!o.dropdown;(c||h)&&r&&!r.hasOwnProperty(Qg)&&(u=l.getDataValidation(e,t)),null===u&&void 0===o&&(o=this._sheet.getStyleWithDropdown(e,t));var f=this.saveOldState(e,t,r,o,i,u),d=this.saveNewState(e,t,r,n,a,o,i,u);return this._command.dontExtendFilter||s&&this.saveExtendFilterRangeChangesets(e,t,f,d),!0}},{key:"saveOldState",value:function(e,t,r,n,a,o){var i=this._sheet,u={};if(void 0!==r){u.value=i.getChangesetValue(e,t);var s=i.getMultipleValues(e,t);s&&(u.multipleValues=s.toJSON())}if(void 0!==n){var l=i.getStyleWithDropdown(e,t);u.style=l&&l.toJSON()||null}return void 0!==a&&(u.reminder=i.getReminderChangeset(e,t)),i.getVar(e,t).isFormula()&&(u.formula=i.getFormula(e,t),u.formulaData=i.getFormulaData(e,t)),void 0!==o&&(u.dataValidation=i.getDataValidationJSON(e,t,{needDeepClone:!0})),this._cellValueToChangeset(e,t,u,!0),u}},{key:"saveNewState",value:function(e,t,r,n,a,o,i,u,s){var l={};return this.setStyle(l,o),this.setValue(l,e,t,r,n,a,i),void 0!==u&&(l.dataValidation=(null==u?void 0:u.toJSON({needDeepClone:!1}))||null),this.setMultipleValue(l,o,s),this._cellValueToChangeset(e,t,l,!1),l}},{key:"setStyle",value:function(e,t){if(t){var r=t.toJSON();e.style=r||null}}},{key:"setValue",value:function(e,t,r,n,a,o,i){var u,s=this._sheet;if(!a)return void 0!==n&&(e.value=n),void(void 0!==i&&(e.reminder=(null==i?void 0:i.toChangeset())||null));e.formula=a;var l=Tp(u=o||Jy(s,t,r,a),{ref:u.getRef()});if(dv(u)){var c=s.getParent(),h=c.importRangeManager,f=c.importRangeManagerV3;if(f.V3Enable)f.compileImportRange(u,!0,!0);else{var d=u.getExternalDataReferenceInfo();if(d){var v=h.generateAndCacheId(u,{sheetID:s.id(),url:d.url,range:d.range});if(v){var p=v.spreadToken,m=v.ref,g=v.isSyncStyle,y=v.importRangeId,_=v.spreadSource;l.externalDataReference={spreadToken:p,ref:m,isSyncStyle:g,importRangeId:y,spreadSource:_}}}}}e.formulaData=l,e.value=null,e.reminder=null}},{key:"setMultipleValue",value:function(e,t,r){if(void 0!==r)if(r){if(e.formulaData)return void(e.value=null);e.multipleValues=r.toJSON();var n=(null==t?void 0:t.formatter)||null,a=r.mergeToSingleValue({formatter:n});a.segmentArray?e.value=a.segmentArray:a.variant?e.value=a.variant.getValue():e.value=null}else e.multipleValues=null}},{key:"saveExtendFilterRangeChangesets",value:function(e,t,r,n){if(function(e){var t=e.value,r=e.formula,n=e.multipleValues;return null!=t&&""!==t||null!=r&&""!==r||null!=n&&n.length>0}(n)){var a=this._sheet,o=this.command._changesets,i=this.command._oldChangesets,u=[a.getSpan(e,t)||new ou(e,t,1,1,a)],s=cp(a,u),l=s.actions,c=s.oldActions;(0,Ce.hTd)(o,l),(0,Ce.hTd)(i,c)}}},{key:"commandName",get:function(){return"setCell"}}]),t}(Qte),Cre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"undo",value:function(){var e=!1,t=this._command._oldChangesets;if(!this.checkCellValidBeforeUndoRedo(t))return!1;this._beforeAction(this._sheet,!0);try{e=this._applyChangsetWithEvent(t,!0)}finally{this._afterAction(this._sheet,!0)}return e}},{key:"_redoAction",value:function(){var e=!1,t=this._sheet,r=this._command._changesets;if(!this.checkCellValidBeforeUndoRedo(r))return!1;this._beforeAction(t,!0);try{e=this._applyChangsetWithEvent(r,!0)}finally{this._afterAction(t,!0)}return e}},{key:"checkCellValidBeforeUndoRedo",value:function(e){var t=this._sheet;if(!this.checkRangeValid(t.parent,e))return!1;for(var r=e.length-1;r>=0;r--)if("setCell"===e[r].action){var n=e[r].target;aee(t,n.row,n.col)&&e.splice(r,1)}return e.length>0}}]),t}(Rre),wre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"_doAction",value:function(){var e=!1,t=this._sheet;this._beforeAction(t,!0);try{if(!this.generateActions())return!1;e=!!this.checkRangeValid(t.getParent(),this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}finally{this._afterAction(t,!0)}return e}},{key:"generateActions",value:function(){var e=this,t=this._sheet,r=this._command,n=r.selections,a=r.data,o=!0;if(OT(n,(function(r,n){e.checkCellValid(t,r,n)||(o=!1)})),!o)return!1;var i=B9(t,kt()(a.expireTime).format("YYYY/MM/DD HH:mm:ss")),u=i.value,s=i.formatter;if("number"!=typeof u||!(0,Ee.isDateTimeFormatter)(s))return!1;var l=new Set;function c(e,r){var n="".concat(e,"_").concat(r);if(l.has(n))return null;if(l.add(n),aee(t,e,r)||t.getReminder(e,r))return null;var o=u,i=t.getValue(e,r),s=t.getCellFormatter(e,r);cn(i)&&s&&(0,Ee.isDateTimeFormatter)(s)&&(o=i);var c=new zC((0,Tt.v4)());if(c.fromChangeset(a),o!==u){var h=xC(o);c.setExpireTime(h),hn(h,s)||c.setNotifyStrategy(6)}return{newCellValue:o,reminder:c}}var h={ignoreStyle:!0,ignoreDataValidation:!0},f=Object.assign({cellValue:{value:null,reminder:null}},h);return n.forEach((function(r){var n=t7(t.id(),r.toJSON()),a=t7(t.id(),r.toJSON());OT(r,(function(e,r){var o=c(e,r);if(null!==o){var i=o.newCellValue,u=o.reminder;f.cellValue.value=i,f.cellValue.reminder=u.toChangeset(),X8(e,r,t,n,f),X8(e,r,t,a,h)}})),Q8(n),Q8(a),e._setRangeValuesActionToChangeset(n),e._setRangeValuesActionToChangeset(a,!0)})),this.saveExtendFilterRange(),!0}},{key:"saveExtendFilterRange",value:function(){var e=this._sheet,t=this._command,r=t.selections,n=t._changesets,a=t._oldChangesets,o=cp(e,r),i=o.actions,u=o.oldActions;(0,Ce.hTd)(n,i),(0,Ce.hTd)(a,u)}},{key:"commandName",get:function(){return Ce.rvF.ADD_REMINDER}}]),t}(Cre),Ere=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"_addRows",value:function(e,t,r,n,a){return this._command._changesets.push(this._addRowsAction(t,r)),(void 0===a||a)&&this.copyRowStyleActionsWithSetRange(e,t,r),this.copyRowHeightActions(t,r,n),[this._delRowsAction(t,r)]}},{key:"copyRowStyleActionsWithSetRange",value:function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this._copyPropertyActionsWithSetRange(e,t,r,!1,{style:!0,dataValidation:!0},n)}},{key:"_copyPropertyActionsWithSetRange",value:function(e,t,r){var n,a,o=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{style:!0,dataValidation:!1},u=i.style,s=i.dataValidation,l=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],c=this._sheet,h={ignoreValue:!0,ignoreFormulaData:!0,ignoreDataValidation:!1,ignoreReminder:!0,ignoreMultipleValues:!0,ignorePivotTable:!0,ignoreStyle:!1,ignoreFilterRow:!0},f=new vu(!0,"add",t,r,this._sheet),d=o?{row:0,col:t,rowCount:c.getRowCount(),colCount:r}:{row:t,col:0,rowCount:r,colCount:c.getColumnCount()},v=t7(c.id(),d),p=d.row+d.rowCount-1,m=d.col+d.colCount-1,g=d.row,y=d.col;o||(p=(n=[m,p])[0],m=n[1],g=(a=[y,g])[0],y=a[1]);for(var _=!1,R=g;R<=p;R++){var C=o?R:e,w=o?e:R,E=void 0,k=void 0,T=void 0,S=!0;if(u){var A=c.getCellStyle(C,w,void 0,!0);A&&(k=v.styleRefMgr.getStyleId(A))}if(s){var I=c.getDataValidation(C,w);if(I){var O=I.clone();O.initFormulaForCheckCell({preventRegisterFml:!0}),O.onOp(f),T=v.dvJSONRefMgr.getValidationId(O),"checkbox"===O.type&&(E={value:0},S=!1)}}if(h.styleId=k,h.ignoreStyle=void 0===k,h.dataValidationId=T,h.ignoreDataValidation=void 0===T,h.cellValue=E,h.ignoreValue=S,!(S&&h.ignoreDataValidation&&h.ignoreStyle)){_=!0;for(var V=y;V<=m;V++)X8(o?R:V,o?V:R,c,v,h)}}return Q8(v),l&&_&&this._setRangeValuesActionToChangeset(v),v}},{key:"copyColStyleActionsWithSetRange",value:function(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return this._copyPropertyActionsWithSetRange(e,t,r,!0,{style:!0,dataValidation:!1},n)}},{key:"_addCols",value:function(e,t,r,n,a){return this._command._changesets.push(this._addColsAction(t,r)),(void 0===a||a)&&this.copyColStyleActionsWithSetRange(e,t,r),this.copyColumnWidthActions(t,r,n),[this._delColsAction(t,r)]}},{key:"copyRowHeightActions",value:function(e,t,r){r&&this._command._changesets.push(this._rowHeightAction(e,r,void 0,t))}},{key:"copyColumnWidthActions",value:function(e,t,r){r&&this._command._changesets.push(this._colWidthAction(e,r,void 0,t))}},{key:"commandName",get:function(){return Ce.rvF.SET_ROW_COL_CHANGE}}]),t}(Qte),kre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){var e=!1,t=this._sheet;this._beforeAction(t,!0);try{e=this._command.isFirstExecution?this._doAction():this._redoAction()}catch(e){return this._afterAction(t,!0),Ce.Ps3.moirae.ravenCatch(e),!1}return this._afterAction(t,!0),e}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_doAction",value:function(){return!!this.generateActions()&&(this.tryApplyActions(this._sheet.parent,this._command._changesets,!0),!0)}},{key:"generateActions",value:function(){var e=this._sheet,t=this.command,r=t.addRowCount,n=t.addColCount,a=e.getRowCount()-1,o=e.getColumnCount()-1,i=[];r>0&&(i=this._addRows(a,a+1,r,void 0,this._command.isCopyStyle)),n>0&&(i=[].concat((0,m.Z)(this._addCols(o,o+1,n,void 0,this._command.isCopyStyle)),(0,m.Z)(i)));var u=this._sheet.getRowCount()-1,s=this._sheet.getColumnCount()-1;if(this._command.addRowCount>0&&this._command.addColCount>0){var l=this._colStyleAction(u,s);if(null!=l){var c=this._setRangeAction(new ou(u+1,o+1,this._command.addRowCount,n,this._sheet),l.value,!0);this._command._changesets.push(c)}}return!!this.checkRangeValid(e.parent,this._command._changesets,!0)&&(this._command._oldChangesets=i,!0)}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"commandName",get:function(){return"addRowAndCol"}}]),t}(Ere),Tre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e){return!(this._command.isFirstExecution&&!this.generateActions(e))&&this._doAction(e)}},{key:"undo",value:function(e){var t=this._command._changesets,r=e.getSheetFromId(this._command.sheetId);if(!r)return this._command._oldChangesets=[],!1;if(t.length>0){var n=Object.assign({},t[0]);n.value=Object.assign({},n.value);var a=Ce.Ps3.getCopySheetWithMutation()?(0,Ce.iWc)(e.serializeWorksheet(r,n.value.index,{ignoreComment:!0,ignoreProtection:!0,customSheetVisible:!0})):dee(see(r.toJSON()));n.value.snapshot=a,this._command._changesets=[n]}return this._applySpreadChangsetWithEvent(e,this._command._oldChangesets,!0)}},{key:"generateActions",value:function(e){var t=e.getSheetIds();this._command.sheetId=(0,Ce.lYS)(t),void 0===this._command.index&&(this._command.index=e.sheets.length),this._command.sheetName&&!this._isConflict(e,this._command.sheetName)||(this._command.sheetName=e._getDefaultSheetName(e.sheets.length));var r=this._command,n=r.sheetId,a=r.sheetName,o=r.index;this._command._oldChangesets=[{action:"delSheet",sheet_id:n,value:{sheet_name:a,index:o}}];var i=Ce.Ps3.getCopySheetWithMutation()?"copySheetMutation":"copySheet";return this._command._changesets=[{action:i,sheet_id:n,value:{sheet_id:n,sheet_name:a,index:o}}],!0===this.checkRangeValid(e,this._command._changesets)}},{key:"_isConflict",value:function(e,t){for(var r=e.sheets,n=0;n<r.length;n++)if(r[n].name()===t)return!0;return!1}},{key:"_doAction",value:function(e){var t=this._applySpreadChangsetWithEvent(e,this._command._changesets,!0);return t&&e.setActiveSheetIndex(this._command.index,!0),t}},{key:"canUndo",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._oldChangesets)}},{key:"commandName",get:function(){return Ce.rvF.ADD_SHEET}}]),t}(Qte),Sre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return!(this._command.isFirstExecution&&!this._saveChangesets())&&!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_saveChangesets",value:function(){var e=this,t=this._command.value,r=t.viewId,n=t.range,a=t.filterItemList,o=t.viewName,i=(0,Ce.US_)(r),u=o||this._sheet.viewsModel.assignViewName(i),s=n?Iv(n):void 0,l=this._sheet.viewsModel.activeView;return this._command._oldChangesets=[(0,Ce.h_E)(this._sheetId,{view_id:r,name:u}),l?(0,Ce.fdi)(this._sheetId,l.getId()):(0,Ce.YY8)(this._sheetId)],this._command._changesets=[(0,Ce.VCn)(this._sheetId,{view_id:r,name:u,empty:!n||void 0})],a&&a.forEach((function(t){e._command._changesets.push((0,Ce.eRv)(e._sheetId,{filter_value:t,range:s,view_id:r}))})),this._command._changesets.push((0,Ce.eRv)(this._sheetId,{view_id:r,range:s,calculate:!0})),this._command._changesets.push((0,Ce.fdi)(this._sheetId,r)),!0}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"commandName",get:function(){return Ce.rvF.ADD_VIEW}}]),t}(Qte),Are=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).styleFormatter2StyleId=new Map,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_doAction",value:function(){return this._saveChangeSets(),!!this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"getSpanChangeSet",value:function(e){var t=this._sheetId,r=[],n=[];if(e&&e.length>0){var a=this.applySpans(e,t);r=a.oldSpanChangeSet,n=a.newSpanChangeSet}return{oldSpanChangeSet:r,newSpanChangeSet:n}}},{key:"addColumnCount",value:function(){var e=this._command.addColCount,t=this._sheet,r=[],n=[];if(e>0){var a=t.getColumnCount();r.push(this._addColsAction(a,e));for(var o=0;o<e;o++)r.push(this._colWidthAction(a+o,t.defaults.colWidth));var i=this.copyLastColumnStyleForAddCols();r.push(i),n.push(this._delColsAction(a,e))}return{newColumnActions:r,oldColumnActions:n}}},{key:"copyLastColumnStyleForAddCols",value:function(){var e=this._command.addColCount,t=this._sheet.getColumnCount()-1;return this.copyColStyleActionsWithSetRange(t,t+1,e,!1)}},{key:"_saveChangeSets",value:function(){var e=this._command,t=e.startRow,r=e.startCol,n=e.rowCount,a=e.colCount,o=e.spans,i=e.splitData,u=e.format,s=e.extendFilterTargetRange,l=e.realColCount;if(0===a)return this.command._changesets=[],void(this.command._oldChangesets=[]);for(var c=this._sheetId,h=this._sheet,f=h.getColumnCount()-1,d=[],v=this.getSpanChangeSet(o),p=v.oldSpanChangeSet,m=v.newSpanChangeSet,g=this.addColumnCount(),y=g.newColumnActions,_=g.oldColumnActions,R=cp(h,[s]),C=R.actions,w=R.oldActions,E=h.formatterService,k={row:t,col:r,rowCount:n,colCount:a},T=t7(c,k),S=K8(h,k,{},J8),A={ignoreDataValidation:!0,styleId:void 0,ignoreStyle:void 0,cellValue:void 0},I=l,O=n,V=0,N=r,b=0;V<I;V++){var M=u[N-r+b];if(M&&"hide"===M)b++;else{for(var F=!M,Z=(0,Ee.createFormatter)(E,M),x=Math.min(f,N),D=0,P=t;D<O;D++,P++){A.styleId=void 0,A.ignoreStyle=!0;var $=i[D][V],L={value:$,multipleValues:null,reminder:null},B=h.getCellStyle(P,x),U=$;if($&&"string"==typeof $){var H=(0,Ee.getPreferredFormatter)(E,$,null!=B&&B.formatter?B.formatter:Z),z=H.value,W=H.formatter;U=z instanceof we.SheetDate?z.toNumber():z,F&&(null==B?void 0:B.formatter)||(null==B?void 0:B.formatter)===W||(A.ignoreStyle=!1,A.styleId=this.getAndSaveStyleId(B,W,T))}L.value=U,A.cellValue=L,X8(P,N,h,T,A)}N++}}Q8(T),d.push(T),this._command._changesets=[].concat(y,m,d,C),this._command._oldChangesets=[].concat(S,p,_,w)}},{key:"getAndSaveStyleId",value:function(e,t,r){var n=this.styleFormatter2StyleId,a=n.get(e);a||(a=new Map,n.set(e,a));var o=a.get(t);if(void 0===o){var i=Om.withFormatter(e||this._sheet.getDefaultStyle(),t);o=r.styleRefMgr.getStyleId(i),a.set(t,o)}return o}},{key:"applySpans",value:function(e,t){var r,n=[],a=[],o=yr(e);try{for(o.s();!(r=o.n()).done;){var i=r.value.toSimpleObj(),u=i.row,s=i.col,l=i.rowCount,c=i.colCount;a.push({action:"setSpans",sheet_id:t,target:{row:u,col:s,row_count:l,col_count:c},value:[]}),n.push({action:"setSpans",sheet_id:t,target:{row:u,col:s,row_count:l,col_count:c},value:[{target:{row:u,col:s,row_count:l,col_count:c}}]})}}catch(e){o.e(e)}finally{o.f()}return{oldSpanChangeSet:n,newSpanChangeSet:a}}},{key:"commandName",get:function(){return Ce.rvF.DATA_SPLIT}}]),t}(Ere),Ire=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"canExecute",value:function(){var e=this._command;return this._sheet&&e.columns&&e.size&&e.columns.length===e.size.length}},{key:"_doAction",value:function(){var e=!1;if(!this.canExecute())return e;var t=this._sheet,r=this._command,n=r.isLocal,a=void 0!==n&&n;r._canUndo=!0;var o=t.getColumnCount();this._beforeAction(t);try{for(var i=0,u=r.columns.length;i<u;i++){var s=r.columns[i];if(s>=0&&s<o){var l=t._getActualColumnWidth(s),c=r.size[i];c!==l&&(this._columnWidthToChangeset(s,l,!0,a),this._columnWidthToChangeset(s,c,!1,a))}}if(!this.checkRangeValid(t.parent,this._command._changesets))return!1;e=this._applyChangsetWithEvent(this._command._changesets,!0)}finally{this._afterAction(t,!1)}return e}},{key:"_redoAction",value:function(){return!!this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"canUndo",value:function(){return(0,f.Z)((0,v.Z)(t.prototype),"canUndo",this).call(this)&&this._command._canUndo}},{key:"commandName",get:function(){return Ce.rvF.AUTO_FIT_COLUMN}}]),t}(Qte),Ore=function(e){function t(e,r){var n;return(0,y.Z)(this,t),n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r)),r._oldSizes=r._oldSizes||[],n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"canExecute",value:function(){var e=this._command;return this._sheet&&e.rows&&e.rows.length>0}},{key:"_doAction",value:function(){var e=this,t=!1;if(!this.canExecute())return t;var r=this._sheet,n=this._command,a=n.isLocal;n._canUndo=!0,this._beforeAction(r);try{if(this.convertToRanges(n.rows).forEach((function(t){e.batchSetRowHeight(t,0,!!a)})),!this.checkRangeValid(r.parent,this._command._changesets))return!1;t=this._applyChangsetWithEvent(this._command._changesets,!0)}finally{this._afterAction(r)}return t}},{key:"_redoAction",value:function(){return!!this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"canUndo",value:function(){return(0,f.Z)((0,v.Z)(t.prototype),"canUndo",this).call(this,this._sheet.parent)&&this._command._canUndo}},{key:"batchSetRowHeight",value:function(e,t,r){this.batchUndoChangeset(e,r),this.batchRowHeightToChangeset(e,t,!1,r)}},{key:"batchUndoChangeset",value:function(e,t){for(var r,n=this._sheet,a=n.getRowCount(),o=e.target,i=e.count,u=0,s=o,l=o;l<o+i;l++)if(0<=l&&l<a){var c=n._getActualRowHeight(l);void 0===r&&(r=c),c===r?u++:(this.batchRowHeightToChangeset({target:s,count:u},r,!0,t),s=l,u=1,r=c)}u>0&&this.batchRowHeightToChangeset({target:s,count:u},r,!0,t)}},{key:"convertToRanges",value:function(e){for(var t=[],r=0;r<e.length;){for(var n=1,a=r+1;a<e.length&&e[a]===e[a-1]+1;)n++,a++;t.push({target:e[r],count:n}),r=a}return t}},{key:"commandName",get:function(){return Ce.rvF.AUTO_FIT_ROW}}]),t}(Qte),Vre=function(e){function t(e,r,n){var a;return(0,y.Z)(this,t),(a=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))).formulaCountBeforeExecute=0,a}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"commandName",get:function(){return Ce.rvF.CLEAR_VALUES}}]),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"clearDataValidation",value:function(e,t,r,n){var a=this;this._sheet._getModel().iterDataValidationWithPos(e,t,r,n).forEach((function(e){var t=(0,g.Z)(e,2),r=t[0],n=t[1],o=n.row,i=n.col;r.shouldDelWhileClearValue&&(a._cellValueToChangeset(o,i,{dataValidation:r.toJSON({needDeepClone:!0})},!0),a._cellValueToChangeset(o,i,{dataValidation:null},!1))}))}},{key:"_clearRangeValues",value:function(){var e=this,t=this._sheet,r=this._command.ranges;this.filterDuplicateRange(r,!0).forEach((function(r){e._setRangeToChangeset(r,{value:null,multipleValues:null,formula:null,reminder:null});var n=r.rowFrom(),a=r.rowCount(),o=r.colFrom(),i=r.colCount();e.clearDataValidation(n,o,a,i),e._setRangeValuesActionToChangeset(K8(t,{row:n,col:o,rowCount:a,colCount:i},{ignoreStyle:!0,ignoreDataValidation:!0}),!0)}))}},{key:"_doAction",value:function(){if(!this.generateActions())return!1;var e=this._applyChangsetWithEvent(this._command._changesets,!0);return this._sheet.dispatch("CellRemoved",{ranges:this._command.ranges,sheetId:this._sheet.id()}),e}},{key:"generateActions",value:function(){var e=this._sheet.getParent();return this._clearRangeValues(),!0===this.checkRangeValid(e,this._command._changesets)}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0,"redo")}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0,"undo")}},{key:"getPerformanceInfo",value:function(){return{formulaCountBeforeExecute:this.formulaCountBeforeExecute}}}]),t}(Rre),Nre=function(e){function t(e,r,n){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"_conditionalFormatToChangeset",value:function(e){var t=d6(this._sheet,e);t&&t.actions&&t.oldActions&&((0,Ce.hTd)(this._command._changesets,t.actions),(0,Ce.hTd)(this._command._oldChangesets,t.oldActions))}},{key:"_sparklineToChangeset",value:function(e){var t,r=new Map,n=this._sheet,a=n.getSparklineModel(),o=yr(e);try{for(o.s();!(t=o.n()).done;){var i=t.value.toJSON(),u=i.row,s=i.col,l=i.rowCount,c=i.colCount;a.iterWithPos(u,s,l,c).forEach((function(e){var t=(0,g.Z)(e,1)[0],n=t.getGroupId(),a=r.get(n)||[];a.push(t.getId()),r.set(n,a)}))}}catch(e){o.e(e)}finally{o.f()}var h,f=n.id(),d=!0,v=!0,p=!0,m=!0,y={action:"updateSparklineGroup",sheet_id:f,value:{}},_={action:"delSparklineGroup",sheet_id:f,value:[]},R={action:"updateSparklineGroup",sheet_id:f,value:{}},C={action:"addSparklineGroup",sheet_id:f,value:{}},w=yr(r);try{for(w.s();!(h=w.n()).done;){var E=(0,g.Z)(h.value,2),k=E[0],T=E[1];T.length===a.getSparklinesByGroupId(k).length?(v=!1,_.value.push(k),m=!1,C.value[k]={sparklines:T.reduce((function(e,t){var r=a.getSparklineById(t);return e[t]={source:r.getSource(),position:r.getPosition()},e}),{})}):(d=!1,y.value[k]={sparklines:T.reduce((function(e,t){return e[t]=null,e}),{})},p=!1,R.value[k]={sparklines:T.reduce((function(e,t){var r=a.getSparklineById(t);return e[t]={source:r.getSource(),position:r.getPosition()},e}),{})})}}catch(e){w.e(e)}finally{w.f()}d||this._command._changesets.push(y),v||this._command._changesets.push(_),p||this._command._oldChangesets.push(R),m||this._command._oldChangesets.push(C)}},{key:"_clearRangeStyleAndValue",value:function(){var e=this,t=this._sheet;if(!y6(t,this._command.ranges,void 0,!0))return!1;for(var r=this._command.ranges,n=new Set,a=function(a){var o=r[a],i=t.getSpans(o);i.length>0&&(e._spanToChangeset(o,i,!0),e._spanToChangeset(o,null));var u={style:null,formula:null,value:null,multipleValues:null,reminder:null,dataValidation:null,note:null},s=e.splitSelectionByFilterRow(o),l=[];e.checkRangeDuplicate(s,n,l,r),l.forEach((function(t){e._setRangeToChangeset(t,u)}))},o=0;o<r.length;o++)a(o);return r.forEach((function(r){e._setRangeValuesActionToChangeset(K8(t,r.toJSON(),{ignoreFilterRow:!0,needNote:!0},J8),!0)})),this._conditionalFormatToChangeset(r),this._sparklineToChangeset(r),!0}},{key:"_doAction",value:function(){if(!this._clearRangeStyleAndValue())return!1;if(!0!==this.checkRangeValid(this._sheet.parent,this._command._changesets))return!1;var e=this._applyChangsetWithEvent(this._command._changesets,!0);return this._sheet.dispatch("CellRemoved",{ranges:this._command.ranges,sheetId:this._sheet.id()}),e}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"commandName",get:function(){return Ce.rvF.CLEAR_VALUES_STYLE}}]),t}(Qte);function bre(e){var t=window.BearWebSlardarWeb;t&&t("addBreadcrumb",{type:"console",message:e.message,category:"sheet-custom",data:Object.assign({},e.arguments,{logger:"console"})})}function Mre(e,t){var r=e.cmd,n=e.isFirstExecution;return t?"undo"+r:"[command]: ".concat(n?"execute":"redo"," ").concat(r)}function Fre(e){return{sheetId:e.sheetId}}function Zre(e,t,r,n,a){var o=(0,Ce.D5c)(),i=e.getSheetFromId(r.sheetId);if(!i)return!1;if(i instanceof s2&&r.cmd!==Ce.rvF.SET_SHEET_PROPERTY)return!1;var u=new t(i,r,n),s=r.cmd;if(bre({message:Mre(r,n),arguments:Fre(r)}),e.dispatch("CommandExecuting",{sheet:i,commandName:s,isUndo:n}),!kee(e,u.command,n))return!1;var l=u&&u.command&&u.command.isFirstExecution;e.commandManager().setExecutingType(n?"undo":l?"do":"redo");var c=n?u.canUndo()&&u.undo(i.parent):u.execute(i.parent);e.commandManager().clearExecutingType(),c||(u.command._oldChangesets=[],u.command._changesets=[]);var h=n?u.command._oldChangesets:u.command._changesets;Dre(e,r),Pre(s,e,r,h),e.dispatch("CommandExecuted",{sheet:i,sheetName:i.name(),commandName:s,excutedResult:c,changesets:h,transId:a,isFirstExecution:l});var f=(0,Ce.egz)(o),d=(0,Ce.UFo)(n,l);return(0,Ce.RHc)({rangeTime:f,sheet:i,commandName:s,changesets:h,executeType:d},u.getPerformanceInfo()),i.notifyShell(86,s),c}function xre(e,t,r,n,a){var o=(0,Ce.D5c)(),i=e.getSheetFromId(r.sheetId),u=i?i.name():void 0,s=new t(i,r,n),l=r.cmd;if(bre({message:Mre(r,n),arguments:Fre(r)}),e.dispatch("CommandExecuting",{sheet:i,sheetName:u,commandName:l,isUndo:n}),!kee(e,s.command,n))return!1;var c=n?s.canUndo(e)&&s.undo(e):s.execute(e);c||(s.command._oldChangesets=[],s.command._changesets=[]);var h=n?s.command._oldChangesets:s.command._changesets;Dre(e,r),Pre(l,e,r,h),e.dispatch("CommandExecuted",{sheet:i,sheetName:u,commandName:l,excutedResult:c,changesets:h,transId:a});var f=(0,Ce.egz)(o),d=s&&s.command&&s.command.isFirstExecution,v=(0,Ce.UFo)(n,d);return(0,Ce.RHc)({rangeTime:f,sheet:i,commandName:l,changesets:h,executeType:v},s.getPerformanceInfo()),i&&i.notifyShell(86,l),c}function Dre(e,t){var r=t.sheetId?e.getSheetFromId(t.sheetId):null,n=e.getActiveSheet();!t.isFirstExecution&&r&&r!==n&&(r.getHiddenStatus()||e.setActiveSheet(r.name(),!0))}function Pre(e,t,r,n,a){var o=r.sheetId,i=o?t.getSheetFromId(o):null;if(!r.isFirstExecution&&i){var u=null,s=[],l=["delRow","delCol","setRowHeight","setColumnWidth","setChart","setFloatImage","setFloatBlock","setDataRange"];switch(s.push((function(e){return!l.includes(e.action)})),e){case"clipboardPaste":case"formatPainter":case"addRowAndCol":l.push("addRow","addCol");break;case"dragDropRowCol":case"removeDuplication":case"fill":case"horizontalFill":case"verticalFill":case"fillRange":case"moveRowCol":case"addOutline":case"delOutline":case"updateOutline":return;case"moveRange":for(var c,h=n.length-1;h>=0;h--)if("setSpans"===n[h].action){c=h;break}s.push((function(e,t){return t===c}));break;case"replace":if("currentRanges"===r.scope)return}for(var f=0;f<n.length;f++){for(var d=n[f],v=!0,p=0;p<s.length;p++)if(!(0,s[p])(d,f)){v=!1;break}if(!0===v){var m=d.target;m&&(u=Xm(u,Qm(m)))}}if(u){var g=u,y=g.row,_=g.col,R=u,C=R.row_end,w=R.col_end;C=-1===C?i.getRowCount()-1:C,w=-1===w?i.getColumnCount()-1:w;var E=(C=Jm(C,i.getRowCount()-1))-y+1,k=(w=Jm(w,i.getColumnCount()-1))-_+1;k>0&&E>0&&(i.clearSelection(),i.setSelection(new ou(y,_,E,k,i)))}}}function $re(e,t,r,n,a,o){for(var i=!1,u=0;u<r.length;u++){var s=r[u];if(CT(e,s.rowFrom(),s.colFrom(),s.rowCount(),s.colCount())){i=!0;break}}(0,de.Z)(a)&&(a=JSON.stringify(a)),Ce.Ps3.collectSheetEvent("sheet_web_set_range_style_command_dev",{commandName:t,styleProp:n,intersectPivot:i,value:a,isLocal:o||!1})}!function(e){e[e.EmbedToFloat=0]="EmbedToFloat",e[e.FloatToEmbed=1]="FloatToEmbed"}(hre||(hre={}));var Lre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return!(this.command.isFirstExecution&&!this.produceChangesets())&&this._applyChangsetWithEvent(this.command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this.command._oldChangesets,!0)}},{key:"produceChangesets",value:function(){var e,t=this.command.commandType;return![hre.EmbedToFloat,hre.FloatToEmbed].every((function(e){return e!==t}))&&((e={},(0,l.Z)(e,hre.EmbedToFloat,this.createEmbedToFloatActions),(0,l.Z)(e,hre.FloatToEmbed,this.createFloatToEmbedActions),e)[t].bind(this)(),!0)}},{key:"createEmbedToFloatActions",value:function(){var e=this;this.command.data.forEach((function(t){var r=t.row,n=t.col,a=t.seg,o=t.isFormulaImage,i=a.width,u=a.height,s=a.link,l=a.fileToken;if(!s||l){var c=l,h=e._sheet.getCellHeight(r,n,!1),f=e.createFloatImageBlock({row:r,col:n,width:i||100,height:u||100,imageToken:c}),d=e.getCellValueAction(r,n).oldStyle;e.command._oldChangesets.push(o?e.getSetCellAction(e._sheet,r,n):e.getSetEmbedImageAction(r,n,a,d),e.getDelFloatImageAction(f.floatImageId)),e.command._changesets.push(e.getEmptyCellAction(r,n),e.getSetRowHeightAction(r,h),e.getSetFloatImageAction(r,n,f))}}))}},{key:"createFloatToEmbedActions",value:function(){var e=this,t=this.command.data,r=this._sheet.getFloatImageMap();t.forEach((function(t){var n,a,o=r[t],i=o.floatImageSetting,u=i.height,s=i.width,l=i.imageToken,c=o.floatImageSetting,h=c.row,f=c.col,d=e._sheet.getSpan(h,f);h=null!==(n=null==d?void 0:d.rowFrom())&&void 0!==n?n:h,f=null!==(a=null==d?void 0:d.colFrom())&&void 0!==a?a:f,delete o.floatImageSetting.zIndex;var v=e.getCellValueAction(h,f),p=v.oldValue,m=v.oldStyle;e._cellStyleAndValueToCS(h,f,p,m,!0),e.command._oldChangesets.push(e.getSetFloatImageAction(h,f,o)),e.command._changesets.push(e.getDelFloatImageAction(t),e.getSetEmbedImageAction(h,f,{height:u,width:s,text:"",link:Ce.Ps3.imageHelper.getDriveImageUrl(l,e._sheet.parent._context.getToken()),type:Ce.K6s.EMBED_IMAGE,fileToken:l},m))}))}},{key:"createFloatImageBlock",value:function(e){var t=e.row,r=e.col,n=e.width,a=e.height,o=e.imageToken,i=this._sheet.getCellWidth(t,r,!0),u=this._sheet.getCellHeight(t,r,!0),s=i,l=u;i/n*a>u?(l=u,s=u/a*n):(l=i/n*a,s=i),(0,E.Z)([l,s])<22&&(l<s?s=(l=22)*(n/a):l=(s=22)*(a/n));var c=qN.createDefault({sheet:this._sheet,imageToken:o,row:t,col:r,width:s,height:l});return delete c.sheetId,c}},{key:"getSetEmbedImageAction",value:function(e,t,r,n){return{action:"setCell",sheet_id:this._sheetId,target:{row:e,col:t},value:{formula:null,multipleValues:null,dataValidation:null,reminder:null,style:n.toJSON(),value:[r]}}}},{key:"getDelFloatImageAction",value:function(e){return{action:"delFloatImage",sheet_id:this._sheetId,value:{floatImageId:e}}}},{key:"getEmptyCellAction",value:function(e,t){return{action:"setRange",sheet_id:this._sheetId,value:{value:null,target:{row:e,col:t,rowCount:1,colCount:1,type:0}}}}},{key:"getCellValueAction",value:function(e,t){var r=this._sheet,n={},a=r.getMultipleValues(e,t),o=r.getStyleWithDropdown(e,t)||r.getDefaultStyle();return n.value=r.getSafeValue(e,t),n.formula=r.getFormula(e,t),n.reminder=r.getReminderChangeset(e,t),n.multipleValues=a?a.toJSON():null,n.dataValidation=r.getDataValidationJSON(e,t,{needDeepClone:!0}),{oldValue:n,oldStyle:o}}},{key:"getSetRowHeightAction",value:function(e,t){return{action:"setRowHeight",sheet_id:this._sheetId,target:{row:e,row_count:1},value:t}}},{key:"getSetFloatImageAction",value:function(e,t,r){return{action:"setFloatImage",sheet_id:this._sheetId,target:{row:e,col:t},value:r}}},{key:"commandName",get:function(){return Ce.rvF.CONVERT_IMAGE}}]),t}(Qte),Bre=function(e){function t(e,r,n){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"_doAction",value:function(){var e=this,t=this._sheet,r=this._command.data,n=!0;return r.forEach((function(r){var a=r.row,o=r.col;!0!==e.checkCellValid(t,a,o)&&(n=!1)})),n&&r.forEach((function(r){var a=r.row,o=r.col,i=r.newSegmentArray,u=t.getStyleWithDropdown(a,o);u=u?u.clone():t.getDefaultStyle().clone(),!0!==e._setCellValue(a,o,i,null,null,u)&&(n=!1)})),n&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"commandName",get:function(){return"convertLink"}}]),t}(Rre),Ure=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e){if(this._command.isFirstExecution){var t=e.getSheetFromId(this._command.copySheetId);if(!(e.blockManager&&t instanceof s2))return!1;if(!this._command.copyBlockData)return Ce.Ps3.moirae.teaLog({key:"client_sheet_block_data_undefined",command_name:Ce.rvF.COPY_BLOCK,value:""+this._command.copyBlockData}),!1;var r=e.getSheetIds(),n=(0,Ce.lYS)(r),a=Number(e.getSheetIndexFromId(this._command.copySheetId))+1,o=t.blockType,i=e.blockManager.createBlockId(),u=this._command.sheetName;u||(u=t.name()),null!==e.getSheetFromName(u)&&(u=this.getSheetNoConflictName(e,u,cr("sheet.copy_item"))),this._command._oldChangesets=[{action:"delBlock",sheet_id:n,value:{sheet_name:u,index:a,block_type:o,block_id:i,block_token:""}}],this._command._changesets=[{action:"addBlock",sheet_id:n,value:{sheet_id:n,sheet_name:u,index:a,block_type:o,block_id:i,block_token:"",block_data:this._command.copyBlockData}}]}var s=this._applySpreadChangsetWithEvent(e,this._command._changesets,!0);return s&&e.setActiveSheetIndex(this._command._changesets[0].value.index,!0),s}},{key:"undo",value:function(e){return tre(e,this._command,this._applySpreadChangsetWithEvent)}},{key:"canUndo",value:function(e){var t=this._command._changesets[0].sheet_id,r=e.getSheetFromId(t);return Boolean(r&&r.blockToken)}},{key:"commandName",get:function(){return Ce.rvF.COPY_BLOCK}}]),t}(Qte);var Hre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e){return!(this._command.isFirstExecution&&!this.generateActions(e))&&this._doAction(e)}},{key:"undo",value:function(e){var t=this._command._changesets,r=e.getSheetFromId(this._command.copySheetId);if(r&&t.length>0){var n=t[0],a=Ce.Ps3.getCopySheetWithMutation()?this.getMutation(r):this.getSnapshot(r);n.value=Object.assign({},n.value,{snapshot:a})}return this._changesetsToAction(e,this._command._oldChangesets,"undo"),!0}},{key:"generateActions",value:function(e){var t=e.getSheetFromId(this._command.sheetId);if(!t)throw new Error("sheet not found");var r=t.name(),n=e.getSheetIndex(r);if((0,w.Z)(n))throw new Error("sheetIndex is null");var a=this._command.copySheetId,o=e.getSheetIds();return a&&!o.includes(a)||(a=(0,Ce.lYS)(o),this._command.copySheetId=a),void 0===this._command.copySheetName&&(this._command.copySheetName=this._getDefaultCopySheetName(e,r)),this._command.copySheetIndex=n+1,!!this._saveChangesets(e)&&!0===this.checkRangeValid(e,this._command._changesets)}},{key:"_doAction",value:function(e){return this._changesetsToAction(e,this._command._changesets),e.setActiveSheetIndex(this._command.copySheetIndex,!0),!0}},{key:"_saveChangesets",value:function(e){return this._actionToChangesets(e)}},{key:"getCopySheetChangeset",value:function(e){var t=this._command,r=t.sheetId,n=t.copySheetId,a=t.copySheetName,o=t.copySheetIndex,i=t.gzipMutation;if(Ce.Ps3.getCopySheetWithMutation()){var u={action:"copySheetMutation",sheet_id:r,value:{sheet_id:n,sheet_name:a,snapshot:this.getMutation(e),index:o}};return i&&(0,Ce.jof)(u),u}return{action:"copySheet",sheet_id:r,value:{sheet_id:n,sheet_name:a,snapshot:this.getSnapshot(e),schemaVersion:1,index:o}}}},{key:"_actionToChangesets",value:function(e){var t=this._command,r=t.sheetId,n=t.copySheetId,a=t.copySheetName,o=t.copySheetIndex,i=e.getSheetFromId(r);if(!i)return!1;var u=this.getCopySheetChangeset(i);return this._command._changesets.push(u),this._command._oldChangesets.push({action:"delSheet",sheet_id:n,value:{sheet_name:a,index:o}}),!0}},{key:"_changesetsToAction",value:function(e,t,r){return this._applySpreadChangsetWithEvent(e,t,!0,r)}},{key:"getMutation",value:function(e){var t=this._command,r=t.copySheetId,n=t.copySheetName,a=t.copySheetIndex,o=t.customFloatBlocks,i=t.customEmbedBlocks,u=e.parent,s={startRow:0,startCol:0,endCol:e.getColumnCount(),endRow:e.getRowCount(),sheetId:e.id()},l=u.serializeWorksheet(e,a,{customSheetId:r,customSheetName:n,gridRanges:[s],customFloatBlocks:o,customEmbedBlocks:i,ignoreComment:!0,ignoreProtection:!0,customSheetVisible:!0});return(0,Ce.iWc)(l)}},{key:"getSnapshot",value:function(e){var t=this._command,r=t.copySheetId,n=t.copySheetName,a=see(e.toJSON({chart:{customSheetId:r}},!1));a.id=r,a.name=n;var o=a.floatImageMap,i=a.dataRanges,u=a.conditionalFormats;if(o&&function(e,t){Object.keys(e).forEach((function(r){var n=(0,Ce.zsn)(10),a=e[r];a.sheetId=t,a.floatImageId=n,e[n]=a,delete e[r]}))}(o,r),i){var s={};Object.keys(i).forEach((function(e){var t=i[e],n=e.split("_"),a=(0,g.Z)(n,2)[1];s["".concat(r,"_").concat(a)]=t})),a.dataRanges=s}var l=this._command.customFloatBlocks;l&&(Object.keys(l).forEach((function(e){l[e].sheetId=r})),a.floatBlocks=l);var c=this._command.customEmbedBlocks;return c&&(a.embeddedBlocks=c),u&&u.forEach((function(e){e.cfId=(0,Ce.zsn)(Ce.w8i)})),a}},{key:"_getDefaultCopySheetName",value:function(e,t){return this.getSheetNoConflictName(e,t,cr("sheet.copy_item"))}},{key:"commandName",get:function(){return Ce.rvF.COPY_SHEET}}]),t}(Qte);function zre(e,t,r,n){var a=null;if(t&&T_(t))r&&A_(r)&&O_(t)&&(a=e.getFirstItem());else{var o=(null==n?void 0:n.formatter)||null;a=e.mergeToSingleValue({formatter:o})}return a}var Wre,Gre=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))).updateSetRangeValueOptionsWithMultipleValues=function(e,t){var r,a=n._sheet,o=a.getMultipleValues(e,t);if(o){var i=n.dataValidation,u=a.getDataValidation(e,t),s=a.getCellStyle(e,t),l=zre(o,i,u,s);r={},n.updateCellValueWithSingleValue(r,l,s)}return r},n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"commandName",get:function(){return Ce.rvF.SET_DATA_VALIDATION}}]),(0,_.Z)(t,[{key:"execute",value:function(){this._beforeAction(this._sheet);var e=this.command.isFirstExecution?this._doActions():this._redoActions();return this._afterAction(this._sheet),e}},{key:"_doActions",value:function(){var e=this.command,t=e.activeCell,r=e.needApplyToAll,n=e._changesets,a=e.dataValidationJSON,o=e.allowUserApplyAll,i=e.selections,u=e.source;this.dataValidation=a?Ey(a,this._sheet):null;var s=this.filterDuplicateRange(i,!1),l=s;if(r){var c=this._sheet.getDataValidation(t.row,t.col);if(this.shouldApplyToAll(c)){var h=V_(this._sheet,c,s);l=s.concat(h)}a&&o&&u&&Ce.Ps3.collectSuiteEvent("sheet_opration",{action:"valid_apply_all",source:u,valid_type:I_(a)?"list_single":"list_multiple",op_item:s.length!==l.length?"true":"false",attr_op_status:r?"effective":"cancel"})}return this.setDataValidationRangeValues(l),this.saveExtendFilterRangeActions(s),this.tryApplyActions(this._sheet.parent,n,!0,!0)}},{key:"_redoActions",value:function(){return this.tryApplyActions(this._sheet.parent,this.command._changesets,!0,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this.command._oldChangesets,!0)}},{key:"shouldApplyToAll",value:function(e){return null!==e}},{key:"setDataValidationRangeValues",value:function(e){var t=this,r=this._sheet,n={ignoreValue:!0,ignoreFormulaData:!0,ignoreDataValidation:!1,ignoreReminder:!0,ignoreMultipleValues:!0,ignorePivotTable:!0,ignoreStyle:!0};e.forEach((function(e){var a=e.toJSON(),o=K8(r,a,{},J8);t._setRangeValuesActionToChangeset(o,!0);var i=K8(r,a,n,t.processCellSetRangeValue.bind(t),(function(e,r){e.dataValidationId=t.dataValidation?r.dvJSONRefMgr.getValidationId(t.dataValidation):null}));t._setRangeValuesActionToChangeset(i)}))}},{key:"updateCellValueWithSingleValue",value:function(e,t,r){if(t){var n=t.segmentArray,a=t.variant,o=t.autoFormatter;if(e.value=n||(a?a.getValue():null),o&&!(0,Ee.isDefaultFormatter)(o)){var i=this._sheet,u=Om.withAutoFormatter(r||i.getDefaultStyle(),o);e.style=u.toJSON()||null}}}},{key:"processCellSetRangeValue",value:function(e,t,r,n){var a,o,i=this._sheet,u=this.updateSetRangeValueOptionsWithMultipleValues(e,t);r.ignoreValue=void 0===(null===(a=u)||void 0===a?void 0:a.value),r.ignoreStyle=void 0===(null===(o=u)||void 0===o?void 0:o.style),r.ignoreReminder=r.ignoreValue,r.ignoreReminder||((u=u||{}).reminder=null),r.cellValue=u,X8(e,t,i,n,r)}},{key:"saveExtendFilterRangeActions",value:function(e){}}]),t}(Qte),jre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"processCellSetRangeValue",value:function(e,r,n,a){if(null===this.dataValidation){var o=this._sheet,i=this._sheet.getDataValidation(e,r);return i&&w_(i)?(n.ignoreDataValidation=!1,n.dataValidationId=null):(n.ignoreDataValidation=!0,n.dataValidationId=void 0),void X8(e,r,o,a,n)}(0,f.Z)((0,v.Z)(t.prototype),"processCellSetRangeValue",this).call(this,e,r,n,a)}},{key:"commandName",get:function(){return Ce.rvF.SET_DATE_TIME_VALIDATION}}]),t}(Gre),Yre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"saveExtendFilterRangeActions",value:function(e){if(0!==e.length){var t=this._sheet,r=cp(t,e),n=r.actions,a=r.oldActions;(0,Ce.hTd)(this._command._changesets,n),(0,Ce.hTd)(this._command._oldChangesets,a)}}},{key:"processCellSetRangeValue",value:function(e,t,r,n){var a=this._sheet,o=this.command.dataValidationJSON,i=!1,u=(0,g.Z)(o.formulas,2),s=u[0],l=u[1],c=a.getImmutableContent(e,t);if(null!=c&&c.multipleValues)i=!0;else if(null!=c&&c.segmentArray)i=!0;else{var h=null==c?void 0:c.variant,f=h?h.getValue():null;f!==s&&f!==l&&(i=!0)}if(r.ignoreStyle=!0,r.cellValue=void 0,r.ignoreValue=!i,r.ignoreReminder=!i,i){var d={value:l,reminder:null},v=a.getCellStyle(e,t);if(null!=v&&v.autoFormatter){r.ignoreStyle=!1;var p=Om.withAutoFormatter(v,void 0);d.style=p.toJSON()||null}r.cellValue=d}X8(e,t,a,n,r)}},{key:"commandName",get:function(){return Ce.rvF.SET_CHECKBOX_VALIDATION}}]),t}(Gre),qre=function(){function e(t,r){(0,y.Z)(this,e),this.sheet=r;var n=t.content;this._multipleValues=n?n.multipleValues:null,this._segmentArray=n?n.segmentArray:null,this._variant=n?n.variant:null,this._style=t.style,this._reminder=t.reminder}return(0,_.Z)(e,[{key:"setValue",value:function(e){Array.isArray(e)?this.setSegmentArray(e):"number"==typeof e?this.setVariant(new it.NumberVar(e)):"string"==typeof e?this.setVariant(new it.StringVar(e)):this.clearContent()}},{key:"getValue",value:function(){return null!==this._segmentArray?this._segmentArray:null!==this._variant?this._variant.getValue():null}},{key:"getMultipleValues",value:function(){return this._multipleValues}},{key:"setMultipleValues",value:function(e){var t;this._multipleValues=e;var r=(null===(t=this._style)||void 0===t?void 0:t.formatter)||null,n=this.sheet.parent.userLanguage,a=this._multipleValues.mergeToSingleValue({formatter:r}),o=a.segmentArray,i=a.variant;o?(this._segmentArray=o,this._variant=new Og(this.sheet.parent,o).getVar(n)):(this._segmentArray=null,this._variant=i||null)}},{key:"getSegmentArray",value:function(){return this._segmentArray}},{key:"setSegmentArray",value:function(e){this._multipleValues=null,this._segmentArray=e,this._variant=new Og(this.sheet.parent,e).getVar(this.sheet.parent.userLanguage)}},{key:"getVariant",value:function(){return this._variant}},{key:"setVariant",value:function(e){this._multipleValues=null,this._segmentArray=null,this._variant=e}},{key:"getStyle",value:function(){return this._style}},{key:"setStyle",value:function(e){this._style=e}},{key:"getReminder",value:function(){return this._reminder}},{key:"setReminder",value:function(e){this._reminder=e}},{key:"getImmutableContent",value:function(){return null===this._multipleValues&&null===this._segmentArray&&null===this._variant?null:new fC(this._segmentArray,this._variant,this._multipleValues)}},{key:"clearContent",value:function(){this._multipleValues=null,this._segmentArray=null,this._variant=null}}]),e}(),Jre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"shouldApplyToAll",value:function(e){return Boolean(e&&T_(e))}},{key:"processCellSetRangeValue",value:function(e,t,r,n){var a,o,i,u=this._sheet;r.cellValue=void 0,r.ignoreStyle=!0,r.ignoreValue=!0,r.ignoreMultipleValues=!0;var s=u.getDataValidation(e,t);if(!(this.command.dataValidationJSON||s&&T_(s)))return r.ignoreDataValidation=!0,void X8(e,t,u,n,r);r.ignoreDataValidation=!1;var l=new qre({content:u.getImmutableContent(e,t),style:u.getCellStyle(e,t),reminder:u.getReminder(e,t)},u),c=this.updateCurCellText(l),h=!0,f=!0,d=!0;c&&(h=(a=c).ignoreMultipleValues,f=a.ignoreStyle,d=a.ignoreValue);var v,p=!!c,m=l.getMultipleValues();if(m){var g=this.dataValidation,y=l.getStyle(),_=zre(m,g,s,y);if(_){p=!0;var R=_.segmentArray,C=_.variant,w=_.autoFormatter;if(R?l.setSegmentArray(R):C?l.setVariant(C):l.clearContent(),d=!1,w&&!(0,Ee.isDefaultFormatter)(w)){var E=Om.withAutoFormatter(y||u.getDefaultStyle(),w);l.setStyle(E),f=!1}}}p&&(v={},d||(v.value=l.getValue(),r.ignoreValue=!1),h||(v.multipleValues=(null===(o=l.getMultipleValues())||void 0===o?void 0:o.toJSON())||null,r.ignoreMultipleValues=!1),f||(v.style=(null===(i=l.getStyle())||void 0===i?void 0:i.toJSON())||null,r.ignoreStyle=!1)),r.ignoreReminder=r.ignoreValue,r.ignoreReminder||((v=v||{}).reminder=null),r.cellValue=v,X8(e,t,u,n,r)}},{key:"updateCurCellText",value:function(e){var t=this.command.cellTextUpdateMap;if(t&&0!==Object.keys(t).length){var r=e.getMultipleValues();return r?this.updateTextOfMultipleValues(e,t,r):this.updateTextOfSingleValue(e,t)}}},{key:"updateTextOfMultipleValues",value:function(e,t,r){for(var n,a=this._sheet,o=null===(n=e.getStyle())||void 0===n?void 0:n.formatter,i=r.clone(),u=!1,s=0;s<r.length;++s){var l=r.get(s),c=l.segmentArray,h=l.variant,f=l.autoFormatter,d=t[My(a.parent,{segmentArray:c,variant:h},{formatter:o||f||null})];null!=d&&(i.set(s,i.stringToMultipleValue(d,o)),u=!0)}return u&&e.setMultipleValues(i),{ignoreMultipleValues:!u,ignoreValue:!0,ignoreStyle:!0}}},{key:"updateTextOfSingleValue",value:function(e,t){var r,n=this._sheet,a=n.parent,o=e.getReminder(),i=e.getStyle(),u=rM(o,i,e.getImmutableContent(),n,!1),s=t[My(a,{segmentArray:e.getSegmentArray(),variant:e.getVariant()},{formatter:u})],l=null;if(null!=s){var c=null==i?void 0:i.formatter;if(l=ca(a.formatterService,{formatter:c},s,!1)){var h=l.autoFormatter;if(h){var f=Om.withAutoFormatter(i||n.getDefaultStyle(),h);e.setStyle(f)}e.setValue(l.value)}}return{ignoreValue:!l,ignoreStyle:!(null!==(r=l)&&void 0!==r&&r.autoFormatter),ignoreMultipleValues:!0}}},{key:"commandName",get:function(){return Ce.rvF.SET_LIST_DATA_VALIDATION}}]),t}(Gre),Kre=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e){var t=this._command.sheetId,r=e.getSheetFromId(t);return!!(r&&r.blockId&&r.blockToken)&&(this._command._oldChangesets=[{action:"restoreBlock",sheet_id:t,value:{sheet_id:t,sheet_name:r.name(),index:Number(e.getSheetIndex(r.name())),block_type:r.blockType,block_id:r.blockId,block_token:r.blockToken}}],this._command._changesets=[{action:"delBlock",sheet_id:t,value:{sheet_name:r.name(),index:Number(e.getSheetIndex(r.name())),block_type:r.blockType,block_id:r.blockId,block_token:r.blockToken}}],this._applySpreadChangsetWithEvent(e,this._command._changesets,!0))}},{key:"undo",value:function(e){return this._applySpreadChangsetWithEvent(e,this._command._oldChangesets,!0)}},{key:"canUndo",value:function(e){var t=this._command._changesets[0].sheet_id;if(e.getSheetFromId(t))return!1;if(e.sheets.filter((function(e){return e.blockType===Ce.kHU.DOCX_BLOCK})).length){var r=this._command._oldChangesets.some((function(e){return e.value.block_type===Ce.kHU.DOCX_BLOCK}));return r&&e.dispatch("LimitDocx"),!r}return!0}},{key:"commandName",get:function(){return Ce.rvF.DEL_BLOCK}}]),t}(Qte),Xre=function(e){function t(e,r,n){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e){return!(this._command.isFirstExecution&&!this.generateActions(e))&&this._doAction(e)}},{key:"undo",value:function(e){var t=this,r=this._command,n=e.sheets.map((function(e){return e.name()}));return r._oldChangesets=r._oldChangesets.map((function(r){if(!(0,Ce._8D)(r))return r;var a=r.value.sheet_name;return-1!==n.indexOf(a)&&(r.value.sheet_name=t.getSheetNoConflictName(e,a,cr("sheet.conflict"))),r})),this._changesetsToAction(e,this._command._oldChangesets,"undo"),!0}},{key:"generateActions",value:function(e){return this._saveChangesets(e),this.checkRangeValid(e,this._command._changesets)}},{key:"_doAction",value:function(e){return this._changesetsToAction(e,this._command._changesets),!0}},{key:"_saveChangesets",value:function(e){return this._actionToChangesets(e)}},{key:"_actionToChangesets",value:function(e){var t=this._command.sheetId,r=e.getSheetFromId(t);if(!r)throw new Error("sheet not found");var n=r.name(),a=e.getSheetIndex(n);if((0,w.Z)(a))throw new Error("sheetIndex is null");if(this._command._changesets.push({action:"delSheet",sheet_id:t,value:{sheet_name:n,index:a}}),Ce.Ps3.getCopySheetWithMutation()){var o=(0,Ce.iWc)(e.serializeWorksheet(r,a)),i={action:"copySheetMutation",sheet_id:r.id(),value:{sheet_id:r.id(),sheet_name:r.name(),index:a,snapshot:o}};this._command._oldChangesets.push(i)}else{var u=r.toJSON(void 0,!1),s={action:"copySheet",sheet_id:u.id,value:{sheet_id:u.id,sheet_name:u.name,index:a,snapshot:u,schemaVersion:1}};this._command._oldChangesets.push(s)}return this.saveConditionalFormatActions(e,r),!0}},{key:"_changesetsToAction",value:function(e,t,r){return this._applySpreadChangsetWithEvent(e,t,!0,r)}},{key:"canUndo",value:function(e){return!0===this.checkRangeValid(e,this._command._oldChangesets)}},{key:"saveConditionalFormatActions",value:function(e,t){if(e&&t){var r=t.id(),n=t.conditionalFormatModel.helper.getAdjustedRulesByDelSheet(r,e);this.setConditionalFormatChangeSet(n,e)}}},{key:"setConditionalFormatChangeSet",value:function(e,t){var r=this;e.size<=0||e.forEach((function(e,n){e.forEach((function(e){var a=t.getSheetFromId(n),o=e.cfId,i=void 0===o?null:o,u=e.attrs,s=void 0===u?null:u;if(a&&i){var l=p6(a,i);if(l){var c=Object.assign({},l);null!==s&&(c.attrs=s);var h=g6(a,i,c);h&&((0,Ce.hTd)(r._command._changesets,h.actions),(0,Ce.hTd)(r._command._oldChangesets,h.oldActions))}}}))}))}},{key:"commandName",get:function(){return Ce.rvF.DELETE_SHEET}}]),t}(Qte),Qre=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets)}},{key:"doAction",value:function(){return this._saveChangeSets(),this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_saveChangeSets",value:function(){var e=this._sheet,t=this.command.target;if(t.type===Ce.xj7.ROW||t.type===Ce.xj7.COL){var r=sre(e.id(),t),n=this.generateDelOutlineOldCs();this._command._changesets.push(r),(0,Ce.hTd)(this._command._oldChangesets,n)}}},{key:"generateDelOutlineOldCs",value:function(){for(var e=this._sheet,t=this.command.target,r=t.type,n=[],a=e.outlineGroupModel,o=$u(a.getInfluencedOutlines(t),t),i=[],u=0;u<o.length;u++){var s=o[u];0!==a.getInfluencedOutlines(xu(t.type,s)).length&&i.push(s)}for(var l=0;l<i.length;l++)for(var c=i[l],h=l+1;h<i.length;h++){var f=i[h];1!==f[2]&&1!==c[2]&&c[0]+c[1]===f[0]&&(c[1]+=f[1],f[2]=1)}for(var d=0;d<i.length;d++){var v=[i[d][0],i[d][1]];if(1!==i[d][2]){var p=a.getBeInludedOutlines(xu(r,v)).sort((function(e,t){return t.count-e.count}));if(0===p.length)continue;var m=p[0],g=m.state,y=[m.start,m.count];n.push(ire(e.id(),r,y,g)),i[d][2]=2;var _=Fu(v,y);bu(_[0])&&i.push(_[0]),_[1]&&bu(_[1])&&i.push(_[1])}}return i.filter((function(e){return!e[2]})).forEach((function(t){n.push(ire(e.id(),r,t,Ce.w2y.Expand))})),n}},{key:"commandName",get:function(){return Ce.rvF.DEL_OUTLINE}}]),t}(Qte),ene=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){var e=this._sheet;if(this._command.isFirstExecution&&!this._saveChangesets())return!1;if(!this.checkRangeValid(e.parent,this._command._changesets))return!1;var t=this._applyChangsetWithEvent(this._command._changesets,!0);return this._afterAction(e),t}},{key:"_saveChangesets",value:function(){var e=this._command.value,t=e.viewName,r=e.viewId;this._command._changesets=[(0,Ce.h_E)(this._sheetId,{view_id:r,name:t}),(0,Ce.YY8)(this._sheetId)];var n=function(e,t){var r=function(e,t){var r=e.viewsModel.getViewById(t);return r&&r.getFilterModel()}(e,t),n=r&&r.getInfo();if(!n)return null;var a=n.range.toJSON(),o=[];return o.push((0,Ce.eRv)(e.id(),{view_id:t,range:Iv(a),calculate:!0})),(0,m.Z)(r.getValidFilterRules()).forEach((function(r){var n=(0,g.Z)(r,1)[0],i=e.filterModel.getFilterInfo(n);i&&o.push((0,Ce.eRv)(e.id(),{view_id:t,range:Iv(a),filter_value:Object.assign({},i),calculate:!0}))})),o}(this._sheet,r)||[];return this._command._oldChangesets=[(0,Ce.VCn)(this._sheetId,{view_id:r,name:t})].concat((0,m.Z)(n),[(0,Ce.fdi)(this._sheetId,r)]),!0}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_afterAction",value:function(e){(0,f.Z)((0,v.Z)(t.prototype),"_afterAction",this).call(this,e),e.dispatch("FilterChanged")}},{key:"commandName",get:function(){return Ce.rvF.DEL_VIEW}}]),t}(Qte),tne=function(e){function t(e,r,n){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"_conditionalFormatToChangeset",value:function(e){var t=d6(this._sheet,e);t&&t.actions&&t.oldActions&&((0,Ce.hTd)(this._command._changesets,t.actions),(0,Ce.hTd)(this._command._oldChangesets,t.oldActions))}},{key:"_doClearRange",value:function(e){var t=this,r=this._sheet;if(!y6(r,this._command.ranges,void 0,!0))return!1;for(var n=new Set,a={ignoreValue:!1,ignoreFormulaData:!0,ignoreDataValidation:!0,ignoreReminder:!0,ignoreMultipleValues:!0,ignorePivotTable:!0,styleId:null},o=0;o<e.length;o++){var i=e[o],u=r.getSpans(i);u.length>0&&(this._spanToChangeset(i,u,!0),this._spanToChangeset(i,null));var s=this.splitSelectionByFilterRow(i),l=[];this.checkRangeDuplicate(s,n,l,e),l.forEach((function(e){t._rangeOpToChangeset(e,{style:null});var n=K8(r,e.toJSON(),a,q8);t._setRangeValuesActionToChangeset(n,!0)}))}return this._conditionalFormatToChangeset(e),!0}},{key:"_doAction",value:function(){var e=this._command.ranges||this._sheet.getSelections();return!!this._doClearRange(e)&&!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){var e=this._command._oldChangesets;return this._applyChangsetWithEvent(e)}},{key:"commandName",get:function(){return Ce.rvF.DO_CLEAR}}]),t}(Qte),rne=function(e){if(!(e instanceof Object))return e;var t=e;if(t.hasOwnProperty("refCount")){var r=t;r.refCount;t=(0,s.Z)(r,gr)}return"mention"===e.type&&(t=function(e){var t={};return Object.keys(e).forEach((function(r){var n=e[r];void 0!==n&&(t[r]=n)})),t}(t)),t},nne=function(e){if(!(e instanceof Object))return e;var t={};return Object.keys(e).forEach((function(r){var n=e[r];void 0!==n&&(t[r]=rne(n))})),t},ane=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"canExecute",value:function(){var e=this._sheet,t=this._command,r=t.row,n=t.col;return!!e._canChange(r,n,1,1)}},{key:"undo",value:function(){var e=this._sheet,t=this._command,r=!1;this._beforeAction(e,!0);try{if(r=this._applyChangsetWithEvent(this._command._oldChangesets,!0,"undo"),this._command._changesets.length<1)return!0;var n=this._command._changesets[0].value.value,a=this._command._oldChangesets[0].value.value;e._raiseValueChanged(t.row,t.col,n,a,t.from,"UNDO")}finally{this._afterAction(e,!0)}return r}},{key:"_doAction",value:function(){var e=!1,t=this._command;if(t._canExecute=this.canExecute(),t._canExecute){var r=this._sheet;this._beforeAction(r,!0);try{var n=this.generateActions();if(!this._command._oldChangesets.length||!this._command._changesets)return!1;var a=this._command._oldChangesets[0].value,o=this._command._changesets[0],i=o.value;if(!this.isValueChanged(i,a))return!1;if("NO_VERSION"===this._command.from&&(o.no_history=!0,o.extra={commandType:"dataConnectorSetMention"}),this._command._canUndo=n,n){var u=i.value,s=a.value;e=this._applyChangsetWithEvent(this._command._changesets,!0),r._raiseValueChanged(t.row,t.col,s,u,t.from,"DO")}}finally{this._afterAction(r,!0)}}return e}},{key:"generateActions",value:function(){var e=this._applyEditing();return!1!==e&&e}},{key:"_redoAction",value:function(){var e=this._sheet,t=this._command,r=!1;if(t._canExecute){if(!0!==this.checkRangeValid(this._sheet.parent,this._command._changesets))return!1;this._beforeAction(e,!0);try{if(this._command._changesets.length<1)return!0;var n=this._command._changesets[0].value.value,a=this._command._oldChangesets[0].value.value;r=this._applyChangsetWithEvent(this._command._changesets,!0,"redo"),e._raiseValueChanged(t.row,t.col,a,n,t.from,"REDO")}finally{this._afterAction(e,!0)}}return r}},{key:"_applyEditing",value:function(){var e=this._sheet,t=this._command,r=t.newSegmentArray,n=t.newValue;n=(0,Ce.ATv)(n);var a=t.row,o=t.col,i=e.getSpan(a,o);if(i&&(i.rowFrom()!==a||i.colFrom()!==o))return!1;var u=void 0===t.autoFormat||t.autoFormat,s=_g._getValueAndStyleFromEditing(e,a,o,n,u),l=s.value,c=s.styleWithDropdown;if(n&&"string"==typeof n&&["=","+"].includes(n[0])&&c.formatter&&(0,Ee.isTextFormatter)(c.formatter))return this._setCellValue(a,o,l,null,null,c,null,void 0,!0),!0;var h=mee(a,o,e,n);if(h.isFormula){var f=h.formulaVar;if(!f)return!1;if(dv(f)&&e.getParent().importRangeManager.isImportRangeNumExceedLimit())return Ce.Ps3.Toast.error({key:"crossTableError_num",closable:!0,content:cr("CreationDoc_Sheets_ImportrangeToLimit",Ce.Ps3.getSheetImportRangeCountLimit())}),!1;(function(e){return fv(e,"QUERY")})(f)&&Ce.Ps3.ccmEventTracking("ccm_sheet_content_page_click",{click:"change_formula_data_range",target:"none",formula_name:"QUERY",query_key:JSON.stringify({select:BG(n,"SELECT"),where:BG(n,"WHERE"),pivot:BG(n,"PIVOT"),"group by":BG(n,"GROUP BY"),"order by":BG(n,"ORDER BY")}),formula_type:"lookup",change_method:"move"});var d=h.text,v=e.getStyleWithDropdown(a,o)||Mm();if(!v.formatter){var p=(0,Ee.createFormatter)(e.parent.formatterService);v=Om.withAutoFormatter(v,p)}return this._setCellValue(a,o,null,d,f,v,null,void 0,!dv(f)),!0}if(n!==h.text){n=h.text;var m=_g._getValueAndStyleFromEditing(e,a,o,n,u);l=m.value,c=m.styleWithDropdown}if(!h.isFormula&&Array.isArray(r)&&r.length){var g=!0,y="number"==typeof l;if(y){for(var _=null,R=0;R<r.length;R++){var C=r[R];C.type!==Ce.K6s.TEXT&&C.type!==Ce.K6s.URL&&(g=!1),_||C.type!==Ce.K6s.URL||(_=C)}g&&_&&r.length>1&&(l=[{type:Ce.K6s.URL,text:String(l),link:_.link,cellPosition:_.cellPosition,visited:_.visited}])}if(!y||!g){var w=pR(r,c,e);c=w.style,l=w.value}if(y&&1===r.length){var E=pR(r,c,e);r[0].type===Ce.K6s.TEXT&&(c=E.style),r[0].type===Ce.K6s.URL&&(c=E.style,l=E.value)}}var k=this.getReminderWithCellValue(l,a,o);return this._setCellValue(a,o,l,null,null,c,k,void 0,!0),!0}},{key:"getReminderWithCellValue",value:function(e,t,r){var n=this._sheet.getReminder(t,r);if(!n||!cn(e))return null;var a=zC.fromReminder(n);return a.setExpireTime(xC(e)),a}},{key:"canUndo",value:function(){return(0,f.Z)((0,v.Z)(t.prototype),"canUndo",this).call(this)&&this._command._canUndo}},{key:"isValueChanged",value:function(e,t){var r=this.command,n=r.row,a=r.col;return!(!e.formulaData&&this._sheet.isProxyArrayFormula(n,a)&&null===t.value&&this._sheet.getValue(n,a)===e.value||(0,me.default)(nne(e.value),nne(t.value))&&this.isEqualStyle(e.style||null,t.style||null)&&e.formula===t.formula&&(0,me.default)(e.formulaData,t.formulaData))}},{key:"isEqualStyle",value:function(e,t){if(e===t)return!0;var r,n,a=this._sheet,o=a.getParent();return r=null===e?a.getDefaultStyle():Om.fromJSON(o.formatterService,e),n=null===t?a.getDefaultStyle():Om.fromJSON(o.formatterService,t),r.equals(n,!1)}},{key:"commandName",get:function(){return"editCell"}}]),t}(Rre),one=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){var e=this._sheet;if(this._command.isFirstExecution&&!this._saveChangesets())return!1;var t=this._applyChangsetWithEvent(this._command._changesets,!0);return this._afterAction(e),t}},{key:"_saveChangesets",value:function(){var e=this._command,t=e.sheetId,r=e.value.view_id,n=this._sheet.viewsModel.activeView;return this._command._oldChangesets=[n?(0,Ce.fdi)(t,n.getId()):(0,Ce.YY8)(t)],this._command._changesets=[(0,Ce.fdi)(t,r)],!0}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_afterAction",value:function(e){(0,f.Z)((0,v.Z)(t.prototype),"_afterAction",this).call(this,e),e.dispatch("FilterChanged")}},{key:"commandName",get:function(){return Ce.rvF.ENTER_VIEW}}]),t}(Qte),ine=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){var e=this._sheet;if(this._command.isFirstExecution&&!this._saveChangesets())return!1;if(!0!==this.checkRangeValid(e.parent,this._command._changesets))return!1;var t=this._applyChangsetWithEvent(this._command._changesets,!0);return this._afterAction(e),t}},{key:"_saveChangesets",value:function(){var e=this._command.sheetId,t=this._sheet.viewsModel.activeView;return t&&(this._command._oldChangesets=[(0,Ce.fdi)(e,t.getId())]),this._command._changesets=[(0,Ce.YY8)(e)],!0}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_afterAction",value:function(e){(0,f.Z)((0,v.Z)(t.prototype),"_afterAction",this).call(this,e),e.dispatch("FilterChanged")}},{key:"commandName",get:function(){return Ce.rvF.EXIT_VIEW}}]),t}(Qte);!function(e){e[e.Normal=1]="Normal",e[e.InoperativeSpanCell=2]="InoperativeSpanCell",e[e.OperativeSpanCell=3]="OperativeSpanCell"}(Wre||(Wre={}));var une=function(e){function t(e,r){var n;(0,y.Z)(this,t),n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r));var a=r.startRange,o=r.fillRange;return n._wholeFillRange=a,o&&(n._wholeFillRange=a.union(o)),n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"canExecute",value:function(){var e=this._command,t=e.startRange,r=e.fillRange;if(!this._sheet._canChange(r.rowFrom(),r.colFrom(),r.rowCount(),r.colCount()))return!1;if(this.isHorizontalFill){if(t.rowFrom()!==r.rowFrom()||t.rowCount()!==r.rowCount())return!1}else if(t.colFrom()!==r.colFrom()||t.colCount()!==r.colCount())return!1;return!r.isIntersect(t)}},{key:"redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"doAction",value:function(){if(!this.canExecute())return!1;var e=this._sheet,t=this._command.fillRange,r=this._collRangeInfo(e,t);return this.saveChangesets(r,!0),this._beforeAction(e,!0),this._executeFill(),this._afterAction(this._sheet,!0),this.extendFilterRange([t]),!!this.checkRangeValid(e.parent,this.command._changesets,!0)&&(this._applyChangsetWithEvent(this.command._changesets),!0)}},{key:"collectEvent",value:function(){var e=this._sheet,t=this.command.startRange;(function(e,t){null!==e.iterReminder(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()).next()&&Ce.Ps3.collectSuiteEvent("sheet_opration",{action:"add_reminder",source:"fill"})})(e,t),function(e,t){var r=t.rowFrom(),n=t.colFrom(),a=t.rowCount(),o=t.colCount(),i=!1,u=!1,s=!1,l=!1,c=!1,h=!1,f=!1,d=!1,v=0,p=[];e.iterDropdown(r,n,a,o).forEach((function(e){u=!0,e.isEnableOptionColor?f=!0:d=!0})),e.iterDataValidation(r,n,a,o).forEach((function(e){switch(e.type){case"list":case"listFromRange":e.options.supportMultipleValues?s=!0:u=!0,e.options.shouldHighlightValidData?f=!0:d=!0;break;case"checkbox":i=!0;break;case"date":c=!0;break;case"textLength":h=!0;break;case"number":l=!0}v++})),l&&p.push("number"),c&&p.push("date"),h&&p.push("text_length"),i&&p.push("checkbox"),u&&p.push("list_single"),s&&p.push("list_multiple"),m_(i,u,s,f,d,"fill",v,p.join("-"))}(e,t),function(e,t){var r=t.rowFrom(),n=t.colFrom(),a=t.rowCount(),o=t.colCount();e._getModel().iterContent(r,n,a,o).forEach((function(e){if(e&&e.segmentArray){var t=!1;e.segmentArray.forEach((function(e){(0,Ce.S3_)(e)&&(t=!0)})),t&&Ce.Ps3.collectSuiteEvent("sheet_opration",{action:"upload_attachment",source:"fill"}),t&&Ce.Ps3.ccmEventTracking&&Ce.Ps3.ccmEventTracking("ccm_sheet_content_page_click",Object.assign({},(0,Ce.dK5)(),{click:"upload_attachment",target:"none",action_method:"fill"}))}}))}(e,t)}},{key:"_executeFill",value:function(){var e=this.command.autoFillType;this.collectEvent(),1===e?this.fillSeries():0===e&&this.copyCells(),this.updateSelectionAfterExecute()}},{key:"updateSelectionAfterExecute",value:function(){var e=this._sheet,t=this._wholeFillRange;e._setActiveCellImp(t.rowFrom(),t.colFrom(),e._activeRowViewportIndex,e._activeColViewportIndex),e._selectionModel&&e._clearSelectionImp(),e.addSelection(t)}},{key:"copyCells",value:function(){var e=this,t=this._sheet,r=this.command,n=r.startRange,a=r.fillRange,o=r.fillDirection,i=n.rowFrom(),u=n.colFrom(),s=n.rowCount(),l=n.colCount(),c=a.rowFrom(),h=a.colFrom(),f=a.rowCount(),d=a.colCount(),v=Math.floor(f/s),p=f%s,m=Math.floor(d/l),g=d%l,y=t._getSpanModel(),_={},R={},C=[],w=[],E={},k={},T=t7(t.id(),{row:c,col:h,rowCount:f,colCount:d}),S=h3(t,i,u,t,c,h,s,l);if(ree(n,(function(r,n){var a=y.find(r,n);if(a){if(a.rowFrom()!==r||a.colFrom()!==n)return;var o=e._transformRange(a);w.push(o);var i=E[r]||[];i.push(o),E[r]=i;var u=k[n]||[];u.push(o),k[n]=u}var s=e.getSetCellAction(t,r,n,{ignoreFormulaData:!0,handleStyleRef:!1});e.preProcessFormulaInSetCellAction(s,S),C.push(s);var l=_[r]||[];l.push(s),_[r]=l;var c=R[n]||[];c.push(s),R[n]=c}),this.skipRow.bind(this)),this.isHorizontalFill)!function(){for(var r=0===o,n=new Set,a=function(a){var o=a*l;r&&(o=d-(a+1)*l),C.forEach((function(r){var a=h+(r.target.col-u)+o;e.saveNewAction(r,T,{col:a}),n.has(a)||(n.add(a),e.saveNewSetColumnWidthAction(a,t.getColumnWidth(r.target.col)))})),w.forEach((function(t){var r=h+(t.col-u)+o;e.saveNewSetSpansAction(t.row,r,t.row_count,t.col_count)}))},i=0;i<m;i++)a(i);0!==g&&function(){var n=h+d-g;r&&(n=h);for(var a=function(a){var o=r?u+l-g+a:u+a,i=R[o]||[],s=n+a;i.forEach((function(t){e.saveNewAction(t,T,{col:s})})),e.saveNewSetColumnWidthAction(s,t.getColumnWidth(o)),(k[o]||[]).forEach((function(t){var r=t.row,o=t.row_count,i=t.col_count;e.saveNewSetSpansAction(r,n+a,o,i)}))},o=0;o<g;o++)a(o)}()}();else{for(var A=2===o,I=function(t){var r=t*s;A&&(r=f-(t+1)*s),C.forEach((function(t){var n=c+(t.target.row-i)+r;e.skipRow(n)||e.saveNewAction(t,T,{row:n})})),w.forEach((function(t){var n=c+(t.row-i)+r;e.saveNewSetSpansAction(n,t.col,t.row_count,t.col_count)}))},O=0;O<v;O++)I(O);0!==p&&function(){var t=c+f-p;A&&(t=c);for(var r=function(r){var n=A?i+s-p+r:i+r;(_[n]||[]).forEach((function(n){var a=t+r;e.skipRow(a)||e.saveNewAction(n,T,{row:a})})),(E[n]||[]).forEach((function(t){var r=t.row,n=t.col,a=t.row_count,o=t.col_count;e.saveNewSetSpansAction(r,n,a,o)}))},n=0;n<p;n++)r(n)}()}T&&(Q8(T),this.command._changesets.unshift(T))}},{key:"fillSeries",value:function(){var e=this,t=this.command,r=t.startRange,n=t.fillRange,a=new qd,o=h3(this._sheet,r.rowFrom(),r.colFrom(),this._sheet,n.rowFrom(),n.colFrom(),r.rowCount(),r.colCount()),i=this._sheet,u=new qd,s=new qd,l=new Set,c=i._getSpanModel(),h=t7(i.id(),n.toJSON()),f=new e6(this._sheet,(function(t,r,n,i,f,d){var v=u.get(r,n);if(void 0===v){var p=c.find(r,n);p?p.rowFrom()===r||p.colFrom()===n?(u.set(r,n,3),s.set(r,n,{rowCount:p.rowCount(),colCount:p.colCount()})):u.set(r,n,2):u.set(r,n,1),v=u.get(r,n)}if(3===v){var m=s.get(r,n);e.saveNewSetSpansAction(i,f,m.rowCount,m.colCount)}var g=a.get(r,n);g||(g=e.getSetCellAction(t,r,n,{ignoreFormulaData:!0,handleStyleRef:!1}),e.preProcessFormulaInSetCellAction(g,o),a.set(r,n,g));var y={row:i,col:f};"number"==typeof d&&(y.value=d),e.saveNewAction(g,h,y),f===n||l.has(f)||(l.add(f),e.saveNewSetColumnWidthAction(f,t.getColumnWidth(n)))}));f.fillAuto(this._wholeFillRange,r,this.isHorizontalFill?1:0),h&&(Q8(h),this.command._changesets.unshift(h))}},{key:"saveNewAction",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e=ga(e),void 0!==r.col&&(e.target.col=r.col),void 0!==r.row&&(e.target.row=r.row),void 0!==r.value&&(e.value.value=r.value);var n=this._sheet,a=e.value,o=e.target,i=o.row,u=o.col;if((0,Ce.Nsj)(a.value,!0),a.formulaData&&a.formulaData.tokens&&a.formulaData.tree){var s=new ou(i,u,1,1,n);a.formulaData=Lk(n,a.formulaData,s)}if(null!=a.reminder){var l=void 0===r.value?a.value:r.value,c=FC(a.reminder,l),h=c&&c.toChangeset();e.value.reminder=h}X8(e.target.row,e.target.col,n,t,{cellValue:e.value})}},{key:"saveNewSetSpansAction",value:function(e,t,r,n){var a,o=this._sheet,i=o.getColumnCount(),u=o.getRowCount();e=(a=this.fixSpan({row:e,col:t,rowCount:r,colCount:n},u,i)).row,t=a.col,(r=a.rowCount)*(n=a.colCount)!=1&&this.command._changesets.push({action:"setSpans",sheet_id:o.id(),target:{row:e,col:t,row_count:r,col_count:n},value:[{target:{row:e,col:t,row_count:r,col_count:n}}]})}},{key:"preProcessFormulaInSetCellAction",value:function(e,t){var r=e.target,n=r.row,a=r.col,o=this._sheet;if(o.hasFormula(n,a)){var i=o.getVar(n,a),u={ref:i.getRef()};e.value.formulaData=Tp(i,u,{refType:1})}else o.isProxyArrayFormula(n,a)&&t.has(o.getVar(n,a).formula)&&(e.value.value=null)}},{key:"fixSpan",value:function(e,t,r){var n=e.row,a=e.col,o=e.rowCount,i=e.colCount;return a+i>r&&(i=r-a),n+o>t&&(o=t-n),{row:n,col:a,rowCount:o,colCount:i}}},{key:"skipRow",value:function(e){return this._isFilterRow(e)}},{key:"extendFilterRange",value:function(e){var t=this._sheet,r=this._command,n=r._changesets,a=r._oldChangesets,o=cp(t,e),i=o.actions,u=o.oldActions;(0,Ce.hTd)(n,i),(0,Ce.hTd)(a,u)}},{key:"isHorizontalFill",get:function(){return[0,1].includes(this._command.fillDirection)}},{key:"commandName",get:function(){return Ce.rvF.FILL}}]),t}(Qte),sne=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r)))._command.autoFillType=0,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"_canExecute",value:function(e){return!!this._sheet._canChange(e.rowFrom(),e.colFrom(),e.rowCount(),e.colCount())}},{key:"redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"doAction",value:function(){var e=this,t=this._sheet,r=this._command,n=r.startRange,a=r.fillRanges;this.collectEvent(),this._beforeAction(t,!0);var o=n.rowFrom(),i=n.colFrom(),u=this.getSetCellAction(t,o,i,{ignoreFormulaData:!0,handleStyleRef:!1});this.preProcessFormulaInSetCellAction(u);var s=t.getColumnWidth(i),l=new Set;return l.add(i),a.forEach((function(r){var n=e._collRangeInfo(t,r);e.saveChangesets(n,!0);var a=t7(t.id(),{row:r.rowFrom(),col:r.colFrom(),rowCount:r.rowCount(),colCount:r.colCount()});ree(r,(function(t,r){e.saveNewAction(u,a,{row:t,col:r}),l.has(r)||(l.add(r),e.saveNewSetColumnWidthAction(r,s))}),e.skipRow.bind(e)),Q8(a),e.command._changesets.unshift(a)})),this.updateSelectionAfterExecute(),this._afterAction(t,!0),this.extendFilterRange(a),!!this.checkRangeValid(t.parent,this.command._changesets,!0)&&(this._applyChangsetWithEvent(this.command._changesets),!0)}},{key:"preProcessFormulaInSetCellAction",value:function(e){var t=e.target,r=t.row,n=t.col,a=this._sheet;if(a.hasFormula(r,n)){var o=a.getVar(r,n),i={ref:o.getRef()};e.value.formulaData=Tp(o,i,{refType:1})}else a.isProxyArrayFormula(r,n)&&(e.value.value=null)}},{key:"updateSelectionAfterExecute",value:function(){var e=this._sheet;e.clearSelection(),this.command.fillRanges.forEach((function(t){return e.addSelection(t)}))}},{key:"commandName",get:function(){return"fillRange"}}]),t}(une),lne=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments)))._addRows=0,e._addCols=0,e.handleConditionFormat=function(t){if(t){var r=e._command,n=r.toRange,a=r.fromRange,o=E6(e._sheet,t,a,n),i=o.changeset,u=o.undoChangeset,s=o.isOverLimit;(0,Ce.hTd)(e._command._changesets,i),(0,Ce.VB2)(e._command._oldChangesets,u),s&&e._sheet.parent.trigger(Ce.zW2.conditionalFormatOverLimit)}},e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_doAction",value:function(){return this._saveChangesets(),!(!this.checkRangeValid(this._sheet.parent,this._command._changesets)||!this._command._changesets.length)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"checkExpandTargetRangeProtected",value:function(e,t){return!!t.protectionModel.getRangePermissions(e).hasPermission||(t._raiseInvalidOperation(8,cr("sheet.protection.cannot_start_edit")),!1)}},{key:"_saveChangesets",value:function(){var e=this._sheet,t=this._command,r=t.fromRange,n=t.toRange,a=t.conditionFormat,o=t.isFromSpanToSpan,i=t.styles;if(this.checkExpandTargetRangeProtected([n],e)){if(o&&(this.handleLackOfRowCol(),!this.handleSetSpans()))return;this.handleSetRangeStyle(e,r,n,i),this.handleSetWidthAndHeight(n),this.handleConditionFormat(a),this.extendFilterRange(),this._command._changesets=this._getCSWithoutFilterRow(this._command._changesets)}}},{key:"handleLackOfRowCol",value:function(){var e=this._sheet,t=this._command,r=t.fromRange,n=t.toRange,a=n.rowFrom(),o=n.colFrom(),i=r.rowCount(),u=r.colCount(),s=e.getRowCount(),l=e.getColumnCount(),c=a+i-s,h=o+u-l;(c>0||h>0)&&Math.max(a+i,s)*Math.max(o+u,l)>(0,Ce.$$w)()?e._raiseInvalidOperation(6,cr("sheet.cell_limit_exceed")):(c>0&&(this._addRows=c,this._command._changesets.push(this._addRowsAction(s,c)),this._command._oldChangesets.unshift(this._delRowsAction(s,c))),h>0&&(this._addCols=h,this._command._changesets.push(this._addColsAction(l,h)),this._command._oldChangesets.unshift(this._delColsAction(l,h))))}},{key:"handleSetSpans",value:function(){for(var e=this._sheet,t=this._command,r=t.fromRange,n=t.spans,a=t.toRange,o=a.rowFrom(),i=a.colFrom(),u=a.rowCount(),s=a.colCount(),l=r.rowCount(),c=r.colCount(),h=this.getRepeatConfig,f=h.rows,d=h.cols,v=h.lastCopyRows,p=h.lastCopyCols,m=[],g=e.getSpans(a),y=!1,_=0;_<n.length;_++)for(var R=n[_],C=R.rowFrom(),w=R.colFrom(),E=R.rowCount(),k=R.colCount(),T=0;T<f||T===f&&C<v;T++){var S=o+l*T+C;if(S+E-1>o+u-1)break;for(var A=0;A<d||A===d&&w<p;A++){var I=i+c*A+w;if(I+k-1>i+s-1)break;if(CT(e,S,I,E,k))y=!0;else{var O=new ou(S,I,E,k,e);m.push(O)}}}if(!this.checkExpandTargetRangeProtected(m,e))return!1;for(var V=0;V<m.length;V++)for(var N=m[V],b=N.rowFrom(),M=N.colFrom(),F=N.rowCount(),Z=N.colCount(),x=b;x<b+F;x++)for(var D=M;D<M+Z;D++)if(x!==b||D!==M){var P=e.getValue(x,D),$=e.getFormula(x,D),L=e.getMultipleValuesJSON(x,D);this._command._oldChangesets.unshift(this._cellValueAction(x,D,{value:P,formula:$,multipleValues:L},!0))}return m.length&&(this._command._changesets.push(this._setSpansAction(a,m)),this._command._oldChangesets.unshift(this._setSpansAction(a,g))),y&&Ce.Ps3.Toast.warning({key:"pivot_table_area_cannot_merge",content:cr("CreationDoc_Sheets_PivotTable_Failed_CanNotMergeCells")}),!0}},{key:"handleSetRangeStyle",value:function(e,t,r,n){var a=e.getDefaultStyle(),o=K8(e,r.toJSON(),{ignoreStyle:!1,ignoreValue:!0,ignoreFormulaData:!0,ignoreDataValidation:!0,ignoreReminder:!0,ignoreMultipleValues:!0,ignorePivotTable:!0,ignoreFilterRow:!0},q8);this._setRangeValuesActionToChangeset(o,!0);var i=t.rowCount(),u=t.colCount(),s=r.rowCount(),l=r.colCount(),c=r.rowFrom(),h=r.colFrom(),f=r.toJSON();this._addRows>0&&(f.rowCount=s+this._addRows),this._addCols>0&&(f.colCount=l+this._addCols);var d=K8(e,f,{ignoreStyle:!1,ignoreValue:!0,ignoreFormulaData:!0,ignoreDataValidation:!0,ignoreReminder:!0,ignoreMultipleValues:!0,ignorePivotTable:!0,ignoreFilterRow:!0},(function(e,t,r,o,s){var l;r.ignoreValue=!0;var f=(t-h)%u,d=(null===(l=n[(e-c)%i])||void 0===l?void 0:l[f])||a,v=o.styleRefMgr.getStyleId(d);r.styleId=v;var p=s.getSegmentArray(e,t);if(Array.isArray(p)&&p.length){var m=z9(p,s.getCellStyle(e,t)||s.getDefaultStyle(),d),g=m.hasChanged,y=m.value;g&&(r.cellValue||(r.cellValue={}),r.ignoreValue=!1,r.cellValue.value=y)}X8(e,t,s,o,r)}));this._setRangeValuesActionToChangeset(d)}},{key:"handleSetWidthAndHeight",value:function(e){var t=this._sheet,r=this._command,n=r.rowHeight,a=r.fromRange,o=r.colWidth,i=e.rowFrom(),u=e.colFrom(),s=e.rowCount(),l=e.colCount(),c=a.rowCount(),h=a.colCount();if(o.length>0)for(var f=0;f<l;f++){var d=u+f,v=t.getColumnWidth(d),p=o[f%h];p!==v&&(this._command._oldChangesets.unshift(this._colWidthAction(d,v)),this._command._changesets.push(this._colWidthAction(d,p)))}if(n.length>0)for(var m=0;m<s;m++){var g=i+m,y=t.getRowHeight(g),_=n[m%c];y!==_&&(this._command._oldChangesets.unshift(this._rowHeightAction(g,y)),this._command._changesets.push(this._rowHeightAction(g,_)))}}},{key:"extendFilterRange",value:function(){var e=this._sheet,t=this._command,r=t.toRange,n=t._changesets,a=t._oldChangesets,o=cp(e,[r]),i=o.actions,u=o.oldActions;(0,Ce.hTd)(n,i),(0,Ce.hTd)(a,u)}},{key:"commandName",get:function(){return Ce.rvF.FORMAT_PAINTER}},{key:"getRepeatConfig",get:function(){var e=this._command,t=e.toRange,r=e.fromRange,n=r.rowCount(),a=r.colCount(),o=t.rowCount(),i=t.colCount();return{rows:Math.floor(o/n),cols:Math.floor(i/a),lastCopyRows:o%n,lastCopyCols:i%a,fromRangeRowCount:n,fromRangeColCount:a}}}]),t}(Qte),cne=function(e){function t(e,r,n){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"checkPropsValid",value:function(){var e=this._command,t=e.shouldAutoFitCol,r=e.addRowCount,n=e.addColCount,a=e.shouldClear;return t||r||n||a}},{key:"_clearRangeValueAndStyle",value:function(){var e=this;if(this.command.shouldClear){for(var t=this._sheet,r=this._command.ranges.filter(Boolean),n=new Set,a=function(a){var o=r[a],i=t.getSpans(o,void 0,!0);if(i.length){var u=1===o.size()?i[0]:o;e._spanToChangeset(u,i,!0),e._spanToChangeset(u,null)}var s={formula:null,value:null,multipleValues:null,reminder:null},l=e.splitSelectionByFilterRow(o),c=[];e.checkRangeDuplicate(l,n,c,r),c.forEach((function(t){e._setRangeToChangeset(t,s),OT(t,(function(t,r){var n={dataValidation:null};(function(e,t,r){var n=e.hasOwnProperty("style")&&!e.style,a=e.style&&!e.style.dropdown;e.hasOwnProperty(Qg)||!n&&!a||(e.dataValidation=t());var o=e.hasOwnProperty(Qg)&&!e.dataValidation;if(!e.hasOwnProperty("style")&&o){var i=r();e.style=i?i.toJSON():null}})(n,(function(){return null}),e._sheet.getStyle.bind(e._sheet,t,r,void 0,!0)),e.command._changesets.push(e._cellValueAction(t,r,n))}))}))},o=0;o<r.length;o++)a(o);OT(r,(function(r,n){if(!e._isFilterRow(r)){var a={},o=t.getMultipleValues(r,n),i=t.getStyleWithDropdown(r,n,!0)||t.getDefaultStyle().clone();a.formula=t.getFormula(r,n,void 0,!0),a.formulaData=t.getFormulaData(r,n,void 0,!0),a.value=a.formula?null:t.getChangesetValue(r,n,!0),a.reminder=t.getReminderChangeset(r,n),a.multipleValues=o?o.toJSON():null,a.dataValidation=t.getDataValidationJSON(r,n,{needDeepClone:!0},!0),e._cellStyleAndValueToCS(r,n,a,i,!0,!0),i.dropdown&&!i.dropdown.isValid&&(i.dropdown.isValid=!0,e._styleToChangeset(r,n,i,!1))}}))}}},{key:"_format",value:function(){this._command.shouldAutoFitCol&&this._autoFitCols()}},{key:"_autoFitCols",value:function(){var e=this._command,t=e.pivotTableName,r=e.ranges,n=this._sheet.getPivotTableManager(),a=n.getPivotTableByName(t),o=n.getViewDataModelByName(t);if(a&&o){var i=(0,g.Z)(r,1)[0];if(i){var u=o.row.range.colCount,s=o.col.range.rowCount;u<0&&(u=0),s<0&&(s=0);var l=a.getFieldByArea(4).length,c=i.toJSON(),h=c.row,f=c.col,d=c.rowCount,v=f+u,p=c.colCount-u-l,m=a._fieldsModel.colFields.length+1;this._autoFitRangeCol(new ou(h,v,s,p,this._sheet),m);for(var y=0;y<u;y++)this._autoFitRangeCol(new ou(h,f+y,d,1,this._sheet));for(var _=0;_<l;_++)this._autoFitRangeCol(new ou(h,v+p+_,d,1,this._sheet))}}else console.error("FormatPivotTableRange Error","No Pivot Table")}},{key:"_autoFitRangeCol",value:function(e,t){var r=105,n=200,a=this._sheet;if(e.isValid()){var o=function(e,t){var n=0;a.getRowVisible(e)&&(a._getSpanModel().find(e,t)||(a.getRowHeight(e)>0&&(n=a.cellWidthHint(e,t)),r<n&&(r=n)))};if(t){var i=e.toJSON(),u=i.row,s=i.col,l=i.rowCount;e.setRowFrom(u+1),e.setRowCount(l-1),OT(new ou(u,s,1,t,this._sheet),o)}e.rowCount()>n&&e.setRowCount(n),e.colCount()>n&&e.setColCount(n),OT(e,o);for(var c=e.colFrom();c<=e.colTo();c++){var h=this._sheet._getActualColumnWidth(c);h!==r&&(this._columnWidthToChangeset(c,h,!0),this._columnWidthToChangeset(c,r,!1))}}}},{key:"_addRowCol",value:function(){var e=this._command,t=e.addRowCount,r=void 0===t?0:t,n=e.addColCount,a=void 0===n?0:n;if(r||a){var o=this._sheet,i=o.getRowCount()-1,u=o.getColumnCount()-1,s=[];r>0&&(s=this._addRows(i,i+1,r)),a>0&&(s=[].concat((0,m.Z)(this._addCols(u,u+1,a)),(0,m.Z)(s)));var l=this._sheet.getRowCount()-1,c=this._sheet.getColumnCount()-1;if(r>0&&a>0){var h=this._colStyleAction(l,c,!0);if(null!=h){var f=this._setRangeAction(new ou(l+1,u+1,r,a,this._sheet),h.value,!0);this._command._changesets.push(f)}}(0,Ce.hTd)(this._command._oldChangesets,s)}}},{key:"_doAction",value:function(){if(!this.checkPropsValid())return!1;if(this._clearRangeValueAndStyle(),this._addRowCol(),this._format(),!0!==this.checkRangeValid(this._sheet.parent,this._command._changesets)||!this._command._changesets.length)return!1;var e=this._applyChangsetWithEvent(this._command._changesets,!0),t=this._command.ranges.filter(Boolean);return this._sheet.dispatch("CellRemoved",{ranges:t,sheetId:this._sheet.id()}),e}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){var e=this._sheet.getPivotTableManager(),t=this._command._oldChangesets.some((function(e){return"setCell"===e.action})),r=(e.getPivotInfoByName(this.command.pivotTableName)||{}).spanRange;return t&&r&&this._sheet.removeEmptyPivotTableSpan(r),this._applyChangsetWithEvent(this._command._oldChangesets,!0)}}]),t}(Ere),hne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){if(this._command.isFirstExecution){if(this._genOldChangesets(),!this.generateActions())return!1;this.chartAdjust()}return this._command._changesets.length>0&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"generateActions",value:function(){return this._saveChangesets()}},{key:"_saveChangesets",value:function(){var e=this._command,t={action:"freezeSheet",sheet_id:this._sheet.id(),target:{row:e.target.row,col:e.target.col}};return!!this.checkRangeValid(this._sheet.parent,[t])&&(e._changesets.push(t),!0)}},{key:"_genOldChangesets",value:function(){var e=this._sheet,t={action:"freezeSheet",sheet_id:this._sheet.id(),target:{row:e.getViewportTopRow(1),col:e.getViewportLeftColumn(1)}};this._command._oldChangesets.push(t)}},{key:"chartAdjust",value:function(){var e=this._command.target,t=e.row,r=e.col,n=this._sheet.chartModel.checkFreezeInfluence(t,r);this.appendOldChartChangeset(n)}},{key:"commandName",get:function(){return Ce.rvF.FREEZE_SHEET}}]),t}(Qte),fne=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r)))._command.autoFillType=0,n._command.fillDirection=1,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"canExecute",value:function(){var e=this._sheet,t=this._command,r=t.startRange,n=t.fillRange;return 0!==n.colCount()&&!!e._canChange(n.rowFrom(),n.colFrom(),n.rowCount(),n.colCount())&&!n.isIntersect(r)}},{key:"redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"doAction",value:function(){if(!this.canExecute())return!1;var e=this._sheet,t=this._command.fillRange,r=this._collRangeInfo(e,t);return this.saveChangesets(r,!0),this._beforeAction(e,!0),this._executeFill(),this._afterAction(this._sheet,!0),this.extendFilterRange([t]),!!this.checkRangeValid(e.parent,this.command._changesets,!0)&&(this._applyChangsetWithEvent(this.command._changesets),!0)}},{key:"commandName",get:function(){return"horizontalFill"}}]),t}(une),dne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"redoAction",value:function(){return this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"doAction",value:function(){return this.generateAction(),this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"generateAction",value:function(){var e=this._command,t=e._changesets,r=e._oldChangesets,n=e.col,a=e.colCount,o=e.lockInfo,i=e.permId,u=e.creatorId;t.push(this.lockColChangeset(this._sheetId,n,a,o,i,u)),r.push(this.unLockColChangeset(this._sheetId,n,a,i))}},{key:"lockColChangeset",value:function(e,t,r,n,a,o){return{action:"lockCol",sheet_id:e,target:{col:t,col_count:r},value:{lock_info:n,perm_id:a,creator_id:o}}}},{key:"unLockColChangeset",value:function(e,t,r,n){return{action:"unlockCol",sheet_id:e,value:{perm_id:n},target:{col:t,col_count:r}}}},{key:"commandName",get:function(){return Ce.rvF.LOCK_COL}}]),t}(Qte),vne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"redoAction",value:function(){return this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"doAction",value:function(){return this.generateAction(),this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"generateAction",value:function(){var e=this._command,t=e._changesets,r=e._oldChangesets,n=e.row,a=e.rowCount,o=e.lockInfo,i=e.permId,u=e.creatorId;t.push(this.lockRowChangeset(this._sheetId,n,a,o,i,u)),r.push(this.unLockRowChangeset(this._sheetId,n,a,i))}},{key:"lockRowChangeset",value:function(e,t,r,n,a,o){return{action:"lockRow",sheet_id:e,target:{row:t,row_count:r},value:{lock_info:n,perm_id:a,creator_id:o}}}},{key:"unLockRowChangeset",value:function(e,t,r,n){return{action:"unlockRow",sheet_id:e,value:{perm_id:n},target:{row:t,row_count:r}}}},{key:"commandName",get:function(){return Ce.rvF.LOCK_ROW}}]),t}(Qte),pne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e){return this._command.isFirstExecution?this.doAction(e):this.redoAction()}},{key:"redoAction",value:function(){return this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"doAction",value:function(e){return this.generateAction(),this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"generateAction",value:function(){var e=this._command,t=e._changesets,r=e._oldChangesets,n=e.lockInfo,a=e.permId,o=e.creatorId;t.push(this.lockSheetChangeset(this._sheetId,n,a,this._sheet.name(),o)),r.push(this.unLockSheetChangeset(this._sheetId,a,this._sheet.name()))}},{key:"lockSheetChangeset",value:function(e,t,r,n,a){return{action:"lockSheet",sheet_id:e,value:{lock_info:t,perm_id:r,sheet_name:n,creator_id:a}}}},{key:"unLockSheetChangeset",value:function(e,t,r){return{action:"unlockSheet",sheet_id:e,value:{perm_id:t,sheet_name:r}}}},{key:"commandName",get:function(){return Ce.rvF.LOCK_SHEET}}]),t}(Qte),mne=function(e){function t(){var e;return(0,y.Z)(this,t),(e=(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))).sparklineChangeInfo=new Map,e}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"beforeMergeAction",value:function(e,t){var r=t.rowFrom(),n=t.colFrom(),a=t.rowCount(),o=t.colCount(),i=this._sheet,u=i._getModel().orderedIterCellWithPos(r,n,a,o).next();if(null!=u){var s=(0,g.Z)(u,2)[1],l=s.row,c=s.col,h=i.getStyleWithDropdown(l,c)||i.getDefaultStyle();if(h=Om.withUpdateStyle(h,{}),l===r&&c===n)e.push(this._styleAction(l,c,h));else{var f=this._getCellValue(l,c);f.style=h.toJSON(),e.push(this._cellValueAction(r,n,f)),kee(this._sheet.parent,this._command)}}}},{key:"collectAddSpanChangeset",value:function(){var e=this,t=this._command,r=t.ranges,n=t._changesets;r.forEach((function(t){e.beforeMergeAction(n,t),e.collectSparklineAction(t),n.push(e._setSpansAction(t,[t]))}))}},{key:"collectAddSpanOldChangeset",value:function(){var e=this,t=this._sheet,r=this._command,n=r.ranges,a=r._oldChangesets;n.forEach((function(r){var n=t.getSpans(r);a.push(e._setSpansAction(r,n)),e._setRangeValuesActionToChangeset(K8(t,r.toJSON(),{needNote:!0},J8),!0)}))}},{key:"collectSparklineAction",value:function(e){var t=this,r=e.toJSON(),n=r.row,a=r.col,o=r.rowCount,i=r.colCount;this._sheet.iterSparklineWithPos(n,a,o,i).forEach((function(e){var r=(0,g.Z)(e,2),o=r[0],i=r[1];if(i.row!==n||i.col!==a){var u=o.getGroupId();t.sparklineChangeInfo.has(u)||t.sparklineChangeInfo.set(u,[]),t.sparklineChangeInfo.get(u).push(o)}}))}},{key:"saveSparklineActions",value:function(){if(this.sparklineChangeInfo.size){var e,t=this._sheet,r=[],n={},a={},o={},i=yr(this.sparklineChangeInfo);try{for(i.s();!(e=i.n()).done;){var u=(0,g.Z)(e.value,2),s=u[0],l=u[1];l.length===t.getSparklinesByGroupId(s).length?function(){r.push(s);var e=t.getSparklineGroupByGroupId(s),n={};l.forEach((function(e){n[e.getId()]={source:e.getSource(),position:e.getPosition()}})),a[s]={sparklines:n},e&&(a[s].config=e)}():function(){var e={},t={};l.forEach((function(r){e[r.getId()]=null,t[r.getId()]={source:r.getSource(),position:r.getPosition()}})),n[s]={sparklines:e},o[s]={sparklines:t}}()}}catch(e){i.e(e)}finally{i.f()}r.length&&(this._command._changesets.push({action:"delSparklineGroup",sheet_id:this._sheetId,value:r}),this._command._oldChangesets.push({action:"addSparklineGroup",sheet_id:this._sheetId,value:a})),this._command._changesets.push({action:"updateSparklineGroup",sheet_id:this._sheetId,value:n}),this._command._oldChangesets.push({action:"updateSparklineGroup",sheet_id:this._sheetId,value:o})}}},{key:"collectRemoveSpanChangeset",value:function(){var e=this,t=this._command,r=t.ranges,n=t._changesets;r.forEach((function(t){n.push(e._setSpansAction(t))}))}},{key:"collectRemoveSpanOldChangeset",value:function(){var e=this,t=this._command,r=t.ranges,n=t._oldChangesets,a=this._sheet;r.forEach((function(t){var r=a.getSpans(t),o=r.reduce((function(e,t){return e.union(t)}),t.clone());n.push(e._setSpansAction(o,r))}))}},{key:"getProtectionInfosToAddSpanRange",value:function(){if(!this._protectionInfosToAddSpanRange){var e=this._sheet.protectionModel,t=[],r=new ou(0,0,0,0,null);this._command.ranges.forEach((function(n){var a=e.getProtectionsByRange(n);a.length<1||a.forEach((function(e){var a,o=0,i=null,u=yr(e.ranges);try{for(u.s();!(a=u.n()).done;){var s=a.value;if(s.type===Ce.xj7.NORMAL){var l=s;if(r.setRowFrom(l.row),r.setRowCount(l.rowCount),r.setColFrom(l.col),r.setColCount(l.colCount),r.equal(n)||r.contain(n))return;if(n.contain(r)){i=l;break}r.isIntersect(n)&&o++}}}catch(e){u.e(e)}finally{u.f()}o<1||!i||t.push({protection:e,cellRangeToReplace:i,spanRange:n.toJSON()})}))})),this._protectionInfosToAddSpanRange=t}return this._protectionInfosToAddSpanRange}},{key:"collectSpanRangeToProtectionChangeset",value:function(){var e=this,t=this.getProtectionInfosToAddSpanRange();if(t.length){var r=this._command._changesets;t.forEach((function(t){var n=t.protection,a=t.cellRangeToReplace,o=t.spanRange,i=CN(n),u=i[Ce.xj7.NORMAL],s=i[Ce.xj7.ROW],l=i[Ce.xj7.COL],c=a?u.filter((function(e){return e!==a})):u,h=Object.assign({},n,{ranges:[].concat((0,m.Z)(c),[o],(0,m.Z)(s),(0,m.Z)(l))});r.push(nre(e._sheet.id(),h))}))}}},{key:"collectSpanRangeToProtectionOldChangeset",value:function(){var e=this,t=this.getProtectionInfosToAddSpanRange();if(t.length){var r=this._command._oldChangesets;t.forEach((function(t){var n=t.protection;r.push(nre(e._sheet.id(),n))}))}}},{key:"execute",value:function(){var e=this._command,t=this._sheet,r=!0;this._beforeAction(t);try{if(e.isFirstExecution&&(this.generateOldActions(),!this.generateActions()))return!1;r=this._applyChangsetWithEvent(this._command._changesets),this.command.isMerge&&this.setNewSelection(t,this._command.ranges),t.notifyShell(2)}catch(e){Ce.Ps3.moirae.ravenCatch(e),r=!1}finally{this._afterAction(t)}return r}},{key:"generateActions",value:function(){return this.command.isMerge?(this.collectAddSpanChangeset(),this.saveExtendFilterRangeActions(),this.saveSparklineActions()):(this.collectRemoveSpanChangeset(),this.collectSpanRangeToProtectionChangeset()),!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)}},{key:"generateOldActions",value:function(){this.command.isMerge?this.collectAddSpanOldChangeset():(this.collectRemoveSpanOldChangeset(),this.collectSpanRangeToProtectionOldChangeset())}},{key:"undo",value:function(){var e=this._sheet;this._beforeAction(e);var t=!0;try{this._applyChangsetWithEvent(this._command._oldChangesets)}catch(e){Ce.Ps3.moirae.ravenCatch(e),t=!1}finally{this._afterAction(e)}return t}},{key:"saveExtendFilterRangeActions",value:function(){var e=this._sheet,t=this._command,r=t.ranges,n=t._changesets,a=t._oldChangesets,o=r.filter((function(t){return function(e,t){return!!t.isValid()&&null!==e.iterContent(t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()).first_if((function(e){return!(!e.variant||e.variant===it.NULL_VAR)||!!(e.segmentArray&&e.segmentArray.length>0)||!!(e.multipleValues&&e.multipleValues.length>0)}))}(e,t)})),i=cp(e,o),u=i.actions,s=i.oldActions;(0,Ce.hTd)(n,u),(0,Ce.hTd)(a,s)}},{key:"setNewSelection",value:function(e,t){var r=e.getActiveRowIndex(),n=e.getActiveColumnIndex();t.forEach((function(t){t.contain(new ou(r,n,1,1,e))&&e.setSelection(new ou(t.rowFrom(),t.colFrom(),1,1,e))}))}},{key:"commandName",get:function(){return Ce.rvF.MERGE_CELLS}}]),t}(Qte),gne=function(e){function t(e,r,n){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"_doAction",value:function(){return this.saveState(),this.extendFilterRange(),!!this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"saveState",value:function(){for(var e=this,t=this._sheet,r=this._command,n=r.ranges,a=r.getValueFn,o=n.length,i={},u=0;u<o;u++){for(var s=n[u],l=s.rowFrom(),c=s.colFrom(),h=s.rowCount(),f=s.colCount(),d=t7(t.id(),{row:l,col:c,rowCount:h,colCount:f}),v=t7(t.id(),{row:l,col:c,rowCount:h,colCount:f}),p=function(r){if(t.filterModel.isVisible(r))for(var n=function(n){var o=e.getModifyInfo(t,r,n,a);if(o){var u=function(e,a){i.cellValue=e,i.ignoreValue=void 0===e.value&&void 0===e.formulaData,i.ignoreFormulaData=void 0===e.formulaData,i.ignoreMultipleValues=void 0===e.multipleValues,i.ignoreStyle=void 0===e.style,i.ignoreDataValidation=void 0===e.dataValidation,i.needNote=void 0!==e.note,X8(r,n,t,a,i)};u(o.oldValue,v),u(o.newValue,d)}},o=c;o<c+f;o++)n(o)},m=l;m<l+h;m++)p(m);Q8(d),Q8(v),this._setRangeValuesActionToChangeset(d,!1,!0),this._setRangeValuesActionToChangeset(v,!0)}}},{key:"getModifyInfo",value:function(e,t,r,n){var a=n(t,r);if(a){var o={},i={};if(void 0===a.value&&void 0===a.multipleValues&&void 0===a.formula&&void 0===a.formulaData||(i.value=e.getChangesetValue(t,r),o.value=a.value,i.multipleValues=e.getMultipleValuesJSON(t,r),o.multipleValues=a.multipleValues,(e.getFormula(t,r)||e.getFormulaData(t,r))&&(i.formula=e.getFormula(t,r),i.formulaData=e.getFormulaData(t,r)),(a.formula||a.formulaData)&&(o.formula=a.formula,o.formulaData=a.formulaData)),a.style){var u=e.getStyle(t,r,void 0,!0);i.style=u.toJSON()||{},o.style=u.toJSON()||{},Object.assign(o.style,a.style)}a.dataValidation&&(i.dataValidation=e.getDataValidationJSON(t,r,{needDeepClone:!0}),o.dataValidation=a.dataValidation);var s=o.hasOwnProperty("style")&&!o.style,l=o.style&&!o.style.dropdown;return!s&&!l||o.hasOwnProperty(Qg)||(i.dataValidation=e.getDataValidationJSON(t,r,{needDeepClone:!0}),o.dataValidation=e.getDataValidationJSON(t,r,{needDeepClone:!0})),i.reminder=e.getReminderChangeset(t,r),o.reminder=null,{oldValue:i,newValue:o}}}},{key:"extendFilterRange",value:function(){var e=this._sheet,t=this._command,r=t.ranges,n=t._changesets,a=t._oldChangesets,o=cp(e,r),i=o.actions,u=o.oldActions;(0,Ce.hTd)(n,i),(0,Ce.hTd)(a,u)}}]),t}(Rre);function yne(e,t){return!(!e||!t)&&(e instanceof iu||e instanceof au)&&0===t.colFrom()}function _ne(e,t){return!(!e||!t)&&(e instanceof nu||e instanceof au)&&0===t.rowFrom()}function Rne(e,t){var r=t(),n=r.do,a=r.undo,o=r.add,i=r.delete,u=null,s=null;return n&&i?u={action:"updateSparklineGroup",sheet_id:e.id(),value:(0,ae.Z)(n,i)}:n?u={action:"updateSparklineGroup",sheet_id:e.id(),value:n}:i&&(u={action:"updateSparklineGroup",sheet_id:e.id(),value:i}),a&&o?s={action:"updateSparklineGroup",sheet_id:e.id(),value:(0,ae.Z)(a,o)}:a?s={action:"updateSparklineGroup",sheet_id:e.id(),value:a}:o&&(s={action:"updateSparklineGroup",sheet_id:e.id(),value:o}),{do:u&&Object.keys(u.value).length?u:null,undo:s&&Object.keys(s.value).length?s:null}}function Cne(e,t,r,n){var a,o=new zM("sparkline_fake","sparkline_fake",!0,e);o.setRowCount(xg),o.setColumnCount(xg);var i=o.rangeStringToRange(t);if(!i)return it.ErrorConstant.REF;if(15===(null==i?void 0:i.refStatus()))return t||it.ErrorConstant.REF;var u=cs(is(i,{ref:new ou(r.row,r.col,1,1,o)},1),{ref:new ou(n.row,n.col,1,1,o)}),s=ls((0,A.default)(u,["refStatus"]),o,(function(){return o}));return xv(e,s.toString({ref:s}),null!==(a=null==u?void 0:u.refStatus)&&void 0!==a?a:0,void 0,o)||it.ErrorConstant.REF}function wne(e,t,r,n){e[t]?e[t].sparklines?e[t].sparklines[r]=n:e[t].sparklines=(0,l.Z)({},r,n):e[t]={sparklines:(0,l.Z)({},r,n)}}function Ene(e,t,r,n){e[t]?e[t][r]=n:e[t]=(0,l.Z)({},r,n)}var kne=function(e){function t(e,r){var n;(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))).undoSetCellActionCells=new Map,n.isColMove=!1,n.isRowMove=!1;var a=r.fromRow,o=r.fromCol,i=r.toRow,u=r.toCol,s=r.rowCount,l=r.colCount;return n.fromSheet=n.command.fromSheet||e,n.toRange=new ou(i,u,s,l,e),n.fromRange=new ou(a,o,s,l,n.fromSheet),r.isColMove&&(n.isColMove=!0),r.isRowMove&&(n.isRowMove=!0),n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this.command.isFirstExecution?this._doAction():this._redoAction()}},{key:"_doAction",value:function(){var e=this._sheet;if(this._beforeAction(e,!0),this.generateActions(),this._afterAction(this._sheet,!0),!0!==this.checkRangeValid(this._sheet.parent,this.command._changesets))return!1;var t=this._applyChangsetWithEvent(this.command._changesets);return t&&this.updateSelectionAfterExecute(),t}},{key:"updateSelectionAfterExecute",value:function(){this._sheet.setSelection(this.toRange)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this.command._oldChangesets,!0,"undo")}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this.command._changesets)&&this._applyChangsetWithEvent(this.command._changesets,void 0,"redo")}},{key:"generateActions",value:function(){var e=this,t=this._sheet;this.command._changesets.push(this._moveRangeAction(this.fromSheet.id(),t.id(),this.fromRange,this.toRange,Ce.xj7.NORMAL)),this.command._oldChangesets.push(this._moveRangeAction(t.id(),this.fromSheet.id(),this.toRange,this.fromRange,Ce.xj7.NORMAL)),this.collectRangeActions(t,this.toRange,{ignorePivotTable:!0,needNote:!0}).forEach((function(r){e.command._oldChangesets.push(r);var n=r.target,a=n.row,o=n.col;e.saveUndoCell(t,a,o)})),this.collectRangeActions(this.fromSheet,this.fromRange,{ignorePivotTable:!0}).forEach((function(r){e.command._oldChangesets.push(r);var n=r.target,a=n.row,o=n.col;e.saveUndoCell(t,a,o)})),this.saveOtherActions()}},{key:"saveOtherActions",value:function(){this.saveColWidthAndRowHeightAction(),this.saveFormulaActions(),this.saveExtendFilterRangeActions(),this.saveConditionalFormatActions(),this.saveCommentActions(),this.saveSparklineActions(),this.saveFloatImgsActions()}},{key:"saveColWidthAndRowHeightAction",value:function(){for(var e=this._sheet,t=this.fromRange.colFrom(),r=this.fromRange.colCount(),n=this.toRange.colFrom(),a=0;a<r;a++){var o=n+a,i=this.fromSheet.getColumnWidth(t+a);if(this.saveNewSetColumnWidthAction(o,i)){var u=e.getColumnWidth(o);this.command._oldChangesets.push(this._colWidthAction(o,u))}}if(this.isRowMove)for(var s=0;s<this.fromRange.rowCount();s++){var l=this.fromRange.rowFrom()+s,c=this.toRange.rowFrom()+s,h=e._getActualRowHeight(l),f=e._getActualRowHeight(c);this.command._changesets.push(this._rowHeightAction(c,h),this._rowHeightAction(l,0)),this.command._oldChangesets.push(this._rowHeightAction(c,f),this._rowHeightAction(l,h))}if(this.isColMove)for(var d=e.defaults.colWidth,v=0;v<this.fromRange.colCount();v++){var p=this.fromRange.colFrom()+v,m=this.toRange.colFrom()+v,g=e._getActualColumnWidth(p),y=e._getActualColumnWidth(m);this.command._changesets.push(this._colWidthAction(m,g),this._colWidthAction(p,d)),this.command._oldChangesets.push(this._colWidthAction(m,y),this._colWidthAction(p,g))}}},{key:"saveFormulaActions",value:function(){var e=this,t=this.fromRange.rowFrom(),r=this.fromRange.colFrom(),n=this.fromRange.rowCount(),a=this.fromRange.colCount(),o=this.toRange.rowFrom(),i=this.toRange.colFrom(),u=this.fromSheet._getModel(),s=new Map;this.fromSheet.iterContentWithPos(t,r,n,a,!0).forEach((function(n){var a=(0,g.Z)(n,2),l=a[0],c=a[1],h=c.row,f=c.col,d=h-t,v=f-r;if(e.fromSheet.isProxyArrayFormula(h,f)){var p=u.getVarByContent(l,h,f).formula;if(!s.has(p)){var m=p.getRef();e.fromRange.contain(m)?s.set(p,!0):s.set(p,!1)}if(!s.get(p)){var y=lR(e.fromSheet,h,f);e.command._changesets.push({action:"setCell",sheet_id:e._sheet.id(),target:{row:o+d,col:i+v},value:{value:y?[e.fromSheet.getValue(h,f)]:e.fromSheet.getValue(h,f)}})}}else if(dv(e.fromSheet.getVar(h,f))){var _=e.getSetCellAction(e.fromSheet,h,f),R=e._sheet.parent.importRangeManager;_.sheet_id=e._sheet.id(),_.target.row=o+d,_.target.col=i+v;var C=_.value.formulaData.externalDataReference;C&&R.setImportRangeAutoExpand("".concat(C.importRangeId,"_").concat(o+d,"_").concat(i+v)),e.command._changesets.push(_)}})),function(e,t){var r=[],n=new Set,a=e.getCalcEngine();return a.iterFormulasDependOn(t[0],!1,(function(e){return e instanceof lv&&!n.has(e)&&(e.getRef().isValid()&&r.push(e.getRef()),!1)})),a.iterFormulasDependOn(t[1],!1,(function(e){return e instanceof lv&&!n.has(e)&&(e.getRef().isValid()&&r.push(e.getRef()),!1)})),r}(this._sheet.parent,[this.fromRange,this.toRange]).forEach((function(t){var r=t.sheet(),n=t.rowFrom(),a=t.colFrom();if(!e.hasGenerateSetCellAction4Undo(r,n,a)&&(e.command._oldChangesets.push(e.getSetCellAction(r,n,a)),e.saveUndoCell(r,n,a),e.fromSheet.isArrayFormula(n,a))){var o=e.fromSheet.getVar(n,a);if(o.canArrayExpand()){var i=o.getArrayRef(),u=i.rowFrom(),s=i.colFrom(),l=i.rowCount(),c=i.colCount();c>1&&e.command._oldChangesets.push(e._setRangeActionCore(e.fromSheet.id(),new ou(u,s+1,l,c-1,e.fromSheet),{value:null})),l>1&&e.command._oldChangesets.push(e._setRangeActionCore(e.fromSheet.id(),new ou(u+1,s,l-1,1,e.fromSheet),{value:null}))}}}))}},{key:"saveExtendFilterRangeActions",value:function(){var e=this._sheet,t=this._command,r=t._changesets,n=t._oldChangesets,a=function(e,t,r){var n={actions:[],oldActions:[]};try{if(Gv(e,t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()))return n;var a=e.sheetFilterModel.filterRange;if(null!=a&&a.isValid()&&!t.contain(a)){var o=ep(e,a,{targetRangeArr:[r],ignoreRanges:[t]});if(o>a.rowTo(!0)||r.contain(a)){var i=rp(e,a,o,!1,!1),u=i.actions,s=i.oldActions;(0,Ce.hTd)(n.actions,u),(0,Ce.hTd)(n.oldActions,s)}}var l,c=yr(Xv(e));try{for(c.s();!(l=c.n()).done;){var h=l.value,f=h.name,d=h.id,v=h.range;if(!t.contain(v)){var p=ep(e,v,{targetRangeArr:[r],ignoreRanges:[t]});if(p>v.rowTo(!0)||r.contain(v)){var m=rp(e,v,p,!1,!1,f,d),g=m.actions,y=m.oldActions;(0,Ce.hTd)(n.actions,g),(0,Ce.hTd)(n.oldActions,y)}}}}catch(e){c.e(e)}finally{c.f()}}catch(e){console.error("extendFilterHelper.ts: getFilterExtendChangeSetsByMoveRange error")}return n}(e,this.fromRange,this.toRange),o=a.actions,i=a.oldActions;(0,Ce.hTd)(r,o),(0,Ce.hTd)(n,i)}},{key:"saveUndoCell",value:function(e,t,r){var n=this.undoSetCellActionCells.get(e)||new Yd;n.add(t,r),this.undoSetCellActionCells.set(e,n)}},{key:"hasGenerateSetCellAction4Undo",value:function(e,t,r){var n=this.undoSetCellActionCells.get(e);return null!=n&&n.has(t,r)}},{key:"saveConditionalFormatActions",value:function(){var e=this._sheet,t=this.fromSheet,r=t.conditionalFormatModel.helper.getAdjustedRulesByMoveRange(this.toRange,this.fromRange,e);this.setConditionalFormatChangeSet(r,t)}},{key:"setConditionalFormatChangeSet",value:function(e,t){var r=this;e.size<=0||e.forEach((function(e,n){var a=p6(t,n);if(a){var o=e.attrs,i=void 0===o?null:o,u=e.newBaseRanges,s=void 0===u?null:u,l=Object.assign({},a);null!==i&&(l.attrs=i),null!==s&&(l.ranges=s.map((function(e){return gu(e,!0)})));var c=g6(t,n,l);c&&((0,Ce.hTd)(r._command._changesets,c.actions),(0,Ce.hTd)(r._command._oldChangesets,c.oldActions))}}))}},{key:"saveCommentActions",value:function(){var e=this;this.getCommentsInRange(this.toRange).forEach((function(t){var r=t.row,n=t.col,a=t.comments;e.command._oldChangesets.push(e._cellCommentsAction(r,n,a))}))}},{key:"saveSparklineActions",value:function(){var e=this,t=this._sheet.getSparklineModel(),r=this.toRange.toJSON(),n=r.row,a=r.col,o=r.rowCount,i=r.colCount,u=this.fromRange.toJSON(),s=u.row,l=u.col,c=u.rowCount,h=u.colCount,f=Rne(this._sheet,(function(){var r,u=[],f=function(t){var r=t.getPosition(),n=r.row,a=r.col,o=t.getId();e.toRange.containCell(n,a)&&!e.fromRange.containCell(n,a)&&u.push(o)};return t.iter(n,a,o,i).forEach(f),t.iter(s,l,c,h).forEach(f),u.length&&u.forEach((function(e){var n=t.getSparklineById(e);if(n){var a=null==n?void 0:n.getGroupId();r||(r={}),wne(r,a,e,{source:n.getSource(),position:n.getPosition()});var o=t.getSparklineRawConfig(a);o&&(r[a].config=o)}})),{add:r}}));if(null!=f&&f.undo&&this.command._oldChangesets.push(f.undo),!this.isColMove&&!this.isRowMove){var d=Rne(this._sheet,(function(){var r;return t.iter(0,0,e._sheet.getRowCount(),e._sheet.getColumnCount()).forEach((function(t){var n=t.getSourceRange();if(n){var a=t.getGroupId(),o=t.getId(),i=t.getSource();e.fromRange.isIntersect(n)&&(r||(r={}),wne(r,a,o,{source:i}))}})),{undo:r}}));(null==d?void 0:d.undo)&&this.command._oldChangesets.push(d.undo)}}},{key:"saveFloatImgsActions",value:function(){var e=this.command,t=e.hasFloatImages,r=e.isCutting;if(t||!r){var n=cT(this.fromRange,this.fromSheet);(null==n?void 0:n.length)>0&&this.seFloatImgsChangeSet(n)}}},{key:"getCommentsInRange",value:function(e){var t=e.toJSON(),r=t.row,n=t.col,a=t.rowCount,o=t.colCount,i=r+a,u=n+o,s=this._sheet.getAllComments().filter((function(e){var t=e.row,a=e.col;return t>=r&&t<i&&a>=n&&a<u}));return(0,Re.default)(s)}},{key:"seFloatImgsChangeSet",value:function(e){var t=this,r=this.fromSheet.id(),n=this._sheet.id(),a=this.fromRange.toJSON(),o=a.row,i=a.col,u=this.toRange.toJSON(),s=u.row,l=u.col,c=s-o,h=l-i;e.forEach((function(e){var a=e.floatImageId,o=e.floatImageSetting,i=o.row,u=o.col,s=hT(e,i+c,u+h,t._sheet);t._command._changesets.push(sT(a,r),uT(n,s)),t._command._oldChangesets.push(sT(s.floatImageId,n),uT(r,e))}))}},{key:"commandName",get:function(){return Ce.rvF.MOVE_RANGE}}]),t}(Qte);var Tne,Sne,Ane,Ine,One,Vne,Nne,bne,Mne=function(e,t){return e.rowFrom()<=t.row&&e.rowTo()>=t.row&&e.rowTo()<t.row+t.rowCount},Fne=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))).rangeAdjust=function(e,t,r){var a=n._sheet.rangeModel.checkDelInfluence(e,t,r);n.appendOldRangeChangeset(n._sheet.id(),a)},n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"canExecute",value:function(){var e,t=this._command,r=t.sourceRg,n=t.targetRg,a=this._sheet,o=!0;return function(e,t){var r=e.getSpans();if(!Array.isArray(r))return!1;var n,a=yr(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(t.isIntersect(o)&&!t.contain(o))return!0}}catch(e){a.e(e)}finally{a.f()}return!1}(a,r)?(e=cr("sheet.error.drag_from_part_spans"),o=!1):function(e,t){var r=e.getSpans();if(!Array.isArray(r))return!1;var n,a=yr(r);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(t instanceof iu){if(t.rowFrom()>o.rowFrom()&&t.rowFrom()<=o.rowTo())return!0}else if(t.colFrom()>o.colFrom()&&t.colFrom()<=o.colTo())return!0}}catch(e){a.e(e)}finally{a.f()}return!1}(a,n)?(e=cr("sheet.error.drag_to_part_spans"),o=!1):function(e,t){var r=function(e){var r=e.getFilterRange();return Boolean(Mne(t,r))};return t instanceof iu&&(!!r(e.sheetFilterModel)||e.viewsModel.getViewList().some((function(e){return r(e.getFilterModel())})))}(a,r)?(e=cr("sheet.error.drag_with_filter"),o=!1):function(e,t){return t instanceof iu?e.checkRangesProtected(new iu(t.rowFrom(),1,e))&&e.checkRangesProtected(new iu(t.rowFrom()-1,1,e)):e.checkRangesProtected(new nu(t.colFrom(),1,e))&&e.checkRangesProtected(new nu(t.colFrom()-1,1,e))}(a,n)?(o=!1,e=cr("sheet.error.drag_to_protected")):function(e,t){for(var r=e.protectionModel.getProtectionRangesByRange(t),n=0;n<r.length;n++){var a=r[n];if(t instanceof iu&&!(a instanceof nu))return!0;if(t instanceof nu&&!(a instanceof iu))return!0}return!1}(a,r)&&(o=!1,e=cr("sheet.error.drag_contain_protected")),!o&&e&&Ce.Ps3.Toast.show({type:"error",content:e,duration:2e3}),o}},{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"_doAction",value:function(){var e=this._command,t=e.sourceRg,r=e.targetRg;if(!this.canExecute())return this.collectEvent(t,r,"cancel"),!1;this._command.highLightRg=t;var n=this._getFinalHightRange(),a=this._sheet,o=a.getParent();return this._saveChangesets(),this._undoCsSaveOtherChangesets(),this.saveConditionalFormatActions(this._sheet,t,r),this.saveExtendFilterChangeSets(t,r),this._appendFreezeOldChangeset(),this.saveOutlineAdjustChangeSets(t,r),o.applyActions(this._command._changesets,!1,!0),n&&a.setSelection(n),this.collectEvent(t,r,"effective"),!0}},{key:"collectEvent",value:function(e,t,r){var n="drag_row";e instanceof nu&&(n="drag_column");var a=e.sheet();Ce.Ps3.collectSuiteEvent("sheet_opration",{op_item:n,attr_op_status:r,source:"body",eventType:"click",object_count:e instanceof iu?e.rowCount():e.colCount(),object_id:a?a.id():"unknown"})}},{key:"_undoCsSaveOtherChangesets",value:function(){var e,t,r,n=this._sheet,a=this._command.sourceRg,o=n.chartModel,i=n.floatImageModel;a instanceof iu?(e=o.checkDelInfluence("row",a.rowFrom(),a.rowCount()),t=i.checkDelInfluence("row",a.rowFrom(),a.rowCount()),r=n.floatBlocksModel.checkDelInfluence("row",a.rowFrom(),a.rowCount()),this.rangeAdjust("row",a.rowFrom(),a.rowCount())):(e=o.checkDelInfluence("col",a.colFrom(),a.colCount()),t=i.checkDelInfluence("col",a.colFrom(),a.colCount()),r=n.floatBlocksModel.checkDelInfluence("col",a.colFrom(),a.colCount()),this.rangeAdjust("col",a.rowFrom(),a.rowCount())),this.appendOldChartChangeset(e),this.appendOldFloatImageChangeset(t),this.appendOldFloatBlockChangeset(r)}},{key:"appendOldFloatBlockChangeset",value:function(e){var t=this,r=this._command._oldChangesets;e.forEach((function(e,n){var a=e.blockType,o=e.blockSetting;r.push({action:"setFloatBlock",sheet_id:t._sheetId,value:Object.assign({},o,{blockToken:n,blockType:a})})}))}},{key:"_appendFreezeOldChangeset",value:function(){var e=this._command,t=e.sourceRg,r=e.targetRg,n=e._oldChangesets,a=this._sheet,o=a.getFrozenColumnCount(),i=a.getFrozenRowCount();o+i&&(t instanceof iu?r.rowFrom()>t.rowFrom()&&t.rowFrom()+t.rowCount()>=i&&n.push(this._freezeAction(i,o)):t instanceof nu&&r.colFrom()>t.colFrom()&&t.colFrom()+t.colCount()>=o&&n.push(this._freezeAction(i,o)))}},{key:"_freezeAction",value:function(e,t){return{action:"freezeSheet",sheet_id:this._sheet.id(),target:{row:e,col:t}}}},{key:"_saveChangesets",value:function(){var e=this._command,t=e.sourceRg,r=e.targetRg,n=e._changesets,a=e._oldChangesets,o=this._sheet,i=t;if(t instanceof iu){r.rowFrom()<t.rowFrom()&&(i=new iu(t.rowFrom()+t.rowCount(),t.rowCount(),o)),n.push(this._addRowsAction(r.rowFrom(),t.rowCount())),n.push(this._moveRangeAction(this._sheetId,this._sheetId,i,r,Ce.xj7.ROW)),n.push(this._delRowsAction(i.rowFrom(),t.rowCount())),a.push(this._addRowsAction(i.rowFrom(),t.rowCount())),a.push(this._moveRangeAction(this._sheetId,this._sheetId,r,i,Ce.xj7.ROW)),a.push(this._delRowsAction(r.rowFrom(),t.rowCount()));var u=r;u.setRowCount(t.rowCount());var s=u.rowFrom()-t.rowFrom();this._addUndoProxyTargetChangesets(u,s,"row",a),this._addArrayFormulaChangesets(t,s,"row",n,a)}else if(t instanceof nu){r.colFrom()<t.colFrom()&&(i=new nu(t.colFrom()+t.colCount(),t.colCount(),o)),n.push(this._addColsAction(r.colFrom(),t.colCount())),n.push(this._moveRangeAction(this._sheetId,this._sheetId,i,r,Ce.xj7.COL)),n.push(this._delColsAction(i.colFrom(),t.colCount())),a.push(this._addColsAction(i.colFrom(),t.colCount())),a.push(this._moveRangeAction(this._sheetId,this._sheetId,r,i,Ce.xj7.COL)),a.push(this._delColsAction(r.colFrom(),t.colCount()));var l=r;l.setColCount(t.colCount());var c=l.colFrom()-t.colFrom();this._addUndoProxyTargetChangesets(l,c,"col",a),this._addArrayFormulaChangesets(t,c,"col",n,a)}return!0}},{key:"undo",value:function(){var e=this._command.highLightRg,t=this._sheet.getParent();return!!this.checkRangeValid(t,this._command._oldChangesets)&&(t.applyActions(this._command._oldChangesets,!1,!0,"undo"),e&&this._sheet.setSelection(e),!0)}},{key:"_addUndoProxyTargetChangesets",value:function(e,t,r,n){var a=e.sheet(),o=e.rowFrom(),i=e.colFrom(),u=e.rowCount(),s=e.colCount(),l=a&&a._getModel();a&&l&&l.iterContentWithPos(o,i,u,s).forEach((function(e){var o=(0,g.Z)(e,2)[1],i=o.row,u=o.col;if(a.isProxyArrayFormula(i,u)){var s=a.getVar(i,u),l="row"===r?i-t:i,c="col"===r?u-t:u,h=a.getVar(l,c);s.isSameFormula(h)||n.push({action:"setCell",sheet_id:a.id(),target:{row:l,col:c},value:{formula:a.getFormula(l,c),value:a.getValue(l,c),multipleValues:a.getMultipleValuesJSON(l,c)}})}}))}},{key:"_getSetCellChangeset",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;return{action:"setCell",sheet_id:r.id(),target:{row:e,col:t},value:{formula:a,value:n}}}},{key:"_addArrayFormulaChangesets",value:function(e,t,r,n,a){var o=this,i=e.sheet(),u=e.rowFrom(),s=e.colFrom(),l=e.rowCount(),c=e.colCount(),h=i&&i._getModel();h&&i&&h.iterContentWithPos(u,s,l,c).forEach((function(u){var s=(0,g.Z)(u,2)[1],h=s.row,f=s.col;if(i.isProxyArrayFormula(h,f)){var d=i.getVar(h,f),v=d.formula,p=d.getArrayRef(),m=p.rowFrom(),y=p.colFrom(),_=p.rowTo(),R=p.colTo(),C="row"===r?h+t:h,w="col"===r?f+t:f,E=e.contain(v.getRef());if(!E&&t<0&&("row"===r&&m+l>C||"col"===r&&y+c>w))n.push(o._getSetCellChangeset(C,w,i,i.getValue(h,f)));else if(!E&&t>0&&("row"===r&&_<C||"col"===r&&R<w)){var k="row"===r?C-1:C,T="col"===r?w-1:w;n.push(o._getSetCellChangeset(k,T,i,i.getValue(h,f)))}a.push(o._getSetCellChangeset(h,f,i))}}))}},{key:"_redoAction",value:function(){if(!this.canExecute())return!1;this._command.highLightRg=this._command.sourceRg;var e=this._getFinalHightRange(),t=this._sheet.getParent();return!!this.checkRangeValid(t,this._command._changesets)&&(t.applyActions(this._command._changesets,!1,!0,"redo"),e&&this._sheet.setSelection(e),!0)}},{key:"_getFinalHightRange",value:function(){var e=this._command,t=e.sourceRg,r=e.targetRg;return t instanceof iu?r.rowFrom()>=t.rowFrom()?new iu(r.rowFrom()-t.rowCount(),t.rowCount(),this._sheet):new iu(r.rowFrom(),t.rowCount(),this._sheet):t instanceof nu?r.colFrom()>=t.colFrom()?new nu(r.colFrom()-t.colCount(),t.colCount(),this._sheet):new nu(r.colFrom(),t.colCount(),this._sheet):null}},{key:"saveConditionalFormatActions",value:function(e,t,r){var n=t instanceof nu?"col":"row",a=e.conditionalFormatModel.helper.getAdjustedRulesByMoveRowCol(e,n,t,r);this.setConditionalFormatChangeSet(a,e)}},{key:"setConditionalFormatChangeSet",value:function(e,t){var r=this;e.size<=0||e.forEach((function(e,n){var a=p6(t,n);if(a){var o=e.attrs,i=void 0===o?null:o,u=e.newBaseRanges,s=void 0===u?null:u,l=Object.assign({},a);null!==i&&(l.attrs=i),null!==s&&(l.ranges=s.map((function(e){return gu(e,!0)})));var c=g6(t,n,l);c&&((0,Ce.hTd)(r._command._changesets,c.actions),(0,Ce.hTd)(r._command._oldChangesets,c.oldActions))}}))}},{key:"saveExtendFilterChangeSets",value:function(e,t){var r=this._sheet,n=this._command,a=n._changesets,o=n._oldChangesets;if(e instanceof iu){var i=function(e,t,r){var n={actions:[],oldActions:[]};try{if(Gv(e,t.rowFrom(),t.colFrom(),t.rowCount(),t.colCount()))return n;var a=e.sheetFilterModel.filterRange;if(null!=a&&a.isValid()&&!t.contain(a)){var o=tp(e,a,{sourceRange:t,targetRange:r}),i=o.targetRow;if(o.shouldExtend){var u=up(a,{sourceRange:t,targetRange:r}),s=u.adjustRange,l=u.offset,c=rp(e,s,i+l,!1).actions;(0,Ce.hTd)(n.actions,c)}var h=rp(e,a,i,!1).oldActions;(0,Ce.hTd)(n.oldActions,h)}var f,d=yr(Xv(e));try{for(d.s();!(f=d.n()).done;){var v=f.value,p=v.name,m=v.id,g=v.range;if(!t.contain(g)){var y=tp(e,g,{sourceRange:t,targetRange:r}),_=y.targetRow;if(y.shouldExtend){var R=up(g,{sourceRange:t,targetRange:r}),C=R.adjustRange,w=R.offset,E=rp(e,C,_+w,!1,!1,p,m).actions;(0,Ce.hTd)(n.actions,E)}var k=rp(e,g,_,!1,!1,p,m).oldActions;(0,Ce.hTd)(n.oldActions,k)}}}catch(e){d.e(e)}finally{d.f()}}catch(e){console.error("extendFilterHelper.ts: getFilterExtendChangeSetsByDragRow error")}return n}(r,e,t),u=i.actions,s=i.oldActions;(0,Ce.hTd)(a,u),(0,Ce.hTd)(o,s)}else(0,Ce.hTd)(o,function(e,t,r){var n=[];try{var a=e.id(),o=e.sheetFilterModel.filterRange;(null==o?void 0:o.isValid())&&(o.intersect(t)||o.intersect(r))&&!t.contain(o)&&n.push({action:"setFilter",sheet_id:a,target:Av(o,!0),value:null});var i,u=yr(Xv(e));try{for(u.s();!(i=u.n()).done;){var s=i.value,l=s.id,c=s.range;(null==c?void 0:c.isValid())&&(c.intersect(t)||c.intersect(r))&&!t.contain(c)&&n.push((0,Ce.eRv)(a,{range:Av(c),view_id:l}))}}catch(e){u.e(e)}finally{u.f()}}catch(e){console.error("extendFilterHelper.ts: getFilterExtendChangeSetsByDragRow error")}return n}(r,e,t))}},{key:"saveOutlineAdjustChangeSets",value:function(e,t){var r,n,a,o,i=function(e,t,r){var n=t.rgType,a=n===Ce.xj7.ROW||n===Ce.xj7.COL,o=[],i=[],u=[],s=[],l=[];if(!a)return{newCsAddOutline:o,newCsDelOutline:i,oldCsAddOutline:u,oldCsDelOutline:s};var c=n===Ce.xj7.ROW,h=e.outlineGroupModel,f=fre(t,c),d=(0,g.Z)(f,2),v=d[0],p=d[1],y=Pu(v,p,c),_=Pu(v-1,1,c),R=Pu(v+p,1,c),C=h.getInfluencedOutlines(_).filter((function(e){return e.start+e.count===v})),w=h.getInfluencedOutlines(R).filter((function(e){return e.start===v+p})),E=fre(r,c),k=(0,g.Z)(E,2),T=k[0],S=k[1],A=T-v,I=h.getInfluencedOutlines(y),O=Pu(T,1,c),V=h.getInfluencedOutlines(O).filter((function(e){return e.start!==T}));if(w.length&&C.length&&(0,ge.Z)(w.concat(C)).forEach((function(t){if(t.state===Au.Fold){var r=Pu(A>0?t.start:t.start+p,t.count,t.type===Ce.xj7.ROW);s.push(lre(e.id(),r,t.state))}})),I.length)I.forEach((function(t){var r=t.start,n=t.count,a=t.state,o=Zu([r,n],[v,p]);l.push([].concat((0,m.Z)(o),[a]));var s=Pu(o[0],o[1],c),h=Pu(o[0]+p,o[1],c);A>0?(i.push(sre(e.id(),s)),u.push(ure(e.id(),s,a))):(i.push(sre(e.id(),h)),u.push(ure(e.id(),h,a)))})),l.forEach((function(t){var r=Pu(t[0]+A,t[1],c);o.push(ure(e.id(),r,t[2])),s.push(sre(e.id(),r))}));else{for(var N=0;N<V.length;N++)l.push([T,S,Au.Expand]);l.forEach((function(t){var r=Pu(t[0],t[1],c);o.push(ure(e.id(),r,t[2])),s.push(sre(e.id(),r))}))}return{newCsAddOutline:o,newCsDelOutline:i,oldCsAddOutline:u,oldCsDelOutline:s}}(this._sheet,e,t),u=i.newCsAddOutline,s=i.newCsDelOutline,l=i.oldCsAddOutline,c=i.oldCsDelOutline,h=function(e,t){return{newCsIndex:{add:e.findIndex((function(e){return"addRow"===e.action||"addCol"===e.action})),del:e.findIndex((function(e){return"delRow"===e.action||"delCol"===e.action}))},oldCsIndex:{add:t.findIndex((function(e){return"addRow"===e.action||"addCol"===e.action})),del:t.findIndex((function(e){return"delRow"===e.action||"delCol"===e.action}))}}}(this._command._changesets,this._command._oldChangesets),f=h.newCsIndex,d=h.oldCsIndex;(r=this._command._changesets).splice.apply(r,[f.add+1,0].concat((0,m.Z)(u))),(n=this._command._changesets).splice.apply(n,[f.del,0].concat((0,m.Z)(s))),(a=this._command._oldChangesets).splice.apply(a,[d.add+1,0].concat((0,m.Z)(l))),(o=this._command._oldChangesets).splice.apply(o,[d.del,0].concat((0,m.Z)(c)))}},{key:"commandName",get:function(){return Ce.rvF.MOVE_ROW_COL}}]),t}(Qte),Zne=function(e){function t(e,r,n){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"undo",value:function(){return this._changesetsToAction(this._command._oldChangesets),!0}},{key:"generateActions",value:function(){return this._saveChangesets(),!!this.checkRangeValid(this._sheet.parent,this._command._changesets)}},{key:"_doAction",value:function(){return!!this.generateActions()&&this._changesetsToAction(this._command._changesets)}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._changesetsToAction(this._command._changesets)}},{key:"_saveChangesets",value:function(){var e=this._command,t=e.sourceIndex,r=e.targetIndex;this._actionToChangesets(t,r,!1),this._actionToChangesets(r,t,!0)}},{key:"_actionToChangesets",value:function(e,t,r){var n=r?this._command._oldChangesets:this._command._changesets,a=this._sheet;n.push({action:"moveSheet",sheet_id:a.id(),value:{source:e,target:t,sheet_name:a.name()}})}},{key:"_changesetsToAction",value:function(e){return this._applySpreadChangsetWithEvent(this._sheet.parent,e,!0)}},{key:"canUndo",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._oldChangesets)}},{key:"commandName",get:function(){return Ce.rvF.MOVE_SHEET}}]),t}(Qte),xne=function(e){function t(e,r,n){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return!(this._command.isFirstExecution&&!this.generateActions())&&this._doAction()}},{key:"generateActions",value:function(){return this._saveChangesets(),!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)}},{key:"undo",value:function(){return this._changesetsToAction(this._command._oldChangesets),!0}},{key:"_doAction",value:function(){return this._changesetsToAction(this._command._changesets),!0}},{key:"_saveChangesets",value:function(){switch(this._command.property_name||"name"){case"visibility":this.handleSetHiddenChangeSet();break;case"gridLine":this.handleSetGridLineChangeSet();break;case"tabColor":this.handleSetTabColorChangeSet();break;case"tabType":this.handleSetTabTypeChangeSet();break;default:this.handleSetNameChangeSet()}}},{key:"handleSetNameChangeSet",value:function(){var e=this._sheet.name(),t=this._command.name;this._actionToChangesets({originName:e,newName:t,isUndo:!1,property_name:"name"}),this._actionToChangesets({originName:t,newName:e,isUndo:!0,property_name:"name"})}},{key:"handleSetTabTypeChangeSet",value:function(){var e=this._sheet.name(),t=this._command.tab_type;this._actionToChangesets({originName:e,isUndo:!1,property_name:"tabType",tab_type:t,no_history:!0}),this._actionToChangesets({originName:e,isUndo:!0,property_name:"tabType",tab_type:t,no_history:!0})}},{key:"handleSetTabColorChangeSet",value:function(){var e=this._sheet.name(),t=this._sheet.tabColor.getTabColor(),r=this._command.tab_color;this._actionToChangesets({originName:e,isUndo:!1,property_name:"tabColor",tab_color:r}),this._actionToChangesets({originName:e,isUndo:!0,property_name:"tabColor",tab_color:t})}},{key:"handleSetHiddenChangeSet",value:function(){var e=this._sheet.name(),t=this._command.hidden;this._actionToChangesets({originName:e,isUndo:!1,property_name:"visibility",hidden:t}),this._actionToChangesets({originName:e,isUndo:!0,property_name:"visibility",hidden:!t})}},{key:"handleSetGridLineChangeSet",value:function(){var e=this._sheet.name(),t=this._command.grid_line_hidden;this._actionToChangesets({originName:e,isUndo:!1,property_name:"gridLine",grid_line_hidden:t}),this._actionToChangesets({originName:e,isUndo:!0,property_name:"gridLine",grid_line_hidden:!t})}},{key:"_actionToChangesets",value:function(e){var t=e.isUndo?this._command._oldChangesets:this._command._changesets,r=e.originName,n=e.newName,a=e.property_name,o=e.hidden,i=e.grid_line_hidden,u=e.tab_color,s=e.tab_type,l=e.no_history;t.push({action:"setSheet",sheet_id:this._sheet.id(),no_history:l,value:{origin_name:r,sheet_name:n||r,property_name:a,hidden:o,grid_line_hidden:i,tab_color:u,tab_type:s}})}},{key:"_changesetsToAction",value:function(e){return this._applySpreadChangsetWithEvent(this._sheet.parent,e,!0)}},{key:"commandName",get:function(){return"setSheetProperty"}}]),t}(Qte);!function(e){e.DO="DO",e.UNDO="UNDO",e.REDO="REDO"}(Tne||(Tne={})),function(e){e[e.SUCC=0]="SUCC",e[e.FORMULA_CALC_ERR=1]="FORMULA_CALC_ERR",e[e.DIFF_FROM_OLD=2]="DIFF_FROM_OLD",e[e.DIFF_FROM_OLD_RANDOM=3]="DIFF_FROM_OLD_RANDOM"}(Sne||(Sne={})),function(e){e.CURRENT_WORKSHEET="currentWorksheet",e.ALL_WORKSHEET="allWorksheet",e.CURRENT_RANGES="currentRanges"}(Ane||(Ane={})),function(e){e.CommandError="CommandError"}(Ine||(Ine={})),function(e){e[e.Visible=0]="Visible",e[e.Filter=1]="Filter"}(One||(One={})),function(e){e[e.ArrayFormulaExpanded=0]="ArrayFormulaExpanded",e[e.StyleChanged=1]="StyleChanged"}(Vne||(Vne={})),function(e){e[e.SetComment=0]="SetComment",e[e.AddActiveComment=1]="AddActiveComment",e[e.RemoveActiveComment=2]="RemoveActiveComment",e[e.ClearActiveComment=3]="ClearActiveComment"}(Nne||(Nne={})),function(e){e[e.Add=0]="Add",e[e.Del=1]="Del",e[e.Drop=2]="Drop"}(bne||(bne={}));var Dne=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"doAction",value:function(){var e=this,t=this._sheet,r=t.getParent(),n=this._command,a=n.items,o=n.find,i=n.replace,u=n.scope,s=n.condition;if(a&&1===a.length){var l=a[0];this._beforeAction(t),l&&this.replaceOne(l,o,i,t,s)}else if(u===Ane.ALL_WORKSHEET){var c,h=new Set(a.map((function(e){return e.sheetId}))),f=yr(h);try{var d=function(){var t=c.value,n=r.getSheetFromId(t),u=a.filter((function(e){return e.sheetId===t}));if(!e.replaceAll(n,o,i,u,s))return{v:!1}};for(f.s();!(c=f.n()).done;){var v=d();if("object"===(0,R.Z)(v))return v.v}}catch(e){f.e(e)}finally{f.f()}}else if(!this.replaceAll(t,o,i,a,s))return!1;return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&(this._applyChangsetWithEvent(this._command._changesets),1!==a.length&&u&&u!==Ane.CURRENT_WORKSHEET&&u!==Ane.CURRENT_RANGES?r.sheets.forEach((function(t){return e._afterAction(t)})):this._afterAction(t),!0)}},{key:"rangeIsValid",value:function(e,t,r){var n=!1;for(var a in r){var o=r[a];if(e>=o.row&&e<o.row+o.rowCount&&t>=o.col&&t<o.col+o.colCount){n=!0;break}}return n}},{key:"createFindRegExp",value:function(e,t){var r="ig";return void 0!==t&&"boolean"==typeof t.matchCase&&(r=t.matchCase?"igm":"gm"),null!=t&&t.searchRegex?new RegExp(e,r):new RegExp((0,C.Z)(e),r)}},{key:"processFormula",value:function(e,t,r,n){if(void 0!==n&&n.includeFormulas){var a="=".concat(e);if(!n.matchEntireCell)return a.replace(r,t);if(a.replace(r,t)===t)return t}}},{key:"processOldCellValue",value:function(e,t,r,n){var a=e.getChangesetValue(t,r),o=e.getReminderChangeset(t,r),i=e.getMultipleValues(t,r),u=e.getFormula(t,r),s=e.getFormulaData(t,r,void 0,void 0,!0);n.value=a,n.reminder=o,n.multipleValues=i&&i.toJSON(),n.formula=u,n.formulaData=s}},{key:"processCellContentData",value:function(e,r,n,a,o,i){if(e.getMultipleValues(r,n)&&!a.includes(",")){var u=new l_(e.parent);o.multipleValues=u.fromString(a).toJSON()}else{var s,l,c,h=e.getCellStyle(r,n),f=_g._parseText2Value(e.formatterService,h,a,!0),d=null!==(s=null==f?void 0:f.value)&&void 0!==s?s:null;if(o.value=""===d?null:d,i){if(!a||"string"!=typeof a||a.length<=1||!t.FORMULA_TAGS.includes(a[0]))return;var v=n_(e,r,n,a);if(!v.isFormula())return;l=v}else{var p=mee(r,n,e,a);if(!p.isFormula)return;l=p.formulaVar,c=p.text}if(!l)return;var m=Tp(l,{ref:l.getRef()},{refType:1});if(dv(l)){var g=e.getParent(),y=g.importRangeManager,_=g.importRangeManagerV3;if(_.V3Enable)_.compileImportRange(l,!0,!0);else{if(y.isImportRangeNumExceedLimit())return void Ce.Ps3.Toast.error({key:"crossTableError_num",closable:!0,content:cr("sheet.cross_table_reference_num_limit_error")});var R=l.getExternalDataReferenceInfo();if(R){var C=y.generateAndCacheId(l,{sheetID:e.id(),url:R.url,range:R.range});if(C){var w=C.spreadToken,E=C.ref,k=C.isSyncStyle,T=C.importRangeId,S=C.spreadSource;m.externalDataReference={spreadToken:w,ref:E,isSyncStyle:k,importRangeId:T,spreadSource:S}}}}}i||(o.formula=c),o.formulaData=m,o.value=null}}},{key:"replaceCore",value:function(e,t,r,n,a,o,i,u){if(!this.checkCellValid(e,t,r))return!1;if(void 0!==i&&void 0!==i.ranges&&!this.rangeIsValid(t,r,i.ranges))return!1;o.formula=void 0,o.formulaData=void 0,o.value=void 0;var s=this.createFindRegExp(n,i),l=(0,Ce.ATv)(e.getText(t,r)),c=l.replace(s,a);if(e.hasFormula(t,r)){var h,f=e.getFormula(t,r);c=null!==(h=this.processFormula(f,a,s,i))&&void 0!==h?h:c}return c!==l&&(this.processCellContentData(e,t,r,c,o,u),!0)}},{key:"replaceImpl",value:function(e,t,r,n,a){var o={},i={};return this.processOldCellValue(n,e.row,e.col,o),this.replaceCore(n,e.row,e.col,t,r,i,a)?(o.formula===i.formula&&o.value===i.value||(this.sheetCellValueToChangeset(n.id(),e.row,e.col,o,!0),this.sheetCellValueToChangeset(n.id(),e.row,e.col,i,!1)),{IsMatch:!0,cellValue:i}):{IsMatch:!1,cellValue:null}}},{key:"replaceOne",value:function(e,t,r,n,a){var o=e.hasFormula,i=e.hasPivotTable;return!((null==a||!a.includeFormulas)&&o||i)&&this.replaceImpl(e,t,r,n,a).IsMatch}},{key:"replaceAll",value:function(e,t,r,n,a){this._beforeAction(e);var o=this.getMinBoundingRect(n);if(o){var i,u=t7(e.id(),o),s=t7(e.id(),o),l={},c={reminder:null},h={ignoreStyle:!0,ignoreDataValidation:!0,ignorePivotTable:!0,ignoreFilterRow:!0,cellValue:l},f={ignoreStyle:!0,ignoreDataValidation:!0,ignorePivotTable:!0,ignoreFilterRow:!0,cellValue:c},d=yr(n);try{for(d.s();!(i=d.n()).done;){var v=i.value,p=v.hasFormula,m=v.hasPivotTable;(null==a||!a.includeFormulas)&&p||m||(this.processOldCellValue(e,v.row,v.col,l),this.replaceCore(e,v.row,v.col,t,r,c,a,!0)&&(l.formula===c.formula&&l.value===c.value||(h.ignoreFormulaData=!l.formulaData,J8(v.row,v.col,h,s,e),f.ignoreFormulaData=!c.formulaData,J8(v.row,v.col,f,u,e))))}}catch(e){d.e(e)}finally{d.f()}return Q8(s),Q8(u),this._setRangeValuesActionToChangeset(s,!0),this._setRangeValuesActionToChangeset(u,!1),!0}}},{key:"getMinBoundingRect",value:function(e){if(0===e.length)return null;var t,r=1/0,n=-1/0,a=1/0,o=-1/0,i=Math.min,u=Math.max,s=yr(e);try{for(s.s();!(t=s.n()).done;){var l=t.value;r=i(r,l.row),n=u(n,l.row),a=i(a,l.col),o=u(o,l.col)}}catch(e){s.e(e)}finally{s.f()}return{row:r,col:a,rowCount:n-r+1,colCount:o-a+1}}},{key:"sheetCellValueToChangeset",value:function(e,t,r,n,a){(a?this._command._oldChangesets:this._command._changesets).push(this.sheetCellValueAction(e,t,r,n))}},{key:"commandName",get:function(){return Ce.rvF.REPLACE}},{key:"isSearchCurrentRanges",get:function(){return this._command.scope===Ane.CURRENT_RANGES}}]),t}(Qte);Dne.FORMULA_TAGS=["=","+"];var Pne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"canUndo",value:function(){return(0,f.Z)((0,v.Z)(t.prototype),"canUndo",this).call(this)&&this._command._canUndo}},{key:"undo",value:function(){var e=this._applyChangsetWithEvent(this._command._oldChangesets);return this._raiseColumnWidthChanged(this._command._colList),e}},{key:"_doAction",value:function(){var e=!1;if(this.canExecute())try{if(!this.generateActions())return e;e=this._applyChangsetWithEvent(this._command._changesets,!0)}finally{this._afterAction(this._sheet)}return e}},{key:"generateActions",value:function(){var e=!1,t=this._command,r=t.isLocal,n=void 0!==r&&r,a=this._sheet,o=t.columns,i=o&&o.length,u=Number.MAX_VALUE;if(a&&i>0){var s=t._colList=this._getColList(o),l={sheet:a,sheetName:a.name(),colList:s,cancel:!1};if(l&&!0===l.cancel)return!1;t._canUndo=!0,this._beforeAction(a);for(var c=a._scrollLeftCol,h=c,f=a.frozenColumnCount(),d=c-1;d>=f&&!a.getColumnVisible(d);d--)h=d;for(var v=u,p=t.size,m=0;m<i;m++){var g=o[m],y=g.target;if(!this.batchSetColumnWidth(g,p,3,n))return!1;e=!0,v=Math.min(y,v)}v!==u&&v<=c&&h!==c&&(a._scrollLeftCol=h)}return e}},{key:"batchSetColumnWidth",value:function(e,t,r,n){this.batchUndoChangeset(e,r,n);var a=Math.max(1,t);return this.batchColumnWidthToChangeset(e,a,!1,n),this.checkRangeValid(this._sheet.parent,this._command._changesets)}},{key:"batchUndoChangeset",value:function(e,t,r){for(var n,a=this._sheet,o=a.getColumnCount(),i=e.target,u=e.count,s=0,l=i,c=i;c<i+u;c++)if(0<=c&&c<o){var h=a._getActualColumnWidth(c,t);void 0===n&&(n=h),h===n?s++:(this.batchColumnWidthToChangeset({target:l,count:s},n,!0,r),l=c,s=1,n=h)}s>0&&this.batchColumnWidthToChangeset({target:l,count:s},n,!0,r)}},{key:"_redoAction",value:function(){if(!0!==this.checkRangeValid(this._sheet.parent,this._command._changesets))return!1;var e=this._applyChangsetWithEvent(this._command._changesets);return this._raiseColumnWidthChanged(this._command._colList),e}},{key:"_getColList",value:function(e){for(var t=[],r=0,n=e.length;r<n;r++)for(var a=e[r],o=a.target,i=a.count,u=o;u<o+i;u++)t.push(u);return t}},{key:"_raiseColumnWidthChanged",value:function(e){var t=this._sheet,r={sheet:t,sheetName:t.name(),colList:e};t.notifyShell(13,r)}},{key:"commandName",get:function(){return Ce.rvF.RESIZE_COLUMN}}]),t}(Qte),$ne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"canUndo",value:function(){return(0,f.Z)((0,v.Z)(t.prototype),"canUndo",this).call(this)&&this._command._canUndo}},{key:"undo",value:function(){var e=this._applyChangsetWithEvent(this._command._oldChangesets);return this._raiseRowHeightChanged(this._command._rowList),e}},{key:"_doAction",value:function(){var e=!1;if(this.canExecute()){var t=this._command,r=t.rows,n=t._rowList=this._getRowList(r);try{if(!this.generateActions())return e;e=this._applyChangsetWithEvent(this._command._changesets,!0)}finally{this._afterAction(this._sheet)}this._raiseRowHeightChanged(n)}return e}},{key:"generateActions",value:function(){var e=!1,t=this._sheet,r=this._command,n=r.isLocal,a=void 0!==n&&n,o=r.rows,i=o&&o.length,u=Number.MAX_VALUE;if(t&&i>0){var s=r._rowList=this._getRowList(o),l={sheet:t,sheetName:t.name(),rowList:s,cancel:!1};if(l&&!0===l.cancel)return e;r._canUndo=!0,this._beforeAction(t);for(var c=t._scrollTopRow,h=c,f=t.frozenRowCount(),d=c-1;d>=f&&!t.getRowVisible(d);d--)h=d;for(var v=u,p=r.size,m=0;m<i;m++){var g=o[m],y=g.target;if(!this.batchSetRowHeight(g,p,3,a))return!1;e=!0,v=Math.min(y,v)}v!==u&&v<=c&&h!==c&&(t._scrollTopRow=h)}return e}},{key:"batchSetRowHeight",value:function(e,t,r,n){this.batchUndoChangeset(e,r,n);var a=Math.max(1,t);return this.batchRowHeightToChangeset(e,a,!1,n),this.checkRangeValid(this._sheet.parent,this._command._changesets)}},{key:"batchUndoChangeset",value:function(e,t,r){for(var n,a=this._sheet,o=a.getRowCount(),i=e.target,u=e.count,s=0,l=i,c=i;c<i+u;c++)if(0<=c&&c<o){var h=a._getActualRowHeight(c,t);void 0===n&&(n=h),h===n?s++:(this.batchRowHeightToChangeset({target:l,count:s},n,!0,r),l=c,s=1,n=h)}s>0&&this.batchRowHeightToChangeset({target:l,count:s},n,!0,r)}},{key:"_redoAction",value:function(){if(!0!==this.checkRangeValid(this._sheet.parent,this._command._changesets))return!1;var e=this._applyChangsetWithEvent(this._command._changesets);return this._raiseRowHeightChanged(this._command._rowList),e}},{key:"_getRowList",value:function(e){for(var t=[],r=0,n=e.length;r<n;r++)for(var a=e[r],o=a.target,i=a.count,u=o;u<o+i;u++)t.push(u);return t}},{key:"_raiseRowHeightChanged",value:function(e){var t=this._sheet,r={sheet:t,sheetName:t.name(),rowList:e};t.notifyShell(8,r)}},{key:"commandName",get:function(){return Ce.rvF.RESIZE_ROW}}]),t}(Qte),Lne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return!(this._command.isFirstExecution&&!this._saveChangesets())&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"creatAddChartAction",value:function(e){var t=this._sheet.id(),r={action:"setChart",sheet_id:t,target:{row:e.data.blockSetting.row,col:e.data.blockSetting.col},value:this.clearRangeInChartBlock(e.data)};return this._sheet.getChartById(e.chartId)?(console.error("chartId ".concat(e.chartId,"  add")),!1):{cs:r,oldCs:{action:"delChart",sheet_id:t,value:{chartId:e.chartId}}}}},{key:"creatSetChartAction",value:function(e){var t=this._sheet.id(),r={action:"setChart",sheet_id:t,target:{row:e.data.blockSetting.row,col:e.data.blockSetting.col},value:this.clearRangeInChartBlock(e.data)},n=this._sheet.getChartById(e.chartId);return n?{cs:r,oldCs:{action:"setChart",sheet_id:t,target:{row:n.blockSetting.row,col:n.blockSetting.col},value:this.clearRangeInChartBlock(n)}}:(console.error("chartId ".concat(e.chartId," ")),!1)}},{key:"creatDelChartAction",value:function(e){var t=this._sheet.id(),r={action:"delChart",sheet_id:t,value:{chartId:e.chartId}},n=this._sheet.getChartById(e.chartId);return n?{cs:r,oldCs:{action:"setChart",sheet_id:t,target:{row:n.blockSetting.row,col:n.blockSetting.col},value:this.clearRangeInChartBlock(n)}}:(console.error("chartId ".concat(e.chartId," ")),!1)}},{key:"_saveChangesets",value:function(){var e,t=this._command;switch(t.commandType){case 1:e=this.creatSetChartAction(t);break;case 0:e=this.creatAddChartAction(t);break;case 2:e=this.creatDelChartAction(t);break;default:throw new Error(" command Type")}return!!e&&(t._changesets.push(e.cs),t._oldChangesets.push(e.oldCs),!0)}},{key:"commandName",get:function(){return Ce.rvF.SET_CHART}}]),t}(Qte),Bne=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e){var t=this._sheet,r=this._command.target,n=r.row,a=r.col,o=this._command.value.comments,i=t.getComments(n,a)||[],u=(0,b.Z)(i,o).reverse();return this._command._changesets.push({sheet_id:t.id(),action:"addComments",target:this._command.target,value:this._command.value}),!0===this.checkRangeValid(t.parent,this._command._changesets)&&(t._setComments(n,a,(0,N.Z)(u,"id").reverse()),!0)}},{key:"commandName",get:function(){return Ce.rvF.SET_COMMENTS}}]),t}(Qte),Une=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){if(this._command.isFirstExecution){if(!this._saveChangesets())return!1}else this._sheet.dispatch("ConditionalFormatChanged",{type:"Redo"});return this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._sheet.dispatch("ConditionalFormatChanged",{type:"Undo"}),this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_saveChangesets",value:function(){var e=this._sheet,t=!1,r=this._command;switch(r.commandType){case"add":t=function(e,t){var r=e.id(),n=t.cfId||iS(e),a=e.conditionalFormatModel.getLastIndex();return{actions:[{action:"addConditionalFormat",sheet_id:r,value:Object.assign({},t,{cfId:n,index:a})}],oldActions:[{action:"delConditionalFormat",sheet_id:r,value:{cfId:n,index:a}}]}}(e,r.data);break;case"set":r.cfId&&(t=g6(e,r.cfId,r.data));break;case"del":t=v6(e,r.cfIds);break;case"clearRange":t=d6(e,r.ranges,{source:r.source});break;case"move":t=function(e,t){return!(!t||void 0===t.oldIndex||void 0===t.newIndex)&&{actions:[{action:"moveConditionalFormat",sheet_id:e.id(),value:{source:t.oldIndex,target:t.newIndex}}],oldActions:[{action:"moveConditionalFormat",sheet_id:e.id(),value:{source:t.newIndex,target:t.oldIndex}}]}}(e,r.data);break;default:throw new Error(" command Type")}return!!t&&((0,Ce.hTd)(r._changesets,t.actions),(0,Ce.hTd)(r._oldChangesets,t.oldActions),!0)}},{key:"commandName",get:function(){return Ce.rvF.SET_CONDITIONAL_FORMAT}}]),t}(Qte),Hne=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))).execute=function(){return!(n.command.isFirstExecution&&!n.saveDataToChangesets())&&!!n.checkRangeValid(n._sheet.parent,n._command._changesets)&&n._applyChangsetWithEvent(n.command._changesets,!0)},n.undo=function(){return n._applyChangsetWithEvent(n.command._oldChangesets,!0,"undo")},n.saveSetRangeAction=function(){var e=n.command.data;return!!e&&(e.forEach((function(e){e?(n.command._changesets.push(n.getSetDataRangeAction(e)),n.command._oldChangesets.push(n.getDelDataRangeAction(e))):console.warn("Chart dataRange is null")})),!0)},n.saveDelRangeAction=function(){var e=n.command.data;return!!e&&(e.forEach((function(e){e?(n.command._changesets.push(n.getDelDataRangeAction(e)),n.command._oldChangesets.push(n.getSetDataRangeAction(e))):console.warn("Chart dataRange is null")})),!0)},n.saveDataToChangesets=function(){switch(n.command.commandType){case 0:return n.saveSetRangeAction();case 1:return n.saveDelRangeAction();default:return!1}},n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"commandName",get:function(){return Ce.rvF.SET_DATA_RANGE}}]),t}(Qte),zne=W6._util,Wne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){var e=this._sheet,t=this._command,r=t.row,n=t.col,a=t._changesets,o=t.text,i=!1,u=e.getSpan(r,n);if(u&&(u.rowFrom()!==r||u.colFrom()!==n))return i;this._beforeAction(e);try{if(this._command.isFirstExecution){var s=e.getStyleWithDropdown(r,n)||e.getDefaultStyle(),l=e.getChangesetValue(r,n),c=e.getFormula(r,n),h=e.getReminderChangeset(r,n);this._cellValueToChangeset(r,n,{style:s&&s.toJSON()||null,value:l,formula:c,reminder:h},!0);var f=zne._getValueAndStyleFromEditing(e,r,n,o,!1,!0),d=f.value,v=f.styleWithDropdown;if(e.setStyle(r,n,v.clone()),(0,ce.Z)(d)?e.setValue(r,n,(0,Ce.Tcw)(d)):e.setValue(r,n,d),v&&v.dropdown&&v.dropdown.list){var p=G9(e,r,n,v.dropdown);p!==v.dropdown.isValid&&(v.dropdown.isValid=p,e.setDropdown(r,n,v.dropdown))}if(this._cellValueToChangeset(r,n,{style:v&&v.toJSON()||null,value:e.getChangesetValue(r,n),reminder:null,formula:e.getFormula(r,n)}),!this.checkRangeValid(e.parent,a))return!1;i=this._applyChangsetWithEvent(a)}else{var m=this._sheet.getParent();if(!0!==this.checkRangeValid(m,this._command._changesets))return!1;i=this._applyChangsetWithEvent(a)}}catch(r){return Ce.Ps3.moirae.ravenCatch(r),this._afterAction(e),!1}return this._afterAction(e),i}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"commandName",get:function(){return Ce.rvF.SET_DROPDOWN_VALID}}]),t}(Qte),Gne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return!(this._command.isFirstExecution&&!this._saveChangesets())&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_saveChangesets",value:function(){var e,t=this._command;switch(t.commandType){case 1:e=this.createSetAction(t);break;case 0:e=this.createAddAction(t);break;case 2:e=this.createDelAction(t);break;default:throw new Error(" command Type")}return!!e&&((0,Ce.hTd)(t._changesets,e.cs),(0,Ce.hTd)(t._oldChangesets,e.oldCs),!0)}},{key:"createAddAction",value:function(e){var t=e.data,r=this._sheet.id(),n=[],a=[],o=t.blockSetting,i=t.position,u=t.blockToken,s=t.blockType,l={action:"setEmbeddedBlock",sheet_id:r,target:i,value:{blockSetting:o,blockToken:u,blockType:s}},c={action:"delEmbeddedBlock",sheet_id:r,target:i,value:{blockToken:u,blockType:s}};return n.push(l),a.push(c),{cs:n,oldCs:a}}},{key:"createSetAction",value:function(e){var t=e.data,r=this._sheet.id(),n=[],a=[],o=t.blockSetting,i=t.position,u=t.blockToken,s={action:"setEmbeddedBlock",sheet_id:r,target:i,value:{blockSetting:o,blockToken:u,blockType:t.blockType}},l=this._sheet.getEmbeddedBlockByToken(u);if(!l)throw new Error("can not find embedded block by token = ".concat(u));var c={action:"setEmbeddedBlock",sheet_id:r,target:l.position,value:{blockSetting:l.blockSetting,blockToken:l.blockToken,blockType:l.blockType}};return n.push(s),a.push(c),{cs:n,oldCs:a}}},{key:"createDelAction",value:function(e){var t=this,r=e.data,n=this._sheet.id(),a=[],o=[],i=r.blockToken,u=r.blockType,s=!r.reserveDepRanges,l=this._sheet.getEmbeddedBlockByToken(i);if(!l)throw new Error("can not find embedded block by token = ".concat(i));var c={action:"delEmbeddedBlock",sheet_id:n,target:l.position,value:{blockToken:i,blockType:u}},h={action:"setEmbeddedBlock",sheet_id:n,target:l.position,value:{blockSetting:l.blockSetting,blockToken:l.blockToken,blockType:l.blockType}};return a.push(c),o.push(h),s&&function(e,t,r){var n,a,o=null==e||null===(n=e.sheetBlocksManager)||void 0===n||null===(a=n.modelManager)||void 0===a?void 0:a.getBlockModel(r);if(!o)return[];try{if("PIVOT_TABLE"===t){var i=o.getSnapshot().rangeId,u=cV(e,i);return u?[u]:[]}return[]}catch(e){return console.error("delete embeddedBlock dep dataRange error",e),[]}}(this._sheet.parent,u,i).forEach((function(e){a.push(t.getDelDataRangeAction(e)),o.push(t.getSetDataRangeAction(e))})),{cs:a,oldCs:o}}},{key:"commandName",get:function(){return Ce.rvF.SET_EMBEDDED_BLOCK}}]),t}(Qte),jne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return rre(this._command,this._sheet,this._beforeAction.bind(this),this._doAction.bind(this),this._redoAction.bind(this),this._afterAction.bind(this))}},{key:"_doAction",value:function(e,r){var n,a=performance.now(),o=r.range,i=r.col,u=r.value,s=this._command,l=s._oldChangesets,c=s._changesets,h=e.getParent();if(o)if(null==i){var f=Av(o);n=t.getFirstSetFilterActions(e,f)}else{var d=Av(o);n=t.getSetFilterActions(e,i,u,d)}else n=t.getDeleteFilterActions(e);n&&n.actions&&(0,Ce.hTd)(c,n.actions),n&&n.oldActions&&(0,Ce.hTd)(l,n.oldActions);var v=performance.now();return!!this.tryApplyActions(h,c)&&(this.createCsTime=v-a,this.applyCsTime=performance.now()-v,!0)}},{key:"_redoAction",value:function(e){var t=this._sheet.getParent();return!!this.checkRangeValid(t,this._command._changesets)&&this._applyChangsetWithEvent(e._changesets)}},{key:"undo",value:function(){return this._afterAction(this._sheet),this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"getPerformanceInfo",value:function(){if(void 0!==this.createCsTime&&void 0!==this.applyCsTime)return{createCsTime:this.createCsTime,applyCsTime:this.applyCsTime}}},{key:"commandName",get:function(){return Ce.rvF.SET_FILTER}}],[{key:"getOldSetFilterActions",value:function(e){var t=e.sheetFilterModel,r=t.getInfo();if(!r)return null;var n=Av(r.range),a=[];return a.push({action:"setFilter",sheet_id:e.id(),target:n,value:null}),(0,m.Z)(t.getValidFilterRules()).forEach((function(t){var r=(0,g.Z)(t,1)[0],o=e.sheetFilterModel.getFilterInfo(r);o&&a.push({action:"setFilter",sheet_id:e.id(),target:n,value:o})})),a}},{key:"getDeleteFilterActions",value:function(e){return e.sheetFilterModel.getInfo()?{actions:[{action:"delFilter",sheet_id:e.id()}],oldActions:t.getOldSetFilterActions(e)||[]}:null}},{key:"getFirstSetFilterActions",value:function(e,t){return{actions:[{action:"setFilter",sheet_id:e.id(),target:t,value:null}],oldActions:[{action:"delFilter",sheet_id:e.id()}]}}},{key:"getSetFilterActions",value:function(e,t,r,n){null===r&&(r={type:null,compare:0,contents:null,expected:""});var a=r,o=a.type,i=a.compare,u=a.expected,s=a.contents,l=a.dateGroups,c=e.sheetFilterModel.getFilterInfo(t),h={col:t,type:null,compare:0,expected:"",contents:null};return{actions:[{action:"setFilter",sheet_id:e.id(),target:n,value:{col:t,type:0===o?null:o,compare:i,expected:u,contents:s,filteredRowsMap:e.sheetFilterModel.filterWithNewRule(o,t,i,u,s,l),dateGroups:l}}],oldActions:[{action:"setFilter",sheet_id:e.id(),target:n,value:c?Object.assign({},c):h}]}}}]),t}(Qte);function Yne(e,t){var r=e.viewsModel.getViewById(t);return r&&r.getFilterModel()}var qne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"generateUndoActions",value:function(e){var t=this._sheet,r=Yne(t,e);if(r){var n=this.command._oldChangesets;n.push((0,Ce.eRv)(t.id(),{view_id:e,range:void 0,calculate:!0}));var a=r.getFilterRange(),o=!a||a.colCount<=0||a.rowCount<=0?void 0:Iv(a);if(o)for(var i=o.col;i<o.col+o.col_count;i++){var u={col:i,type:null,compare:0,expected:"",contents:null},s=r.getFilterInfo(i);n.push((0,Ce.eRv)(t.id(),{view_id:e,filter_value:s?Object.assign({},(0,A.default)(s,"filteredRowsMap")):u,range:o,calculate:!0}))}}}},{key:"generateActionsForRange",value:function(e,t){var r=this._sheet;if(Yne(r,t)){var n=this.command._changesets;n.push((0,Ce.eRv)(r.id(),{view_id:t,range:void 0,calculate:!0})),e&&n.push((0,Ce.eRv)(r.id(),{view_id:t,range:Iv(e),calculate:!0}))}}},{key:"generateActions",value:function(e){var t=this._sheet,r=e.col,n=e.range,a=e.viewId,o=this._command,i=o.isLocal,u=o._changesets,s=t.id(),l=e.value;null===l&&(l={type:null,compare:0,contents:null,expected:""});var c=Yne(t,a),h=l,f=h.type,d=h.compare,v=h.expected,p=h.dateGroups,m=h.contents,g=null==c?void 0:c.getFilterRange(),y=(null==g?void 0:g.row)===(null==n?void 0:n.row)&&(null==g?void 0:g.col)===(null==n?void 0:n.col)&&(null==g?void 0:g.rowCount)===(null==n?void 0:n.rowCount)&&(null==g?void 0:g.colCount)===(null==n?void 0:n.colCount);y||u.push((0,Ce.eRv)(t.id(),{view_id:a,range:void 0,calculate:!0})),u.push((0,Ce.eRv)(s,{view_id:a,range:n?Iv(n):void 0,filter_value:{col:r,type:0===f?null:f,compare:d,expected:v,contents:m,dateGroups:p,filteredRowsMap:!i&&y?null==c?void 0:c.filterWithNewRule(f,r,d,v,m,p):void 0},calculate:!0}))}},{key:"execute",value:function(){return rre(this._command,this._sheet,this._beforeAction.bind(this),this._doAction.bind(this),this._redoAction.bind(this),this._afterAction.bind(this))}},{key:"_doAction",value:function(e,t){var r=t.range,n=t.col,a=t.value,o=t.viewId,i=this._command._changesets,u=e.getParent();return null==n?this.generateActionsForRange(r,o):this.generateActions({col:n,value:a,range:r,viewId:o}),this.generateUndoActions(o),!!this.tryApplyActions(u,i)}},{key:"_redoAction",value:function(e){var t=this._sheet.getParent();return!!this.checkRangeValid(t,this._command._changesets)&&this._applyChangsetWithEvent(e._changesets)}},{key:"undo",value:function(){return this._afterAction(this._sheet),this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"_afterAction",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];(0,f.Z)((0,v.Z)(t.prototype),"_afterAction",this).call(this,e,r),e.dispatch("FilterChanged")}},{key:"commandName",get:function(){return Ce.rvF.SET_FILTER_VIEW}}]),t}(Qte),Jne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return!(this._command.isFirstExecution&&!this._saveChangesets())&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_saveChangesets",value:function(){var e,t=this._command;switch(t.commandType){case 1:e=this.creatSetAction(t);break;case 0:e=this.creatAddAction(t);break;case 2:e=this.creatDelAction(t);break;default:throw new Error(" command Type")}return!!e&&((0,Ce.hTd)(t._changesets,e.cs),(0,Ce.hTd)(t._oldChangesets,e.oldCs),!0)}},{key:"creatAddAction",value:function(e){var t=e.data,r=this._sheet.id(),n=[],a=[],o=t.blockSetting,i=t.blockToken,u=t.blockType,s={action:"setFloatBlock",sheet_id:r,value:Object.assign({},o,{blockToken:i,blockType:u})},l={action:"delFloatBlock",sheet_id:r,value:{blockToken:i,blockType:u}};return n.push(s),a.push(l),{cs:n,oldCs:a}}},{key:"creatSetAction",value:function(e){var t=e.data,r=this._sheet.id(),n=[],a=[],o=t.blockSetting,i=t.blockToken,u=t.blockType,s={action:"setFloatBlock",sheet_id:r,value:Object.assign({},o,{blockToken:i,blockType:u})},l=this._sheet.getFloatBlockByToken(i);if(!l)throw new Error("can not find float block by token = ".concat(i));var c={action:"setFloatBlock",sheet_id:r,value:Object.assign({},l.blockSetting,{blockToken:l.blockToken,blockType:l.blockType})};return n.push(s),a.push(c),{cs:n,oldCs:a}}},{key:"creatDelAction",value:function(e){var t=this,r=e.data,n=this._sheet.id(),a=[],o=[],i=r.blockToken,u=r.blockType;r.skipDelDepsRanges||function(e,t){if(!e||!e.sheetBlocksManager||!e.sheetBlocksManager.modelManager)return[];var r=e.sheetBlocksManager.modelManager.getBlockModel(t);if(!r||"CHART"!==r.type||!r.dimensionManager)return[];var n=r.dimensionManager,a=n.getAllDimensionRefIds()||[],o=n.getAllBaseDimensionRefIds()||[],i=(0,ge.Z)([].concat((0,m.Z)(a),(0,m.Z)(o)));return Cte(e,i)}(this._sheet.parent,i).forEach((function(e){e&&(a.push(t.getDelDataRangeAction(e)),o.push(t.getSetDataRangeAction(e)))}));var s={action:"delFloatBlock",sheet_id:n,value:{blockToken:i,blockType:u}},l=this._sheet.getFloatBlockByToken(i);if(!l)throw new Error("can not find float block by token = ".concat(i));var c={action:"setFloatBlock",sheet_id:n,value:Object.assign({},l.blockSetting,{blockToken:l.blockToken,blockType:l.blockType})};return a.push(s),o.push(c),{cs:a,oldCs:o}}},{key:"commandName",get:function(){return Ce.rvF.SET_FLOAT_BLOCK}}]),t}(Qte);var Kne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return!(this._command.isFirstExecution&&!this._saveChangesets())&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"creatAddAction",value:function(e){var t=this,r=e.data,n=this._sheet.id(),a=[],o=[];return r.forEach((function(e){var r={action:"setFloatImage",sheet_id:n,target:{row:e.floatImageSetting.row,col:e.floatImageSetting.col},value:t.clearRangeInFloatImageBlock(e)},i={action:"delFloatImage",sheet_id:n,value:{floatImageId:e.floatImageId}};a.push(r),o.push(i)})),{cs:a,oldCs:o}}},{key:"creatSetAction",value:function(e){var t=this,r=e.data,n=this._sheet.id(),a=[],o=[];return r.forEach((function(e){var r={action:"setFloatImage",sheet_id:n,target:{row:e.floatImageSetting.row,col:e.floatImageSetting.col},value:t.clearRangeInFloatImageBlock(e)},i=t._sheet.getFloatImageById(e.floatImageId);if(i){var u={action:"setFloatImage",sheet_id:n,target:{row:i.floatImageSetting.row,col:i.floatImageSetting.col},value:t.clearRangeInFloatImageBlock(i)};a.push(r),o.push(u)}})),!!o.length&&{cs:a,oldCs:o}}},{key:"creatDelAction",value:function(e){var t=this,r=this._sheet.id(),n=e.floatImageIds,a=[],o=[];return n.forEach((function(e){var n={action:"delFloatImage",sheet_id:r,value:{floatImageId:e}},i=t._sheet.getFloatImageById(e);if(i){var u={action:"setFloatImage",sheet_id:r,target:{row:i.floatImageSetting.row,col:i.floatImageSetting.col},value:t.clearRangeInFloatImageBlock(i)};a.push(n),o.push(u)}})),!!o.length&&{cs:a,oldCs:o}}},{key:"_saveChangesets",value:function(){var e,t=this._command;switch(t.commandType){case 1:e=this.creatSetAction(t);break;case 0:e=this.creatAddAction(t);break;case 2:e=this.creatDelAction(t);break;default:throw new Error(" command Type")}return!!e&&((0,Ce.hTd)(t._changesets,e.cs),(0,Ce.hTd)(t._oldChangesets,e.oldCs),!0)}},{key:"commandName",get:function(){return Ce.rvF.SET_FLOAT_IMAGE}}]),t}(Qte),Xne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"_setRangeFormat",value:function(){var e=this,t=this._command,r=t.selections,n=t.value,a=this._sheet,o=this._sheet.getParent(),i={};i[pm]=(0,Ee.createFormatter)(a.formatterService,n).toJSON()||"",void 0===n&&(i[gm]=(0,Ee.createFormatter)(a.formatterService).toJSON()||"");var u=this.filterDuplicateRange(r,!0);if(function(){var e=window.location.search&&new URLSearchParams(window.location.search.substring(1)),t="format_change_value";return e&&e.has(t)?!!e&&"true"===e.get(t):Ce.Ps3.getFormatChangeValueEnabled()}()){var s={ignoreValue:!0,ignoreFormulaData:!0,ignoreMultipleValues:!0,ignoreReminder:!0,ignoreDataValidation:!0,ignorePivotTable:!0},l={ignoreValue:!0,ignoreFormulaData:!0,ignoreMultipleValues:!0,ignoreReminder:!0,ignoreDataValidation:!0,ignorePivotTable:!0},c=new Map;if(u.forEach((function(t){var r=!1,o=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{ignoreValue:!1,ignoreStyle:!1,ignoreDataValidation:!1,ignoreFilterRow:!1,ignorePivotTable:!1},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{ignoreValue:!1,ignoreStyle:!1,ignoreDataValidation:!1,ignoreFilterRow:!1,ignorePivotTable:!1},a=arguments.length>4?arguments[4]:void 0,o=arguments.length>5?arguments[5]:void 0,i=t7(e.id(),t),u=t7(e.id(),t);null==o||o(r,i);for(var s=t.row+t.rowCount-1,l=t.col+t.colCount-1,c=t.row;c<=s;c++)if(!r.ignoreFilterRow||e.filterModel.isVisible(c))for(var h=t.col;h<=l;h++)a(c,h,r,i,n,u,e);return Q8(i),Q8(u),{doSetRangeValueAction:i,undoSetRangeValueAction:u}}(a,t.toJSON(),s,l,(function(t,a,o,i,u,s,l){var h,f=o.ignorePivotTable,d=l.getChangesetValue(t,a,f),v=l.formatterService,p={formatter:{formatCached:n}},m=l.getCellStyle(t,a,void 0,!0)||l.getDefaultStyle(),g=m?s.styleRefMgr.getStyleId(m):null;if(u.styleId=g,void 0===(h=c.get(m))){var y=Om.withUpdateStyle(m,p,v);h=i.styleRefMgr.getStyleId(y),c.set(m,h)}o.styleId=h;var _={value:d,formulaData:void 0},C={value:d,formulaData:void 0};o.cellValue=_,u.cellValue=C;var w=(0,R.Z)(d);if("@"===n)l.hasFormula(t,a)?(o.cellValue.value="="+l.getFormula(t,a),u.ignoreFormulaData=!1,u.cellValue.formulaData=l.getFormulaData(t,a,void 0,f,!0),o.ignoreValue=!1,u.ignoreValue=!1):"number"===w&&null===l.getReminder(t,a)&&(o.cellValue.value=l.getText(t,a),o.ignoreValue=!1,u.ignoreValue=!1);else if("string"!==w||null!=n&&n.includes("@")||l.hasFormula(t,a)){if(Array.isArray(d)&&d.length){for(var E=!1,k=0;k<d.length;k++)if(Ce.PFf.has(d[k].type)){E=!0;break}E||(d=l.getVar(t,a).getValue(),e._updateValueFormStringToNumber(d,o,u,v))}}else e._updateValueFormStringToNumber(d,o,u,v);!1===o.ignoreValue&&!1===u.ignoreValue&&(r=!0),X8(t,a,l,i,o),X8(t,a,l,s,u),o.ignoreValue=!0,u.ignoreValue=!0})),u=o.doSetRangeValueAction,h=o.undoSetRangeValueAction;r?e._setRangeValuesActionToChangeset(u):e._rangeOpToChangeset(t,{style:i},!1),e._setRangeValuesActionToChangeset(h,!0)})),!0!==this.checkRangeValid(o,this._command._changesets))return!1}else{if(u.forEach((function(t){e._rangeOpToChangeset(t,{style:i},!1)})),!0!==this.checkRangeValid(o,this._command._changesets))return!1;var h={ignoreValue:!0,ignoreFormulaData:!0,ignoreMultipleValues:!0,ignoreReminder:!0,ignoreDataValidation:!0,ignorePivotTable:!0};r.forEach((function(t){e._setRangeValuesActionToChangeset(K8(a,t.toJSON(),h,J8),!0)}))}return this._applyChangsetWithEvent(this._command._changesets)}},{key:"_updateValueFormStringToNumber",value:function(e,t,r,n){var a=(0,Ee.getPreferredFormatter)(n,e);"number"==typeof a.value?(t.cellValue.value=a.value,t.ignoreValue=!1,r.ignoreValue=!1):"string"==typeof a.value&&(0,Ee.isBigNumber)(a.value)?(t.cellValue.value=Number(a.value),t.ignoreValue=!1,r.ignoreValue=!1):(0,Ee.isDateTimeFormatter)(a.formatter)&&a.value instanceof we.SheetDate&&(t.cellValue.value=a.value.toNumber(),t.ignoreValue=!1,r.ignoreValue=!1)}},{key:"_doAction",value:function(){return this._setRangeFormat()}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets)}},{key:"execute",value:function(){var e=!1,t=this._sheet;this._beforeAction(t);try{if(!(e=this._command.isFirstExecution?this._doAction():this._redoAction()))return!1}catch(e){return this._afterAction(t),Ce.Ps3.moirae.ravenCatch(e),!1}return this._afterAction(t),e}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"commandName",get:function(){return Ce.rvF.SET_FORMATTER}}]),t}(Qte);var Qne=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){var e=this._sheet,t=this._command._changesets,r=!1;this._beforeAction(e);try{if(this._command.isFirstExecution){if(this.doAction(),!this.checkRangeValid(e.parent,t))return!1;r=this._applyChangsetWithEvent(t)}else{var n=this._sheet.getParent();if(!0!==this.checkRangeValid(n,this._command._changesets))return!1;r=this._applyChangsetWithEvent(t)}}catch(t){return Ce.Ps3.moirae.ravenCatch(t),this._afterAction(e),!1}return this._afterAction(e),r}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"doAction",value:function(){var e=this,t=this._sheet;OT(this._command.selections,(function(r,n){v_(t,r,n)&&e._cellValueToMultipleValuesChangeset(r,n)}))}},{key:"_cellValueToMultipleValuesChangeset",value:function(e,t){var r=this._sheet;if(null==r.getMultipleValues(e,t)){var n=r.getChangesetValue(e,t);this._cellValueToChangeset(e,t,{value:n},!0);var a=p_(r,e,t);r.setValue(e,t,a),this._cellValueToChangeset(e,t,{multipleValues:a.toJSON()})}}},{key:"commandName",get:function(){return Ce.rvF.SET_MULTIPLE_VALUES_BY_RANGE}}]),t}(Qte);function eae(e,t,r,n,a){var o=new Map,i=new Map,u=K8(e,t.toJSON(),r,(function(e,t,r,u,s){var l,c=(null==a?void 0:a.get(e,t))||s.getCellStyle(e,t)||s.getDefaultStyle();if(void 0===(l=o.get(c))){var h=n(c,e,t);l=u.styleRefMgr.getStyleId(h),o.set(c,l),i.set(l,h),null==a||a.set(e,t,h)}else null==a||a.set(e,t,i.get(l));r.styleId=l,X8(e,t,s,u,r)}));return o.clear(),u}var tae,rae,nae=void 0,aae=function(e,t){return e.rowFrom()===t.rowFrom()?e.colFrom()-t.colFrom():e.rowFrom()-t.rowFrom()},oae=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"setRangeBorder",value:function(e){var t,r,n,a,o=e.selection,i=e.row,u=e.col,s=e.style,l=e.border,c=e.color,h=o.rowFrom()>-1?o.rowFrom():0,f=h+o.rowCount()-1,d=o.colFrom()>-1?o.colFrom():0,v=d+o.colCount()-1;if("noborder"===l)return Om.withBorders(s,{borderLeft:nae,borderTop:nae,borderRight:nae,borderBottom:nae,diagonal:nae,diagonalUp:nae,diagonalDown:nae},!0,"noborder");if(!c)throw new Error("no color");var p=new dm(c,1),m=new dm(c,1,tm.thin);switch(l){case"fullborder":return Om.withBorders(s,{borderLeft:p,borderTop:p,borderRight:p,borderBottom:p},!0);case"outerborder":i===h&&(n=p),i===f&&(a=p),u===d&&(t=p),u===v&&(r=p);break;case"innerborder":i!==h&&(n=p),i!==f&&(a=p),u!==d&&(t=p),u!==v&&(r=p);break;case"leftborder":u===d&&(t=p);break;case"rightborder":u===v&&(r=p);break;case"topborder":i===h&&(n=p);break;case"bottomborder":i===f&&(a=p);break;case"diagonalup":return Om.withBorders(s,{diagonal:m,diagonalUp:!0},!1,"diagonalup");case"diagonaldown":return Om.withBorders(s,{diagonal:m,diagonalDown:!0},!1,"diagonaldown")}return Om.withBorders(s,{borderLeft:t,borderRight:r,borderBottom:a,borderTop:n},!1)}},{key:"_setRangeStyle",value:function(){var e=this,t=this._sheet,r=this._command,n=r.prop,a=r.selections,o=r.value,i=r.isLocal,u=new qd,s=!0;if(OT(a,(function(r,n){e.checkCellValid(t,r,n)||(s=!1)})),!s)return!1;var c={ignoreStyle:!1,ignoreValue:!0,ignoreFormulaData:!0,ignoreDataValidation:!0,ignoreReminder:!0,ignoreMultipleValues:!0,ignorePivotTable:!0,ignoreFilterRow:!0,isLocal:i},h={styleId:void 0,ignoreStyle:!1,ignoreValue:!0,ignoreFormulaData:!0,ignoreDataValidation:!0,ignoreReminder:!0,ignoreMultipleValues:!0,ignorePivotTable:!0,ignoreFilterRow:!0},f=a.length>1;f&&a.sort(aae);var d=f?u:void 0;return a.forEach((function(r){var a=K8(t,r.toJSON(),c,q8);if(e._setRangeValuesActionToChangeset(a,!0),"frame"===n){var i=o.border,u=o.color,s=function(e,t){var r=e.sheet(),n=Math.max(e.rowFrom(),0),a=n+e.rowCount()-1,o=Math.max(e.colFrom(),0),i=o+e.colCount()-1,u=e.rowCount(),s=e.colCount(),l=null==r?void 0:r.getRowCount(),c=null==r?void 0:r.getColumnCount(),h={};switch(t){case"noborder":case"outerborder":case"fullborder":n-1>=0&&(h.borderBottom=new ou(n-1,o,1,s,r)),l&&a+1<l&&(h.borderTop=new ou(a+1,o,1,s,r)),o-1>=0&&(h.borderRight=new ou(n,o-1,u,1,r)),c&&i+1<c&&(h.borderLeft=new ou(n,i+1,u,1,r));break;case"diagonaldown":case"diagonalup":case"innerborder":break;case"leftborder":o-1>=0&&(h.borderRight=new ou(n,o-1,u,1,r));break;case"rightborder":c&&i+1<c&&(h.borderLeft=new ou(n,i+1,u,1,r));break;case"topborder":n-1>=0&&(h.borderBottom=new ou(n-1,o,1,s,r));break;case"bottomborder":l&&a+1<l&&(h.borderTop=new ou(a+1,o,1,s,r))}return h}(r,i),f=function(r){var n=s[r],a=eae(t,n,h,(function(e){return Om.delBorder(e,r)}),d);e._setRangeValuesActionToChangeset(a)};for(var v in s)f(v);(function(e,t){var r=e.sheet(),n=Math.max(e.rowFrom(),0),a=n+e.rowCount()-1,o=Math.max(e.colFrom(),0),i=o+e.colCount()-1,u=e.rowCount(),s=e.colCount(),l=[];switch(t){case"diagonalup":case"diagonaldown":case"fullborder":case"noborder":return[e];case"innerborder":case"outerborder":if(u*s==1)return[e];if(1===u)return l.push(new ou(n,o,1,1,r),new ou(n,i,1,1,r)),s>=3&&l.push(new ou(n,o+1,1,s-2,r)),l;if(1===s)return l.push(new ou(n,o,1,1,r),new ou(a,o,1,1,r)),u>=3&&l.push(new ou(n+1,o,u-2,1,r)),l;var c=new ou(n,o,1,1,r),h=new ou(a,o,1,1,r),f=new ou(n,i,1,1,r),d=new ou(a,i,1,1,r);if(l.push(c,f,h,d),u>=3){var v=new ou(n+1,o,u-2,1,r),p=new ou(n+1,i,u-2,1,r);l.push(v,p)}if(s>=3){var m=new ou(n,o+1,1,s-2,r),g=new ou(a,o+1,1,s-2,r);l.push(m,g)}if(s>=3&&u>=3){var y=new ou(n+1,o+1,u-2,s-2,r);l.push(y)}break;case"leftborder":l.push(new ou(n,o,u,1,r));break;case"rightborder":l.push(new ou(n,i,u,1,r));break;case"topborder":l.push(new ou(n,o,1,s,r));break;case"bottomborder":l.push(new ou(a,o,1,s,r))}return l})(r,i).forEach((function(n){var a=eae(t,n,h,(function(t,n,a){return e.setRangeBorder({selection:r,row:n,col:a,style:t,border:i,color:u})}),d);e._setRangeValuesActionToChangeset(a)}))}else{var p=eae(t,r,h,(function(e){return e[n]!==o?Om.withUpdateStyle(e,(0,l.Z)({},n,o)):e}));e._setRangeValuesActionToChangeset(p)}})),u.clear(),this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_updateRangeStyle",value:function(){var e=this,t=this._sheet,r=this._sheet.getParent(),n=this._command,a=n.prop,o=n.selections,i=n.value,u=n.isLocal,s={};s[a]=i;var l=this.filterDuplicateRange(o,!0);if(l.forEach((function(t){e._rangeOpToChangeset(t,{style:s},!1,u)})),!0!==this.checkRangeValid(r,this._command._changesets))return!1;var c={ignoreStyle:!1,ignoreValue:!0,ignoreFormulaData:!0,ignoreDataValidation:!0,ignoreReminder:!0,ignoreMultipleValues:!0,ignorePivotTable:!0,ignoreFilterRow:!0,isLocal:u};return l.forEach((function(r){var n=K8(t,r.toJSON(),c,q8);e._setRangeValuesActionToChangeset(n,!0)})),this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"execute",value:function(){var e=!1,t=this._sheet,r=this._command;this._beforeAction(t);try{e=r.isFirstExecution?this.doAction():this.redoAction()}catch(e){return Ce.Ps3.moirae.ravenCatch(e),!1}finally{this._afterAction(t)}return e}},{key:"doAction",value:function(){var e=this._command,t=e.prop;return $re(this._sheet,this.commandName,e.selections,t,e.value,e.isLocal),["fontSize","frame"].includes(t)?this._setRangeStyle():this._updateRangeStyle()}},{key:"redoAction",value:function(){return this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"commandName",get:function(){return Ce.rvF.SET_RANGE_STYLE}}]),t}(Qte),iae=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"_doAction",value:function(){var e=!1,t=this._sheet;this._beforeAction(t,!0);try{if(!this.generateActions())return!1;e=this._applyChangsetWithEvent(this._command._changesets,!0),t._raiseCellChanged()}finally{this._afterAction(t,!0)}return e}},{key:"generateActions",value:function(){var e=this._sheet,t=this._command,r=t.row,n=t.col,a=t.reminder,o=t.cellValue,i=e.getSpan(r,n);return(!i||i.rowFrom()===r&&i.colFrom()===n)&&!!this.checkCellValid(e,r,n)&&(this._setCellValue(r,n,o,null,null,void 0,a),!0)}},{key:"commandName",get:function(){return Ce.rvF.SET_REMINDER}}]),t}(Cre);!function(e){e.ADD="add",e.DEL="del",e.ADD_AND_DEL="add_and_del"}(tae||(tae={})),function(e){e.ROW="row",e.COL="col"}(rae||(rae={}));var uae=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"generateActions",value:function(){var e=this,t=this._command,r=t.type,n=t.method,a=t.source,o=t.target,i=t.count,u=this.sortRanges(this._command.ranges)||[{type:r,method:n,source:a,target:o,count:i}],s=(0,m.Z)(this._command._oldChangesets),l=[],c=[];return u.forEach((function(t){var r=[];"add"===n?r=e.genAddAction(t,c,t.isCopyStyle):"del"===n&&(r=e.genDelAction(t,c)),(0,Ce.hTd)(l,r)})),this._command._oldChangesets=c.reverse().reduce((function(e,t){for(var r=0;r<t.length;r++)e.push(t[r]);return e}),s),!!l.length&&(l.forEach((function(t){e.chartAdjust(t),e.rangeAdjust(t),e.floatImageAdjust(t),e.conditionalFormatAdjust(t),e.floatBlockAdjust(t),e.pivotTablePositionAdjust(t),e.outlinePositionAdjust(t),e.pushAddsparklineAction(t),e.protectionAdjust(t)})),this.filterRangeAdjust(),!0)}},{key:"_doAction",value:function(){return!!this.generateActions()&&this.applyActions()}},{key:"appendToChangeset",value:function(e){if(e){var t=e.actions,r=e.oldActions;t&&(0,Ce.hTd)(this._command._changesets,t),r&&(0,Ce.hTd)(this._command._oldChangesets,r)}}},{key:"applyActions",value:function(){return 0!==this._command._changesets.length&&this.tryApplyActions(this._sheet.parent,this._command._changesets,!0)}},{key:"genAddAction",value:function(e,t,r){var n=e.type,a=e.method,o=e.target,i=e.count,u=e.source,s=e.size,l={type:n,method:a,target:o,count:i,source:u,size:s};return"row"===n?t.push(this._addRows(u,o,i,s,r)):t.push(this._addCols(u,o,i,s,r)),[l]}},{key:"genDelAction",value:function(e,t){var r=e.type,n=e.method,a=e.target,o=e.count,i={type:r,method:n,target:a,count:o,source:e.source};return"row"===r?t.push(this._delRows(a,o)):t.push(this._delCols(a,o)),[i]}},{key:"sortRanges",value:function(e){return e&&1!==e.length?e.sort((function(e,t){return t.target-e.target})):e}},{key:"_delRows",value:function(e,t){var r="row",n=Rv(new iu(e,t,this._sheet)).map((function(e){return{target:e.rowFrom(),count:e.rowCount()}})),a=this._command._oldChangesets;this._command._oldChangesets=[];for(var o=n.length-1;o>=0;o--){var i=n[o];this._command._changesets.push(this._delRowsAction(i.target,i.count))}for(var u=0;u<n.length;u++){var s=n[u];this._command._oldChangesets.push(this._addRowsAction(s.target,s.count))}for(var l=0;l<n.length;l++){var c=n[l];this._saveUndoRange(r,c.target,c.count),this._sizeToChangeset(r,c.target,c.count),this._fIdToChangeset(r,c.target,c.count),this.hiddenRowsToChangeset(c.target,c.count)}this._delRowSpansToChangeset(e,t,n);var h=this._command._oldChangesets;return this._command._oldChangesets=a,h}},{key:"hiddenRowsToChangeset",value:function(e,t){for(var r,n=this._sheet,a=this._sheetId,o=0;o<t;o++)n.getRowVisible(e+o,!0)?r&&(this._command._oldChangesets.push(r),r=void 0):r?r.target.row_count=r.target.row_count+1:r={action:"hideRow",sheet_id:a,target:{row:e+o,row_count:1}};r&&this._command._oldChangesets.push(r)}},{key:"_delCols",value:function(e,t){var r="col",n=this._command._oldChangesets;this._command._oldChangesets=[],this._command._changesets.push(this._delColsAction(e,t)),this._command._oldChangesets.push(this._addColsAction(e,t)),this._saveUndoRange(r,e,t),this._delColSpansToChangeset(e,t),this._sizeToChangeset(r,e,t),this._fIdToChangeset(r,e,t),this.hiddenColToChangeset(e,t);var a=this._command._oldChangesets;return this._command._oldChangesets=n,a}},{key:"hiddenColToChangeset",value:function(e,t){var r=this,n=this._sheet,a=this._sheetId;n._getColInfos().iterVisible(e,e+t).filter((function(e){return!1===e.value})).forEach((function(e){var t=e.index,n=e.count;r._command._oldChangesets.push({action:"hideCol",sheet_id:a,target:{col:t,col_count:n}})}))}},{key:"_saveUndoRange",value:function(e,t,r){var n=this,a=this._sheet,o="row"===e?t:0,i="col"===e?t:0,u="row"===e?r:a.getRowCount(),s="col"===e?r:a.getColumnCount(),l=K8(a,{row:o,col:i,rowCount:u,colCount:s},{needNote:!0},(function(e,t,r,a,o){var i=o.getComments(e,t);i&&n._cellCommentsToChangeset(e,t,i,!0),J8(e,t,r,a,o)}));this._setRangeValuesActionToChangeset(l,!0)}},{key:"_sizeToChangeset",value:function(e,t,r){for(var n=this._sheet,a=t;a<t+r;a++)if("row"===e){var o=n._getActualRowHeight(a);this._rowHeightToChangeset(a,o,!0)}else{var i=n.getColumnWidth(a);this._columnWidthToChangeset(a,i,!0)}}},{key:"_fIdToChangeset",value:function(e,t,r){for(var n=this._sheet,a=t;a<t+r;a++)if("row"===e){var o=n.getRowColProperty(a,"fId",!0);o&&this._rowFIdToChangeset(a,o,!0)}else{var i=n.getRowColProperty(a,"fId",!1);i&&this._columnFIdToChangeset(a,i,!0)}}},{key:"_delRowSpansToChangeset",value:function(e,t,r){var n=this,a=this._sheet,o=a.getSpans(new iu(e,t,a),void 0,!0);o=o.filter((function(e){for(var t=e.rowFrom(),n=e.rowTo(!0),a=0;a<r.length;a++){var o=r[a];if(o.target>n)return!1;if(!(o.target+o.count-1<t)&&(o.target<=t||o.target+o.count-1>=n))return!0}return!1})),o.forEach((function(e){n._spanToChangeset(e,[e],!0)}))}},{key:"_delColSpansToChangeset",value:function(e,t){var r=this,n=this._sheet,a=n.getSpans(new nu(e,t,n),void 0,!0);a=a.filter((function(r){var n=r.colFrom(),a=r.colTo(!0);return!(e>a||e+t-1<n||!(e<=n||e+t-1>=a))})),a.forEach((function(e){r._spanToChangeset(e,[e],!0)}))}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0,"redo")}},{key:"execute",value:function(){var e=!1,t=this._sheet;this._beforeAction(t,!0);try{e=this._command.isFirstExecution?this._doAction():this._redoAction()}catch(e){return this._afterAction(t,!0),Ce.Ps3.moirae.ravenCatch(e),!1}return this._afterAction(t,!0),e}},{key:"undo",value:function(){var e=this._sheet;this._beforeAction(e,!0);try{this._applyChangsetWithEvent(this._command._oldChangesets,!0,"undo")}catch(t){return Ce.Ps3.moirae.ravenCatch(t),this._afterAction(e,!0),!1}return this._afterAction(e,!0),!0}},{key:"chartAdjust",value:function(e){var t=this._sheet,r=e.type,n=e.method,a=e.target,o=e.count;if("del"===n){var i=t.chartModel.checkDelInfluence(r,a,o);this.appendOldChartChangeset(i)}}},{key:"rangeAdjust",value:function(e){var t=e.type,r=e.method,n=e.target,a=e.count;if("del"===r){var o=this._sheet.rangeModel.checkDelInfluence(t,n,a);this.appendOldRangeChangeset(this._sheet.id(),o)}}},{key:"floatImageAdjust",value:function(e){var t=this._sheet,r=e.type,n=e.method,a=e.target,o=e.count;if("del"===n){var i=t.floatImageModel.checkDelInfluence(r,a,o);this.appendOldFloatImageChangeset(i)}}},{key:"floatBlockAdjust",value:function(e){var t=this._sheet,r=e.type,n=e.method,a=e.target,o=e.count;if("del"===n){var i=t.floatBlocksModel.checkDelInfluence(r,a,o);this.appendOldFloatBlockChangeset(i)}}},{key:"appendOldFloatBlockChangeset",value:function(e){var t=this,r=this._command._oldChangesets;e.forEach((function(e,n){var a=e.blockType,o=e.blockSetting;r.push({action:"setFloatBlock",sheet_id:t._sheetId,value:Object.assign({},o,{blockToken:n,blockType:a})})}))}},{key:"conditionalFormatAdjust",value:function(e){var t=this._sheet,r=e.type,n=e.source,a=e.method,o=e.target,i=e.count,u=t.conditionalFormatModel.helper;if("add"===a){var s=u.getRulesByAddRowCol(r,n,o,i);s.size>0&&this.pushSetConditionalFormatActions(s)}if("del"===a){var l=u.getRulesByDelRowCol(r,o,i),c=[],h=new Map;l.forEach((function(e,t){var r=e.subRange,n=void 0===r?null:r;0===(null==n?void 0:n.length)?c.push(t):h.set(t,e)})),c.length&&this.pushDeleteConditionalFormatActions(c),h.size&&this.pushModifiedConditionalFormatActionsToChangeset(h)}}},{key:"pushSetConditionalFormatActions",value:function(e){var t=this,r=this._sheet;e.forEach((function(e,n){var a=p6(r,n);if(a){var o=Object.assign({},a),i=e.attrs,u=void 0===i?null:i,s=e.ranges,l=void 0===s?null:s;null!==u&&(o.attrs=u),null!==l&&(o.ranges=function(e){return e.getRanges().map((function(e){return gu(e,!0)}))}(l));var c=g6(r,n,o);c&&((0,Ce.hTd)(t._command._changesets,c.actions),(0,Ce.hTd)(t._command._oldChangesets,c.oldActions))}}))}},{key:"pushDeleteConditionalFormatActions",value:function(e){var t=v6(this._sheet,e);t&&((0,Ce.hTd)(this._command._changesets,t.actions),(0,Ce.hTd)(this._command._oldChangesets,t.oldActions))}},{key:"pushModifiedConditionalFormatActionsToChangeset",value:function(e){var t=this,r=this._sheet,n=r.id();e.forEach((function(e,a){var o=e.subRange,i=void 0===o?null:o,u=e.attrs,s=void 0===u?null:u,l=e.newBaseRanges,c=void 0===l?null:l;if(i&&!s){var h=m6(t._sheet,a);if(h){var f={action:"setConditionalFormat",sheet_id:n,value:h};t._command._oldChangesets.push(f)}}else{var d=p6(r,a);if(!d)return;var v=Object.assign({},d);null!==s&&(v.attrs=s),null!==c&&(v.ranges=c.map((function(e){return gu(e,!0)})));var p=g6(r,a,v);p&&((0,Ce.hTd)(t._command._changesets,p.actions),(0,Ce.hTd)(t._command._oldChangesets,p.oldActions))}}))}},{key:"pushAddsparklineAction",value:function(e){var t=e.type,r=e.method,n=e.target,a=e.count;if("del"===r){var o,i,u,s,l=this._sheet.getSparklineModel();"row"===t?(o=n,i=0,u=this._sheet.getRowCount()-n,s=this._sheet.getColumnCount()):(o=0,i=n,u=this._sheet.getRowCount(),s=this._sheet.getColumnCount()-n);var c=Rne(this._sheet,(function(){var e={},r=[];return l.iter(o,i,u,s).forEach((function(e){var o=e.getPosition(),i=e.getId();("row"===t?o.row>=n&&o.row<n+a:o.col>=n&&o.col<n+a)&&r.push(i)})),r.length&&r.forEach((function(t){var r=l.getSparklineById(t);if(r){var n=r.getGroupId();wne(e,n,t,{source:r.getSource(),position:r.getPosition()}),e[n].config=l.getSparklineRawConfig(n)}})),{add:e}}));(null==c?void 0:c.undo)&&this.command._oldChangesets.push(c.undo)}}},{key:"pivotTablePositionAdjust",value:function(e){var t=this,r=e.type,n=e.method,a=e.target,o=this._sheet.embeddedBlocksModel;"del"===n&&o.getBlockTokensToAdjust(a,r,"del").forEach((function(e){var r=o.getBlock(e),n=r.position,a=r.blockSetting,i=r.blockToken,u=r.blockType,s={action:"setEmbeddedBlock",sheet_id:t._sheet.id(),target:{row:n.row,col:n.col},value:{blockSetting:a,blockToken:i,blockType:u}};t._command._oldChangesets.push(s)}))}},{key:"outlinePositionAdjust",value:function(e){var t=this._sheet,r=e.method,n=yre(t,e),a=n.newChangesets,o=n.oldChangesets;"del"===r?((0,Ce.VB2)(this._command._changesets,a),(0,Ce.hTd)(this._command._oldChangesets,o)):((0,Ce.hTd)(this._command._changesets,a),(0,Ce.VB2)(this._command._oldChangesets,o))}},{key:"protectionAdjust",value:function(e){var t=this;"del"===e.method&&function(e,t,r,n){var a=[],o=r+n,i="row"===t?"rowCount":"colCount",u=function(e){var n=e[t],a=n+e[i];return r<=n?n<o:r<a&&a<=o};return e.getAllProtections().forEach((function(e){for(var r=0,n=e.ranges.length;r<n;r++){var o=e.ranges[r];if((o.type===Ce.xj7.NORMAL||o.type===Ce.xj7.ROW&&"row"===t||o.type===Ce.xj7.COL&&"col"===t)&&u(o)){a.push(e);break}}})),a}(this._sheet.protectionModel,e.type,e.target,e.count).forEach((function(e){var r=nre(t._sheetId,e);t._command._oldChangesets.push(r)}))}},{key:"filterRangeAdjust",value:function(){try{var e,t=this._command,r=t.method,n=t.ranges;if(0===n.length)return;if("del"!==r)return;var a=this._sheet,o=null==a||null===(e=a.sheetFilterModel)||void 0===e?void 0:e.filterRange,i=Xv(a);switch(this._command.type){case"row":var u,s=[],l=yr(n);try{for(l.s();!(u=l.n()).done;){var c=u.value,h=c.target,f=c.count;(0,Ce.hTd)(s,Rv(new iu(h,f,a)))}}catch(e){l.e(e)}finally{l.f()}(null==o?void 0:o.isValid())&&this.appendToChangeset(sp(a,o,s));var d,v=yr(i);try{for(v.s();!(d=v.n()).done;){var p=d.value,m=p.name,g=p.id,y=p.range;this.appendToChangeset(sp(a,y,s,m,g))}}catch(e){v.e(e)}finally{v.f()}break;case"col":var _,R=[],C=yr(n);try{for(C.s();!(_=C.n()).done;){var w=_.value,E=w.target,k=w.count;R.push(new nu(E,k,a))}}catch(e){C.e(e)}finally{C.f()}(null==o?void 0:o.isValid())&&this.appendToChangeset(lp(a,o,R));var T,S=yr(i);try{for(S.s();!(T=S.n()).done;){var A=T.value,I=A.name,O=A.id,V=A.range;this.appendToChangeset(lp(a,V,R,I,O))}}catch(e){S.e(e)}finally{S.f()}}}catch(e){console.error("SetRowColChange command - filterRangeAdjust error")}}},{key:"getPerformanceInfo",value:function(){return{sub_command:"".concat(this._command.method,"-").concat(this._command.type)}}}]),t}(Ere),sae=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"doAction",value:function(){var e=this.generateActions();return e?this._applyChangsetWithEvent(this.command._changesets,!0):e}},{key:"generateActions",value:function(){var e=this,t=this._command,r=t._changesets,n=t._oldChangesets,a=t.action,o=t.ranges,i=this._sheet,u=[],s=-1,l=1;return o.forEach((function(t){switch(a){case"unhideRow":var o=Object.keys(i.getHiddenRows()).map(Number);if(0===o.length)break;l=1;for(var c=t.target;c<=t.target+t.count;c++)o.includes(c)&&(-1===s?s=c:s+l===c?l++:(u.push({target:s,count:l}),s=c,l=1));s>-1&&u.push({target:s,count:l});break;case"unhideCol":var h=Object.keys(i.getHiddenCols()).map(Number);if(0===h.length)break;l=1;for(var f=t.target;f<=t.target+t.count;f++)h.includes(f)&&(-1===s?s=f:s+l===f?l++:(u.push({target:s,count:l}),s=f,l=1));s>-1&&u.push({target:s,count:l});break;case"hideCol":r.push(e.hideColChangeset(t)),n.push(e.unhideColChangeset(t));break;case"hideRow":r.push(e.hideRowChangeset(t)),n.push(e.unhideRowChangeset(t))}})),u.length>0&&("unhideRow"===a?u.forEach((function(t){r.push(e.unhideRowChangeset(t)),n.push(e.hideRowChangeset(t))})):"unhideCol"===a&&u.forEach((function(t){r.push(e.unhideColChangeset(t)),n.push(e.hideColChangeset(t))}))),!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&(this.saveExtendFilterRangeActions(),!0)}},{key:"hideRowChangeset",value:function(e){return{action:"hideRow",sheet_id:this._sheetId,target:{row:e.target,row_count:e.count}}}},{key:"unhideRowChangeset",value:function(e){return{action:"unhideRow",sheet_id:this._sheetId,target:{row:e.target,row_count:e.count}}}},{key:"hideColChangeset",value:function(e){return{action:"hideCol",sheet_id:this._sheetId,target:{col:e.target,col_count:e.count}}}},{key:"unhideColChangeset",value:function(e){return{action:"unhideCol",sheet_id:this._sheetId,target:{col:e.target,col_count:e.count}}}},{key:"saveExtendFilterRangeActions",value:function(){var e=this._command,t=e.action,r=e.ranges;if("hideRow"===t){var n,a=this._sheet,o=[],i=yr(r);try{for(i.s();!(n=i.n()).done;){var u=n.value,s=u.target,l=u.count;o.push(new iu(s,l,a))}}catch(e){i.e(e)}finally{i.f()}this.appendToChangeset(cp(a,o))}}},{key:"appendToChangeset",value:function(e){if(e){var t=e.actions,r=e.oldActions;t&&(0,Ce.hTd)(this._command._changesets,t),r&&(0,Ce.hTd)(this._command._oldChangesets,r)}}},{key:"commandName",get:function(){return Ce.rvF.SET_ROW_COL_VISIBLE}}]),t}(Qte);var lae=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"_setRangeFontStyle",value:function(){var e=this,t=this._command,r=t.selections,n=t.prop,a=t.value,o=t.isIncrease,i=this._sheet,u=this._sheet.getParent(),s=this.filterDuplicateRange(r,!0),l={ignoreValue:!1,ignoreFormulaData:!0,ignoreDataValidation:!0,ignoreReminder:!0,ignoreMultipleValues:!0,ignorePivotTable:!0,ignoreStyle:!1,ignoreFilterRow:!0};if(s.forEach((function(t){var r=K8(i,t.toJSON(),l,q8);e._setRangeValuesActionToChangeset(r,!0)})),void 0!==o){var c={styleId:void 0,ignoreStyle:!1,ignoreValue:!1,ignoreFormulaData:!0,ignoreDataValidation:!0,ignoreReminder:!0,ignoreMultipleValues:!0,ignorePivotTable:!0,ignoreFilterRow:!0},h=new Map,f=function(t,r,n,a,i){var u,s=i.getSegmentArray(t,r),l=i.getCellStyle(t,r)||i.getDefaultStyle(),c={fontInfo:{fontSize:e.changeFontSize(l.fontSizePx,o)}};if(Array.isArray(s)&&s.length){n.ignoreValue=!1;var f=function(e,t,r,n){var a=pR(e,t,r,n),o=a.value,i=a.style,u=a.hasChanged;return Array.isArray(o)?{value:o.map((function(e){return e.style&&(e.style=e.style.toJSON()),e})),style:i,hasChanged:u}:{value:o,style:i,hasChanged:u}}(s,l,i,c),d=f.value,v=f.style;f.hasChanged&&(n.cellValue||(n.cellValue={}),n.cellValue.value=d,u=a.styleRefMgr.getStyleId(v))}else if(n.ignoreValue=!0,void 0===(u=h.get(l))){var p=Om.withUpdateStyle(l,c);u=a.styleRefMgr.getStyleId(p),h.set(l,u)}n.styleId=u,X8(t,r,i,a,n)};return r.forEach((function(t){var r=K8(i,t.toJSON(),c,f);e._setRangeValuesActionToChangeset(r)})),!0}if(void 0!==a){var d={};return d[n]=a,function(e){var t=e["font-weight"]||e.fontWeight;t&&(e.fontWeight=im(t),delete e["font-weight"])}(d),s.forEach((function(t){e._rangeOpToChangeset(t,{style:{fontInfo:d}})})),!0===this.checkRangeValid(u,this._command._changesets)}return!1}},{key:"execute",value:function(){var e=this._command,t=e._changesets,r=this._sheet,n=this._sheet.getParent(),a=!1;this._beforeAction(r),$re(this._sheet,this.commandName,e.selections,e.prop,e.value,e.isLocal);try{if(e.isFirstExecution)this._setRangeFontStyle(),a=this._applyChangsetWithEvent(t);else{if(!0!==this.checkRangeValid(n,this._command._changesets))return!1;a=this.tryApplyActions(n,t)}}catch(e){return Ce.Ps3.moirae.ravenCatch(e),this._afterAction(r),!1}return this._afterAction(r),a}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"changeFontSize",value:function(e,t){var r=Ce.xOW.indexOf(e+"px");return t?r===Ce.xOW.length-1?e:parseInt(Ce.xOW[r+1],10):0===r?e:parseInt(Ce.xOW[r-1],10)}},{key:"commandName",get:function(){return Ce.rvF.SET_STYLE_FONT}}]),t}(Qte),cae=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"_updateRangeTextDecoration",value:function(){var e=this,t=this._command,r=t.selections,n=t.active,a=t.flag,o=this._sheet,i=this._sheet.getParent(),u={textDecoration:{active:n,flag:a}},s=this.filterDuplicateRange(r,!0);if(s.forEach((function(t){e._rangeOpToChangeset(t,{style:u})})),!0!==this.checkRangeValid(i,this._command._changesets))return!1;var l={ignoreValue:!0,ignoreFormulaData:!0,ignoreDataValidation:!0,ignoreReminder:!0,ignoreMultipleValues:!0,ignorePivotTable:!0,ignoreStyle:!1,ignoreFilterRow:!0};return s.forEach((function(t){var r=K8(o,t.toJSON(),l,q8);e._setRangeValuesActionToChangeset(r,!0)})),!0}},{key:"execute",value:function(){var e=this._command,t=e._changesets,r=this._sheet,n=this._sheet.getParent(),a=!1;this._beforeAction(r);try{if(e.isFirstExecution){if($re(this._sheet,this.commandName,e.selections,"textDecoration",e.active,e.isLocal),this._updateRangeTextDecoration(),!(a=this._applyChangsetWithEvent(t)))return!1}else{if(!0!==this.checkRangeValid(n,this._command._changesets))return!1;a=this._applyChangsetWithEvent(t)}}catch(e){return Ce.Ps3.moirae.ravenCatch(e),this._afterAction(r),!1}return this._afterAction(r),a}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"commandName",get:function(){return Ce.rvF.SET_TEXT_DECORATION}}]),t}(Qte),hae=W6._util,fae=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"commandName",get:function(){return"setValueByDataValidation"}}]),(0,_.Z)(t,[{key:"_doAction",value:function(){return this._doSetValue()}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_doSetValue",value:function(){var e=this._sheet,t=this._command,r=t.row,n=t.col,a=t._changesets,o=t.text,i=t.isMultiple,u=t.multipleValues,s=this._command,l=s.formula,c=s.formulaVar,h=!1,f=e.getSpan(r,n);if(f&&(f.rowFrom()!==r||f.colFrom()!==n))return h;this._beforeAction(e);try{var d=e.getChangesetValue(r,n),v=e.getFormula(r,n),p=e.getFormulaData(r,n),m=e.getReminderChangeset(r,n),g=e.getMultipleValues(r,n),y=e.getStyleWithDropdown(r,n)||e.getDefaultStyle(),_={value:d,formula:v,reminder:m,multipleValues:g?g.toJSON():null,style:y.toJSON()};void 0!==p&&(_.formulaData=p);var R={};this._cellValueToChangeset(r,n,_,!0);var C=hae._getValueAndStyleFromEditing(e,r,n,o,!1,!0),w=C.value,E=C.styleWithDropdown,k=null;if(!l)if(Array.isArray(o))l=null,c=null;else{var T=mee(r,n,e,o);T.isFormula&&(l=T.text,c=T.formulaVar)}if(i){var S=y.formatter;k=new l_(e.parent),u?k.fromJSON(u):Array.isArray(o)?o.forEach((function(e){var t;null===(t=k)||void 0===t||t.addByTextNoSplit(e,S)})):k.fromString(o,S),R=this.saveNewState(r,n,w,l,c,E,null,void 0,k)}else R=(0,ce.Z)(w)?this.saveNewState(r,n,(0,Ce.Tcw)(w),l,c,E,null):this.saveNewState(r,n,w,l,c,E,null);if(this.saveExtendFilterRangeChangesets(r,n,_,R),!this.checkRangeValid(e.parent,a,!0))return!1;h=this._applyChangsetWithEvent(a)}catch(r){throw Ce.Ps3.moirae.ravenCatch(r),this._afterAction(e),r}return this._afterAction(e),h}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}}]),t}(Rre),dae=function(e){function t(){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).apply(this,arguments))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return!(this._command.isFirstExecution&&!this._saveChangesets())&&!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_saveChangesets",value:function(){var e=this._command,t=e.sheetId,r=e.value,n=r.originName,a=r.viewId,o=(0,Ce.US_)(a),i=r.name;return i&&!this._isNameConflict(i)||(i=this._getDefaultName(o)),this._command._oldChangesets=[(0,Ce.OU8)(t,{type:0,origin_name:i,name:n,view_id:a})],this._command._changesets=[(0,Ce.OU8)(t,{type:0,origin_name:n,name:i,view_id:a})],!0}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_getDefaultName",value:function(e){return this._sheet.viewsModel.assignViewName(e)}},{key:"_isNameConflict",value:function(e){return!!this._sheet.viewsModel&&this._sheet.viewsModel.isNameExit(e)}},{key:"commandName",get:function(){return Ce.rvF.SET_VIEW}}]),t}(Qte);var vae,pae,mae,gae,yae,_ae=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"undo",value:function(){return this._undoAction()}},{key:"_doAction",value:function(){var e=performance.now(),t=this._command,r=this._sheet;this._beforeAction(r);try{var n=t.target,a=t.sortConditions,o=t.sortType,i=this.handleSortRangeByFrozen(r,n);if(!i.continueSort)return!1;n=i.sortRange;var u=performance.now();if(!this._canSortRange(n,a,o))return!1;for(var s=performance.now(),l=[],c=0;c<n.rowCount();c++)for(var h=0;h<n.colCount();h++){var f=r.getFormula(c+n.rowFrom(),h+n.colFrom());f&&l.push({row:c+n.rowFrom(),col:h+n.colFrom(),formula:f})}var d=r._sortRange(n.rowFrom(),n.colFrom(),n.rowCount(),n.colCount(),!0,a),v=n.rowFrom(),p=d.reduce((function(e,t,r){return e[t-v]=r+v,e}),[]);if(this._sortToChangeset(n.rowFrom(),n.colFrom(),n.rowCount(),n.colCount(),p,!0),this._sortToChangeset(n.rowFrom(),n.colFrom(),n.rowCount(),n.colCount(),d,!1),!this.checkRangeValid(r.getParent(),this._command._changesets))return Ce.Ps3.modalHelper.showError(17),!1;var m=performance.now(),g=this._applyChangsetWithEvent(this._command._changesets,!1);return this.checkCanSortTime=s-u,this.createCsTime=m-e,this.applyCsTime=performance.now()-m,g||Ce.Ps3.modalHelper.showError(17),g}catch(e){return Ce.Ps3.moirae.ravenCatch(e),Ce.Ps3.modalHelper.showError(17),!1}finally{this._afterAction(r)}}},{key:"_redoAction",value:function(){var e=this._command,t=this._sheet,r=e._changesets;return!0===this.checkRangeValid(t.parent,r)&&this._applyChangsetWithEvent(r,!1)}},{key:"_undoAction",value:function(){if(!0!==this.checkRangeValid(this._sheet.parent,this._command._oldChangesets))return!1;var e=this._command._oldChangesets;return this._applyChangsetWithEvent(e,!1)}},{key:"_canSortRange",value:function(e,t,r){var n=this._sheet;if(!function(e,t){if(t.length<=0)return!1;var r,n=e.colFrom(),a=e.colTo(),o=yr(t);try{for(o.s();!(r=o.n()).done;){var i=r.value.index;if(i>a||i<n)return Ce.Ps3.modalHelper.showError(22),!1}}catch(e){o.e(e)}finally{o.f()}return!0}(e,t))return!1;if(1===e.rowCount())return!1;if(!0!==this.checkRangeValid(n.parent,[{action:"sort",sheet_id:n.id(),target:{row:e.rowFrom(),col:e.colFrom(),row_count:e.rowCount(),col_count:e.colCount()}}]))return Ce.Ps3.modalHelper.showError(22),!1;var a=n.getSpans(e);return a&&a.length>0?(Ce.Ps3.modalHelper.showSpansPromptModalWhileSort(a,r),!1):!zv(n,e)||(Ce.Ps3.modalHelper.showError(21),!1)}},{key:"getPerformanceInfo",value:function(){if(void 0!==this.checkCanSortTime&&void 0!==this.createCsTime&&void 0!==this.applyCsTime)return{checkCanSortTime:this.checkCanSortTime,createCsTime:this.createCsTime,applyCsTime:this.applyCsTime,sortConditionsNum:this.command.sortConditions.length}}},{key:"handleSortRangeByFrozen",value:function(e,t){var r=e.frozenRowCount(),n=t.rowFrom(),a=t.rowCount()-1+n;return a<=r?{continueSort:!1}:(n<=r-1&&((t=ou.toNormalRange(t)).setRowFrom(r),t.setRowCount(a-r+1)),{continueSort:!0,sortRange:t})}},{key:"commandName",get:function(){return Ce.rvF.SORT_RANGE}}]),t}(Qte),Rae=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"redoAction",value:function(){return this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"doAction",value:function(){return!!this.generateAction()&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"generateAction",value:function(){var e=this._command,t=e._changesets,r=e._oldChangesets,n=e.permId,a=this._sheet.protectionModel.getProtectionById(n);if(!a)return!1;var o=CN(a),i=o[Ce.xj7.NORMAL],u=o[Ce.xj7.ROW],s=o[Ce.xj7.COL];if(u.length>0||i.length>0||1!==s.length)return!1;var l=s[0];return r.push(this.lockColChangeset(this._sheetId,l.col,l.colCount,a.description||"",n,a.creatorId)),t.push(this.unLockColChangeset(this._sheetId,l.col,l.colCount,n)),!0}},{key:"lockColChangeset",value:function(e,t,r,n,a,o){return{action:"lockCol",sheet_id:e,target:{col:t,col_count:r},value:{lock_info:n,perm_id:a,creator_id:o||""}}}},{key:"unLockColChangeset",value:function(e,t,r,n){return{action:"unlockCol",sheet_id:e,value:{perm_id:n},target:{col:t,col_count:r}}}},{key:"commandName",get:function(){return Ce.rvF.UNLOCK_COL}}]),t}(Qte),Cae=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"redoAction",value:function(){return this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"doAction",value:function(){return!!this.generateAction()&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"generateAction",value:function(){var e=this._command,t=e._changesets,r=e._oldChangesets,n=e.permId,a=this._sheet.protectionModel.getProtectionById(n);if(!a)return!1;var o=CN(a),i=o[Ce.xj7.NORMAL],u=o[Ce.xj7.ROW];if(o[Ce.xj7.COL].length>0||i.length>0||1!==u.length)return!1;var s=u[0];return r.push(this.lockRowChangeset(this._sheetId,s.row,s.rowCount,a.description||"",n,a.creatorId)),t.push(this.unLockRowChangeset(this._sheetId,s.row,s.rowCount,n)),!0}},{key:"lockRowChangeset",value:function(e,t,r,n,a,o){return{action:"lockRow",sheet_id:e,target:{row:t,row_count:r},value:{lock_info:n,perm_id:a,creator_id:o||""}}}},{key:"unLockRowChangeset",value:function(e,t,r,n){return{action:"unlockRow",sheet_id:e,value:{perm_id:n},target:{row:t,row_count:r}}}},{key:"commandName",get:function(){return Ce.rvF.UNLOCK_ROW}}]),t}(Qte),wae=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(e){return this._command.isFirstExecution?this.doAction(e):this.redoAction()}},{key:"redoAction",value:function(){return this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"doAction",value:function(e){return!!this.generateAction(e)&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"generateAction",value:function(e){var t=this._command,r=t._changesets,n=t._oldChangesets,a=t.permId,o=e.permissionManager.findPermById(a);return!!o&&(r.push(this.unUnlockSheetChangeset(this._sheetId,a,this._sheet.name())),n.push(this.lockSheetChangeset(o.sheetId,o.lockInfo,a,o.sheetName,o.creatorId)),!0)}},{key:"lockSheetChangeset",value:function(e,t,r,n,a){return{action:"lockSheet",sheet_id:e,value:{lock_info:t,perm_id:r,sheet_name:n,creator_id:a||""}}}},{key:"unUnlockSheetChangeset",value:function(e,t,r){return{action:"unlockSheet",sheet_id:e,value:{perm_id:t,sheet_name:r}}}},{key:"commandName",get:function(){return Ce.rvF.UNLOCK_SHEET}}]),t}(Qte),Eae=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets)}},{key:"doAction",value:function(){return this._saveChangeSets(),this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"_saveChangeSets",value:function(){var e=this.command,t=e.target,r=e.state,n=r===Ce.w2y.Fold?Ce.w2y.Expand:Ce.w2y.Fold,a=this.createUpdateOutlineActions(t,r),o=this.createUpdateOutlineActions(t,n);this._command._changesets.push(a),this._command._oldChangesets.push(o)}},{key:"createUpdateOutlineActions",value:function(e,t){return{action:"updateOutline",sheet_id:this._sheet.id(),value:{state:t},target:cre(e)}}},{key:"commandName",get:function(){return Ce.rvF.UPDATE_OUTLINE}}]),t}(Qte),kae=function(e){function t(e,r){var n;return(0,y.Z)(this,t),(n=(0,d.Z)(this,(0,v.Z)(t).call(this,e,r)))._command.autoFillType=0,n._command.fillDirection=3,n}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this.doAction():this.redoAction()}},{key:"canExecute",value:function(){var e=this._sheet,t=this._command,r=t.startRange,n=t.fillRange,a=t.autoFillType;return!(0===n.rowCount()||!e._canChange(n.rowFrom(),n.colFrom(),n.rowCount(),n.colCount())||4!==a&&n.isIntersect(r))}},{key:"redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets)}},{key:"doAction",value:function(){if(!this.canExecute())return!1;var e=this._sheet,t=this._command.fillRange,r=this._collRangeInfo(e,t);return this.saveChangesets(r,!0),this._beforeAction(e,!0),this._executeFill(),this._afterAction(this._sheet,!0),this.extendFilterRange([t]),!!this.checkRangeValid(e.parent,this.command._changesets,!0)&&(this._applyChangsetWithEvent(this.command._changesets),!0)}},{key:"commandName",get:function(){return"verticalFill"}}]),t}(une),Tae=function(e){function t(e,r,n){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return this._command.isFirstExecution?this._doAction():this._redoAction()}},{key:"_clearRangeNotes",value:function(){var e=this,t=this._sheet,r=this._command.ranges,n={ignoreValue:!0,ignoreStyle:!0,ignoreDataValidation:!0,ignoreFormulaData:!0,ignoreMultipleValues:!0,ignoreReminder:!0,ignorePivotTable:!0,needNote:!0};this.filterDuplicateRange(r,!0).forEach((function(r){e._setRangeToChangeset(r,{note:null}),e._setRangeValuesActionToChangeset(K8(t,r.toJSON(),n),!0)}))}},{key:"_doAction",value:function(){return!!this.generateActions()&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"generateActions",value:function(){var e=this._sheet.getParent();return this._clearRangeNotes(),!0===this.checkRangeValid(e,this._command._changesets)}},{key:"_redoAction",value:function(){return!0===this.checkRangeValid(this._sheet.parent,this._command._changesets)&&this._applyChangsetWithEvent(this._command._changesets,!0,"redo")}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0,"undo")}},{key:"commandName",get:function(){return Ce.rvF.CLEAR_NOTES}}]),t}(Rre),Sae=function(e){function t(e,r){return(0,y.Z)(this,t),(0,d.Z)(this,(0,v.Z)(t).call(this,e,r))}return(0,p.Z)(t,e),(0,_.Z)(t,[{key:"execute",value:function(){return!(this._command.isFirstExecution&&!this._saveChangesets())&&this._applyChangsetWithEvent(this._command._changesets,!0)}},{key:"undo",value:function(){return this._applyChangsetWithEvent(this._command._oldChangesets,!0)}},{key:"_saveChangesets",value:function(){var e=this._command,t=e.row,r=e.col,n=e.note,a=void 0===n?null:n,o=this._sheet.id(),i=this._sheet.getCellNoteJSON(t,r);if((0,me.default)(a,i))return!1;var u={action:"setCell",sheet_id:o,target:{row:t,col:r},value:{note:a},type:8},s={action:"setCell",sheet_id:o,target:{row:t,col:r},value:{note:i},type:8};return this._command._changesets.push(u),this._command._oldChangesets.push(s),!0}},{key:"commandName",get:function(){return Ce.rvF.SET_CELL_NOTE}}]),t}(Qte),Aae=(nt={},(0,l.Z)(nt,Ce.rvF.FILL_RANGE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,sne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_RANGE_STYLE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,oae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_STYLE_FONT,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,lae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_FORMATTER,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Xne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_TEXT_DECORATION,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,cae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.MERGE_CELLS,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,mne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_ROW_COL_CHANGE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,uae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_ROW_COL_VISIBLE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,sae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.DO_CLEAR,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,tne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.CLEAR_VALUES_STYLE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Nre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.FORMAT_PIVOT_TABLE_RANGE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,cne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SORT_RANGE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,_ae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.AUTO_FIT_ROW,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Ore,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.AUTO_FIT_COLUMN,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Ire,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.ADD_SHEET,{canUndo:!0,execute:function(e,t,r,n){return xre(e,Tre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.MOVE_SHEET,{canUndo:!0,execute:function(e,t,r,n){return xre(e,Zne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.DELETE_SHEET,{canUndo:!0,execute:function(e,t,r,n){return xre(e,Xre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_SHEET_PROPERTY,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,xne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.COPY_SHEET,{canUndo:!0,execute:function(e,t,r,n){return xre(e,Hre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.RESIZE_ROW,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,$ne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.RESIZE_COLUMN,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Pne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.EDIT_CELL,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,ane,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_CELL_NOTE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Sae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.CLEAR_NOTES,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Tae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.MOVE_RANGE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,kne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.FILL,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,une,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.HORIZONTAL_FILL,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,fne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.VERTICAL_FILL,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,kae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.CLEAR_VALUES,{canUndo:!0,execute:function(e,t,r,n){return Ce.Ps3.collectSuiteEvent("edit_cell_content",{action:"delete"}),Zre(e,Vre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_FILTER,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,jne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.FREEZE_SHEET,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,hne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.FORMAT_PAINTER,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,lne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.REPLACE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Dne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_DROPDOWN_VALID,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Wne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.CONVERT_LINK,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Bre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_CHART,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Lne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_FLOAT_BLOCK,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Jne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_EMBEDDED_BLOCK,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Gne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_FLOAT_IMAGE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Kne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.CONVERT_IMAGE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Lre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.MODIFY_VALUES,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,gne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_CONDITIONAL_FORMAT,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Une,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.ADD_BLOCK,{canUndo:!0,execute:function(e,t,r,n){return xre(e,ore,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.DEL_BLOCK,{canUndo:!0,execute:function(e,t,r,n){return xre(e,Kre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.COPY_BLOCK,{canUndo:!0,execute:function(e,t,r,n){return xre(e,Ure,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.ADD_VIEW,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Sre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.ENTER_VIEW,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,one,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.EXIT_VIEW,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,ine,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.DEL_VIEW,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,ene,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_VIEW,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,dae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_FILTER_VIEW,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,qne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.ADD_REMINDER,{canUndo:!0,execute:function(e,t,r,n){return xre(e,wre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_REMINDER,{canUndo:!0,execute:function(e,t,r,n){return xre(e,iae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_DATA_VALIDATION,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Gre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_LIST_DATA_VALIDATION,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Jre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_CHECKBOX_VALIDATION,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Yre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_DATE_TIME_VALIDATION,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,jre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_VALUE_BY_DATA_VALIDATION,{canUndo:!0,execute:function(e,t,r,n){return xre(e,fae,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_MULTIPLE_VALUES_BY_RANGE,{canUndo:!0,execute:function(e,t,r,n){return xre(e,Qne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.ADD_ROW_AND_COL,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,kre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.DATA_SPLIT,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Are,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.SET_DATA_RANGE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Hne,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.ADD_OUTLINE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,_re,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.DEL_OUTLINE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Qre,t,r,n)}}),(0,l.Z)(nt,Ce.rvF.UPDATE_OUTLINE,{canUndo:!0,execute:function(e,t,r,n){return Zre(e,Eae,t,r,n)}}),nt);Aae[Ce.rvF.DEL_VIEW_NOT_UNDO]={canUndo:!1,execute:function(e,t,r,n){return Zre(e,ene,t,r,n)}},Aae[Ce.rvF.ADD_VIEW_NOT_UNDO]={canUndo:!1,execute:function(e,t,r,n){return Zre(e,Sre,t,r,n)}},Aae[Ce.rvF.SET_COMMENTS]={canUndo:!1,execute:function(e,t,r,n){return Zre(e,Bne,t,r,n)}},Aae[Ce.rvF.LOCK_ROW]={canUndo:!1,execute:function(e,t,r,n){return Zre(e,vne,t,r,n)}},Aae[Ce.rvF.UNLOCK_ROW]={canUndo:!1,execute:function(e,t,r,n){return Zre(e,Cae,t,r,n)}},Aae[Ce.rvF.LOCK_COL]={canUndo:!1,execute:function(e,t,r,n){return Zre(e,dne,t,r,n)}},Aae[Ce.rvF.UNLOCK_COL]={canUndo:!1,execute:function(e,t,r,n){return Zre(e,Rae,t,r,n)}},Aae[Ce.rvF.LOCK_SHEET]={canUndo:!1,execute:function(e,t,r,n){return xre(e,pne,t,r,n)}},Aae[Ce.rvF.UNLOCK_SHEET]={canUndo:!1,execute:function(e,t,r,n){return xre(e,wae,t,r,n)}},Aae[Ce.rvF.MOVE_ROW_COL]={canUndo:!0,execute:function(e,t,r,n){return Zre(e,Fne,t,r,n)}},function(e){e.BackColor="backColor",e.FontSize="fontSize",e.ForeColor="foreColor",e.Frame="frame",e.HAlign="hAlign",e.HideLink="hideLink",e.VAlign="vAlign",e.WordWrap="wordWrap"}(vae||(vae={})),function(e){e.ToolbarDropdown="toolbar_dropdown",e.ToolbarValidation="toolbar_validation",e.AiCreateSheet="AiCreateSheet"}(pae||(pae={})),function(e){e.ADD="add",e.SET="set",e.DEL="del",e.MOVE="move",e.CLEAR_RANGE="clearRange"}(mae||(mae={})),function(e){e[e.Add=0]="Add",e[e.Set=1]="Set",e[e.Del=2]="Del"}(gae||(gae={})),function(e){e[e.Add=0]="Add",e[e.Set=1]="Set",e[e.Del=2]="Del"}(yae||(yae={}));var Iae=function(e){var t=e.commandManager();(0,L.Z)(Aae,(function(e,r){t.register(r,e)}))},Oae=function(){function e(){(0,y.Z)(this,e),this.range$=new ft.X(null),this.visibleRanges$=new ft.X([]),this.invisibleRanges$=new ft.X([]),this.primaryRanges$=new ft.X([]),this.highlightedRows=null,this.highlightFirstDuplicationItem=!1}return(0,_.Z)(e,[{key:"setIsFirstDuplicationItem",value:function(e){this.highlightFirstDuplicationItem=e}},{key:"getIsFirstDuplicationItem",value:function(){return this.highlightFirstDuplicationItem}},{key:"hasHighlightedRange",value:function(){return!!this.highlightedRows}},{key:"cellInHighlightedRange",value:function(e,t){var r=this.range$.getValue()||this.visibleRanges$.getValue()[0]||this.primaryRanges$.getValue()[0];return!(!r||!this.highlightedRows)&&(Lo(r.colFrom(),r.colTo(),t,t)&&this.highlightedRows.has(e))}},{key:"cellInHighlightedRows",value:function(e){this.highlightedRows=e}},{key:"updateSearchingRange",value:function(e){this.range$.next(e)}},{key:"updateDuplicationRanges",value:function(e,t,r){this.visibleRanges$.next(e),this.invisibleRanges$.next(t),this.primaryRanges$.next(r)}},{key:"clear",value:function(){this.range$.next(null),this.visibleRanges$.next([]),this.invisibleRanges$.next([]),this.primaryRanges$.next([])}},{key:"clearHighlight",value:function(){this.visibleRanges$.next([]),this.invisibleRanges$.next([]),this.primaryRanges$.next([])}},{key:"dispose",value:function(){this.range$.complete(),this.visibleRanges$.complete(),this.invisibleRanges$.complete(),this.primaryRanges$.complete()}}]),e}();Vu([(0,ut.P)()],Oae.prototype,"dispose",null),Oae=Vu([(0,st.b)()],Oae)}}]);
//# sourceMappingURL=//slardar.bytedance.net/api_v2/browser/jserr/get_sourcemap?bid=docs_pc&js_filename=sheet_core.e1c778f9.js