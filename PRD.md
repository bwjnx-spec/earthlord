# 产品需求文档 (PRD)
## 地球新主 (Earth Lord)

---

## 1. 产品概述

### 1.1 产品名称
**地球新主 (Earth Lord)**

### 1.2 产品定位
基于真实地理位置的末日生存经营游戏，玩家通过GPS圈地、探索现实世界POI、收集资源、建造设施，在末日世界中建立自己的领地王国。

### 1.3 目标用户
- 年龄：18-45岁
- 特征：喜欢LBS游戏、生存建造类游戏、社交互动的玩家
- 场景：户外活动、日常通勤、休闲娱乐

### 1.4 核心价值主张
- **真实世界探索**：将现实世界转化为游戏地图，鼓励玩家户外活动
- **领地经营**：通过GPS圈地系统建立专属领地
- **资源循环**：探索-收集-建造-交易的完整经济系统
- **社交互动**：公共频道、私聊、PTT呼叫等多种社交方式

---

## 2. 产品背景

### 2.1 世界观设定
- **时间线**：
  - 2048年："世界战争"爆发，全球文明在72小时内崩塌
  - 2051年：幸存者按照《新开拓者协议》重建家园

- **核心法则**：
  > "凡以双足丈量之无主土地，皆为开拓者所有。"

- **视觉风格**：
  - **希望朋克** (Hope Punk)
  - 废土背景 + 希望元素
  - 破败建筑 + 新生绿植
  - 灰暗色调 + 明亮标志

### 2.2 开发背景
- 代码规模：48,000+ 行
- 开发模式：AI辅助独立开发
- 平台：iOS

---

## 3. 功能需求

### 3.1 核心游戏循环

```
┌─────────────────────────────────────────────────────────────┐
│                      游戏核心循环                            │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   登录注册 → 圈地占领 → 探索搜刮 → 获得资源                   │
│      ↑                              ↓                       │
│      │         ┌──────────────────────────────┐            │
│      │         │  资源用途：                    │            │
│      │         │  • 建造建筑（消耗资源）         │            │
│      │         │  • 交易换取（获得收益）         │            │
│      │         │  • 生存消耗（维持运营）         │            │
│      │         └──────────────────────────────┘            │
│      │                              ↓                       │
│      │         ┌──────────────────────────────┐            │
│      │         │  持续发展：                    │            │
│      │         │  • 通讯社交（玩家互动）         │            │
│      │         │  • 成就排行（竞争激励）         │            │
│      └─────────└──────────────────────────────┘            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. 详细功能模块

### 4.1 第一部分：登录与圈地系统

#### 4.1.1 第一阶段：登录注册系统

**功能描述**：
- 多种登录方式：
  - 邮箱 + 密码
  - Apple ID
  - Google账号

**技术要点**：
- 使用Supabase进行用户认证
- 支持OAuth 2.0协议
- 本地存储用户会话token

**验收标准**：
- [ ] 支持三种登录方式
- [ ] 登录成功后自动跳转到主界面
- [ ] 错误提示清晰明确
- [ ] 支持自动登录（记住登录状态）

---

#### 4.1.2 第二阶段：GPS圈地系统

**功能描述**：
玩家通过真实行走，用GPS轨迹圈出领地范围

**核心机制**：
1. **开始圈地**：
   - 点击"开始圈地"按钮
   - 系统开始记录GPS轨迹

2. **行走绘制**：
   - 实时显示行走路径
   - 显示已圈面积
   - 显示当前位置

3. **完成圈地**：
   - 回到起点附近（误差<10米）自动闭合
   - 或手动点击"完成圈地"
   - 系统验证领地有效性

**技术要点**：
- 使用Apple MapKit进行地图显示
- 使用Core Location获取GPS数据
- 使用PostGIS存储地理数据
- 多边形面积计算算法

**限制条件**：
- 单次圈地最小面积：100平方米
- 单次圈地最大面积：100,000平方米
- 领地不能与已有领地重叠
- 必须在户外开阔区域（GPS精度要求）

**验收标准**：
- [ ] GPS定位精度<10米
- [ ] 实时显示行走轨迹
- [ ] 正确计算圈地面积
- [ ] 检测领地重叠冲突
- [ ] 数据实时同步到云端

---

#### 4.1.3 第三阶段：领地管理

**功能描述**：
查看和管理自己的所有领地

**功能列表**：
1. **领地列表**：
   - 显示所有领地
   - 显示领地面积
   - 显示创建时间
   - 显示领地资源产出

2. **领地详情**：
   - 在地图上高亮显示
   - 显示建筑列表
   - 显示资源统计
   - 显示领地名称（可编辑）

3. **领地操作**：
   - 重命名领地
   - 删除领地（需确认）
   - 查看领地历史

**验收标准**：
- [ ] 正确显示所有领地
- [ ] 领地信息准确无误
- [ ] 支持领地重命名
- [ ] 删除操作有二次确认

---

### 4.2 第二部分：探索与资源获取

#### 4.2.1 第四阶段：POI发现与搜刮

**功能描述**：
玩家在现实世界中移动，发现并搜刮POI（兴趣点）获取资源

**POI类型**：
- 🏪 商店：食物、日用品
- 🏥 医院：医疗用品
- ⛽ 加油站：燃料
- 🏭 工厂：建材、工具
- 🌳 公园：水源、木材
- 🏢 写字楼：电子元件

**发现机制**：
1. **自动发现**：
   - 玩家移动到POI附近（50米内）
   - 自动在地图上显示POI图标
   - 首次发现获得额外奖励

2. **搜刮机制**：
   - 点击POI进入搜刮界面
   - 显示可获得的资源
   - 每个POI每6小时可搜刮一次
   - 消耗行动点数

**技术要点**：
- 使用Apple Maps POI数据
- 本地缓存已发现POI
- 搜刮冷却时间管理
- 资源掉落概率算法

**验收标准**：
- [ ] 准确检测玩家与POI距离
- [ ] 正确显示POI类型和状态
- [ ] 搜刮冷却时间正确
- [ ] 资源掉落符合预期

---

#### 4.2.2 第五阶段：背包系统

**功能描述**：
存储和管理玩家收集的所有资源

**背包设计**：
1. **容量系统**：
   - 初始容量：50格
   - 可通过升级扩容
   - 最大容量：200格

2. **资源分类**：
   - 🥫 食物：维持生存
   - 💊 医疗：治疗伤病
   - ⛽ 燃料：能源消耗
   - 🔧 工具：建造材料
   - 💎 贵重品：交易货币
   - 📦 其他：特殊物品

3. **物品操作**：
   - 使用物品
   - 丢弃物品
   - 拆分堆叠
   - 物品详情

**技术要点**：
- 本地优先存储（SQLite）
- 后台同步到云端（Supabase）
- 离线支持
- 数据冲突解决

**验收标准**：
- [ ] 背包容量计算正确
- [ ] 物品分类清晰
- [ ] 支持离线操作
- [ ] 数据同步无丢失

---

### 4.3 第三部分：建造与交易系统

#### 4.3.1 第六阶段：建造系统

**功能描述**：
在领地内建造各种设施

**建筑类型**：
1. **资源建筑**：
   - 🏠 庇护所：基础建筑
   - 🌾 农田：生产食物
   - 💧 净水厂：生产水源
   - ⚡ 发电站：生产能源

2. **功能建筑**：
   - 🏪 交易所：物品交易
   - 📡 通讯塔：扩展通讯范围
   - 🔬 实验室：科技研究
   - 🏰 防御塔：领地防御

**建造流程**：
1. 选择建造位置（必须在领地内）
2. 选择建筑类型
3. 检查资源是否足够
4. 确认建造
5. 等待建造完成（实时倒计时）

**建造要求**：
- 消耗资源
- 占用领地空间
- 建造时间（可加速）
- 前置科技解锁

**验收标准**：
- [ ] 建筑类型齐全
- [ ] 资源消耗正确
- [ ] 建造倒计时准确
- [ ] 建筑位置限制有效

---

#### 4.3.2 第七阶段：建筑状态

**功能描述**：
建筑具有不同状态，需要维护和升级

**状态系统**：
1. **基础状态**：
   - 🏗️ 建造中
   - ✅ 正常运行
   - ⚠️ 需要维护
   - ❌ 损坏停运

2. **升级系统**：
   - 等级：1-10级
   - 每级提升产出/效率
   - 消耗资源和时间

3. **维护系统**：
   - 定期消耗维护资源
   - 未维护导致效率下降
   - 长期不维护导致损坏

**验收标准**：
- [ ] 状态转换逻辑正确
- [ ] 升级系统运作正常
- [ ] 维护提醒及时

---

#### 4.3.3 第八阶段：交易系统

**功能描述**：
玩家之间或与NPC进行物品交易

**交易方式**：
1. **玩家交易**：
   - 点对点交易
   - 交易所挂单
   - 拍卖系统

2. **NPC商店**：
   - 系统商店（固定价格）
   - 流动商人（随机刷新）

3. **交易货币**：
   - 主货币：废土币
   - 硬货币：钻石（充值获得）

**验收标准**：
- [ ] 交易流程安全可靠
- [ ] 价格计算正确
- [ ] 支持交易历史查询
- [ ] 防止交易欺诈

---

### 4.4 第四部分：通讯系统

#### 4.4.1 第九阶段：消息中心

**功能描述**：
接收和管理各类消息通知

**消息类型**：
- 📬 系统消息：游戏公告、更新通知
- 👥 好友消息：私聊消息
- 📢 频道消息：公共频道@提醒
- 🔔 游戏通知：建造完成、资源满了、领地被攻击

**功能特性**：
- 消息分类显示
- 未读消息提醒
- 消息搜索
- 消息删除

**验收标准**：
- [ ] 消息推送及时
- [ ] 消息分类准确
- [ ] 支持消息搜索

---

#### 4.4.2 第十阶段：公共频道聊天

**功能描述**：
全服玩家公共聊天频道

**频道类型**：
- 🌍 世界频道：全服玩家
- 📍 区域频道：附近玩家（5km范围）
- 👥 联盟频道：联盟成员
- 📢 系统频道：系统公告

**聊天功能**：
- 文字消息
- 表情符号
- 物品链接
- 坐标分享
- @提醒

**验收标准**：
- [ ] 消息发送接收流畅
- [ ] 频道切换正常
- [ ] 敏感词过滤
- [ ] 举报功能完善

---

#### 4.4.3 第十一阶段：频道管理

**功能描述**：
创建和管理自定义频道

**管理功能**：
- 创建频道
- 邀请成员
- 踢出成员
- 设置管理员
- 频道设置（公开/私密）

**验收标准**：
- [ ] 频道创建成功
- [ ] 权限管理正确
- [ ] 成员管理功能完整

---

#### 4.4.4 第十二阶段：PTT呼叫

**功能描述**：
一键语音呼叫（Push-To-Talk）

**功能特性**：
- 按住说话
- 松开发送
- 实时语音传输
- 支持群组呼叫

**技术要点**：
- 语音编码压缩
- 实时音频传输
- 低延迟优化

**验收标准**：
- [ ] 语音质量清晰
- [ ] 延迟<500ms
- [ ] 支持后台运行

---

### 4.5 第五部分：商业变现与社交

#### 4.5.1 个人中心

**功能描述**：
玩家个人信息和成就展示

**内容包括**：
- 玩家头像和昵称
- 等级和经验值
- 领地统计
- 成就徽章
- 游戏数据统计

---

#### 4.5.2 付费订阅

**订阅类型**：
1. **月度订阅**（¥30/月）：
   - 每日资源包
   - 建造时间-20%
   - 背包容量+50

2. **年度订阅**（¥298/年）：
   - 月度订阅所有特权
   - 专属皮肤
   - VIP标识

**验收标准**：
- [ ] 订阅购买流程完整
- [ ] 特权正确生效
- [ ] 支持订阅管理

---

#### 4.5.3 排行榜系统

**排行榜类型**：
- 🏆 领地面积榜
- 💰 财富榜
- 🎖️ 成就榜
- 👥 联盟榜

**更新规则**：
- 每小时更新一次
- 显示前100名
- 显示自己的排名

**验收标准**：
- [ ] 排名计算准确
- [ ] 更新及时
- [ ] 防作弊机制

---

#### 4.5.4 成就系统

**成就分类**：
- 探索成就：发现POI数量
- 建造成就：建筑数量和等级
- 社交成就：好友数量、聊天次数
- 战斗成就：防御成功次数
- 收集成就：收集资源种类

**成就奖励**：
- 成就点数
- 专属称号
- 稀有道具
- 钻石奖励

**验收标准**：
- [ ] 成就进度正确追踪
- [ ] 完成成就自动解锁
- [ ] 奖励正确发放

---

## 5. 技术架构

### 5.1 技术栈

**前端**：
- 平台：iOS
- 语言：Swift
- UI框架：SwiftUI
- 地图：MapKit
- 定位：Core Location

**后端**：
- BaaS：Supabase
- 数据库：PostgreSQL + PostGIS
- 认证：Supabase Auth
- 实时通讯：Supabase Realtime
- 存储：Supabase Storage

**本地存储**：
- SQLite（资源数据）
- UserDefaults（配置）
- Core Data（可选）

### 5.2 数据架构

**本地优先策略**：
1. 数据优先存储在本地
2. 后台异步同步到云端
3. 冲突时以服务器为准
4. 支持离线操作

**关键数据表**：
- users（用户）
- territories（领地）
- buildings（建筑）
- inventory（背包）
- pois（兴趣点）
- messages（消息）
- transactions（交易）

---

## 6. 非功能需求

### 6.1 性能要求
- App启动时间：<3秒
- 地图加载时间：<2秒
- GPS定位延迟：<1秒
- 消息发送延迟：<500ms

### 6.2 兼容性
- iOS 17.0+
- iPhone 12及以上机型
- 支持iPhone和iPad

### 6.3 安全性
- 用户数据加密传输
- 本地数据加密存储
- 防作弊检测
- 敏感信息脱敏

### 6.4 可用性
- 7x24小时服务
- 99.9%可用性
- 支持离线模式
- 数据自动备份

---

## 7. 里程碑规划

### Phase 1: MVP（4-6周）
- [x] 登录注册系统
- [x] GPS圈地基础功能
- [x] 简单的资源收集
- [x] 基础建造系统

### Phase 2: 核心玩法（6-8周）
- [ ] 完整的POI发现系统
- [ ] 建筑状态和升级
- [ ] 交易系统
- [ ] 基础社交功能

### Phase 3: 社交与变现（4-6周）
- [ ] 完整通讯系统
- [ ] 付费订阅
- [ ] 排行榜
- [ ] 成就系统

### Phase 4: 优化与上线（4周）
- [ ] 性能优化
- [ ] Bug修复
- [ ] 多语言支持
- [ ] App Store上线

---

## 8. 风险与挑战

### 8.1 技术风险
- GPS定位精度受环境影响
- 实时通讯的网络延迟
- 大量地理数据的存储和查询性能

**应对措施**：
- 使用融合定位（GPS + WiFi + 基站）
- WebSocket连接优化
- PostGIS地理索引优化

### 8.2 产品风险
- 用户户外活动意愿不高
- 圈地玩法学习成本高
- 资源平衡性难以把握

**应对措施**：
- 新手引导优化
- 游戏化激励机制
- 数据驱动的平衡性调整

### 8.3 运营风险
- 用户留存率
- 付费转化率
- 作弊行为

**应对措施**：
- 每日任务和活动
- 合理的付费点设计
- 完善的反作弊系统

---

## 9. 成功指标 (KPI)

### 9.1 用户指标
- DAU（日活跃用户）：目标10,000
- MAU（月活跃用户）：目标50,000
- 次日留存率：>40%
- 7日留存率：>20%

### 9.2 业务指标
- 付费率：>5%
- ARPU（平均每用户收入）：>¥10
- LTV（用户生命周期价值）：>¥100

### 9.3 游戏指标
- 平均游戏时长：>30分钟/天
- 圈地数量：平均每用户>3块
- 社交互动：平均每用户每天发送>5条消息

---

## 10. 附录

### 10.1 术语表
- **POI**：Point of Interest，兴趣点
- **LBS**：Location Based Service，基于位置的服务
- **PTT**：Push-To-Talk，一键通话
- **BaaS**：Backend as a Service，后端即服务

### 10.2 参考资料
- MapKit官方文档
- Supabase官方文档
- PostGIS地理数据库文档
- iOS人机界面设计指南

---

**文档版本**：v1.0
**创建日期**：2025-12-23
**最后更新**：2025-12-23
**文档负责人**：产品团队
