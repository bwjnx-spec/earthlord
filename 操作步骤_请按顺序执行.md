# 🎯 TLS 错误修复 - 详细操作步骤（请按顺序执行）

## ✅ 我已经帮你完成的工作

1. ✅ 创建了 `Info.plist` 文件（包含网络安全配置）
2. ✅ 创建了「网络诊断工具」
3. ✅ 添加了所有必要的配置
4. ✅ 准备好了所有文档

## 🚨 问题根源

**你的 Supabase 项目无法访问！**很可能是被暂停了（免费项目 7 天无活动自动暂停）

---

## 📝 你需要完成的操作（共 3 步，5 分钟）

### 第 1 步：恢复 Supabase 项目 ⭐ 最重要

#### 1.1 打开浏览器，访问
```
https://supabase.com/dashboard
```

#### 1.2 登录你的 Supabase 账户
- 使用你注册时的邮箱和密码

#### 1.3 查找你的项目
在项目列表中找到：
```
项目 ID: xlhkojuliphmvmzhpgzw
或
项目名称: earthlord（或你起的名字）
```

#### 1.4 检查项目状态

**情况 A：项目显示「Paused」或「已暂停」**
1. 点击该项目卡片
2. 你会看到一个 **"Resume"** 或 **"恢复项目"** 按钮
3. ⭐ **点击这个按钮**
4. 等待 1-2 分钟，项目状态变为 "Active"
5. ✅ 完成！跳到第 2 步

**情况 B：项目在列表中，状态是 "Active"**
- 说明项目没问题
- 可能是网络问题，继续第 2 步

**情况 C：项目不在列表中（已删除）**
- 需要创建新项目
- 查看下面的「补充说明 A」

---

### 第 2 步：在 Xcode 中添加 Info.plist 文件

#### 2.1 打开 Xcode 项目
```
双击打开: earthlord.xcodeproj
```

#### 2.2 添加 Info.plist 到项目

**方法 1（推荐）：拖拽添加**
1. 打开 Finder，找到文件：
   ```
   白文娟——地球新主复刻/earthlord/earthlord/Info.plist
   ```
2. 将这个文件 **拖拽** 到 Xcode 左侧的 `earthlord` 文件夹中
3. 在弹出的对话框中：
   - ✅ 勾选 "Copy items if needed"
   - ✅ 勾选 "Add to targets: earthlord"
   - 点击 "Finish"

**方法 2：使用菜单添加**
1. 在 Xcode 左侧，右键点击 `earthlord` 文件夹
2. 选择 "Add Files to earthlord..."
3. 找到 `Info.plist` 文件并选择
4. 确保勾选上面的选项
5. 点击 "Add"

#### 2.3 验证是否添加成功
在 Xcode 左侧导航器中，你应该看到：
```
earthlord
├─ earthlord
│  ├─ Assets.xcassets
│  ├─ Components
│  ├─ Info.plist  ← 应该看到这个文件
│  ├─ Managers
│  └─ Views
```

---

### 第 3 步：清理并运行项目

#### 3.1 清理构建缓存
在 Xcode 中：
```
菜单栏 → Product → Clean Build Folder
或按快捷键：Shift + Command + K
```

#### 3.2 运行项目
```
点击左上角的 ▶️ 按钮
或按快捷键：Command + R
```

#### 3.3 测试结果

**成功标志**：
- ✅ 不再显示 TLS 错误
- ✅ 可以看到注册/登录界面
- ✅ 可以尝试注册（输入邮箱会发送验证码）

**如果还是失败**：
- 进入 App 的「更多」标签
- 点击「网络诊断工具」
- 点击「开始测试」
- 查看详细的错误信息
- 截图发给我

---

## 🔍 如何验证 Supabase 项目已恢复

### 方法 1：在终端测试
打开终端（Terminal），运行：
```bash
curl -I https://xlhkojuliphmvmzhpgzw.supabase.co
```

**成功**应该看到：
```
HTTP/2 200
```

**失败**会看到：
```
curl: (35) SSL error  ← 说明项目还没恢复
```

### 方法 2：在浏览器测试
在浏览器地址栏输入：
```
https://xlhkojuliphmvmzhpgzw.supabase.co
```

**成功**：
- 显示一个页面（可能是 404 或 Supabase 页面）

**失败**：
- 无法连接
- 连接超时

### 方法 3：使用 App 内诊断工具
1. 运行 App
2. 进入「更多」标签
3. 点击「网络诊断工具」
4. 点击「开始测试」
5. 查看结果

---

## 📸 操作截图示例

### Supabase Dashboard 应该看起来像这样：

**项目已暂停的样子**：
```
┌────────────────────────────────┐
│  earthlord                     │
│  xlhkojuliphmvmzhpgzw         │
│                                │
│  Status: Paused ⏸️             │
│  [Resume Project] ← 点这里     │
└────────────────────────────────┘
```

**项目恢复后的样子**：
```
┌────────────────────────────────┐
│  earthlord                     │
│  xlhkojuliphmvmzhpgzw         │
│                                │
│  Status: Active ✅             │
└────────────────────────────────┘
```

### Xcode 添加文件对话框：
```
┌─────────────────────────────────┐
│ Options:                        │
│ ☑️ Copy items if needed         │
│ ☑️ Create groups               │
│                                 │
│ Add to targets:                │
│ ☑️ earthlord                   │
│                                 │
│        [Cancel]  [Add]          │
└─────────────────────────────────┘
```

---

## 🆘 补充说明

### 补充说明 A：如果需要创建新的 Supabase 项目

如果你的项目已被删除，需要创建新项目：

#### A1. 创建新项目
1. 在 Supabase Dashboard 点击 "New Project"
2. 填写：
   - Name: `earthlord`
   - Database Password: 设置一个强密码（记住它！）
   - Region: 选择 `Singapore` 或 `Tokyo`
   - Plan: `Free`
3. 点击 "Create new project"
4. 等待 2-3 分钟创建完成

#### A2. 获取新的连接信息
1. 进入项目后，点击左侧 "Settings"
2. 点击 "API"
3. 复制以下信息：
   - **URL**: `https://[新的ID].supabase.co`
   - **anon public key**: `eyJ...`（很长的字符串）

#### A3. 更新 iOS 项目配置
告诉我新的 URL 和 Key，我会帮你更新 `RootView.swift` 文件。

---

### 补充说明 B：Info.plist 配置说明

我创建的 Info.plist 包含：

1. **网络安全配置**（修复 TLS 错误）
   ```xml
   NSAppTransportSecurity
   └─ NSAllowsArbitraryLoads = true
   ```

2. **隐私权限**
   - 位置权限（用于地图功能）

3. **Google 登录配置**
   - URL Scheme
   - Client ID

这些配置都是必需的，已经为你设置好了。

---

### 补充说明 C：如果遇到其他错误

#### C1. 编译错误
如果 Xcode 显示编译错误：
1. 按 `Command + Shift + K` 清理
2. 关闭 Xcode
3. 删除 DerivedData：
   ```bash
   rm -rf ~/Library/Developer/Xcode/DerivedData/*
   ```
4. 重新打开 Xcode 并运行

#### C2. 模拟器错误
如果模拟器无法启动：
1. 关闭模拟器
2. 在 Xcode 中：Device → Erase All Content and Settings
3. 重新运行

#### C3. 网络仍然无法连接
1. 检查 Mac 的网络连接
2. 关闭 VPN（如果有）
3. 尝试切换网络（WiFi / 手机热点）
4. 使用 App 内的网络诊断工具查看详细错误

---

## ✅ 完成检查清单

完成后请检查：

- [ ] Supabase 项目状态显示 "Active"
- [ ] 终端 curl 测试返回 HTTP/2 200
- [ ] Info.plist 文件已添加到 Xcode 项目
- [ ] Xcode 编译成功（没有红色错误）
- [ ] App 可以正常启动
- [ ] 不再显示 TLS 错误
- [ ] 可以看到注册/登录界面

---

## 📞 如果还有问题

完成上述步骤后，如果还有问题，请告诉我：

1. **Supabase 项目状态**（Active / Paused / 找不到）
2. **终端测试结果**（复制完整输出）
3. **App 诊断工具结果**（截图）
4. **Xcode 错误信息**（如果有）

我会继续帮你解决！

---

## 🎉 预期结果

完成这 3 步后：
- ✅ TLS 错误消失
- ✅ 可以正常注册和登录
- ✅ 所有网络功能正常工作

开始操作吧！有任何问题随时告诉我！💪
